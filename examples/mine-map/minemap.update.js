(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.minemap = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function geometry(e){var r,t=0;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=polygonArea(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)t+=geometry(e.geometries[r]);return t}}function polygonArea(e){var r=0;if(e&&e.length>0){r+=Math.abs(ringArea(e[0]));for(var t=1;t<e.length;t++)r-=Math.abs(ringArea(e[t]))}return r}function ringArea(e){var r,t,n,o,a,i,g,s=0,l=e.length;if(l>2){for(g=0;g<l;g++)g===l-2?(o=l-2,a=l-1,i=0):g===l-1?(o=l-1,a=0,i=1):(o=g,a=g+1,i=g+2),r=e[o],t=e[a],n=e[i],s+=(rad(n[0])-rad(r[0]))*Math.sin(rad(t[1]));s=s*wgs84.RADIUS*wgs84.RADIUS/2}return s}function rad(e){return e*Math.PI/180}var wgs84=require("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea;
},{"wgs84":198}],2:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.glMatrix=n()}(this,function(){"use strict";function t(t,n,r){var e=n[0],a=n[1],o=n[2];return t[0]=e*r[0]+a*r[3]+o*r[6],t[1]=e*r[1]+a*r[4]+o*r[7],t[2]=e*r[2]+a*r[5]+o*r[8],t}function n(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3];return t[0]=r[0]*e+r[4]*a+r[8]*o+r[12]*u,t[1]=r[1]*e+r[5]*a+r[9]*o+r[13]*u,t[2]=r[2]*e+r[6]*a+r[10]*o+r[14]*u,t[3]=r[3]*e+r[7]*a+r[11]*o+r[15]*u,t}function r(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function e(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+o*i,t[1]=a*c+u*i,t[2]=e*-i+o*c,t[3]=a*-i+u*c,t}function a(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=r[0],c=r[1];return t[0]=e*i,t[1]=a*i,t[2]=o*c,t[3]=u*c,t}function o(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function u(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,n){var r=n[0],e=n[1],a=n[2],o=n[3],u=n[4],i=n[5],c=n[6],f=n[7],v=n[8],s=n[9],l=n[10],M=n[11],h=n[12],m=n[13],y=n[14],d=n[15],p=r*i-e*u,w=r*c-a*u,A=r*f-o*u,F=e*c-a*i,x=e*f-o*i,b=a*f-o*c,g=v*m-s*h,j=v*y-l*h,R=v*d-M*h,X=s*y-l*m,Z=s*d-M*m,k=l*d-M*y,q=p*k-w*Z+A*X+F*R-x*j+b*g;return q?(q=1/q,t[0]=(i*k-c*Z+f*X)*q,t[1]=(a*Z-e*k-o*X)*q,t[2]=(m*b-y*x+d*F)*q,t[3]=(l*x-s*b-M*F)*q,t[4]=(c*R-u*k-f*j)*q,t[5]=(r*k-a*R+o*j)*q,t[6]=(y*A-h*b-d*w)*q,t[7]=(v*b-l*A+M*w)*q,t[8]=(u*Z-i*R+f*g)*q,t[9]=(e*R-r*Z-o*g)*q,t[10]=(h*x-m*A+d*p)*q,t[11]=(s*A-v*x-M*p)*q,t[12]=(i*j-u*X-c*g)*q,t[13]=(r*X-e*j+a*g)*q,t[14]=(m*w-h*F-y*p)*q,t[15]=(v*F-s*w+l*p)*q,t):null}function v(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],m=n[12],y=n[13],d=n[14],p=n[15],w=r[0],A=r[1],F=r[2],x=r[3];return t[0]=w*e+A*i+F*s+x*m,t[1]=w*a+A*c+F*l+x*y,t[2]=w*o+A*f+F*M+x*d,t[3]=w*u+A*v+F*h+x*p,w=r[4],A=r[5],F=r[6],x=r[7],t[4]=w*e+A*i+F*s+x*m,t[5]=w*a+A*c+F*l+x*y,t[6]=w*o+A*f+F*M+x*d,t[7]=w*u+A*v+F*h+x*p,w=r[8],A=r[9],F=r[10],x=r[11],t[8]=w*e+A*i+F*s+x*m,t[9]=w*a+A*c+F*l+x*y,t[10]=w*o+A*f+F*M+x*d,t[11]=w*u+A*v+F*h+x*p,w=r[12],A=r[13],F=r[14],x=r[15],t[12]=w*e+A*i+F*s+x*m,t[13]=w*a+A*c+F*l+x*y,t[14]=w*o+A*f+F*M+x*d,t[15]=w*u+A*v+F*h+x*p,t}function s(t,n,r){var e,a,o,u,i,c,f,v,s,l,M,h,m=r[0],y=r[1],d=r[2];return n===t?(t[12]=n[0]*m+n[4]*y+n[8]*d+n[12],t[13]=n[1]*m+n[5]*y+n[9]*d+n[13],t[14]=n[2]*m+n[6]*y+n[10]*d+n[14],t[15]=n[3]*m+n[7]*y+n[11]*d+n[15]):(e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],t[0]=e,t[1]=a,t[2]=o,t[3]=u,t[4]=i,t[5]=c,t[6]=f,t[7]=v,t[8]=s,t[9]=l,t[10]=M,t[11]=h,t[12]=e*m+i*y+s*d+n[12],t[13]=a*m+c*y+l*d+n[13],t[14]=o*m+f*y+M*d+n[14],t[15]=u*m+v*y+h*d+n[15]),t}function l(t,n,r){var e=r[0],a=r[1],o=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function M(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[4],u=n[5],i=n[6],c=n[7],f=n[8],v=n[9],s=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*a+f*e,t[5]=u*a+v*e,t[6]=i*a+s*e,t[7]=c*a+l*e,t[8]=f*a-o*e,t[9]=v*a-u*e,t[10]=s*a-i*e,t[11]=l*a-c*e,t}function h(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[0],u=n[1],i=n[2],c=n[3],f=n[4],v=n[5],s=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*a+f*e,t[1]=u*a+v*e,t[2]=i*a+s*e,t[3]=c*a+l*e,t[4]=f*a-o*e,t[5]=v*a-u*e,t[6]=s*a-i*e,t[7]=l*a-c*e,t}function m(t,n,r,e,a){var o=1/Math.tan(n/2),u=1/(e-a);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*u,t[15]=0,t}function y(t,n,r,e,a,o,u){var i=1/(n-r),c=1/(e-a),f=1/(o-u);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(n+r)*i,t[13]=(a+e)*c,t[14]=(u+o)*f,t[15]=1,t}(function(){var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0})(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}();return{vec3:{transformMat3:t},vec4:{transformMat4:n},mat2:{create:r,rotate:e,scale:a},mat3:{create:o,fromRotation:u},mat4:{create:i,identity:c,translate:s,scale:l,multiply:v,perspective:m,rotateX:M,rotateZ:h,invert:f,ortho:y}}});
},{}],3:[function(require,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ShelfPack=e()}(this,function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}function i(t,e,i,s,h,n,r){this.id=t,this.x=e,this.y=i,this.w=s,this.h=h,this.maxw=n||s,this.maxh=r||h,this.refcount=0}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,s,h,n,r=[],f=0;f<t.length;f++)if(i=t[f].w||t[f].width,s=t[f].h||t[f].height,h=t[f].id,i&&s){if(!(n=this.packOne(i,s,h)))continue;e.inPlace&&(t[f].x=n.x,t[f].y=n.y,t[f].id=n.id),r.push(n)}if(this.shelves.length>0){for(var o=0,a=0,u=0;u<this.shelves.length;u++){var l=this.shelves[u];a+=l.h,o=Math.max(l.w-l.free,o)}this.resize(o,a)}return r},t.prototype.packOne=function(t,i,s){var h,n,r,f,o={freebin:-1,shelf:-1,waste:1/0},a=0;if("string"==typeof s||"number"==typeof s){if(h=this.getBin(s))return this.ref(h),h;"number"==typeof s&&(this.maxId=Math.max(s,this.maxId))}else s=++this.maxId;for(f=0;f<this.freebins.length;f++){if(h=this.freebins[f],i===h.maxh&&t===h.maxw)return this.allocFreebin(f,t,i,s);i>h.maxh||t>h.maxw||i<=h.maxh&&t<=h.maxw&&(r=h.maxw*h.maxh-t*i)<o.waste&&(o.waste=r,o.freebin=f)}for(f=0;f<this.shelves.length;f++)if(n=this.shelves[f],a+=n.h,!(t>n.free)){if(i===n.h)return this.allocShelf(f,t,i,s);i>n.h||i<n.h&&(r=(n.h-i)*t)<o.waste&&(o.freebin=-1,o.waste=r,o.shelf=f)}if(o.freebin!==-1)return this.allocFreebin(o.freebin,t,i,s);if(o.shelf!==-1)return this.allocShelf(o.shelf,t,i,s);if(i<=this.h-a&&t<=this.w)return n=new e(a,this.w,i),this.allocShelf(this.shelves.push(n)-1,t,i,s);if(this.autoResize){var u,l,c,p;return u=l=this.h,c=p=this.w,(c<=u||t>c)&&(p=2*Math.max(t,c)),(u<c||i>u)&&(l=2*Math.max(i,u)),this.resize(p,l),this.packOne(t,i,s)}return null},t.prototype.allocFreebin=function(t,e,i,s){var h=this.freebins.splice(t,1)[0];return h.id=s,h.w=e,h.h=i,h.refcount=0,this.bins[s]=h,this.ref(h),h},t.prototype.allocShelf=function(t,e,i,s){var h=this.shelves[t],n=h.alloc(e,i,s);return this.bins[s]=n,this.ref(n),n},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},e.prototype.alloc=function(t,e,s){if(t>this.free||e>this.h)return null;var h=this.x;return this.x+=t,this.free-=t,new i(s,h,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t});
},{}],4:[function(require,module,exports){
function UnitBezier(t,i,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(r-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=e,this.p2y=r}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,i){void 0===i&&(i=1e-6);var e,r,s,h,n;for(s=t,n=0;n<8;n++){if(h=this.sampleCurveX(s)-t,Math.abs(h)<i)return s;var u=this.sampleCurveDerivativeX(s);if(Math.abs(u)<1e-6)break;s-=h/u}if(e=0,r=1,(s=t)<e)return e;if(s>r)return r;for(;e<r;){if(h=this.sampleCurveX(s),Math.abs(h-t)<i)return s;t>h?e=s:r=s,s=.5*(r-e)+e}return s},UnitBezier.prototype.solve=function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))};
},{}],5:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.WhooTS=e.WhooTS||{})}(this,function(e){function t(e,t,r,n,i,s){return s=s||{},e+"?"+["bbox="+o(r,n,i),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+t].join("&")}function o(e,t,o){t=Math.pow(2,o)-t-1;var n=r(256*e,256*t,o),i=r(256*(e+1),256*(t+1),o);return n[0]+","+n[1]+","+i[0]+","+i[1]}function r(e,t,o){var r=2*Math.PI*6378137/256/Math.pow(2,o);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=t,e.getTileBBox=o,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})});
},{}],6:[function(require,module,exports){
var measureDistance=require("@turf/distance"),point=require("@turf/helpers").point,bearing=require("@turf/bearing"),destination=require("@turf/destination");module.exports=function(e,r,t){var i;if("Feature"===e.type)i=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");i=e.coordinates}for(var n=0,a=0;a<i.length&&!(r>=n&&a===i.length-1);a++){if(n>=r){var o=r-n;if(o){var u=bearing(i[a],i[a-1])-180;return destination(i[a],o,u,t)}return point(i[a])}n+=measureDistance(i[a],i[a+1],t)}return point(i[i.length-1])};
},{"@turf/bearing":11,"@turf/destination":23,"@turf/distance":26,"@turf/helpers":33}],7:[function(require,module,exports){
var area=require("@mapbox/geojson-area").geometry,geomReduce=require("@turf/meta").geomReduce;module.exports=function(e){return geomReduce(e,function(e,r){return e+area(r)},0)};
},{"@mapbox/geojson-area":1,"@turf/meta":63}],8:[function(require,module,exports){
function clipPolygon(e,n){for(var r=[],t=0;t<e.length;t++){var i=lineclip.polygon(e[t],n);i.length>0&&(i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0]),r.push(i))}return r}function getGeom(e){return e.geometry?e.geometry.type:e.type}var helpers=require("@turf/helpers"),lineclip=require("lineclip"),getCoords=require("@turf/invariant").getCoords,lineString=helpers.lineString,multiLineString=helpers.multiLineString,polygon=helpers.polygon,multiPolygon=helpers.multiPolygon;module.exports=function(e,n){var r=getGeom(e),t=getCoords(e),i=e.properties;switch(r){case"LineString":case"MultiLineString":var o=[];return"LineString"===r&&(t=[t]),t.forEach(function(e){lineclip(e,n,o)}),1===o.length?lineString(o[0],i):multiLineString(o,i);case"Polygon":return polygon(clipPolygon(t,n),i);case"MultiPolygon":return multiPolygon(t.map(function(e){return clipPolygon(e,n)}),i);default:throw new Error("geometry "+r+" not supported")}};
},{"@turf/helpers":33,"@turf/invariant":38,"lineclip":145}],9:[function(require,module,exports){
var polygon=require("@turf/helpers").polygon;module.exports=function(o){var r=[o[0],o[1]],e=[o[0],o[3]],n=[o[2],o[3]],l=[o[2],o[1]];return polygon([[r,l,n,e,r]])};
},{"@turf/helpers":33}],10:[function(require,module,exports){
var coordEach=require("@turf/meta").coordEach;module.exports=function(r){var o=[1/0,1/0,-(1/0),-(1/0)];return coordEach(r,function(r){o[0]>r[0]&&(o[0]=r[0]),o[1]>r[1]&&(o[1]=r[1]),o[2]<r[0]&&(o[2]=r[0]),o[3]<r[1]&&(o[3]=r[1])}),o};
},{"@turf/meta":63}],11:[function(require,module,exports){
function bearing(a,t,r){if(r===!0)return calculateFinalBearing(a,t);var n=Math.PI/180,e=180/Math.PI,i=getCoord(a),o=getCoord(t),c=n*i[0],h=n*o[0],u=n*i[1],M=n*o[1],g=Math.sin(h-c)*Math.cos(M),s=Math.cos(u)*Math.sin(M)-Math.sin(u)*Math.cos(M)*Math.cos(h-c);return e*Math.atan2(g,s)}function calculateFinalBearing(a,t){var r=bearing(t,a);return r=(r+180)%360}var getCoord=require("@turf/invariant").getCoord;module.exports=bearing;
},{"@turf/invariant":38}],12:[function(require,module,exports){
var linestring=require("@turf/helpers").lineString,Spline=require("./spline.js");module.exports=function(r,e,n){for(var i=[],t=new Spline({points:r.geometry.coordinates.map(function(r){return{x:r[0],y:r[1]}}),duration:e,sharpness:n}),o=0;o<t.duration;o+=10){var s=t.pos(o);Math.floor(o/100)%2==0&&i.push([s.x,s.y])}return linestring(i,r.properties)};
},{"./spline.js":13,"@turf/helpers":33}],13:[function(require,module,exports){
var Spline=function(s){this.points=s.points||[],this.duration=s.duration||1e4,this.sharpness=s.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=s.stepLength||60,this.length=this.points.length,this.delay=0;for(var t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(var t=0;t<this.length-1;t++){var i=this.points[t],h=this.points[t+1];this.centers.push({x:(i.x+h.x)/2,y:(i.y+h.y)/2,z:(i.z+h.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var t=0;t<this.centers.length-1;t++){var i=this.centers[t],h=this.centers[t+1],n=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,e=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,r=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+e),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+r)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+e),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+r)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};Spline.prototype.cacheSteps=function(s){var t=[],i=this.pos(0);t.push(0);for(var h=0;h<this.duration;h+=10){var n=this.pos(h);Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y)+(n.z-i.z)*(n.z-i.z))>s&&(t.push(h),i=n)}return t},Spline.prototype.vector=function(s){var t=this.pos(s+10),i=this.pos(s-10);return{angle:180*Math.atan2(t.y-i.y,t.x-i.x)/3.14,speed:Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)+(i.z-t.z)*(i.z-t.z))}},Spline.prototype.pos=function(s){var t=s-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var i=t/this.duration;if(i>=1)return this.points[this.length-1];var h=Math.floor((this.points.length-1)*i),n=(this.length-1)*i-h;return function(s,t,i,h,n){var e=function(s){var t=s*s;return[t*s,3*t*(1-s),3*s*(1-s)*(1-s),(1-s)*(1-s)*(1-s)]}(s);return{x:n.x*e[0]+h.x*e[1]+i.x*e[2]+t.x*e[3],y:n.y*e[0]+h.y*e[1]+i.y*e[2]+t.y*e[3],z:n.z*e[0]+h.z*e[1]+i.z*e[2]+t.z*e[3]}}(n,this.points[h],this.controls[h][1],this.controls[h+1][0],this.points[h+1])},module.exports=Spline;
},{}],14:[function(require,module,exports){
function buffer(e,r,t,o){var n=e.properties||{},a="Feature"===e.type?e.geometry:e;switch(a.type){case"Point":return circle(a.coordinates,r,o,t,n);case"GeometryCollection":var i=[];return geomEach(e,function(e){var n=buffer(e,r,t,o);n&&i.push(n)}),featureCollection(i)}var c=radiansToDistance(distanceToRadians(r,t),"meters"),s=defineProjection(e),u={type:a.type,coordinates:projectCoords(a.coordinates,s)},f=new jsts.io.GeoJSONReader,d=f.read(u),p=d.buffer(c);if(p=(new jsts.io.GeoJSONWriter).write(p),!coordsIsNaN(p.coordinates))return p.coordinates=unprojectCoords(p.coordinates,s),feature(p,n)}function coordsIsNaN(e){return Array.isArray(e[0])?coordsIsNaN(e[0]):isNaN(e[0])}function projectCoords(e,r){return"object"!=typeof e[0]?r(e):e.map(function(e){return projectCoords(e,r)})}function unprojectCoords(e,r){return"object"!=typeof e[0]?r.invert(e):e.map(function(e){return unprojectCoords(e,r)})}function defineProjection(e){var r=center(e).geometry.coordinates.reverse(),t=r.map(function(e){return-e});return d3.geoTransverseMercator().center(r).rotate(t).scale(6373e3)}var d3=require("d3-geo"),jsts=require("jsts"),meta=require("@turf/meta"),circle=require("@turf/circle"),center=require("@turf/center"),helpers=require("@turf/helpers"),feature=helpers.feature,geomEach=meta.geomEach,featureEach=meta.featureEach,featureCollection=helpers.featureCollection,radiansToDistance=helpers.radiansToDistance,distanceToRadians=helpers.distanceToRadians;module.exports=function(e,r,t,o){if(!e)throw new Error("geojson is required");if(void 0===r)throw new Error("radius is required");if(o<=0)throw new Error("steps must be greater than 0");o=o||64,t=t||"kilometers";var n=[];switch(e.type){case"GeometryCollection":return geomEach(e,function(e){var a=buffer(e,r,t,o);a&&n.push(a)}),featureCollection(n);case"FeatureCollection":return featureEach(e,function(e){var a=buffer(e,r,t,o);a&&featureEach(a,function(e){e&&n.push(e)})}),featureCollection(n)}return buffer(e,r,t,o)};
},{"@turf/center":16,"@turf/circle":18,"@turf/helpers":33,"@turf/meta":63,"d3-geo":103,"jsts":140}],15:[function(require,module,exports){
function centerOfMass(e,r){switch(e.geometry?e.geometry.type:e.type){case"Point":return point(getCoord(e),r);case"Polygon":var t=[];coordEach(e,function(e){t.push(e)});var o,n,c,i,u,a,d,f,p=centroid(e,r),s=p.geometry.coordinates,v=0,g=0,l=0,h=t.map(function(e){return[e[0]-s[0],e[1]-s[1]]});for(o=0;o<t.length-1;o++)n=h[o],i=n[0],a=n[1],c=h[o+1],u=c[0],d=c[1],f=i*d-u*a,l+=f,v+=(i+u)*f,g+=(a+d)*f;if(0===l)return p;var x=.5*l,m=1/(6*x);return point([s[0]+m*v,s[1]+m*g],r);default:var q=convex(explode(e));return q?centerOfMass(q,r):centroid(e,r)}}var point=require("@turf/helpers").point,convex=require("@turf/convex"),explode=require("@turf/explode"),centroid=require("@turf/centroid"),getCoord=require("@turf/invariant").getCoord,coordEach=require("@turf/meta").coordEach;module.exports=centerOfMass;
},{"@turf/centroid":17,"@turf/convex":22,"@turf/explode":28,"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63}],16:[function(require,module,exports){
var bbox=require("@turf/bbox"),point=require("@turf/helpers").point;module.exports=function(r,e){var o=bbox(r),t=(o[0]+o[2])/2,u=(o[1]+o[3])/2;return point([t,u],e)};
},{"@turf/bbox":10,"@turf/helpers":33}],17:[function(require,module,exports){
var coordEach=require("@turf/meta").coordEach,point=require("@turf/helpers").point;module.exports=function(r,o){var e=0,t=0,c=0;return coordEach(r,function(r){e+=r[0],t+=r[1],c++},!0),point([e/c,t/c],o)};
},{"@turf/helpers":33,"@turf/meta":63}],18:[function(require,module,exports){
var destination=require("@turf/destination"),polygon=require("@turf/helpers").polygon;module.exports=function(r,e,o,i,t){if(!r)throw new Error("center is required");if(!e)throw new Error("radius is required");o=o||64,t=t||r.properties||{};for(var n=[],s=0;s<o;s++)n.push(destination(r,e,360*s/o,i).geometry.coordinates);return n.push(n[0]),polygon([n],t)};
},{"@turf/destination":23,"@turf/helpers":33}],19:[function(require,module,exports){
var turfbbox=require("@turf/bbox"),inside=require("@turf/inside"),rbush=require("rbush");module.exports=function(r,e,o,t){var i=rbush(6),n=e.features.map(function(r){return{minX:r.geometry.coordinates[0],minY:r.geometry.coordinates[1],maxX:r.geometry.coordinates[0],maxY:r.geometry.coordinates[1],property:r.properties[o]}});return i.load(n),r.features.forEach(function(r){r.properties||(r.properties={});var e=turfbbox(r),o=i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),n=[];o.forEach(function(e){inside({type:"Point",coordinates:[e.minX,e.minY]},r)&&n.push(e.property)}),r.properties[t]=n}),r};
},{"@turf/bbox":10,"@turf/inside":36,"rbush":163}],20:[function(require,module,exports){
var meta=require("@turf/meta");module.exports=function(e){function t(e,t,o){o?r[t].coordinates=r[t].coordinates.concat(e.geometry.coordinates):r[t].coordinates.push(e.geometry.coordinates),r[t].properties.push(e.properties)}var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},o=Object.keys(r).reduce(function(e,t){return e[t.replace("Multi","")]=t,e},{});return meta.featureEach(e,function(e){e.geometry&&(r[e.geometry.type]?t(e,e.geometry.type,!0):o[e.geometry.type]&&t(e,o[e.geometry.type],!1))}),{type:"FeatureCollection",features:Object.keys(r).filter(function(e){return r[e].coordinates.length}).sort().map(function(e){return{type:"Feature",properties:{collectedProperties:r[e].properties},geometry:{type:e,coordinates:r[e].coordinates}}})}};
},{"@turf/meta":63}],21:[function(require,module,exports){
function concave(e,r,t){function n(e){var n=e.geometry.coordinates[0][0],o=e.geometry.coordinates[0][1],i=e.geometry.coordinates[0][2],u=distance(n,o,t),a=distance(o,i,t),f=distance(n,i,t);return u<=r&&a<=r&&f<=r}if("number"!=typeof r)throw new Error("maxEdge parameter is required");var o=tin(e),i=o.features.filter(n);if(o.features=i,o.features.length<1)throw new Error("too few polygons found to compute concave hull");return merge(o)}function merge(e){for(var r=JSON.parse(JSON.stringify(e.features[0])),t=e.features,n=0,o=t.length;n<o;n++){var i=t[n];i.geometry&&(r=union(r,i))}return r}var tin=require("@turf/tin"),union=require("@turf/union"),distance=require("@turf/distance");module.exports=concave;
},{"@turf/distance":26,"@turf/tin":85,"@turf/union":92}],22:[function(require,module,exports){
var each=require("@turf/meta").coordEach,convexHull=require("convex-hull"),polygon=require("@turf/helpers").polygon;module.exports=function(e){var r=[];each(e,function(e){r.push([e[0],e[1]])});var o=convexHull(r);if(o.length>=3){for(var u=[],l=0;l<o.length;l++)u.push(r[o[l][0]]);return u.push(r[o[o.length-1][1]]),polygon([u])}};
},{"@turf/helpers":33,"@turf/meta":63,"convex-hull":97}],23:[function(require,module,exports){
var getCoord=require("@turf/invariant").getCoord,helpers=require("@turf/helpers"),point=helpers.point,distanceToRadians=helpers.distanceToRadians;module.exports=function(a,t,s,n){var e=Math.PI/180,i=180/Math.PI,o=getCoord(a),h=e*o[0],r=e*o[1],M=e*s,d=distanceToRadians(t,n),c=Math.asin(Math.sin(r)*Math.cos(d)+Math.cos(r)*Math.sin(d)*Math.cos(M)),p=h+Math.atan2(Math.sin(M)*Math.sin(d)*Math.cos(r),Math.cos(d)-Math.sin(r)*Math.sin(c));return point([i*p,i*c])};
},{"@turf/helpers":33,"@turf/invariant":38}],24:[function(require,module,exports){
function removeEmptyPolygon(e){switch(e.type){case"Polygon":if(area(e)>1)return e;return;case"MultiPolygon":var r=[];if(flattenEach(e,function(e){area(e)>1&&r.push(e.geometry.coordinates)}),r.length)return{type:"MultiPolygon",coordinates:r}}}var jsts=require("jsts"),area=require("@turf/area"),feature=require("@turf/helpers").feature,getGeom=require("@turf/invariant").getGeom,flattenEach=require("@turf/meta").flattenEach;module.exports=function(e,r){var t=getGeom(e),o=getGeom(r),a=e.properties||{};if(t=removeEmptyPolygon(t),o=removeEmptyPolygon(o),t){if(!o)return feature(t,a);var n=new jsts.io.GeoJSONReader,i=n.read(t),u=n.read(o),f=i.difference(u);if(!f.isEmpty()){var s=new jsts.io.GeoJSONWriter,l=s.write(f);return feature(l,a)}}};
},{"@turf/area":7,"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63,"jsts":140}],25:[function(require,module,exports){
function toLinestring(e){if(null===e||void 0===e)throw new Error("No polygon was passed");e.geometry.type="LineString";var r=[].concat.apply([],e.geometry.coordinates);return e.geometry.coordinates=r,e}var turfUnion=require("@turf/union"),turfOverlaps=require("turf-overlaps"),turfbbox=require("@turf/bbox"),Rbush=require("rbush"),gju=require("geojson-utils"),getClosest=require("get-closest");module.exports=function(e,r){for(var t=[],o=[],i=new Rbush,n=0;n<e.features.length;n++){var s=turfbbox(e.features[n]),u={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],origIndexPosition:n};o.push(u)}i.load(o);for(var a=0;a<e.features.length;a++){for(var f=e.features[a],g=turfbbox(f),l={minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]},m=i.search(l),p=!1,v=0;v<m.length;v++){f=e.features[a];var x=m[v].origIndexPosition;if(t.length>0&&0!==x)if(x>t[t.length-1])x-=t.length;else{var b=getClosest.greaterNumber(x,t);0!==b&&(x-=b)}if(x!==a){var d=e.features[x];if(void 0===typeof r||d.properties[r]===f.properties[r]){var h=turfOverlaps(f,d);if(!h){var c=JSON.stringify(f),y=JSON.stringify(d),I=toLinestring(JSON.parse(c)),P=toLinestring(JSON.parse(y));h=gju.lineStringsIntersect(I.geometry,P.geometry)}h&&(e.features[a]=turfUnion(f,d),t.push(m[v].origIndexPosition),t.sort(function(e,r){return e-r}),i.remove(m[v]),e.features.splice(x,1),l.origIndexPosition=a,i.remove(l,function(e,r){return e.origIndexPosition===r.origIndexPosition}),p=!0)}}}if(p){var q=turfbbox(f);i.insert({minX:q[0],minY:q[1],maxX:q[2],maxY:q[3],origIndexPosition:a}),a--}}return e};
},{"@turf/bbox":10,"@turf/union":92,"geojson-utils":126,"get-closest":135,"rbush":163,"turf-overlaps":183}],26:[function(require,module,exports){
var getCoord=require("@turf/invariant").getCoord,radiansToDistance=require("@turf/helpers").radiansToDistance;module.exports=function(t,a,r){var o=Math.PI/180,e=getCoord(t),n=getCoord(a),s=o*(n[1]-e[1]),i=o*(n[0]-e[0]),h=o*e[1],M=o*n[1],d=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(h)*Math.cos(M);return radiansToDistance(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),r)};
},{"@turf/helpers":33,"@turf/invariant":38}],27:[function(require,module,exports){
var bbox=require("@turf/bbox"),bboxPolygon=require("@turf/bbox-polygon");module.exports=function(o){return bboxPolygon(bbox(o))};
},{"@turf/bbox":10,"@turf/bbox-polygon":9}],28:[function(require,module,exports){
var meta=require("@turf/meta"),helpers=require("@turf/helpers"),point=helpers.point,coordEach=meta.coordEach,featureEach=meta.featureEach,featureCollection=helpers.featureCollection;module.exports=function(e){var r=[];return"FeatureCollection"===e.type?featureEach(e,function(e){coordEach(e,function(t){r.push(point(t,e.properties))})}):coordEach(e,function(t){r.push(point(t,e.properties))}),featureCollection(r)};
},{"@turf/helpers":33,"@turf/meta":63}],29:[function(require,module,exports){
function flatten(e){if(!e)throw new Error("geojson is required");var t=[];return flattenEach(e,function(e){t.push(e)}),featureCollection(t)}var flattenEach=require("@turf/meta").flattenEach,featureCollection=require("@turf/helpers").featureCollection;module.exports=flatten;
},{"@turf/helpers":33,"@turf/meta":63}],30:[function(require,module,exports){
var coordEach=require("@turf/meta").coordEach;module.exports=function(r,o){if(!r)throw new Error("geojson is required");return o!==!1&&void 0!==o||(r=JSON.parse(JSON.stringify(r))),coordEach(r,function(r){var o=r[0],e=r[1];r[0]=e,r[1]=o}),r};
},{"@turf/meta":63}],31:[function(require,module,exports){
"use strict";var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(t,e){this.lon=t,this.lat=e,this.x=D2R*t,this.y=D2R*e};Coord.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Coord.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:(180-this.lon)*-1;return new Coord(e,t)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Arc=function(t){this.properties=t||{},this.geometries=[]};Arc.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Arc.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(t){e+=t[0]+" "+t[1]+","},s=0;s<this.geometries.length;s++){if(0===this.geometries[s].coords.length)return"LINESTRING(empty)";this.geometries[s].coords.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};var GreatCircle=function(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Coord(t.x,t.y),this.end=new Coord(e.x,e.y),this.properties=r||{};var s=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(s/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};GreatCircle.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),s=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),h=R2D*Math.atan2(o,Math.sqrt(Math.pow(s,2)+Math.pow(i,2)));return[R2D*Math.atan2(i,s),h]},GreatCircle.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var s=1/(t-1),i=0;i<t;++i){var o=s*i,h=this.interpolate(o);r.push(h)}for(var n=!1,a=0,p=e&&e.offset?e.offset:10,c=180-p,l=-180+p,u=360-p,g=1;g<r.length;++g){var d=r[g-1][0],f=r[g][0],v=Math.abs(f-d);v>u&&(f>c&&d<l||d>c&&f<l)?n=!0:v>a&&(a=v)}var y=[];if(n&&a<p){var M=[];y.push(M);for(var w=0;w<r.length;++w){var m=parseFloat(r[w][0]);if(w>0&&Math.abs(m-r[w-1][0])>u){var x=parseFloat(r[w-1][0]),C=parseFloat(r[w-1][1]),S=parseFloat(r[w][0]),G=parseFloat(r[w][1]);if(x>-180&&x<l&&180===S&&w+1<r.length&&r[w-1][0]>-180&&r[w-1][0]<l){M.push([-180,r[w][1]]),w++,M.push([r[w][0],r[w][1]]);continue}if(x>c&&x<180&&S===-180&&w+1<r.length&&r[w-1][0]>c&&r[w-1][0]<180){M.push([180,r[w][1]]),w++,M.push([r[w][0],r[w][1]]);continue}if(x<l&&S>c){var F=x;x=S,S=F;var L=C;C=G,G=L}if(x>c&&S<l&&(S+=360),x<=180&&S>=180&&x<S){var R=(180-x)/(S-x),b=R*G+(1-R)*C;M.push([r[w-1][0]>c?180:-180,b]),M=[],M.push([r[w-1][0]>c?-180:180,b]),y.push(M)}else M=[],y.push(M);M.push([m,r[w][1]])}else M.push([r[w][0],r[w][1]])}}else{var A=[];y.push(A);for(var E=0;E<r.length;++E)A.push([r[E][0],r[E][1]])}for(var I=new Arc(this.properties),D=0;D<y.length;++D){var N=new LineString;I.geometries.push(N);for(var j=y[D],P=0;P<j.length;++P)N.move_to(j[P])}return I},module.exports={Coord:Coord,Arc:Arc,GreatCircle:GreatCircle};
},{}],32:[function(require,module,exports){
var arc=require("./arc"),getCoord=require("@turf/invariant").getCoord;module.exports=function(r,e,o,t,a){return r=getCoord(r),e=getCoord(e),o=o||{},t=t||100,a=a||10,new arc.GreatCircle({x:r[0],y:r[1]},{x:e[0],y:e[1]},o).Arc(t,{offset:a}).json()};
},{"./arc":31,"@turf/invariant":38}],33:[function(require,module,exports){
function feature(r,e){if(!r)throw new Error("No geometry passed");return{type:"Feature",properties:e||{},geometry:r}}function point(r,e){if(!r)throw new Error("No coordinates passed");if(void 0===r.length)throw new Error("Coordinates must be an array");if(r.length<2)throw new Error("Coordinates must be at least 2 numbers long");if("number"!=typeof r[0]||"number"!=typeof r[1])throw new Error("Coordinates must numbers");return feature({type:"Point",coordinates:r},e)}function polygon(r,e){if(!r)throw new Error("No coordinates passed");for(var n=0;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var t=0;t<o[o.length-1].length;t++)if(o[o.length-1][t]!==o[0][t])throw new Error("First and last Position are not equivalent.")}return feature({type:"Polygon",coordinates:r},e)}function lineString(r,e){if(!r)throw new Error("No coordinates passed");if(r.length<2)throw new Error("Coordinates must be an array of two or more positions");return feature({type:"LineString",coordinates:r},e)}function featureCollection(r){if(!r)throw new Error("No features passed");if(!Array.isArray(r))throw new Error("features must be an Array");return{type:"FeatureCollection",features:r}}function multiLineString(r,e){if(!r)throw new Error("No coordinates passed");return feature({type:"MultiLineString",coordinates:r},e)}function multiPoint(r,e){if(!r)throw new Error("No coordinates passed");return feature({type:"MultiPoint",coordinates:r},e)}function multiPolygon(r,e){if(!r)throw new Error("No coordinates passed");return feature({type:"MultiPolygon",coordinates:r},e)}function geometryCollection(r,e){if(!r)throw new Error("geometries is required");return feature({type:"GeometryCollection",geometries:r},e)}function round(r,e){if(void 0===r||null===r||isNaN(r))throw new Error("num is required");if(e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(r*n)/n}function radiansToDistance(r,e){if(void 0===r||null===r)throw new Error("radians is required");var n=factors[e||"kilometers"];if(!n)throw new Error("units is invalid");return r*n}function distanceToRadians(r,e){if(void 0===r||null===r)throw new Error("distance is required");var n=factors[e||"kilometers"];if(!n)throw new Error("units is invalid");return r/n}function distanceToDegrees(r,e){return radians2degrees(distanceToRadians(r,e))}function bearingToAngle(r){if(null===r||void 0===r)throw new Error("bearing is required");var e=r%360;return e<0&&(e+=360),e}function radians2degrees(r){if(null===r||void 0===r)throw new Error("radians is required");return r%(2*Math.PI)*180/Math.PI}function degrees2radians(r){if(null===r||void 0===r)throw new Error("degrees is required");return r%360*Math.PI/180}function convertDistance(r,e,n){if(null===r||void 0===r)throw new Error("distance is required");if(!(r>=0))throw new Error("distance must be a positive number");return radiansToDistance(distanceToRadians(r,e),n||"kilometers")}var factors={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373e3,metres:6373e3,centimeters:6373e5,centimetres:6373e5,kilometers:6373,kilometres:6373,feet:20908792.65};module.exports={feature:feature,featureCollection:featureCollection,geometryCollection:geometryCollection,point:point,multiPoint:multiPoint,lineString:lineString,multiLineString:multiLineString,polygon:polygon,multiPolygon:multiPolygon,radiansToDistance:radiansToDistance,distanceToRadians:distanceToRadians,distanceToDegrees:distanceToDegrees,radians2degrees:radians2degrees,degrees2radians:degrees2radians,bearingToAngle:bearingToAngle,convertDistance:convertDistance,round:round};
},{}],34:[function(require,module,exports){
function hexagon(e,s,n){for(var r=[],o=0;o<6;o++){var i=e[0]+s*cosines[o],a=e[1]+n*sines[o];r.push([i,a])}return r.push(r[0]),polygon([r])}function hexTriangles(e,s,n){for(var r=[],o=0;o<6;o++){var i=[];i.push(e),i.push([e[0]+s*cosines[o],e[1]+n*sines[o]]),i.push([e[0]+s*cosines[(o+1)%6],e[1]+n*sines[(o+1)%6]]),i.push(e),r.push(polygon([i]))}return r}for(var distance=require("@turf/distance"),helpers=require("@turf/helpers"),point=helpers.point,polygon=helpers.polygon,featureCollection=helpers.featureCollection,cosines=[],sines=[],i=0;i<6;i++){var angle=2*Math.PI/6*i;cosines.push(Math.cos(angle)),sines.push(Math.sin(angle))}module.exports=function(e,s,n,r){var o=e[0],i=e[1],a=e[2],t=e[3],p=(i+t)/2,u=(o+a)/2,h=s/distance(point([o,p]),point([a,p]),n),l=h*(a-o),c=s/distance(point([u,i]),point([u,t]),n),f=c*(t-i),v=l/2,g=2*v,M=Math.sqrt(3)/2*f,d=a-o,x=t-i,y=.75*g,q=M,C=d/(g-v/2),T=Math.ceil(C);Math.round(C)===T&&T++;var m=(T*y-v/2-d)/2-v/2,I=Math.ceil(x/M),P=(x-I*M)/2,b=I*M-x>M/2;b&&(P-=M/4);for(var j=featureCollection([]),k=0;k<T;k++)for(var w=0;w<=I;w++){var z=k%2==1;if((0!==w||!z)&&(0!==w||!b)){var A=k*y+o-m,B=w*q+i+P;z&&(B-=M/2),r?j.features.push.apply(j.features,hexTriangles([A,B],l/2,f/2)):j.features.push(hexagon([A,B],l/2,f/2))}}return j};
},{"@turf/distance":26,"@turf/helpers":33}],35:[function(require,module,exports){
var distance=require("@turf/distance"),squareGrid=require("@turf/square-grid"),centroid=require("@turf/centroid"),bbox=require("@turf/bbox");module.exports=function(e,r,t,i,s){if(0!==e.features.filter(function(e){return e.properties&&e.properties.hasOwnProperty(r)}).length){for(var u=squareGrid(bbox(e),i,s),a=u.features.length,o=0;o<a;o++){for(var f=0,n=0,p=0;p<e.features.length;p++){var d=distance(centroid(u.features[o]),e.features[p],s);0===d&&(f=e.features[p].properties[r]);var c=1/Math.pow(d,t);n+=c,f+=c*e.features[p].properties[r]}u.features[o].properties.z=f/n}return u}console.log("Specified Data Field is Missing")};
},{"@turf/bbox":10,"@turf/centroid":17,"@turf/distance":26,"@turf/square-grid":81}],36:[function(require,module,exports){
function inRing(r,n,e){var o=!1;n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]&&(n=n.slice(0,n.length-1));for(var t=0,i=n.length-1;t<n.length;i=t++){var g=n[t][0],a=n[t][1],u=n[i][0],f=n[i][1];if(r[1]*(g-u)+a*(u-r[0])+f*(r[0]-g)==0&&(g-r[0])*(u-r[0])<=0&&(a-r[1])*(f-r[1])<=0)return!e;a>r[1]!=f>r[1]&&r[0]<(u-g)*(r[1]-a)/(f-a)+g&&(o=!o)}return o}function inBBox(r,n){return n[0]<=r[0]&&n[1]<=r[1]&&n[2]>=r[0]&&n[3]>=r[1]}var invariant=require("@turf/invariant"),getCoord=invariant.getCoord,getCoords=invariant.getCoords;module.exports=function(r,n,e){if(!r)throw new Error("point is required");if(!n)throw new Error("polygon is required");var o=getCoord(r),t=getCoords(n),i=n.geometry?n.geometry.type:n.type,g=n.bbox;if(g&&inBBox(o,g)===!1)return!1;"Polygon"===i&&(t=[t]);for(var a=0,u=!1;a<t.length&&!u;a++)if(inRing(o,t[a][0],e)){for(var f=!1,l=1;l<t[a].length&&!f;)inRing(o,t[a][l],!e)&&(f=!0),l++;f||(u=!0)}return u};
},{"@turf/invariant":38}],37:[function(require,module,exports){
var jsts=require("jsts");module.exports=function(e,r){var t,i;t="Feature"===e.type?e.geometry:e,i="Feature"===r.type?r.geometry:r;var s=new jsts.io.GeoJSONReader,o=s.read(JSON.stringify(t)),a=s.read(JSON.stringify(i)),n=o.intersection(a);if(!n.isEmpty()){return{type:"Feature",properties:{},geometry:(new jsts.io.GeoJSONWriter).write(n)}}};
},{"jsts":140}],38:[function(require,module,exports){
function getCoord(e){if(!e)throw new Error("No obj passed");var r=getCoords(e);if(r.length>1&&"number"==typeof r[0]&&"number"==typeof r[1])return r;throw new Error("Coordinate is not a valid Point")}function getCoords(e){if(!e)throw new Error("No obj passed");var r;if(e.length?r=e:e.coordinates?r=e.coordinates:e.geometry&&e.geometry.coordinates&&(r=e.geometry.coordinates),r)return containsNumber(r),r;throw new Error("No valid coordinates")}function containsNumber(e){if(e.length>1&&"number"==typeof e[0]&&"number"==typeof e[1])return!0;if(Array.isArray(e[0])&&e[0].length)return containsNumber(e[0]);throw new Error("coordinates must only contain numbers")}function geojsonType(e,r,o){if(!r||!o)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+e.type)}function featureOf(e,r,o){if(!e)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+e.geometry.type)}function collectionOf(e,r,o){if(!e)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+o+", FeatureCollection required");for(var t=0;t<e.features.length;t++){var n=e.features[t];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!n.geometry||n.geometry.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+n.geometry.type)}}function getGeom(e){if(!e)throw new Error("<geojson> is required");if(e.geometry)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("<geojson> must be a Feature or Geometry Object")}function getGeomType(e){return getGeom(e).type}module.exports={geojsonType:geojsonType,collectionOf:collectionOf,featureOf:featureOf,getCoord:getCoord,getCoords:getCoords,containsNumber:containsNumber,getGeom:getGeom,getGeomType:getGeomType};
},{}],39:[function(require,module,exports){
function createContourLines(r,e,o){for(var n=[],t=1;t<e.length;t++){var i=+e[t-1],a=+e[t],u=marchingsquares.isoBands(r,i,a-i),s=orderByArea(u),f=groupNestedRings(s),l={};l.groupedRings=f,l[o]=i+"-"+a,n.push(l)}return n}function rescaleContours(r,e,o){var n=bbox(o),t=n[2]-n[0],i=n[3]-n[1],a=n[0],u=n[1],s=e[0].length-1,f=e.length-1,l=t/s,c=i/f,p=function(r){r[0]=r[0]*l+a,r[1]=r[1]*c+u};return r.forEach(function(r){r.groupedRings.forEach(function(r){r.forEach(function(r){r.forEach(p)})})}),r}function orderByArea(r){var e=[],o=[];r.forEach(function(r){var n=area(polygon([r]));o.push(n),e.push({ring:r,area:n})}),o.sort(function(r,e){return e-r});var n=[];return o.forEach(function(r){for(var o=0;o<e.length;o++)if(e[o].area===r){n.push(e[o].ring),e.splice(o,1);break}}),n}function groupNestedRings(r){for(var e=r.map(function(r){return{lrCoordinates:r,grouped:!1}}),o=[];!allGrouped(e);)for(var n=0;n<e.length;n++)if(!e[n].grouped){var t=[];t.push(e[n].lrCoordinates),e[n].grouped=!0;for(var i=polygon([e[n].lrCoordinates]),a=n+1;a<e.length;a++)if(!e[a].grouped){var u=polygon([e[a].lrCoordinates]);isInside(u,i)&&(t.push(e[a].lrCoordinates),e[a].grouped=!0)}o.push(t)}return o}function isInside(r,e){for(var o=explode(r),n=0;n<o.features.length;n++)if(!inside(o.features[n],e))return!1;return!0}function allGrouped(r){for(var e=0;e<r.length;e++)if(r[e].grouped===!1)return!1;return!0}var bbox=require("@turf/bbox"),area=require("@turf/area"),inside=require("@turf/inside"),helpers=require("@turf/helpers"),explode=require("@turf/explode"),invariant=require("@turf/invariant"),gridToMatrix=require("grid-to-matrix"),marchingsquares=require("marchingsquares"),polygon=helpers.polygon,multiPolygon=helpers.multiPolygon,collectionOf=invariant.collectionOf,featureCollection=helpers.featureCollection;module.exports=function(r,e,o,n){var t=function(r){return!!r&&r.constructor===Object};if(collectionOf(r,"Point","Input must contain Points"),!e||!Array.isArray(e))throw new Error("breaks is required");if(n.commonProperties&&!t(n.commonProperties))throw new Error("commonProperties is not an Object");if(n.isobandProperties&&!Array.isArray(n.isobandProperties))throw new Error("isobandProperties is not an Array");if(o&&"string"!=typeof o)throw new Error("zProperty is not a string");o=o||"elevation",n=n||{};var i=n.commonProperties||{},a=n.isobandProperties||[],u=gridToMatrix(r,o,!0),s=createContourLines(u,e,o);s=rescaleContours(s,u,r);var f=s.map(function(r,e){if(a[e]&&!t(a[e]))throw new Error("Each mappedProperty is required to be an Object");var n=Object.assign({},i,a[e]);return n[o]=r[o],multiPolygon(r.groupedRings,n)});return featureCollection(f)};
},{"@turf/area":40,"@turf/bbox":41,"@turf/explode":42,"@turf/helpers":43,"@turf/inside":44,"@turf/invariant":45,"grid-to-matrix":137,"marchingsquares":148}],40:[function(require,module,exports){
arguments[4][7][0].apply(exports,arguments)
},{"@mapbox/geojson-area":1,"@turf/meta":46,"dup":7}],41:[function(require,module,exports){
var each=require("@turf/meta").coordEach;module.exports=function(r){var e=[1/0,1/0,-(1/0),-(1/0)];return each(r,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e};
},{"@turf/meta":46}],42:[function(require,module,exports){
var featureCollection=require("@turf/helpers").featureCollection,featureEach=require("@turf/meta").featureEach,coordEach=require("@turf/meta").coordEach,point=require("@turf/helpers").point;module.exports=function(e){var r=[];return"FeatureCollection"===e.type?featureEach(e,function(e){coordEach(e,function(t){r.push(point(t,e.properties))})}):coordEach(e,function(t){r.push(point(t,e.properties))}),featureCollection(r)};
},{"@turf/helpers":43,"@turf/meta":46}],43:[function(require,module,exports){
function feature(e,r){if(!e)throw new Error("No geometry passed");return{type:"Feature",properties:r||{},geometry:e}}module.exports.feature=feature,module.exports.point=function(e,r){if(!e)throw new Error("No coordinates passed");if(void 0===e.length)throw new Error("Coordinates must be an array");if(e.length<2)throw new Error("Coordinates must be at least 2 numbers long");if("number"!=typeof e[0]||"number"!=typeof e[1])throw new Error("Coordinates must numbers");return feature({type:"Point",coordinates:e},r)},module.exports.polygon=function(e,r){if(!e)throw new Error("No coordinates passed");for(var o=0;o<e.length;o++){var t=e[o];if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var n=0;n<t[t.length-1].length;n++)if(t[t.length-1][n]!==t[0][n])throw new Error("First and last Position are not equivalent.")}return feature({type:"Polygon",coordinates:e},r)},module.exports.lineString=function(e,r){if(!e)throw new Error("No coordinates passed");return feature({type:"LineString",coordinates:e},r)},module.exports.featureCollection=function(e){if(!e)throw new Error("No features passed");return{type:"FeatureCollection",features:e}},module.exports.multiLineString=function(e,r){if(!e)throw new Error("No coordinates passed");return feature({type:"MultiLineString",coordinates:e},r)},module.exports.multiPoint=function(e,r){if(!e)throw new Error("No coordinates passed");return feature({type:"MultiPoint",coordinates:e},r)},module.exports.multiPolygon=function(e,r){if(!e)throw new Error("No coordinates passed");return feature({type:"MultiPolygon",coordinates:e},r)},module.exports.geometryCollection=function(e,r){if(!e)throw new Error("No geometries passed");return feature({type:"GeometryCollection",geometries:e},r)};var factors={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373e3,metres:6373e3,kilometers:6373,kilometres:6373,feet:20908792.65};module.exports.radiansToDistance=function(e,r){var o=factors[r||"kilometers"];if(void 0===o)throw new Error("Invalid unit");return e*o},module.exports.distanceToRadians=function(e,r){var o=factors[r||"kilometers"];if(void 0===o)throw new Error("Invalid unit");return e/o},module.exports.distanceToDegrees=function(e,r){var o=factors[r||"kilometers"];if(void 0===o)throw new Error("Invalid unit");return e/o*57.2958};
},{}],44:[function(require,module,exports){
function inRing(n,r,e){var t=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var i=0,o=r.length-1;i<r.length;o=i++){var a=r[i][0],g=r[i][1],l=r[o][0],v=r[o][1];if(n[1]*(a-l)+g*(l-n[0])+v*(n[0]-a)==0&&(a-n[0])*(l-n[0])<=0&&(g-n[1])*(v-n[1])<=0)return!e;g>n[1]!=v>n[1]&&n[0]<(l-a)*(n[1]-g)/(v-g)+a&&(t=!t)}return t}var invariant=require("@turf/invariant");module.exports=function(n,r){var e=invariant.getCoord(n),t=r.geometry.coordinates;"Polygon"===r.geometry.type&&(t=[t]);for(var i=0,o=!1;i<t.length&&!o;i++)if(inRing(e,t[i][0])){for(var a=!1,g=1;g<t[i].length&&!a;)inRing(e,t[i][g],!0)&&(a=!0),g++;a||(o=!0)}return o};
},{"@turf/invariant":45}],45:[function(require,module,exports){
function getCoord(e){if(!e)throw new Error("No obj passed");var r=getCoords(e);if(r.length>1&&"number"==typeof r[0]&&"number"==typeof r[1])return r;throw new Error("Coordinate is not a valid Point")}function getCoords(e){if(!e)throw new Error("No obj passed");var r;if(e.length?r=e:e.coordinates?r=e.coordinates:e.geometry&&e.geometry.coordinates&&(r=e.geometry.coordinates),r)return containsNumber(r),r;throw new Error("No valid coordinates")}function containsNumber(e){if(e.length>1&&"number"==typeof e[0]&&"number"==typeof e[1])return!0;if(e[0].length)return containsNumber(e[0]);throw new Error("coordinates must only contain numbers")}function geojsonType(e,r,o){if(!r||!o)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+e.type)}function featureOf(e,r,o){if(!e)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+e.geometry.type)}function collectionOf(e,r,o){if(!e)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+o+", FeatureCollection required");for(var t=0;t<e.features.length;t++){var n=e.features[t];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!n.geometry||n.geometry.type!==r)throw new Error("Invalid input to "+o+": must be a "+r+", given "+n.geometry.type)}}module.exports.geojsonType=geojsonType,module.exports.collectionOf=collectionOf,module.exports.featureOf=featureOf,module.exports.getCoord=getCoord,module.exports.getCoords=getCoords;
},{}],46:[function(require,module,exports){
function coordEach(e,o,t){var r,n,u,c,i,l,p,a,f,g,y=0,d=0,s="FeatureCollection"===e.type,h="Feature"===e.type,m=s?e.features.length:1;for(r=0;r<m;r++)for(f=s?e.features[r].geometry:h?e.geometry:e,g="GeometryCollection"===f.type,p=g?f.geometries.length:1,c=0;c<p;c++)if(l=g?f.geometries[c]:f,a=l.coordinates,y=!t||"Polygon"!==l.type&&"MultiPolygon"!==l.type?0:1,"Point"===l.type)o(a,d),d++;else if("LineString"===l.type||"MultiPoint"===l.type)for(n=0;n<a.length;n++)o(a[n],d),d++;else if("Polygon"===l.type||"MultiLineString"===l.type)for(n=0;n<a.length;n++)for(u=0;u<a[n].length-y;u++)o(a[n][u],d),d++;else if("MultiPolygon"===l.type)for(n=0;n<a.length;n++)for(u=0;u<a[n].length;u++)for(i=0;i<a[n][u].length-y;i++)o(a[n][u][i],d),d++;else{if("GeometryCollection"!==l.type)throw new Error("Unknown Geometry Type");for(n=0;n<l.geometries.length;n++)coordEach(l.geometries[n],o,t)}}function coordReduce(e,o,t,r){var n=t;return coordEach(e,function(e,r){n=0===r&&void 0===t?e:o(n,e,r)},r),n}function propEach(e,o){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length;t++)o(e.features[t].properties,t);break;case"Feature":o(e.properties,0)}}function propReduce(e,o,t){var r=t;return propEach(e,function(e,n){r=0===n&&void 0===t?e:o(r,e,n)}),r}function featureEach(e,o){if("Feature"===e.type)o(e,0);else if("FeatureCollection"===e.type)for(var t=0;t<e.features.length;t++)o(e.features[t],t)}function featureReduce(e,o,t){var r=t;return featureEach(e,function(e,n){r=0===n&&void 0===t?e:o(r,e,n)}),r}function coordAll(e){var o=[];return coordEach(e,function(e){o.push(e)}),o}function geomEach(e,o){var t,r,n,u,c,i,l,p=0,a="FeatureCollection"===e.type,f="Feature"===e.type,g=a?e.features.length:1;for(t=0;t<g;t++)for(i=a?e.features[t].geometry:f?e.geometry:e,l="GeometryCollection"===i.type,c=l?i.geometries.length:1,n=0;n<c;n++)if(u=l?i.geometries[n]:i,"Point"===u.type||"LineString"===u.type||"MultiPoint"===u.type||"Polygon"===u.type||"MultiLineString"===u.type||"MultiPolygon"===u.type)o(u,p),p++;else{if("GeometryCollection"!==u.type)throw new Error("Unknown Geometry Type");for(r=0;r<u.geometries.length;r++)o(u.geometries[r],p),p++}}function geomReduce(e,o,t){var r=t;return geomEach(e,function(e,n){r=0===n&&void 0===t?e:o(r,e,n)}),r}module.exports.coordEach=coordEach,module.exports.coordReduce=coordReduce,module.exports.propEach=propEach,module.exports.propReduce=propReduce,module.exports.featureEach=featureEach,module.exports.featureReduce=featureReduce,module.exports.coordAll=coordAll,module.exports.geomEach=geomEach,module.exports.geomReduce=geomReduce;
},{}],47:[function(require,module,exports){
function pointsEqual(e,t){var r=e.x-t.x,a=e.y-t.y;return r*r+a*a<EPSILON}function reverseList(e){for(var t=e.head;t;){var r=t.next;t.next=t.prev,t.prev=r,t=r}var r=e.head;e.head=e.tail,e.tail=r}function ContourBuilder(e){this.level=e,this.s=null,this.count=0}function Conrec(e){if(e)this.drawContour=e;else{var t=this;t.contours={},this.drawContour=function(e,r,a,n,i,s){var o=t.contours[s];o||(o=t.contours[s]=new ContourBuilder(i)),o.addSegment({x:e,y:r},{x:a,y:n})},this.contourList=function(){var e=[],r=t.contours;for(var a in r)for(var n=r[a].s,i=r[a].level;n;){var s=n.head,o=[];for(o.level=i,o.k=a;s&&s.p;)o.push(s.p),s=s.next;e.push(o),n=n.next}return e.sort(function(e,t){return e.k-t.k}),e}}this.h=new Array(5),this.sh=new Array(5),this.xh=new Array(5),this.yh=new Array(5)}module.exports=Conrec;var EPSILON=1e-10;ContourBuilder.prototype.remove_seq=function(e){e.prev?e.prev.next=e.next:this.s=e.next,e.next&&(e.next.prev=e.prev),--this.count},ContourBuilder.prototype.addSegment=function(e,t){for(var r=this.s,a=null,n=null,i=!1,s=!1;r&&(null==a&&(pointsEqual(e,r.head.p)?(a=r,i=!0):pointsEqual(e,r.tail.p)&&(a=r)),null==n&&(pointsEqual(t,r.head.p)?(n=r,s=!0):pointsEqual(t,r.tail.p)&&(n=r)),null==n||null==a);)r=r.next;switch((null!=a?1:0)|(null!=n?2:0)){case 0:var o={p:e,prev:null},l={p:t,next:null};o.next=l,l.prev=o,a={head:o,tail:l,next:this.s,prev:null,closed:!1},this.s&&(this.s.prev=a),this.s=a,++this.count;break;case 1:var h={p:t};i?(h.next=a.head,h.prev=null,a.head.prev=h,a.head=h):(h.next=null,h.prev=a.tail,a.tail.next=h,a.tail=h);break;case 2:var h={p:e};s?(h.next=n.head,h.prev=null,n.head.prev=h,n.head=h):(h.next=null,h.prev=n.tail,n.tail.next=h,n.tail=h);break;case 3:if(a===n){var h={p:a.tail.p,next:a.head,prev:null};a.head.prev=h,a.head=h,a.closed=!0;break}switch((i?1:0)|(s?2:0)){case 0:reverseList(a);case 1:n.tail.next=a.head,a.head.prev=n.tail,n.tail=a.tail,this.remove_seq(a);break;case 3:reverseList(a);case 2:a.tail.next=n.head,n.head.prev=a.tail,a.tail=n.tail,this.remove_seq(n)}}},Conrec.prototype.contour=function(e,t,r,a,n,i,s,o,l){var h=this.h,u=this.sh,v=this.xh,c=this.yh,p=this.drawContour;this.contours={};for(var d,x,f,k,b,y,m=function(e,t){return(h[t]*v[e]-h[e]*v[t])/(h[t]-h[e])},w=function(e,t){return(h[t]*c[e]-h[e]*c[t])/(h[t]-h[e])},C=0,E=0,q=0,L=0,M=[0,1,1,0],S=[0,0,1,1],A=[[[0,0,8],[0,2,5],[7,6,9]],[[0,3,4],[1,3,1],[4,3,0]],[[9,6,7],[5,2,0],[8,0,0]]],B=n-1;B>=a;B--)for(var I=t;I<=r-1;I++){var N,O;if(N=Math.min(e[I][B],e[I][B+1]),O=Math.min(e[I+1][B],e[I+1][B+1]),b=Math.min(N,O),N=Math.max(e[I][B],e[I][B+1]),O=Math.max(e[I+1][B],e[I+1][B+1]),(y=Math.max(N,O))>=l[0]&&b<=l[o-1])for(var P=0;P<o;P++)if(l[P]>=b&&l[P]<=y){for(var _=4;_>=0;_--)_>0?(h[_]=e[I+M[_-1]][B+S[_-1]]-l[P],v[_]=i[I+M[_-1]],c[_]=s[B+S[_-1]]):(h[0]=.25*(h[1]+h[2]+h[3]+h[4]),v[0]=.5*(i[I]+i[I+1]),c[0]=.5*(s[B]+s[B+1])),h[_]>EPSILON?u[_]=1:h[_]<-EPSILON?u[_]=-1:u[_]=0;for(_=1;_<=4;_++)if(d=_,x=0,f=4!=_?_+1:1,0!=(k=A[u[d]+1][u[x]+1][u[f]+1])){switch(k){case 1:C=v[d],q=c[d],E=v[x],L=c[x];break;case 2:C=v[x],q=c[x],E=v[f],L=c[f];break;case 3:C=v[f],q=c[f],E=v[d],L=c[d];break;case 4:C=v[d],q=c[d],E=m(x,f),L=w(x,f);break;case 5:C=v[x],q=c[x],E=m(f,d),L=w(f,d);break;case 6:C=v[f],q=c[f],E=m(d,x),L=w(d,x);break;case 7:C=m(d,x),q=w(d,x),E=m(x,f),L=w(x,f);break;case 8:C=m(x,f),q=w(x,f),E=m(f,d),L=w(f,d);break;case 9:C=m(f,d),q=w(f,d),E=m(d,x),L=w(d,x)}p(C,q,E,L,l[P],P)}}}};
},{}],48:[function(require,module,exports){
var tin=require("@turf/tin"),bbox=require("@turf/bbox"),grid=require("@turf/point-grid"),inside=require("@turf/inside"),square=require("@turf/square"),helpers=require("@turf/helpers"),distance=require("@turf/distance"),planepoint=require("@turf/planepoint"),featurecollection=helpers.featureCollection,linestring=helpers.lineString,point=helpers.point,Conrec=require("./conrec");module.exports=function(e,r,t,i){for(var n=tin(e,r),o=bbox(e),u=square(o),s=distance(point([u[0],u[1]]),point([u[2],u[1]]),"kilometers")/t,p=grid(u,s,"kilometers"),a=[],f=0;f<p.features.length;f++)for(var l=p.features[f],h=0;h<n.features.length;h++){var c=n.features[h];inside(l,c)&&(l.properties={},l.properties[r]=planepoint(l,c))}for(var q=Math.sqrt(p.features.length),g=0;g<q;g++){for(var v=p.features.slice(g*q,(g+1)*q),d=[],b=0;b<v.length;b++)v[b].properties?d.push(v[b].properties[r]):d.push(0);a.push(d)}for(var x=(u[2]-u[0])/q,m=[],C=[],k=0;k<q;k++)m.push(k*x+u[0]),C.push(k*x+u[1]);var E=new Conrec;E.contour(a,0,t,0,t,m,C,i.length,i);var w=E.contourList(),y=featurecollection([]);return w.forEach(function(e){if(e.length>2){var t=[];e.forEach(function(e){t.push([e.x,e.y])});var i=linestring(t);i.properties={},i.properties[r]=e.level,y.features.push(i)}}),y};
},{"./conrec":47,"@turf/bbox":10,"@turf/distance":26,"@turf/helpers":33,"@turf/inside":36,"@turf/planepoint":66,"@turf/point-grid":67,"@turf/square":82,"@turf/tin":85}],49:[function(require,module,exports){
function lineIntersects(e,n,t,o,r,i,l,u){var a,s,y,f,c,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0===(a=(u-i)*(t-e)-(l-r)*(o-n))?null!==p.x&&null!==p.y&&p:(s=n-i,y=e-r,f=(l-r)*s-(u-i)*y,c=(t-e)*s-(o-n)*y,s=f/a,y=c/a,p.x=e+s*(t-e),p.y=n+s*(o-n),s>=0&&s<=1&&(p.onLine1=!0),y>=0&&y<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}var point=require("@turf/helpers").point;module.exports=function(e){var n,t,o={type:"FeatureCollection",features:[]};if(t="Feature"===e.type?e.geometry:e,"LineString"===t.type)n=[t.coordinates];else if("MultiLineString"===t.type)n=t.coordinates;else if("MultiPolygon"===t.type)n=[].concat.apply([],t.coordinates);else{if("Polygon"!==t.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");n=t.coordinates}return n.forEach(function(e){n.forEach(function(n){for(var t=0;t<e.length-1;t++)for(var r=0;r<n.length-1;r++)if(e!==n||1!==Math.abs(t-r)&&Math.abs(t-r)!==e.length-2){var i=lineIntersects(e[t][0],e[t][1],e[t+1][0],e[t+1][1],n[r][0],n[r][1],n[r+1][0],n[r+1][1]);i&&o.features.push(point([i[0],i[1]]))}})}),o};
},{"@turf/helpers":33}],50:[function(require,module,exports){
function convertAngleTo360(r){var e=r%360;return e<0&&(e+=360),e}var destination=require("@turf/destination"),circle=require("@turf/circle"),lineString=require("@turf/helpers").lineString;module.exports=function(r,e,i,n,t,o){if(!r)throw new Error("center is required");if(void 0===i||null===i)throw new Error("bearing1 is required");if(void 0===n||null===n)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");t=t||64;var u=convertAngleTo360(i),s=convertAngleTo360(n),l=r.properties;if(u===s)return lineString(circle(r,e,t,o).geometry.coordinates[0],l);for(var c=u,d=u<s?s:s+360,a=c,g=[],f=0;a<d;)g.push(destination(r,e,a,o).geometry.coordinates),f++,a=c+360*f/t;return a>d&&g.push(destination(r,e,d,o).geometry.coordinates),lineString(g,l)};
},{"@turf/circle":18,"@turf/destination":23,"@turf/helpers":33}],51:[function(require,module,exports){
function sliceLineSegments(e,r,t,n){var i=lineDistance(e,t);if(i<=r)return n(e);for(var o=Math.floor(i/r)+1,l=0;l<o;l++){n(lineSliceAlong(e,r*l,r*(l+1),t),l)}}var lineSliceAlong=require("@turf/line-slice-along"),lineDistance=require("@turf/line-distance"),featureCollection=require("@turf/helpers").featureCollection,flattenEach=require("@turf/meta").flattenEach;module.exports=function(e,r,t,n){if(!e)throw new Error("geojson is required");if(r<=0)throw new Error("segmentLength must be greater than 0");var i=[];return flattenEach(e,function(e){n&&(e.geometry.coordinates=e.geometry.coordinates.reverse()),sliceLineSegments(e,r,t,function(e){i.push(e)})}),featureCollection(i)};
},{"@turf/helpers":33,"@turf/line-distance":52,"@turf/line-slice-along":58,"@turf/meta":63}],52:[function(require,module,exports){
function segmentEach(e,t){var r=0;featureEach(e,function(e){featureEach(flatten(e),function(e){coordReduce(e,function(n,o){var i=lineString([n,o],e.properties);return t(i,r),r++,o})})})}function segmentReduce(e,t,r){var n=r;return segmentEach(e,function(e,o){n=0===o&&void 0===r?e:t(n,e,o)}),n}var flatten=require("@turf/flatten"),distance=require("@turf/distance"),meta=require("@turf/meta"),geomEach=meta.geomEach,featureEach=meta.featureEach,coordReduce=meta.coordReduce,helpers=require("@turf/helpers"),point=helpers.point,lineString=helpers.lineString;module.exports=function(e,t){if(!e)throw new Error("geojson is required");return geomEach(e,function(e){if("Point"===e.type)throw new Error("geojson cannot be a Point");if("MultiPoint"===e.type)throw new Error("geojson cannot be a MultiPoint")}),segmentReduce(e,function(e,r){var n=r.geometry.coordinates,o=point(n[0]),i=point(n[1]);return e+distance(o,i,t)},0)};
},{"@turf/distance":26,"@turf/flatten":29,"@turf/helpers":33,"@turf/meta":63}],53:[function(require,module,exports){
function intersects(e,r){var t=getCoords(e),n=getCoords(r);if(2!==t.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],u=t[1][0],a=t[1][1],s=n[0][0],l=n[0][1],c=n[1][0],f=n[1][1],g=(f-l)*(u-o)-(c-s)*(a-i),h=(c-s)*(i-l)-(f-l)*(o-s),p=(u-o)*(i-l)-(a-i)*(o-s);if(0===g)return null;var m=h/g,y=p/g;if(m>=0&&m<=1&&y>=0&&y<=1){return point([o+m*(u-o),i+m*(a-i)])}return null}var meta=require("@turf/meta"),rbush=require("geojson-rbush"),helpers=require("@turf/helpers"),getCoords=require("@turf/invariant").getCoords,lineSegment=require("@turf/line-segment"),point=helpers.point,featureEach=meta.featureEach,featureCollection=helpers.featureCollection;module.exports=function(e,r){var t={},n=[];if("LineString"===e.type&&(e=helpers.feature(e)),"LineString"===r.type&&(r=helpers.feature(r)),"Feature"===e.type&&"Feature"===r.type&&"LineString"===e.geometry.type&&"LineString"===r.geometry.type&&2===e.geometry.coordinates.length&&2===r.geometry.coordinates.length){var o=intersects(e,r);return o&&n.push(o),featureCollection(n)}var i=rbush();return i.load(lineSegment(r)),featureEach(lineSegment(e),function(e){featureEach(i.search(e),function(r){var o=intersects(e,r);if(o){var i=getCoords(o).join(",");t[i]||(t[i]=!0,n.push(o))}})}),featureCollection(n)};
},{"@turf/helpers":33,"@turf/invariant":38,"@turf/line-segment":57,"@turf/meta":63,"geojson-rbush":121}],54:[function(require,module,exports){
function lineOffset(e,r,t){var n=[],i=distanceToDegrees(r,t),s=getCoords(e),o=[];return s.forEach(function(e,r){if(r!==s.length-1){var t=processSegment(e,s[r+1],i);if(n.push(t),r>0){var u=n[r-1],a=intersection(t,u);a!==!1&&(u[1]=a,t[0]=a),o.push(u[0]),r===s.length-2&&(o.push(t[0]),o.push(t[1]))}2===s.length&&(o.push(t[0]),o.push(t[1]))}}),lineString(o,e.properties)}function processSegment(e,r,t){var n=Math.sqrt((e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1])),i=e[0]+t*(r[1]-e[1])/n,s=r[0]+t*(r[1]-e[1])/n;return[[i,e[1]+t*(e[0]-r[0])/n],[s,r[1]+t*(e[0]-r[0])/n]]}var meta=require("@turf/meta"),helpers=require("@turf/helpers"),getCoords=require("@turf/invariant").getCoords,intersection=require("./intersection"),flattenEach=meta.flattenEach,lineString=helpers.lineString,multiLineString=helpers.multiLineString,distanceToDegrees=helpers.distanceToDegrees;module.exports=function(e,r,t){if(!e)throw new Error("geojson is required");if(void 0===r||null===r||isNaN(r))throw new Error("distance is required");var n="Feature"===e.type?e.geometry.type:e.type,i=e.properties;switch(n){case"LineString":return lineOffset(e,r,t);case"MultiLineString":var s=[];return flattenEach(e,function(e){s.push(lineOffset(e,r,t).geometry.coordinates)}),multiLineString(s,i);default:throw new Error("geometry "+n+" is not supported")}};
},{"./intersection":55,"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63}],55:[function(require,module,exports){
function ab(r){var t=r[0],n=r[1];return[n[0]-t[0],n[1]-t[1]]}function crossProduct(r,t){return r[0]*t[1]-t[0]*r[1]}function add(r,t){return[r[0]+t[0],r[1]+t[1]]}function sub(r,t){return[r[0]-t[0],r[1]-t[1]]}function scalarMult(r,t){return[r*t[0],r*t[1]]}function intersectSegments(r,t){var n=r[0],u=ab(r),e=t[0],c=ab(t),s=crossProduct(u,c);return add(n,scalarMult(crossProduct(sub(e,n),c)/s,u))}function isParallel(r,t){return 0===crossProduct(ab(r),ab(t))}function intersection(r,t){return!isParallel(r,t)&&intersectSegments(r,t)}module.exports=intersection;
},{}],56:[function(require,module,exports){
function concatSegment(e,r){var t=getCoords(r),o=getCoords(e),u=o[0],a=o[o.length-1];return equal(t[0],u)?e.geometry.coordinates.unshift(t[1]):equal(t[0],a)?e.geometry.coordinates.push(t[1]):equal(t[1],u)?e.geometry.coordinates.unshift(t[0]):equal(t[1],a)&&e.geometry.coordinates.push(t[0]),e}var lineSegment=require("@turf/line-segment"),getCoords=require("@turf/invariant").getCoords,rbush=require("geojson-rbush"),equal=require("deep-equal"),featureCollection=require("@turf/helpers").featureCollection,featureEach=require("@turf/meta").featureEach;module.exports=function(e,r){var t=[],o=rbush();o.load(lineSegment(e));var u;return featureEach(lineSegment(r),function(e){var r=!1;featureEach(o.search(e),function(t){if(r===!1){var o=getCoords(e).sort(),a=getCoords(t).sort();equal(o,a)&&(r=!0,u=u?concatSegment(u,e):e)}}),r===!1&&u&&(t.push(u),u=void 0)}),u&&t.push(u),featureCollection(t)};
},{"@turf/helpers":33,"@turf/invariant":38,"@turf/line-segment":57,"@turf/meta":63,"deep-equal":104,"geojson-rbush":121}],57:[function(require,module,exports){
function lineSegment(e,r){var t=[],n=e.geometry;switch(n.type){case"Polygon":t=getCoords(n);break;case"LineString":t=[getCoords(n)]}t.forEach(function(t){createSegments(t,e.properties).forEach(function(e){e.id=r.length,r.push(e)})})}function createSegments(e,r){var t=[];return e.reduce(function(e,n){var o=lineString([e,n],r);return o.bbox=bbox(e,n),t.push(o),n}),t}function bbox(e,r){var t=e[0],n=e[1],o=r[0],i=r[1];return[t<o?t:o,n<i?n:i,t>o?t:o,n>i?n:i]}var helpers=require("@turf/helpers"),getCoords=require("@turf/invariant").getCoords,flattenEach=require("@turf/meta").flattenEach,lineString=helpers.lineString,featureCollection=helpers.featureCollection;module.exports=function(e){if(!e)throw new Error("geojson is required");var r=[];return flattenEach(e,function(e){lineSegment(e,r)}),featureCollection(r)};
},{"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63}],58:[function(require,module,exports){
var bearing=require("@turf/bearing"),distance=require("@turf/distance"),destination=require("@turf/destination"),lineString=require("@turf/helpers").lineString;module.exports=function(e,r,n,t){var i,o=[];if("Feature"===e.type)i=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");i=e.coordinates}for(var u,a,g,s=0,l=0;l<i.length&&!(r>=s&&l===i.length-1);l++){if(s>r&&0===o.length){if(!(u=r-s))return o.push(i[l]),lineString(o);a=bearing(i[l],i[l-1])-180,g=destination(i[l],u,a,t),o.push(g.geometry.coordinates)}if(s>=n)return(u=n-s)?(a=bearing(i[l],i[l-1])-180,g=destination(i[l],u,a,t),o.push(g.geometry.coordinates),lineString(o)):(o.push(i[l]),lineString(o));if(s>=r&&o.push(i[l]),l===i.length-1)return lineString(o);s+=distance(i[l],i[l+1],t)}return lineString(i[i.length-1])};
},{"@turf/bearing":11,"@turf/destination":23,"@turf/distance":26,"@turf/helpers":33}],59:[function(require,module,exports){
var linestring=require("@turf/helpers").lineString,pointOnLine=require("@turf/point-on-line");module.exports=function(e,r,i){var n;if("Feature"===i.type)n=i.geometry.coordinates;else{if("LineString"!==i.type)throw new Error("input must be a LineString Feature or Geometry");n=i.coordinates}var t,o=pointOnLine(i,e),p=pointOnLine(i,r);t=o.properties.index<=p.properties.index?[o,p]:[p,o];for(var s=[t[0].geometry.coordinates],u=t[0].properties.index+1;u<t[1].properties.index+1;u++)s.push(n[u]);return s.push(t[1].geometry.coordinates),linestring(s,i.properties)};
},{"@turf/helpers":33,"@turf/point-on-line":68}],60:[function(require,module,exports){
function geomType(e){return e.geometry?e.geometry.type:e.type}function splitLineWithPoints(e,t){var r=[],n=rbush();return featureEach(t,function(t){if(r.forEach(function(e,t){e.id=t}),r.length){var i=n.search(t),o=findClosestFeature(t,i);r=r.filter(function(e){return e.id!==o.id}),n.remove(o),featureEach(splitLineWithPoint(o,t),function(e){r.push(e),n.insert(e)})}else r=splitLineWithPoint(e,t).features,n.load(featureCollection(r))}),featureCollection(r)}function splitLineWithPoint(e,t){var r=[],n=rbush(),i=lineSegment(e);n.load(i);var o=n.search(t);if(!o.features.length)return featureCollection([e]);var u=findClosestFeature(t,o),s=[getCoords(i.features[0])[0]],a=featureReduce(i,function(e,n,i){var o=getCoords(n)[1],s=getCoords(t);return i===u.id?(e.push(s),r.push(lineString(e)),s[0]===o[0]&&s[1]===o[1]?[s]:[s,o]):(e.push(o),e)},s);return a.length>1&&r.push(lineString(a)),featureCollection(r)}function findClosestFeature(e,t){var r,n;if(!t.features)throw new Error("<lines> must contain features");return 1===t.features.length?t.features[0]:(featureEach(t,function(t){var i=pointOnLine(t,e),o=i.properties.dist;void 0===r?(n=t,r=o):o<r&&(n=t,r=o)}),n)}var flatten=require("@turf/flatten"),pointOnLine=require("@turf/point-on-line"),lineSegment=require("@turf/line-segment"),getCoords=require("@turf/invariant").getCoords,lineIntersect=require("@turf/line-intersect"),rbush=require("geojson-rbush"),helpers=require("@turf/helpers"),featureCollection=helpers.featureCollection,lineString=helpers.lineString,meta=require("@turf/meta"),featureEach=meta.featureEach,featureReduce=meta.featureReduce;module.exports=function(e,t){if("LineString"!==geomType(e))throw new Error("<line> must be LineString");if("FeatureCollection"===geomType(t))throw new Error("<splitter> cannot be a FeatureCollection");switch(geomType(t)){case"Point":return splitLineWithPoint(e,t);case"MultiPoint":return splitLineWithPoints(e,flatten(t));case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return splitLineWithPoints(e,lineIntersect(e,t));default:throw new Error("<splitter> geometry type is not supported")}};
},{"@turf/flatten":29,"@turf/helpers":33,"@turf/invariant":38,"@turf/line-intersect":53,"@turf/line-segment":57,"@turf/meta":63,"@turf/point-on-line":68,"geojson-rbush":121}],61:[function(require,module,exports){
function lineStringToPolygon(e,o,r,t){o=o||e.properties||{};var n=getCoords(e),i=geomType(e);if(!n.length)throw new Error("line must contain coordinates");switch(i){case"LineString":return r&&(n=autoCompleteCoords(n)),polygon([n],o);case"MultiLineString":var l=[],u=0;return n.forEach(function(e){if(r&&(e=autoCompleteCoords(e)),t){var o=calculateArea(bbox(lineString(e)));o>u?(l.unshift(e),u=o):l.push(e)}else l.push(e)}),polygon(l,o);default:throw new Error("geometry type "+i+" is not supported")}}function geomType(e){return e.geometry?e.geometry.type:e.type}function autoCompleteCoords(e){var o=e[0],r=o[0],t=o[1],n=e[e.length-1],i=n[0],l=n[1];return r===i&&t===l||e.push(o),e}function calculateArea(e){var o=e[0],r=e[1],t=e[2],n=e[3];return Math.abs(o-t)*Math.abs(r-n)}var bbox=require("@turf/bbox"),getCoords=require("@turf/invariant").getCoords,helpers=require("@turf/helpers"),polygon=helpers.polygon,multiPolygon=helpers.multiPolygon,lineString=helpers.lineString;module.exports=function(e,o,r,t){if(!e)throw new Error("lines is required");switch(r=void 0===r||r,t=void 0===t||t,geomType(e)){case"FeatureCollection":case"GeometryCollection":var n=[];return(e.features?e.features:e.geometries).forEach(function(e){n.push(getCoords(lineStringToPolygon(e,{},r,t)))}),multiPolygon(n,o)}return lineStringToPolygon(e,o,r,t)};
},{"@turf/bbox":10,"@turf/helpers":33,"@turf/invariant":38}],62:[function(require,module,exports){
function buildMask(e,r,n){var o=[];return o.push(e.geometry.coordinates[0]),featureEach(r,function(e){o.push(e.geometry.coordinates[0])}),featureEach(n,function(e){o.push(e.geometry.coordinates[0])}),helpers.polygon(o)}function separatePolygons(e){var r=[],n=[];return featureEach(e,function(e){"MultiPolygon"===e.geometry.type&&(e=flattenMultiPolygon(e)),featureEach(e,function(e){var o=e.geometry.coordinates,t=o[0],u=o.slice(1);r.push(helpers.polygon([t])),u.forEach(function(e){n.push(helpers.polygon([e]))})})}),[helpers.featureCollection(r),helpers.featureCollection(n)]}function flattenMultiPolygon(e){var r=[];return e.geometry.coordinates.forEach(function(e){r.push(helpers.polygon(e))}),helpers.featureCollection(r)}function createMask(e){var r=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],n=e&&e.geometry.coordinates||r;return helpers.polygon(n)}function unionPolygons(e){if(e.features.length<=1)return e;var r=createIndex(e),n=[],o={};return featureEach(e,function(e,t){if(o[t])return!0;for(r.remove({index:t},filterByIndex),o[t]=!0;;){var u=turfBBox(e),a=r.search({minX:u[0],minY:u[1],maxX:u[2],maxY:u[3]});if(a.length>0){var i=a.map(function(e){return o[e.index]=!0,r.remove({index:e.index},filterByIndex),e.geojson});i.push(e),e=union.apply(this,i)}if(0===a.length)break}n.push(e)}),helpers.featureCollection(n)}function filterByIndex(e,r){return e.index===r.index}function createIndex(e){var r=rbush(),n=[];return featureEach(e,function(e,r){var o=turfBBox(e);n.push({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],geojson:e,index:r})}),r.load(n),r}var rbush=require("rbush"),union=require("@turf/union"),helpers=require("@turf/helpers"),turfBBox=require("@turf/bbox"),featureEach=require("@turf/meta").featureEach;module.exports=function(e,r){var n=createMask(r),o=separatePolygons(e),t=o[0],u=o[1];return t=unionPolygons(t),u=unionPolygons(u),buildMask(n,t,u)};
},{"@turf/bbox":10,"@turf/helpers":33,"@turf/meta":63,"@turf/union":92,"rbush":163}],63:[function(require,module,exports){
function coordEach(e,t,o){var r,n,i,c,a,u,f,l,p,g,y=0,s=0,h="FeatureCollection"===e.type,d="Feature"===e.type,m=h?e.features.length:1;for(r=0;r<m;r++)for(p=h?e.features[r].geometry:d?e.geometry:e,g="GeometryCollection"===p.type,f=g?p.geometries.length:1,c=0;c<f;c++)if(u=g?p.geometries[c]:p,l=u.coordinates,y=!o||"Polygon"!==u.type&&"MultiPolygon"!==u.type?0:1,"Point"===u.type)t(l,s),s++;else if("LineString"===u.type||"MultiPoint"===u.type)for(n=0;n<l.length;n++)t(l[n],s),s++;else if("Polygon"===u.type||"MultiLineString"===u.type)for(n=0;n<l.length;n++)for(i=0;i<l[n].length-y;i++)t(l[n][i],s),s++;else if("MultiPolygon"===u.type)for(n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)for(a=0;a<l[n][i].length-y;a++)t(l[n][i][a],s),s++;else{if("GeometryCollection"!==u.type)throw new Error("Unknown Geometry Type");for(n=0;n<u.geometries.length;n++)coordEach(u.geometries[n],t,o)}}function coordReduce(e,t,o,r){var n=o;return coordEach(e,function(e,r){n=0===r&&void 0===o?e:t(n,e,r)},r),n}function propEach(e,t){var o;switch(e.type){case"FeatureCollection":for(o=0;o<e.features.length;o++)t(e.features[o].properties,o);break;case"Feature":t(e.properties,0)}}function propReduce(e,t,o){var r=o;return propEach(e,function(e,n){r=0===n&&void 0===o?e:t(r,e,n)}),r}function featureEach(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)t(e.features[o],o)}function featureReduce(e,t,o){var r=o;return featureEach(e,function(e,n){r=0===n&&void 0===o?e:t(r,e,n)}),r}function coordAll(e){var t=[];return coordEach(e,function(e){t.push(e)}),t}function geomEach(e,t){var o,r,n,i,c,a,u,f,l=0,p="FeatureCollection"===e.type,g="Feature"===e.type,y=p?e.features.length:1;for(o=0;o<y;o++)for(a=p?e.features[o].geometry:g?e.geometry:e,f=p?e.features[o].properties:g?e.properties:{},u="GeometryCollection"===a.type,c=u?a.geometries.length:1,n=0;n<c;n++)if(i=u?a.geometries[n]:a,"Point"===i.type||"LineString"===i.type||"MultiPoint"===i.type||"Polygon"===i.type||"MultiLineString"===i.type||"MultiPolygon"===i.type)t(i,l,f),l++;else{if("GeometryCollection"!==i.type)throw new Error("Unknown Geometry Type");for(r=0;r<i.geometries.length;r++)t(i.geometries[r],l,f),l++}}function geomReduce(e,t,o){var r=o;return geomEach(e,function(e,n,i){r=0===n&&void 0===o?e:t(r,e,n,i)}),r}function flattenEach(e,t){geomEach(e,function(e,o,r){switch(e.type){case"Point":case"LineString":case"Polygon":return void t(feature(e,r),o,0)}var n;switch(e.type){case"MultiPoint":n="Point";break;case"MultiLineString":n="LineString";break;case"MultiPolygon":n="Polygon"}e.coordinates.forEach(function(e,i){t(feature({type:n,coordinates:e},r),o,i)})})}function flattenReduce(e,t,o){var r=o;return flattenEach(e,function(e,n,i){r=0===n&&0===i&&void 0===o?e:t(r,e,n,i)}),r}function feature(e,t){if(!e)throw new Error("No geometry passed");return{type:"Feature",properties:t||{},geometry:e}}module.exports={coordEach:coordEach,coordReduce:coordReduce,propEach:propEach,propReduce:propReduce,featureEach:featureEach,featureReduce:featureReduce,coordAll:coordAll,geomEach:geomEach,geomReduce:geomReduce,flattenEach:flattenEach,flattenReduce:flattenReduce};
},{}],64:[function(require,module,exports){
var bearing=require("@turf/bearing"),destination=require("@turf/destination"),distance=require("@turf/distance");module.exports=function(e,i){var r=distance(e,i,"miles"),n=bearing(e,i);return destination(e,r/2,n,"miles")};
},{"@turf/bearing":11,"@turf/destination":23,"@turf/distance":26}],65:[function(require,module,exports){
var distance=require("@turf/distance");module.exports=function(e,r){for(var t,a=1/0,s=0;s<r.features.length;s++){var u=distance(e,r.features[s],"miles");u<a&&(t=r.features[s],a=u)}return t};
},{"@turf/distance":26}],66:[function(require,module,exports){
var invariant=require("@turf/invariant"),getCoord=invariant.getCoord,getGeom=invariant.getGeom;module.exports=function(o,r){var e=getCoord(o),t=getGeom(r),i=t.coordinates,n=i[0];if(n.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var a=r.properties||{},v=a.a,g=a.b,d=a.c,u=e[0],m=e[1],s=n[0][0],f=n[0][1],c=void 0!==v?v:n[0][2],h=n[1][0],l=n[1][1],p=void 0!==g?g:n[1][2],C=n[2][0],G=n[2][1],w=void 0!==d?d:n[2][2];return(w*(u-s)*(m-l)+c*(u-h)*(m-G)+p*(u-C)*(m-f)-p*(u-s)*(m-G)-w*(u-h)*(m-f)-c*(u-C)*(m-l))/((u-s)*(m-l)+(u-h)*(m-G)+(u-C)*(m-f)-(u-s)*(m-G)-(u-h)*(m-f)-(u-C)*(m-l))};
},{"@turf/invariant":38}],67:[function(require,module,exports){
var distance=require("@turf/distance"),turfBBox=require("@turf/bbox"),helpers=require("@turf/helpers"),point=helpers.point,featureCollection=helpers.featureCollection;module.exports=function(r,e,o,t){var i=[];if(!r)throw new Error("bbox is required");if(Array.isArray(r)||(r=turfBBox(r)),4!==r.length)throw new Error("bbox must contain 4 numbers");var n=r[0],a=r[1],u=r[2],f=r[3],l=e/distance(point([n,a]),point([u,a]),o),s=l*(u-n),p=e/distance(point([n,a]),point([n,f]),o),h=p*(f-a);if(t===!0)var c=u-n,b=f-a,d=Math.floor(c/s),v=Math.floor(b/h),x=(c-d*s)/2,q=(b-v*h)/2;var w=n;for(t===!0&&(w+=x);w<=u;){var B=a;for(t===!0&&(B+=q);B<=f;)i.push(point([w,B])),B+=h;w+=s}return featureCollection(i)};
},{"@turf/bbox":10,"@turf/distance":26,"@turf/helpers":33}],68:[function(require,module,exports){
var distance=require("@turf/distance"),helpers=require("@turf/helpers"),bearing=require("@turf/bearing"),destination=require("@turf/destination"),lineIntersects=require("@turf/line-intersect"),point=helpers.point,lineString=helpers.lineString;module.exports=function(e,t,r){var i;if("Feature"===e.type)i=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");i=e.coordinates}for(var n=point([1/0,1/0],{dist:1/0}),s=0,o=0;o<i.length-1;o++){var p=point(i[o]),a=point(i[o+1]);p.properties.dist=distance(t,p,r),a.properties.dist=distance(t,a,r);var d=distance(p,a,r),c=Math.max(p.properties.dist,a.properties.dist),l=bearing(p,a),u=destination(t,c,l+90,r),g=destination(t,c,l-90,r),f=lineIntersects(lineString([u.geometry.coordinates,g.geometry.coordinates]),lineString([p.geometry.coordinates,a.geometry.coordinates])),m=null;f.features.length>0&&(m=f.features[0],m.properties.dist=distance(t,m,r),m.properties.location=s+distance(p,m,r)),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=o,n.properties.location=s),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=o+1,n.properties.location=s+d),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=o),s+=d}return n};
},{"@turf/bearing":11,"@turf/destination":23,"@turf/distance":26,"@turf/helpers":33,"@turf/line-intersect":53}],69:[function(require,module,exports){
function pointOnSurface(e){"FeatureCollection"!==e.type&&("Feature"!==e.type&&(e={type:"Feature",geometry:e,properties:{}}),e=featureCollection([e]));for(var t=centroid(e),r=!1,o=0;!r&&o<e.features.length;){var n,i,a,s,u,c,f,d=e.features[o].geometry,l=!1;if("Point"===d.type)t.geometry.coordinates[0]===d.coordinates[0]&&t.geometry.coordinates[1]===d.coordinates[1]&&(r=!0);else if("MultiPoint"===d.type){var g=!1;for(f=0;!g&&f<d.coordinates.length;)t.geometry.coordinates[0]===d.coordinates[f][0]&&t.geometry.coordinates[1]===d.coordinates[f][1]&&(r=!0,g=!0),f++}else if("LineString"===d.type)for(f=0;!l&&f<d.coordinates.length-1;)n=t.geometry.coordinates[0],i=t.geometry.coordinates[1],a=d.coordinates[f][0],s=d.coordinates[f][1],u=d.coordinates[f+1][0],c=d.coordinates[f+1][1],pointOnSegment(n,i,a,s,u,c)&&(l=!0,r=!0),f++;else if("MultiLineString"===d.type)for(var p=0;p<d.coordinates.length;){l=!1,f=0;for(var y=d.coordinates[p];!l&&f<y.length-1;)n=t.geometry.coordinates[0],i=t.geometry.coordinates[1],a=y[f][0],s=y[f][1],u=y[f+1][0],c=y[f+1][1],pointOnSegment(n,i,a,s,u,c)&&(l=!0,r=!0),f++;p++}else if("Polygon"===d.type||"MultiPolygon"===d.type){var m={type:"Feature",geometry:d,properties:{}};inside(t,m)&&(r=!0)}o++}if(r)return t;var h=featureCollection([]);for(o=0;o<e.features.length;o++)h.features=h.features.concat(explode(e.features[o]).features);var v,q=1/0;for(o=0;o<h.features.length;o++){var S=distance(t,h.features[o],"miles");S<q&&(q=S,v=h.features[o])}return v}function pointOnSegment(e,t,r,o,n,i){if(Math.sqrt((n-r)*(n-r)+(i-o)*(i-o))===Math.sqrt((e-r)*(e-r)+(t-o)*(t-o))+Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)))return!0}var featureCollection=require("@turf/helpers").featureCollection,centroid=require("@turf/center"),distance=require("@turf/distance"),inside=require("@turf/inside"),explode=require("@turf/explode");module.exports=pointOnSurface;
},{"@turf/center":16,"@turf/distance":26,"@turf/explode":28,"@turf/helpers":33,"@turf/inside":36}],70:[function(require,module,exports){
function processPolygon(e,o,r,t,n,i){for(var s=0;s<e.length;s++){var l=e[s],u=e[s+1];s===e.length-1&&(u=e[0]),t=isLeft(l,u,o),r<=0&&t>0&&(isBelow(o,l,n)||(n=e[s])),r>0&&t<=0&&(isAbove(o,l,i)||(i=e[s])),r=t}return[n,i]}function isAbove(e,o,r){return isLeft(e,o,r)>=0}function isBelow(e,o,r){return isLeft(e,o,r)<=0}function isLeft(e,o,r){return(o[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(o[1]-e[1])}function getGeomType(e){return e.geometry?e.geometry.type:e.type}var getCoords=require("@turf/invariant").getCoords,helpers=require("@turf/helpers"),featureCollection=helpers.featureCollection;module.exports=function(e,o){var r,t,n,i=getCoords(e),s=getCoords(o);switch(getGeomType(o)){case"Polygon":t=s[0][0],n=s[0][0],r=isLeft(s[0][0],s[0][1],i);var l=processPolygon(s[0],i,r,void 0,t,n);t=l[0],n=l[1];break;case"MultiPolygon":t=s[0][0][0],n=s[0][0][0],r=isLeft(s[0][0][0],s[0][0][1],i),s.forEach(function(e){var o=processPolygon(e[0],i,r,void 0,t,n);t=o[0],n=o[1]})}return featureCollection([helpers.point(t),helpers.point(n)])};
},{"@turf/helpers":33,"@turf/invariant":38}],71:[function(require,module,exports){
function coordsToLine(e,r){return e.length>1?multiLineString(e,r):lineString(e[0],r)}function getGeomType(e){return e.geometry?e.geometry.type:e.type}var getCoords=require("@turf/invariant").getCoords,helpers=require("@turf/helpers"),lineString=helpers.lineString,multiLineString=helpers.multiLineString,featureCollection=helpers.featureCollection;module.exports=function(e,r){var o=getGeomType(e),t=getCoords(e);if(r=r||e.properties||{},!t.length)throw new Error("polygon must contain coordinates");switch(o){case"Polygon":return coordsToLine(t,r);case"MultiPolygon":var n=[];return t.forEach(function(e){n.push(coordsToLine(e,r))}),featureCollection(n);default:throw new Error("geom "+o+" not supported")}};
},{"@turf/helpers":33,"@turf/invariant":38}],72:[function(require,module,exports){
var polygonize=require("polygonize");module.exports=function(o){return polygonize(o)};
},{"polygonize":159}],73:[function(require,module,exports){
var random=require("geojson-random");module.exports=function(o,n,e){switch(e=e||{},n=n||1,o){case"point":case"points":case void 0:return random.point(n,e.bbox);case"polygon":case"polygons":return random.polygon(n,e.num_vertices,e.max_radial_length,e.bbox);default:throw new Error("Unknown type given: valid options are points and polygons")}};
},{"geojson-random":120}],74:[function(require,module,exports){
function rewind(e,r){switch("Feature"===e.type?e.geometry.type:e.type){case"GeometryCollection":return geomEach(e,function(e){rewind(e,r)}),e;case"LineString":return rewindLineString(getCoords(e),r),e;case"Polygon":return rewindPolygon(getCoords(e),r),e;case"MultiLineString":return getCoords(e).forEach(function(e){rewindLineString(e,r)}),e;case"MultiPolygon":return getCoords(e).forEach(function(e){rewindPolygon(e,r)}),e;case"Point":case"MultiPoint":return e}}function rewindLineString(e,r){isClockWise(e)===r&&e.reverse()}function rewindPolygon(e,r){isClockWise(e[0])!==r&&e[0].reverse();for(var o=1;o<e.length;o++)isClockWise(e[o])===r&&e[o].reverse()}var meta=require("@turf/meta"),getCoords=require("@turf/invariant").getCoords,isClockWise=require("turf-is-clockwise"),featureCollection=require("@turf/helpers").featureCollection,geomEach=meta.geomEach,featureEach=meta.featureEach;module.exports=function(e,r,o){if(r=void 0!==r&&r,o=void 0!==o&&o,!e)throw new Error("<geojson> is required");if("boolean"!=typeof r)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof o)throw new Error("<mutate> must be a boolean");o!==!1&&void 0!==o||(e=JSON.parse(JSON.stringify(e)));var t=[];switch(e.type){case"GeometryCollection":return geomEach(e,function(e){rewind(e,r)}),e;case"FeatureCollection":return featureEach(e,function(e){featureEach(rewind(e,r),function(e){t.push(e)})}),featureCollection(t)}return rewind(e,r)};
},{"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63,"turf-is-clockwise":182}],75:[function(require,module,exports){
var getCoord=require("@turf/invariant").getCoord,GeodesyLatLon=require("geodesy").LatLonSpherical;module.exports=function(r,e,o){if(!r)throw new Error("start point is required");if(!e)throw new Error("end point is required");var t,n=getCoord(r),i=getCoord(e),a=new GeodesyLatLon(n[1],n[0]),d=new GeodesyLatLon(i[1],i[0]);return t=o?d.rhumbBearingTo(a):a.rhumbBearingTo(d),t>180?-(360-t):t};
},{"@turf/invariant":38,"geodesy":114}],76:[function(require,module,exports){
var helpers=require("@turf/helpers"),getCoord=require("@turf/invariant").getCoord,GeodesyLatLon=require("geodesy").LatLonSpherical,point=helpers.point,radiansToDistance=helpers.radiansToDistance,distanceToRadians=helpers.distanceToRadians;module.exports=function(e,r,i,n){if(!e)throw new Error("origin is required");if(void 0===r||null===r)throw new Error("distance is required");if(void 0===i||null===i)throw new Error("bearing is required");if(!(r>=0))throw new Error("distance must be greater than 0");n=n||"kilometers";var o=radiansToDistance(distanceToRadians(r,n),"meters"),t=getCoord(e),a=new GeodesyLatLon(t[1],t[0]),s=a.rhumbDestinationPoint(o,i);return s.lon+=s.lon-t[0]>180?-360:t[0]-s.lon>180?360:0,point([s.lon,s.lat])};
},{"@turf/helpers":33,"@turf/invariant":38,"geodesy":114}],77:[function(require,module,exports){
var helpers=require("@turf/helpers"),getCoord=require("@turf/invariant").getCoord,GeodesyLatLon=require("geodesy").LatLonSpherical,radiansToDistance=helpers.radiansToDistance,distanceToRadians=helpers.distanceToRadians;module.exports=function(e,r,o){if(!e)throw new Error("from point is required");if(!r)throw new Error("to point is required");o=o||"kilometers";var a=getCoord(e),i=getCoord(r),n=new GeodesyLatLon(a[1],a[0]),t=new GeodesyLatLon(i[1],i[0]);t[0]+=t[0]-n[0]>180?-360:n[0]-t[0]>180?360:0;var s=n.rhumbDistanceTo(t);return radiansToDistance(distanceToRadians(s,"meters"),o)};
},{"@turf/helpers":33,"@turf/invariant":38,"geodesy":114}],78:[function(require,module,exports){
function getRandomSubarray(e,r){for(var t,o,a=e.slice(0),n=e.length,u=n-r;n-- >u;)o=Math.floor((n+1)*Math.random()),t=a[o],a[o]=a[n],a[n]=t;return a.slice(u)}var featureCollection=require("@turf/helpers").featureCollection;module.exports=function(e,r){return featureCollection(getRandomSubarray(e.features,r))};
},{"@turf/helpers":33}],79:[function(require,module,exports){
function convertAngleTo360(r){var e=r%360;return e<0&&(e+=360),e}var circle=require("@turf/circle"),coordEach=require("@turf/meta").coordEach,helpers=require("@turf/helpers"),getCoords=require("@turf/invariant").getCoords,polygon=helpers.polygon,lineArc=require("@turf/line-arc");module.exports=function(r,e,o,i,n,u){if(!r)throw new Error("center is required");if(void 0===o||null===o)throw new Error("bearing1 is required");if(void 0===i||null===i)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if(n=n||64,convertAngleTo360(o)===convertAngleTo360(i))return circle(r,e,n,u);var t=getCoords(r),c=lineArc(r,e,o,i,n,u),l=[[t]];return coordEach(c,function(r){l[0].push(r)}),l[0].push(t),polygon(l)};
},{"@turf/circle":18,"@turf/helpers":33,"@turf/invariant":38,"@turf/line-arc":50,"@turf/meta":63}],80:[function(require,module,exports){
function simplifyHelper(e,t,i){return"LineString"===e.geometry.type?{type:"LineString",coordinates:simplifyLine(e.geometry.coordinates,t,i)}:"MultiLineString"===e.geometry.type?{type:"MultiLineString",coordinates:e.geometry.coordinates.map(function(e){return simplifyLine(e,t,i)})}:"Polygon"===e.geometry.type?{type:"Polygon",coordinates:simplifyPolygon(e.geometry.coordinates,t,i)}:"MultiPolygon"===e.geometry.type?{type:"MultiPolygon",coordinates:e.geometry.coordinates.map(function(e){return simplifyPolygon(e,t,i)})}:e}function checkValidity(e){return!(e.length<3)&&(3!==e.length||e[2][0]!==e[0][0]||e[2][1]!==e[0][1])}function simpleFeature(e,t){return{type:"Feature",geometry:e,properties:t}}function simplifyLine(e,t,i){return simplify(e.map(function(e){return{x:e[0],y:e[1],z:e[2]}}),t,i).map(function(e){return e.z?[e.x,e.y,e.z]:[e.x,e.y]})}function simplifyPolygon(e,t,i){return e.map(function(e){var r=e.map(function(e){return{x:e[0],y:e[1]}});if(r.length<4)throw new Error("Invalid polygon");for(var n=simplify(r,t,i).map(function(e){return[e.x,e.y]});!checkValidity(n);)t-=.01*t,n=simplify(r,t,i).map(function(e){return[e.x,e.y]});return n[n.length-1][0]===n[0][0]&&n[n.length-1][1]===n[0][1]||n.push(n[0]),n})}var simplify=require("simplify-js"),supportedTypes=["LineString","MultiLineString","Polygon","MultiPolygon"];module.exports=function(e,t,i){return"Feature"===e.type?simpleFeature(simplifyHelper(e,t,i),e.properties):"FeatureCollection"===e.type?{type:"FeatureCollection",features:e.features.map(function(e){var r=simplifyHelper(e,t,i);return supportedTypes.indexOf(r.type)>-1?simpleFeature(r,e.properties):r})}:"GeometryCollection"===e.type?{type:"GeometryCollection",geometries:e.geometries.map(function(e){return supportedTypes.indexOf(e.type)>-1?simplifyHelper({type:"Feature",geometry:e},t,i):e})}:e};
},{"simplify-js":179}],81:[function(require,module,exports){
var distance=require("@turf/distance"),turfBBox=require("@turf/bbox"),helpers=require("@turf/helpers"),point=helpers.point,polygon=helpers.polygon,featureCollection=helpers.featureCollection;module.exports=function(r,e,o,t){var i=[];if(!r)throw new Error("bbox is required");if(Array.isArray(r)||(r=turfBBox(r)),4!==r.length)throw new Error("bbox must contain 4 numbers");var n=r[0],a=r[1],l=r[2],u=r[3],p=distance(point([n,a]),point([l,a]),o),s=distance(point([n,a]),point([n,u]),o),f=Math.ceil(p/e),c=Math.ceil(s/e),h=e/p,b=h*(l-n);t===!0&&(b*=p/e/f);var v=e/s,d=v*(u-a);t===!0&&(d*=s/e/c);for(var x=n,y=0;y<f;y++){for(var g=a,q=0;q<c;q++){var w=polygon([[[x,g],[x,g+d],[x+b,g+d],[x+b,g],[x,g]]]);i.push(w),g+=d}x+=b}return featureCollection(i)};
},{"@turf/bbox":10,"@turf/distance":26,"@turf/helpers":33}],82:[function(require,module,exports){
var distance=require("@turf/distance");module.exports=function(e){var r=e[0],i=e[1],t=e[2],a=e[3];if(distance(e.slice(0,2),[t,i])>=distance(e.slice(0,2),[r,a])){var n=(i+a)/2;return[r,n-(t-r)/2,t,n+(t-r)/2]}var c=(r+t)/2;return[c-(a-i)/2,i,c+(a-i)/2,a]};
},{"@turf/distance":26}],83:[function(require,module,exports){
var inside=require("@turf/inside");module.exports=function(r,e,i,s){return r=JSON.parse(JSON.stringify(r)),e=JSON.parse(JSON.stringify(e)),r.features.forEach(function(r){r.properties||(r.properties={}),e.features.forEach(function(e){if(void 0===r.properties[s]){inside(r,e)&&(r.properties[s]=e.properties[i])}})}),r};
},{"@turf/inside":36}],84:[function(require,module,exports){
function processPolygon(e){var o=flattenCoords(e),r=earcut(o.vertices,o.holes,2),t=[],n=[];r.forEach(function(e,t){var s=r[t];n.push([o.vertices[2*s],o.vertices[2*s+1]])});for(var s=0;s<n.length;s+=3){var u=n.slice(s,s+3);u.push(n[s]),t.push(polygon([u]))}return t}function flattenCoords(e){for(var o=e[0][0].length,r={vertices:[],holes:[],dimensions:o},t=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var u=0;u<o;u++)r.vertices.push(e[n][s][u]);n>0&&(t+=e[n-1].length,r.holes.push(t))}return r}var polygon=require("@turf/helpers").polygon,earcut=require("earcut");module.exports=function(e){if(!e.geometry||"Polygon"!==e.geometry.type&&"MultiPolygon"!==e.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var o={type:"FeatureCollection",features:[]};return"Polygon"===e.geometry.type?o.features=processPolygon(e.geometry.coordinates):e.geometry.coordinates.forEach(function(e){o.features=o.features.concat(processPolygon(e))}),o};
},{"@turf/helpers":33,"earcut":107}],85:[function(require,module,exports){
function Triangle(e,t,r){this.a=e,this.b=t,this.c=r;var n,o,i=t.x-e.x,l=t.y-e.y,y=r.x-e.x,a=r.y-e.y,s=i*(e.x+t.x)+l*(e.y+t.y),u=y*(e.x+r.x)+a*(e.y+r.y),c=2*(i*(r.y-t.y)-l*(r.x-t.x));this.x=(a*s-l*u)/c,this.y=(i*u-y*s)/c,n=this.x-e.x,o=this.y-e.y,this.r=n*n+o*o}function byX(e,t){return t.x-e.x}function dedup(e){var t,r,n,o,i,l=e.length;e:for(;l;)for(r=e[--l],t=e[--l],n=l;n;)if(i=e[--n],o=e[--n],t===o&&r===i||t===i&&r===o){e.splice(l,2),e.splice(n,2),l-=2;continue e}}function triangulate(e){if(e.length<3)return[];e.sort(byX);for(var t,r,n,o,i,l,y=e.length-1,a=e[y].x,s=e[0].x,u=e[y].y,c=u;y--;)e[y].y<u&&(u=e[y].y),e[y].y>c&&(c=e[y].y);var p,x=s-a,h=c-u,f=x>h?x:h,g=.5*(s+a),b=.5*(c+u),_=[new Triangle({x:g-20*f,y:b-f,__sentinel:!0},{x:g,y:b+20*f,__sentinel:!0},{x:g+20*f,y:b-f,__sentinel:!0})],d=[],m=[];for(y=e.length;y--;){for(m.length=0,p=_.length;p--;)x=e[y].x-_[p].x,x>0&&x*x>_[p].r?(d.push(_[p]),_.splice(p,1)):(h=e[y].y-_[p].y,x*x+h*h>_[p].r||(m.push(_[p].a,_[p].b,_[p].b,_[p].c,_[p].c,_[p].a),_.splice(p,1)));for(dedup(m),p=m.length;p;)r=m[--p],t=m[--p],n=e[y],o=r.x-t.x,i=r.y-t.y,l=2*(o*(n.y-r.y)-i*(n.x-r.x)),Math.abs(l)>1e-12&&_.push(new Triangle(t,r,n))}for(Array.prototype.push.apply(d,_),y=d.length;y--;)(d[y].a.__sentinel||d[y].b.__sentinel||d[y].c.__sentinel)&&d.splice(y,1);return d}var helpers=require("@turf/helpers"),polygon=helpers.polygon,featurecollection=helpers.featureCollection;module.exports=function(e,t){if("FeatureCollection"!==e.type)throw new Error("points must be a FeatureCollection");var r=!1;return featurecollection(triangulate(e.features.map(function(e){var n={x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]};return t?n.z=e.properties[t]:3===e.geometry.coordinates.length&&(r=!0,n.z=e.geometry.coordinates[2]),n})).map(function(e){var t=[e.a.x,e.a.y],n=[e.b.x,e.b.y],o=[e.c.x,e.c.y],i={};return r?(t.push(e.a.z),n.push(e.b.z),o.push(e.c.z)):i={a:e.a.z,b:e.b.z,c:e.c.z},polygon([[t,n,o,t]],i)}))};
},{"@turf/helpers":33}],86:[function(require,module,exports){
var meta=require("@turf/meta"),centroid=require("@turf/centroid"),invariant=require("@turf/invariant"),rhumbBearing=require("@turf/rhumb-bearing"),rhumbDistance=require("@turf/rhumb-distance"),rhumbDestination=require("@turf/rhumb-destination"),coordEach=meta.coordEach,getCoords=invariant.getCoords;module.exports=function(r,e,i,t){if(!r)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("angle is required");return 0===e?r:(i||(i=centroid(r)),t!==!1&&void 0!==t||(r=JSON.parse(JSON.stringify(r))),coordEach(r,function(r){var t=rhumbBearing(i,r),n=t+e,o=rhumbDistance(i,r),u=getCoords(rhumbDestination(i,o,n));r[0]=u[0],r[1]=u[1]}),r)};
},{"@turf/centroid":17,"@turf/invariant":38,"@turf/meta":63,"@turf/rhumb-bearing":75,"@turf/rhumb-destination":76,"@turf/rhumb-distance":77}],87:[function(require,module,exports){
function scale(e,r,t){var o="Point"===e.type||e.geometry&&"Point"===e.geometry.type;return t=defineOrigin(e,t),1===r||o?e:(coordEach(e,function(e){var o=rhumbDistance(t,e),n=rhumbBearing(t,e),a=o*r,i=getCoords(rhumbDestination(t,a,n));e[0]=i[0],e[1]=i[1],3===e.length&&(e[2]*=r)}),e)}function defineOrigin(e,r){if(void 0!==r&&null!==r||(r="centroid"),Array.isArray(r)||"object"==typeof r)return getCoord(r);var t=e.bbox?e.bbox:turfBBox(e),o=t[0],n=t[1],a=t[2],i=t[3];switch(r){case"sw":case"southwest":case"westsouth":case"bottomleft":return point([o,n]);case"se":case"southeast":case"eastsouth":case"bottomright":return point([a,n]);case"nw":case"northwest":case"westnorth":case"topleft":return point([o,i]);case"ne":case"northeast":case"eastnorth":case"topright":return point([a,i]);case"center":return center(e);case void 0:case null:case"centroid":return centroid(e);default:throw new Error("invalid origin")}}var meta=require("@turf/meta"),center=require("@turf/center"),helpers=require("@turf/helpers"),centroid=require("@turf/centroid"),turfBBox=require("@turf/bbox"),invariant=require("@turf/invariant"),rhumbBearing=require("@turf/rhumb-bearing"),rhumbDistance=require("@turf/rhumb-distance"),rhumbDestination=require("@turf/rhumb-destination"),point=helpers.point,coordEach=meta.coordEach,featureEach=meta.featureEach,getCoord=invariant.getCoord,getCoords=invariant.getCoords;module.exports=function(e,r,t,o){if(!e)throw new Error("geojson required");if("number"!=typeof r||0===r)throw new Error("invalid factor");var n=Array.isArray(t)||"object"==typeof t;return o!==!0&&(e=JSON.parse(JSON.stringify(e))),"FeatureCollection"!==e.type||n?scale(e,r,t):(featureEach(e,function(o,n){e.features[n]=scale(o,r,t)}),e)};
},{"@turf/bbox":10,"@turf/center":16,"@turf/centroid":17,"@turf/helpers":33,"@turf/invariant":38,"@turf/meta":63,"@turf/rhumb-bearing":75,"@turf/rhumb-destination":76,"@turf/rhumb-distance":77}],88:[function(require,module,exports){
var meta=require("@turf/meta"),invariant=require("@turf/invariant"),rhumbDestination=require("@turf/rhumb-destination"),coordEach=meta.coordEach,getCoords=invariant.getCoords;module.exports=function(r,i,e,o,n,t){if(!r)throw new Error("geojson is required");if(void 0===i||null===i||isNaN(i))throw new Error("distance is required");if(n&&"number"!=typeof n&&isNaN(n))throw new Error("zTranslation is not a number");if(n=void 0!==n?n:0,0===i&&0===n)return r;if(void 0===e||null===e||isNaN(e))throw new Error("direction is required");return i<0&&(i=-i,e=-e),t!==!1&&void 0!==t||(r=JSON.parse(JSON.stringify(r))),coordEach(r,function(r){var t=getCoords(rhumbDestination(r,i,e,o));r[0]=t[0],r[1]=t[1],n&&3===r.length&&(r[2]+=n)}),r};
},{"@turf/invariant":38,"@turf/meta":63,"@turf/rhumb-destination":76}],89:[function(require,module,exports){
var distance=require("@turf/distance"),helpers=require("@turf/helpers"),polygon=helpers.polygon,featureCollection=helpers.featureCollection;module.exports=function(e,o,r){for(var l=featureCollection([]),n=o/distance([e[0],e[1]],[e[2],e[1]],r),p=n*(e[2]-e[0]),t=o/distance([e[0],e[1]],[e[0],e[3]],r),u=t*(e[3]-e[1]),s=0,a=e[0];a<=e[2];){for(var f=0,g=e[1];g<=e[3];)s%2==0&&f%2==0?l.features.push(polygon([[[a,g],[a,g+u],[a+p,g],[a,g]]]),polygon([[[a,g+u],[a+p,g+u],[a+p,g],[a,g+u]]])):s%2==0&&f%2==1?l.features.push(polygon([[[a,g],[a+p,g+u],[a+p,g],[a,g]]]),polygon([[[a,g],[a,g+u],[a+p,g+u],[a,g]]])):f%2==0&&s%2==1?l.features.push(polygon([[[a,g],[a,g+u],[a+p,g+u],[a,g]]]),polygon([[[a,g],[a+p,g+u],[a+p,g],[a,g]]])):f%2==1&&s%2==1&&l.features.push(polygon([[[a,g],[a,g+u],[a+p,g],[a,g]]]),polygon([[[a,g+u],[a+p,g+u],[a+p,g],[a,g+u]]])),g+=u,f++;s++,a+=p}return l};
},{"@turf/distance":26,"@turf/helpers":33}],90:[function(require,module,exports){
function truncate(r,e,o){r.length>o&&r.splice(o,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}var coordEach=require("@turf/meta").coordEach;module.exports=function(r,e,o,n){if(e=void 0===e||null===e||isNaN(e)?6:e,o=void 0===o||null===o||isNaN(o)?3:o,!r)throw new Error("<geojson> is required");if("number"!=typeof e)throw new Error("<precision> must be a number");if("number"!=typeof o)throw new Error("<coordinates> must be a number");n!==!1&&void 0!==n||(r=JSON.parse(JSON.stringify(r)));var t=Math.pow(10,e);return coordEach(r,function(r){truncate(r,t,o)}),r};
},{"@turf/meta":63}],91:[function(require,module,exports){
var helpers=require("@turf/helpers"),invariant=require("@turf/invariant"),meta=require("@turf/meta"),turf={isolines:require("@turf/isolines"),convex:require("@turf/convex"),within:require("@turf/within"),concave:require("@turf/concave"),difference:require("@turf/difference"),dissolve:require("@turf/dissolve"),collect:require("@turf/collect"),flip:require("@turf/flip"),simplify:require("@turf/simplify"),bezier:require("@turf/bezier"),tag:require("@turf/tag"),sample:require("@turf/sample"),envelope:require("@turf/envelope"),square:require("@turf/square"),circle:require("@turf/circle"),midpoint:require("@turf/midpoint"),buffer:require("@turf/buffer"),center:require("@turf/center"),centerOfMass:require("@turf/center-of-mass"),centroid:require("@turf/centroid"),combine:require("@turf/combine"),distance:require("@turf/distance"),explode:require("@turf/explode"),bbox:require("@turf/bbox"),tesselate:require("@turf/tesselate"),bboxPolygon:require("@turf/bbox-polygon"),inside:require("@turf/inside"),intersect:require("@turf/intersect"),nearest:require("@turf/nearest"),planepoint:require("@turf/planepoint"),random:require("@turf/random"),tin:require("@turf/tin"),union:require("@turf/union"),bearing:require("@turf/bearing"),destination:require("@turf/destination"),kinks:require("@turf/kinks"),pointOnSurface:require("@turf/point-on-surface"),area:require("@turf/area"),along:require("@turf/along"),lineDistance:require("@turf/line-distance"),lineSlice:require("@turf/line-slice"),lineSliceAlong:require("@turf/line-slice-along"),pointOnLine:require("@turf/point-on-line"),pointGrid:require("@turf/point-grid"),squareGrid:require("@turf/square-grid"),triangleGrid:require("@turf/triangle-grid"),hexGrid:require("@turf/hex-grid"),idw:require("@turf/idw"),truncate:require("@turf/truncate"),flatten:require("@turf/flatten"),lineIntersect:require("@turf/line-intersect"),mask:require("@turf/mask"),lineChunk:require("@turf/line-chunk"),unkinkPolygon:require("@turf/unkink-polygon"),greatCircle:require("@turf/great-circle"),lineSegment:require("@turf/line-segment"),lineSplit:require("@turf/line-split"),lineArc:require("@turf/line-arc"),polygonToLineString:require("@turf/polygon-to-linestring"),lineStringToPolygon:require("@turf/linestring-to-polygon"),bboxClip:require("@turf/bbox-clip"),lineOverlap:require("@turf/line-overlap"),sector:require("@turf/sector"),rhumbBearing:require("@turf/rhumb-bearing"),rhumbDistance:require("@turf/rhumb-distance"),rhumbDestination:require("@turf/rhumb-destination"),polygonTangents:require("@turf/polygon-tangents"),rewind:require("@turf/rewind"),isobands:require("@turf/isobands"),transformRotate:require("@turf/transform-rotate"),transformScale:require("@turf/transform-scale"),transformTranslate:require("@turf/transform-translate"),lineOffset:require("@turf/line-offset"),polygonize:require("@turf/polygonize"),point:helpers.point,polygon:helpers.polygon,lineString:helpers.lineString,multiPoint:helpers.multiPoint,multiPolygon:helpers.multiPolygon,multiLineString:helpers.multiLineString,feature:helpers.feature,featureCollection:helpers.featureCollection,geometryCollection:helpers.geometryCollection,radiansToDistance:helpers.radiansToDistance,distanceToRadians:helpers.distanceToRadians,distanceToDegrees:helpers.distanceToDegrees,bearingToAngle:helpers.bearingToAngle,degrees2radians:helpers.degrees2radians,radians2degrees:helpers.radians2degrees,convertDistance:helpers.convertDistance,round:helpers.round,getCoord:invariant.getCoord,getCoords:invariant.getCoords,geojsonType:invariant.geojsonType,featureOf:invariant.featureOf,collectionOf:invariant.collectionOf,containsNumber:invariant.containsNumber,getGeom:invariant.getGeom,getGeomType:invariant.getGeomType,coordEach:meta.coordEach,coordReduce:meta.coordReduce,propEach:meta.propEach,propReduce:meta.propReduce,featureEach:meta.featureEach,featureReduce:meta.featureReduce,coordAll:meta.coordAll,geomEach:meta.geomEach,geomReduce:meta.geomReduce,flattenEach:meta.flattenEach,flattenReduce:meta.flattenReduce};module.exports=turf;
},{"@turf/along":6,"@turf/area":7,"@turf/bbox":10,"@turf/bbox-clip":8,"@turf/bbox-polygon":9,"@turf/bearing":11,"@turf/bezier":12,"@turf/buffer":14,"@turf/center":16,"@turf/center-of-mass":15,"@turf/centroid":17,"@turf/circle":18,"@turf/collect":19,"@turf/combine":20,"@turf/concave":21,"@turf/convex":22,"@turf/destination":23,"@turf/difference":24,"@turf/dissolve":25,"@turf/distance":26,"@turf/envelope":27,"@turf/explode":28,"@turf/flatten":29,"@turf/flip":30,"@turf/great-circle":32,"@turf/helpers":33,"@turf/hex-grid":34,"@turf/idw":35,"@turf/inside":36,"@turf/intersect":37,"@turf/invariant":38,"@turf/isobands":39,"@turf/isolines":48,"@turf/kinks":49,"@turf/line-arc":50,"@turf/line-chunk":51,"@turf/line-distance":52,"@turf/line-intersect":53,"@turf/line-offset":54,"@turf/line-overlap":56,"@turf/line-segment":57,"@turf/line-slice":59,"@turf/line-slice-along":58,"@turf/line-split":60,"@turf/linestring-to-polygon":61,"@turf/mask":62,"@turf/meta":63,"@turf/midpoint":64,"@turf/nearest":65,"@turf/planepoint":66,"@turf/point-grid":67,"@turf/point-on-line":68,"@turf/point-on-surface":69,"@turf/polygon-tangents":70,"@turf/polygon-to-linestring":71,"@turf/polygonize":72,"@turf/random":73,"@turf/rewind":74,"@turf/rhumb-bearing":75,"@turf/rhumb-destination":76,"@turf/rhumb-distance":77,"@turf/sample":78,"@turf/sector":79,"@turf/simplify":80,"@turf/square":82,"@turf/square-grid":81,"@turf/tag":83,"@turf/tesselate":84,"@turf/tin":85,"@turf/transform-rotate":86,"@turf/transform-scale":87,"@turf/transform-translate":88,"@turf/triangle-grid":89,"@turf/truncate":90,"@turf/union":92,"@turf/unkink-polygon":93,"@turf/within":94}],92:[function(require,module,exports){
var jsts=require("jsts");module.exports=function(){for(var e=new jsts.io.GeoJSONReader,r=e.read(JSON.stringify(arguments[0].geometry)),t=1;t<arguments.length;t++)r=r.union(e.read(JSON.stringify(arguments[t].geometry)));return r=(new jsts.io.GeoJSONWriter).write(r),{type:"Feature",geometry:r,properties:arguments[0].properties}};
},{"jsts":140}],93:[function(require,module,exports){
var simplepolygon=require("simplepolygon"),flatten=require("@turf/flatten"),featureEach=require("@turf/meta").featureEach,featureCollection=require("@turf/helpers").featureCollection;module.exports=function(e){var r=featureCollection([]);return featureEach(e,function(e){"MultiPolygon"===e.geometry.type&&(e=flatten(e)),featureEach(e,function(e){var t=simplepolygon(e);featureEach(t,function(t){t.properties=e.properties?e.properties:{},r.features.push(t)})})}),r};
},{"@turf/flatten":29,"@turf/helpers":33,"@turf/meta":63,"simplepolygon":168}],94:[function(require,module,exports){
var inside=require("@turf/inside"),featureCollection=require("@turf/helpers").featureCollection;module.exports=function(e,r){for(var t=featureCollection([]),u=0;u<r.features.length;u++)for(var f=0;f<e.features.length;f++){var a=inside(e.features[f],r.features[u]);a&&t.features.push(e.features[f])}return t};
},{"@turf/helpers":33,"@turf/inside":36}],95:[function(require,module,exports){
"use strict";function linearlyIndependent(r,e){for(var n=new Array(e+1),t=0;t<r.length;++t)n[t]=r[t];for(var t=0;t<=r.length;++t){for(var i=r.length;i<=e;++i){for(var l=new Array(e),o=0;o<e;++o)l[o]=Math.pow(i+1-t,o);n[i]=l}if(orient.apply(void 0,n))return!0}return!1}function affineHull(r){var e=r.length;if(0===e)return[];if(1===e)return[0];for(var n=r[0].length,t=[r[0]],i=[0],l=1;l<e;++l)if(t.push(r[l]),linearlyIndependent(t,n)){if(i.push(l),i.length===n+1)return i}else t.pop();return i}module.exports=affineHull;var orient=require("robust-orientation");
},{"robust-orientation":164}],96:[function(require,module,exports){
"use strict";"use restrict";function countTrailingZeros(r){var n=32;return r&=-r,r&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}var INT_BITS=32;exports.INT_BITS=INT_BITS,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<INT_BITS-1,exports.sign=function(r){return(r>0)-(r<0)},exports.abs=function(r){var n=r>>INT_BITS-1;return(r^n)-n},exports.min=function(r,n){return n^(r^n)&-(r<n)},exports.max=function(r,n){return r^(r^n)&-(r<n)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,r>>>=n,t=(r>255)<<3,r>>>=t,n|=t,t=(r>15)<<2,r>>>=t,n|=t,t=(r>3)<<1,r>>>=t,(n|=t)|r>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return r-=r>>>1&1431655765,16843009*((r=(858993459&r)+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,27030>>>(r&=15)&1};var REVERSE_TABLE=new Array(256);!function(r){for(var n=0;n<256;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(REVERSE_TABLE),exports.reverse=function(r){return REVERSE_TABLE[255&r]<<24|REVERSE_TABLE[r>>>8&255]<<16|REVERSE_TABLE[r>>>16&255]<<8|REVERSE_TABLE[r>>>24&255]},exports.interleave2=function(r,n){return r&=65535,r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),r=1431655765&(r|r<<1),n&=65535,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),r|n<<1},exports.deinterleave2=function(r,n){return r=r>>>n&1431655765,r=858993459&(r|r>>>1),r=252645135&(r|r>>>2),r=16711935&(r|r>>>4),(r=65535&(r|r>>>16))<<16>>16},exports.interleave3=function(r,n,t){return r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),r|=n<<1,t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),r|t<<2},exports.deinterleave3=function(r,n){return r=r>>>n&1227133513,r=3272356035&(r|r>>>2),r=251719695&(r|r>>>4),r=4278190335&(r|r>>>8),(r=1023&(r|r>>>16))<<22>>22},exports.nextCombination=function(r){var n=r|r-1;return n+1|(~n&-~n)-1>>>countTrailingZeros(r)+1};
},{}],97:[function(require,module,exports){
"use strict";function convexHull(e){var l=e.length;if(0===l)return[];if(1===l)return[[0]];var n=e[0].length;return 0===n?[]:1===n?convexHull1d(e):2===n?convexHull2d(e):convexHullnd(e,n)}var convexHull1d=require("./lib/ch1d"),convexHull2d=require("./lib/ch2d"),convexHullnd=require("./lib/chnd");module.exports=convexHull;
},{"./lib/ch1d":98,"./lib/ch2d":99,"./lib/chnd":100}],98:[function(require,module,exports){
"use strict";function convexHull1d(e){for(var l=0,n=0,o=1;o<e.length;++o)e[o][0]<e[l][0]&&(l=o),e[o][0]>e[n][0]&&(n=o);return l<n?[[l],[n]]:l>n?[[n],[l]]:[[l]]}module.exports=convexHull1d;
},{}],99:[function(require,module,exports){
"use strict";function convexHull2D(o){var e=monotoneHull(o),n=e.length;if(n<=2)return[];for(var r=new Array(n),l=e[n-1],u=0;u<n;++u){var t=e[u];r[u]=[l,t],l=t}return r}module.exports=convexHull2D;var monotoneHull=require("monotone-convex-hull-2d");
},{"monotone-convex-hull-2d":150}],100:[function(require,module,exports){
"use strict";function permute(r,e){for(var n=r.length,t=new Array(n),u=0;u<e.length;++u)t[u]=r[e[u]];for(var l=e.length,u=0;u<n;++u)e.indexOf(u)<0&&(t[l++]=r[u]);return t}function invPermute(r,e){for(var n=r.length,t=e.length,u=0;u<n;++u)for(var l=r[u],f=0;f<l.length;++f){var i=l[f];if(i<t)l[f]=e[i];else{i-=t;for(var a=0;a<t;++a)i>=e[a]&&(i+=1);l[f]=i}}return r}function convexHullnD(r,e){try{return ich(r,!0)}catch(l){var n=aff(r);if(n.length<=e)return[];var t=permute(r,n),u=ich(t,!0);return invPermute(u,n)}}module.exports=convexHullnD;var ich=require("incremental-convex-hull"),aff=require("affine-hull");
},{"affine-hull":95,"incremental-convex-hull":139}],101:[function(require,module,exports){
function clamp_css_byte(e){return e=Math.round(e),e<0?0:e>255?255:e}function clamp_css_float(e){return e<0?0:e>1?1:e}function parse_css_int(e){return clamp_css_byte("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function parse_css_float(e){return clamp_css_float("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function css_hue_to_rgb(e,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?e+(r-e)*l*6:2*l<1?r:3*l<2?e+(r-e)*(2/3-l)*6:e}function parseCSSColor(e){var r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0]){if(4===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null}if(7===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null}return null}var a=r.indexOf("("),t=r.indexOf(")");if(a!==-1&&t+1===r.length){var n=r.substr(0,a),s=r.substr(a+1,t-(a+1)).split(","),o=1;switch(n){case"rgba":if(4!==s.length)return null;o=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),o];case"hsla":if(4!==s.length)return null;o=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var i=(parseFloat(s[0])%360+360)%360/360,u=parse_css_float(s[1]),g=parse_css_float(s[2]),d=g<=.5?g*(u+1):g+u-g*u,c=2*g-d;return[clamp_css_byte(255*css_hue_to_rgb(c,d,i+1/3)),clamp_css_byte(255*css_hue_to_rgb(c,d,i)),clamp_css_byte(255*css_hue_to_rgb(c,d,i-1/3)),o];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}
},{}],102:[function(require,module,exports){
!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(n.d3=n.d3||{})}(this,function(n){"use strict";function r(n){return function(r,t){return f(n(r),t)}}function t(n,r){return[n,r]}function e(n,r,t){var e=(r-n)/Math.max(0,t),o=Math.floor(Math.log(e)/Math.LN10),u=e/Math.pow(10,o);return o>=0?(u>=b?10:u>=q?5:u>=L?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=b?10:u>=q?5:u>=L?2:1)}function o(n,r,t){var e=Math.abs(r-n)/Math.max(0,t),o=Math.pow(10,Math.floor(Math.log(e)/Math.LN10)),u=e/o;return u>=b?o*=10:u>=q?o*=5:u>=L&&(o*=2),r<n?-o:o}function u(n){return n.length}var f=function(n,r){return n<r?-1:n>r?1:n>=r?0:NaN},l=function(n){return 1===n.length&&(n=r(n)),{left:function(r,t,e,o){for(null==e&&(e=0),null==o&&(o=r.length);e<o;){var u=e+o>>>1;n(r[u],t)<0?e=u+1:o=u}return e},right:function(r,t,e,o){for(null==e&&(e=0),null==o&&(o=r.length);e<o;){var u=e+o>>>1;n(r[u],t)>0?o=u:e=u+1}return e}}},i=l(f),a=i.right,h=i.left,c=function(n,r){null==r&&(r=t);for(var e=0,o=n.length-1,u=n[0],f=new Array(o<0?0:o);e<o;)f[e]=r(u,u=n[++e]);return f},s=function(n,r,e){var o,u,f,l,i=n.length,a=r.length,h=new Array(i*a);for(null==e&&(e=t),o=f=0;o<i;++o)for(l=n[o],u=0;u<a;++u,++f)h[f]=e(l,r[u]);return h},g=function(n,r){return r<n?-1:r>n?1:r>=n?0:NaN},M=function(n){return null===n?NaN:+n},v=function(n,r){var t,e,o=n.length,u=0,f=-1,l=0,i=0;if(null==r)for(;++f<o;)isNaN(t=M(n[f]))||(e=t-l,l+=e/++u,i+=e*(t-l));else for(;++f<o;)isNaN(t=M(r(n[f],f,n)))||(e=t-l,l+=e/++u,i+=e*(t-l));if(u>1)return i/(u-1)},p=function(n,r){var t=v(n,r);return t?Math.sqrt(t):t},d=function(n,r){var t,e,o,u=n.length,f=-1;if(null==r){for(;++f<u;)if(null!=(t=n[f])&&t>=t)for(e=o=t;++f<u;)null!=(t=n[f])&&(e>t&&(e=t),o<t&&(o=t))}else for(;++f<u;)if(null!=(t=r(n[f],f,n))&&t>=t)for(e=o=t;++f<u;)null!=(t=r(n[f],f,n))&&(e>t&&(e=t),o<t&&(o=t));return[e,o]},y=Array.prototype,N=y.slice,m=y.map,w=function(n){return function(){return n}},A=function(n){return n},x=function(n,r,t){n=+n,r=+r,t=(o=arguments.length)<2?(r=n,n=0,1):o<3?1:+t;for(var e=-1,o=0|Math.max(0,Math.ceil((r-n)/t)),u=new Array(o);++e<o;)u[e]=n+e*t;return u},b=Math.sqrt(50),q=Math.sqrt(10),L=Math.sqrt(2),k=function(n,r,t){var o,u,f,l=r<n,i=-1;if(l&&(o=n,n=r,r=o),0===(f=e(n,r,t))||!isFinite(f))return[];if(f>0)for(n=Math.ceil(n/f),r=Math.floor(r/f),u=new Array(o=Math.ceil(r-n+1));++i<o;)u[i]=(n+i)*f;else for(n=Math.floor(n*f),r=Math.ceil(r*f),u=new Array(o=Math.ceil(n-r+1));++i<o;)u[i]=(n-i)/f;return l&&u.reverse(),u},S=function(n){return Math.ceil(Math.log(n.length)/Math.LN2)+1},j=function(){function n(n){var u,f,l=n.length,i=new Array(l);for(u=0;u<l;++u)i[u]=r(n[u],u,n);var h=t(i),c=h[0],s=h[1],g=e(i,c,s);Array.isArray(g)||(g=o(c,s,g),g=x(Math.ceil(c/g)*g,Math.floor(s/g)*g,g));for(var M=g.length;g[0]<=c;)g.shift(),--M;for(;g[M-1]>s;)g.pop(),--M;var v,p=new Array(M+1);for(u=0;u<=M;++u)v=p[u]=[],v.x0=u>0?g[u-1]:c,v.x1=u<M?g[u]:s;for(u=0;u<l;++u)f=i[u],c<=f&&f<=s&&p[a(g,f,0,M)].push(n[u]);return p}var r=A,t=d,e=S;return n.value=function(t){return arguments.length?(r="function"==typeof t?t:w(t),n):r},n.domain=function(r){return arguments.length?(t="function"==typeof r?r:w([r[0],r[1]]),n):t},n.thresholds=function(r){return arguments.length?(e="function"==typeof r?r:w(Array.isArray(r)?N.call(r):r),n):e},n},F=function(n,r,t){if(null==t&&(t=M),e=n.length){if((r=+r)<=0||e<2)return+t(n[0],0,n);if(r>=1)return+t(n[e-1],e-1,n);var e,o=(e-1)*r,u=Math.floor(o),f=+t(n[u],u,n);return f+(+t(n[u+1],u+1,n)-f)*(o-u)}},_=function(n,r,t){return n=m.call(n,M).sort(f),Math.ceil((t-r)/(2*(F(n,.75)-F(n,.25))*Math.pow(n.length,-1/3)))},z=function(n,r,t){return Math.ceil((t-r)/(3.5*p(n)*Math.pow(n.length,-1/3)))},D=function(n,r){var t,e,o=n.length,u=-1;if(null==r){for(;++u<o;)if(null!=(t=n[u])&&t>=t)for(e=t;++u<o;)null!=(t=n[u])&&t>e&&(e=t)}else for(;++u<o;)if(null!=(t=r(n[u],u,n))&&t>=t)for(e=t;++u<o;)null!=(t=r(n[u],u,n))&&t>e&&(e=t);return e},I=function(n,r){var t,e=n.length,o=e,u=-1,f=0;if(null==r)for(;++u<e;)isNaN(t=M(n[u]))?--o:f+=t;else for(;++u<e;)isNaN(t=M(r(n[u],u,n)))?--o:f+=t;if(o)return f/o},O=function(n,r){var t,e=n.length,o=-1,u=[];if(null==r)for(;++o<e;)isNaN(t=M(n[o]))||u.push(t);else for(;++o<e;)isNaN(t=M(r(n[o],o,n)))||u.push(t);return F(u.sort(f),.5)},P=function(n){for(var r,t,e,o=n.length,u=-1,f=0;++u<o;)f+=n[u].length;for(t=new Array(f);--o>=0;)for(e=n[o],r=e.length;--r>=0;)t[--f]=e[r];return t},R=function(n,r){var t,e,o=n.length,u=-1;if(null==r){for(;++u<o;)if(null!=(t=n[u])&&t>=t)for(e=t;++u<o;)null!=(t=n[u])&&e>t&&(e=t)}else for(;++u<o;)if(null!=(t=r(n[u],u,n))&&t>=t)for(e=t;++u<o;)null!=(t=r(n[u],u,n))&&e>t&&(e=t);return e},B=function(n,r){for(var t=r.length,e=new Array(t);t--;)e[t]=n[r[t]];return e},C=function(n,r){if(t=n.length){var t,e,o=0,u=0,l=n[u];for(null==r&&(r=f);++o<t;)(r(e=n[o],l)<0||0!==r(l,l))&&(l=e,u=o);return 0===r(l,l)?u:void 0}},E=function(n,r,t){for(var e,o,u=(null==t?n.length:t)-(r=null==r?0:+r);u;)o=Math.random()*u--|0,e=n[u+r],n[u+r]=n[o+r],n[o+r]=e;return n},G=function(n,r){var t,e=n.length,o=-1,u=0;if(null==r)for(;++o<e;)(t=+n[o])&&(u+=t);else for(;++o<e;)(t=+r(n[o],o,n))&&(u+=t);return u},H=function(n){if(!(o=n.length))return[];for(var r=-1,t=R(n,u),e=new Array(t);++r<t;)for(var o,f=-1,l=e[r]=new Array(o);++f<o;)l[f]=n[f][r];return e},J=function(){return H(arguments)};n.bisect=a,n.bisectRight=a,n.bisectLeft=h,n.ascending=f,n.bisector=l,n.cross=s,n.descending=g,n.deviation=p,n.extent=d,n.histogram=j,n.thresholdFreedmanDiaconis=_,n.thresholdScott=z,n.thresholdSturges=S,n.max=D,n.mean=I,n.median=O,n.merge=P,n.min=R,n.pairs=c,n.permute=B,n.quantile=F,n.range=x,n.scan=C,n.shuffle=E,n.sum=G,n.ticks=k,n.tickIncrement=e,n.tickStep=o,n.transpose=H,n.variance=v,n.zip=J,Object.defineProperty(n,"__esModule",{value:!0})});
},{}],103:[function(require,module,exports){
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],t):t(n.d3=n.d3||{},n.d3)}(this,function(n,t){"use strict";function r(){this.reset()}function i(n,t,r){var i=n.s=t+r,e=i-t,o=i-e;n.t=t-o+(r-e)}function e(n){return n>1?0:n<-1?Dt:Math.acos(n)}function o(n){return n>1?Ut:n<-1?-Ut:Math.asin(n)}function u(n){return(n=rr(n/2))*n}function c(){}function a(n,t){n&&cr.hasOwnProperty(n.type)&&cr[n.type](n,t)}function l(n,t,r){var i,e=-1,o=n.length-r;for(t.lineStart();++e<o;)i=n[e],t.point(i[0],i[1],i[2]);t.lineEnd()}function f(n,t){var r=-1,i=n.length;for(t.polygonStart();++r<i;)l(n[r],t,1);t.polygonEnd()}function s(){sr.point=h}function p(){g(lt,ft)}function h(n,t){sr.point=g,lt=n,ft=t,n*=Ht,t*=Ht,st=n,pt=Vt(t=t/2+Xt),ht=rr(t)}function g(n,t){n*=Ht,t*=Ht,t=t/2+Xt;var r=n-st,i=r>=0?1:-1,e=i*r,o=Vt(t),u=rr(t),c=ht*u,a=pt*o+c*Vt(e),l=c*i*rr(e);lr.add(Qt(l,a)),st=n,pt=o,ht=u}function v(n){return[Qt(n[1],n[0]),o(n[2])]}function d(n){var t=n[0],r=n[1],i=Vt(r);return[i*Vt(t),i*rr(t),rr(r)]}function E(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function y(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function S(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function m(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function M(n){var t=er(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function x(n,t){xt.push(_t=[gt=n,dt=n]),t<vt&&(vt=t),t>Et&&(Et=t)}function _(n,t){var r=d([n*Ht,t*Ht]);if(Mt){var i=y(Mt,r),e=[i[1],-i[0],0],o=y(e,i);M(o),o=v(o);var u,c=n-yt,a=c>0?1:-1,l=o[0]*Zt*a,f=Jt(c)>180;f^(a*yt<l&&l<a*n)?(u=o[1]*Zt)>Et&&(Et=u):(l=(l+360)%360-180,f^(a*yt<l&&l<a*n)?(u=-o[1]*Zt)<vt&&(vt=u):(t<vt&&(vt=t),t>Et&&(Et=t))),f?n<yt?C(gt,n)>C(gt,dt)&&(dt=n):C(n,dt)>C(gt,dt)&&(gt=n):dt>=gt?(n<gt&&(gt=n),n>dt&&(dt=n)):n>yt?C(gt,n)>C(gt,dt)&&(dt=n):C(n,dt)>C(gt,dt)&&(gt=n)}else xt.push(_t=[gt=n,dt=n]);t<vt&&(vt=t),t>Et&&(Et=t),Mt=r,yt=n}function N(){gr.point=_}function w(){_t[0]=gt,_t[1]=dt,gr.point=x,Mt=null}function P(n,t){if(Mt){var r=n-yt;hr.add(Jt(r)>180?r+(r>0?360:-360):r)}else St=n,mt=t;sr.point(n,t),_(n,t)}function R(){sr.lineStart()}function A(){P(St,mt),sr.lineEnd(),Jt(hr)>Bt&&(gt=-(dt=180)),_t[0]=gt,_t[1]=dt,Mt=null}function C(n,t){return(t-=n)<0?t+360:t}function j(n,t){return n[0]-t[0]}function q(n,t){return n[0]<=n[1]?n[0]<=t&&t<=n[1]:t<n[0]||n[1]<t}function z(n,t){n*=Ht,t*=Ht;var r=Vt(t);b(r*Vt(n),r*rr(n),rr(t))}function b(n,t,r){++Nt,Pt+=(n-Pt)/Nt,Rt+=(t-Rt)/Nt,At+=(r-At)/Nt}function L(){dr.point=O}function O(n,t){n*=Ht,t*=Ht;var r=Vt(t);Tt=r*Vt(n),kt=r*rr(n),Ft=rr(t),dr.point=G,b(Tt,kt,Ft)}function G(n,t){n*=Ht,t*=Ht;var r=Vt(t),i=r*Vt(n),e=r*rr(n),o=rr(t),u=Qt(er((u=kt*o-Ft*e)*u+(u=Ft*i-Tt*o)*u+(u=Tt*e-kt*i)*u),Tt*i+kt*e+Ft*o);wt+=u,Ct+=u*(Tt+(Tt=i)),jt+=u*(kt+(kt=e)),qt+=u*(Ft+(Ft=o)),b(Tt,kt,Ft)}function T(){dr.point=z}function k(){dr.point=I}function F(){B(Ot,Gt),dr.point=z}function I(n,t){Ot=n,Gt=t,n*=Ht,t*=Ht,dr.point=B;var r=Vt(t);Tt=r*Vt(n),kt=r*rr(n),Ft=rr(t),b(Tt,kt,Ft)}function B(n,t){n*=Ht,t*=Ht;var r=Vt(t),i=r*Vt(n),e=r*rr(n),u=rr(t),c=kt*u-Ft*e,a=Ft*i-Tt*u,l=Tt*e-kt*i,f=er(c*c+a*a+l*l),s=o(f),p=f&&-s/f;zt+=p*c,bt+=p*a,Lt+=p*l,wt+=s,Ct+=s*(Tt+(Tt=i)),jt+=s*(kt+(kt=e)),qt+=s*(Ft+(Ft=u)),b(Tt,kt,Ft)}function D(n,t){return[n>Dt?n-Yt:n<-Dt?n+Yt:n,t]}function U(n,t,r){return(n%=Yt)?t||r?Sr(Y(n),Z(t,r)):Y(n):t||r?Z(t,r):D}function X(n){return function(t,r){return t+=n,[t>Dt?t-Yt:t<-Dt?t+Yt:t,r]}}function Y(n){var t=X(n);return t.invert=X(-n),t}function Z(n,t){function r(n,t){var r=Vt(t),a=Vt(n)*r,l=rr(n)*r,f=rr(t),s=f*i+a*e;return[Qt(l*u-s*c,a*i-f*e),o(s*u+l*c)]}var i=Vt(n),e=rr(n),u=Vt(t),c=rr(t);return r.invert=function(n,t){var r=Vt(t),a=Vt(n)*r,l=rr(n)*r,f=rr(t),s=f*u-l*c;return[Qt(l*u+f*c,a*i+s*e),o(s*i-a*e)]},r}function H(n,t,r,i,e,o){if(r){var u=Vt(t),c=rr(t),a=i*r;null==e?(e=t+i*Yt,o=t-a/2):(e=J(u,e),o=J(u,o),(i>0?e<o:e>o)&&(e+=i*Yt));for(var l,f=e;i>0?f>o:f<o;f-=a)l=v([u,-c*Vt(f),-c*rr(f)]),n.point(l[0],l[1])}}function J(n,t){t=d(t),t[0]-=n,M(t);var r=e(-t[1]);return((-t[2]<0?-r:r)+Yt-Bt)%Yt}function K(n,t,r,i){this.x=n,this.z=t,this.o=r,this.e=i,this.v=!1,this.n=this.p=null}function Q(n){if(t=n.length){for(var t,r,i=0,e=n[0];++i<t;)e.n=r=n[i],r.p=e,e=r;e.n=r=n[0],r.p=e}}function V(n,r,i,e){function o(t,o){return n<=t&&t<=i&&r<=o&&o<=e}function u(t,o,u,a){var f=0,s=0;if(null==t||(f=c(t,u))!==(s=c(o,u))||l(t,o)<0^u>0)do{a.point(0===f||3===f?n:i,f>1?e:r)}while((f=(f+u+4)%4)!==s);else a.point(o[0],o[1])}function c(t,e){return Jt(t[0]-n)<Bt?e>0?0:3:Jt(t[0]-i)<Bt?e>0?2:1:Jt(t[1]-r)<Bt?e>0?1:0:e>0?3:2}function a(n,t){return l(n.x,t.x)}function l(n,t){var r=c(n,1),i=c(t,1);return r!==i?r-i:0===r?t[1]-n[1]:1===r?n[0]-t[0]:2===r?n[1]-t[1]:t[0]-n[0]}return function(c){function l(n,t){o(n,t)&&R.point(n,t)}function f(){for(var t=0,r=0,i=E.length;r<i;++r)for(var o,u,c=E[r],a=1,l=c.length,f=c[0],s=f[0],p=f[1];a<l;++a)o=s,u=p,f=c[a],s=f[0],p=f[1],u<=e?p>e&&(s-o)*(e-u)>(p-u)*(n-o)&&++t:p<=e&&(s-o)*(e-u)<(p-u)*(n-o)&&--t;return t}function s(){R=A,d=[],E=[],P=!0}function p(){var n=f(),r=P&&n,i=(d=t.merge(d)).length;(r||i)&&(c.polygonStart(),r&&(c.lineStart(),u(null,null,1,c),c.lineEnd()),i&&Gr(d,a,n,u,c),c.polygonEnd()),R=c,d=E=y=null}function h(){C.point=v,E&&E.push(y=[]),w=!0,N=!1,x=_=NaN}function g(){d&&(v(S,m),M&&N&&A.rejoin(),d.push(A.result())),C.point=l,N&&R.lineEnd()}function v(t,u){var c=o(t,u);if(E&&y.push([t,u]),w)S=t,m=u,M=c,w=!1,c&&(R.lineStart(),R.point(t,u));else if(c&&N)R.point(t,u);else{var a=[x=Math.max(kr,Math.min(Tr,x)),_=Math.max(kr,Math.min(Tr,_))],l=[t=Math.max(kr,Math.min(Tr,t)),u=Math.max(kr,Math.min(Tr,u))];Lr(a,l,n,r,i,e)?(N||(R.lineStart(),R.point(a[0],a[1])),R.point(l[0],l[1]),c||R.lineEnd(),P=!1):c&&(R.lineStart(),R.point(t,u),P=!1)}x=t,_=u,N=c}var d,E,y,S,m,M,x,_,N,w,P,R=c,A=br(),C={point:l,lineStart:h,lineEnd:g,polygonStart:s,polygonEnd:p};return C}}function W(){Ur.point=nn,Ur.lineEnd=$}function $(){Ur.point=Ur.lineEnd=c}function nn(n,t){n*=Ht,t*=Ht,mr=n,Mr=rr(t),xr=Vt(t),Ur.point=tn}function tn(n,t){n*=Ht,t*=Ht;var r=rr(t),i=Vt(t),e=Jt(n-mr),o=Vt(e),u=rr(e),c=i*u,a=xr*r-Mr*i*o,l=Mr*r+xr*i*o;Dr.add(Qt(er(c*c+a*a),l)),mr=n,Mr=r,xr=i}function rn(n,t){return!(!n||!Kr.hasOwnProperty(n.type))&&Kr[n.type](n,t)}function en(n,t){return 0===Hr(n,t)}function on(n,t){var r=Hr(n[0],n[1]);return Hr(n[0],t)+Hr(t,n[1])<=r+Bt}function un(n,t){return!!Br(n.map(cn),an(t))}function cn(n){return n=n.map(an),n.pop(),n}function an(n){return[n[0]*Ht,n[1]*Ht]}function ln(n,r,i){var e=t.range(n,r-Bt,i).concat(r);return function(n){return e.map(function(t){return[n,t]})}}function fn(n,r,i){var e=t.range(n,r-Bt,i).concat(r);return function(n){return e.map(function(t){return[t,n]})}}function sn(){function n(){return{type:"MultiLineString",coordinates:r()}}function r(){return t.range(Wt(u/E)*E,o,E).map(h).concat(t.range(Wt(f/y)*y,l,y).map(g)).concat(t.range(Wt(e/v)*v,i,v).filter(function(n){return Jt(n%E)>Bt}).map(s)).concat(t.range(Wt(a/d)*d,c,d).filter(function(n){return Jt(n%y)>Bt}).map(p))}var i,e,o,u,c,a,l,f,s,p,h,g,v=10,d=v,E=90,y=360,S=2.5;return n.lines=function(){return r().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(u).concat(g(l).slice(1),h(o).reverse().slice(1),g(f).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.extentMajor(t).extentMinor(t):n.extentMinor()},n.extentMajor=function(t){return arguments.length?(u=+t[0][0],o=+t[1][0],f=+t[0][1],l=+t[1][1],u>o&&(t=u,u=o,o=t),f>l&&(t=f,f=l,l=t),n.precision(S)):[[u,f],[o,l]]},n.extentMinor=function(t){return arguments.length?(e=+t[0][0],i=+t[1][0],a=+t[0][1],c=+t[1][1],e>i&&(t=e,e=i,i=t),a>c&&(t=a,a=c,c=t),n.precision(S)):[[e,a],[i,c]]},n.step=function(t){return arguments.length?n.stepMajor(t).stepMinor(t):n.stepMinor()},n.stepMajor=function(t){return arguments.length?(E=+t[0],y=+t[1],n):[E,y]},n.stepMinor=function(t){return arguments.length?(v=+t[0],d=+t[1],n):[v,d]},n.precision=function(t){return arguments.length?(S=+t,s=ln(a,c,90),p=fn(e,i,S),h=ln(f,l,90),g=fn(u,o,S),n):S},n.extentMajor([[-180,-90+Bt],[180,90-Bt]]).extentMinor([[-180,-80-Bt],[180,80+Bt]])}function pn(){return sn()()}function hn(){ti.point=gn}function gn(n,t){ti.point=vn,_r=wr=n,Nr=Pr=t}function vn(n,t){ni.add(Pr*n-wr*t),wr=n,Pr=t}function dn(){vn(_r,Nr)}function En(n,t){n<ri&&(ri=n),n>ei&&(ei=n),t<ii&&(ii=t),t>oi&&(oi=t)}function yn(n,t){ci+=n,ai+=t,++li}function Sn(){di.point=mn}function mn(n,t){di.point=Mn,yn(Cr=n,jr=t)}function Mn(n,t){var r=n-Cr,i=t-jr,e=er(r*r+i*i);fi+=e*(Cr+n)/2,si+=e*(jr+t)/2,pi+=e,yn(Cr=n,jr=t)}function xn(){di.point=yn}function _n(){di.point=wn}function Nn(){Pn(Rr,Ar)}function wn(n,t){di.point=Pn,yn(Rr=Cr=n,Ar=jr=t)}function Pn(n,t){var r=n-Cr,i=t-jr,e=er(r*r+i*i);fi+=e*(Cr+n)/2,si+=e*(jr+t)/2,pi+=e,e=jr*n-Cr*t,hi+=e*(Cr+n),gi+=e*(jr+t),vi+=3*e,yn(Cr=n,jr=t)}function Rn(n){this._context=n}function An(n,t){_i.point=Cn,yi=mi=n,Si=Mi=t}function Cn(n,t){mi-=n,Mi-=t,xi.add(er(mi*mi+Mi*Mi)),mi=n,Mi=t}function jn(){this._string=[]}function qn(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function zn(n){return n.length>1}function bn(n,t){return((n=n.x)[0]<0?n[1]-Ut-Bt:Ut-n[1])-((t=t.x)[0]<0?t[1]-Ut-Bt:Ut-t[1])}function Ln(n){var t,r=NaN,i=NaN,e=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(o,u){var c=o>0?Dt:-Dt,a=Jt(o-r);Jt(a-Dt)<Bt?(n.point(r,i=(i+u)/2>0?Ut:-Ut),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),n.point(o,i),t=0):e!==c&&a>=Dt&&(Jt(r-e)<Bt&&(r-=e*Bt),Jt(o-c)<Bt&&(o-=c*Bt),i=On(r,i,o,u),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),t=0),n.point(r=o,i=u),e=c},lineEnd:function(){n.lineEnd(),r=i=NaN},clean:function(){return 2-t}}}function On(n,t,r,i){var e,o,u=rr(n-r);return Jt(u)>Bt?Kt((rr(t)*(o=Vt(i))*rr(r)-rr(i)*(e=Vt(t))*rr(n))/(e*o*u)):(t+i)/2}function Gn(n,t,r,i){var e;if(null==n)e=r*Ut,i.point(-Dt,e),i.point(0,e),i.point(Dt,e),i.point(Dt,0),i.point(Dt,-e),i.point(0,-e),i.point(-Dt,-e),i.point(-Dt,0),i.point(-Dt,e);else if(Jt(n[0]-t[0])>Bt){var o=n[0]<t[0]?Dt:-Dt;e=r*o/2,i.point(-o,e),i.point(0,e),i.point(o,e)}else i.point(t[0],t[1])}function Tn(n){return function(t){var r=new kn;for(var i in n)r[i]=n[i];return r.stream=t,r}}function kn(){}function Fn(n,t,r){var i=t[1][0]-t[0][0],e=t[1][1]-t[0][1],o=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),null!=o&&n.clipExtent(null),ar(r,n.stream(ui));var u=ui.result(),c=Math.min(i/(u[1][0]-u[0][0]),e/(u[1][1]-u[0][1])),a=+t[0][0]+(i-c*(u[1][0]+u[0][0]))/2,l=+t[0][1]+(e-c*(u[1][1]+u[0][1]))/2;return null!=o&&n.clipExtent(o),n.scale(150*c).translate([a,l])}function In(n,t,r){return Fn(n,[[0,0],t],r)}function Bn(n){return Tn({point:function(t,r){t=n(t,r),this.stream.point(t[0],t[1])}})}function Dn(n,t){function r(i,e,u,c,a,l,f,s,p,h,g,v,d,E){var y=f-i,S=s-e,m=y*y+S*S;if(m>4*t&&d--){var M=c+h,x=a+g,_=l+v,N=er(M*M+x*x+_*_),w=o(_/=N),P=Jt(Jt(_)-1)<Bt||Jt(u-p)<Bt?(u+p)/2:Qt(x,M),R=n(P,w),A=R[0],C=R[1],j=A-i,q=C-e,z=S*j-y*q;(z*z/m>t||Jt((y*j+S*q)/m-.5)>.3||c*h+a*g+l*v<ji)&&(r(i,e,u,c,a,l,A,C,P,M/=N,x/=N,_,d,E),E.point(A,C),r(A,C,P,M,x,_,f,s,p,h,g,v,d,E))}}return function(t){function i(r,i){r=n(r,i),t.point(r[0],r[1])}function e(){y=NaN,_.point=o,t.lineStart()}function o(i,e){var o=d([i,e]),u=n(i,e);r(y,S,E,m,M,x,y=u[0],S=u[1],E=i,m=o[0],M=o[1],x=o[2],Ci,t),t.point(y,S)}function u(){_.point=i,t.lineEnd()}function c(){e(),_.point=a,_.lineEnd=l}function a(n,t){o(f=n,t),s=y,p=S,h=m,g=M,v=x,_.point=o}function l(){r(y,S,E,m,M,x,s,p,f,h,g,v,Ci,t),_.lineEnd=u,u()}var f,s,p,h,g,v,E,y,S,m,M,x,_={point:i,lineStart:e,lineEnd:u,polygonStart:function(){t.polygonStart(),_.lineStart=c},polygonEnd:function(){t.polygonEnd(),_.lineStart=e}};return _}}function Un(n){return Xn(function(){return n})()}function Xn(n){function t(n){return n=f(n[0]*Ht,n[1]*Ht),[n[0]*d+c,a-n[1]*d]}function r(n){return(n=f.invert((n[0]-c)/d,(a-n[1])/d))&&[n[0]*Zt,n[1]*Zt]}function i(n,t){return n=u(n,t),[n[0]*d+c,a-n[1]*d]}function e(){f=Sr(l=U(M,x,_),u);var n=u(S,m);return c=E-n[0]*d,a=y+n[1]*d,o()}function o(){return g=v=null,t}var u,c,a,l,f,s,p,h,g,v,d=150,E=480,y=250,S=0,m=0,M=0,x=0,_=0,N=null,w=Pi,P=null,R=Wr,A=.5,C=qi(i,A);return t.stream=function(n){return g&&v===n?g:g=zi(w(l,C(R(v=n))))},t.clipAngle=function(n){return arguments.length?(w=+n?Ri(N=n*Ht,6*Ht):(N=null,Pi),o()):N*Zt},t.clipExtent=function(n){return arguments.length?(R=null==n?(P=s=p=h=null,Wr):V(P=+n[0][0],s=+n[0][1],p=+n[1][0],h=+n[1][1]),o()):null==P?null:[[P,s],[p,h]]},t.scale=function(n){return arguments.length?(d=+n,e()):d},t.translate=function(n){return arguments.length?(E=+n[0],y=+n[1],e()):[E,y]},t.center=function(n){return arguments.length?(S=n[0]%360*Ht,m=n[1]%360*Ht,e()):[S*Zt,m*Zt]},t.rotate=function(n){return arguments.length?(M=n[0]%360*Ht,x=n[1]%360*Ht,_=n.length>2?n[2]%360*Ht:0,e()):[M*Zt,x*Zt,_*Zt]},t.precision=function(n){return arguments.length?(C=qi(i,A=n*n),o()):er(A)},t.fitExtent=function(n,r){return Fn(t,n,r)},t.fitSize=function(n,r){return In(t,n,r)},function(){return u=n.apply(this,arguments),t.invert=u.invert&&r,e()}}function Yn(n){var t=0,r=Dt/3,i=Xn(n),e=i(t,r);return e.parallels=function(n){return arguments.length?i(t=n[0]*Ht,r=n[1]*Ht):[t*Zt,r*Zt]},e}function Zn(n){function t(n,t){return[n*r,rr(t)/r]}var r=Vt(n);return t.invert=function(n,t){return[n/r,o(t*r)]},t}function Hn(n,t){function r(n,t){var r=er(u-2*e*rr(t))/e;return[r*rr(n*=e),c-r*Vt(n)]}var i=rr(n),e=(i+rr(t))/2;if(Jt(e)<Bt)return Zn(n);var u=1+i*(2*e-i),c=er(u)/e;return r.invert=function(n,t){var r=c-t;return[Qt(n,Jt(r))/e*ir(r),o((u-(n*n+r*r)*e*e)/(2*e))]},r}function Jn(n){var t=n.length;return{point:function(r,i){for(var e=-1;++e<t;)n[e].point(r,i)},sphere:function(){for(var r=-1;++r<t;)n[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)n[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)n[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)n[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)n[r].polygonEnd()}}}function Kn(n){return function(t,r){var i=Vt(t),e=Vt(r),o=n(i*e);return[o*e*rr(t),o*rr(r)]}}function Qn(n){return function(t,r){var i=er(t*t+r*r),e=n(i),u=rr(e),c=Vt(e);return[Qt(t*u,i*c),o(i&&r*u/i)]}}function Vn(n,t){return[n,nr(or((Ut+t)/2))]}function Wn(n){function t(){var t=Dt*c(),u=o(qr(o.rotate()).invert([0,0]));return l(null==f?[[u[0]-t,u[1]-t],[u[0]+t,u[1]+t]]:n===Vn?[[Math.max(u[0]-t,f),r],[Math.min(u[0]+t,i),e]]:[[f,Math.max(u[1]-t,r)],[i,Math.min(u[1]+t,e)]])}var r,i,e,o=Un(n),u=o.center,c=o.scale,a=o.translate,l=o.clipExtent,f=null;return o.scale=function(n){return arguments.length?(c(n),t()):c()},o.translate=function(n){return arguments.length?(a(n),t()):a()},o.center=function(n){return arguments.length?(u(n),t()):u()},o.clipExtent=function(n){return arguments.length?(null==n?f=r=i=e=null:(f=+n[0][0],r=+n[0][1],i=+n[1][0],e=+n[1][1]),t()):null==f?null:[[f,r],[i,e]]},t()}function $n(n){return or((Ut+n)/2)}function nt(n,t){function r(n,t){o>0?t<-Ut+Bt&&(t=-Ut+Bt):t>Ut-Bt&&(t=Ut-Bt);var r=o/tr($n(t),e);return[r*rr(e*n),o-r*Vt(e*n)]}var i=Vt(n),e=n===t?rr(n):nr(i/Vt(t))/nr($n(t)/$n(n)),o=i*tr($n(n),e)/e;return e?(r.invert=function(n,t){var r=o-t,i=ir(e)*er(n*n+r*r);return[Qt(n,Jt(r))/e*ir(r),2*Kt(tr(o/i,1/e))-Ut]},r):Vn}function tt(n,t){return[n,t]}function rt(n,t){function r(n,t){var r=o-t,i=e*n;return[r*rr(i),o-r*Vt(i)]}var i=Vt(n),e=n===t?rr(n):(i-Vt(t))/(t-n),o=i/e+n;return Jt(e)<Bt?tt:(r.invert=function(n,t){var r=o-t;return[Qt(n,Jt(r))/e*ir(r),o-ir(e)*er(n*n+r*r)]},r)}function it(n,t){var r=Vt(t),i=Vt(n)*r;return[r*rr(n)/i,rr(t)/i]}function et(n,t,r,i){return 1===n&&1===t&&0===r&&0===i?Wr:Tn({point:function(e,o){this.stream.point(e*n+r,o*t+i)}})}function ot(n,t){return[Vt(t)*rr(n),rr(t)]}function ut(n,t){var r=Vt(t),i=1+Vt(n)*r;return[r*rr(n)/i,rr(t)/i]}function ct(n,t){return[nr(or((Ut+t)/2)),-n]}var at=function(){return new r};r.prototype={constructor:r,reset:function(){this.s=this.t=0},add:function(n){i(It,n,this.t),i(this,It.s,this.s),this.s?this.t+=It.t:this.s=It.t},valueOf:function(){return this.s}};var lt,ft,st,pt,ht,gt,vt,dt,Et,yt,St,mt,Mt,xt,_t,Nt,wt,Pt,Rt,At,Ct,jt,qt,zt,bt,Lt,Ot,Gt,Tt,kt,Ft,It=new r,Bt=1e-6,Dt=Math.PI,Ut=Dt/2,Xt=Dt/4,Yt=2*Dt,Zt=180/Dt,Ht=Dt/180,Jt=Math.abs,Kt=Math.atan,Qt=Math.atan2,Vt=Math.cos,Wt=Math.ceil,$t=Math.exp,nr=Math.log,tr=Math.pow,rr=Math.sin,ir=Math.sign||function(n){return n>0?1:n<0?-1:0},er=Math.sqrt,or=Math.tan,ur={Feature:function(n,t){a(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,i=-1,e=r.length;++i<e;)a(r[i].geometry,t)}},cr={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)n=r[i],t.point(n[0],n[1],n[2])},LineString:function(n,t){l(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)l(r[i],t,0)},Polygon:function(n,t){f(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)f(r[i],t)},GeometryCollection:function(n,t){for(var r=n.geometries,i=-1,e=r.length;++i<e;)a(r[i],t)}},ar=function(n,t){n&&ur.hasOwnProperty(n.type)?ur[n.type](n,t):a(n,t)},lr=at(),fr=at(),sr={point:c,lineStart:c,lineEnd:c,polygonStart:function(){lr.reset(),sr.lineStart=s,sr.lineEnd=p},polygonEnd:function(){var n=+lr;fr.add(n<0?Yt+n:n),this.lineStart=this.lineEnd=this.point=c},sphere:function(){fr.add(Yt)}},pr=function(n){return fr.reset(),ar(n,sr),2*fr},hr=at(),gr={point:x,lineStart:N,lineEnd:w,polygonStart:function(){gr.point=P,gr.lineStart=R,gr.lineEnd=A,hr.reset(),sr.polygonStart()},polygonEnd:function(){sr.polygonEnd(),gr.point=x,gr.lineStart=N,gr.lineEnd=w,lr<0?(gt=-(dt=180),vt=-(Et=90)):hr>Bt?Et=90:hr<-Bt&&(vt=-90),_t[0]=gt,_t[1]=dt}},vr=function(n){var t,r,i,e,o,u,c;if(Et=dt=-(gt=vt=1/0),xt=[],ar(n,gr),r=xt.length){for(xt.sort(j),t=1,i=xt[0],o=[i];t<r;++t)e=xt[t],q(i,e[0])||q(i,e[1])?(C(i[0],e[1])>C(i[0],i[1])&&(i[1]=e[1]),C(e[0],i[1])>C(i[0],i[1])&&(i[0]=e[0])):o.push(i=e);for(u=-(1/0),r=o.length-1,t=0,i=o[r];t<=r;i=e,++t)e=o[t],(c=C(i[1],e[0]))>u&&(u=c,gt=e[0],dt=i[1])}return xt=_t=null,gt===1/0||vt===1/0?[[NaN,NaN],[NaN,NaN]]:[[gt,vt],[dt,Et]]},dr={sphere:c,point:z,lineStart:L,lineEnd:T,polygonStart:function(){dr.lineStart=k,dr.lineEnd=F},polygonEnd:function(){dr.lineStart=L,dr.lineEnd=T}},Er=function(n){Nt=wt=Pt=Rt=At=Ct=jt=qt=zt=bt=Lt=0,ar(n,dr);var t=zt,r=bt,i=Lt,e=t*t+r*r+i*i;return e<1e-12&&(t=Ct,r=jt,i=qt,wt<Bt&&(t=Pt,r=Rt,i=At),(e=t*t+r*r+i*i)<1e-12)?[NaN,NaN]:[Qt(r,t)*Zt,o(i/er(e))*Zt]},yr=function(n){return function(){return n}},Sr=function(n,t){function r(r,i){return r=n(r,i),t(r[0],r[1])}return n.invert&&t.invert&&(r.invert=function(r,i){return(r=t.invert(r,i))&&n.invert(r[0],r[1])}),r};D.invert=D;var mr,Mr,xr,_r,Nr,wr,Pr,Rr,Ar,Cr,jr,qr=function(n){function t(t){return t=n(t[0]*Ht,t[1]*Ht),t[0]*=Zt,t[1]*=Zt,t}return n=U(n[0]*Ht,n[1]*Ht,n.length>2?n[2]*Ht:0),t.invert=function(t){return t=n.invert(t[0]*Ht,t[1]*Ht),t[0]*=Zt,t[1]*=Zt,t},t},zr=function(){function n(n,t){r.push(n=i(n,t)),n[0]*=Zt,n[1]*=Zt}function t(){var n=e.apply(this,arguments),t=o.apply(this,arguments)*Ht,a=u.apply(this,arguments)*Ht;return r=[],i=U(-n[0]*Ht,-n[1]*Ht,0).invert,H(c,t,a,1),n={type:"Polygon",coordinates:[r]},r=i=null,n}var r,i,e=yr([0,0]),o=yr(90),u=yr(6),c={point:n};return t.center=function(n){return arguments.length?(e="function"==typeof n?n:yr([+n[0],+n[1]]),t):e},t.radius=function(n){return arguments.length?(o="function"==typeof n?n:yr(+n),t):o},t.precision=function(n){return arguments.length?(u="function"==typeof n?n:yr(+n),t):u},t},br=function(){var n,t=[];return{point:function(t,r){n.push([t,r])},lineStart:function(){t.push(n=[])},lineEnd:c,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],n=null,r}}},Lr=function(n,t,r,i,e,o){var u,c=n[0],a=n[1],l=t[0],f=t[1],s=0,p=1,h=l-c,g=f-a;if(u=r-c,h||!(u>0)){if(u/=h,h<0){if(u<s)return;u<p&&(p=u)}else if(h>0){if(u>p)return;u>s&&(s=u)}if(u=e-c,h||!(u<0)){if(u/=h,h<0){if(u>p)return;u>s&&(s=u)}else if(h>0){if(u<s)return;u<p&&(p=u)}if(u=i-a,g||!(u>0)){if(u/=g,g<0){if(u<s)return;u<p&&(p=u)}else if(g>0){if(u>p)return;u>s&&(s=u)}if(u=o-a,g||!(u<0)){if(u/=g,g<0){if(u>p)return;u>s&&(s=u)}else if(g>0){if(u<s)return;u<p&&(p=u)}return s>0&&(n[0]=c+s*h,n[1]=a+s*g),p<1&&(t[0]=c+p*h,t[1]=a+p*g),!0}}}}},Or=function(n,t){return Jt(n[0]-t[0])<Bt&&Jt(n[1]-t[1])<Bt},Gr=function(n,t,r,i,e){var o,u,c=[],a=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,r,i=n[0],u=n[t];if(Or(i,u)){for(e.lineStart(),o=0;o<t;++o)e.point((i=n[o])[0],i[1]);return void e.lineEnd()}c.push(r=new K(i,n,null,!0)),a.push(r.o=new K(i,null,r,!1)),c.push(r=new K(u,n,null,!1)),a.push(r.o=new K(u,null,r,!0))}}),c.length){for(a.sort(t),Q(c),Q(a),o=0,u=a.length;o<u;++o)a[o].e=r=!r;for(var l,f,s=c[0];;){for(var p=s,h=!0;p.v;)if((p=p.n)===s)return;l=p.z,e.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(o=0,u=l.length;o<u;++o)e.point((f=l[o])[0],f[1]);else i(p.x,p.n.x,1,e);p=p.n}else{if(h)for(l=p.p.z,o=l.length-1;o>=0;--o)e.point((f=l[o])[0],f[1]);else i(p.x,p.p.x,-1,e);p=p.p}p=p.o,l=p.z,h=!h}while(!p.v);e.lineEnd()}}},Tr=1e9,kr=-Tr,Fr=function(){var n,t,r,i=0,e=0,o=960,u=500;return r={stream:function(r){return n&&t===r?n:n=V(i,e,o,u)(t=r)},extent:function(c){return arguments.length?(i=+c[0][0],e=+c[0][1],o=+c[1][0],u=+c[1][1],n=t=null,r):[[i,e],[o,u]]}}},Ir=at(),Br=function(n,t){var r=t[0],i=t[1],e=[rr(r),-Vt(r),0],u=0,c=0;Ir.reset();for(var a=0,l=n.length;a<l;++a)if(s=(f=n[a]).length)for(var f,s,p=f[s-1],h=p[0],g=p[1]/2+Xt,v=rr(g),E=Vt(g),S=0;S<s;++S,h=x,v=N,E=w,p=m){var m=f[S],x=m[0],_=m[1]/2+Xt,N=rr(_),w=Vt(_),P=x-h,R=P>=0?1:-1,A=R*P,C=A>Dt,j=v*N;if(Ir.add(Qt(j*R*rr(A),E*w+j*Vt(A))),u+=C?P+R*Yt:P,C^h>=r^x>=r){var q=y(d(p),d(m));M(q);var z=y(e,q);M(z);var b=(C^P>=0?-1:1)*o(z[2]);(i>b||i===b&&(q[0]||q[1]))&&(c+=C^P>=0?1:-1)}}return(u<-Bt||u<Bt&&Ir<-Bt)^1&c},Dr=at(),Ur={sphere:c,point:c,lineStart:W,lineEnd:c,polygonStart:c,polygonEnd:c},Xr=function(n){return Dr.reset(),ar(n,Ur),+Dr},Yr=[null,null],Zr={type:"LineString",coordinates:Yr},Hr=function(n,t){return Yr[0]=n,Yr[1]=t,Xr(Zr)},Jr={Feature:function(n,t){return rn(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,i=-1,e=r.length;++i<e;)if(rn(r[i].geometry,t))return!0;return!1}},Kr={Sphere:function(){return!0},Point:function(n,t){return en(n.coordinates,t)},MultiPoint:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)if(en(r[i],t))return!0;return!1},LineString:function(n,t){return on(n.coordinates,t)},MultiLineString:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)if(on(r[i],t))return!0;return!1},Polygon:function(n,t){return un(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)if(un(r[i],t))return!0;return!1},GeometryCollection:function(n,t){for(var r=n.geometries,i=-1,e=r.length;++i<e;)if(rn(r[i],t))return!0;return!1}},Qr=function(n,t){return(n&&Jr.hasOwnProperty(n.type)?Jr[n.type]:rn)(n,t)},Vr=function(n,t){var r=n[0]*Ht,i=n[1]*Ht,e=t[0]*Ht,c=t[1]*Ht,a=Vt(i),l=rr(i),f=Vt(c),s=rr(c),p=a*Vt(r),h=a*rr(r),g=f*Vt(e),v=f*rr(e),d=2*o(er(u(c-i)+a*f*u(e-r))),E=rr(d),y=d?function(n){var t=rr(n*=d)/E,r=rr(d-n)/E,i=r*p+t*g,e=r*h+t*v,o=r*l+t*s;return[Qt(e,i)*Zt,Qt(o,er(i*i+e*e))*Zt]}:function(){return[r*Zt,i*Zt]};return y.distance=d,y},Wr=function(n){return n},$r=at(),ni=at(),ti={point:c,lineStart:c,lineEnd:c,polygonStart:function(){ti.lineStart=hn,ti.lineEnd=dn},polygonEnd:function(){ti.lineStart=ti.lineEnd=ti.point=c,$r.add(Jt(ni)),ni.reset()},result:function(){var n=$r/2;return $r.reset(),n}},ri=1/0,ii=ri,ei=-ri,oi=ei,ui={point:En,lineStart:c,lineEnd:c,polygonStart:c,polygonEnd:c,result:function(){var n=[[ri,ii],[ei,oi]];return ei=oi=-(ii=ri=1/0),n}},ci=0,ai=0,li=0,fi=0,si=0,pi=0,hi=0,gi=0,vi=0,di={point:yn,lineStart:Sn,lineEnd:xn,polygonStart:function(){di.lineStart=_n,di.lineEnd=Nn},polygonEnd:function(){di.point=yn,di.lineStart=Sn,di.lineEnd=xn},result:function(){var n=vi?[hi/vi,gi/vi]:pi?[fi/pi,si/pi]:li?[ci/li,ai/li]:[NaN,NaN];return ci=ai=li=fi=si=pi=hi=gi=vi=0,n}};Rn.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._context.moveTo(n,t),this._point=1;break;case 1:this._context.lineTo(n,t);break;default:this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,Yt)}},result:c};var Ei,yi,Si,mi,Mi,xi=at(),_i={point:c,lineStart:function(){_i.point=An},lineEnd:function(){Ei&&Cn(yi,Si),_i.point=c},polygonStart:function(){Ei=!0},polygonEnd:function(){Ei=null},result:function(){var n=+xi;return xi.reset(),n}};jn.prototype={_radius:4.5,_circle:qn(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._string.push("M",n,",",t),this._point=1;break;case 1:this._string.push("L",n,",",t);break;default:null==this._circle&&(this._circle=qn(this._radius)),this._string.push("M",n,",",t,this._circle)}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}return null}};var Ni=function(n,t){function r(n){return n&&("function"==typeof o&&e.pointRadius(+o.apply(this,arguments)),ar(n,i(e))),e.result()}var i,e,o=4.5;return r.area=function(n){return ar(n,i(ti)),ti.result()},r.measure=function(n){return ar(n,i(_i)),_i.result()},r.bounds=function(n){return ar(n,i(ui)),ui.result()},r.centroid=function(n){return ar(n,i(di)),di.result()},r.projection=function(t){return arguments.length?(i=null==t?(n=null,Wr):(n=t).stream,r):n},r.context=function(n){return arguments.length?(e=null==n?(t=null,new jn):new Rn(t=n),"function"!=typeof o&&e.pointRadius(o),r):t},r.pointRadius=function(n){return arguments.length?(o="function"==typeof n?n:(e.pointRadius(+n),+n),r):o},r.projection(n).context(t)},wi=function(n,r,i,e){return function(o,u){function c(t,r){var i=o(t,r);n(t=i[0],r=i[1])&&u.point(t,r)}function a(n,t){var r=o(n,t);E.point(r[0],r[1])}function l(){x.point=a,E.lineStart()}function f(){x.point=c,E.lineEnd()}function s(n,t){d.push([n,t]);var r=o(n,t);m.point(r[0],r[1])}function p(){m.lineStart(),d=[]}function h(){s(d[0][0],d[0][1]),m.lineEnd();var n,t,r,i,e=m.clean(),o=S.result(),c=o.length;if(d.pop(),g.push(d),d=null,c)if(1&e){if(r=o[0],(t=r.length-1)>0){for(M||(u.polygonStart(),M=!0),u.lineStart(),n=0;n<t;++n)u.point((i=r[n])[0],i[1]);u.lineEnd()}}else c>1&&2&e&&o.push(o.pop().concat(o.shift())),v.push(o.filter(zn))}var g,v,d,E=r(u),y=o.invert(e[0],e[1]),S=br(),m=r(S),M=!1,x={point:c,lineStart:l,lineEnd:f,polygonStart:function(){x.point=s,x.lineStart=p,x.lineEnd=h,v=[],g=[]},polygonEnd:function(){x.point=c,x.lineStart=l,x.lineEnd=f,v=t.merge(v);var n=Br(g,y);v.length?(M||(u.polygonStart(),M=!0),Gr(v,bn,n,i,u)):n&&(M||(u.polygonStart(),M=!0),u.lineStart(),i(null,null,1,u),u.lineEnd()),M&&(u.polygonEnd(),M=!1),v=g=null},sphere:function(){u.polygonStart(),u.lineStart(),i(null,null,1,u),u.lineEnd(),u.polygonEnd()}};return x}},Pi=wi(function(){return!0},Ln,Gn,[-Dt,-Ut]),Ri=function(n,t){function r(r,i,e,o){H(o,n,t,e,r,i)}function i(n,t){return Vt(n)*Vt(t)>c}function e(n){var t,r,e,c,f;return{lineStart:function(){c=e=!1,f=1},point:function(s,p){var h,g=[s,p],v=i(s,p),d=a?v?0:u(s,p):v?u(s+(s<0?Dt:-Dt),p):0;if(!t&&(c=e=v)&&n.lineStart(),v!==e&&(!(h=o(t,g))||Or(t,h)||Or(g,h))&&(g[0]+=Bt,g[1]+=Bt,v=i(g[0],g[1])),v!==e)f=0,v?(n.lineStart(),h=o(g,t),n.point(h[0],h[1])):(h=o(t,g),n.point(h[0],h[1]),n.lineEnd()),t=h;else if(l&&t&&a^v){var E;d&r||!(E=o(g,t,!0))||(f=0,a?(n.lineStart(),n.point(E[0][0],E[0][1]),n.point(E[1][0],E[1][1]),n.lineEnd()):(n.point(E[1][0],E[1][1]),n.lineEnd(),n.lineStart(),n.point(E[0][0],E[0][1])))}!v||t&&Or(t,g)||n.point(g[0],g[1]),t=g,e=v,r=d},lineEnd:function(){e&&n.lineEnd(),t=null},clean:function(){return f|(c&&e)<<1}}}function o(n,t,r){var i=d(n),e=d(t),o=[1,0,0],u=y(i,e),a=E(u,u),l=u[0],f=a-l*l;if(!f)return!r&&n;var s=c*a/f,p=-c*l/f,h=y(o,u),g=m(o,s);S(g,m(u,p));var M=h,x=E(g,M),_=E(M,M),N=x*x-_*(E(g,g)-1);if(!(N<0)){var w=er(N),P=m(M,(-x-w)/_);if(S(P,g),P=v(P),!r)return P;var R,A=n[0],C=t[0],j=n[1],q=t[1];C<A&&(R=A,A=C,C=R);var z=C-A,b=Jt(z-Dt)<Bt,L=b||z<Bt;if(!b&&q<j&&(R=j,j=q,q=R),L?b?j+q>0^P[1]<(Jt(P[0]-A)<Bt?j:q):j<=P[1]&&P[1]<=q:z>Dt^(A<=P[0]&&P[0]<=C)){var O=m(M,(-x+w)/_);return S(O,g),[P,v(O)]}}}function u(t,r){var i=a?n:Dt-n,e=0;return t<-i?e|=1:t>i&&(e|=2),r<-i?e|=4:r>i&&(e|=8),e}var c=Vt(n),a=c>0,l=Jt(c)>Bt;return wi(i,e,r,a?[0,-n]:[-Dt,n-Dt])},Ai=function(n){return{stream:Tn(n)}};kn.prototype={constructor:kn,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Ci=16,ji=Vt(30*Ht),qi=function(n,t){return+t?Dn(n,t):Bn(n)},zi=Tn({point:function(n,t){this.stream.point(n*Ht,t*Ht)}}),bi=function(){return Yn(Hn).scale(155.424).center([0,33.6442])},Li=function(){return bi().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])},Oi=function(){function n(n){var t=n[0],r=n[1];return c=null,e.point(t,r),c||(o.point(t,r),c)||(u.point(t,r),c)}function t(){return r=i=null,n}var r,i,e,o,u,c,a=Li(),l=bi().rotate([154,0]).center([-2,58.5]).parallels([55,65]),f=bi().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s={point:function(n,t){c=[n,t]}};return n.invert=function(n){var t=a.scale(),r=a.translate(),i=(n[0]-r[0])/t,e=(n[1]-r[1])/t;return(e>=.12&&e<.234&&i>=-.425&&i<-.214?l:e>=.166&&e<.234&&i>=-.214&&i<-.115?f:a).invert(n)},n.stream=function(n){return r&&i===n?r:r=Jn([a.stream(i=n),l.stream(n),f.stream(n)])},n.precision=function(n){return arguments.length?(a.precision(n),l.precision(n),f.precision(n),t()):a.precision()},n.scale=function(t){return arguments.length?(a.scale(t),l.scale(.35*t),f.scale(t),n.translate(a.translate())):a.scale()},n.translate=function(n){if(!arguments.length)return a.translate();var r=a.scale(),i=+n[0],c=+n[1];return e=a.translate(n).clipExtent([[i-.455*r,c-.238*r],[i+.455*r,c+.238*r]]).stream(s),o=l.translate([i-.307*r,c+.201*r]).clipExtent([[i-.425*r+Bt,c+.12*r+Bt],[i-.214*r-Bt,c+.234*r-Bt]]).stream(s),u=f.translate([i-.205*r,c+.212*r]).clipExtent([[i-.214*r+Bt,c+.166*r+Bt],[i-.115*r-Bt,c+.234*r-Bt]]).stream(s),t()},n.fitExtent=function(t,r){return Fn(n,t,r)},n.fitSize=function(t,r){return In(n,t,r)},n.scale(1070)},Gi=Kn(function(n){return er(2/(1+n))});Gi.invert=Qn(function(n){return 2*o(n/2)});var Ti=function(){return Un(Gi).scale(124.75).clipAngle(179.999)},ki=Kn(function(n){return(n=e(n))&&n/rr(n)});ki.invert=Qn(function(n){return n});var Fi=function(){return Un(ki).scale(79.4188).clipAngle(179.999)};Vn.invert=function(n,t){return[n,2*Kt($t(t))-Ut]};var Ii=function(){return Wn(Vn).scale(961/Yt)},Bi=function(){return Yn(nt).scale(109.5).parallels([30,30])};tt.invert=tt;var Di=function(){return Un(tt).scale(152.63)},Ui=function(){return Yn(rt).scale(131.154).center([0,13.9389])};it.invert=Qn(Kt);var Xi=function(){return Un(it).scale(144.049).clipAngle(60)},Yi=function(){function n(){return e=o=null,u}var t,r,i,e,o,u,c=1,a=0,l=0,f=1,s=1,p=Wr,h=null,g=Wr;return u={stream:function(n){return e&&o===n?e:e=p(g(o=n))},clipExtent:function(e){return arguments.length?(g=null==e?(h=t=r=i=null,Wr):V(h=+e[0][0],t=+e[0][1],r=+e[1][0],i=+e[1][1]),n()):null==h?null:[[h,t],[r,i]]},scale:function(t){return arguments.length?(p=et((c=+t)*f,c*s,a,l),n()):c},translate:function(t){return arguments.length?(p=et(c*f,c*s,a=+t[0],l=+t[1]),n()):[a,l]},reflectX:function(t){
return arguments.length?(p=et(c*(f=t?-1:1),c*s,a,l),n()):f<0},reflectY:function(t){return arguments.length?(p=et(c*f,c*(s=t?-1:1),a,l),n()):s<0},fitExtent:function(n,t){return Fn(u,n,t)},fitSize:function(n,t){return In(u,n,t)}}};ot.invert=Qn(o);var Zi=function(){return Un(ot).scale(249.5).clipAngle(90+Bt)};ut.invert=Qn(function(n){return 2*Kt(n)});var Hi=function(){return Un(ut).scale(250).clipAngle(142)};ct.invert=function(n,t){return[-t,2*Kt($t(n))-Ut]};var Ji=function(){var n=Wn(ct),t=n.center,r=n.rotate;return n.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)};n.geoArea=pr,n.geoBounds=vr,n.geoCentroid=Er,n.geoCircle=zr,n.geoClipExtent=Fr,n.geoContains=Qr,n.geoDistance=Hr,n.geoGraticule=sn,n.geoGraticule10=pn,n.geoInterpolate=Vr,n.geoLength=Xr,n.geoPath=Ni,n.geoAlbers=Li,n.geoAlbersUsa=Oi,n.geoAzimuthalEqualArea=Ti,n.geoAzimuthalEqualAreaRaw=Gi,n.geoAzimuthalEquidistant=Fi,n.geoAzimuthalEquidistantRaw=ki,n.geoConicConformal=Bi,n.geoConicConformalRaw=nt,n.geoConicEqualArea=bi,n.geoConicEqualAreaRaw=Hn,n.geoConicEquidistant=Ui,n.geoConicEquidistantRaw=rt,n.geoEquirectangular=Di,n.geoEquirectangularRaw=tt,n.geoGnomonic=Xi,n.geoGnomonicRaw=it,n.geoIdentity=Yi,n.geoProjection=Un,n.geoProjectionMutator=Xn,n.geoMercator=Ii,n.geoMercatorRaw=Vn,n.geoOrthographic=Zi,n.geoOrthographicRaw=ot,n.geoStereographic=Hi,n.geoStereographicRaw=ut,n.geoTransverseMercator=Ji,n.geoTransverseMercatorRaw=ct,n.geoRotation=qr,n.geoStream=ar,n.geoTransform=Ai,Object.defineProperty(n,"__esModule",{value:!0})});
},{"d3-array":102}],104:[function(require,module,exports){
function isUndefinedOrNull(e){return null===e||void 0===e}function isBuffer(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}function objEquiv(e,t,r){var n,i;if(isUndefinedOrNull(e)||isUndefinedOrNull(t))return!1;if(e.prototype!==t.prototype)return!1;if(isArguments(e))return!!isArguments(t)&&(e=pSlice.call(e),t=pSlice.call(t),deepEqual(e,t,r));if(isBuffer(e)){if(!isBuffer(t))return!1;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}try{var u=objectKeys(e),o=objectKeys(t)}catch(e){return!1}if(u.length!=o.length)return!1;for(u.sort(),o.sort(),n=u.length-1;n>=0;n--)if(u[n]!=o[n])return!1;for(n=u.length-1;n>=0;n--)if(i=u[n],!deepEqual(e[i],t[i],r))return!1;return typeof e==typeof t}var pSlice=Array.prototype.slice,objectKeys=require("./lib/keys.js"),isArguments=require("./lib/is_arguments.js"),deepEqual=module.exports=function(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:objEquiv(e,t,r))};
},{"./lib/is_arguments.js":105,"./lib/keys.js":106}],105:[function(require,module,exports){
function supported(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function unsupported(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var supportsArgumentsClass="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();exports=module.exports=supportsArgumentsClass?supported:unsupported,exports.supported=supported,exports.unsupported=unsupported;
},{}],106:[function(require,module,exports){
function shim(e){var s=[];for(var t in e)s.push(t);return s}exports=module.exports="function"==typeof Object.keys?Object.keys:shim,exports.shim=shim;
},{}],107:[function(require,module,exports){
"use strict";function earcut(e,n,r){r=r||2;var t=n&&n.length,i=t?n[0]*r:e.length,x=linkedList(e,0,i,r,!0),a=[];if(!x)return a;var o,l,u,s,v,f,y;if(t&&(x=eliminateHoles(e,n,x,r)),e.length>80*r){o=u=e[0],l=s=e[1];for(var d=r;d<i;d+=r)v=e[d],f=e[d+1],v<o&&(o=v),f<l&&(l=f),v>u&&(u=v),f>s&&(s=f);y=Math.max(u-o,s-l)}return earcutLinked(x,a,r,o,l,y),a}function linkedList(e,n,r,t,i){var x,a;if(i===signedArea(e,n,r,t)>0)for(x=n;x<r;x+=t)a=insertNode(x,e[x],e[x+1],a);else for(x=r-t;x>=n;x-=t)a=insertNode(x,e[x],e[x+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,n){if(!e)return e;n||(n=e);var r,t=e;do{if(r=!1,t.steiner||!equals(t,t.next)&&0!==area(t.prev,t,t.next))t=t.next;else{if(removeNode(t),(t=n=t.prev)===t.next)return null;r=!0}}while(r||t!==n);return n}function earcutLinked(e,n,r,t,i,x,a){if(e){!a&&x&&indexCurve(e,t,i,x);for(var o,l,u=e;e.prev!==e.next;)if(o=e.prev,l=e.next,x?isEarHashed(e,t,i,x):isEar(e))n.push(o.i/r),n.push(e.i/r),n.push(l.i/r),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?(e=cureLocalIntersections(e,n,r),earcutLinked(e,n,r,t,i,x,2)):2===a&&splitEarcut(e,n,r,t,i,x):earcutLinked(filterPoints(e),n,r,t,i,x,1);break}}}function isEar(e){var n=e.prev,r=e,t=e.next;if(area(n,r,t)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(n.x,n.y,r.x,r.y,t.x,t.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,n,r,t){var i=e.prev,x=e,a=e.next;if(area(i,x,a)>=0)return!1;for(var o=i.x<x.x?i.x<a.x?i.x:a.x:x.x<a.x?x.x:a.x,l=i.y<x.y?i.y<a.y?i.y:a.y:x.y<a.y?x.y:a.y,u=i.x>x.x?i.x>a.x?i.x:a.x:x.x>a.x?x.x:a.x,s=i.y>x.y?i.y>a.y?i.y:a.y:x.y>a.y?x.y:a.y,v=zOrder(o,l,n,r,t),f=zOrder(u,s,n,r,t),y=e.nextZ;y&&y.z<=f;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(y=e.prevZ;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}return!0}function cureLocalIntersections(e,n,r){var t=e;do{var i=t.prev,x=t.next.next;!equals(i,x)&&intersects(i,t,t.next,x)&&locallyInside(i,x)&&locallyInside(x,i)&&(n.push(i.i/r),n.push(t.i/r),n.push(x.i/r),removeNode(t),removeNode(t.next),t=e=x),t=t.next}while(t!==e);return t}function splitEarcut(e,n,r,t,i,x){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var l=splitPolygon(a,o);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,n,r,t,i,x),void earcutLinked(l,n,r,t,i,x)}o=o.next}a=a.next}while(a!==e)}function eliminateHoles(e,n,r,t){var i,x,a,o,l,u=[];for(i=0,x=n.length;i<x;i++)a=n[i]*t,o=i<x-1?n[i+1]*t:e.length,l=linkedList(e,a,o,t,!1),l===l.next&&(l.steiner=!0),u.push(getLeftmost(l));for(u.sort(compareX),i=0;i<u.length;i++)eliminateHole(u[i],r),r=filterPoints(r,r.next);return r}function compareX(e,n){return e.x-n.x}function eliminateHole(e,n){if(n=findHoleBridge(e,n)){var r=splitPolygon(n,e);filterPoints(r,r.next)}}function findHoleBridge(e,n){var r,t=n,i=e.x,x=e.y,a=-(1/0);do{if(x<=t.y&&x>=t.next.y){var o=t.x+(x-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=i&&o>a){if(a=o,o===i){if(x===t.y)return t;if(x===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!r)return null;if(i===a)return r.prev;var l,u=r,s=r.x,v=r.y,f=1/0;for(t=r.next;t!==u;)i>=t.x&&t.x>=s&&pointInTriangle(x<v?i:a,x,s,v,x<v?a:i,x,t.x,t.y)&&((l=Math.abs(x-t.y)/(i-t.x))<f||l===f&&t.x>r.x)&&locallyInside(t,e)&&(r=t,f=l),t=t.next;return r}function indexCurve(e,n,r,t){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,n,r,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var n,r,t,i,x,a,o,l,u=1;do{for(r=e,e=null,x=null,a=0;r;){for(a++,t=r,o=0,n=0;n<u&&(o++,t=t.nextZ);n++);for(l=u;o>0||l>0&&t;)0===o?(i=t,t=t.nextZ,l--):0!==l&&t?r.z<=t.z?(i=r,r=r.nextZ,o--):(i=t,t=t.nextZ,l--):(i=r,r=r.nextZ,o--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;r=t}x.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,n,r,t,i){return e=32767*(e-r)/i,n=32767*(n-t)/i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),e|n<<1}function getLeftmost(e){var n=e,r=e;do{n.x<r.x&&(r=n),n=n.next}while(n!==e);return r}function pointInTriangle(e,n,r,t,i,x,a,o){return(i-a)*(n-o)-(e-a)*(x-o)>=0&&(e-a)*(t-o)-(r-a)*(n-o)>=0&&(r-a)*(x-o)-(i-a)*(t-o)>=0}function isValidDiagonal(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!intersectsPolygon(e,n)&&locallyInside(e,n)&&locallyInside(n,e)&&middleInside(e,n)}function area(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}function equals(e,n){return e.x===n.x&&e.y===n.y}function intersects(e,n,r,t){return!!(equals(e,n)&&equals(r,t)||equals(e,t)&&equals(r,n))||area(e,n,r)>0!=area(e,n,t)>0&&area(r,t,e)>0!=area(r,t,n)>0}function intersectsPolygon(e,n){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==n.i&&r.next.i!==n.i&&intersects(r,r.next,e,n))return!0;r=r.next}while(r!==e);return!1}function locallyInside(e,n){return area(e.prev,e,e.next)<0?area(e,n,e.next)>=0&&area(e,e.prev,n)>=0:area(e,n,e.prev)<0||area(e,e.next,n)<0}function middleInside(e,n){var r=e,t=!1,i=(e.x+n.x)/2,x=(e.y+n.y)/2;do{r.y>x!=r.next.y>x&&i<(r.next.x-r.x)*(x-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next}while(r!==e);return t}function splitPolygon(e,n){var r=new Node(e.i,e.x,e.y),t=new Node(n.i,n.x,n.y),i=e.next,x=n.prev;return e.next=n,n.prev=e,r.next=i,i.prev=r,t.next=r,r.prev=t,x.next=t,t.prev=x,t}function insertNode(e,n,r,t){var i=new Node(e,n,r);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,n,r){this.i=e,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,n,r,t){for(var i=0,x=n,a=r-t;x<r;x+=t)i+=(e[a]-e[x])*(e[x+1]+e[a+1]),a=x;return i}module.exports=earcut,earcut.deviation=function(e,n,r,t){var i=n&&n.length,x=i?n[0]*r:e.length,a=Math.abs(signedArea(e,0,x,r));if(i)for(var o=0,l=n.length;o<l;o++){var u=n[o]*r,s=o<l-1?n[o+1]*r:e.length;a-=Math.abs(signedArea(e,u,s,r))}var v=0;for(o=0;o<t.length;o+=3){var f=t[o]*r,y=t[o+1]*r,d=t[o+2]*r;v+=Math.abs((e[f]-e[d])*(e[y+1]-e[f+1])-(e[f]-e[y])*(e[d+1]-e[f+1]))}return 0===a&&0===v?0:Math.abs((v-a)/a)},earcut.flatten=function(e){for(var n=e[0][0].length,r={vertices:[],holes:[],dimensions:n},t=0,i=0;i<e.length;i++){for(var x=0;x<e[i].length;x++)for(var a=0;a<n;a++)r.vertices.push(e[i][x][a]);i>0&&(t+=e[i-1].length,r.holes.push(t))}return r};
},{}],108:[function(require,module,exports){
"use strict";var Dms={};Dms.parseDMS=function(e){if("number"==typeof e&&isFinite(e))return Number(e);var a=String(e).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==a[a.length-1]&&a.splice(a.length-1),""==a)return NaN;var r;switch(a.length){case 3:r=a[0]/1+a[1]/60+a[2]/3600;break;case 2:r=a[0]/1+a[1]/60;break;case 1:r=a[0];break;default:return NaN}return/^-|[WS]$/i.test(e.trim())&&(r=-r),Number(r)},Dms.separator="",Dms.toDMS=function(e,a,r){if(isNaN(e))return null;if(void 0===a&&(a="dms"),void 0===r)switch(a){case"d":case"deg":r=4;break;case"dm":case"deg+min":r=2;break;case"dms":case"deg+min+sec":r=0;break;default:a="dms",r=0}e=Math.abs(e);var s,t,c,n;switch(a){default:case"d":case"deg":t=e.toFixed(r),t<100&&(t="0"+t),t<10&&(t="0"+t),s=t+"";break;case"dm":case"deg+min":var o=(60*e).toFixed(r);t=Math.floor(o/60),c=(o%60).toFixed(r),t<100&&(t="0"+t),t<10&&(t="0"+t),c<10&&(c="0"+c),s=t+""+Dms.separator+c+"";break;case"dms":case"deg+min+sec":var i=(3600*e).toFixed(r);t=Math.floor(i/3600),c=Math.floor(i/60)%60,n=(i%60).toFixed(r),t<100&&(t="0"+t),t<10&&(t="0"+t),c<10&&(c="0"+c),n<10&&(n="0"+n),s=t+""+Dms.separator+c+""+Dms.separator+n+""}return s},Dms.toLat=function(e,a,r){var s=Dms.toDMS(e,a,r);return null===s?"":s.slice(1)+Dms.separator+(e<0?"S":"N")},Dms.toLon=function(e,a,r){var s=Dms.toDMS(e,a,r);return null===s?"":s+Dms.separator+(e<0?"W":"E")},Dms.toBrng=function(e,a,r){e=(Number(e)+360)%360;var s=Dms.toDMS(e,a,r);return null===s?"":s.replace("360","0")},Dms.compassPoint=function(e,a){void 0===a&&(a=3),e=(e%360+360)%360;var r;switch(a){case 1:switch(Math.round(4*e/360)%4){case 0:r="N";break;case 1:r="E";break;case 2:r="S";break;case 3:r="W"}break;case 2:switch(Math.round(8*e/360)%8){case 0:r="N";break;case 1:r="NE";break;case 2:r="E";break;case 3:r="SE";break;case 4:r="S";break;case 5:r="SW";break;case 6:r="W";break;case 7:r="NW"}break;case 3:switch(Math.round(16*e/360)%16){case 0:r="N";break;case 1:r="NNE";break;case 2:r="NE";break;case 3:r="ENE";break;case 4:r="E";break;case 5:r="ESE";break;case 6:r="SE";break;case 7:r="SSE";break;case 8:r="S";break;case 9:r="SSW";break;case 10:r="SW";break;case 11:r="WSW";break;case 12:r="W";break;case 13:r="WNW";break;case 14:r="NW";break;case 15:r="NNW"}break;default:throw new RangeError("Precision must be between 1 and 3")}return r},void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),"undefined"!=typeof module&&module.exports&&(module.exports=Dms);
},{}],109:[function(require,module,exports){
"use strict";function LatLon(t,o,r){if(!(this instanceof LatLon))return new LatLon(t,o,r);void 0===r&&(r=LatLon.datum.WGS84),this.lat=Number(t),this.lon=Number(o),this.datum=r}if("undefined"!=typeof module&&module.exports)var Vector3d=require("./vector3d.js");if("undefined"!=typeof module&&module.exports)var Dms=require("./dms.js");LatLon.ellipsoid={WGS84:{a:6378137,b:6356752.31425,f:1/298.257223563},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Intl1924:{a:6378388,b:6356911.946,f:1/297},Bessel1841:{a:6377397.155,b:6356078.963,f:1/299.152815351}},LatLon.datum={WGS84:{ellipsoid:LatLon.ellipsoid.WGS84,transform:{tx:0,ty:0,tz:0,rx:0,ry:0,rz:0,s:0}},ITRF90:{ellipsoid:LatLon.ellipsoid.GRS80,transform:{tx:-.06,ty:.517,tz:.223,rx:-.0183,ry:3e-4,rz:-.007,s:.011}},NAD83:{ellipsoid:LatLon.ellipsoid.GRS80,transform:{tx:1.004,ty:-1.91,tz:-.515,rx:.0267,ry:34e-5,rz:.011,s:-.0015}},OSGB36:{ellipsoid:LatLon.ellipsoid.Airy1830,transform:{tx:-446.448,ty:125.157,tz:-542.06,rx:-.1502,ry:-.247,rz:-.8421,s:20.4894}},ED50:{ellipsoid:LatLon.ellipsoid.Intl1924,transform:{tx:89.5,ty:93.8,tz:123.1,rx:0,ry:0,rz:.156,s:-1.2}},Irl1975:{ellipsoid:LatLon.ellipsoid.AiryModified,transform:{tx:-482.53,ty:130.596,tz:-564.557,rx:-1.042,ry:-.214,rz:-.631,s:-8.15}},TokyoJapan:{ellipsoid:LatLon.ellipsoid.Bessel1841,transform:{tx:148,ty:-507,tz:-685,rx:0,ry:0,rz:0,s:0}}},LatLon.prototype.convertDatum=function(t){var o,r=this;if(r.datum==LatLon.datum.WGS84&&(o=t.transform),t==LatLon.datum.WGS84){o={};for(var a in r.datum.transform)r.datum.transform.hasOwnProperty(a)&&(o[a]=-r.datum.transform[a])}return void 0===o&&(r=this.convertDatum(LatLon.datum.WGS84),o=t.transform),r.toCartesian().applyTransform(o).toLatLonE(t)},LatLon.prototype.toCartesian=function(){var t=this.lat.toRadians(),o=this.lon.toRadians(),r=this.datum.ellipsoid.a,a=this.datum.ellipsoid.f,e=Math.sin(t),i=Math.cos(t),s=Math.sin(o),n=Math.cos(o),d=2*a-a*a,l=r/Math.sqrt(1-d*e*e);return new Vector3d((l+0)*i*n,(l+0)*i*s,(l*(1-d)+0)*e)},Vector3d.prototype.toLatLonE=function(t){var o=this.x,r=this.y,a=this.z,e=t.ellipsoid.a,i=t.ellipsoid.b,s=t.ellipsoid.f,n=2*s-s*s,d=n/(1-n),l=Math.sqrt(o*o+r*r),p=Math.sqrt(l*l+a*a),u=i*a/(e*l)*(1+d*i/p),L=u/Math.sqrt(1+u*u),m=L/u,f=isNaN(m)?0:Math.atan2(a+d*i*L*L*L,l-n*e*m*m*m),y=Math.atan2(r,o),h=Math.sin(f);Math.cos(f),Math.sqrt(1-n*h*h);return new LatLon(f.toDegrees(),y.toDegrees(),t)},Vector3d.prototype.applyTransform=function(t){var o=this.x,r=this.y,a=this.z,e=t.tx,i=t.ty,s=t.tz,n=(t.rx/3600).toRadians(),d=(t.ry/3600).toRadians(),l=(t.rz/3600).toRadians(),p=t.s/1e6+1;return new Vector3d(e+o*p-r*l+a*d,i+o*l+r*p-a*n,s-o*d+r*n+a*p)},LatLon.prototype.toString=function(t,o){return Dms.toLat(this.lat,t,o)+", "+Dms.toLon(this.lon,t,o)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon,module.exports.Vector3d=Vector3d);
},{"./dms.js":108,"./vector3d.js":117}],110:[function(require,module,exports){
"use strict";function LatLon(t,a){if(!(this instanceof LatLon))return new LatLon(t,a);this.lat=Number(t),this.lon=Number(a)}if("undefined"!=typeof module&&module.exports)var Dms=require("./dms");LatLon.prototype.distanceTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");a=void 0===a?6371e3:Number(a);var n=a,o=this.lat.toRadians(),s=this.lon.toRadians(),i=t.lat.toRadians(),h=t.lon.toRadians(),e=i-o,r=h-s,M=Math.sin(e/2)*Math.sin(e/2)+Math.cos(o)*Math.cos(i)*Math.sin(r/2)*Math.sin(r/2);return n*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))},LatLon.prototype.bearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=t.lat.toRadians(),o=(t.lon-this.lon).toRadians(),s=Math.sin(o)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(o);return(Math.atan2(s,i).toDegrees()+360)%360},LatLon.prototype.finalBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");return(t.bearingTo(this)+180)%360},LatLon.prototype.midpointTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=this.lon.toRadians(),o=t.lat.toRadians(),s=(t.lon-this.lon).toRadians(),i=Math.cos(o)*Math.cos(s),h=Math.cos(o)*Math.sin(s),e=Math.sqrt((Math.cos(a)+i)*(Math.cos(a)+i)+h*h),r=Math.sin(a)+Math.sin(o),M=Math.atan2(r,e),c=n+Math.atan2(h,Math.cos(a)+i);return new LatLon(M.toDegrees(),(c.toDegrees()+540)%360-180)},LatLon.prototype.intermediatePointTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var n=this.lat.toRadians(),o=this.lon.toRadians(),s=t.lat.toRadians(),i=t.lon.toRadians(),h=Math.sin(n),e=Math.cos(n),r=Math.sin(o),M=Math.cos(o),c=Math.sin(s),L=Math.cos(s),u=Math.sin(i),l=Math.cos(i),d=s-n,p=i-o,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(n)*Math.cos(s)*Math.sin(p/2)*Math.sin(p/2),b=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),R=Math.sin((1-a)*b)/Math.sin(b),g=Math.sin(a*b)/Math.sin(b),v=R*e*M+g*L*l,m=R*e*r+g*L*u,P=R*h+g*c,y=Math.atan2(P,Math.sqrt(v*v+m*m)),w=Math.atan2(m,v);return new LatLon(y.toDegrees(),(w.toDegrees()+540)%360-180)},LatLon.prototype.destinationPoint=function(t,a,n){n=void 0===n?6371e3:Number(n);var o=Number(t)/n,s=Number(a).toRadians(),i=this.lat.toRadians(),h=this.lon.toRadians(),e=Math.sin(i),r=Math.cos(i),M=Math.sin(o),c=Math.cos(o),L=Math.sin(s),u=Math.cos(s),l=e*c+r*M*u,d=Math.asin(l),p=L*M*r,f=c-e*l,b=h+Math.atan2(p,f);return new LatLon(d.toDegrees(),(b.toDegrees()+540)%360-180)},LatLon.intersection=function(t,a,n,o){if(!(t instanceof LatLon))throw new TypeError("p1 is not LatLon object");if(!(n instanceof LatLon))throw new TypeError("p2 is not LatLon object");var s=t.lat.toRadians(),i=t.lon.toRadians(),h=n.lat.toRadians(),e=n.lon.toRadians(),r=Number(a).toRadians(),M=Number(o).toRadians(),c=h-s,L=e-i,u=2*Math.asin(Math.sqrt(Math.sin(c/2)*Math.sin(c/2)+Math.cos(s)*Math.cos(h)*Math.sin(L/2)*Math.sin(L/2)));if(0==u)return null;var l=Math.acos((Math.sin(h)-Math.sin(s)*Math.cos(u))/(Math.sin(u)*Math.cos(s)));isNaN(l)&&(l=0);var d=Math.acos((Math.sin(s)-Math.sin(h)*Math.cos(u))/(Math.sin(u)*Math.cos(h))),p=Math.sin(e-i)>0?l:2*Math.PI-l,f=Math.sin(e-i)>0?2*Math.PI-d:d,b=(r-p+Math.PI)%(2*Math.PI)-Math.PI,R=(f-M+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(b)&&0==Math.sin(R))return null;if(Math.sin(b)*Math.sin(R)<0)return null;var g=Math.acos(-Math.cos(b)*Math.cos(R)+Math.sin(b)*Math.sin(R)*Math.cos(u)),v=Math.atan2(Math.sin(u)*Math.sin(b)*Math.sin(R),Math.cos(R)+Math.cos(b)*Math.cos(g)),m=Math.asin(Math.sin(s)*Math.cos(v)+Math.cos(s)*Math.sin(v)*Math.cos(r)),P=Math.atan2(Math.sin(r)*Math.sin(v)*Math.cos(s),Math.cos(v)-Math.sin(s)*Math.sin(m)),y=i+P;return new LatLon(m.toDegrees(),(y.toDegrees()+540)%360-180)},LatLon.prototype.crossTrackDistanceTo=function(t,a,n){if(!(t instanceof LatLon))throw new TypeError("pathStart is not LatLon object");if(!(a instanceof LatLon))throw new TypeError("pathEnd is not LatLon object");n=void 0===n?6371e3:Number(n);var o=t.distanceTo(this,n)/n,s=t.bearingTo(this).toRadians(),i=t.bearingTo(a).toRadians();return Math.asin(Math.sin(o)*Math.sin(s-i))*n},LatLon.prototype.maxLatitude=function(t){var a=Number(t).toRadians(),n=this.lat.toRadians();return Math.acos(Math.abs(Math.sin(a)*Math.cos(n))).toDegrees()},LatLon.crossingParallels=function(t,a,n){var o=Number(n).toRadians(),s=t.lat.toRadians(),i=t.lon.toRadians(),h=a.lat.toRadians(),e=a.lon.toRadians(),r=e-i,M=Math.sin(s)*Math.cos(h)*Math.cos(o)*Math.sin(r),c=Math.sin(s)*Math.cos(h)*Math.cos(o)*Math.cos(r)-Math.cos(s)*Math.sin(h)*Math.cos(o),L=Math.cos(s)*Math.cos(h)*Math.sin(o)*Math.sin(r);if(L*L>M*M+c*c)return null;var u=Math.atan2(-c,M),l=Math.acos(L/Math.sqrt(M*M+c*c)),d=i+u-l,p=i+u+l;return{lon1:(d.toDegrees()+540)%360-180,lon2:(p.toDegrees()+540)%360-180}},LatLon.prototype.rhumbDistanceTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");a=void 0===a?6371e3:Number(a);var n=a,o=this.lat.toRadians(),s=t.lat.toRadians(),i=s-o,h=Math.abs(t.lon-this.lon).toRadians();Math.abs(h)>Math.PI&&(h=h>0?-(2*Math.PI-h):2*Math.PI+h);var e=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),r=Math.abs(e)>1e-11?i/e:Math.cos(o);return Math.sqrt(i*i+r*r*h*h)*n},LatLon.prototype.rhumbBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=t.lat.toRadians(),o=(t.lon-this.lon).toRadians();Math.abs(o)>Math.PI&&(o=o>0?-(2*Math.PI-o):2*Math.PI+o);var s=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));return(Math.atan2(o,s).toDegrees()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(t,a,n){n=void 0===n?6371e3:Number(n);var o=Number(t)/n,s=this.lat.toRadians(),i=this.lon.toRadians(),h=Number(a).toRadians(),e=o*Math.cos(h),r=s+e;Math.abs(r)>Math.PI/2&&(r=r>0?Math.PI-r:-Math.PI-r);var M=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(M)>1e-11?e/M:Math.cos(s),L=o*Math.sin(h)/c,u=i+L;return new LatLon(r.toDegrees(),(u.toDegrees()+540)%360-180)},LatLon.prototype.rhumbMidpointTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=this.lon.toRadians(),o=t.lat.toRadians(),s=t.lon.toRadians();Math.abs(s-n)>Math.PI&&(n+=2*Math.PI);var i=(a+o)/2,h=Math.tan(Math.PI/4+a/2),e=Math.tan(Math.PI/4+o/2),r=Math.tan(Math.PI/4+i/2),M=((s-n)*Math.log(r)+n*Math.log(e)-s*Math.log(h))/Math.log(e/h);return isFinite(M)||(M=(n+s)/2),LatLon(i.toDegrees(),(M.toDegrees()+540)%360-180)},LatLon.areaOf=function(t,a){var n=void 0===a?6371e3:Number(a),o=t[0].equals(t[t.length-1]);o||t.push(t[0]);for(var s=t.length-1,i=0,h=0;h<s;h++){var e=t[h].lat.toRadians(),r=t[h+1].lat.toRadians(),M=(t[h+1].lon-t[h].lon).toRadians();i+=2*Math.atan2(Math.tan(M/2)*(Math.tan(e/2)+Math.tan(r/2)),1+Math.tan(e/2)*Math.tan(r/2))}(function(t){for(var a=0,n=t[0].bearingTo(t[1]),o=0;o<t.length-1;o++){var s=t[o].bearingTo(t[o+1]),i=t[o].finalBearingTo(t[o+1]);a+=(s-n+540)%360-180,a+=(i-s+540)%360-180,n=i}var s=t[0].bearingTo(t[1]);return a+=(s-n+540)%360-180,Math.abs(a)<90})(t)&&(i=Math.abs(i)-2*Math.PI);var c=Math.abs(i*n*n);return o||t.pop(),c},LatLon.prototype.equals=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");return this.lat==t.lat&&this.lon==t.lon},LatLon.prototype.toString=function(t,a){return Dms.toLat(this.lat,t,a)+", "+Dms.toLon(this.lon,t,a)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon);
},{"./dms":108}],111:[function(require,module,exports){
"use strict";function LatLon(t,o){if(!(this instanceof LatLon))return new LatLon(t,o);this.lat=Number(t),this.lon=Number(o)}if("undefined"!=typeof module&&module.exports)var Vector3d=require("./vector3d.js");if("undefined"!=typeof module&&module.exports)var Dms=require("./dms.js");LatLon.prototype.toVector=function(){var t=this.lat.toRadians(),o=this.lon.toRadians(),e=Math.cos(t)*Math.cos(o),n=Math.cos(t)*Math.sin(o),r=Math.sin(t);return new Vector3d(e,n,r)},Vector3d.prototype.toLatLonS=function(){var t=Math.atan2(this.z,Math.sqrt(this.x*this.x+this.y*this.y)),o=Math.atan2(this.y,this.x);return new LatLon(t.toDegrees(),o.toDegrees())},LatLon.prototype.greatCircle=function(t){var o=this.lat.toRadians(),e=this.lon.toRadians(),n=Number(t).toRadians(),r=Math.sin(e)*Math.cos(n)-Math.sin(o)*Math.cos(e)*Math.sin(n),a=-Math.cos(e)*Math.cos(n)-Math.sin(o)*Math.sin(e)*Math.sin(n),s=Math.cos(o)*Math.sin(n);return new Vector3d(r,a,s)},Vector3d.prototype.greatCircle=function(t){var o=Number(t).toRadians(),e=new Vector3d(0,0,1),n=e.cross(this),r=this.cross(n),a=n.times(Math.cos(o)/n.length());return r.times(Math.sin(o)/r.length()).minus(a)},LatLon.prototype.distanceTo=function(t,o){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");o=void 0===o?6371e3:Number(o);var e=this.toVector(),n=t.toVector();return e.angleTo(n)*o},LatLon.prototype.bearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var o=this.toVector(),e=t.toVector(),n=new Vector3d(0,0,1),r=o.cross(e),a=o.cross(n);return(r.angleTo(a,o).toDegrees()+360)%360},LatLon.prototype.midpointTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var o=this.toVector(),e=t.toVector();return o.plus(e).unit().toLatLonS()},LatLon.prototype.destinationPoint=function(t,o,e){e=void 0===e?6371e3:Number(e);var n=this.toVector(),r=Number(t)/e,a=Number(o).toRadians(),s=new Vector3d(0,0,1),i=s.cross(n).unit(),c=n.cross(i),h=i.times(Math.sin(a)),u=c.times(Math.cos(a)),L=u.plus(h),p=n.times(Math.cos(r)),l=L.times(Math.sin(r));return p.plus(l).toLatLonS()},LatLon.intersection=function(t,o,e,n){if(!(t instanceof LatLon))throw new TypeError("path1start is not LatLon object");if(!(e instanceof LatLon))throw new TypeError("path2start is not LatLon object");if(!(o instanceof LatLon)&&isNaN(o))throw new TypeError("path1brngEnd is not LatLon object or bearing");if(!(n instanceof LatLon)&&isNaN(n))throw new TypeError("path2brngEnd is not LatLon object or bearing");var r,a,s,i,c=t.toVector(),h=e.toVector();o instanceof LatLon?(r=c.cross(o.toVector()),s="endpoint"):(r=t.greatCircle(Number(o)),s="bearing"),n instanceof LatLon?(a=h.cross(n.toVector()),i="endpoint"):(a=e.greatCircle(Number(n)),i="bearing");var u=r.cross(a),L=a.cross(r),p=null,l=null,d=null;switch(s+"+"+i){case"bearing+bearing":switch(l=Math.sign(r.cross(c).dot(u)),d=Math.sign(a.cross(h).dot(u)),l+d){case 2:p=u;break;case-2:p=L;break;case 0:p=c.plus(h).dot(u)>0?L:u}break;case"bearing+endpoint":l=Math.sign(r.cross(c).dot(u)),p=l>0?u:L;break;case"endpoint+bearing":d=Math.sign(a.cross(h).dot(u)),p=d>0?u:L;break;case"endpoint+endpoint":p=c.plus(h).plus(o.toVector()).plus(n.toVector()).dot(u)>0?u:L}return p.toLatLonS()},LatLon.prototype.crossTrackDistanceTo=function(t,o,e){if(!(t instanceof LatLon))throw new TypeError("pathStart is not LatLon object");var n=void 0===e?6371e3:Number(e),r=this.toVector();return((o instanceof LatLon?t.toVector().cross(o.toVector()):t.greatCircle(Number(o))).angleTo(r)-Math.PI/2)*n},LatLon.prototype.nearestPointOnSegment=function(t,o){var e=null;if(this.isBetween(t,o)){var n=this.toVector(),r=t.toVector(),a=o.toVector(),s=r.cross(a),i=n.cross(s);e=s.cross(i).toLatLonS()}else{e=this.distanceTo(t)<this.distanceTo(o)?t:o}return e},LatLon.prototype.isBetween=function(t,o){var e=this.toVector(),n=t.toVector(),r=o.toVector(),a=e.minus(n),s=r.minus(n),i=e.minus(r),c=n.minus(r),h=a.dot(s),u=i.dot(c);return h>=0&&u>=0},LatLon.prototype.enclosedBy=function(t){var o=t[0].equals(t[t.length-1]);o||t.push(t[0]);for(var e=t.length-1,n=this.toVector(),r=[],a=0;a<e;a++)r[a]=n.minus(t[a].toVector());r.push(r[0]);for(var s=0,a=0;a<e;a++)s+=r[a].angleTo(r[a+1],n);var i=Math.abs(s)>Math.PI;return o||t.pop(),i},LatLon.areaOf=function(t,o){var e=void 0===o?6371e3:Number(o);t[0].equals(t[t.length-1])||t.push(t[0]);var n=t.length-1;console.log("n",n);for(var r=[],a=0;a<n;a++){var s=t[a].toVector(),i=t[a+1].toVector();r[a]=s.cross(i)}console.log("c",r.length,r),r.push(r[0]);for(var c=0,a=0;a<n;a++)console.log(a,(Math.PI-r[a].angleTo(r[a+1])).toDegrees()),c+=Math.PI-r[a].angleTo(r[a+1]);return console.log("",c.toDegrees(),((n-2)*Math.PI).toDegrees()),(c-(n-2)*Math.PI)*e*e},LatLon.meanOf=function(t){for(var o=new Vector3d(0,0,0),e=0;e<t.length;e++)o=o.plus(t[e].toVector());return o.unit().toLatLonS()},LatLon.prototype.equals=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");return this.lat==t.lat&&this.lon==t.lon},LatLon.prototype.toString=function(t,o){return Dms.toLat(this.lat,t,o)+", "+Dms.toLon(this.lon,t,o)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),void 0===Math.sign&&(Math.sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon,module.exports.Vector3d=Vector3d);
},{"./dms.js":108,"./vector3d.js":117}],112:[function(require,module,exports){
"use strict";if("undefined"!=typeof module&&module.exports)var LatLon=require("./latlon-ellipsoidal.js");LatLon.prototype.distanceTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");try{return this.inverse(t).distance}catch(t){return NaN}},LatLon.prototype.initialBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");try{return this.inverse(t).initialBearing}catch(t){return NaN}},LatLon.prototype.finalBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");try{return this.inverse(t).finalBearing}catch(t){return NaN}},LatLon.prototype.destinationPoint=function(t,a){return this.direct(Number(t),Number(a)).point},LatLon.prototype.finalBearingOn=function(t,a){return this.direct(Number(t),Number(a)).finalBearing},LatLon.prototype.direct=function(t,a){var e,n,o,i,r,s=this.lat.toRadians(),h=this.lon.toRadians(),u=a.toRadians(),d=t,l=this.datum.ellipsoid.a,p=this.datum.ellipsoid.b,M=this.datum.ellipsoid.f,c=Math.sin(u),f=Math.cos(u),L=(1-M)*Math.tan(s),m=1/Math.sqrt(1+L*L),y=L*m,g=Math.atan2(L,f),N=m*c,b=1-N*N,v=b*(l*l-p*p)/(p*p),w=1+v/16384*(4096+v*(v*(320-175*v)-768)),P=v/1024*(256+v*(v*(74-47*v)-128)),I=d/(p*w),B=0;do{e=Math.cos(2*g+I),n=Math.sin(I),o=Math.cos(I),i=P*n*(e+P/4*(o*(2*e*e-1)-P/6*e*(4*n*n-3)*(4*e*e-3))),r=I,I=d/(p*w)+i}while(Math.abs(I-r)>1e-12&&++B<200);if(B>=200)throw new Error("Formula failed to converge");var R=y*n-m*o*f,D=Math.atan2(y*o+m*n*f,(1-M)*Math.sqrt(N*N+R*R)),q=Math.atan2(n*c,m*o-y*n*f),T=M/16*b*(4+M*(4-3*b)),E=q-(1-T)*M*N*(I+T*n*(e+T*o*(2*e*e-1))),j=(h+E+3*Math.PI)%(2*Math.PI)-Math.PI,x=Math.atan2(N,-R);return x=(x+2*Math.PI)%(2*Math.PI),{point:new LatLon(D.toDegrees(),j.toDegrees(),this.datum),finalBearing:x.toDegrees()}},LatLon.prototype.inverse=function(t){var a,e,n,o,i,r,s,h,u,d,l,p=this,M=t,c=p.lat.toRadians(),f=p.lon.toRadians(),L=M.lat.toRadians(),m=M.lon.toRadians(),y=this.datum.ellipsoid.a,g=this.datum.ellipsoid.b,N=this.datum.ellipsoid.f,b=m-f,v=(1-N)*Math.tan(c),w=1/Math.sqrt(1+v*v),P=v*w,I=(1-N)*Math.tan(L),B=1/Math.sqrt(1+I*I),R=I*B,D=b,q=0;do{if(a=Math.sin(D),e=Math.cos(D),n=B*a*(B*a)+(w*R-P*B*e)*(w*R-P*B*e),0==(o=Math.sqrt(n)))return 0;i=P*R+w*B*e,r=Math.atan2(o,i),s=w*B*a/o,h=1-s*s,u=i-2*P*R/h,isNaN(u)&&(u=0),d=N/16*h*(4+N*(4-3*h)),l=D,D=b+(1-d)*N*s*(r+d*o*(u+d*i*(2*u*u-1)))}while(Math.abs(D-l)>1e-12&&++q<200);if(q>=200)throw new Error("Formula failed to converge");var T=h*(y*y-g*g)/(g*g),E=1+T/16384*(4096+T*(T*(320-175*T)-768)),j=T/1024*(256+T*(T*(74-47*T)-128)),x=j*o*(u+j/4*(i*(2*u*u-1)-j/6*u*(4*o*o-3)*(4*u*u-3))),F=g*E*(r-x),O=Math.atan2(B*a,w*R-P*B*e),k=Math.atan2(w*a,-P*B+w*R*e);return O=(O+2*Math.PI)%(2*Math.PI),k=(k+2*Math.PI)%(2*Math.PI),F=Number(F.toFixed(3)),{distance:F,initialBearing:O.toDegrees(),finalBearing:k.toDegrees()}},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon);
},{"./latlon-ellipsoidal.js":109}],113:[function(require,module,exports){
"use strict";function Mgrs(e,t,r,n,i,o,s){if(!(this instanceof Mgrs))return new Mgrs(e,t,r,n,i,o,s);if(void 0===s&&(s=LatLon.datum.WGS84),!(1<=e&&e<=60))throw new Error("Invalid MGRS grid reference (zone "+e+")");if(1!=t.length)throw new Error("Invalid MGRS grid reference (band "+t+")");if(Mgrs.latBands.indexOf(t)==-1)throw new Error("Invalid MGRS grid reference (band "+t+")");if(1!=r.length)throw new Error("Invalid MGRS grid reference (e100k "+r+")");if(1!=n.length)throw new Error("Invalid MGRS grid reference (n100k "+n+")");this.zone=Number(e),this.band=t,this.e100k=r,this.n100k=n,this.easting=Number(i),this.northing=Number(o),this.datum=s}if("undefined"!=typeof module&&module.exports)var Utm=require("./utm.js");if("undefined"!=typeof module&&module.exports)var LatLon=require("./latlon-ellipsoidal.js");Mgrs.latBands="CDEFGHJKLMNPQRSTUVWXX",Mgrs.e100kLetters=["ABCDEFGH","JKLMNPQR","STUVWXYZ"],Mgrs.n100kLetters=["ABCDEFGHJKLMNPQRSTUV","FGHJKLMNPQRSTUVABCDE"],Utm.prototype.toMgrs=function(){if(isNaN(this.zone+this.easting+this.northing))throw new Error("Invalid UTM coordinate "+this.toString()+"");var e=this.zone,t=this.toLatLonE(),r=Mgrs.latBands.charAt(Math.floor(t.lat/8+10)),n=Math.floor(this.easting/1e5),i=Mgrs.e100kLetters[(e-1)%3].charAt(n-1),o=Math.floor(this.northing/1e5)%20,s=Mgrs.n100kLetters[(e-1)%2].charAt(o),h=this.easting%1e5,a=this.northing%1e5;return h=Number(h.toFixed(6)),a=Number(a.toFixed(6)),new Mgrs(e,r,i,s,h,a)},Mgrs.prototype.toUtm=function(){for(var e=this.zone,t=this.band,r=this.e100k,n=this.n100k,i=this.easting,o=this.northing,s=t>="N"?"N":"S",h=Mgrs.e100kLetters[(e-1)%3].indexOf(r)+1,a=1e5*h,d=Mgrs.n100kLetters[(e-1)%2].indexOf(n),l=1e5*d,g=8*(Mgrs.latBands.indexOf(t)-10),f=1e5*Math.floor(new LatLon(g,0).toUtm().northing/1e5),M=0;M+l+o<f;)M+=2e6;return new Utm(e,s,a+i,M+l+o,this.datum)},Mgrs.parse=function(e){if(e=e.trim(),!e.match(/\s/)){var t=e.slice(5);t=t.slice(0,t.length/2)+" "+t.slice(-t.length/2),e=e.slice(0,3)+" "+e.slice(3,5)+" "+t}if(null==(e=e.match(/\S+/g))||4!=e.length)throw new Error("Invalid MGRS grid reference "+e+"");var r=e[0],n=r.slice(0,2),i=r.slice(2,3),o=e[1],s=o.slice(0,1),h=o.slice(1,2),a=e[2],d=e[3];return a=a.length>=5?a:(a+"00000").slice(0,5),d=d.length>=5?d:(d+"00000").slice(0,5),new Mgrs(n,i,s,h,a,d)},Mgrs.prototype.toString=function(e){if(e=void 0===e?10:Number(e),[2,4,6,8,10].indexOf(e)==-1)throw new Error("Invalid precision "+e+"");var t=this.zone.pad(2),r=this.band,n=this.e100k,i=this.n100k,o=Math.floor(this.easting/Math.pow(10,5-e/2)),s=Math.floor(this.northing/Math.pow(10,5-e/2));return o=o.pad(e/2),s=s.pad(e/2),t+r+" "+n+i+" "+o+" "+s},void 0===Number.prototype.pad&&(Number.prototype.pad=function(e){for(var t=this.toString();t.length<e;)t="0"+t;return t}),"undefined"!=typeof module&&module.exports&&(module.exports=Mgrs);
},{"./latlon-ellipsoidal.js":109,"./utm.js":116}],114:[function(require,module,exports){
"use strict";exports.LatLonSpherical=require("./latlon-spherical.js"),exports.LatLonEllipsoidal=require("./latlon-ellipsoidal.js");var V=require("./latlon-vincenty.js");for(var prop in V)exports.LatLonEllipsoidal[prop]=V[prop];exports.LatLonVectors=require("./latlon-vectors.js"),exports.Vector3d=require("./vector3d.js"),exports.Utm=require("./utm.js"),exports.Mgrs=require("./mgrs.js"),exports.OsGridRef=require("./osgridref.js"),exports.Dms=require("./dms.js");
},{"./dms.js":108,"./latlon-ellipsoidal.js":109,"./latlon-spherical.js":110,"./latlon-vectors.js":111,"./latlon-vincenty.js":112,"./mgrs.js":113,"./osgridref.js":115,"./utm.js":116,"./vector3d.js":117}],115:[function(require,module,exports){
"use strict";function OsGridRef(t,r){if(!(this instanceof OsGridRef))return new OsGridRef(t,r);this.easting=Number(t),this.northing=Number(r)}if("undefined"!=typeof module&&module.exports)var LatLon=require("./latlon-ellipsoidal.js");OsGridRef.latLonToOsGrid=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");t.datum!=LatLon.datum.OSGB36&&(t=t.convertDatum(LatLon.datum.OSGB36));var r=t.lat.toRadians(),e=t.lon.toRadians(),o=6377563.396,a=6356256.909,n=.9996012717,i=49..toRadians(),s=(-2).toRadians(),d=1-a*a/(o*o),h=(o-a)/(o+a),f=h*h*h,c=Math.cos(r),l=Math.sin(r),u=o*n/Math.sqrt(1-d*l*l),p=o*n*(1-d)/Math.pow(1-d*l*l,1.5),M=u/p-1,g=1.0016767257673973*(r-i),m=(3*h+3*h*h+21/8*f)*Math.sin(r-i)*Math.cos(r+i),w=(15/8*(h*h)+15/8*f)*Math.sin(2*(r-i))*Math.cos(2*(r+i)),v=35/24*f*Math.sin(3*(r-i))*Math.cos(3*(r+i)),L=a*n*(g-m+w-v),G=c*c*c,R=G*c*c,O=Math.tan(r)*Math.tan(r),N=O*O,S=L+-1e5,A=u/2*l*c,C=u/24*l*G*(5-O+9*M),b=u/720*l*R*(61-58*O+N),y=u*c,E=u/6*G*(u/p-O),I=u/120*R*(5-18*O+N+14*M-58*O*M),x=e-s,B=x*x,D=B*x,T=D*x,j=T*x,q=j*x,$=S+A*B+C*T+b*q,F=4e5+y*x+E*D+I*j;return $=Number($.toFixed(3)),F=Number(F.toFixed(3)),new OsGridRef(F,$)},OsGridRef.osGridToLatLon=function(t,r){if(!(t instanceof OsGridRef))throw new TypeError("gridref is not OsGridRef object");void 0===r&&(r=LatLon.datum.WGS84);var e=t.easting,o=t.northing,a=6377563.396,n=6356256.909,i=.9996012717,s=49..toRadians(),d=(-2).toRadians(),h=1-n*n/(a*a),f=(a-n)/(a+n),c=f*f*f,l=s,u=0;do{l=(o- -1e5-u)/(a*i)+l;u=n*i*(1.0016767257673973*(l-s)-(3*f+3*f*f+21/8*c)*Math.sin(l-s)*Math.cos(l+s)+(15/8*(f*f)+15/8*c)*Math.sin(2*(l-s))*Math.cos(2*(l+s))-35/24*c*Math.sin(3*(l-s))*Math.cos(3*(l+s)))}while(o- -1e5-u>=1e-5);var p=Math.cos(l),M=Math.sin(l),g=a*i/Math.sqrt(1-h*M*M),m=a*i*(1-h)/Math.pow(1-h*M*M,1.5),w=g/m-1,v=Math.tan(l),L=v*v,G=L*L,R=G*L,O=1/p,N=g*g*g,S=N*g*g,A=S*g*g,C=v/(2*m*g),b=v/(24*m*N)*(5+3*L+w-9*L*w),y=v/(720*m*S)*(61+90*L+45*G),E=O/g,I=O/(6*N)*(g/m+2*L),x=O/(120*S)*(5+28*L+24*G),B=O/(5040*A)*(61+662*L+1320*G+720*R),D=e-4e5,T=D*D,j=T*D,q=T*T,$=j*T,F=q*T,U=$*T;l=l-C*T+b*q-y*F;var W=d+E*D-I*j+x*$-B*U,Z=new LatLon(l.toDegrees(),W.toDegrees(),LatLon.datum.OSGB36);return r!=LatLon.datum.OSGB36&&(Z=Z.convertDatum(r)),Z},OsGridRef.parse=function(t){t=String(t).trim();var r=t.match(/^(\d+),\s*(\d+)$/);if(r)return new OsGridRef(r[1],r[2]);if(!(r=t.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference");var e=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),o=t.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);e>7&&e--,o>7&&o--;var a=(e-2)%5*5+o%5,n=19-5*Math.floor(e/5)-Math.floor(o/5),i=t.slice(2).trim().split(/\s+/);if(1==i.length&&(i=[i[0].slice(0,i[0].length/2),i[0].slice(i[0].length/2)]),a<0||a>6||n<0||n>12)throw new Error("Invalid grid reference");if(2!=i.length)throw new Error("Invalid grid reference");if(i[0].length!=i[1].length)throw new Error("Invalid grid reference");return i[0]=(i[0]+"00000").slice(0,5),i[1]=(i[1]+"00000").slice(0,5),new OsGridRef(a+i[0],n+i[1])},OsGridRef.prototype.toString=function(t){if(t=void 0===t?10:Number(t),isNaN(t))throw new Error("Invalid precision");var r=this.easting,e=this.northing;if(isNaN(r)||isNaN(e))throw new Error("Invalid grid reference");if(0==t)return r.pad(6)+","+e.pad(6);var o=Math.floor(r/1e5),a=Math.floor(e/1e5);if(o<0||o>6||a<0||a>12)return"";var n=19-a-(19-a)%5+Math.floor((o+10)/5),i=5*(19-a)%25+o%5;n>7&&n++,i>7&&i++;var s=String.fromCharCode(n+"A".charCodeAt(0),i+"A".charCodeAt(0));return r=Math.floor(r%1e5/Math.pow(10,5-t/2)),e=Math.floor(e%1e5/Math.pow(10,5-t/2)),s+" "+r.pad(t/2)+" "+e.pad(t/2)},void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),void 0===Number.prototype.pad&&(Number.prototype.pad=function(t){for(var r=this.toString();r.length<t;)r="0"+r;return r}),"undefined"!=typeof module&&module.exports&&(module.exports=OsGridRef);
},{"./latlon-ellipsoidal.js":109}],116:[function(require,module,exports){
"use strict";function Utm(t,a,h,i,n,s,o){if(!(this instanceof Utm))return new Utm(t,a,h,i,n,s,o);if(void 0===n&&(n=LatLon.datum.WGS84),void 0===s&&(s=null),void 0===o&&(o=null),!(1<=t&&t<=60))throw new Error("Invalid UTM zone "+t);if(!a.match(/[NS]/i))throw new Error("Invalid UTM hemisphere "+a);this.zone=Number(t),this.hemisphere=a.toUpperCase(),this.easting=Number(h),this.northing=Number(i),this.datum=n,this.convergence=null===s?null:Number(s),this.scale=null===o?null:Number(o)}if("undefined"!=typeof module&&module.exports)var LatLon=require("./latlon-ellipsoidal.js");LatLon.prototype.toUtm=function(){if(isNaN(this.lat)||isNaN(this.lon))throw new Error("Invalid point");if(!(-80<this.lat&&this.lat<84))throw new Error("Outside UTM limits ("+this.lat+","+this.lon+")");var t=Math.floor((this.lon+180)/6)+1,a=(6*(t-1)-180+3).toRadians(),h="CDEFGHJKLMNPQRSTUVWXX",i=h.charAt(Math.floor(this.lat/8+10));31==t&&"V"==i&&this.lon>=3&&(t++,a+=6..toRadians()),32==t&&"X"==i&&this.lon<9&&(t--,a-=6..toRadians()),32==t&&"X"==i&&this.lon>=9&&(t++,a+=6..toRadians()),34==t&&"X"==i&&this.lon<21&&(t--,a-=6..toRadians()),34==t&&"X"==i&&this.lon>=21&&(t++,a+=6..toRadians()),36==t&&"X"==i&&this.lon<33&&(t--,a-=6..toRadians()),36==t&&"X"==i&&this.lon>=33&&(t++,a+=6..toRadians());for(var n=this.lat.toRadians(),s=this.lon.toRadians()-a,o=this.datum.ellipsoid.a,r=this.datum.ellipsoid.f,e=Math.sqrt(r*(2-r)),M=r/(2-r),l=M*M,u=M*l,d=M*u,m=M*d,c=M*m,p=Math.cos(s),f=Math.sin(s),v=Math.tan(s),N=Math.tan(n),q=Math.sinh(e*Math.atanh(e*N/Math.sqrt(1+N*N))),x=N*Math.sqrt(1+q*q)-q*Math.sqrt(1+N*N),g=Math.atan2(x,p),w=Math.asinh(f/Math.sqrt(x*x+p*p)),U=o/(1+M)*(1+.25*l+1/64*d+1/256*c),b=[null,.5*M-2/3*l+5/16*u+41/180*d-127/288*m+7891/37800*c,13/48*l-.6*u+557/1440*d+281/630*m-1983433/1935360*c,61/240*u-103/140*d+15061/26880*m+167603/181440*c,49561/161280*d-179/168*m+6601661/7257600*c,34729/80640*m-3418889/1995840*c,.6650675310896665*c],L=g,R=1;R<=6;R++)L+=b[R]*Math.sin(2*R*g)*Math.cosh(2*R*w);for(var S=w,R=1;R<=6;R++)S+=b[R]*Math.cos(2*R*g)*Math.sinh(2*R*w);for(var F=.9996*U*S,E=.9996*U*L,X=1,R=1;R<=6;R++)X+=2*R*b[R]*Math.cos(2*R*g)*Math.cosh(2*R*w);for(var y=0,R=1;R<=6;R++)y+=2*R*b[R]*Math.sin(2*R*g)*Math.sinh(2*R*w);var z=Math.atan(x/Math.sqrt(1+x*x)*v),D=Math.atan2(y,X),I=z+D,T=Math.sin(n),G=Math.sqrt(1-e*e*T*T)*Math.sqrt(1+N*N)/Math.sqrt(x*x+p*p),W=U/o*Math.sqrt(X*X+y*y),C=.9996*G*W;F+=5e5,E<0&&(E+=1e7),F=Number(F.toFixed(6)),E=Number(E.toFixed(6));var V=Number(I.toDegrees().toFixed(9)),j=Number(C.toFixed(12));return new Utm(t,this.lat>=0?"N":"S",F,E,this.datum,V,j)},Utm.prototype.toLatLonE=function(){var t=this.zone,a=this.hemisphere,h=this.easting,i=this.northing;if(isNaN(t)||isNaN(h)||isNaN(i))throw new Error("Invalid coordinate");var n=this.datum.ellipsoid.a,s=this.datum.ellipsoid.f;h-=5e5,i="S"==a?i-1e7:i;for(var o=Math.sqrt(s*(2-s)),r=s/(2-s),e=r*r,M=r*e,l=r*M,u=r*l,d=r*u,m=n/(1+r)*(1+.25*e+1/64*l+1/256*d),c=h/(.9996*m),p=i/(.9996*m),f=[null,.5*r-2/3*e+37/96*M-1/360*l-81/512*u+96199/604800*d,1/48*e+1/15*M-437/1440*l+46/105*u-1118711/3870720*d,17/480*M-37/840*l-209/4480*u+5569/90720*d,4397/161280*l-11/504*u-830251/7257600*d,4583/161280*u-108847/3991680*d,.03233083094085698*d],v=p,N=1;N<=6;N++)v-=f[N]*Math.sin(2*N*p)*Math.cosh(2*N*c);for(var q=c,N=1;N<=6;N++)q-=f[N]*Math.cos(2*N*p)*Math.sinh(2*N*c);var x=Math.sinh(q),g=Math.sin(v),w=Math.cos(v),U=g/Math.sqrt(x*x+w*w),b=U;do{var L=Math.sinh(o*Math.atanh(o*b/Math.sqrt(1+b*b))),R=b*Math.sqrt(1+L*L)-L*Math.sqrt(1+b*b),S=(U-R)/Math.sqrt(1+R*R)*(1+(1-o*o)*b*b)/((1-o*o)*Math.sqrt(1+b*b));b+=S}while(Math.abs(S)>1e-12);for(var F=b,E=Math.atan(F),X=Math.atan2(x,w),y=1,N=1;N<=6;N++)y-=2*N*f[N]*Math.cos(2*N*p)*Math.cosh(2*N*c);for(var z=0,N=1;N<=6;N++)z+=2*N*f[N]*Math.sin(2*N*p)*Math.sinh(2*N*c);var D=Math.atan(Math.tan(v)*Math.tanh(q)),I=Math.atan2(z,y),T=D+I,G=Math.sin(E),W=Math.sqrt(1-o*o*G*G)*Math.sqrt(1+F*F)*Math.sqrt(x*x+w*w),C=m/n/Math.sqrt(y*y+z*z),V=.9996*W*C;X+=(6*(t-1)-180+3).toRadians();var j=Number(E.toDegrees().toFixed(11)),A=Number(X.toDegrees().toFixed(11)),H=Number(T.toDegrees().toFixed(9)),J=Number(V.toFixed(12)),K=new LatLon(j,A,this.datum);return K.convergence=H,K.scale=J,K},Utm.parse=function(t,a){if(void 0===a&&(a=LatLon.datum.WGS84),null==(t=t.trim().match(/\S+/g))||4!=t.length)throw new Error("Invalid UTM coordinate "+t+"");return new Utm(t[0],t[1],t[2],t[3],a)},Utm.prototype.toString=function(t){t=Number(t||0);var a=this.zone<10?"0"+this.zone:this.zone,h=this.hemisphere,i=this.easting,n=this.northing;return isNaN(a)||!h.match(/[NS]/)||isNaN(i)||isNaN(n)?"":a+" "+h+" "+i.toFixed(t)+" "+n.toFixed(t)},void 0===Math.sinh&&(Math.sinh=function(t){return(Math.exp(t)-Math.exp(-t))/2}),void 0===Math.cosh&&(Math.cosh=function(t){return(Math.exp(t)+Math.exp(-t))/2}),void 0===Math.tanh&&(Math.tanh=function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}),void 0===Math.asinh&&(Math.asinh=function(t){return Math.log(t+Math.sqrt(1+t*t))}),void 0===Math.atanh&&(Math.atanh=function(t){return Math.log((1+t)/(1-t))/2}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),"undefined"!=typeof module&&module.exports&&(module.exports=Utm);
},{"./latlon-ellipsoidal.js":109}],117:[function(require,module,exports){
"use strict";function Vector3d(t,o,e){if(!(this instanceof Vector3d))return new Vector3d(t,o,e);this.x=Number(t),this.y=Number(o),this.z=Number(e)}Vector3d.prototype.plus=function(t){if(!(t instanceof Vector3d))throw new TypeError("v is not Vector3d object");return new Vector3d(this.x+t.x,this.y+t.y,this.z+t.z)},Vector3d.prototype.minus=function(t){if(!(t instanceof Vector3d))throw new TypeError("v is not Vector3d object");return new Vector3d(this.x-t.x,this.y-t.y,this.z-t.z)},Vector3d.prototype.times=function(t){return t=Number(t),new Vector3d(this.x*t,this.y*t,this.z*t)},Vector3d.prototype.dividedBy=function(t){return t=Number(t),new Vector3d(this.x/t,this.y/t,this.z/t)},Vector3d.prototype.dot=function(t){if(!(t instanceof Vector3d))throw new TypeError("v is not Vector3d object");return this.x*t.x+this.y*t.y+this.z*t.z},Vector3d.prototype.cross=function(t){if(!(t instanceof Vector3d))throw new TypeError("v is not Vector3d object");return new Vector3d(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},Vector3d.prototype.negate=function(){return new Vector3d(-this.x,-this.y,-this.z)},Vector3d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector3d.prototype.unit=function(){var t=this.length();return 1==t?this:0==t?this:new Vector3d(this.x/t,this.y/t,this.z/t)},Vector3d.prototype.angleTo=function(t,o){if(!(t instanceof Vector3d))throw new TypeError("v is not Vector3d object");var e=this.cross(t).length(),r=this.dot(t);if(void 0!==o){if(!(o instanceof Vector3d))throw new TypeError("vSign is not Vector3d object");e=this.cross(t).dot(o)<0?-e:e}return Math.atan2(e,r)},Vector3d.prototype.rotateAround=function(t,o){if(!(t instanceof Vector3d))throw new TypeError("axis is not Vector3d object");for(var e=this.unit(),r=[e.x,e.y,e.z],i=t.unit(),n=Math.sin(o),s=Math.cos(o),c=[[i.x*i.x*(1-s)+s,i.x*i.y*(1-s)-i.z*n,i.x*i.z*(1-s)+i.y*n],[i.y*i.x*(1-s)+i.z*n,i.y*i.y*(1-s)+s,i.y*i.z*(1-s)-i.x*n],[i.z*i.x*(1-s)-i.y*n,i.z*i.y*(1-s)+i.x*n,i.z*i.z*(1-s)+s]],h=[0,0,0],d=0;d<3;d++)for(var y=0;y<3;y++)h[d]+=c[d][y]*r[y];return new Vector3d(h[0],h[1],h[2])},Vector3d.prototype.toString=function(t){var o=void 0===t?3:Number(t);return"["+this.x.toFixed(o)+","+this.y.toFixed(o)+","+this.z.toFixed(o)+"]"},"undefined"!=typeof module&&module.exports&&(module.exports=Vector3d);
},{}],118:[function(require,module,exports){
function geometry(r){if("Polygon"===r.type)return polygonArea(r.coordinates);if("MultiPolygon"===r.type){for(var e=0,n=0;n<r.coordinates.length;n++)e+=polygonArea(r.coordinates[n]);return e}return null}function polygonArea(r){var e=0;if(r&&r.length>0){e+=Math.abs(ringArea(r[0]));for(var n=1;n<r.length;n++)e-=Math.abs(ringArea(r[n]))}return e}function ringArea(r){var e=0;if(r.length>2){for(var n,t,o=0;o<r.length-1;o++)n=r[o],t=r[o+1],e+=rad(t[0]-n[0])*(2+Math.sin(rad(n[1]))+Math.sin(rad(t[1])));e=e*wgs84.RADIUS*wgs84.RADIUS/2}return e}function rad(r){return r*Math.PI/180}var wgs84=require("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea;
},{"wgs84":198}],119:[function(require,module,exports){
function intersect(r,e,a,n){if(equalArrays(r,a)||equalArrays(r,n)||equalArrays(e,a)||equalArrays(n,a))return null;var t=r[0],u=r[1],i=e[0],o=e[1],f=a[0],l=a[1],s=n[0],v=n[1],h=(t-i)*(l-v)-(u-o)*(f-s);return 0==h?null:[((t*o-u*i)*(f-s)-(t-i)*(f*v-l*s))/h,((t*o-u*i)*(l-v)-(u-o)*(f*v-l*s))/h]}function equalArrays(r,e){if(!r||!e)return!1;if(r.length!=e.length)return!1;for(var a=0,n=r.length;a<n;a++)if(r[a]instanceof Array&&e[a]instanceof Array){if(!equalArrays(r[a],e[a]))return!1}else if(r[a]!=e[a])return!1;return!0}var rbush=require("rbush");module.exports=function(r,e,a){function n(r,a,n,t){var f=u[r][a],l=u[r][a+1],s=u[n][t],v=u[n][t+1],h=intersect(f,l,s,v);if(null!=h){if(l[0]!=f[0])var g=(h[0]-f[0])/(l[0]-f[0]);else var g=(h[1]-f[1])/(l[1]-f[1]);if(v[0]!=s[0])var y=(h[0]-s[0])/(v[0]-s[0]);else var y=(h[1]-s[1])/(v[1]-s[1]);if(!(g>=1||g<=0||y>=1||y<=0)){var c=h,m=!o[c];m&&(o[c]=!0),e?i.push(e(h,r,a,f,l,g,n,t,s,v,y,m)):i.push(h)}}}function t(r,e){var a=u[r][e],n=u[r][e+1];if(a[0]<n[0])var t=a[0],i=n[0];else var t=n[0],i=a[0];if(a[1]<n[1])var o=a[1],f=n[1];else var o=n[1],f=a[1];return{minX:t,minY:o,maxX:i,maxY:f,ring:r,edge:e}}if("Polygon"!=r.geometry.type)throw new Error("The input feature must be a Polygon");void 0==a&&(a=1);var u=r.geometry.coordinates,i=[],o={};if(a){for(var f=[],l=0;l<u.length;l++)for(var s=0;s<u[l].length-1;s++)f.push(t(l,s));var v=rbush();v.load(f)}for(var l=0;l<u.length;l++)for(var s=0;s<u[l].length-1;s++)if(a){var h=v.search(t(l,s));h.forEach(function(r){var e=r.ring,a=r.edge;n(l,s,e,a)})}else for(var g=0;g<u.length;g++)for(var y=0;y<u[g].length-1;y++)n(l,s,g,y);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i};
},{"rbush":163}],120:[function(require,module,exports){
function position(n){return n?coordInBBBOX(n):[lon(),lat()]}function vertexToCoordinate(n){return function(o,t){return[o[0]+n[0],o[1]+n[1]]}}function rnd(){return Math.random()-.5}function lon(){return 360*rnd()}function lat(){return 180*rnd()}function point(n){return{type:"Point",coordinates:n||[lon(),lat()]}}function coordInBBBOX(n){return[Math.random()*(n[2]-n[0])+n[0],Math.random()*(n[3]-n[1])+n[1]]}function pointInBBBOX(){return{type:"Point",coordinates:[lon(),lat()]}}function polygon(n){return{type:"Polygon",coordinates:n}}function feature(n){return{type:"Feature",geometry:n,properties:{}}}function collection(n){return{type:"FeatureCollection",features:n}}module.exports=function(){throw new Error("call .point() or .polygon() instead")},module.exports.position=position,module.exports.point=function(n,o){var t=[];for(i=0;i<n;i++)t.push(feature(o?point(position(o)):point()));return collection(t)},module.exports.polygon=function(n,o,t,r){function e(n,o,t){t[o]=o>0?n+t[o-1]:n}function u(n,o){n=2*n*Math.PI/c[c.length-1];var r=Math.random();p.push([r*t*Math.sin(n),r*t*Math.cos(n)])}"number"!=typeof o&&(o=10),"number"!=typeof t&&(t=10);var a=[];for(i=0;i<n;i++){var p=[],c=Array.apply(null,new Array(o+1)).map(Math.random);c.forEach(e),c.forEach(u),p[p.length-1]=p[0],p=p.map(vertexToCoordinate(position(r))),a.push(feature(polygon([p])))}return collection(a)};
},{}],121:[function(require,module,exports){
var turfBBox=require("@turf/bbox"),featureCollection=require("@turf/helpers").featureCollection,featureEach=require("@turf/meta").featureEach,bboxPolygon=require("@turf/bbox-polygon"),rbush=require("rbush");module.exports=function(r){var o=rbush(r);return o.insert=function(r){if(Array.isArray(r)){const o=r;r=bboxPolygon(o),r.bbox=o}else r.bbox=r.bbox?r.bbox:turfBBox(r);return rbush.prototype.insert.call(this,r)},o.load=function(r){var o=[];return Array.isArray(r)?r.forEach(function(r){const t=bboxPolygon(r);t.bbox=r,o.push(t)}):featureEach(r,function(r){r.bbox=r.bbox?r.bbox:turfBBox(r),o.push(r)}),rbush.prototype.load.call(this,o)},o.remove=function(r){if(Array.isArray(r)){const o=r;r=bboxPolygon(o),r.bbox=o}return rbush.prototype.remove.call(this,r)},o.clear=function(){return rbush.prototype.clear.call(this)},o.search=function(r){var o=rbush.prototype.search.call(this,this.toBBox(r));return featureCollection(o)},o.collides=function(r){return rbush.prototype.collides.call(this,this.toBBox(r))},o.all=function(){var r=rbush.prototype.all.call(this);return featureCollection(r)},o.toJSON=function(){return rbush.prototype.toJSON.call(this)},o.fromJSON=function(r){return rbush.prototype.fromJSON.call(this,r)},o.toBBox=function(r){var o;return o=r.bbox?r.bbox:Array.isArray(r)&&4===r.length?r:turfBBox(r),{minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]}},o};
},{"@turf/bbox":122,"@turf/bbox-polygon":9,"@turf/helpers":123,"@turf/meta":124,"rbush":163}],122:[function(require,module,exports){
arguments[4][41][0].apply(exports,arguments)
},{"@turf/meta":124,"dup":41}],123:[function(require,module,exports){
arguments[4][43][0].apply(exports,arguments)
},{"dup":43}],124:[function(require,module,exports){
arguments[4][46][0].apply(exports,arguments)
},{"dup":46}],125:[function(require,module,exports){
function rewind(r,e){switch(r&&r.type||null){case"FeatureCollection":return r.features=r.features.map(curryOuter(rewind,e)),r;case"Feature":return r.geometry=rewind(r.geometry,e),r;case"Polygon":case"MultiPolygon":return correct(r,e);default:return r}}function curryOuter(r,e){return function(n){return r(n,e)}}function correct(r,e){return"Polygon"===r.type?r.coordinates=correctRings(r.coordinates,e):"MultiPolygon"===r.type&&(r.coordinates=r.coordinates.map(curryOuter(correctRings,e))),r}function correctRings(r,e){e=!!e,r[0]=wind(r[0],!e);for(var n=1;n<r.length;n++)r[n]=wind(r[n],e);return r}function wind(r,e){return cw(r)===e?r:r.reverse()}function cw(r){return geojsonArea.ring(r)>=0}var geojsonArea=require("geojson-area");module.exports=rewind;
},{"geojson-area":118}],126:[function(require,module,exports){
!function(){function t(t){for(var n=[],o=[],r=0;r<t[0].length;r++)n.push(t[0][r][1]),o.push(t[0][r][0]);return n=n.sort(function(t,n){return t-n}),o=o.sort(function(t,n){return t-n}),[[n[0],o[0]],[n[n.length-1],o[o.length-1]]]}function n(t,n,o){for(var r=[[0,0]],a=0;a<o.length;a++){for(var e=0;e<o[a].length;e++)r.push(o[a][e]);r.push(o[a][0]),r.push([0,0])}for(var i=!1,a=0,e=r.length-1;a<r.length;e=a++)r[a][0]>n!=r[e][0]>n&&t<(r[e][1]-r[a][1])*(n-r[a][0])/(r[e][0]-r[a][0])+r[a][1]&&(i=!i);return i}var o=this.gju={};"undefined"!=typeof module&&module.exports&&(module.exports=o),o.lineStringsIntersect=function(t,n){for(var o=[],r=0;r<=t.coordinates.length-2;++r)for(var a=0;a<=n.coordinates.length-2;++a){var e={x:t.coordinates[r][1],y:t.coordinates[r][0]},i={x:t.coordinates[r+1][1],y:t.coordinates[r+1][0]},s={x:n.coordinates[a][1],y:n.coordinates[a][0]},u={x:n.coordinates[a+1][1],y:n.coordinates[a+1][0]},c=(u.x-s.x)*(e.y-s.y)-(u.y-s.y)*(e.x-s.x),h=(i.x-e.x)*(e.y-s.y)-(i.y-e.y)*(e.x-s.x),d=(u.y-s.y)*(i.x-e.x)-(u.x-s.x)*(i.y-e.y);if(0!=d){var l=c/d,y=h/d;0<=l&&l<=1&&0<=y&&y<=1&&o.push({type:"Point",coordinates:[e.x+l*(i.x-e.x),e.y+l*(i.y-e.y)]})}}return 0==o.length&&(o=!1),o},o.pointInBoundingBox=function(t,n){return!(t.coordinates[1]<n[0][0]||t.coordinates[1]>n[1][0]||t.coordinates[0]<n[0][1]||t.coordinates[0]>n[1][1])},o.pointInPolygon=function(r,a){for(var e="Polygon"==a.type?[a.coordinates]:a.coordinates,i=!1,s=0;s<e.length;s++)o.pointInBoundingBox(r,t(e[s]))&&(i=!0);if(!i)return!1;for(var u=!1,s=0;s<e.length;s++)n(r.coordinates[1],r.coordinates[0],e[s])&&(u=!0);return u},o.pointInMultiPolygon=function(r,a){for(var e="MultiPolygon"==a.type?[a.coordinates]:a.coordinates,i=!1,s=!1,u=0;u<e.length;u++){for(var c=e[u],h=0;h<c.length;h++)i||o.pointInBoundingBox(r,t(c[h]))&&(i=!0);if(!i)return!1;for(var h=0;h<c.length;h++)s||n(r.coordinates[1],r.coordinates[0],c[h])&&(s=!0)}return s},o.numberToRadius=function(t){return t*Math.PI/180},o.numberToDegree=function(t){return 180*t/Math.PI},o.drawCircle=function(t,n,r){for(var a=[n.coordinates[1],n.coordinates[0]],e=t/1e3/6371,i=[o.numberToRadius(a[0]),o.numberToRadius(a[1])],r=r||15,s=[[a[0],a[1]]],u=0;u<r;u++){var c=2*Math.PI*u/r,h=Math.asin(Math.sin(i[0])*Math.cos(e)+Math.cos(i[0])*Math.sin(e)*Math.cos(c)),d=i[1]+Math.atan2(Math.sin(c)*Math.sin(e)*Math.cos(i[0]),Math.cos(e)-Math.sin(i[0])*Math.sin(h));s[u]=[],s[u][1]=o.numberToDegree(h),s[u][0]=o.numberToDegree(d)}return{type:"Polygon",coordinates:[s]}},o.rectangleCentroid=function(t){var n=t.coordinates[0],o=n[0][0],r=n[0][1];return{type:"Point",coordinates:[o+(n[2][0]-o)/2,r+(n[2][1]-r)/2]}},o.pointDistance=function(t,n){var r=t.coordinates[0],a=t.coordinates[1],e=n.coordinates[0],i=n.coordinates[1],s=o.numberToRadius(i-a),u=o.numberToRadius(e-r),c=Math.pow(Math.sin(s/2),2)+Math.cos(o.numberToRadius(a))*Math.cos(o.numberToRadius(i))*Math.pow(Math.sin(u/2),2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371*1e3},o.geometryWithinRadius=function(t,n,r){if("Point"==t.type)return o.pointDistance(t,n)<=r;if("LineString"==t.type||"Polygon"==t.type){var a,e={};a="Polygon"==t.type?t.coordinates[0]:t.coordinates;for(var i in a)if(e.coordinates=a[i],o.pointDistance(e,n)>r)return!1}return!0},o.area=function(t){for(var n,o,r=0,a=t.coordinates[0],e=a.length-1,i=0;i<a.length;e=i++){var n={x:a[i][1],y:a[i][0]},o={x:a[e][1],y:a[e][0]};r+=n.x*o.y,r-=n.y*o.x}return r/=2},o.centroid=function(t){for(var n,r,a,e=0,i=0,s=t.coordinates[0],u=s.length-1,c=0;c<s.length;u=c++){var r={x:s[c][1],y:s[c][0]},a={x:s[u][1],y:s[u][0]};n=r.x*a.y-a.x*r.y,e+=(r.x+a.x)*n,i+=(r.y+a.y)*n}return n=6*o.area(t),{type:"Point",coordinates:[i/n,e/n]}},o.simplify=function(t,n){n=n||20,t=t.map(function(t){return{lng:t.coordinates[0],lat:t.coordinates[1]}});var o,r,a,e,i,s,u,c,h,d,l,y,M,f,g,p,x,v,m,P=Math.PI/180*.5,b=new Array,T=new Array,I=new Array;if(t.length<3)return t;for(o=t.length,d=360*n/(2*Math.PI*6378137),d*=d,a=0,T[0]=0,I[0]=o-1,r=1;r>0;)if(e=T[r-1],i=I[r-1],r--,i-e>1){for(l=t[i].lng()-t[e].lng(),y=t[i].lat()-t[e].lat(),Math.abs(l)>180&&(l=360-Math.abs(l)),l*=Math.cos(P*(t[i].lat()+t[e].lat())),M=l*l+y*y,s=e+1,u=e,h=-1;s<i;s++)f=t[s].lng()-t[e].lng(),g=t[s].lat()-t[e].lat(),Math.abs(f)>180&&(f=360-Math.abs(f)),f*=Math.cos(P*(t[s].lat()+t[e].lat())),p=f*f+g*g,x=t[s].lng()-t[i].lng(),v=t[s].lat()-t[i].lat(),Math.abs(x)>180&&(x=360-Math.abs(x)),x*=Math.cos(P*(t[s].lat()+t[i].lat())),m=x*x+v*v,(c=p>=M+m?m:m>=M+p?p:(f*y-g*l)*(f*y-g*l)/M)>h&&(u=s,h=c);h<d?(b[a]=e,a++):(r++,T[r-1]=u,I[r-1]=i,r++,T[r-1]=e,I[r-1]=u)}else b[a]=e,a++;b[a]=o-1,a++;for(var R=new Array,s=0;s<a;s++)R.push(t[b[s]]);return R.map(function(t){return{type:"Point",coordinates:[t.lng,t.lat]}})},o.destinationPoint=function(t,n,r){r/=6371,n=o.numberToRadius(n);var a=o.numberToRadius(t.coordinates[0]),e=o.numberToRadius(t.coordinates[1]),i=Math.asin(Math.sin(e)*Math.cos(r)+Math.cos(e)*Math.sin(r)*Math.cos(n)),s=a+Math.atan2(Math.sin(n)*Math.sin(r)*Math.cos(e),Math.cos(r)-Math.sin(e)*Math.sin(i));return s=(s+3*Math.PI)%(2*Math.PI)-Math.PI,{type:"Point",coordinates:[o.numberToDegree(s),o.numberToDegree(i)]}}}();
},{}],127:[function(require,module,exports){
"use strict";function clip(e,r,t,n,u,i,l,s){if(t/=r,n/=r,l>=t&&s<=n)return e;if(l>n||s<t)return null;for(var h=[],p=0;p<e.length;p++){var a,c,o=e[p],f=o.geometry,g=o.type;if(a=o.min[u],c=o.max[u],a>=t&&c<=n)h.push(o);else if(!(a>n||c<t)){var v=1===g?clipPoints(f,t,n,u):clipGeometry(f,t,n,u,i,3===g);v.length&&h.push(createFeature(o.tags,g,v,o.id))}}return h.length?h:null}function clipPoints(e,r,t,n){for(var u=[],i=0;i<e.length;i++){var l=e[i],s=l[n];s>=r&&s<=t&&u.push(l)}return u}function clipGeometry(e,r,t,n,u,i){for(var l=[],s=0;s<e.length;s++){var h,p,a,c=0,o=0,f=null,g=e[s],v=g.area,m=g.dist,w=g.outer,S=g.length,d=[];for(p=0;p<S-1;p++)h=f||g[p],f=g[p+1],c=o||h[n],o=f[n],c<r?o>t?(d.push(u(h,f,r),u(h,f,t)),i||(d=newSlice(l,d,v,m,w))):o>=r&&d.push(u(h,f,r)):c>t?o<r?(d.push(u(h,f,t),u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o<=t&&d.push(u(h,f,t)):(d.push(h),o<r?(d.push(u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o>t&&(d.push(u(h,f,t)),i||(d=newSlice(l,d,v,m,w))));h=g[S-1],c=h[n],c>=r&&c<=t&&d.push(h),a=d[d.length-1],i&&a&&(d[0][0]!==a[0]||d[0][1]!==a[1])&&d.push(d[0]),newSlice(l,d,v,m,w)}return l}function newSlice(e,r,t,n,u){return r.length&&(r.area=t,r.dist=n,void 0!==u&&(r.outer=u),e.push(r)),[]}module.exports=clip;var createFeature=require("./feature");
},{"./feature":129}],128:[function(require,module,exports){
"use strict";function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)convertFeature(r,e.features[o],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){if(null!==t.geometry){var o,a,i,n,u=t.geometry,c=u.type,l=u.coordinates,s=t.properties,p=t.id;if("Point"===c)e.push(createFeature(s,1,[projectPoint(l)],p));else if("MultiPoint"===c)e.push(createFeature(s,1,project(l),p));else if("LineString"===c)e.push(createFeature(s,2,[project(l,r)],p));else if("MultiLineString"===c||"Polygon"===c){for(i=[],o=0;o<l.length;o++)n=project(l[o],r),"Polygon"===c&&(n.outer=0===o),i.push(n);e.push(createFeature(s,"Polygon"===c?3:2,i,p))}else if("MultiPolygon"===c){for(i=[],o=0;o<l.length;o++)for(a=0;a<l[o].length;a++)n=project(l[o][a],r),n.outer=0===a,i.push(n);e.push(createFeature(s,3,i,p))}else{if("GeometryCollection"!==c)throw new Error("Input data is not a valid GeoJSON object.");for(o=0;o<u.geometries.length;o++)convertFeature(e,{geometry:u.geometries[o],properties:s},r)}}}function project(e,t){for(var r=[],o=0;o<e.length;o++)r.push(projectPoint(e[o]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return o=o<0?0:o>1?1:o,[r,o,0]}function calcSize(e){for(var t,r,o=0,a=0,i=0;i<e.length-1;i++)t=r||e[i],r=e[i+1],o+=t[0]*r[1]-r[0]*t[1],a+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(o/2),e.dist=a}module.exports=convert;var simplify=require("./simplify"),createFeature=require("./feature");
},{"./feature":129,"./simplify":131}],129:[function(require,module,exports){
"use strict";function createFeature(e,t,a,n){var r={id:n||null,type:t,geometry:a,tags:e||null,min:[1/0,1/0],max:[-(1/0),-(1/0)]};return calcBBox(r),r}function calcBBox(e){var t=e.geometry,a=e.min,n=e.max;if(1===e.type)calcRingBBox(a,n,t);else for(var r=0;r<t.length;r++)calcRingBBox(a,n,t[r]);return e}function calcRingBBox(e,t,a){for(var n,r=0;r<a.length;r++)n=a[r],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1])}module.exports=createFeature;
},{}],130:[function(require,module,exports){
"use strict";function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var i=t.debug;i&&console.time("preprocess data");var o=1<<t.maxZoom,n=convert(e,t.tolerance/(o*t.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=wrap(n,t.buffer/t.extent,intersectX),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,i){return 32*((1<<e)*i+t)+e}function intersectX(e,t,i){return[i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function intersectY(e,t,i){return[(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i,1]}function extend(e,t){for(var i in t)e[i]=t[i];return e}function isClippedSquare(e,t,i){var o=e.source;if(1!==o.length)return!1;var n=o[0];if(3!==n.type||n.geometry.length>1)return!1;var r=n.geometry[0].length;if(5!==r)return!1;for(var s=0;s<r;s++){var l=transform.point(n.geometry[0][s],t,e.z2,e.x,e.y);if(l[0]!==-i&&l[0]!==t+i||l[1]!==-i&&l[1]!==t+i)return!1}return!0}module.exports=geojsonvt;var convert=require("./convert"),transform=require("./transform"),clip=require("./clip"),wrap=require("./wrap"),createTile=require("./tile");GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,i,o,n,r,s){for(var l=[e,t,i,o],a=this.options,u=a.debug,c=null;l.length;){o=l.pop(),i=l.pop(),t=l.pop(),e=l.pop();var p=1<<t,d=toID(t,i,o),m=this.tiles[d],f=t===a.maxZoom?0:a.tolerance/(p*a.extent);if(!m&&(u>1&&console.time("creation"),m=this.tiles[d]=createTile(e,p,i,o,f,t===a.maxZoom),this.tileCoords.push({z:t,x:i,y:o}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,o,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var h="z"+t;this.stats[h]=(this.stats[h]||0)+1,this.total++}if(m.source=e,n){if(t===a.maxZoom||t===n)continue;var x=1<<n-t;if(i!==Math.floor(r/x)||o!==Math.floor(s/x))continue}else if(t===a.indexMaxZoom||m.numPoints<=a.indexMaxPoints)continue;if(a.solidChildren||!isClippedSquare(m,a.extent,a.buffer)){m.source=null,u>1&&console.time("clipping");var g,v,M,T,b,y,S=.5*a.buffer/a.extent,Z=.5-S,q=.5+S,w=1+S;g=v=M=T=null,b=clip(e,p,i-S,i+q,0,intersectX,m.min[0],m.max[0]),y=clip(e,p,i+Z,i+w,0,intersectX,m.min[0],m.max[0]),b&&(g=clip(b,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),v=clip(b,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),y&&(M=clip(y,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),T=clip(y,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),u>1&&console.timeEnd("clipping"),e.length&&(l.push(g||[],t+1,2*i,2*o),l.push(v||[],t+1,2*i,2*o+1),l.push(M||[],t+1,2*i+1,2*o),l.push(T||[],t+1,2*i+1,2*o+1))}else n&&(c=t)}return c},GeoJSONVT.prototype.getTile=function(e,t,i){var o=this.options,n=o.extent,r=o.debug,s=1<<e;t=(t%s+s)%s;var l=toID(e,t,i);if(this.tiles[l])return transform.tile(this.tiles[l],n);r>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var a,u=e,c=t,p=i;!a&&u>0;)u--,c=Math.floor(c/2),p=Math.floor(p/2),a=this.tiles[toID(u,c,p)];if(!a||!a.source)return null;if(r>1&&console.log("found parent tile z%d-%d-%d",u,c,p),isClippedSquare(a,n,o.buffer))return transform.tile(a,n);r>1&&console.time("drilling down");var d=this.splitTile(a.source,u,c,p,e,t,i);if(r>1&&console.timeEnd("drilling down"),null!==d){var m=1<<e-d;l=toID(d,Math.floor(t/m),Math.floor(i/m))}return this.tiles[l]?transform.tile(this.tiles[l],n):null};
},{"./clip":127,"./convert":128,"./tile":132,"./transform":133,"./wrap":134}],131:[function(require,module,exports){
"use strict";function simplify(t,i){var e,p,r,s,o=i*i,f=t.length,u=0,n=f-1,g=[];for(t[u][2]=1,t[n][2]=1;n;){for(p=0,e=u+1;e<n;e++)(r=getSqSegDist(t[e],t[u],t[n]))>p&&(s=e,p=r);p>o?(t[s][2]=p,g.push(u),g.push(s),u=s):(n=g.pop(),u=g.pop())}}function getSqSegDist(t,i,e){var p=i[0],r=i[1],s=e[0],o=e[1],f=t[0],u=t[1],n=s-p,g=o-r;if(0!==n||0!==g){var l=((f-p)*n+(u-r)*g)/(n*n+g*g);l>1?(p=s,r=o):l>0&&(p+=n*l,r+=g*l)}return n=f-p,g=u-r,n*n+g*g}module.exports=simplify;
},{}],132:[function(require,module,exports){
"use strict";function createTile(e,n,r,i,t,u){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z2:n,transformed:!1,min:[2,1],max:[-1,0]},m=0;m<e.length;m++){a.numFeatures++,addFeature(a,e[m],t,u);var s=e[m].min,l=e[m].max;s[0]<a.min[0]&&(a.min[0]=s[0]),s[1]<a.min[1]&&(a.min[1]=s[1]),l[0]>a.max[0]&&(a.max[0]=l[0]),l[1]>a.max[1]&&(a.max[1]=l[1])}return a}function addFeature(e,n,r,i){var t,u,a,m,s=n.geometry,l=n.type,o=[],f=r*r;if(1===l)for(t=0;t<s.length;t++)o.push(s[t]),e.numPoints++,e.numSimplified++;else for(t=0;t<s.length;t++)if(a=s[t],i||!(2===l&&a.dist<r||3===l&&a.area<f)){var d=[];for(u=0;u<a.length;u++)m=a[u],(i||m[2]>f)&&(d.push(m),e.numSimplified++),e.numPoints++;3===l&&rewind(d,a.outer),o.push(d)}else e.numPoints+=a.length;if(o.length){var g={geometry:o,type:l,tags:n.tags||null};null!==n.id&&(g.id=n.id),e.features.push(g)}}function rewind(e,n){signedArea(e)<0===n&&e.reverse()}function signedArea(e){for(var n,r,i=0,t=0,u=e.length,a=u-1;t<u;a=t++)n=e[t],r=e[a],i+=(r[0]-n[0])*(n[1]+r[1]);return i}module.exports=createTile;
},{}],133:[function(require,module,exports){
"use strict";function transformTile(r,t){if(r.transformed)return r;var n,e,o,f=r.z2,a=r.x,s=r.y;for(n=0;n<r.features.length;n++){var i=r.features[n],u=i.geometry;if(1===i.type)for(e=0;e<u.length;e++)u[e]=transformPoint(u[e],t,f,a,s);else for(e=0;e<u.length;e++){var m=u[e];for(o=0;o<m.length;o++)m[o]=transformPoint(m[o],t,f,a,s)}}return r.transformed=!0,r}function transformPoint(r,t,n,e,o){return[Math.round(t*(r[0]*n-e)),Math.round(t*(r[1]*n-o))]}exports.tile=transformTile,exports.point=transformPoint;
},{}],134:[function(require,module,exports){
"use strict";function wrap(r,e,t){var o=r,a=clip(r,1,-1-e,e,0,t,-1,2),s=clip(r,1,1-e,2+e,0,t,-1,2);return(a||s)&&(o=clip(r,1,-e,1+e,0,t,-1,2)||[],a&&(o=shiftFeatureCoords(a,1).concat(o)),s&&(o=o.concat(shiftFeatureCoords(s,-1)))),o}function shiftFeatureCoords(r,e){for(var t=[],o=0;o<r.length;o++){var a,s=r[o],i=s.type;if(1===i)a=shiftCoords(s.geometry,e);else{a=[];for(var u=0;u<s.geometry.length;u++)a.push(shiftCoords(s.geometry[u],e))}t.push(createFeature(s.tags,i,a,s.id))}return t}function shiftCoords(r,e){var t=[];t.area=r.area,t.dist=r.dist;for(var o=0;o<r.length;o++)t.push([r[o][0]+e,r[o][1],r[o][2]]);return t}var clip=require("./clip"),createFeature=require("./feature");module.exports=wrap;
},{"./clip":127,"./feature":129}],135:[function(require,module,exports){
"use strict";function _getClosest(r,t,e){var n,o;if(!Array.isArray(t))throw new Error("Get closest expects an array as second argument");return t.forEach(function(t,u){var s=e(t,r);s>=0&&(void 0===o||s<o)&&(o=s,n=u)}),n}module.exports={number:function(r,t){return _getClosest(r,t,function(r,t){return Math.abs(r-t)})},greaterNumber:function(r,t){return _getClosest(r,t,function(r,t){return r-t})},lowerNumber:function(r,t){return _getClosest(r,t,function(r,t){return t-r})},custom:function(r,t,e){return _getClosest(r,t,e)}};
},{}],136:[function(require,module,exports){
"use strict";function GridIndex(t,r,e){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],r=i[1],e=i[2],this.d=r+2*e;for(var h=0;h<this.d*this.d;h++){var n=i[NUM_PARAMS+h],o=i[NUM_PARAMS+h+1];s.push(n===o?null:i.subarray(n,o))}var l=i[NUM_PARAMS+s.length],a=i[NUM_PARAMS+s.length+1];this.keys=i.subarray(l,a),this.bboxes=i.subarray(a),this.insert=this._insertReadonly}else{this.d=r+2*e;for(var d=0;d<this.d*this.d;d++)s.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=e,this.scale=r/t,this.uid=0;var f=e/r*t;this.min=-f,this.max=t+f}module.exports=GridIndex;var NUM_PARAMS=3;GridIndex.prototype.insert=function(t,r,e,s,i){this._forEachCell(r,e,s,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(i)},GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},GridIndex.prototype._insertCell=function(t,r,e,s,i,h){this.cells[i].push(h)},GridIndex.prototype.query=function(t,r,e,s){var i=this.min,h=this.max;if(t<=i&&r<=i&&h<=e&&h<=s)return Array.prototype.slice.call(this.keys);var n=[],o={};return this._forEachCell(t,r,e,s,this._queryCell,n,o),n},GridIndex.prototype._queryCell=function(t,r,e,s,i,h,n){var o=this.cells[i];if(null!==o)for(var l=this.keys,a=this.bboxes,d=0;d<o.length;d++){var f=o[d];if(void 0===n[f]){var u=4*f;t<=a[u+2]&&r<=a[u+3]&&e>=a[u+0]&&s>=a[u+1]?(n[f]=!0,h.push(l[f])):n[f]=!1}}},GridIndex.prototype._forEachCell=function(t,r,e,s,i,h,n){for(var o=this._convertToCellCoord(t),l=this._convertToCellCoord(r),a=this._convertToCellCoord(e),d=this._convertToCellCoord(s),f=o;f<=a;f++)for(var u=l;u<=d;u++){var y=this.d*u+f;if(i.call(this,t,r,e,s,y,h,n))return}},GridIndex.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,r=NUM_PARAMS+this.cells.length+1+1,e=0,s=0;s<this.cells.length;s++)e+=this.cells[s].length;var i=new Int32Array(r+e+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var h=r,n=0;n<t.length;n++){var o=t[n];i[NUM_PARAMS+n]=h,i.set(o,h),h+=o.length}return i[NUM_PARAMS+t.length]=h,i.set(this.keys,h),h+=this.keys.length,i[NUM_PARAMS+t.length+1]=h,i.set(this.bboxes,h),h+=this.bboxes.length,i.buffer};
},{}],137:[function(require,module,exports){
function sortPointsByLatLng(t,r){var o={};return featureEach(t,function(t){var r=getCoords(t)[1];o[r]||(o[r]=[]),o[r].push(t)}),Object.keys(o).map(function(t){return o[t].sort(function(t,r){return getCoords(t)[0]-getCoords(r)[0]})}).sort(function(t,o){return r?getCoords(t[0])[1]-getCoords(o[0])[1]:getCoords(o[0])[1]-getCoords(t[0])[1]})}var invariant=require("@turf/invariant"),getCoords=invariant.getCoords,featureEach=require("@turf/meta").featureEach;module.exports=function(t,r,o){invariant.collectionOf(t,"Point","input must contain Points"),r=r||"elevation";for(var e=sortPointsByLatLng(t,o),n=[],a=0;a<e.length;a++){for(var i=e[a],s=[],u=0;u<i.length;u++){var f=i[u];f.properties[r]?s.push(f.properties[r]):s.push(0)}n.push(s)}return n};
},{"@turf/invariant":38,"@turf/meta":63}],138:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],139:[function(require,module,exports){
"use strict";function compareInt(e,t){return e-t}function Simplex(e,t,r){this.vertices=e,this.adjacent=t,this.boundary=r,this.lastVisited=-1}function GlueFacet(e,t,r){this.vertices=e,this.cell=t,this.index=r}function compareGlue(e,t){return compareCell(e.vertices,t.vertices)}function bakeOrient(e){for(var t=["function orient(){var tuple=this.tuple;return test("],r=0;r<=e;++r)r>0&&t.push(","),t.push("tuple[",r,"]");t.push(")}return orient");var i=new Function("test",t.join("")),n=orient[e+1];return n||(n=orient),i(n)}function Triangulation(e,t,r){this.dimension=e,this.vertices=t,this.simplices=r,this.interior=r.filter(function(e){return!e.boundary}),this.tuple=new Array(e+1);for(var i=0;i<=e;++i)this.tuple[i]=this.vertices[i];var n=BAKED[e];n||(n=BAKED[e]=bakeOrient(e)),this.orient=n}function incrementalConvexHull(e,t){var r=e.length;if(0===r)throw new Error("Must have at least d+1 points");var i=e[0].length;if(r<=i)throw new Error("Must input at least d+1 points");var n=e.slice(0,i+1),a=orient.apply(void 0,n);if(0===a)throw new Error("Input not in general position");for(var s=new Array(i+1),o=0;o<=i;++o)s[o]=o;a<0&&(s[0]=1,s[1]=0);for(var l=new Simplex(s,new Array(i+1),!1),v=l.adjacent,c=new Array(i+2),o=0;o<=i;++o){for(var h=s.slice(),u=0;u<=i;++u)u===o&&(h[u]=-1);var d=h[0];h[0]=h[1],h[1]=d;var f=new Simplex(h,new Array(i+1),!0);v[o]=f,c[o]=f}c[i+1]=l;for(var o=0;o<=i;++o)for(var h=v[o].vertices,p=v[o].adjacent,u=0;u<=i;++u){var m=h[u];if(m<0)p[u]=l;else for(var y=0;y<=i;++y)v[y].vertices.indexOf(m)<0&&(p[u]=v[y])}for(var w=new Triangulation(i,n,c),x=!!t,o=i+1;o<r;++o)w.insert(e[o],x);return w.boundary()}module.exports=incrementalConvexHull;var orient=require("robust-orientation"),compareCell=require("simplicial-complex").compareCells;Simplex.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=t};var BAKED=[],proto=Triangulation.prototype;proto.handleBoundaryDegeneracy=function(e,t){var r=this.dimension,i=this.vertices.length-1,n=this.tuple,a=this.vertices,s=[e];for(e.lastVisited=-i;s.length>0;){e=s.pop();for(var o=(e.vertices,e.adjacent),l=0;l<=r;++l){var v=o[l];if(v.boundary&&!(v.lastVisited<=-i)){for(var c=v.vertices,h=0;h<=r;++h){var u=c[h];n[h]=u<0?t:a[u]}var d=this.orient();if(d>0)return v;v.lastVisited=-i,0===d&&s.push(v)}}}return null},proto.walk=function(e,t){var r=this.vertices.length-1,i=this.dimension,n=this.vertices,a=this.tuple,s=t?this.interior.length*Math.random()|0:this.interior.length-1,o=this.interior[s];e:for(;!o.boundary;){for(var l=o.vertices,v=o.adjacent,c=0;c<=i;++c)a[c]=n[l[c]];o.lastVisited=r;for(var c=0;c<=i;++c){var h=v[c];if(!(h.lastVisited>=r)){var u=a[c];a[c]=e;var d=this.orient();if(a[c]=u,d<0){o=h;continue e}h.boundary?h.lastVisited=-r:h.lastVisited=r}}return}return o},proto.addPeaks=function(e,t){var r=this.vertices.length-1,i=this.dimension,n=this.vertices,a=this.tuple,s=this.interior,o=this.simplices,l=[t];t.lastVisited=r,t.vertices[t.vertices.indexOf(-1)]=r,t.boundary=!1,s.push(t);for(var v=[];l.length>0;){var t=l.pop(),c=t.vertices,h=t.adjacent,u=c.indexOf(r);if(!(u<0))for(var d=0;d<=i;++d)if(d!==u){var f=h[d];if(f.boundary&&!(f.lastVisited>=r)){var p=f.vertices;if(f.lastVisited!==-r){for(var m=0,y=0;y<=i;++y)p[y]<0?(m=y,a[y]=e):a[y]=n[p[y]];var w=this.orient();if(w>0){p[m]=r,f.boundary=!1,s.push(f),l.push(f),f.lastVisited=r;continue}f.lastVisited=-r}var x=f.adjacent,g=c.slice(),b=h.slice(),j=new Simplex(g,b,!0);o.push(j);var V=x.indexOf(t);if(!(V<0)){x[V]=j,b[u]=f,g[d]=-1,b[d]=t,h[d]=j,j.flip();for(var y=0;y<=i;++y){var A=g[y];if(!(A<0||A===r)){for(var k=new Array(i-1),E=0,O=0;O<=i;++O){var B=g[O];B<0||O===y||(k[E++]=B)}v.push(new GlueFacet(k,j,y))}}}}}}v.sort(compareGlue);for(var d=0;d+1<v.length;d+=2){var C=v[d],D=v[d+1],S=C.index,G=D.index;S<0||G<0||(C.cell.adjacent[C.index]=D.cell,D.cell.adjacent[D.index]=C.cell)}},proto.insert=function(e,t){var r=this.vertices;r.push(e);var i=this.walk(e,t);if(i){for(var n=this.dimension,a=this.tuple,s=0;s<=n;++s){var o=i.vertices[s];a[s]=o<0?e:r[o]}var l=this.orient(a);l<0||(0!==l||(i=this.handleBoundaryDegeneracy(i,e)))&&this.addPeaks(e,i)}},proto.boundary=function(){for(var e=this.dimension,t=[],r=this.simplices,i=r.length,n=0;n<i;++n){var a=r[n];if(a.boundary){for(var s=new Array(e),o=a.vertices,l=0,v=0,c=0;c<=e;++c)o[c]>=0?s[l++]=o[c]:v=1&c;if(v===(1&e)){var h=s[0];s[0]=s[1],s[1]=h}t.push(s)}}return t};
},{"robust-orientation":164,"simplicial-complex":178}],140:[function(require,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.jsts=t.jsts||{})}(this,function(t){"use strict";function e(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function n(){}function i(){}function r(){}function s(){}function o(){}function a(){}function u(){}function l(t){this.message=t}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function c(){if(0===arguments.length)l.call(this);else if(1===arguments.length){var t=arguments[0];l.call(this,t)}}function f(){}function g(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)g.call(this,0,0);else if(1===arguments.length){var t=arguments[0];g.call(this,t.x,t.y,t.z)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];g.call(this,e,n,g.NULL_ORDINATE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this.x=i,this.y=r,this.z=s}}function d(){if(this.dimensionsToTest=2,0===arguments.length)d.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new i("only 2 or 3 dimensions may be specified");this.dimensionsToTest=t}}function p(){}function m(){}function v(t){this.message=t||""}function y(){}function x(t){this.message=t||""}function E(t){this.message=t||""}function I(){this.array_=[],arguments[0]instanceof m&&this.addAll(arguments[0])}function N(){if(I.apply(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.ensureCapacity(e.length),this.add(e,n)}}function C(){if(this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof g){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof C){var e=arguments[0];this.init(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];this.init(r,s,o,a)}}function S(){}function w(){S.call(this,"Projective point not representable on the Cartesian plane.")}function L(){}function R(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1}function T(){}function P(t){this.str=t}function b(t){this.value=t}function O(){}function _(){if(this.hi=0,this.lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof _){var e=arguments[0];this.init(e)}else if("string"==typeof arguments[0]){var n=arguments[0];_.call(this,_.parse(n))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i,r)}}function M(){}function D(){}function A(){}function F(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];this.x=e,this.y=n,this.w=1}else if(arguments[0]instanceof F&&arguments[1]instanceof F){var i=arguments[0],r=arguments[1];this.x=i.y*r.w-r.y*i.w,this.y=r.x*i.w-i.x*r.w,this.w=i.x*r.y-r.x*i.y}else if(arguments[0]instanceof g&&arguments[1]instanceof g){var s=arguments[0],o=arguments[1];this.x=s.y-o.y,this.y=o.x-s.x,this.w=s.x*o.y-o.x*s.y}}else if(3===arguments.length){var a=arguments[0],u=arguments[1],l=arguments[2];this.x=a,this.y=u,this.w=l}else if(4===arguments.length){var h=arguments[0],c=arguments[1],f=arguments[2],d=arguments[3],p=h.y-c.y,m=c.x-h.x,v=h.x*c.y-c.x*h.y,y=f.y-d.y,x=d.x-f.x,E=f.x*d.y-d.x*f.y;this.x=m*E-x*v,this.y=y*v-p*E,this.w=p*x-y*m}}function G(){}function q(){}function B(){this.envelope=null,this.factory=null,this.SRID=null,this.userData=null;var t=arguments[0];this.factory=t,this.SRID=t.getSRID()}function z(){}function V(){}function k(){}function Y(){}function U(){}function X(){}function H(){}function W(){}function j(){}function K(){}function Z(){}function Q(){}function J(){this.array_=[],arguments[0]instanceof m&&this.addAll(arguments[0])}function $(t){return null==t?Js:t.color}function tt(t){return null==t?null:t.parent}function et(t,e){null!==t&&(t.color=e)}function nt(t){return null==t?null:t.left}function it(t){return null==t?null:t.right}function rt(){this.root_=null,this.size_=0}function st(){}function ot(){}function at(){this.array_=[],arguments[0]instanceof m&&this.addAll(arguments[0])}function ut(){}function lt(){}function ht(){}function ct(){}function ft(){this.geometries=null;var t=arguments[0],e=arguments[1];if(B.call(this,e),null===t&&(t=[]),B.hasNullElements(t))throw new i("geometries must not contain null elements");this.geometries=t}function gt(){var t=arguments[0],e=arguments[1];ft.call(this,t,e)}function dt(){if(this.geom=null,this.geomFact=null,this.bnRule=null,this.endpointMap=null,1===arguments.length){var t=arguments[0];dt.call(this,t,V.MOD2_BOUNDARY_RULE)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.geom=e,this.geomFact=e.getFactory(),this.bnRule=n}}function pt(){this.count=null}function mt(){}function vt(){}function yt(){}function xt(){}function Et(){}function It(){}function Nt(){}function Ct(){}function St(){this.points=null;var t=arguments[0],e=arguments[1];B.call(this,e),this.init(t)}function wt(){}function Lt(){this.coordinates=null;var t=arguments[0],e=arguments[1];B.call(this,e),this.init(t)}function Rt(){}function Tt(){this.shell=null,this.holes=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(B.call(this,n),null===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),B.hasNullElements(e))throw new i("holes must not contain null elements");if(t.isEmpty()&&B.hasNonEmptyElements(e))throw new i("shell is empty but holes are not");this.shell=t,this.holes=e}function Pt(){var t=arguments[0],e=arguments[1];ft.call(this,t,e)}function bt(){if(arguments[0]instanceof g&&arguments[1]instanceof ne){var t=arguments[0],e=arguments[1];bt.call(this,e.getCoordinateSequenceFactory().create(t),e)}else if(R(arguments[0],D)&&arguments[1]instanceof ne){var n=arguments[0],i=arguments[1];St.call(this,n,i),this.validateConstruction()}}function Ot(){var t=arguments[0],e=arguments[1];ft.call(this,t,e)}function _t(){if(this.factory=null,this.isUserDataCopied=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.factory=t}}function Mt(){}function Dt(){}function At(){}function Ft(){}function Gt(){if(this.dimension=3,this.coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];Gt.call(this,t,3)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.coordinates=new Array(e).fill(null);for(var n=0;e>n;n++)this.coordinates[n]=new g}else if(R(arguments[0],D)){var i=arguments[0];if(null===i)return this.coordinates=new Array(0).fill(null),null;this.dimension=i.getDimension(),this.coordinates=new Array(i.size()).fill(null);for(var n=0;n<this.coordinates.length;n++)this.coordinates[n]=i.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var r=arguments[0],s=arguments[1];this.coordinates=r,this.dimension=s,null===r&&(this.coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];this.coordinates=new Array(o).fill(null),this.dimension=a;for(var n=0;o>n;n++)this.coordinates[n]=new g}}function qt(){}function Bt(t,e){return t===e||t!==t&&e!==e}function zt(t){this.add?t.forEach(this.add,this):t.forEach(function(t){this.set(t[0],t[1])},this)}function Vt(t){return this.has(t)&&(this._keys.splice(to,1),this._values.splice(to,1),this._itp.forEach(function(t){to<t[0]&&t[0]--})),to>-1}function kt(t){return this.has(t)?this._values[to]:void 0}function Yt(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!==e||0===e)for(to=t.length;to--&&!Bt(t[to],e););else to=t.indexOf(e);return to>-1}function Ut(t){return Yt.call(this,this._keys,t)}function Xt(t,e){return this.has(t)?this._values[to]=e:this._values[this._keys.push(t)-1]=e,this}function Ht(){(this._keys||0).length=this._values.length=0}function Wt(){return Zt(this._itp,this._keys)}function jt(){return Zt(this._itp,this._values)}function Kt(){return Zt(this._itp,this._keys,this._values)}function Zt(t,e,n){var i=[0],r=!1;return t.push(i),{next:function(){var s,o=i[0];return!r&&o<e.length?(s=n?[e[o],n[o]]:e[o],i[0]++):(r=!0,t.splice(t.indexOf(i),1)),{done:r,value:s}}}}function Qt(){return this._values.length}function Jt(t,e){for(var n=this.entries();;){var i=n.next();if(i.done)break;t.call(e,i.value[1],i.value[0],this)}}function $t(){this.map_=new io}function te(){if(this.modelType=null,this.scale=null,0===arguments.length)this.modelType=te.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof ee){var t=arguments[0];this.modelType=t,t===te.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var e=arguments[0];this.modelType=te.FIXED,this.setScale(e)}else if(arguments[0]instanceof te){var n=arguments[0];this.modelType=n.modelType,this.scale=n.scale}}function ee(){this.name=null;var t=arguments[0];this.name=t,ee.nameToTypeMap.put(t,this)}function ne(){if(this.precisionModel=null,this.coordinateSequenceFactory=null,this.SRID=null,0===arguments.length)ne.call(this,new te,0);else if(1===arguments.length){if(R(arguments[0],G)){var t=arguments[0];ne.call(this,new te,0,t)}else if(arguments[0]instanceof te){var e=arguments[0];ne.call(this,e,0,ne.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];ne.call(this,n,i,ne.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.precisionModel=r,this.coordinateSequenceFactory=o,this.SRID=s}}function ie(t){this.geometryFactory=t||new ne}function re(t){this.parser=new ie(t)}function se(){this.result=null,this.inputLines=Array(2).fill().map(function(){return Array(2)}),this.intPt=new Array(2).fill(null),this.intLineIndex=null,this._isProper=null,this.pa=null,this.pb=null,this.precisionModel=null,this.intPt[0]=new g,this.intPt[1]=new g,this.pa=this.intPt[0],this.pb=this.intPt[1],this.result=0}function oe(){se.apply(this)}function ae(){}function ue(){this.p=null,this.crossingCount=0,this.isPointOnSegment=!1;var t=arguments[0];this.p=t}function le(){}function he(){if(this.p0=null,this.p1=null,0===arguments.length)he.call(this,new g,new g);else if(1===arguments.length){var t=arguments[0];he.call(this,t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0=e,this.p1=n}else if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];he.call(this,new g(i,r),new g(s,o))}}function ce(){if(this.matrix=null,0===arguments.length)this.matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(lt.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];ce.call(this),this.set(t)}else if(arguments[0]instanceof ce){var e=arguments[0];ce.call(this),this.matrix[L.INTERIOR][L.INTERIOR]=e.matrix[L.INTERIOR][L.INTERIOR],this.matrix[L.INTERIOR][L.BOUNDARY]=e.matrix[L.INTERIOR][L.BOUNDARY],this.matrix[L.INTERIOR][L.EXTERIOR]=e.matrix[L.INTERIOR][L.EXTERIOR],this.matrix[L.BOUNDARY][L.INTERIOR]=e.matrix[L.BOUNDARY][L.INTERIOR],this.matrix[L.BOUNDARY][L.BOUNDARY]=e.matrix[L.BOUNDARY][L.BOUNDARY],this.matrix[L.BOUNDARY][L.EXTERIOR]=e.matrix[L.BOUNDARY][L.EXTERIOR],this.matrix[L.EXTERIOR][L.INTERIOR]=e.matrix[L.EXTERIOR][L.INTERIOR],this.matrix[L.EXTERIOR][L.BOUNDARY]=e.matrix[L.EXTERIOR][L.BOUNDARY],this.matrix[L.EXTERIOR][L.EXTERIOR]=e.matrix[L.EXTERIOR][L.EXTERIOR]}}function fe(){this.areaBasePt=null,this.triangleCent3=new g,this.areasum2=0,this.cg3=new g,this.lineCentSum=new g,this.totalLength=0,this.ptCount=0,this.ptCentSum=new g;var t=arguments[0];this.areaBasePt=null,this.add(t)}function ge(t){this.message=t||""}function de(){this.array_=[]}function pe(){this.treeSet=new at,this.list=new I}function me(){if(this.geomFactory=null,this.inputPts=null,1===arguments.length){var t=arguments[0];me.call(this,me.extractCoordinates(t),t.getFactory())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.inputPts=pe.filterCoordinates(e),this.geomFactory=n}}function ve(){this.origin=null;var t=arguments[0];this.origin=t}function ye(){this.inputGeom=null,this.factory=null,this.pruneEmptyGeometry=!0,this.preserveGeometryCollectionType=!0,this.preserveCollections=!1,this.preserveType=!1}function xe(){if(this.snapTolerance=0,this.srcPts=null,this.seg=new he,this.allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof St&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];xe.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.srcPts=n,this._isClosed=xe.isClosed(n),this.snapTolerance=i}}function Ee(){this.srcGeom=null;var t=arguments[0];this.srcGeom=t}function Ie(){if(ye.apply(this),this.snapTolerance=null,this.snapPts=null,this.isSelfSnap=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this.snapTolerance=t,this.snapPts=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.snapTolerance=n,this.snapPts=i,this.isSelfSnap=r}}function Ne(){this.isFirst=!0,this.commonMantissaBitsCount=53,this.commonBits=0,this.commonSignExp=null}function Ce(){this.commonCoord=null,this.ccFilter=new Se}function Se(){this.commonBitsX=new Ne,this.commonBitsY=new Ne}function we(){this.trans=null;var t=arguments[0];this.trans=t}function Le(){this.parent=null,this.atStart=null,this.max=null,this.index=null,this.subcollectionIterator=null;var t=arguments[0];this.parent=t,this.atStart=!0,this.index=0,this.max=t.getNumGeometries()}function Re(){if(this.boundaryRule=V.OGC_SFS_BOUNDARY_RULE,this.isIn=null,this.numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new i("Rule must be non-null");this.boundaryRule=t}}function Te(){}function Pe(){}function be(){this.pts=null,this.data=null;var t=arguments[0],e=arguments[1];this.pts=t,this.data=e}function Oe(){}function _e(){this.bounds=null,this.item=null;var t=arguments[0],e=arguments[1];this.bounds=t,this.item=e}function Me(){this._size=null,this.items=null,this._size=0,this.items=new I,this.items.add(null)}function De(){}function Ae(){}function Fe(){if(this.childBoundables=new I,this.bounds=null,this.level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.level=t}}function Ge(){this.boundable1=null,this.boundable2=null,this._distance=null,this.itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.boundable1=t,this.boundable2=e,this.itemDistance=n,this._distance=this.distance()}function qe(){if(this.root=null,this.built=!1,this.itemBoundables=new I,this.nodeCapacity=null,0===arguments.length)qe.call(this,qe.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];f.isTrue(t>1,"Node capacity must be greater than 1"),this.nodeCapacity=t}}function Be(){}function ze(){}function Ve(){if(0===arguments.length)Ve.call(this,Ve.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];qe.call(this,t)}}function ke(){var t=arguments[0];Fe.call(this,t)}function Ye(){}function Ue(){this.segString=null,this.coord=null,this.segmentIndex=null,this.segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.segString=t,this.coord=new g(e),this.segmentIndex=n,this.segmentOctant=i,this._isInterior=!e.equals2D(t.getCoordinate(n))}function Xe(){this.nodeMap=new rt,this.edge=null;var t=arguments[0];this.edge=t}function He(){this.nodeList=null,this.edge=null,this.nodeIt=null,this.currNode=null,this.nextNode=null,this.currSegIndex=0;var t=arguments[0];this.nodeList=t,this.edge=t.getEdge(),this.nodeIt=t.iterator(),this.readNextNode()}function We(){}function je(){this.nodeList=new Xe(this),this.pts=null,this.data=null;var t=arguments[0],e=arguments[1];this.pts=t,this.data=e}function Ke(){this.tempEnv1=new C,this.tempEnv2=new C,this.overlapSeg1=new he,this.overlapSeg2=new he}function Ze(){this.pts=null,this.start=null,this.end=null,this.env=null,this.context=null,this.id=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.pts=t,this.start=e,this.end=n,this.context=i}function Qe(){}function Je(){}function $e(){}function tn(){if(this.segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}}function en(){if(this.monoChains=new I,this.index=new Ve,this.idCounter=0,this.nodedSegStrings=null,this.nOverlaps=0,0===arguments.length);else if(1===arguments.length){var t=arguments[0];tn.call(this,t)}}function nn(){Ke.apply(this),this.si=null;var t=arguments[0];this.si=t}function rn(){if(this.pt=null,1===arguments.length){var t=arguments[0];l.call(this,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];l.call(this,rn.msgWithCoord(e,n)),this.pt=new g(n)}}function sn(){}function on(){this.findAllIntersections=!1,this.isCheckEndSegmentsOnly=!1,this.li=null,this.interiorIntersection=null,this.intSegments=null,this.intersections=new I,this.intersectionCount=0,this.keepIntersections=!0;var t=arguments[0];this.li=t,this.interiorIntersection=null}function an(){this.li=new oe,this.segStrings=null,this.findAllIntersections=!1,this.segInt=null,this._isValid=!0;var t=arguments[0];this.segStrings=t}function un(){this.nv=null;var t=arguments[0];this.nv=new an(un.toSegmentStrings(t))}function ln(){this.mapOp=null;var t=arguments[0];this.mapOp=t}function hn(){}function cn(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.init(1),this.location[hn.ON]=e}else if(arguments[0]instanceof cn){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var i=0;i<this.location.length;i++)this.location[i]=n.location[i]}}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.init(3),this.location[hn.ON]=r,this.location[hn.LEFT]=s,this.location[hn.RIGHT]=o}}function fn(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new cn(t),this.elt[1]=new cn(t)}else if(arguments[0]instanceof fn){var e=arguments[0];this.elt[0]=new cn(e.elt[0]),this.elt[1]=new cn(e.elt[1])}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.elt[0]=new cn(L.NONE),this.elt[1]=new cn(L.NONE),this.elt[n].setLocation(i)}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.elt[0]=new cn(r,s,o),this.elt[1]=new cn(r,s,o)}else if(4===arguments.length){var a=arguments[0],u=arguments[1],l=arguments[2],h=arguments[3];this.elt[0]=new cn(L.NONE,L.NONE,L.NONE),this.elt[1]=new cn(L.NONE,L.NONE,L.NONE),this.elt[a].setLocations(u,l,h)}}function gn(){this.startDe=null,this.maxNodeDegree=-1,this.edges=new I,this.pts=new I,this.label=new fn(L.NONE),this.ring=null,this._isHole=null,this.shell=null,this.holes=new I,this.geometryFactory=null;var t=arguments[0],e=arguments[1];this.geometryFactory=e,this.computePoints(t),this.computeRing()}function dn(){var t=arguments[0],e=arguments[1];gn.call(this,t,e)}function pn(){var t=arguments[0],e=arguments[1];gn.call(this,t,e)}function mn(){if(this.label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.label=t}}function vn(){mn.apply(this),this.coord=null,this.edges=null;var t=arguments[0],e=arguments[1];this.coord=t,this.edges=e,this.label=new fn(0,L.NONE)}function yn(){this.nodeMap=new rt,this.nodeFact=null;var t=arguments[0];this.nodeFact=t}function xn(){if(this.edge=null,this.label=null,this.node=null,this.p0=null,this.p1=null,this.dx=null,this.dy=null,this.quadrant=null,1===arguments.length){var t=arguments[0];this.edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];xn.call(this,e,n,i,null)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];xn.call(this,r),this.init(s,o),this.label=a}}function En(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this.sym=null,this.next=null,this.nextMin=null,this.edgeRing=null,this.minEdgeRing=null,this.depth=[0,-999,-999];var t=arguments[0],e=arguments[1];if(xn.call(this,t),this._isForward=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var n=t.getNumPoints()-1;this.init(t.getCoordinate(n),t.getCoordinate(n-1))}this.computeDirectedLabel()}function In(){}function Nn(){if(this.edges=new I,this.nodes=null,this.edgeEndList=new I,0===arguments.length)this.nodes=new yn(new In);else if(1===arguments.length){var t=arguments[0];this.nodes=new yn(t)}}function Cn(){this.geometryFactory=null,this.shellList=new I;var t=arguments[0];this.geometryFactory=t}function Sn(){this.op=null,this.geometryFactory=null,this.ptLocator=null,this.lineEdgesList=new I,this.resultLineList=new I;var t=arguments[0],e=arguments[1],n=arguments[2];this.op=t,this.geometryFactory=e,this.ptLocator=n}function wn(){this.op=null,this.geometryFactory=null,this.resultPointList=new I;var t=arguments[0],e=arguments[1];arguments[2],this.op=t,this.geometryFactory=e}function Ln(){}function Rn(){this.geom=null;var t=arguments[0];this.geom=t}function Tn(){this.edgeMap=new rt,this.edgeList=null,this.ptInAreaLocation=[L.NONE,L.NONE]}function Pn(){Tn.apply(this),this.resultAreaEdgeList=null,this.label=null,this.SCANNING_FOR_INCOMING=1,this.LINKING_TO_OUTGOING=2}function bn(){In.apply(this)}function On(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e}function _n(){if(this.label=null,this.xValue=null,this.eventType=null,this.insertEvent=null,this.deleteEventIndex=null,this.obj=null,2===arguments.length){var t=arguments[0],e=arguments[1];this.eventType=_n.DELETE,this.xValue=t,this.insertEvent=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.eventType=_n.INSERT,this.label=n,this.xValue=i,this.obj=r}}function Mn(){}function Dn(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.properIntersectionPoint=null,this.li=null,this.includeProper=null,this.recordIsolated=null,this.isSelfIntersection=null,this.numIntersections=0,this.numTests=0,this.bdyNodes=null,this._isDone=!1,this.isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.li=t,this.includeProper=e,this.recordIsolated=n}function An(){Mn.apply(this),this.events=new I,this.nOverlaps=null}function Fn(){this.min=r.POSITIVE_INFINITY,this.max=r.NEGATIVE_INFINITY}function Gn(){}function qn(){Fn.apply(this),this.item=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.min=t,this.max=e,this.item=n}function Bn(){Fn.apply(this),this.node1=null,this.node2=null;var t=arguments[0],e=arguments[1];this.node1=t,this.node2=e,this.buildExtent(this.node1,this.node2)}function zn(){this.leaves=new I,this.root=null,this.level=0}function Vn(){if(this.lines=null,this.isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this.lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.lines=e,this.isForcedToLineString=n}}function kn(){this.items=new I}function Yn(){this.index=null;var t=arguments[0];if(!R(t,Rt))throw new i("Argument must be Polygonal");this.index=new Xn(t)}function Un(){this.counter=null;var t=arguments[0];this.counter=t}function Xn(){this.index=new zn;var t=arguments[0];this.init(t)}function Hn(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new g(t),this.segmentIndex=e,this.dist=n}function Wn(){this.nodeMap=new rt,this.edge=null;var t=arguments[0];this.edge=t}function jn(){}function Kn(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new C,this.env2=new C;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new jn;this.startIndex=e.getChainStartIndices(this.pts)}function Zn(){this.depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;2>t;t++)for(var e=0;3>e;e++)this.depth[t][e]=Zn.NULL_VALUE}function Qn(){if(mn.apply(this),this.pts=null,this.env=null,this.eiList=new Wn(this),this.name=null,this.mce=null,this._isIsolated=!0,this.depth=new Zn,this.depthDelta=0,1===arguments.length){var t=arguments[0];Qn.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.pts=e,this.label=n}}function Jn(){if(Nn.apply(this),this.parentGeom=null,this.lineEdgeMap=new $t,this.boundaryNodeRule=null,this.useBoundaryDeterminationRule=!0,this.argIndex=null,this.boundaryNodes=null,this._hasTooFewPoints=!1,this.invalidPoint=null,this.areaPtLocator=null,this.ptLocator=new Re,2===arguments.length){var t=arguments[0],e=arguments[1];Jn.call(this,t,e,V.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.argIndex=n,this.parentGeom=i,this.boundaryNodeRule=r,null!==i&&this.add(i)}}function $n(){if(this.li=new oe,this.resultPrecisionModel=null,this.arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this.arg=new Array(1).fill(null),this.arg[0]=new Jn(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];$n.call(this,e,n,V.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this.arg=new Array(2).fill(null),this.arg[0]=new Jn(0,i,s),this.arg[1]=new Jn(1,r,s)}}function ti(){this.pts=null,this._orientation=null;var t=arguments[0];this.pts=t,this._orientation=ti.orientation(t)}function ei(){this.edges=new I,this.ocaMap=new rt}function ni(){this.ptLocator=new Re,this.geomFact=null,this.resultGeom=null,this.graph=null,this.edgeList=new ei,this.resultPolyList=new I,this.resultLineList=new I,this.resultPointList=new I;var t=arguments[0],e=arguments[1];$n.call(this,t,e),this.graph=new Nn(new bn),this.geomFact=t.getFactory()}function ii(){this.geom=new Array(2).fill(null),this.snapTolerance=null,this.cbr=null;var t=arguments[0],e=arguments[1];this.geom[0]=t,this.geom[1]=e,this.computeSnapTolerance()}function ri(){this.geom=new Array(2).fill(null);var t=arguments[0],e=arguments[1];this.geom[0]=t,this.geom[1]=e}function si(){this.factory=null,this.interiorPoint=null,this.maxWidth=0;var t=arguments[0];this.factory=t.getFactory(),this.add(t)}function oi(){this.poly=null,this.centreY=null,this.hiY=r.MAX_VALUE,this.loY=-r.MAX_VALUE;var t=arguments[0];this.poly=t,this.hiY=t.getEnvelopeInternal().getMaxY(),this.loY=t.getEnvelopeInternal().getMinY(),this.centreY=si.avg(this.loY,this.hiY)}function ai(){this.centroid=null,this.minDistance=r.MAX_VALUE,this.interiorPoint=null;var t=arguments[0];this.centroid=t.getCentroid().getCoordinate(),this.addInterior(t),null===this.interiorPoint&&this.addEndpoints(t)}function ui(){this.centroid=null,this.minDistance=r.MAX_VALUE,this.interiorPoint=null;var t=arguments[0];this.centroid=t.getCentroid().getCoordinate(),this.add(t)}function li(){}function hi(){this.p0=null,this.p1=null,this.p2=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.p0=t,this.p1=e,this.p2=n}function ci(){this.input=null,this.extremalPts=null,this.centre=null,this.radius=0;var t=arguments[0];this.input=t}function fi(){if(this.inputGeom=null,this.isConvex=null,this.convexHullPts=null,this.minBaseSeg=new he,this.minWidthPt=null,this.minPtIndex=null,this.minWidth=0,1===arguments.length){var t=arguments[0];fi.call(this,t,!1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.inputGeom=e,this.isConvex=n}}function gi(){this.inputGeom=null,this.distanceTolerance=null;var t=arguments[0];this.inputGeom=t}function di(){ye.apply(this),this.distanceTolerance=null;var t=arguments[0];this.distanceTolerance=t}function pi(){this._orig=null,this._sym=null,this._next=null;var t=arguments[0];this._orig=t}function mi(){this._isMarked=!1;var t=arguments[0];pi.call(this,t)}function vi(){this.vertexMap=new $t}function yi(){this._isStart=!1;var t=arguments[0];mi.call(this,t)}function xi(){vi.apply(this)}function Ei(){this.result=null,this.factory=null,this.graph=null,this.lines=new I,this.nodeEdgeStack=new de,this.ringStartEdge=null,this.graph=new xi}function Ii(){this.items=new I,this.subnode=new Array(4).fill(null)}function Ni(){}function Ci(t,e){var n,i,r,s,o={32:{d:127,c:128,b:0,a:0},64:{d:32752,c:0,b:0,a:0}},a={32:8,64:11}[t];if(s||(n=0>e||0>1/e,isFinite(e)||(s=o[t],n&&(s.d+=1<<t/4-1),i=Math.pow(2,a)-1,r=0)),!s){for(i={32:127,64:1023}[t],r=Math.abs(e);r>=2;)i++,r/=2;for(;1>r&&i>0;)i--,r*=2;0>=i&&(r/=2),32===t&&i>254&&(s={d:n?255:127,c:128,b:0,a:0},i=Math.pow(2,a)-1,r=0)}return i}function Si(){this.pt=new g,this.level=0,this.env=null;var t=arguments[0];this.computeKey(t)}function wi(){Ii.apply(this),this.env=null,this.centrex=null,this.centrey=null,this.level=null;var t=arguments[0],e=arguments[1];this.env=t,this.level=e,this.centrex=(t.getMinX()+t.getMaxX())/2,this.centrey=(t.getMinY()+t.getMaxY())/2}function Li(){}function Ri(){Ii.apply(this)}function Ti(){this.root=null,this.minExtent=1,this.root=new Ri}function Pi(t){this.geometryFactory=t||new ne}function bi(t){this.geometryFactory=t||new ne,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Pi(this.geometryFactory)}function Oi(){this.parser=new Pi(this.geometryFactory)}function _i(t){this.geometryFactory=t||new ne,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ie(this.geometryFactory)}function Mi(t){return[t.x,t.y]}function Di(t){this.geometryFactory=t||new ne}function Ai(){if(this.noder=null,this.scaleFactor=null,this.offsetX=null,this.offsetY=null,this.isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];Ai.call(this,t,e,0,0)}else if(4===arguments.length){var n=arguments[0],i=arguments[1];arguments[2],arguments[3],this.noder=n,this.scaleFactor=i,this.isScaled=!this.isIntegerPrecision()}}function Fi(){if(this.inputGeom=null,this.isClosedEndpointsInInterior=!0,this.nonSimpleLocation=null,1===arguments.length){var t=arguments[0];this.inputGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.inputGeom=e,this.isClosedEndpointsInInterior=!n.isInBoundary(2)}}function Gi(){this.pt=null,this.isClosed=null,this.degree=null;var t=arguments[0];this.pt=t,this.isClosed=!1,this.degree=0}function qi(){if(this.quadrantSegments=qi.DEFAULT_QUADRANT_SEGMENTS,this.endCapStyle=qi.CAP_ROUND,this.joinStyle=qi.JOIN_ROUND,this.mitreLimit=qi.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this.simplifyFactor=qi.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(r),this.setJoinStyle(s),this.setMitreLimit(o)}}function Bi(){this.minIndex=-1,this.minCoord=null,this.minDe=null,this.orientedDe=null}function zi(){this.array_=[]}function Vi(){this.finder=null,this.dirEdgeList=new I,this.nodes=new I,this.rightMostCoord=null,this.env=null,this.finder=new Bi}function ki(){this.inputLine=null,this.distanceTol=null,this.isDeleted=null,this.angleOrientation=le.COUNTERCLOCKWISE;var t=arguments[0];this.inputLine=t}function Yi(){this.ptList=null,this.precisionModel=null,this.minimimVertexDistance=0,
this.ptList=new I}function Ui(){this.maxCurveSegmentError=0,this.filletAngleQuantum=null,this.closingSegLengthFactor=1,this.segList=null,this.distance=0,this.precisionModel=null,this.bufParams=null,this.li=null,this.s0=null,this.s1=null,this.s2=null,this.seg0=new he,this.seg1=new he,this.offset0=new he,this.offset1=new he,this.side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.precisionModel=t,this.bufParams=e,this.li=new oe,this.filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===qi.JOIN_ROUND&&(this.closingSegLengthFactor=Ui.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}function Xi(){this.distance=0,this.precisionModel=null,this.bufParams=null;var t=arguments[0],e=arguments[1];this.precisionModel=t,this.bufParams=e}function Hi(){this.subgraphs=null,this.seg=new he,this.cga=new le;var t=arguments[0];this.subgraphs=t}function Wi(){this.upwardSeg=null,this.leftDepth=null;var t=arguments[0],e=arguments[1];this.upwardSeg=new he(t),this.leftDepth=e}function ji(){this.inputGeom=null,this.distance=null,this.curveBuilder=null,this.curveList=new I;var t=arguments[0],e=arguments[1],n=arguments[2];this.inputGeom=t,this.distance=e,this.curveBuilder=n}function Ki(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.hasInterior=!1,this.properIntersectionPoint=null,this.li=null,this.isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this.li=t}function Zi(){this.bufParams=null,this.workingPrecisionModel=null,this.workingNoder=null,this.geomFact=null,this.graph=null,this.edgeList=new ei;var t=arguments[0];this.bufParams=t}function Qi(){this.li=new oe,this.segStrings=null;var t=arguments[0];this.segStrings=t}function Ji(){this.li=null,this.pt=null,this.originalPt=null,this.ptScaled=null,this.p0Scaled=null,this.p1Scaled=null,this.scaleFactor=null,this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,this.corner=new Array(4).fill(null),this.safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this.originalPt=t,this.pt=t,this.scaleFactor=e,this.li=n,0>=e)throw new i("Scale factor must be non-zero");1!==e&&(this.pt=new g(this.scale(t.x),this.scale(t.y)),this.p0Scaled=new g,this.p1Scaled=new g),this.initCorners(this.pt)}function $i(){this.tempEnv1=new C,this.selectedSegment=new he}function tr(){this.index=null;var t=arguments[0];this.index=t}function er(){$i.apply(this),this.hotPixel=null,this.parentEdge=null,this.hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.hotPixel=t,this.parentEdge=e,this.hotPixelVertexIndex=n}function nr(){this.li=null,this.interiorIntersections=null;var t=arguments[0];this.li=t,this.interiorIntersections=new I}function ir(){this.pm=null,this.li=null,this.scaleFactor=null,this.noder=null,this.pointSnapper=null,this.nodedSegStrings=null;var t=arguments[0];this.pm=t,this.li=new oe,this.li.setPrecisionModel(t),this.scaleFactor=t.getScale()}function rr(){if(this.argGeom=null,this.distance=null,this.bufParams=new qi,this.resultGeometry=null,this.saveException=null,1===arguments.length){var t=arguments[0];this.argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.argGeom=e,this.bufParams=n}}function sr(){this.comps=null;var t=arguments[0];this.comps=t}function or(){if(this.component=null,this.segIndex=null,this.pt=null,2===arguments.length){var t=arguments[0],e=arguments[1];or.call(this,t,or.INSIDE_AREA,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.component=n,this.segIndex=i,this.pt=r}}function ar(){this.pts=null;var t=arguments[0];this.pts=t}function ur(){this.locations=null;var t=arguments[0];this.locations=t}function lr(){if(this.geom=null,this.terminateDistance=0,this.ptLocator=new Re,this.minDistanceLocation=null,this.minDistance=r.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];lr.call(this,t,e,0)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],s=arguments[2];this.geom=new Array(2).fill(null),this.geom[0]=n,this.geom[1]=i,this.terminateDistance=s}}function hr(){this.factory=null,this.directedEdges=new I,this.coordinates=null;var t=arguments[0];this.factory=t}function cr(){this._isMarked=!1,this._isVisited=!1,this.data=null}function fr(){cr.apply(this),this.parentEdge=null,this.from=null,this.to=null,this.p0=null,this.p1=null,this.sym=null,this.edgeDirection=null,this.quadrant=null,this.angle=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.from=t,this.to=e,this.edgeDirection=i,this.p0=t.getCoordinate(),this.p1=n;var r=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y;this.quadrant=Qe.quadrant(r,s),this.angle=Math.atan2(s,r)}function gr(){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];fr.call(this,t,e,n,i)}function dr(){if(cr.apply(this),this.dirEdge=null,0===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.setDirectedEdges(t,e)}}function pr(){this.outEdges=new I,this.sorted=!1}function mr(){if(cr.apply(this),this.pt=null,this.deStar=null,1===arguments.length){var t=arguments[0];mr.call(this,t,new pr)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.pt=e,this.deStar=n}}function vr(){dr.apply(this),this.line=null;var t=arguments[0];this.line=t}function yr(){this.nodeMap=new rt}function xr(){this.edges=new J,this.dirEdges=new J,this.nodeMap=new yr}function Er(){xr.apply(this)}function Ir(){this.graph=new Er,this.mergedLineStrings=null,this.factory=null,this.edgeStrings=null}function Nr(){this.edgeRing=null,this.next=null,this.label=-1;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];fr.call(this,t,e,n,i)}function Cr(){dr.apply(this),this.line=null;var t=arguments[0];this.line=t}function Sr(){this.factory=null,this.deList=new I,this.lowestEdge=null,this.ring=null,this.ringPts=null,this.holes=null,this.shell=null,this._isHole=null,this._isProcessed=!1,this._isIncludedSet=!1,this._isIncluded=!1;var t=arguments[0];this.factory=t}function wr(){}function Lr(){xr.apply(this),this.factory=null;var t=arguments[0];this.factory=t}function Rr(){if(this.lineStringAdder=new Tr(this),this.graph=null,this.dangles=new I,this.cutEdges=new I,this.invalidRingLines=new I,this.holeList=null,this.shellList=null,this.polyList=null,this.isCheckingRingsValid=!0,this.extractOnlyPolygonal=null,this.geomFactory=null,0===arguments.length)Rr.call(this,!1);else if(1===arguments.length){var t=arguments[0];this.extractOnlyPolygonal=t}}function Tr(){this.p=null;var t=arguments[0];this.p=t}function Pr(){}function br(){if(this.edgeEnds=new I,1===arguments.length){var t=arguments[0];br.call(this,null,t)}else if(2===arguments.length){var e=(arguments[0],arguments[1]);xn.call(this,e.getEdge(),e.getCoordinate(),e.getDirectedCoordinate(),new fn(e.getLabel())),this.insert(e)}}function Or(){Tn.apply(this)}function _r(){var t=arguments[0],e=arguments[1];vn.call(this,t,e)}function Mr(){In.apply(this)}function Dr(){this.li=new oe,this.ptLocator=new Re,this.arg=null,this.nodes=new yn(new Mr),this.im=null,this.isolatedEdges=new I,this.invalidPoint=null;var t=arguments[0];this.arg=t}function Ar(){this.rectEnv=null;var t=arguments[0];this.rectEnv=t.getEnvelopeInternal()}function Fr(){this.li=new oe,this.rectEnv=null,this.diagUp0=null,this.diagUp1=null,this.diagDown0=null,this.diagDown1=null;var t=arguments[0];this.rectEnv=t,this.diagUp0=new g(t.getMinX(),t.getMinY()),this.diagUp1=new g(t.getMaxX(),t.getMaxY()),this.diagDown0=new g(t.getMinX(),t.getMaxY()),this.diagDown1=new g(t.getMaxX(),t.getMinY())}function Gr(){this._isDone=!1}function qr(){this.rectangle=null,this.rectEnv=null;var t=arguments[0];this.rectangle=t,this.rectEnv=t.getEnvelopeInternal()}function Br(){Gr.apply(this),this.rectEnv=null,this._intersects=!1;var t=arguments[0];this.rectEnv=t}function zr(){Gr.apply(this),this.rectSeq=null,this.rectEnv=null,this._containsPoint=!1;var t=arguments[0];this.rectSeq=t.getExteriorRing().getCoordinateSequence(),this.rectEnv=t.getEnvelopeInternal()}function Vr(){Gr.apply(this),this.rectEnv=null,this.rectIntersector=null,this.hasIntersection=!1,this.p0=new g,this.p1=new g;var t=arguments[0];this.rectEnv=t.getEnvelopeInternal(),this.rectIntersector=new Fr(this.rectEnv)}function kr(){if(this._relate=null,2===arguments.length){var t=arguments[0],e=arguments[1];$n.call(this,t,e),this._relate=new Dr(this.arg)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];$n.call(this,n,i,r),this._relate=new Dr(this.arg)}}function Yr(){this.geomFactory=null,this.skipEmpty=!1,this.inputGeoms=null;var t=arguments[0];this.geomFactory=Yr.extractFactory(t),this.inputGeoms=t}function Ur(){this.pointGeom=null,this.otherGeom=null,this.geomFact=null;var t=arguments[0],e=arguments[1];this.pointGeom=t,this.otherGeom=e,this.geomFact=e.getFactory()}function Xr(){this.sortIndex=-1,this.comps=null;var t=arguments[0],e=arguments[1];this.sortIndex=t,this.comps=e}function Hr(){this.inputPolys=null,this.geomFactory=null;var t=arguments[0];this.inputPolys=t,null===this.inputPolys&&(this.inputPolys=new I)}function Wr(){if(this.polygons=new I,this.lines=new I,this.points=new I,this.geomFact=null,1===arguments.length){if(R(arguments[0],m)){var t=arguments[0];this.extract(t)}else if(arguments[0]instanceof B){var e=arguments[0];this.extract(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.geomFact=i,this.extract(n)}}function jr(){this.geometryFactory=new ne,this.geomGraph=null,this.disconnectedRingcoord=null;var t=arguments[0];this.geomGraph=t}function Kr(){this.items=new I,this.subnode=[null,null]}function Zr(){if(this.min=null,this.max=null,0===arguments.length)this.min=0,this.max=0;else if(1===arguments.length){var t=arguments[0];this.init(t.min,t.max)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.init(e,n)}}function Qr(){this.pt=0,this.level=0,this.interval=null;var t=arguments[0];this.computeKey(t)}function Jr(){Kr.apply(this),this.interval=null,this.centre=null,this.level=null;var t=arguments[0],e=arguments[1];this.interval=t,this.level=e,this.centre=(t.getMin()+t.getMax())/2}function $r(){Kr.apply(this)}function ts(){this.root=null,this.minExtent=1,this.root=new $r}function es(){}function ns(){this.ring=null,this.tree=null,this.crossings=0,this.interval=new Zr;var t=arguments[0];this.ring=t,this.buildIndex()}function is(){$i.apply(this),this.mcp=null,this.p=null;var t=arguments[0],e=arguments[1];this.mcp=t,this.p=e}function rs(){this.nodes=new yn(new Mr)}function ss(){this.li=new oe,this.geomGraph=null,this.nodeGraph=new rs,this.invalidPoint=null;var t=arguments[0];this.geomGraph=t}function os(){this.graph=null,this.rings=new I,this.totalEnv=new C,this.index=null,this.nestedPt=null;var t=arguments[0];this.graph=t}function as(){if(this.errorType=null,this.pt=null,1===arguments.length){var t=arguments[0];as.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.errorType=e,null!==n&&(this.pt=n.copy())}}function us(){this.parentGeometry=null,this.isSelfTouchingRingFormingHoleValid=!1,this.validErr=null;var t=arguments[0];this.parentGeometry=t}function ls(){_t.CoordinateOperation.apply(this),this.targetPM=null,this.removeCollapsed=!0;var t=arguments[0],e=arguments[1];this.targetPM=t,this.removeCollapsed=e}function hs(){this.targetPM=null,this.removeCollapsed=!0,this.changePrecisionModel=!1,this.isPointwise=!1;var t=arguments[0];this.targetPM=t}function cs(){this.pts=null,this.usePt=null,this.distanceTolerance=null,this.seg=new he;var t=arguments[0];this.pts=t}function fs(){this.inputGeom=null,this.distanceTolerance=null,this.isEnsureValidTopology=!0;var t=arguments[0];this.inputGeom=t}function gs(){ye.apply(this),this.isEnsureValidTopology=!0,this.distanceTolerance=null;var t=arguments[0],e=arguments[1];this.isEnsureValidTopology=t,this.distanceTolerance=e}function ds(){if(this.parent=null,this.index=null,2===arguments.length){var t=arguments[0],e=arguments[1];ds.call(this,t,e,null,-1)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3];he.call(this,n,i),this.parent=r,this.index=s}}function ps(){if(this.parentLine=null,this.segs=null,this.resultSegs=new I,this.minimumSize=null,1===arguments.length){var t=arguments[0];ps.call(this,t,2)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.parentLine=e,this.minimumSize=n,this.init()}}function ms(){this.index=new Ti}function vs(){this.querySeg=null,this.items=new I;var t=arguments[0];this.querySeg=t}function ys(){this.li=new oe,this.inputIndex=new ms,this.outputIndex=new ms,this.line=null,this.linePts=null,this.distanceTolerance=0;var t=arguments[0],e=arguments[1];this.inputIndex=t,this.outputIndex=e}function xs(){this.inputIndex=new ms,this.outputIndex=new ms,this.distanceTolerance=0}function Es(){this.inputGeom=null,this.lineSimplifier=new xs,this.linestringMap=null;var t=arguments[0];this.inputGeom=t}function Is(){ye.apply(this),this.linestringMap=null;var t=arguments[0];this.linestringMap=t}function Ns(){this.tps=null;var t=arguments[0];this.tps=t}function Cs(){this.seg=null,this.segLen=null,this.splitPt=null,this.minimumLen=0;var t=arguments[0];this.seg=t,this.segLen=t.getLength()}function Ss(){}function ws(){}function Ls(){}function Rs(){if(this.p=null,1===arguments.length){var t=arguments[0];this.p=new g(t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p=new g(e,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this.p=new g(i,r,s)}}function Ts(){this._isOnConstraint=null,this.constraint=null;var t=arguments[0];Rs.call(this,t)}function Ps(){this._rot=null,this.vertex=null,this.next=null,this.data=null}function bs(){this.subdiv=null,this.isUsingTolerance=!1;var t=arguments[0];this.subdiv=t,this.isUsingTolerance=t.getTolerance()>0}function Os(){}function _s(){this.subdiv=null,this.lastEdge=null;var t=arguments[0];this.subdiv=t,this.init()}function Ms(){if(this.seg=null,1===arguments.length){if("string"==typeof arguments[0]){var t=arguments[0];l.call(this,t)}else if(arguments[0]instanceof he){var e=arguments[0];l.call(this,"Locate failed to converge (at edge: "+e+").  Possible causes include invalid Subdivision topology or very close sites"),this.seg=new he(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];l.call(this,Ms.msgWithSpatial(n,i)),this.seg=new he(i)}}function Ds(){}function As(){this.visitedKey=0,this.quadEdges=new I,this.startingEdge=null,this.tolerance=null,this.edgeCoincidenceTolerance=null,this.frameVertex=new Array(3).fill(null),this.frameEnv=null,this.locator=null,this.seg=new he,this.triEdges=new Array(3).fill(null);var t=arguments[0],e=arguments[1];this.tolerance=e,this.edgeCoincidenceTolerance=e/As.EDGE_COINCIDENCE_TOL_FACTOR,this.createFrame(t),this.startingEdge=this.initSubdiv(),this.locator=new _s(this)}function Fs(){}function Gs(){this.triList=new I}function qs(){this.triList=new I}function Bs(){this.coordList=new N,this.triCoords=new I}function zs(){if(this.ls=null,this.data=null,2===arguments.length){var t=arguments[0],e=arguments[1];this.ls=new he(t,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.ls=new he(n,i),this.data=r}else if(6===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2],u=arguments[3],l=arguments[4],h=arguments[5];zs.call(this,new g(s,o,a),new g(u,l,h))}else if(7===arguments.length){var c=arguments[0],f=arguments[1],d=arguments[2],p=arguments[3],m=arguments[4],v=arguments[5],y=arguments[6];zs.call(this,new g(c,f,d),new g(p,m,v),y)}}function Vs(){}function ks(){if(this.p=null,this.data=null,this.left=null,this.right=null,this.count=null,2===arguments.length){var t=arguments[0],e=arguments[1];this.p=new g(t),this.left=null,this.right=null,this.count=1,this.data=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.p=new g(n,i),this.left=null,this.right=null,this.count=1,this.data=r}}function Ys(){if(this.root=null,this.numberOfNodes=null,this.tolerance=null,0===arguments.length)Ys.call(this,0);else if(1===arguments.length){var t=arguments[0];this.tolerance=t}}function Us(){this.tolerance=null,this.matchNode=null,this.matchDist=0,this.p=null;var t=arguments[0],e=arguments[1];this.p=t,this.tolerance=e}function Xs(){this.initialVertices=null,this.segVertices=null,this.segments=new I,this.subdiv=null,this.incDel=null,this.convexHull=null,this.splitFinder=new ws,this.kdt=null,this.vertexFactory=null,this.computeAreaEnv=null,this.splitPt=null,this.tolerance=null;var t=arguments[0],e=arguments[1];this.initialVertices=new I(t),this.tolerance=e,this.kdt=new Ys(e)}function Hs(){this.siteCoords=null,this.tolerance=0,this.subdiv=null}function Ws(){this.siteCoords=null,this.constraintLines=null,this.tolerance=0,this.subdiv=null,this.constraintVertexMap=new rt}function js(){this.siteCoords=null,this.tolerance=0,this.subdiv=null,this.clipEnv=null,this.diagramEnv=null}function Ks(){}Array.prototype.fill||(Array.prototype.fill=function(t){for(var e=Object(this),n=parseInt(e.length,10),i=arguments[1],r=parseInt(i,10)||0,s=0>r?Math.max(n+r,0):Math.min(r,n),o=arguments[2],a=void 0===o?n:parseInt(o,10)||0,u=0>a?Math.max(n+a,0):Math.min(a,n);u>s;s++)e[s]=t;return e}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!==t},Math.trunc=Math.trunc||function(t){return 0>t?Math.ceil(t):Math.floor(t)},e(n.prototype,{interfaces_:function(){return[]},getClass:function(){return n}}),n.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n},r.isNaN=function(t){return Number.isNaN(t)},r.doubleToLongBits=function(t){return t},r.longBitsToDouble=function(t){return t},r.isInfinite=function(t){return!Number.isFinite(t)},r.MAX_VALUE=Number.MAX_VALUE,h(c,l),e(c.prototype,{interfaces_:function(){return[]},getClass:function(){return c}}),e(f.prototype,{interfaces_:function(){return[]},getClass:function(){return f}}),f.shouldNeverReachHere=function(){if(0===arguments.length)f.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new c("Should never reach here"+(null!==t?": "+t:""))}},f.isTrue=function(){if(1===arguments.length){var t=arguments[0];f.isTrue(t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!e)throw null===n?new c:new c(n)}},f.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];f.equals(t,e,null)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(!i.equals(n))throw new c("Expected "+n+" but encountered "+i+(null!==r?": "+r:""))}},e(g.prototype,{setOrdinate:function(t,e){switch(t){case g.X:this.x=e;break;case g.Y:this.y=e;break;case g.Z:this.z=e;break;default:throw new i("Invalid ordinate index: "+t)}},equals2D:function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!n.equalsWithTolerance(this.x,e.x,i)&&!!n.equalsWithTolerance(this.y,e.y,i)}},getOrdinate:function(t){switch(t){case g.X:return this.x;case g.Y:return this.y;case g.Z:return this.z}throw new i("Invalid ordinate index: "+t)},equals3D:function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||r.isNaN(this.z)&&r.isNaN(t.z))},equals:function(t){return t instanceof g&&this.equals2D(t)},equalInZ:function(t,e){return n.equalsWithTolerance(this.z,t.z,e)},compareTo:function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return f.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}finally{}},copy:function(){return new g(this)},toString:function(){return"("+this.x+", "+this.y+", "+this.z+")"},distance3D:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+n*n+i*i)},distance:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return t=37*t+g.hashCode(this.x),t=37*t+g.hashCode(this.y)},setCoordinate:function(t){this.x=t.x,this.y=t.y,this.z=t.z},interfaces_:function(){return[s,o,u]},getClass:function(){return g}}),g.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=r.doubleToLongBits(t);return Math.trunc(e^e>>>32)}},e(d.prototype,{compare:function(t,e){var n=t,i=e,r=d.compare(n.x,i.x);if(0!==r)return r;var s=d.compare(n.y,i.y);return 0!==s?s:this.dimensionsToTest<=2?0:d.compare(n.z,i.z)},interfaces_:function(){return[a]},getClass:function(){return d}}),d.compare=function(t,e){return e>t?-1:t>e?1:r.isNaN(t)?r.isNaN(e)?0:-1:r.isNaN(e)?1:0},g.DimensionalComparator=d,g.serialVersionUID=0x5cbf2c235c7e5800,g.NULL_ORDINATE=r.NaN,g.X=0,g.Y=1,g.Z=2,p.prototype.hasNext=function(){},p.prototype.next=function(){},p.prototype.remove=function(){},m.prototype.add=function(){},m.prototype.addAll=function(){},m.prototype.isEmpty=function(){},m.prototype.iterator=function(){},m.prototype.size=function(){},m.prototype.toArray=function(){},m.prototype.remove=function(){},v.prototype=new Error,v.prototype.name="IndexOutOfBoundsException",y.prototype=Object.create(m.prototype),y.prototype.constructor=y,y.prototype.get=function(){},y.prototype.set=function(){},y.prototype.isEmpty=function(){},x.prototype=new Error,x.prototype.name="NoSuchElementException",E.prototype=new Error,E.prototype.name="OperationNotSupported",I.prototype=Object.create(y.prototype),I.prototype.constructor=I,I.prototype.ensureCapacity=function(){},I.prototype.interfaces_=function(){return[y,m]},I.prototype.add=function(t){return this.array_.push(t),!0},I.prototype.clear=function(){this.array_=[]},I.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},I.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},I.prototype.iterator=function(){return new Zs(this)},I.prototype.get=function(t){if(0>t||t>=this.size())throw new v;return this.array_[t]},I.prototype.isEmpty=function(){return 0===this.array_.length},I.prototype.size=function(){return this.array_.length},I.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;n>e;e++)t.push(this.array_[e]);return t},I.prototype.remove=function(t){for(var e=!1,n=0,i=this.array_.length;i>n;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e};var Zs=function(t){this.arrayList_=t,this.position_=0};Zs.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new x;return this.arrayList_.get(this.position_++)},Zs.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},Zs.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},Zs.prototype.remove=function(){throw new E},h(N,I),e(N.prototype,{getCoordinate:function(t){return this.get(t)},addAll:function(){if(2===arguments.length){for(var t=arguments[0],e=arguments[1],n=!1,i=t.iterator();i.hasNext();)this.add(i.next(),e),n=!0;return n}return I.prototype.addAll.apply(this,arguments)},clone:function t(){for(var t=I.prototype.clone.call(this),e=0;e<this.size();e++)t.add(e,this.get(e).copy());return t},toCoordinateArray:function(){return this.toArray(N.coordArrayType)},add:function(){if(1===arguments.length){var t=arguments[0];I.prototype.add.call(this,t)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var e=arguments[0],n=arguments[1];return this.add(e,n,!0),!0}if(arguments[0]instanceof g&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];if(!r&&this.size()>=1){var s=this.get(this.size()-1);if(s.equals2D(i))return null}I.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];return this.add(o,a),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var u=arguments[0],l=arguments[1],h=arguments[2];if(h)for(var c=0;c<u.length;c++)this.add(u[c],l);else for(var c=u.length-1;c>=0;c--)this.add(u[c],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof g){var f=arguments[0],d=arguments[1],p=arguments[2];if(!p){var m=this.size();if(m>0){if(f>0){var v=this.get(f-1);if(v.equals2D(d))return null}if(m>f){var y=this.get(f);if(y.equals2D(d))return null}}}I.prototype.add.call(this,f,d)}}else if(4===arguments.length){var x=arguments[0],E=arguments[1],N=arguments[2],C=arguments[3],S=1;N>C&&(S=-1);for(var c=N;c!==C;c+=S)this.add(x[c],E);return!0}},closeRing:function(){this.size()>0&&this.add(new g(this.get(0)),!1)},interfaces_:function(){return[]},getClass:function(){return N}}),N.coordArrayType=new Array(0).fill(null),e(C.prototype,{getArea:function(){return this.getWidth()*this.getHeight()},equals:function(t){if(!(t instanceof C))return!1;var e=t;return this.isNull()?e.isNull():this.maxx===e.getMaxX()&&this.maxy===e.getMaxY()&&this.minx===e.getMinX()&&this.miny===e.getMinY()},intersection:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new C;var e=this.minx>t.minx?this.minx:t.minx,n=this.miny>t.miny?this.miny:t.miny;return new C(e,this.maxx<t.maxx?this.maxx:t.maxx,n,this.maxy<t.maxy?this.maxy:t.maxy)},isNull:function(){return this.maxx<this.minx},getMaxX:function(){return this.maxx},covers:function(){if(1===arguments.length){if(arguments[0]instanceof g){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof C){var e=arguments[0];return!this.isNull()&&!e.isNull()&&(e.getMinX()>=this.minx&&e.getMaxX()<=this.maxx&&e.getMinY()>=this.miny&&e.getMaxY()<=this.maxy)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&(n>=this.minx&&n<=this.maxx&&i>=this.miny&&i<=this.maxy)}},intersects:function(){if(1===arguments.length){if(arguments[0]instanceof C){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t.minx>this.maxx||t.maxx<this.minx||t.miny>this.maxy||t.maxy<this.miny)}if(arguments[0]instanceof g){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.maxx||n<this.minx||i>this.maxy||i<this.miny)}},getMinY:function(){return this.miny},getMinX:function(){return this.minx},expandToInclude:function(){if(1===arguments.length){if(arguments[0]instanceof g){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof C){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this.minx=e.getMinX(),this.maxx=e.getMaxX(),this.miny=e.getMinY(),this.maxy=e.getMaxY()):(e.minx<this.minx&&(this.minx=e.minx),e.maxx>this.maxx&&(this.maxx=e.maxx),e.miny<this.miny&&(this.miny=e.miny),e.maxy>this.maxy&&(this.maxy=e.maxy))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.minx=n,this.maxx=n,this.miny=i,this.maxy=i):(n<this.minx&&(this.minx=n),n>this.maxx&&(this.maxx=n),i<this.miny&&(this.miny=i),i>this.maxy&&(this.maxy=i))}},minExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return e>t?t:e},getWidth:function(){return this.isNull()?0:this.maxx-this.minx},compareTo:function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this.minx<e.minx?-1:this.minx>e.minx?1:this.miny<e.miny?-1:this.miny>e.miny?1:this.maxx<e.maxx?-1:this.maxx>e.maxx?1:this.maxy<e.maxy?-1:this.maxy>e.maxy?1:0},translate:function(t,e){return this.isNull()?null:void this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},toString:function(){return"Env["+this.minx+" : "+this.maxx+", "+this.miny+" : "+this.maxy+"]"},setToNull:function(){this.minx=0,this.maxx=-1,this.miny=0,this.maxy=-1},getHeight:function(){return this.isNull()?0:this.maxy-this.miny},maxExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},expandBy:function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this.minx-=e,this.maxx+=e,this.miny-=n,this.maxy+=n,(this.minx>this.maxx||this.miny>this.maxy)&&this.setToNull()}},contains:function(){if(1===arguments.length){if(arguments[0]instanceof C){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof g){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},centre:function(){return this.isNull()?null:new g((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},init:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof g){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof C){var e=arguments[0];this.minx=e.minx,this.maxx=e.maxx,this.miny=e.miny,this.maxy=e.maxy}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];s>r?(this.minx=r,this.maxx=s):(this.minx=s,this.maxx=r),a>o?(this.miny=o,this.maxy=a):(this.miny=a,this.maxy=o)}},getMaxY:function(){return this.maxy},distance:function(t){if(this.intersects(t))return 0;var e=0;this.maxx<t.minx?e=t.minx-this.maxx:this.minx>t.maxx&&(e=this.minx-t.maxx);var n=0;return this.maxy<t.miny?n=t.miny-this.maxy:this.miny>t.maxy&&(n=this.miny-t.maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return t=37*t+g.hashCode(this.minx),t=37*t+g.hashCode(this.maxx),t=37*t+g.hashCode(this.miny),t=37*t+g.hashCode(this.maxy)},interfaces_:function(){return[s,u]},getClass:function(){return C}}),C.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=Math.min(s.x,o.x),u=Math.max(s.x,o.x),l=Math.min(i.x,r.x),h=Math.max(i.x,r.x);return!(l>u)&&(!(a>h)&&(a=Math.min(s.y,o.y),u=Math.max(s.y,o.y),l=Math.min(i.y,r.y),h=Math.max(i.y,r.y),!(l>u)&&!(a>h)))}},C.serialVersionUID=0x51845cd552189800,h(w,S),e(w.prototype,{interfaces_:function(){return[]},getClass:function(){return w}}),e(L.prototype,{interfaces_:function(){return[]},getClass:function(){return L}}),L.toLocationSymbol=function(t){switch(t){case L.EXTERIOR:return"e";case L.BOUNDARY:return"b";case L.INTERIOR:return"i";case L.NONE:return"-"}throw new i("Unknown location value: "+t)},L.INTERIOR=0,L.BOUNDARY=1,L.EXTERIOR=2,L.NONE=-1,e(T.prototype,{interfaces_:function(){return[]},getClass:function(){return T}}),T.log10=function(t){var e=Math.log(t);return r.isInfinite(e)?e:r.isNaN(e)?e:e/T.LOG_10},T.min=function(t,e,n,i){var r=t;return r>e&&(r=e),r>n&&(r=n),r>i&&(r=i),r},T.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return e>t?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],s=arguments[2];return r>i?r:i>s?s:i}},T.wrap=function(t,e){return 0>t?e- -t%e:t%e},T.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=t;return e>i&&(i=e),n>i&&(i=n),i}if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],i=r;return s>i&&(i=s),o>i&&(i=o),a>i&&(i=a),i}},T.average=function(t,e){return(t+e)/2},T.LOG_10=Math.log(10),P.prototype.append=function(t){this.str+=t},P.prototype.setCharAt=function(t,e){return this.str.substr(0,t)+e+this.str.substr(t+1)},P.prototype.toString=function(t){return this.str},
b.prototype.intValue=function(){return this.value},b.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},b.isNaN=function(t){return Number.isNaN(t)},O.isWhitespace=function(t){return 32>=t&&t>=0||127==t},O.toUpperCase=function(t){return t.toUpperCase()},e(_.prototype,{le:function(t){return this.hi<t.hi||this.hi===t.hi&&this.lo<=t.lo},extractSignificantDigits:function(t,e){var n=this.abs(),i=_.magnitude(n.hi),r=_.TEN.pow(i);n=n.divide(r),n.gt(_.TEN)?(n=n.divide(_.TEN),i+=1):n.lt(_.ONE)&&(n=n.multiply(_.TEN),i-=1);for(var s=i+1,o=new P,a=_.MAX_PRINT_DIGITS-1,u=0;a>=u;u++){t&&u===s&&o.append(".");var l=Math.trunc(n.hi);if(0>l)break;var h=!1,c=0;l>9?(h=!0,c="9"):c="0"+l,o.append(c),n=n.subtract(_.valueOf(l)).multiply(_.TEN),h&&n.selfAdd(_.TEN);var f=!0,g=_.magnitude(n.hi);if(0>g&&Math.abs(g)>=a-u&&(f=!1),!f)break}return e[0]=i,o.toString()},sqr:function(){return this.multiply(this)},doubleValue:function(){return this.hi+this.lo},subtract:function(){if(arguments[0]instanceof _){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},equals:function(){if(1===arguments.length){var t=arguments[0];return this.hi===t.hi&&this.lo===t.lo}},isZero:function(){return 0===this.hi&&0===this.lo},selfSubtract:function(){if(arguments[0]instanceof _){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t.hi,-t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},getSpecialNumberString:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},min:function(t){return this.le(t)?this:t},selfDivide:function(){if(1===arguments.length){if(arguments[0]instanceof _){var t=arguments[0];return this.selfDivide(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,s=null,o=null,a=null,u=null,l=null,h=null,c=null;return u=this.hi/n,l=_.SPLIT*u,r=l-u,c=_.SPLIT*n,r=l-r,s=u-r,o=c-n,h=u*n,o=c-o,a=n-o,c=r*o-h+r*a+s*o+s*a,l=(this.hi-h-c+this.lo-u*i)/n,c=u+l,this.hi=c,this.lo=u-c+l,this}},dump:function(){return"DD<"+this.hi+", "+this.lo+">"},divide:function(){if(arguments[0]instanceof _){var t=arguments[0],e=null,n=null,i=null,s=null,o=null,a=null,u=null,l=null;o=this.hi/t.hi,a=_.SPLIT*o,e=a-o,l=_.SPLIT*t.hi,e=a-e,n=o-e,i=l-t.hi,u=o*t.hi,i=l-i,s=t.hi-i,l=e*i-u+e*s+n*i+n*s,a=(this.hi-u-l+this.lo-o*t.lo)/t.hi,l=o+a;return new _(l,o-l+a)}if("number"==typeof arguments[0]){var h=arguments[0];return r.isNaN(h)?_.createNaN():_.copy(this).selfDivide(h,0)}},ge:function(t){return this.hi>t.hi||this.hi===t.hi&&this.lo>=t.lo},pow:function(t){if(0===t)return _.valueOf(1);var e=new _(this),n=_.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(e),(i/=2)>0&&(e=e.sqr());else n=e;return 0>t?n.reciprocal():n},ceil:function(){if(this.isNaN())return _.NaN;var t=Math.ceil(this.hi),e=0;return t===this.hi&&(e=Math.ceil(this.lo)),new _(t,e)},compareTo:function(t){var e=t;return this.hi<e.hi?-1:this.hi>e.hi?1:this.lo<e.lo?-1:this.lo>e.lo?1:0},rint:function(){return this.isNaN()?this:this.add(.5).floor()},setValue:function(){if(arguments[0]instanceof _){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},max:function(t){return this.ge(t)?this:t},sqrt:function(){if(this.isZero())return _.valueOf(0);if(this.isNegative())return _.NaN;var t=1/Math.sqrt(this.hi),e=this.hi*t,n=_.valueOf(e),i=this.subtract(n.sqr()),r=i.hi*(.5*t);return n.add(r)},selfAdd:function(){if(1===arguments.length){if(arguments[0]instanceof _){var t=arguments[0];return this.selfAdd(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,i=null,r=null,s=null,o=null,a=null;return r=this.hi+e,o=r-this.hi,s=r-o,s=e-o+(this.hi-s),a=s+this.lo,n=r+a,i=a+(r-n),this.hi=n+i,this.lo=i+(n-this.hi),this}}else if(2===arguments.length){var u=arguments[0],l=arguments[1],n=null,i=null,h=null,c=null,r=null,s=null,o=null,a=null;r=this.hi+u,h=this.lo+l,o=r-this.hi,a=h-this.lo,s=r-o,c=h-a,s=u-o+(this.hi-s),c=l-a+(this.lo-c),o=s+h,n=r+o,i=o+(r-n),o=c+i;var f=n+o,g=o+(n-f);return this.hi=f,this.lo=g,this}},selfMultiply:function(){if(1===arguments.length){if(arguments[0]instanceof _){var t=arguments[0];return this.selfMultiply(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,s=null,o=null,a=null,u=null,l=null;u=_.SPLIT*this.hi,r=u-this.hi,l=_.SPLIT*n,r=u-r,s=this.hi-r,o=l-n,u=this.hi*n,o=l-o,a=n-o,l=r*o-u+r*a+s*o+s*a+(this.hi*i+this.lo*n);var h=u+l;r=u-h;var c=l+r;return this.hi=h,this.lo=c,this}},selfSqr:function(){return this.selfMultiply(this)},floor:function(){if(this.isNaN())return _.NaN;var t=Math.floor(this.hi),e=0;return t===this.hi&&(e=Math.floor(this.lo)),new _(t,e)},negate:function(){return this.isNaN()?this:new _(-this.hi,-this.lo)},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}finally{}},multiply:function(){if(arguments[0]instanceof _){var t=arguments[0];return t.isNaN()?_.createNaN():_.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return r.isNaN(e)?_.createNaN():_.copy(this).selfMultiply(e,0)}},isNaN:function(){return r.isNaN(this.hi)},intValue:function(){return Math.trunc(this.hi)},toString:function(){var t=_.magnitude(this.hi);return t>=-3&&20>=t?this.toStandardNotation():this.toSciNotation()},toStandardNotation:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),i=e[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(0>i)r="0."+_.stringOfChar("0",-i)+n;else if(-1===n.indexOf(".")){var s=i-n.length,o=_.stringOfChar("0",s);r=n+o+".0"}return this.isNegative()?"-"+r:r},reciprocal:function(){var t=null,e=null,n=null,i=null,r=null,s=null,o=null,a=null;r=1/this.hi,s=_.SPLIT*r,t=s-r,a=_.SPLIT*this.hi,t=s-t,e=r-t,n=a-this.hi,o=r*this.hi,n=a-n,i=this.hi-n,a=t*n-o+t*i+e*n+e*i,s=(1-o-a-r*this.lo)/this.hi;var u=r+s;return new _(u,r-u+s)},toSciNotation:function(){if(this.isZero())return _.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),i=_.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new IllegalStateException("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var s=n.charAt(0)+"."+r;return this.isNegative()?"-"+s+i:s+i},abs:function(){return this.isNaN()?_.NaN:this.isNegative()?this.negate():new _(this)},isPositive:function(){return this.hi>0||0===this.hi&&this.lo>0},lt:function(t){return this.hi<t.hi||this.hi===t.hi&&this.lo<t.lo},add:function(){if(arguments[0]instanceof _){var t=arguments[0];return _.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return _.copy(this).selfAdd(e)}},init:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.hi=t,this.lo=0}else if(arguments[0]instanceof _){var e=arguments[0];this.hi=e.hi,this.lo=e.lo}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.hi=n,this.lo=i}},gt:function(t){return this.hi>t.hi||this.hi===t.hi&&this.lo>t.lo},isNegative:function(){return this.hi<0||0===this.hi&&this.lo<0},trunc:function(){return this.isNaN()?_.NaN:this.isPositive()?this.floor():this.ceil()},signum:function(){return this.hi>0?1:this.hi<0?-1:this.lo>0?1:this.lo<0?-1:0},interfaces_:function(){return[u,s,o]},getClass:function(){return _}}),_.sqr=function(t){return _.valueOf(t).selfMultiply(t)},_.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return _.parse(t)}if("number"==typeof arguments[0]){return new _(arguments[0])}},_.sqrt=function(t){return _.valueOf(t).sqrt()},_.parse=function(t){for(var e=0,n=t.length;O.isWhitespace(t.charAt(e));)e++;var i=!1;if(n>e){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(i=!0))}for(var s=new _,o=0,a=0,u=0;!(e>=n);){var l=t.charAt(e);if(e++,O.isDigit(l)){var h=l-"0";s.selfMultiply(_.TEN),s.selfAdd(h),o++}else{if("."!==l){if("e"===l||"E"===l){var c=t.substring(e);try{u=b.parseInt(c)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+c+" in string "+t):e}finally{}break}throw new NumberFormatException("Unexpected character '"+l+"' at position "+e+" in string "+t)}a=o}}var f=s,g=o-a-u;if(0===g)f=s;else if(g>0){var d=_.TEN.pow(g);f=s.divide(d)}else if(0>g){var d=_.TEN.pow(-g);f=s.multiply(d)}return i?f.negate():f},_.createNaN=function(){return new _(r.NaN,r.NaN)},_.copy=function(t){return new _(t)},_.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(n));return e>=10*Math.pow(10,i)&&(i+=1),i},_.stringOfChar=function(t,e){for(var n=new P,i=0;e>i;i++)n.append(t);return n.toString()},_.PI=new _(3.141592653589793,1.2246467991473532e-16),_.TWO_PI=new _(6.283185307179586,2.4492935982947064e-16),_.PI_2=new _(1.5707963267948966,6.123233995736766e-17),_.E=new _(2.718281828459045,1.4456468917292502e-16),_.NaN=new _(r.NaN,r.NaN),_.EPS=1.23259516440783e-32,_.SPLIT=134217729,_.MAX_PRINT_DIGITS=32,_.TEN=_.valueOf(10),_.ONE=_.valueOf(1),_.SCI_NOT_EXPONENT_CHAR="E",_.SCI_NOT_ZERO="0.0E0",e(M.prototype,{interfaces_:function(){return[]},getClass:function(){return M}}),M.orientationIndex=function(t,e,n){var i=M.orientationIndexFilter(t,e,n);if(1>=i)return i;var r=_.valueOf(e.x).selfAdd(-t.x),s=_.valueOf(e.y).selfAdd(-t.y),o=_.valueOf(n.x).selfAdd(-e.x),a=_.valueOf(n.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(s.selfMultiply(o)).signum()},M.signOfDet2x2=function(t,e,n,i){return t.multiply(i).selfSubtract(e.multiply(n)).signum()},M.intersection=function(t,e,n,i){var r=_.valueOf(i.y).selfSubtract(n.y).selfMultiply(_.valueOf(e.x).selfSubtract(t.x)),s=_.valueOf(i.x).selfSubtract(n.x).selfMultiply(_.valueOf(e.y).selfSubtract(t.y)),o=r.subtract(s),a=_.valueOf(i.x).selfSubtract(n.x).selfMultiply(_.valueOf(t.y).selfSubtract(n.y)),u=_.valueOf(i.y).selfSubtract(n.y).selfMultiply(_.valueOf(t.x).selfSubtract(n.x)),l=a.subtract(u),h=l.selfDivide(o).doubleValue(),c=_.valueOf(t.x).selfAdd(_.valueOf(e.x).selfSubtract(t.x).selfMultiply(h)).doubleValue(),f=_.valueOf(e.x).selfSubtract(t.x).selfMultiply(_.valueOf(t.y).selfSubtract(n.y)),d=_.valueOf(e.y).selfSubtract(t.y).selfMultiply(_.valueOf(t.x).selfSubtract(n.x)),p=f.subtract(d),m=p.selfDivide(o).doubleValue();return new g(c,_.valueOf(n.y).selfAdd(_.valueOf(i.y).selfSubtract(n.y).selfMultiply(m)).doubleValue())},M.orientationIndexFilter=function(t,e,n){var i=null,r=(t.x-n.x)*(e.y-n.y),s=(t.y-n.y)*(e.x-n.x),o=r-s;if(r>0){if(0>=s)return M.signum(o);i=r+s}else{if(!(0>r))return M.signum(o);if(s>=0)return M.signum(o);i=-r-s}var a=M.DP_SAFE_EPSILON*i;return o>=a||-o>=a?M.signum(o):2},M.signum=function(t){return t>0?1:0>t?-1:0},M.DP_SAFE_EPSILON=1e-15,e(D.prototype,{setOrdinate:function(t,e,n){},size:function(){},getOrdinate:function(t,e){},getCoordinate:function(){1===arguments.length?arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},getCoordinateCopy:function(t){},getDimension:function(){},getX:function(t){},clone:function(){},expandEnvelope:function(t){},copy:function(){},getY:function(t){},toCoordinateArray:function(){},interfaces_:function(){return[o]},getClass:function(){return D}}),D.X=0,D.Y=1,D.Z=2,D.M=3,A.arraycopy=function(t,e,n,i,r){for(var s=0,o=e;e+r>o;o++)n[i+s]=t[o],s++},A.getProperty=function(t){return{"line.separator":"\n"}[t]},e(F.prototype,{getY:function(){var t=this.y/this.w;if(r.isNaN(t)||r.isInfinite(t))throw new w;return t},getX:function(){var t=this.x/this.w;if(r.isNaN(t)||r.isInfinite(t))throw new w;return t},getCoordinate:function(){var t=new g;return t.x=this.getX(),t.y=this.getY(),t},interfaces_:function(){return[]},getClass:function(){return F}}),F.intersection=function(t,e,n,i){var s=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,u=n.y-i.y,l=i.x-n.x,h=n.x*i.y-i.x*n.y,c=o*h-l*a,f=u*a-s*h,d=s*l-u*o,p=c/d,m=f/d;if(r.isNaN(p)||r.isInfinite(p)||r.isNaN(m)||r.isInfinite(m))throw new w;return new g(p,m)},e(G.prototype,{create:function(){1===arguments.length?arguments[0]instanceof Array?arguments[0]:R(arguments[0],D)&&arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},interfaces_:function(){return[]},getClass:function(){return G}}),e(q.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return q}}),e(B.prototype,{isGeometryCollection:function(){return this.getSortIndex()===B.SORTINDEX_GEOMETRYCOLLECTION},getFactory:function(){return this.factory},getGeometryN:function(t){return this},getArea:function(){return 0},isRectangle:function(){return!1},equals:function(){if(1===arguments.length){if(arguments[0]instanceof B){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof B))return!1;var n=e;return this.equalsExact(n)}}},equalsExact:function(t){return this===t||this.equalsExact(t,0)},geometryChanged:function(){this.apply(B.geometryChangedFilter)},geometryChangedAction:function(){this.envelope=null},equalsNorm:function(t){return null!==t&&this.norm().equalsExact(t.norm())},getLength:function(){return 0},getNumGeometries:function(){return 1},compareTo:function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=n;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,i)}},getUserData:function(){return this.userData},getSRID:function(){return this.SRID},getEnvelope:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},checkNotGeometryCollection:function(t){if(t.getSortIndex()===B.SORTINDEX_GEOMETRYCOLLECTION)throw new i("This method does not support GeometryCollection arguments")},equal:function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},norm:function(){var t=this.copy();return t.normalize(),t},getPrecisionModel:function(){return this.factory.getPrecisionModel()},getEnvelopeInternal:function(){return null===this.envelope&&(this.envelope=this.computeEnvelopeInternal()),new C(this.envelope)},setSRID:function(t){this.SRID=t},setUserData:function(t){this.userData=t},compare:function(t,e){for(var n=t.iterator(),i=e.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),s=i.next(),o=r.compareTo(s);if(0!==o)return o}return n.hasNext()?1:i.hasNext()?-1:0},hashCode:function(){return this.getEnvelopeInternal().hashCode()},isGeometryCollectionOrDerived:function(){return this.getSortIndex()===B.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===B.SORTINDEX_MULTIPOINT||this.getSortIndex()===B.SORTINDEX_MULTILINESTRING||this.getSortIndex()===B.SORTINDEX_MULTIPOLYGON},interfaces_:function(){return[o,s,u]},getClass:function(){return B}}),B.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},B.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},B.serialVersionUID=0x799ea46522854c00,B.SORTINDEX_POINT=0,B.SORTINDEX_MULTIPOINT=1,B.SORTINDEX_LINESTRING=2,B.SORTINDEX_LINEARRING=3,B.SORTINDEX_MULTILINESTRING=4,B.SORTINDEX_POLYGON=5,B.SORTINDEX_MULTIPOLYGON=6,B.SORTINDEX_GEOMETRYCOLLECTION=7,B.geometryChangedFilter={interfaces_:function(){return[q]},filter:function(t){t.geometryChangedAction()}},e(z.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return z}}),e(V.prototype,{isInBoundary:function(t){},interfaces_:function(){return[]},getClass:function(){return V}}),e(k.prototype,{isInBoundary:function(t){return t%2==1},interfaces_:function(){return[V]},getClass:function(){return k}}),e(Y.prototype,{isInBoundary:function(t){return t>0},interfaces_:function(){return[V]},getClass:function(){return Y}}),e(U.prototype,{isInBoundary:function(t){return t>1},interfaces_:function(){return[V]},getClass:function(){return U}}),e(X.prototype,{isInBoundary:function(t){return 1===t},interfaces_:function(){return[V]},getClass:function(){return X}}),V.Mod2BoundaryNodeRule=k,V.EndPointBoundaryNodeRule=Y,V.MultiValentEndPointBoundaryNodeRule=U,V.MonoValentEndPointBoundaryNodeRule=X,V.MOD2_BOUNDARY_RULE=new k,V.ENDPOINT_BOUNDARY_RULE=new Y,V.MULTIVALENT_ENDPOINT_BOUNDARY_RULE=new U,V.MONOVALENT_ENDPOINT_BOUNDARY_RULE=new X,V.OGC_SFS_BOUNDARY_RULE=V.MOD2_BOUNDARY_RULE,e(H.prototype,{interfaces_:function(){return[]},getClass:function(){return H}}),H.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},H.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(H.indexOf(i,e)<0)return i}return null},H.scroll=function(t,e){var n=H.indexOf(e,t);if(0>n)return null;var i=new Array(t.length).fill(null);A.arraycopy(t,n,i,0,t.length-n),A.arraycopy(t,0,i,t.length-n,n),A.arraycopy(i,0,t,0,t.length)},H.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var n=0;n<i.length;n++)if(0!==s.compare(i[n],r[n]))return!1;return!0}},H.intersection=function(t,e){for(var n=new N,i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()},H.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},H.removeRepeatedPoints=function(t){return H.hasRepeatedPoints(t)?new N(t,!1).toCoordinateArray():t},H.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),i=0;n>=i;i++){var r=t[i];t[i]=t[e-i],t[e-i]=r}},H.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var i=new Array(e).fill(null);if(0===e)return i;for(var r=0,n=0;n<t.length;n++)null!==t[n]&&(i[r++]=t[n]);return i},H.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new g(t[n]);return e}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=arguments[4],n=0;a>n;n++)s[o+n]=new g(i[r+n])},H.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[t.length-n-1];if(0!==i.compareTo(r))return!1}return!0},H.envelope=function(t){for(var e=new C,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},H.toCoordinateArray=function(t){return t.toArray(H.coordArrayType)},H.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},H.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},H.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,i=t[e].compareTo(t[n]);if(0!==i)return i}return 1},H.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var i=t[n].compareTo(e[n]);if(0!==i)return i;n++}return n<e.length?-1:n<t.length?1:0},H.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},H.extract=function(t,e,n){e=T.clamp(e,0,t.length),n=T.clamp(n,-1,t.length);var i=n-e+1;0>n&&(i=0),e>=t.length&&(i=0),e>n&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var s=0,o=e;n>=o;o++)r[s++]=t[o];return r},e(W.prototype,{compare:function(t,e){var n=t,i=e;return H.compare(n,i)},interfaces_:function(){return[a]},getClass:function(){return W}}),e(j.prototype,{compare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=H.compare(n,i);return H.isEqualReversed(n,i)?0:r},OLDcompare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=H.increasingDirection(n),s=H.increasingDirection(i),o=r>0?0:n.length-1,a=s>0?0:n.length-1,u=0;u<n.length;u++){var l=n[o].compareTo(i[a]);if(0!==l)return l;o+=r,a+=s}return 0},interfaces_:function(){return[a]},getClass:function(){return j}}),H.ForwardComparator=W,H.BidirectionalComparator=j,H.coordArrayType=new Array(0).fill(null),K.prototype.get=function(){},K.prototype.put=function(){},K.prototype.size=function(){},K.prototype.values=function(){},K.prototype.entrySet=function(){},Z.prototype=new K,Q.prototype=new m,Q.prototype.contains=function(){},J.prototype=new Q,J.prototype.contains=function(t){for(var e=0,n=this.array_.length;n>e;e++){if(this.array_[e]===t)return!0}return!1},J.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},J.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},J.prototype.remove=function(t){throw new javascript.util.OperationNotSupported},J.prototype.size=function(){return this.array_.length},J.prototype.isEmpty=function(){return 0===this.array_.length},J.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;n>e;e++)t.push(this.array_[e]);return t},J.prototype.iterator=function(){return new Qs(this)};var Qs=function(t){this.hashSet_=t,this.position_=0};Qs.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new x;return this.hashSet_.array_[this.position_++]},Qs.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},Qs.prototype.remove=function(){throw new E};var Js=0;rt.prototype=new Z,rt.prototype.get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(0>n)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},rt.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Js,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,0>(i=t.compareTo(r.key)))r=r.left;else{if(!(i>0)){var s=r.value;return r.value=e,s}r=r.right}}while(null!==r);var o={key:t,left:null,right:null,value:e,parent:n,color:Js,getValue:function(){return this.value},getKey:function(){return this.key}};return 0>i?n.left=o:n.right=o,this.fixAfterInsertion(o),this.size_++,null},rt.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!=this.root_&&1==t.parent.color;)if(tt(t)==nt(tt(tt(t)))){var e=it(tt(tt(t)));1==$(e)?(et(tt(t),Js),et(e,Js),et(tt(tt(t)),1),t=tt(tt(t))):(t==it(tt(t))&&(t=tt(t),this.rotateLeft(t)),et(tt(t),Js),et(tt(tt(t)),1),this.rotateRight(tt(tt(t))))}else{var e=nt(tt(tt(t)));1==$(e)?(et(tt(t),Js),et(e,Js),et(tt(tt(t)),1),t=tt(tt(t))):(t==nt(tt(t))&&(t=tt(t),this.rotateRight(t)),et(tt(t),Js),et(tt(tt(t)),1),this.rotateLeft(tt(tt(t))))}this.root_.color=Js},rt.prototype.values=function(){var t=new I,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=rt.successor(e));)t.add(e.value);return t},rt.prototype.entrySet=function(){var t=new J,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=rt.successor(e));)t.add(e);return t},rt.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.left==t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},rt.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.right==t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},rt.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},rt.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var e=t.parent,n=t;null!==e&&n===e.right;)n=e,e=e.parent;return e},rt.prototype.size=function(){return this.size_},e(st.prototype,{interfaces_:function(){return[]},getClass:function(){return st}}),ot.prototype=new Q,at.prototype=new ot,at.prototype.contains=function(t){for(var e=0,n=this.array_.length;n>e;e++){if(0===this.array_[e].compareTo(t))return!0}return!1},at.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;n>e;e++){if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0}return this.array_.push(t),!0},at.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},at.prototype.remove=function(t){throw new E},at.prototype.size=function(){return this.array_.length},at.prototype.isEmpty=function(){return 0===this.array_.length},at.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;n>e;e++)t.push(this.array_[e]);return t},at.prototype.iterator=function(){return new $s(this)};var $s=function(t){this.treeSet_=t,this.position_=0};$s.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new x;return this.treeSet_.array_[this.position_++]},$s.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},$s.prototype.remove=function(){throw new E},ut.sort=function(){var t,e,n,i,r=arguments[0];if(1===arguments.length)return i=function(t,e){return t.compareTo(e)},void r.sort(i);if(2===arguments.length)n=arguments[1],i=function(t,e){return n.compare(t,e)},r.sort(i);else{if(3===arguments.length){e=r.slice(arguments[1],arguments[2]),e.sort();var s=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<s.length;t++)r.push(s[t]);return}if(4===arguments.length){for(e=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(t,e){return n.compare(t,e)},e.sort(i),s=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<s.length;t++)r.push(s[t]);return}}},ut.asList=function(t){for(var e=new I,n=0,i=t.length;i>n;n++)e.add(t[n]);return e},e(lt.prototype,{interfaces_:function(){return[]},getClass:function(){return lt}}),lt.toDimensionSymbol=function(t){switch(t){case lt.FALSE:return lt.SYM_FALSE;case lt.TRUE:return lt.SYM_TRUE;case lt.DONTCARE:return lt.SYM_DONTCARE;case lt.P:return lt.SYM_P;case lt.L:return lt.SYM_L;case lt.A:return lt.SYM_A}throw new i("Unknown dimension value: "+t)},lt.toDimensionValue=function(t){switch(O.toUpperCase(t)){case lt.SYM_FALSE:return lt.FALSE;case lt.SYM_TRUE:return lt.TRUE;case lt.SYM_DONTCARE:return lt.DONTCARE;case lt.SYM_P:return lt.P;case lt.SYM_L:return lt.L;case lt.SYM_A:return lt.A}throw new i("Unknown dimension symbol: "+t)},lt.P=0,lt.L=1,lt.A=2,lt.FALSE=-1,lt.TRUE=-2,lt.DONTCARE=-3,lt.SYM_FALSE="F",lt.SYM_TRUE="T",lt.SYM_DONTCARE="*",lt.SYM_P="0",lt.SYM_L="1",lt.SYM_A="2",e(ht.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return ht}}),e(ct.prototype,{filter:function(t,e){},isDone:function(){},isGeometryChanged:function(){},interfaces_:function(){return[]},getClass:function(){return ct}}),h(ft,B),e(ft.prototype,{computeEnvelopeInternal:function(){for(var t=new C,e=0;e<this.geometries.length;e++)t.expandToInclude(this.geometries[e].getEnvelopeInternal());return t},getGeometryN:function(t){return this.geometries[t]},getSortIndex:function(){return B.SORTINDEX_GEOMETRYCOLLECTION},getCoordinates:function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this.geometries.length;n++)for(var i=this.geometries[n].getCoordinates(),r=0;r<i.length;r++)e++,t[e]=i[r];return t},getArea:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getArea();return t},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.geometries.length!==n.geometries.length)return!1;for(var i=0;i<this.geometries.length;i++)if(!this.geometries[i].equalsExact(n.geometries[i],e))return!1;return!0}return B.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<this.geometries.length;t++)this.geometries[t].normalize();ut.sort(this.geometries)},getCoordinate:function(){return this.isEmpty()?null:this.geometries[0].getCoordinate()},getBoundaryDimension:function(){for(var t=lt.FALSE,e=0;e<this.geometries.length;e++)t=Math.max(t,this.geometries[e].getBoundaryDimension());return t},getDimension:function(){for(var t=lt.FALSE,e=0;e<this.geometries.length;e++)t=Math.max(t,this.geometries[e].getDimension());return t},getLength:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getLength();return t},getNumPoints:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getNumPoints();return t},getNumGeometries:function(){return this.geometries.length},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[n]=this.geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=new at(ut.asList(this.geometries)),n=new at(ut.asList(t.geometries));return this.compare(e,n)}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],s=i,o=this.getNumGeometries(),a=s.getNumGeometries(),u=0;o>u&&a>u;){var l=this.getGeometryN(u),h=s.getGeometryN(u),c=l.compareToSameClass(h,r);if(0!==c)return c;u++}return o>u?1:a>u?-1:0}},apply:function(){if(R(arguments[0],z))for(var t=arguments[0],e=0;e<this.geometries.length;e++)this.geometries[e].apply(t);else if(R(arguments[0],ct)){var n=arguments[0];if(0===this.geometries.length)return null;for(var e=0;e<this.geometries.length&&(this.geometries[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(R(arguments[0],ht)){var i=arguments[0];i.filter(this);for(var e=0;e<this.geometries.length;e++)this.geometries[e].apply(i)}else if(R(arguments[0],q)){var r=arguments[0];r.filter(this);for(var e=0;e<this.geometries.length;e++)this.geometries[e].apply(r)}},getBoundary:function(){return this.checkNotGeometryCollection(this),f.shouldNeverReachHere(),null},clone:function(){var t=B.prototype.clone.call(this);t.geometries=new Array(this.geometries.length).fill(null);for(var e=0;e<this.geometries.length;e++)t.geometries[e]=this.geometries[e].clone();return t},getGeometryType:function(){return"GeometryCollection"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new ft(t,this.factory)},isEmpty:function(){for(var t=0;t<this.geometries.length;t++)if(!this.geometries[t].isEmpty())return!1;return!0},interfaces_:function(){return[]},getClass:function(){return ft}}),ft.serialVersionUID=-0x4f07bcb1f857d800,h(gt,ft),e(gt.prototype,{getSortIndex:function(){return B.SORTINDEX_MULTILINESTRING},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&ft.prototype.equalsExact.call(this,t,e)}return ft.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return this.isClosed()?lt.FALSE:0},isClosed:function(){if(this.isEmpty())return!1;for(var t=0;t<this.geometries.length;t++)if(!this.geometries[t].isClosed())return!1;return!0},getDimension:function(){return 1},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[t-1-n]=this.geometries[n].reverse();return this.getFactory().createMultiLineString(e)},getBoundary:function(){return new dt(this).getBoundary()},getGeometryType:function(){return"MultiLineString"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new gt(t,this.factory)},interfaces_:function(){return[st]},getClass:function(){return gt}}),gt.serialVersionUID=0x7155d2ab4afa8000,e(dt.prototype,{boundaryMultiLineString:function(t){if(this.geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this.geomFact.createPoint(e[0]):this.geomFact.createMultiPointFromCoords(e)},getBoundary:function(){
return this.geom instanceof St?this.boundaryLineString(this.geom):this.geom instanceof gt?this.boundaryMultiLineString(this.geom):this.geom.getBoundary()},boundaryLineString:function(t){if(this.geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){return this.bnRule.isInBoundary(2)?t.getStartPoint():this.geomFact.createMultiPoint()}return this.geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},getEmptyMultiPoint:function(){return this.geomFact.createMultiPoint()},computeBoundaryCoordinates:function(t){var e=new I;this.endpointMap=new rt;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this.endpointMap.entrySet().iterator();r.hasNext();){var s=r.next(),o=s.getValue(),a=o.count;this.bnRule.isInBoundary(a)&&e.add(s.getKey())}return H.toCoordinateArray(e)},addEndpoint:function(t){var e=this.endpointMap.get(t);null===e&&(e=new pt,this.endpointMap.put(t,e)),e.count++},interfaces_:function(){return[]},getClass:function(){return dt}}),dt.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new dt(t);return e.getBoundary()}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=new dt(n,i);return e.getBoundary()}},e(pt.prototype,{interfaces_:function(){return[]},getClass:function(){return pt}}),e(Nt.prototype,{interfaces_:function(){return[]},getClass:function(){return Nt}}),Nt.chars=function(t,e){for(var n=new Array(e).fill(null),i=0;e>i;i++)n[i]=t;return new String(n)},Nt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new xt,n=new mt(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],s="",o=new vt(Nt.getStackTrace(i)),a=new It(o),u=0;r>u;u++)try{s+=a.readLine()+Nt.NEWLINE}catch(t){if(!(t instanceof Et))throw t;f.shouldNeverReachHere()}finally{}return s}},Nt.split=function(t,e){for(var n=e.length,i=new I,r=""+t,s=r.indexOf(e);s>=0;){var o=r.substring(0,s);i.add(o),r=r.substring(s+n),s=r.indexOf(e)}r.length>0&&i.add(r);for(var a=new Array(i.size()).fill(null),u=0;u<a.length;u++)a[u]=i.get(u);return a},Nt.toString=function(){if(1===arguments.length){var t=arguments[0];return Nt.SIMPLE_ORDINATE_FORMAT.format(t)}},Nt.spaces=function(t){return Nt.chars(" ",t)},Nt.NEWLINE=A.getProperty("line.separator"),Nt.SIMPLE_ORDINATE_FORMAT=new yt("0.#"),e(Ct.prototype,{interfaces_:function(){return[]},getClass:function(){return Ct}}),Ct.copyCoord=function(t,e,n,i){for(var r=Math.min(t.getDimension(),n.getDimension()),s=0;r>s;s++)n.setOrdinate(i,s,t.getOrdinate(e,s))},Ct.isRing=function(t){var e=t.size();return 0===e||!(3>=e)&&(t.getOrdinate(0,D.X)===t.getOrdinate(e-1,D.X)&&t.getOrdinate(0,D.Y)===t.getOrdinate(e-1,D.Y))},Ct.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),s=0;n>s;s++)for(var o=0;i>o;o++){var a=t.getOrdinate(s,o),u=e.getOrdinate(s,o);if(!(t.getOrdinate(s,o)===e.getOrdinate(s,o)||r.isNaN(a)&&r.isNaN(u)))return!1}return!0},Ct.extend=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();if(Ct.copy(e,0,i,0,r),r>0)for(var s=r;n>s;s++)Ct.copy(e,r-1,i,s,1);return i},Ct.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),i=0;n>=i;i++)Ct.swap(t,i,e-i)},Ct.swap=function(t,e,n){if(e===n)return null;for(var i=0;i<t.getDimension();i++){var r=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,r)}},Ct.copy=function(t,e,n,i,r){for(var s=0;r>s;s++)Ct.copyCoord(t,e+s,n,i+s)},Ct.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),i=new P;i.append("(");for(var r=0;e>r;r++){r>0&&i.append(" ");for(var s=0;n>s;s++)s>0&&i.append(","),i.append(Nt.toString(t.getOrdinate(r,s)))}return i.append(")"),i.toString()}},Ct.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:3>=n?Ct.createClosedRing(t,e,4):e.getOrdinate(0,D.X)===e.getOrdinate(n-1,D.X)&&e.getOrdinate(0,D.Y)===e.getOrdinate(n-1,D.Y)?e:Ct.createClosedRing(t,e,n+1)},Ct.createClosedRing=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();Ct.copy(e,0,i,0,r);for(var s=r;n>s;s++)Ct.copy(e,0,i,s,1);return i},h(St,B),e(St.prototype,{computeEnvelopeInternal:function(){return this.isEmpty()?new C:this.points.expandEnvelope(new C)},isRing:function(){return this.isClosed()&&this.isSimple()},getSortIndex:function(){return B.SORTINDEX_LINESTRING},getCoordinates:function(){return this.points.toCoordinateArray()},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.points.size()!==n.points.size())return!1;for(var i=0;i<this.points.size();i++)if(!this.equal(this.points.getCoordinate(i),n.points.getCoordinate(i),e))return!1;return!0}return B.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<Math.trunc(this.points.size()/2);t++){var e=this.points.size()-1-t;if(!this.points.getCoordinate(t).equals(this.points.getCoordinate(e)))return this.points.getCoordinate(t).compareTo(this.points.getCoordinate(e))>0&&Ct.reverse(this.points),null}},getCoordinate:function(){return this.isEmpty()?null:this.points.getCoordinate(0)},getBoundaryDimension:function(){return this.isClosed()?lt.FALSE:0},isClosed:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},getEndPoint:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},getDimension:function(){return 1},getLength:function(){return le.computeLength(this.points)},getNumPoints:function(){return this.points.size()},reverse:function(){var t=this.points.copy();return Ct.reverse(t),this.getFactory().createLineString(t)},compareToSameClass:function(){if(1===arguments.length){for(var t=arguments[0],e=t,n=0,i=0;n<this.points.size()&&i<e.points.size();){var r=this.points.getCoordinate(n).compareTo(e.points.getCoordinate(i));if(0!==r)return r;n++,i++}return n<this.points.size()?1:i<e.points.size()?-1:0}if(2===arguments.length){var s=arguments[0],o=arguments[1],e=s;return o.compare(this.points,e.points)}},apply:function(){if(R(arguments[0],z))for(var t=arguments[0],e=0;e<this.points.size();e++)t.filter(this.points.getCoordinate(e));else if(R(arguments[0],ct)){var n=arguments[0];if(0===this.points.size())return null;for(var e=0;e<this.points.size()&&(n.filter(this.points,e),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(R(arguments[0],ht)){var i=arguments[0];i.filter(this)}else if(R(arguments[0],q)){var r=arguments[0];r.filter(this)}},getBoundary:function(){return new dt(this).getBoundary()},isEquivalentClass:function(t){return t instanceof St},clone:function(){var t=B.prototype.clone.call(this);return t.points=this.points.clone(),t},getCoordinateN:function(t){return this.points.getCoordinate(t)},getGeometryType:function(){return"LineString"},copy:function(){return new St(this.points.copy(),this.factory)},getCoordinateSequence:function(){return this.points},isEmpty:function(){return 0===this.points.size()},init:function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new i("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this.points=t},isCoordinate:function(t){for(var e=0;e<this.points.size();e++)if(this.points.getCoordinate(e).equals(t))return!0;return!1},getStartPoint:function(){return this.isEmpty()?null:this.getPointN(0)},getPointN:function(t){return this.getFactory().createPoint(this.points.getCoordinate(t))},interfaces_:function(){return[st]},getClass:function(){return St}}),St.serialVersionUID=0x2b2b51ba435c8e00,e(wt.prototype,{interfaces_:function(){return[]},getClass:function(){return wt}}),h(Lt,B),e(Lt.prototype,{computeEnvelopeInternal:function(){if(this.isEmpty())return new C;var t=new C;return t.expandToInclude(this.coordinates.getX(0),this.coordinates.getY(0)),t},getSortIndex:function(){return B.SORTINDEX_POINT},getCoordinates:function(){return this.isEmpty()?[]:[this.getCoordinate()]},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))}return B.prototype.equalsExact.apply(this,arguments)},normalize:function(){},getCoordinate:function(){return 0!==this.coordinates.size()?this.coordinates.getCoordinate(0):null},getBoundaryDimension:function(){return lt.FALSE},getDimension:function(){return 0},getNumPoints:function(){return this.isEmpty()?0:1},reverse:function(){return this.copy()},getX:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=n;return i.compare(this.coordinates,e.coordinates)}},apply:function(){if(R(arguments[0],z)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(R(arguments[0],ct)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(R(arguments[0],ht)){var n=arguments[0];n.filter(this)}else if(R(arguments[0],q)){var i=arguments[0];i.filter(this)}},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},clone:function(){var t=B.prototype.clone.call(this);return t.coordinates=this.coordinates.clone(),t},getGeometryType:function(){return"Point"},copy:function(){return new Lt(this.coordinates.copy(),this.factory)},getCoordinateSequence:function(){return this.coordinates},getY:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y},isEmpty:function(){return 0===this.coordinates.size()},init:function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),f.isTrue(t.size()<=1),this.coordinates=t},isSimple:function(){return!0},interfaces_:function(){return[wt]},getClass:function(){return Lt}}),Lt.serialVersionUID=0x44077bad161cbc00,e(Rt.prototype,{interfaces_:function(){return[]},getClass:function(){return Rt}}),h(Tt,B),e(Tt.prototype,{computeEnvelopeInternal:function(){return this.shell.getEnvelopeInternal()},getSortIndex:function(){return B.SORTINDEX_POLYGON},getCoordinates:function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this.shell.getCoordinates(),i=0;i<n.length;i++)e++,t[e]=n[i];for(var r=0;r<this.holes.length;r++)for(var s=this.holes[r].getCoordinates(),o=0;o<s.length;o++)e++,t[e]=s[o];return t},getArea:function(){var t=0;t+=Math.abs(le.signedArea(this.shell.getCoordinateSequence()));for(var e=0;e<this.holes.length;e++)t-=Math.abs(le.signedArea(this.holes[e].getCoordinateSequence()));return t},isRectangle:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.shell)return!1;if(5!==this.shell.getNumPoints())return!1;for(var t=this.shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;5>n;n++){var i=t.getX(n);if(i!==e.getMinX()&&i!==e.getMaxX())return!1;var r=t.getY(n);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var s=t.getX(0),o=t.getY(0),n=1;4>=n;n++){var i=t.getX(n),r=t.getY(n);if(i!==s===(r!==o))return!1;s=i,o=r}return!0},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t,i=this.shell,r=n.shell;if(!i.equalsExact(r,e))return!1;if(this.holes.length!==n.holes.length)return!1;for(var s=0;s<this.holes.length;s++)if(!this.holes[s].equalsExact(n.holes[s],e))return!1;return!0}return B.prototype.equalsExact.apply(this,arguments)},normalize:function(){if(0===arguments.length){this.normalize(this.shell,!0);for(var t=0;t<this.holes.length;t++)this.normalize(this.holes[t],!1);ut.sort(this.holes)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var i=new Array(e.getCoordinates().length-1).fill(null);A.arraycopy(e.getCoordinates(),0,i,0,i.length);var r=H.minCoordinate(e.getCoordinates());H.scroll(i,r),A.arraycopy(i,0,e.getCoordinates(),0,i.length),e.getCoordinates()[i.length]=i[0],le.isCCW(e.getCoordinates())===n&&H.reverse(e.getCoordinates())}},getCoordinate:function(){return this.shell.getCoordinate()},getNumInteriorRing:function(){return this.holes.length},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},getLength:function(){var t=0;t+=this.shell.getLength();for(var e=0;e<this.holes.length;e++)t+=this.holes[e].getLength();return t},getNumPoints:function(){for(var t=this.shell.getNumPoints(),e=0;e<this.holes.length;e++)t+=this.holes[e].getNumPoints();return t},reverse:function(){var t=this.copy();t.shell=this.shell.copy().reverse(),t.holes=new Array(this.holes.length).fill(null);for(var e=0;e<this.holes.length;e++)t.holes[e]=this.holes[e].copy().reverse();return t},convexHull:function(){return this.getExteriorRing().convexHull()},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=this.shell,n=t.shell;return e.compareToSameClass(n)}if(2===arguments.length){var i=arguments[0],r=arguments[1],s=i,e=this.shell,n=s.shell,o=e.compareToSameClass(n,r);if(0!==o)return o;for(var a=this.getNumInteriorRing(),u=s.getNumInteriorRing(),l=0;a>l&&u>l;){var h=this.getInteriorRingN(l),c=s.getInteriorRingN(l),f=h.compareToSameClass(c,r);if(0!==f)return f;l++}return a>l?1:u>l?-1:0}},apply:function(){if(R(arguments[0],z)){var t=arguments[0];this.shell.apply(t);for(var e=0;e<this.holes.length;e++)this.holes[e].apply(t)}else if(R(arguments[0],ct)){var n=arguments[0];if(this.shell.apply(n),!n.isDone())for(var e=0;e<this.holes.length&&(this.holes[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(R(arguments[0],ht)){var i=arguments[0];i.filter(this)}else if(R(arguments[0],q)){var r=arguments[0];r.filter(this),this.shell.apply(r);for(var e=0;e<this.holes.length;e++)this.holes[e].apply(r)}},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this.holes.length+1).fill(null);t[0]=this.shell;for(var e=0;e<this.holes.length;e++)t[e+1]=this.holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},clone:function(){var t=B.prototype.clone.call(this);t.shell=this.shell.clone(),t.holes=new Array(this.holes.length).fill(null);for(var e=0;e<this.holes.length;e++)t.holes[e]=this.holes[e].clone();return t},getGeometryType:function(){return"Polygon"},copy:function(){for(var t=this.shell.copy(),e=new Array(this.holes.length).fill(null),n=0;n<e.length;n++)e[n]=this.holes[n].copy();return new Tt(t,e,this.factory)},getExteriorRing:function(){return this.shell},isEmpty:function(){return this.shell.isEmpty()},getInteriorRingN:function(t){return this.holes[t]},interfaces_:function(){return[Rt]},getClass:function(){return Tt}}),Tt.serialVersionUID=-0x307ffefd8dc97200,h(Pt,ft),e(Pt.prototype,{getSortIndex:function(){return B.SORTINDEX_MULTIPOINT},isValid:function(){return!0},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&ft.prototype.equalsExact.call(this,t,e)}return ft.prototype.equalsExact.apply(this,arguments)},getCoordinate:function(){if(1===arguments.length){var t=arguments[0];return this.geometries[t].getCoordinate()}return ft.prototype.getCoordinate.apply(this,arguments)},getBoundaryDimension:function(){return lt.FALSE},getDimension:function(){return 0},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},getGeometryType:function(){return"MultiPoint"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new Pt(t,this.factory)},interfaces_:function(){return[wt]},getClass:function(){return Pt}}),Pt.serialVersionUID=-0x6fb1ed4162e0fc00,h(bt,St),e(bt.prototype,{getSortIndex:function(){return B.SORTINDEX_LINEARRING},getBoundaryDimension:function(){return lt.FALSE},isClosed:function(){return!!this.isEmpty()||St.prototype.isClosed.call(this)},reverse:function(){var t=this.points.copy();return Ct.reverse(t),this.getFactory().createLinearRing(t)},validateConstruction:function(){if(!this.isEmpty()&&!St.prototype.isClosed.call(this))throw new i("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<bt.MINIMUM_VALID_SIZE)throw new i("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},getGeometryType:function(){return"LinearRing"},copy:function(){return new bt(this.points.copy(),this.factory)},interfaces_:function(){return[]},getClass:function(){return bt}}),bt.MINIMUM_VALID_SIZE=4,bt.serialVersionUID=-0x3b229e262367a600,h(Ot,ft),e(Ot.prototype,{getSortIndex:function(){return B.SORTINDEX_MULTIPOLYGON},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&ft.prototype.equalsExact.call(this,t,e)}return ft.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[n]=this.geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new I,e=0;e<this.geometries.length;e++)for(var n=this.geometries[e],i=n.getBoundary(),r=0;r<i.getNumGeometries();r++)t.add(i.getGeometryN(r));var s=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(s))},getGeometryType:function(){return"MultiPolygon"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new Ot(t,this.factory)},interfaces_:function(){return[Rt]},getClass:function(){return Ot}}),Ot.serialVersionUID=-0x7a5aa1369171980,e(_t.prototype,{setCopyUserData:function(t){this.isUserDataCopied=t},edit:function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this.isUserDataCopied&&n.setUserData(t.getUserData()),n},editInternal:function(t,e){return null===this.factory&&(this.factory=t.getFactory()),t instanceof ft?this.editGeometryCollection(t,e):t instanceof Tt?this.editPolygon(t,e):t instanceof Lt?e.edit(t,this.factory):t instanceof St?e.edit(t,this.factory):(f.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},editGeometryCollection:function(t,e){for(var n=e.edit(t,this.factory),i=new I,r=0;r<n.getNumGeometries();r++){var s=this.edit(n.getGeometryN(r),e);null===s||s.isEmpty()||i.add(s)}return n.getClass()===Pt?this.factory.createMultiPoint(i.toArray([])):n.getClass()===gt?this.factory.createMultiLineString(i.toArray([])):n.getClass()===Ot?this.factory.createMultiPolygon(i.toArray([])):this.factory.createGeometryCollection(i.toArray([]))},editPolygon:function(t,e){var n=e.edit(t,this.factory);if(null===n&&(n=this.factory.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),e);if(null===i||i.isEmpty())return this.factory.createPolygon();for(var r=new I,s=0;s<n.getNumInteriorRing();s++){var o=this.edit(n.getInteriorRingN(s),e);null===o||o.isEmpty()||r.add(o)}return this.factory.createPolygon(i,r.toArray([]))},interfaces_:function(){return[]},getClass:function(){return _t}}),_t.GeometryEditorOperation=Mt,e(Dt.prototype,{edit:function(t,e){return t},interfaces_:function(){return[Mt]},getClass:function(){return Dt}}),e(At.prototype,{edit:function(t,e){if(t instanceof bt)return e.createLinearRing(this.editCoordinates(t.getCoordinates(),t));if(t instanceof St)return e.createLineString(this.editCoordinates(t.getCoordinates(),t));if(t instanceof Lt){var n=this.editCoordinates(t.getCoordinates(),t);return n.length>0?e.createPoint(n[0]):e.createPoint()}return t},interfaces_:function(){return[Mt]},getClass:function(){return At}}),e(Ft.prototype,{edit:function(t,e){return t instanceof bt?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof St?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Lt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},interfaces_:function(){return[Mt]},getClass:function(){return Ft}}),_t.NoOpGeometryOperation=Dt,_t.CoordinateOperation=At,_t.CoordinateSequenceOperation=Ft,e(Gt.prototype,{setOrdinate:function(t,e,n){switch(e){case D.X:this.coordinates[t].x=n;break;case D.Y:this.coordinates[t].y=n;break;case D.Z:this.coordinates[t].z=n;break;default:throw new i("invalid ordinateIndex")}},size:function(){return this.coordinates.length},getOrdinate:function(t,e){switch(e){case D.X:return this.coordinates[t].x;case D.Y:return this.coordinates[t].y;case D.Z:return this.coordinates[t].z}return r.NaN},getCoordinate:function(){if(1===arguments.length){var t=arguments[0];return this.coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this.coordinates[e].x,n.y=this.coordinates[e].y,n.z=this.coordinates[e].z}},getCoordinateCopy:function(t){return new g(this.coordinates[t])},getDimension:function(){return this.dimension},getX:function(t){return this.coordinates[t].x},clone:function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.coordinates.length;e++)t[e]=this.coordinates[e].clone();return new Gt(t,this.dimension)},expandEnvelope:function(t){for(var e=0;e<this.coordinates.length;e++)t.expandToInclude(this.coordinates[e]);return t},copy:function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.coordinates.length;e++)t[e]=this.coordinates[e].copy();return new Gt(t,this.dimension)},toString:function(){if(this.coordinates.length>0){var t=new P(17*this.coordinates.length);t.append("("),t.append(this.coordinates[0]);for(var e=1;e<this.coordinates.length;e++)t.append(", "),t.append(this.coordinates[e]);return t.append(")"),t.toString()}return"()"},getY:function(t){return this.coordinates[t].y},toCoordinateArray:function(){return this.coordinates},interfaces_:function(){return[D,u]},getClass:function(){return Gt}}),Gt.serialVersionUID=-0xcb44a778db18e00,e(qt.prototype,{readResolve:function(){return qt.instance()},create:function(){if(1===arguments.length){if(arguments[0]instanceof Array){return new Gt(arguments[0])}if(R(arguments[0],D)){return new Gt(arguments[0])}}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),2>e?new Gt(t):new Gt(t,e)}},interfaces_:function(){return[G,u]},getClass:function(){return qt}}),qt.instance=function(){return qt.instanceObject},qt.serialVersionUID=-0x38e49fa6cf6f2e00,qt.instanceObject=new qt;var to,eo=Object.defineProperty,no=function(t,e){function n(t){return this&&this.constructor===n?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=e,void(t&&zt.call(this,t))):new n(t)}return e||eo(t,"size",{get:Qt}),t.constructor=n,n.prototype=t,n}({delete:Vt,has:Ut,get:kt,set:Xt,keys:Wt,values:jt,entries:Kt,forEach:Jt,clear:Ht}),io="undefined"!=typeof Map&&Map.prototype.values?Map:no;$t.prototype=new K,$t.prototype.get=function(t){return this.map_.get(t)||null},$t.prototype.put=function(t,e){return this.map_.set(t,e),e},$t.prototype.values=function(){for(var t=new I,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},$t.prototype.entrySet=function(){var t=new J;return this.map_.entries().forEach(function(e){return t.add(e)}),t},$t.prototype.size=function(){return this.map_.size()},e(te.prototype,{equals:function(t){if(!(t instanceof te))return!1;var e=t;return this.modelType===e.modelType&&this.scale===e.scale},compareTo:function(t){var e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return new b(n).compareTo(new b(i))},getScale:function(){return this.scale},isFloating:function(){return this.modelType===te.FLOATING||this.modelType===te.FLOATING_SINGLE},getType:function(){return this.modelType},toString:function(){var t="UNKNOWN";return this.modelType===te.FLOATING?t="Floating":this.modelType===te.FLOATING_SINGLE?t="Floating-Single":this.modelType===te.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},makePrecise:function(){if("number"==typeof arguments[0]){var t=arguments[0];if(r.isNaN(t))return t;if(this.modelType===te.FLOATING_SINGLE){return t}return this.modelType===te.FIXED?Math.round(t*this.scale)/this.scale:t}if(arguments[0]instanceof g){var e=arguments[0];if(this.modelType===te.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},getMaximumSignificantDigits:function(){var t=16;return this.modelType===te.FLOATING?t=16:this.modelType===te.FLOATING_SINGLE?t=6:this.modelType===te.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},setScale:function(t){this.scale=Math.abs(t)},interfaces_:function(){return[u,s]},getClass:function(){return te}}),te.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},e(ee.prototype,{readResolve:function(){return ee.nameToTypeMap.get(this.name)},toString:function(){return this.name},interfaces_:function(){return[u]},getClass:function(){return ee}}),ee.serialVersionUID=-552860263173159e4,ee.nameToTypeMap=new $t,te.Type=ee,te.serialVersionUID=0x6bee6404e9a25c00,te.FIXED=new ee("FIXED"),te.FLOATING=new ee("FLOATING"),te.FLOATING_SINGLE=new ee("FLOATING SINGLE"),te.maximumPreciseValue=9007199254740992,e(ne.prototype,{toGeometry:function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new g(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new g(t.getMinX(),t.getMinY()),new g(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new g(t.getMinX(),t.getMinY()),new g(t.getMinX(),t.getMaxY()),new g(t.getMaxX(),t.getMaxY()),new g(t.getMaxX(),t.getMinY()),new g(t.getMinX(),t.getMinY())]),null)},createLineString:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLineString(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(R(arguments[0],D)){return new St(arguments[0],this)}}},createMultiLineString:function(){if(0===arguments.length)return new gt(null,this);if(1===arguments.length){return new gt(arguments[0],this)}},buildGeometry:function(t){for(var e=null,n=!1,i=!1,r=t.iterator();r.hasNext();){var s=r.next(),o=s.getClass();null===e&&(e=o),o!==e&&(n=!0),s.isGeometryCollectionOrDerived()&&(i=!0)}if(null===e)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(ne.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Tt)return this.createMultiPolygon(ne.toPolygonArray(t));if(a instanceof St)return this.createMultiLineString(ne.toLineStringArray(t));if(a instanceof Lt)return this.createMultiPoint(ne.toPointArray(t));f.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},createMultiPointFromCoords:function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},createPoint:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof g){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(R(arguments[0],D)){return new Lt(arguments[0],this)}}},getCoordinateSequenceFactory:function(){return this.coordinateSequenceFactory},createPolygon:function(){if(0===arguments.length)return new Tt(null,null,this);if(1===arguments.length){if(R(arguments[0],D)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof bt){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return new Tt(i,r,this)}},getSRID:function(){return this.SRID},createGeometryCollection:function(){if(0===arguments.length)return new ft(null,this);if(1===arguments.length){return new ft(arguments[0],this)}},createGeometry:function(t){return new _t(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return arguments[1],this.coordinateSequenceFactory.create(t)}}})},getPrecisionModel:function(){return this.precisionModel},createLinearRing:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(R(arguments[0],D)){return new bt(arguments[0],this)}}},createMultiPolygon:function(){if(0===arguments.length)return new Ot(null,this);if(1===arguments.length){return new Ot(arguments[0],this)}},createMultiPoint:function(){if(0===arguments.length)return new Pt(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){return new Pt(arguments[0],this)}if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(R(arguments[0],D)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var n=new Array(e.size()).fill(null),i=0;i<e.size();i++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension());Ct.copy(e,i,r,0,1),n[i]=this.createPoint(r)}return this.createMultiPoint(n)}}},interfaces_:function(){return[u]},getClass:function(){return ne}}),ne.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.getDefaultCoordinateSequenceFactory=function(){return qt.instance()},ne.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ne.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ne.serialVersionUID=-0x5ea75f2051eeb400;var ro={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};e(ie.prototype,{read:function(t){var e,n,i;t=t.replace(/[\n\r]/g," ");var r=ro.typeStr.exec(t);if(-1!==t.search("EMPTY")&&(r=ro.emptyTypeStr.exec(t),r[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],oo[n]&&(e=oo[n].apply(this,[i]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},write:function(t){return this.extractGeometry(t)},extractGeometry:function(t){var e=t.getGeometryType().toLowerCase();if(!so[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+so[e].apply(this,[t])+")"}});var so={coordinate:function(t){return t.x+" "+t.y},point:function(t){return so.coordinate.call(this,t.coordinates.coordinates[0])},multipoint:function(t){for(var e=[],n=0,i=t.geometries.length;i>n;++n)e.push("("+so.point.apply(this,[t.geometries[n]])+")");return e.join(",")},linestring:function(t){
for(var e=[],n=0,i=t.points.coordinates.length;i>n;++n)e.push(so.coordinate.apply(this,[t.points.coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,i=t.points.coordinates.length;i>n;++n)e.push(so.coordinate.apply(this,[t.points.coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,i=t.geometries.length;i>n;++n)e.push("("+so.linestring.apply(this,[t.geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+so.linestring.apply(this,[t.shell])+")");for(var n=0,i=t.holes.length;i>n;++n)e.push("("+so.linestring.apply(this,[t.holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,i=t.geometries.length;i>n;++n)e.push("("+so.polygon.apply(this,[t.geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,i=t.geometries.length;i>n;++n)e.push(this.extractGeometry(t.geometries[n]));return e.join(",")}},oo={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(ro.spaces);return this.geometryFactory.createPoint(new g(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,n=t.trim().split(","),i=[],r=0,s=n.length;s>r;++r)e=n[r].replace(ro.trimParens,"$1"),i.push(oo.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),i=[],r=0,s=n.length;s>r;++r)e=n[r].trim().split(ro.spaces),i.push(new g(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(i)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),i=[],r=0,s=n.length;s>r;++r)e=n[r].trim().split(ro.spaces),i.push(new g(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,n=t.trim().split(ro.parenComma),i=[],r=0,s=n.length;s>r;++r)e=n[r].replace(ro.trimParens,"$1"),i.push(oo.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,n,i,r,s=t.trim().split(ro.parenComma),o=[],a=0,u=s.length;u>a;++a)e=s[a].replace(ro.trimParens,"$1"),n=oo.linestring.apply(this,[e]),i=this.geometryFactory.createLinearRing(n.points),0===a?r=i:o.push(i);return this.geometryFactory.createPolygon(r,o)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,n=t.trim().split(ro.doubleParenComma),i=[],r=0,s=n.length;s>r;++r)e=n[r].replace(ro.trimParens,"$1"),i.push(oo.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var e=t.trim().split("|"),n=[],i=0,r=e.length;r>i;++i)n.push(this.read(e[i]));return this.geometryFactory.createGeometryCollection(n)}};e(re.prototype,{write:function(t){return this.parser.write(t)}}),e(re,{toLineString:function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}),e(se.prototype,{getIndexAlongSegment:function(t,e){return this.computeIntLineIndex(),this.intLineIndex[t][e]},getTopologySummary:function(){var t=new P;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},computeIntersection:function(t,e,n,i){this.inputLines[0][0]=t,this.inputLines[0][1]=e,this.inputLines[1][0]=n,this.inputLines[1][1]=i,this.result=this.computeIntersect(t,e,n,i)},getIntersectionNum:function(){return this.result},computeIntLineIndex:function(){if(0===arguments.length)null===this.intLineIndex&&(this.intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this.intLineIndex[t][0]=0,this.intLineIndex[t][1]=1):(this.intLineIndex[t][0]=1,this.intLineIndex[t][1]=0)}},isProper:function(){return this.hasIntersection()&&this._isProper},setPrecisionModel:function(t){this.precisionModel=t},isInteriorIntersection:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this.result;e++)if(!this.intPt[e].equals2D(this.inputLines[t][0])&&!this.intPt[e].equals2D(this.inputLines[t][1]))return!0;return!1}},getIntersection:function(t){return this.intPt[t]},isEndPoint:function(){return this.hasIntersection()&&!this._isProper},hasIntersection:function(){return this.result!==se.NO_INTERSECTION},getEdgeDistance:function(t,e){return se.computeEdgeDistance(this.intPt[e],this.inputLines[t][0],this.inputLines[t][1])},isCollinear:function(){return this.result===se.COLLINEAR_INTERSECTION},toString:function(){return re.toLineString(this.inputLines[0][0],this.inputLines[0][1])+" - "+re.toLineString(this.inputLines[1][0],this.inputLines[1][1])+this.getTopologySummary()},getEndpoint:function(t,e){return this.inputLines[t][e]},isIntersection:function(t){for(var e=0;e<this.result;e++)if(this.intPt[e].equals2D(t))return!0;return!1},getIntersectionAlongSegment:function(t,e){return this.computeIntLineIndex(),this.intPt[this.intLineIndex[t][e]]},interfaces_:function(){return[]},getClass:function(){return se}}),se.computeEdgeDistance=function(t,e,n){var i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y),s=-1;if(t.equals(e))s=0;else if(t.equals(n))s=i>r?i:r;else{var o=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(s=i>r?o:a)||t.equals(e)||(s=Math.max(o,a))}return f.isTrue(!(0===s&&!t.equals(e)),"Bad distance calculation"),s},se.nonRobustComputeEdgeDistance=function(t,e,n){var i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);return f.isTrue(!(0===s&&!t.equals(e)),"Invalid distance calculation"),s},se.DONT_INTERSECT=0,se.DO_INTERSECT=1,se.COLLINEAR=2,se.NO_INTERSECTION=0,se.POINT_INTERSECTION=1,se.COLLINEAR_INTERSECTION=2,h(oe,se),e(oe.prototype,{isInSegmentEnvelopes:function(t){var e=new C(this.inputLines[0][0],this.inputLines[0][1]),n=new C(this.inputLines[1][0],this.inputLines[1][1]);return e.contains(t)&&n.contains(t)},computeIntersection:function(){if(3!==arguments.length)return se.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2];return this._isProper=!1,C.intersects(e,n,t)&&0===le.orientationIndex(e,n,t)&&0===le.orientationIndex(n,e,t)?(this._isProper=!0,(t.equals(e)||t.equals(n))&&(this._isProper=!1),this.result=se.POINT_INTERSECTION,null):void(this.result=se.NO_INTERSECTION)},normalizeToMinimum:function(t,e,n,i,r){r.x=this.smallestInAbsValue(t.x,e.x,n.x,i.x),r.y=this.smallestInAbsValue(t.y,e.y,n.y,i.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},safeHCoordinateIntersection:function(t,e,n,i){var r=null;try{r=F.intersection(t,e,n,i)}catch(s){if(!(s instanceof w))throw s;r=oe.nearestEndpoint(t,e,n,i)}finally{}return r},intersection:function(t,e,n,i){var r=this.intersectionWithNormalization(t,e,n,i);return this.isInSegmentEnvelopes(r)||(r=new g(oe.nearestEndpoint(t,e,n,i))),null!==this.precisionModel&&this.precisionModel.makePrecise(r),r},smallestInAbsValue:function(t,e,n,i){var r=t,s=Math.abs(r);return Math.abs(e)<s&&(r=e,s=Math.abs(e)),Math.abs(n)<s&&(r=n,s=Math.abs(n)),Math.abs(i)<s&&(r=i),r},checkDD:function(t,e,n,i,r){var s=M.intersection(t,e,n,i),o=this.isInSegmentEnvelopes(s);A.out.println("DD in env = "+o+"  --------------------- "+s),r.distance(s)>1e-4&&A.out.println("Distance = "+r.distance(s))},intersectionWithNormalization:function(t,e,n,i){var r=new g(t),s=new g(e),o=new g(n),a=new g(i),u=new g;this.normalizeToEnvCentre(r,s,o,a,u);var l=this.safeHCoordinateIntersection(r,s,o,a);return l.x+=u.x,l.y+=u.y,l},computeCollinearIntersection:function(t,e,n,i){var r=C.intersects(t,e,n),s=C.intersects(t,e,i),o=C.intersects(n,i,t),a=C.intersects(n,i,e);return r&&s?(this.intPt[0]=n,this.intPt[1]=i,se.COLLINEAR_INTERSECTION):o&&a?(this.intPt[0]=t,this.intPt[1]=e,se.COLLINEAR_INTERSECTION):r&&o?(this.intPt[0]=n,this.intPt[1]=t,!n.equals(t)||s||a?se.COLLINEAR_INTERSECTION:se.POINT_INTERSECTION):r&&a?(this.intPt[0]=n,this.intPt[1]=e,!n.equals(e)||s||o?se.COLLINEAR_INTERSECTION:se.POINT_INTERSECTION):s&&o?(this.intPt[0]=i,this.intPt[1]=t,!i.equals(t)||r||a?se.COLLINEAR_INTERSECTION:se.POINT_INTERSECTION):s&&a?(this.intPt[0]=i,this.intPt[1]=e,!i.equals(e)||r||o?se.COLLINEAR_INTERSECTION:se.POINT_INTERSECTION):se.NO_INTERSECTION},normalizeToEnvCentre:function(t,e,n,i,r){var s=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,l=n.x<i.x?n.x:i.x,h=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,f=n.y>i.y?n.y:i.y,g=s>l?s:l,d=c>a?a:c,p=o>h?o:h,m=f>u?u:f,v=(g+d)/2,y=(p+m)/2;r.x=v,r.y=y,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},computeIntersect:function(t,e,n,i){if(this._isProper=!1,!C.intersects(t,e,n,i))return se.NO_INTERSECTION;var r=le.orientationIndex(t,e,n),s=le.orientationIndex(t,e,i);if(r>0&&s>0||0>r&&0>s)return se.NO_INTERSECTION;var o=le.orientationIndex(n,i,t),a=le.orientationIndex(n,i,e);return o>0&&a>0||0>o&&0>a?se.NO_INTERSECTION:0===r&&0===s&&0===o&&0===a?this.computeCollinearIntersection(t,e,n,i):(0===r||0===s||0===o||0===a?(this._isProper=!1,t.equals2D(n)||t.equals2D(i)?this.intPt[0]=t:e.equals2D(n)||e.equals2D(i)?this.intPt[0]=e:0===r?this.intPt[0]=new g(n):0===s?this.intPt[0]=new g(i):0===o?this.intPt[0]=new g(t):0===a&&(this.intPt[0]=new g(e))):(this._isProper=!0,this.intPt[0]=this.intersection(t,e,n,i)),se.POINT_INTERSECTION)},interfaces_:function(){return[]},getClass:function(){return oe}}),oe.nearestEndpoint=function(t,e,n,i){var r=t,s=le.distancePointLine(t,n,i),o=le.distancePointLine(e,n,i);return s>o&&(s=o,r=e),o=le.distancePointLine(n,t,e),s>o&&(s=o,r=n),o=le.distancePointLine(i,t,e),s>o&&(s=o,r=i),r},e(ae.prototype,{interfaces_:function(){return[]},getClass:function(){return ae}}),ae.orientationIndex=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=n.x-e.x,o=n.y-e.y;return ae.signOfDet2x2(i,r,s,o)},ae.signOfDet2x2=function(t,e,n,i){var r=null,s=null,o=null,a=0;if(r=1,0===t||0===i)return 0===e||0===n?0:e>0?n>0?-r:r:n>0?r:-r;if(0===e||0===n)return i>0?t>0?r:-r:t>0?-r:r;if(e>0?i>0?i>=e||(r=-r,s=t,t=n,n=s,s=e,e=i,i=s):-i>=e?(r=-r,n=-n,i=-i):(s=t,t=-n,n=s,s=e,e=-i,i=s):i>0?i>=-e?(r=-r,t=-t,e=-e):(s=-t,t=n,n=s,s=-e,e=i,i=s):e>=i?(t=-t,e=-e,n=-n,i=-i):(r=-r,s=-t,t=-n,n=s,s=-e,e=-i,i=s),t>0){if(!(n>0))return r;if(!(n>=t))return r}else{if(n>0)return-r;if(!(t>=n))return-r;r=-r,t=-t,n=-n}for(;;){if(a+=1,o=Math.floor(n/t),n-=o*t,0>(i-=o*e))return-r;if(i>e)return r;if(t>n+n){if(i+i>e)return r}else{if(e>i+i)return-r;n=t-n,i=e-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if(o=Math.floor(t/n),t-=o*n,0>(e-=o*i))return r;if(e>i)return-r;if(n>t+t){if(e+e>i)return-r}else{if(i>e+e)return r;t=n-t,e=i-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}},e(ue.prototype,{countSegment:function(t,e){if(t.x<this.p.x&&e.x<this.p.x)return null;if(this.p.x===e.x&&this.p.y===e.y)return this.isPointOnSegment=!0,null;if(t.y===this.p.y&&e.y===this.p.y){var n=t.x,i=e.x;return n>i&&(n=e.x,i=t.x),this.p.x>=n&&this.p.x<=i&&(this.isPointOnSegment=!0),null}if(t.y>this.p.y&&e.y<=this.p.y||e.y>this.p.y&&t.y<=this.p.y){var r=t.x-this.p.x,s=t.y-this.p.y,o=e.x-this.p.x,a=e.y-this.p.y,u=ae.signOfDet2x2(r,s,o,a);if(0===u)return this.isPointOnSegment=!0,null;s>a&&(u=-u),u>0&&this.crossingCount++}},isPointInPolygon:function(){return this.getLocation()!==L.EXTERIOR},getLocation:function(){return this.isPointOnSegment?L.BOUNDARY:this.crossingCount%2==1?L.INTERIOR:L.EXTERIOR},isOnSegment:function(){return this.isPointOnSegment},interfaces_:function(){return[]},getClass:function(){return ue}}),ue.locatePointInRing=function(){if(arguments[0]instanceof g&&R(arguments[1],D)){for(var t=arguments[0],e=arguments[1],n=new ue(t),i=new g,r=new g,s=1;s<e.size();s++)if(e.getCoordinate(s,i),e.getCoordinate(s-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof g&&arguments[1]instanceof Array){for(var o=arguments[0],a=arguments[1],n=new ue(o),s=1;s<a.length;s++){var i=a[s],r=a[s-1];if(n.countSegment(i,r),n.isOnSegment())return n.getLocation()}return n.getLocation()}},e(le.prototype,{interfaces_:function(){return[]},getClass:function(){return le}}),le.orientationIndex=function(t,e,n){return M.orientationIndex(t,e,n)},le.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++){var r=t[i].x-n,s=t[i+1].y;e+=r*(t[i-1].y-s)}return e/2}if(R(arguments[0],D)){var o=arguments[0],a=o.size();if(3>a)return 0;var u=new g,l=new g,h=new g;o.getCoordinate(0,l),o.getCoordinate(1,h);var n=l.x;h.x-=n;for(var e=0,i=1;a-1>i;i++)u.y=l.y,l.x=h.x,l.y=h.y,o.getCoordinate(i+1,h),h.x-=n,e+=l.x*(u.y-h.y);return e/2}},le.distanceLineLine=function(t,e,n,i){if(t.equals(e))return le.distancePointLine(t,n,i);if(n.equals(i))return le.distancePointLine(i,t,e);var r=!1;if(C.intersects(t,e,n,i)){var s=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(0===s)r=!0;else{var o=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),a=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),u=a/s,l=o/s;(0>l||l>1||0>u||u>1)&&(r=!0)}}else r=!0;return r?T.min(le.distancePointLine(t,n,i),le.distancePointLine(e,n,i),le.distancePointLine(n,t,e),le.distancePointLine(i,t,e)):0},le.isPointInRing=function(t,e){return le.locatePointInRing(t,e)!==L.EXTERIOR},le.computeLength=function(t){var e=t.size();if(1>=e)return 0;var n=0,i=new g;t.getCoordinate(0,i);for(var r=i.x,s=i.y,o=1;e>o;o++){t.getCoordinate(o,i);var a=i.x,u=i.y,l=a-r,h=u-s;n+=Math.sqrt(l*l+h*h),r=a,s=u}return n},le.isCCW=function(t){var e=t.length-1;if(3>e)throw new i("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,s=1;e>=s;s++){var o=t[s];o.y>n.y&&(n=o,r=s)}var a=r;do{0>(a-=1)&&(a=e)}while(t[a].equals2D(n)&&a!==r);var u=r;do{u=(u+1)%e}while(t[u].equals2D(n)&&u!==r);var l=t[a],h=t[u];if(l.equals2D(n)||h.equals2D(n)||l.equals2D(h))return!1;var c=le.computeOrientation(l,n,h);return 0===c?l.x>h.x:c>0},le.locatePointInRing=function(t,e){return ue.locatePointInRing(t,e)},le.distancePointLinePerpendicular=function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(r)*Math.sqrt(i)},le.computeOrientation=function(t,e,n){return le.orientationIndex(t,e,n)},le.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new i("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var s=le.distancePointLine(t,e[r],e[r+1]);n>s&&(n=s)}return n}if(3===arguments.length){var o=arguments[0],a=arguments[1],u=arguments[2];if(a.x===u.x&&a.y===u.y)return o.distance(a);var l=(u.x-a.x)*(u.x-a.x)+(u.y-a.y)*(u.y-a.y),h=((o.x-a.x)*(u.x-a.x)+(o.y-a.y)*(u.y-a.y))/l;if(0>=h)return o.distance(a);if(h>=1)return o.distance(u);var c=((a.y-o.y)*(u.x-a.x)-(a.x-o.x)*(u.y-a.y))/l;return Math.abs(c)*Math.sqrt(l)}},le.isOnLine=function(t,e){for(var n=new oe,i=1;i<e.length;i++){var r=e[i-1],s=e[i];if(n.computeIntersection(t,r,s),n.hasIntersection())return!0}return!1},le.CLOCKWISE=-1,le.RIGHT=le.CLOCKWISE,le.COUNTERCLOCKWISE=1,le.LEFT=le.COUNTERCLOCKWISE,le.COLLINEAR=0,le.STRAIGHT=le.COLLINEAR,e(he.prototype,{minX:function(){return Math.min(this.p0.x,this.p1.x)},orientationIndex:function(){if(arguments[0]instanceof he){var t=arguments[0],e=le.orientationIndex(this.p0,this.p1,t.p0),n=le.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0?Math.max(e,n):0>=e&&0>=n?Math.max(e,n):0}if(arguments[0]instanceof g){var i=arguments[0];return le.orientationIndex(this.p0,this.p1,i)}},toGeometry:function(t){return t.createLineString([this.p0,this.p1])},isVertical:function(){return this.p0.x===this.p1.x},equals:function(t){if(!(t instanceof he))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},intersection:function(t){var e=new oe;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},project:function(){if(arguments[0]instanceof g){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new g(t);var e=this.projectionFactor(t),n=new g;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof he){var i=arguments[0],r=this.projectionFactor(i.p0),s=this.projectionFactor(i.p1);if(r>=1&&s>=1)return null;if(0>=r&&0>=s)return null;var o=this.project(i.p0);0>r&&(o=this.p0),r>1&&(o=this.p1);var a=this.project(i.p1);return 0>s&&(a=this.p0),s>1&&(a=this.p1),new he(o,a)}},normalize:function(){this.p1.compareTo(this.p0)<0&&this.reverse()},angle:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},getCoordinate:function(t){return 0===t?this.p0:this.p1},distancePerpendicular:function(t){return le.distancePointLinePerpendicular(t,this.p0,this.p1)},minY:function(){return Math.min(this.p0.y,this.p1.y)},midPoint:function(){return he.midPoint(this.p0,this.p1)},projectionFactor:function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=e*e+n*n;return 0>=i?r.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/i},closestPoints:function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),i=r.MAX_VALUE,s=null,o=this.closestPoint(t.p0);i=o.distance(t.p0),n[0]=o,n[1]=t.p0;var a=this.closestPoint(t.p1);s=a.distance(t.p1),i>s&&(i=s,n[0]=a,n[1]=t.p1);var u=t.closestPoint(this.p0);s=u.distance(this.p0),i>s&&(i=s,n[0]=this.p0,n[1]=u);var l=t.closestPoint(this.p1);return s=l.distance(this.p1),i>s&&(i=s,n[0]=this.p1,n[1]=l),n},closestPoint:function(t){var e=this.projectionFactor(t);if(e>0&&1>e)return this.project(t);var n=this.p0.distance(t);return this.p1.distance(t)>n?this.p0:this.p1},maxX:function(){return Math.max(this.p0.x,this.p1.x)},getLength:function(){return this.p0.distance(this.p1)},compareTo:function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},reverse:function(){var t=this.p0;this.p0=this.p1,this.p1=t},equalsTopo:function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)},lineIntersection:function(t){try{return F.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof w))throw t}finally{}return null},maxY:function(){return Math.max(this.p0.y,this.p1.y)},pointAlongOffset:function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,o=Math.sqrt(r*r+s*s),a=0,u=0;if(0!==e){if(0>=o)throw new IllegalStateException("Cannot compute offset from zero-length line segment");a=e*r/o,u=e*s/o}return new g(n-u,i+a)},setCoordinates:function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},segmentFraction:function(t){var e=this.projectionFactor(t);return 0>e?e=0:(e>1||r.isNaN(e))&&(e=1),e},toString:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},isHorizontal:function(){return this.p0.y===this.p1.y},distance:function(){if(arguments[0]instanceof he){var t=arguments[0];return le.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof g){var e=arguments[0];return le.distancePointLine(e,this.p0,this.p1)}},pointAlong:function(t){var e=new g;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},hashCode:function(){var t=java.lang.Double.doubleToLongBits(this.p0.x);t^=31*java.lang.Double.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=java.lang.Double.doubleToLongBits(this.p1.x);return n^=31*java.lang.Double.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},interfaces_:function(){return[s,u]},getClass:function(){return he}}),he.midPoint=function(t,e){return new g((t.x+e.x)/2,(t.y+e.y)/2)},he.serialVersionUID=0x2d2172135f411c00,e(ce.prototype,{isIntersects:function(){return!this.isDisjoint()},isCovers:function(){return(ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])||ce.isTrue(this.matrix[L.INTERIOR][L.BOUNDARY])||ce.isTrue(this.matrix[L.BOUNDARY][L.INTERIOR])||ce.isTrue(this.matrix[L.BOUNDARY][L.BOUNDARY]))&&this.matrix[L.EXTERIOR][L.INTERIOR]===lt.FALSE&&this.matrix[L.EXTERIOR][L.BOUNDARY]===lt.FALSE},isCoveredBy:function(){return(ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])||ce.isTrue(this.matrix[L.INTERIOR][L.BOUNDARY])||ce.isTrue(this.matrix[L.BOUNDARY][L.INTERIOR])||ce.isTrue(this.matrix[L.BOUNDARY][L.BOUNDARY]))&&this.matrix[L.INTERIOR][L.EXTERIOR]===lt.FALSE&&this.matrix[L.BOUNDARY][L.EXTERIOR]===lt.FALSE},set:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.matrix[n][i]=lt.toDimensionValue(t.charAt(e))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.matrix[r][s]=o}},isContains:function(){return ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&this.matrix[L.EXTERIOR][L.INTERIOR]===lt.FALSE&&this.matrix[L.EXTERIOR][L.BOUNDARY]===lt.FALSE},setAtLeast:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.setAtLeast(n,i,lt.toDimensionValue(t.charAt(e)))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.matrix[r][s]<o&&(this.matrix[r][s]=o)}},setAtLeastIfValid:function(t,e,n){t>=0&&e>=0&&this.setAtLeast(t,e,n)},isWithin:function(){return ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&this.matrix[L.INTERIOR][L.EXTERIOR]===lt.FALSE&&this.matrix[L.BOUNDARY][L.EXTERIOR]===lt.FALSE},isTouches:function(t,e){return t>e?this.isTouches(e,t):(t===lt.A&&e===lt.A||t===lt.L&&e===lt.L||t===lt.L&&e===lt.A||t===lt.P&&e===lt.A||t===lt.P&&e===lt.L)&&(this.matrix[L.INTERIOR][L.INTERIOR]===lt.FALSE&&(ce.isTrue(this.matrix[L.INTERIOR][L.BOUNDARY])||ce.isTrue(this.matrix[L.BOUNDARY][L.INTERIOR])||ce.isTrue(this.matrix[L.BOUNDARY][L.BOUNDARY])))},isOverlaps:function(t,e){return t===lt.P&&e===lt.P||t===lt.A&&e===lt.A?ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&ce.isTrue(this.matrix[L.INTERIOR][L.EXTERIOR])&&ce.isTrue(this.matrix[L.EXTERIOR][L.INTERIOR]):t===lt.L&&e===lt.L&&(1===this.matrix[L.INTERIOR][L.INTERIOR]&&ce.isTrue(this.matrix[L.INTERIOR][L.EXTERIOR])&&ce.isTrue(this.matrix[L.EXTERIOR][L.INTERIOR]))},isEquals:function(t,e){return t===e&&(ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&this.matrix[L.INTERIOR][L.EXTERIOR]===lt.FALSE&&this.matrix[L.BOUNDARY][L.EXTERIOR]===lt.FALSE&&this.matrix[L.EXTERIOR][L.INTERIOR]===lt.FALSE&&this.matrix[L.EXTERIOR][L.BOUNDARY]===lt.FALSE)},toString:function(){for(var t=new P("123456789"),e=0;3>e;e++)for(var n=0;3>n;n++)t.setCharAt(3*e+n,lt.toDimensionSymbol(this.matrix[e][n]));return t.toString()},setAll:function(t){for(var e=0;3>e;e++)for(var n=0;3>n;n++)this.matrix[e][n]=t},get:function(t,e){return this.matrix[t][e]},transpose:function(){var t=this.matrix[1][0];return this.matrix[1][0]=this.matrix[0][1],this.matrix[0][1]=t,t=this.matrix[2][0],this.matrix[2][0]=this.matrix[0][2],this.matrix[0][2]=t,t=this.matrix[2][1],this.matrix[2][1]=this.matrix[1][2],this.matrix[1][2]=t,this},matches:function(t){if(9!==t.length)throw new i("Should be length 9: "+t);for(var e=0;3>e;e++)for(var n=0;3>n;n++)if(!ce.matches(this.matrix[e][n],t.charAt(3*e+n)))return!1;return!0},add:function(t){for(var e=0;3>e;e++)for(var n=0;3>n;n++)this.setAtLeast(e,n,t.get(e,n))},isDisjoint:function(){return this.matrix[L.INTERIOR][L.INTERIOR]===lt.FALSE&&this.matrix[L.INTERIOR][L.BOUNDARY]===lt.FALSE&&this.matrix[L.BOUNDARY][L.INTERIOR]===lt.FALSE&&this.matrix[L.BOUNDARY][L.BOUNDARY]===lt.FALSE},isCrosses:function(t,e){return t===lt.P&&e===lt.L||t===lt.P&&e===lt.A||t===lt.L&&e===lt.A?ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&ce.isTrue(this.matrix[L.INTERIOR][L.EXTERIOR]):t===lt.L&&e===lt.P||t===lt.A&&e===lt.P||t===lt.A&&e===lt.L?ce.isTrue(this.matrix[L.INTERIOR][L.INTERIOR])&&ce.isTrue(this.matrix[L.EXTERIOR][L.INTERIOR]):t===lt.L&&e===lt.L&&0===this.matrix[L.INTERIOR][L.INTERIOR]},interfaces_:function(){return[o]},getClass:function(){return ce}}),ce.matches=function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],e=arguments[1];return e===lt.SYM_DONTCARE||(e===lt.SYM_TRUE&&(t>=0||t===lt.TRUE)||(e===lt.SYM_FALSE&&t===lt.FALSE||(e===lt.SYM_P&&t===lt.P||(e===lt.SYM_L&&t===lt.L||e===lt.SYM_A&&t===lt.A))))}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var n=arguments[0],i=arguments[1];return new ce(n).matches(i)}},ce.isTrue=function(t){return t>=0||t===lt.TRUE};var ao=Object.freeze({Coordinate:g,CoordinateList:N,Envelope:C,LineSegment:he,GeometryFactory:ne,Geometry:B,Point:Lt,LineString:St,LinearRing:bt,Polygon:Tt,GeometryCollection:ft,MultiPoint:Pt,MultiLineString:gt,MultiPolygon:Ot,Dimension:lt,IntersectionMatrix:ce});e(fe.prototype,{addPoint:function(t){this.ptCount+=1,this.ptCentSum.x+=t.x,this.ptCentSum.y+=t.y},setBasePoint:function(t){null===this.areaBasePt&&(this.areaBasePt=t)},addLineSegments:function(t){for(var e=0,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);if(0!==i){e+=i;var r=(t[n].x+t[n+1].x)/2;this.lineCentSum.x+=i*r;var s=(t[n].y+t[n+1].y)/2;this.lineCentSum.y+=i*s}}this.totalLength+=e,0===e&&t.length>0&&this.addPoint(t[0])},addHole:function(t){for(var e=le.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this.areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},getCentroid:function(){var t=new g;if(Math.abs(this.areasum2)>0)t.x=this.cg3.x/3/this.areasum2,t.y=this.cg3.y/3/this.areasum2;else if(this.totalLength>0)t.x=this.lineCentSum.x/this.totalLength,t.y=this.lineCentSum.y/this.totalLength;else{if(!(this.ptCount>0))return null;t.x=this.ptCentSum.x/this.ptCount,t.y=this.ptCentSum.y/this.ptCount}return t},addShell:function(t){t.length>0&&this.setBasePoint(t[0]);for(var e=!le.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this.areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},addTriangle:function(t,e,n,i){var r=i?1:-1;fe.centroid3(t,e,n,this.triangleCent3);var s=fe.area2(t,e,n);this.cg3.x+=r*s*this.triangleCent3.x,this.cg3.y+=r*s*this.triangleCent3.y,this.areasum2+=r*s},add:function(){if(arguments[0]instanceof Tt){var t=arguments[0];this.addShell(t.getExteriorRing().getCoordinates());for(var e=0;e<t.getNumInteriorRing();e++)this.addHole(t.getInteriorRingN(e).getCoordinates())}else if(arguments[0]instanceof B){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Lt)this.addPoint(n.getCoordinate());else if(n instanceof St)this.addLineSegments(n.getCoordinates());else if(n instanceof Tt){var i=n;this.add(i)}else if(n instanceof ft)for(var r=n,e=0;e<r.getNumGeometries();e++)this.add(r.getGeometryN(e))}},interfaces_:function(){return[]},getClass:function(){return fe}}),fe.area2=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)},fe.centroid3=function(t,e,n,i){return i.x=t.x+e.x+n.x,i.y=t.y+e.y+n.y,null},fe.getCentroid=function(t){return new fe(t).getCentroid()},ge.prototype=new Error,ge.prototype.name="EmptyStackException",de.prototype=new y,de.prototype.add=function(t){return this.array_.push(t),!0},de.prototype.get=function(t){if(0>t||t>=this.size())throw new IndexOutOfBoundsException;return this.array_[t]},de.prototype.push=function(t){return this.array_.push(t),t},de.prototype.pop=function(t){if(0===this.array_.length)throw new ge;return this.array_.pop()},de.prototype.peek=function(){if(0===this.array_.length)throw new ge;return this.array_[this.array_.length-1]},de.prototype.empty=function(){return 0===this.array_.length},de.prototype.isEmpty=function(){return this.empty()},de.prototype.search=function(t){return this.array_.indexOf(t)},de.prototype.size=function(){return this.array_.length},de.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;n>e;e++)t.push(this.array_[e]);return t},e(pe.prototype,{filter:function(t){this.treeSet.contains(t)||(this.list.add(t),this.treeSet.add(t))},getCoordinates:function(){var t=new Array(this.list.size()).fill(null);return this.list.toArray(t)},interfaces_:function(){return[z]},getClass:function(){return pe}}),pe.filterCoordinates=function(t){for(var e=new pe,n=0;n<t.length;n++)e.filter(t[n]);return e.getCoordinates()},e(me.prototype,{preSort:function(t){for(var e=null,n=1;n<t.length;n++)(t[n].y<t[0].y||t[n].y===t[0].y&&t[n].x<t[0].x)&&(e=t[0],t[0]=t[n],t[n]=e);return ut.sort(t,1,t.length,new ve(t[0])),t},computeOctRing:function(t){var e=this.computeOctPts(t),n=new N;return n.add(e,!1),n.size()<3?null:(n.closeRing(),n.toCoordinateArray())},lineOrPolygon:function(t){if(t=this.cleanRing(t),3===t.length)return this.geomFactory.createLineString([t[0],t[1]]);var e=this.geomFactory.createLinearRing(t);return this.geomFactory.createPolygon(e,null)},cleanRing:function(t){f.equals(t[0],t[t.length-1]);for(var e=new I,n=null,i=0;i<=t.length-2;i++){var r=t[i],s=t[i+1];r.equals(s)||null!==n&&this.isBetween(n,r,s)||(e.add(r),n=r)}e.add(t[t.length-1]);var o=new Array(e.size()).fill(null);return e.toArray(o)},isBetween:function(t,e,n){if(0!==le.computeOrientation(t,e,n))return!1;if(t.x!==n.x){if(t.x<=e.x&&e.x<=n.x)return!0;if(n.x<=e.x&&e.x<=t.x)return!0}if(t.y!==n.y){if(t.y<=e.y&&e.y<=n.y)return!0;if(n.y<=e.y&&e.y<=t.y)return!0}return!1},reduce:function(t){var e=this.computeOctRing(t);if(null===e)return t;for(var n=new at,i=0;i<e.length;i++)n.add(e[i]);for(var i=0;i<t.length;i++)le.isPointInRing(t[i],e)||n.add(t[i]);var r=H.toCoordinateArray(n);return r.length<3?this.padArray3(r):r},getConvexHull:function(){if(0===this.inputPts.length)return this.geomFactory.createGeometryCollection(null);if(1===this.inputPts.length)return this.geomFactory.createPoint(this.inputPts[0]);if(2===this.inputPts.length)return this.geomFactory.createLineString(this.inputPts);var t=this.inputPts;this.inputPts.length>50&&(t=this.reduce(this.inputPts));var e=this.preSort(t),n=this.grahamScan(e),i=this.toCoordinateArray(n);return this.lineOrPolygon(i)},padArray3:function(t){for(var e=new Array(3).fill(null),n=0;n<e.length;n++)n<t.length?e[n]=t[n]:e[n]=t[0];return e},computeOctPts:function(t){for(var e=new Array(8).fill(null),n=0;n<e.length;n++)e[n]=t[0];for(var i=1;i<t.length;i++)t[i].x<e[0].x&&(e[0]=t[i]),t[i].x-t[i].y<e[1].x-e[1].y&&(e[1]=t[i]),t[i].y>e[2].y&&(e[2]=t[i]),t[i].x+t[i].y>e[3].x+e[3].y&&(e[3]=t[i]),t[i].x>e[4].x&&(e[4]=t[i]),t[i].x-t[i].y>e[5].x-e[5].y&&(e[5]=t[i]),t[i].y<e[6].y&&(e[6]=t[i]),t[i].x+t[i].y<e[7].x+e[7].y&&(e[7]=t[i]);return e},toCoordinateArray:function(t){for(var e=new Array(t.size()).fill(null),n=0;n<t.size();n++){var i=t.get(n);e[n]=i}return e},grahamScan:function(t){var e=null,n=new de;e=n.push(t[0]),e=n.push(t[1]),e=n.push(t[2]);for(var i=3;i<t.length;i++){for(e=n.pop();!n.empty()&&le.computeOrientation(n.peek(),e,t[i])>0;)e=n.pop();e=n.push(e),e=n.push(t[i])}return e=n.push(t[0]),n},interfaces_:function(){return[]},getClass:function(){return me}}),me.extractCoordinates=function(t){var e=new pe;return t.apply(e),e.getCoordinates()},e(ve.prototype,{compare:function(t,e){var n=t,i=e;return ve.polarCompare(this.origin,n,i)},interfaces_:function(){return[a]},getClass:function(){return ve}}),ve.polarCompare=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=n.x-t.x,o=n.y-t.y,a=le.computeOrientation(t,e,n);if(a===le.COUNTERCLOCKWISE)return 1;if(a===le.CLOCKWISE)return-1;var u=i*i+r*r,l=s*s+o*o;return l>u?-1:u>l?1:0},me.RadialComparator=ve,e(ye.prototype,{transformPoint:function(t,e){return this.factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},transformPolygon:function(t,e){
var n=!0,i=this.transformLinearRing(t.getExteriorRing(),t);null!==i&&i instanceof bt&&!i.isEmpty()||(n=!1);for(var r=new I,s=0;s<t.getNumInteriorRing();s++){var o=this.transformLinearRing(t.getInteriorRingN(s),t);null===o||o.isEmpty()||(o instanceof bt||(n=!1),r.add(o))}if(n)return this.factory.createPolygon(i,r.toArray([]));var a=new I;return null!==i&&a.add(i),a.addAll(r),this.factory.buildGeometry(a)},createCoordinateSequence:function(t){return this.factory.getCoordinateSequenceFactory().create(t)},getInputGeometry:function(){return this.inputGeom},transformMultiLineString:function(t,e){for(var n=new I,i=0;i<t.getNumGeometries();i++){var r=this.transformLineString(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},transformCoordinates:function(t,e){return this.copy(t)},transformLineString:function(t,e){return this.factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},transformMultiPoint:function(t,e){for(var n=new I,i=0;i<t.getNumGeometries();i++){var r=this.transformPoint(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},transformMultiPolygon:function(t,e){for(var n=new I,i=0;i<t.getNumGeometries();i++){var r=this.transformPolygon(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},copy:function(t){return t.copy()},transformGeometryCollection:function(t,e){for(var n=new I,i=0;i<t.getNumGeometries();i++){var r=this.transform(t.getGeometryN(i));null!==r&&(this.pruneEmptyGeometry&&r.isEmpty()||n.add(r))}return this.preserveGeometryCollectionType?this.factory.createGeometryCollection(ne.toGeometryArray(n)):this.factory.buildGeometry(n)},transform:function(t){if(this.inputGeom=t,this.factory=t.getFactory(),t instanceof Lt)return this.transformPoint(t,null);if(t instanceof Pt)return this.transformMultiPoint(t,null);if(t instanceof bt)return this.transformLinearRing(t,null);if(t instanceof St)return this.transformLineString(t,null);if(t instanceof gt)return this.transformMultiLineString(t,null);if(t instanceof Tt)return this.transformPolygon(t,null);if(t instanceof Ot)return this.transformMultiPolygon(t,null);if(t instanceof ft)return this.transformGeometryCollection(t,null);throw new i("Unknown Geometry subtype: "+t.getClass().getName())},transformLinearRing:function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this.factory.createLinearRing(null);var i=n.size();return i>0&&4>i&&!this.preserveType?this.factory.createLineString(n):this.factory.createLinearRing(n)},interfaces_:function(){return[]},getClass:function(){return ye}}),e(xe.prototype,{snapVertices:function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),i=0;n>i;i++){var r=t.get(i),s=this.findSnapForVertex(r,e);null!==s&&(t.set(i,new g(s)),0===i&&this._isClosed&&t.set(t.size()-1,new g(s)))}},findSnapForVertex:function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this.snapTolerance)return e[n]}return null},snapTo:function(t){var e=new N(this.srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},snapSegments:function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var i=0;n>i;i++){var r=e[i],s=this.findSegmentIndexToSnap(r,t);s>=0&&t.add(s+1,new g(r),!1)}},findSegmentIndexToSnap:function(t,e){for(var n=r.MAX_VALUE,i=-1,s=0;s<e.size()-1;s++){if(this.seg.p0=e.get(s),this.seg.p1=e.get(s+1),this.seg.p0.equals2D(t)||this.seg.p1.equals2D(t)){if(this.allowSnappingToSourceVertices)continue;return-1}var o=this.seg.distance(t);o<this.snapTolerance&&n>o&&(n=o,i=s)}return i},setAllowSnappingToSourceVertices:function(t){this.allowSnappingToSourceVertices=t},interfaces_:function(){return[]},getClass:function(){return xe}}),xe.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])},e(Ee.prototype,{snapTo:function(t,e){return new Ie(e,this.extractTargetCoordinates(t)).transform(this.srcGeom)},snapToSelf:function(t,e){var n=this.extractTargetCoordinates(this.srcGeom),i=new Ie(t,n,!0),r=i.transform(this.srcGeom),s=r;return e&&R(s,Rt)&&(s=r.buffer(0)),s},computeSnapTolerance:function(t){return this.computeMinimumSegmentLength(t)/10},extractTargetCoordinates:function(t){for(var e=new at,n=t.getCoordinates(),i=0;i<n.length;i++)e.add(n[i]);return e.toArray(new Array(0).fill(null))},computeMinimumSegmentLength:function(t){for(var e=r.MAX_VALUE,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);e>i&&(e=i)}return e},interfaces_:function(){return[]},getClass:function(){return Ee}}),Ee.snap=function(t,e,n){var i=new Array(2).fill(null),r=new Ee(t);i[0]=r.snapTo(e,n);var s=new Ee(e);return i[1]=s.snapTo(i[0],n),i},Ee.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Ee.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===te.FIXED){var i=1/n.getScale()*2/1.415;i>e&&(e=i)}return e}if(2===arguments.length){var r=arguments[0],s=arguments[1];return Math.min(Ee.computeOverlaySnapTolerance(r),Ee.computeOverlaySnapTolerance(s))}},Ee.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Ee.SNAP_PRECISION_FACTOR},Ee.snapToSelf=function(t,e,n){return new Ee(t).snapToSelf(e,n)},Ee.SNAP_PRECISION_FACTOR=1e-9,h(Ie,ye),e(Ie.prototype,{snapLine:function(t,e){var n=new xe(t,this.snapTolerance);return n.setAllowSnappingToSourceVertices(this.isSelfSnap),n.snapTo(e)},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=this.snapLine(n,this.snapPts);return this.factory.getCoordinateSequenceFactory().create(i)},interfaces_:function(){return[]},getClass:function(){return Ie}}),e(Ne.prototype,{getCommon:function(){return r.longBitsToDouble(this.commonBits)},add:function(t){var e=r.doubleToLongBits(t);return this.isFirst?(this.commonBits=e,this.commonSignExp=Ne.signExpBits(this.commonBits),this.isFirst=!1,null):Ne.signExpBits(e)!==this.commonSignExp?(this.commonBits=0,null):(this.commonMantissaBitsCount=Ne.numCommonMostSigMantissaBits(this.commonBits,e),void(this.commonBits=Ne.zeroLowerBits(this.commonBits,64-(12+this.commonMantissaBitsCount))))},toString:function(){if(1===arguments.length){var t=arguments[0],e=r.longBitsToDouble(t),n=Long.toBinaryString(t),i="0000000000000000000000000000000000000000000000000000000000000000"+n,s=i.substring(i.length-64);return s.substring(0,1)+"  "+s.substring(1,12)+"(exp) "+s.substring(12)+" [ "+e+" ]"}},interfaces_:function(){return[]},getClass:function(){return Ne}}),Ne.getBit=function(t,e){return 0!=(t&1<<e)?1:0},Ne.signExpBits=function(t){return t>>52},Ne.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Ne.numCommonMostSigMantissaBits=function(t,e){for(var n=0,i=52;i>=0;i--){if(Ne.getBit(t,i)!==Ne.getBit(e,i))return n;n++}return 52},e(Ce.prototype,{addCommonBits:function(t){var e=new we(this.commonCoord);t.apply(e),t.geometryChanged()},removeCommonBits:function(t){if(0===this.commonCoord.x&&0===this.commonCoord.y)return t;var e=new g(this.commonCoord);e.x=-e.x,e.y=-e.y;var n=new we(e);return t.apply(n),t.geometryChanged(),t},getCommonCoordinate:function(){return this.commonCoord},add:function(t){t.apply(this.ccFilter),this.commonCoord=this.ccFilter.getCommonCoordinate()},interfaces_:function(){return[]},getClass:function(){return Ce}}),e(Se.prototype,{filter:function(t){this.commonBitsX.add(t.x),this.commonBitsY.add(t.y)},getCommonCoordinate:function(){return new g(this.commonBitsX.getCommon(),this.commonBitsY.getCommon())},interfaces_:function(){return[z]},getClass:function(){return Se}}),e(we.prototype,{filter:function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)},isDone:function(){return!1},isGeometryChanged:function(){return!0},interfaces_:function(){return[ct]},getClass:function(){return we}}),Ce.CommonCoordinateFilter=Se,Ce.Translater=we,e(Le.prototype,{next:function(){if(this.atStart)return this.atStart=!1,Le.isAtomic(this.parent)&&this.index++,this.parent;if(null!==this.subcollectionIterator){if(this.subcollectionIterator.hasNext())return this.subcollectionIterator.next();this.subcollectionIterator=null}if(this.index>=this.max)throw new x;var t=this.parent.getGeometryN(this.index++);return t instanceof ft?(this.subcollectionIterator=new Le(t),this.subcollectionIterator.next()):t},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){if(this.atStart)return!0;if(null!==this.subcollectionIterator){if(this.subcollectionIterator.hasNext())return!0;this.subcollectionIterator=null}return!(this.index>=this.max)},interfaces_:function(){return[p]},getClass:function(){return Le}}),Le.isAtomic=function(t){return!(t instanceof ft)},e(Re.prototype,{locateInternal:function(){if(arguments[0]instanceof g&&arguments[1]instanceof Tt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return L.EXTERIOR;var n=e.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===L.EXTERIOR)return L.EXTERIOR;if(i===L.BOUNDARY)return L.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var s=e.getInteriorRingN(r),o=this.locateInPolygonRing(t,s);if(o===L.INTERIOR)return L.EXTERIOR;if(o===L.BOUNDARY)return L.BOUNDARY}return L.INTERIOR}if(arguments[0]instanceof g&&arguments[1]instanceof St){var a=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(a))return L.EXTERIOR;var l=u.getCoordinates();return u.isClosed()||!a.equals(l[0])&&!a.equals(l[l.length-1])?le.isOnLine(a,l)?L.INTERIOR:L.EXTERIOR:L.BOUNDARY}if(arguments[0]instanceof g&&arguments[1]instanceof Lt){var h=arguments[0];return arguments[1].getCoordinate().equals2D(h)?L.INTERIOR:L.EXTERIOR}},locateInPolygonRing:function(t,e){return e.getEnvelopeInternal().intersects(t)?le.locatePointInRing(t,e.getCoordinates()):L.EXTERIOR},intersects:function(t,e){return this.locate(t,e)!==L.EXTERIOR},updateLocationInfo:function(t){t===L.INTERIOR&&(this.isIn=!0),t===L.BOUNDARY&&this.numBoundaries++},computeLocation:function(t,e){if(e instanceof Lt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof St)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Tt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof gt)for(var n=e,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateInternal(t,r))}else if(e instanceof Ot)for(var s=e,i=0;i<s.getNumGeometries();i++){var o=s.getGeometryN(i);this.updateLocationInfo(this.locateInternal(t,o))}else if(e instanceof ft)for(var a=new Le(e);a.hasNext();){var u=a.next();u!==e&&this.computeLocation(t,u)}},locate:function(t,e){return e.isEmpty()?L.EXTERIOR:e instanceof St?this.locateInternal(t,e):e instanceof Tt?this.locateInternal(t,e):(this.isIn=!1,this.numBoundaries=0,this.computeLocation(t,e),this.boundaryRule.isInBoundary(this.numBoundaries)?L.BOUNDARY:this.numBoundaries>0||this.isIn?L.INTERIOR:L.EXTERIOR)},interfaces_:function(){return[]},getClass:function(){return Re}}),e(Te.prototype,{interfaces_:function(){return[]},getClass:function(){return Te}}),Te.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new i("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof g&&arguments[1]instanceof g){var s=arguments[0],o=arguments[1],a=o.x-s.x,u=o.y-s.y;if(0===a&&0===u)throw new i("Cannot compute the octant for two identical points "+s);return Te.octant(a,u)}},e(Pe.prototype,{getCoordinates:function(){},size:function(){},getCoordinate:function(t){},isClosed:function(){},setData:function(t){},getData:function(){},interfaces_:function(){return[]},getClass:function(){return Pe}}),e(be.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(t){return this.pts[t]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(t){return t===this.pts.length-1?-1:Te.octant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this.data=t},getData:function(){return this.data},toString:function(){return re.toLineString(new Gt(this.pts))},interfaces_:function(){return[Pe]},getClass:function(){return be}}),e(Oe.prototype,{getBounds:function(){},interfaces_:function(){return[]},getClass:function(){return Oe}}),e(_e.prototype,{getItem:function(){return this.item},getBounds:function(){return this.bounds},interfaces_:function(){return[Oe,u]},getClass:function(){return _e}}),e(Me.prototype,{poll:function(){if(this.isEmpty())return null;var t=this.items.get(1);return this.items.set(1,this.items.get(this._size)),this._size-=1,this.reorder(1),t},size:function(){return this._size},reorder:function(t){for(var e=null,n=this.items.get(t);2*t<=this._size&&(e=2*t,e!==this._size&&this.items.get(e+1).compareTo(this.items.get(e))<0&&e++,this.items.get(e).compareTo(n)<0);t=e)this.items.set(t,this.items.get(e));this.items.set(t,n)},clear:function(){this._size=0,this.items.clear()},isEmpty:function(){return 0===this._size},add:function(t){this.items.add(null),this._size+=1;var e=this._size;for(this.items.set(0,t);t.compareTo(this.items.get(Math.trunc(e/2)))<0;e/=2)this.items.set(e,this.items.get(Math.trunc(e/2)));this.items.set(e,t)},interfaces_:function(){return[]},getClass:function(){return Me}}),e(De.prototype,{visitItem:function(t){},interfaces_:function(){return[]},getClass:function(){return De}}),e(Ae.prototype,{insert:function(t,e){},remove:function(t,e){},query:function(){1===arguments.length?arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},interfaces_:function(){return[]},getClass:function(){return Ae}}),e(Fe.prototype,{getLevel:function(){return this.level},size:function(){return this.childBoundables.size()},getChildBoundables:function(){return this.childBoundables},addChildBoundable:function(t){f.isTrue(null===this.bounds),this.childBoundables.add(t)},isEmpty:function(){return this.childBoundables.isEmpty()},getBounds:function(){return null===this.bounds&&(this.bounds=this.computeBounds()),this.bounds},interfaces_:function(){return[Oe,u]},getClass:function(){return Fe}}),Fe.serialVersionUID=0x5a1e55ec41369800;var uo={reverseOrder:function(){return{compare:function(t,e){return e.compareTo(t)}}},min:function(t){return uo.sort(t),t.get(0)},sort:function(t,e){var n=t.toArray();e?ut.sort(n,e):ut.sort(n);for(var i=t.iterator(),r=0,s=n.length;s>r;r++)i.next(),i.set(n[r])},singletonList:function(t){var e=new I;return e.add(t),e}};e(Ge.prototype,{expandToQueue:function(t,e){var n=Ge.isComposite(this.boundable1),r=Ge.isComposite(this.boundable2);if(n&&r)return Ge.area(this.boundable1)>Ge.area(this.boundable2)?(this.expand(this.boundable1,this.boundable2,t,e),null):(this.expand(this.boundable2,this.boundable1,t,e),null);if(n)return this.expand(this.boundable1,this.boundable2,t,e),null;if(r)return this.expand(this.boundable2,this.boundable1,t,e),null;throw new i("neither boundable is composite")},isLeaves:function(){return!(Ge.isComposite(this.boundable1)||Ge.isComposite(this.boundable2))},compareTo:function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},expand:function(t,e,n,i){for(var r=t.getChildBoundables(),s=r.iterator();s.hasNext();){var o=s.next(),a=new Ge(o,e,this.itemDistance);a.getDistance()<i&&n.add(a)}},getBoundable:function(t){return 0===t?this.boundable1:this.boundable2},getDistance:function(){return this._distance},distance:function(){return this.isLeaves()?this.itemDistance.distance(this.boundable1,this.boundable2):this.boundable1.getBounds().distance(this.boundable2.getBounds())},interfaces_:function(){return[s]},getClass:function(){return Ge}}),Ge.area=function(t){return t.getBounds().getArea()},Ge.isComposite=function(t){return t instanceof Fe},e(qe.prototype,{getNodeCapacity:function(){return this.nodeCapacity},lastNode:function(t){return t.get(t.size()-1)},size:function t(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.root));if(1===arguments.length){for(var e=arguments[0],t=0,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof Fe?t+=this.size(i):i instanceof _e&&(t+=1)}return t}},removeItem:function(t,e){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof _e&&r.getItem()===e&&(n=r)}return null!==n&&(t.getChildBoundables().remove(n),!0)},itemsTree:function(){if(0===arguments.length){this.build();var t=this.itemsTree(this.root);return null===t?new I:t}if(1===arguments.length){for(var e=arguments[0],n=new I,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Fe){var s=this.itemsTree(r);null!==s&&n.add(s)}else r instanceof _e?n.add(r.getItem()):f.shouldNeverReachHere()}return n.size()<=0?null:n}},insert:function(t,e){f.isTrue(!this.built,"Cannot insert items into an STR packed R-tree after it has been built."),this.itemBoundables.add(new _e(t,e))},boundablesAtLevel:function(){if(1===arguments.length){var t=arguments[0],e=new I;return this.boundablesAtLevel(t,this.root,e),e}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(f.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var o=s.next();o instanceof Fe?this.boundablesAtLevel(n,o,r):(f.isTrue(o instanceof _e),-1===n&&r.add(o))}return null}},query:function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new I;return this.isEmpty()?e:(this.getIntersectsOp().intersects(this.root.getBounds(),t)&&this.query(t,this.root,e),e)}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.root.getBounds(),n)&&this.query(n,this.root,i)}else if(3===arguments.length)if(R(arguments[2],De)&&arguments[0]instanceof Object&&arguments[1]instanceof Fe)for(var r=arguments[0],s=arguments[1],o=arguments[2],a=s.getChildBoundables(),u=0;u<a.size();u++){var l=a.get(u);this.getIntersectsOp().intersects(l.getBounds(),r)&&(l instanceof Fe?this.query(r,l,o):l instanceof _e?o.visitItem(l.getItem()):f.shouldNeverReachHere())}else if(R(arguments[2],y)&&arguments[0]instanceof Object&&arguments[1]instanceof Fe)for(var h=arguments[0],c=arguments[1],g=arguments[2],a=c.getChildBoundables(),u=0;u<a.size();u++){var l=a.get(u);this.getIntersectsOp().intersects(l.getBounds(),h)&&(l instanceof Fe?this.query(h,l,g):l instanceof _e?g.add(l.getItem()):f.shouldNeverReachHere())}},build:function(){return this.built?null:(this.root=this.itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this.itemBoundables,-1),this.itemBoundables=null,void(this.built=!0))},getRoot:function(){return this.build(),this.root},remove:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.root.getBounds(),t)&&this.remove(t,this.root,e)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=this.removeItem(i,r);if(s)return!0;for(var o=null,a=i.getChildBoundables().iterator();a.hasNext();){var u=a.next();if(this.getIntersectsOp().intersects(u.getBounds(),n)&&u instanceof Fe&&(s=this.remove(n,u,r))){o=u;break}}return null!==o&&o.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(o),s}},createHigherLevels:function(t,e){f.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},depth:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.root));if(1===arguments.length){for(var t=arguments[0],e=0,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof Fe){var r=this.depth(i);r>e&&(e=r)}}return e+1}},createParentBoundables:function(t,e){f.isTrue(!t.isEmpty());var n=new I;n.add(this.createNode(e));var i=new I(t);uo.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var s=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(s)}return n},isEmpty:function(){return this.built?this.root.isEmpty():this.itemBoundables.isEmpty()},interfaces_:function(){return[u]},getClass:function(){return qe}}),qe.compareDoubles=function(t,e){return t>e?1:e>t?-1:0},qe.IntersectsOp=Be,qe.serialVersionUID=-0x35ef64c82d4c5400,qe.DEFAULT_NODE_CAPACITY=10,e(ze.prototype,{distance:function(t,e){},interfaces_:function(){return[]},getClass:function(){return ze}}),h(Ve,qe),e(Ve.prototype,{createParentBoundablesFromVerticalSlices:function(t,e){f.isTrue(t.length>0);for(var n=new I,i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n},createNode:function(t){return new ke(t)},size:function(){return 0===arguments.length?qe.prototype.size.call(this):qe.prototype.size.apply(this,arguments)},insert:function(){if(2!==arguments.length)return qe.prototype.insert.apply(this,arguments);var t=arguments[0],e=arguments[1];return t.isNull()?null:void qe.prototype.insert.call(this,t,e)},getIntersectsOp:function(){return Ve.intersectsOp},verticalSlices:function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),r=t.iterator(),s=0;e>s;s++){i[s]=new I;for(var o=0;r.hasNext()&&n>o;){var a=r.next();i[s].add(a),o++}}return i},query:function(){if(1===arguments.length){var t=arguments[0];return qe.prototype.query.call(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];qe.prototype.query.call(this,e,n)}else if(3===arguments.length)if(R(arguments[2],De)&&arguments[0]instanceof Object&&arguments[1]instanceof Fe){var i=arguments[0],r=arguments[1],s=arguments[2];qe.prototype.query.call(this,i,r,s)}else if(R(arguments[2],y)&&arguments[0]instanceof Object&&arguments[1]instanceof Fe){var o=arguments[0],a=arguments[1],u=arguments[2];qe.prototype.query.call(this,o,a,u)}},getComparator:function(){return Ve.yComparator},createParentBoundablesFromVerticalSlice:function(t,e){return qe.prototype.createParentBoundables.call(this,t,e)},remove:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return qe.prototype.remove.call(this,t,e)}return qe.prototype.remove.apply(this,arguments)},depth:function(){return 0===arguments.length?qe.prototype.depth.call(this):qe.prototype.depth.apply(this,arguments)},createParentBoundables:function(t,e){f.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new I(t);uo.sort(i,Ve.xComparator);var r=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(r,e)},nearestNeighbour:function(){if(1===arguments.length){if(R(arguments[0],ze)){var t=arguments[0],e=new Ge(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof Ge){var n=arguments[0];return this.nearestNeighbour(n,r.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof Ve&&R(arguments[1],ze)){var i=arguments[0],s=arguments[1],e=new Ge(this.getRoot(),i.getRoot(),s);return this.nearestNeighbour(e)}if(arguments[0]instanceof Ge&&"number"==typeof arguments[1]){var o=arguments[0],a=arguments[1],u=a,l=null,h=new Me;for(h.add(o);!h.isEmpty()&&u>0;){var c=h.poll(),f=c.getDistance();if(f>=u)break;c.isLeaves()?(u=f,l=c):c.expandToQueue(h,u)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var g=arguments[0],d=arguments[1],p=arguments[2],m=new _e(g,d),e=new Ge(this.getRoot(),m,p);return this.nearestNeighbour(e)[0]}},interfaces_:function(){return[Ae,u]},getClass:function(){return Ve}}),Ve.centreX=function(t){return Ve.avg(t.getMinX(),t.getMaxX())},Ve.avg=function(t,e){return(t+e)/2},Ve.centreY=function(t){return Ve.avg(t.getMinY(),t.getMaxY())},h(ke,Fe),e(ke.prototype,{computeBounds:function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new C(n.getBounds()):t.expandToInclude(n.getBounds())}return t},interfaces_:function(){return[]},getClass:function(){return ke}}),Ve.STRtreeNode=ke,Ve.serialVersionUID=0x39920f7d5f261e0,Ve.xComparator={interfaces_:function(){return[a]},compare:function(t,e){return qe.compareDoubles(Ve.centreX(t.getBounds()),Ve.centreX(e.getBounds()))}},Ve.yComparator={interfaces_:function(){return[a]},compare:function(t,e){return qe.compareDoubles(Ve.centreY(t.getBounds()),Ve.centreY(e.getBounds()))}},Ve.intersectsOp={interfaces_:function(){return[IntersectsOp]},intersects:function(t,e){return t.intersects(e)}},Ve.DEFAULT_NODE_CAPACITY=10,e(Ye.prototype,{interfaces_:function(){return[]},getClass:function(){return Ye}}),Ye.relativeSign=function(t,e){return e>t?-1:t>e?1:0},Ye.compare=function(t,e,n){if(e.equals2D(n))return 0;var i=Ye.relativeSign(e.x,n.x),r=Ye.relativeSign(e.y,n.y);switch(t){case 0:return Ye.compareValue(i,r);case 1:return Ye.compareValue(r,i);case 2:return Ye.compareValue(r,-i);case 3:return Ye.compareValue(-i,r);case 4:return Ye.compareValue(-i,-r);case 5:return Ye.compareValue(-r,-i);case 6:return Ye.compareValue(-r,i);case 7:return Ye.compareValue(i,-r)}return f.shouldNeverReachHere("invalid octant value"),0},Ye.compareValue=function(t,e){return 0>t?-1:t>0?1:0>e?-1:e>0?1:0},e(Ue.prototype,{getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},compareTo:function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Ye.compare(this.segmentOctant,this.coord,e.coord)},isEndPoint:function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},isInterior:function(){return this._isInterior},interfaces_:function(){return[s]},getClass:function(){return Ue}}),e(Xe.prototype,{getSplitCoordinates:function(){var t=new N;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()},addCollapsedNodes:function(){var t=new I;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this.edge.getCoordinate(n),n)}},print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},findCollapsesFromExistingVertices:function(t){for(var e=0;e<this.edge.size()-2;e++){var n=this.edge.getCoordinate(e),i=(this.edge.getCoordinate(e+1),this.edge.getCoordinate(e+2));n.equals2D(i)&&t.add(new b(e+1))}},addEdgeCoordinates:function(t,e,n){var i=e.segmentIndex-t.segmentIndex+2,r=this.edge.getCoordinate(e.segmentIndex),s=e.isInterior()||!e.coord.equals2D(r);s||i--,n.add(new g(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this.edge.getCoordinate(o));s&&n.add(new g(e.coord))},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},findCollapseIndex:function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,1===i&&(n[0]=t.segmentIndex+1,!0)},findCollapsesFromInsertedNodes:function(t){for(var e=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,e)&&t.add(new b(e[0])),i=r}},getEdge:function(){return this.edge},addEndpoints:function(){var t=this.edge.size()-1;this.add(this.edge.getCoordinate(0),0),this.add(this.edge.getCoordinate(t),t)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new g(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)s[o++]=this.edge.getCoordinate(a);return r&&(s[o]=new g(e.coord)),new je(s,this.edge.getData())},add:function(t,e){var n=new Ue(this.edge,t,e,this.edge.getSegmentOctant(e)),i=this.nodeMap.get(n);return null!==i?(f.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this.nodeMap.put(n,n),n)},checkSplitEdgesCorrectness:function(t){var e=this.edge.getCoordinates(),n=t.get(0),i=n.getCoordinate(0);if(!i.equals2D(e[0]))throw new l("bad split edge start point at "+i);var r=t.get(t.size()-1),s=r.getCoordinates(),o=s[s.length-1];if(!o.equals2D(e[e.length-1]))throw new l("bad split edge end point at "+o)},interfaces_:function(){return[]},getClass:function(){return Xe}}),e(He.prototype,{next:function(){return null===this.currNode?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):null===this.nextNode?null:this.nextNode.segmentIndex===this.currNode.segmentIndex?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):(this.nextNode.segmentIndex,this.currNode.segmentIndex,null)},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){return null!==this.nextNode},readNextNode:function(){this.nodeIt.hasNext()?this.nextNode=this.nodeIt.next():this.nextNode=null},interfaces_:function(){return[p]},getClass:function(){return He}}),e(We.prototype,{addIntersection:function(t,e){},interfaces_:function(){return[Pe]},getClass:function(){return We}}),e(je.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(t){return this.pts[t]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(t){return t===this.pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this.data=t},safeOctant:function(t,e){return t.equals2D(e)?0:Te.octant(t,e)},getData:function(){return this.data},addIntersection:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=(arguments[2],arguments[3]),s=new g(n.getIntersection(r));this.addIntersection(s,i)}},toString:function(){return re.toLineString(new Gt(this.pts))},getNodeList:function(){return this.nodeList},addIntersectionNode:function(t,e){var n=e,i=n+1;if(i<this.pts.length){var r=this.pts[i];t.equals2D(r)&&(n=i)}return this.nodeList.add(t,n)},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[We]},getClass:function(){return je}}),je.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new I;return je.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var s=r.next();s.getNodeList().addSplitEdges(i)}},e(Ke.prototype,{overlap:function(){if(2===arguments.length)arguments[0],arguments[1];else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];t.getLineSegment(e,this.overlapSeg1),n.getLineSegment(i,this.overlapSeg2),this.overlap(this.overlapSeg1,this.overlapSeg2)}},interfaces_:function(){return[]},getClass:function(){return Ke}}),e(Ze.prototype,{getLineSegment:function(t,e){e.p0=this.pts[t],e.p1=this.pts[t+1]},computeSelect:function(t,e,n,i){var r=this.pts[e],s=this.pts[n];if(i.tempEnv1.init(r,s),n-e==1)return i.select(this,e),null;if(!t.intersects(i.tempEnv1))return null;var o=Math.trunc((e+n)/2);o>e&&this.computeSelect(t,e,o,i),n>o&&this.computeSelect(t,o,n,i)},getCoordinates:function(){for(var t=new Array(this.end-this.start+1).fill(null),e=0,n=this.start;n<=this.end;n++)t[e++]=this.pts[n];return t},computeOverlaps:function(t,e){this.computeOverlapsInternal(this.start,this.end,t,t.start,t.end,e)},setId:function(t){this.id=t},select:function(t,e){this.computeSelect(t,this.start,this.end,e)},getEnvelope:function(){
if(null===this.env){var t=this.pts[this.start],e=this.pts[this.end];this.env=new C(t,e)}return this.env},getEndIndex:function(){return this.end},getStartIndex:function(){return this.start},getContext:function(){return this.context},getId:function(){return this.id},computeOverlapsInternal:function(t,e,n,i,r,s){var o=this.pts[t],a=this.pts[e],u=n.pts[i],l=n.pts[r];if(e-t==1&&r-i==1)return s.overlap(this,t,n,i),null;if(s.tempEnv1.init(o,a),s.tempEnv2.init(u,l),!s.tempEnv1.intersects(s.tempEnv2))return null;var h=Math.trunc((t+e)/2),c=Math.trunc((i+r)/2);h>t&&(c>i&&this.computeOverlapsInternal(t,h,n,i,c,s),r>c&&this.computeOverlapsInternal(t,h,n,c,r,s)),e>h&&(c>i&&this.computeOverlapsInternal(h,e,n,i,c,s),r>c&&this.computeOverlapsInternal(h,e,n,c,r,s))},interfaces_:function(){return[]},getClass:function(){return Ze}}),e(Qe.prototype,{interfaces_:function(){return[]},getClass:function(){return Qe}}),Qe.isNorthern=function(t){return t===Qe.NE||t===Qe.NW},Qe.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Qe.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=e>t?t:e,i=t>e?t:e;return 0===n&&3===i?3:n},Qe.isInHalfPlane=function(t,e){return e===Qe.SE?t===Qe.SE||t===Qe.SW:t===e||t===e+1},Qe.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new i("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Qe.NE:Qe.SE:e>=0?Qe.NW:Qe.SW}if(arguments[0]instanceof g&&arguments[1]instanceof g){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new i("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Qe.NE:Qe.SE:r.y>=n.y?Qe.NW:Qe.SW}},Qe.NE=0,Qe.NW=1,Qe.SW=2,Qe.SE=3,e(Je.prototype,{interfaces_:function(){return[]},getClass:function(){return Je}}),Je.getChainStartIndices=function(t){var e=0,n=new I;n.add(new b(e));do{var i=Je.findChainEnd(t,e);n.add(new b(i)),e=i}while(e<t.length-1);return Je.toIntArray(n)},Je.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=Qe.quadrant(t[n],t[n+1]),r=e+1;r<t.length;){if(!t[r-1].equals2D(t[r])){if(Qe.quadrant(t[r-1],t[r])!==i)break}r++}return r-1},Je.getChains=function(){if(1===arguments.length){var t=arguments[0];return Je.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new I,r=Je.getChainStartIndices(e),s=0;s<r.length-1;s++){var o=new Ze(e,r[s],r[s+1],n);i.add(o)}return i}},Je.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},e($e.prototype,{computeNodes:function(t){},getNodedSubstrings:function(){},interfaces_:function(){return[]},getClass:function(){return $e}}),e(tn.prototype,{setSegmentIntersector:function(t){this.segInt=t},interfaces_:function(){return[$e]},getClass:function(){return tn}}),h(en,tn),e(en.prototype,{getMonotoneChains:function(){return this.monoChains},getNodedSubstrings:function(){return je.getNodedSubstrings(this.nodedSegStrings)},getIndex:function(){return this.index},add:function(t){for(var e=Je.getChains(t.getCoordinates(),t),n=e.iterator();n.hasNext();){var i=n.next();i.setId(this.idCounter++),this.index.insert(i.getEnvelope(),i),this.monoChains.add(i)}},computeNodes:function(t){this.nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},intersectChains:function(){for(var t=new nn(this.segInt),e=this.monoChains.iterator();e.hasNext();)for(var n=e.next(),i=this.index.query(n.getEnvelope()),r=i.iterator();r.hasNext();){var s=r.next();if(s.getId()>n.getId()&&(n.computeOverlaps(s,t),this.nOverlaps++),this.segInt.isDone())return null}},interfaces_:function(){return[]},getClass:function(){return en}}),h(nn,Ke),e(nn.prototype,{overlap:function(){if(4!==arguments.length)return Ke.prototype.overlap.apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],r=t.getContext(),s=n.getContext();this.si.processIntersections(r,e,s,i)},interfaces_:function(){return[]},getClass:function(){return nn}}),en.SegmentOverlapAction=nn,h(rn,l),e(rn.prototype,{getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return rn}}),rn.msgWithCoord=function(t,e){return null!==e?t+" [ "+e+" ]":t},e(sn.prototype,{processIntersections:function(t,e,n,i){},isDone:function(){},interfaces_:function(){return[]},getClass:function(){return sn}}),e(on.prototype,{getInteriorIntersection:function(){return this.interiorIntersection},setCheckEndSegmentsOnly:function(t){this.isCheckEndSegmentsOnly=t},getIntersectionSegments:function(){return this.intSegments},count:function(){return this.intersectionCount},getIntersections:function(){return this.intersections},setFindAllIntersections:function(t){this.findAllIntersections=t},setKeepIntersections:function(t){this.keepIntersections=t},processIntersections:function(t,e,n,i){if(!this.findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===i)return null;if(this.isCheckEndSegmentsOnly){if(!(this.isEndSegment(t,e)||this.isEndSegment(n,i)))return null}var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.li.computeIntersection(r,s,o,a),this.li.hasIntersection()&&this.li.isInteriorIntersection()&&(this.intSegments=new Array(4).fill(null),this.intSegments[0]=r,this.intSegments[1]=s,this.intSegments[2]=o,this.intSegments[3]=a,this.interiorIntersection=this.li.getIntersection(0),this.keepIntersections&&this.intersections.add(this.interiorIntersection),this.intersectionCount++)},isEndSegment:function(t,e){return 0===e||e>=t.size()-2},hasIntersection:function(){return null!==this.interiorIntersection},isDone:function(){return!this.findAllIntersections&&null!==this.interiorIntersection},interfaces_:function(){return[sn]},getClass:function(){return on}}),on.createAllIntersectionsFinder=function(t){var e=new on(t);return e.setFindAllIntersections(!0),e},on.createAnyIntersectionFinder=function(t){return new on(t)},on.createIntersectionCounter=function(t){var e=new on(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e},e(an.prototype,{execute:function(){return null!==this.segInt?null:void this.checkInteriorIntersections()},getIntersections:function(){return this.segInt.getIntersections()},isValid:function(){return this.execute(),this._isValid},setFindAllIntersections:function(t){this.findAllIntersections=t},checkInteriorIntersections:function(){this._isValid=!0,this.segInt=new on(this.li),this.segInt.setFindAllIntersections(this.findAllIntersections);var t=new en;return t.setSegmentIntersector(this.segInt),t.computeNodes(this.segStrings),this.segInt.hasIntersection()?(this._isValid=!1,null):void 0},checkValid:function(){if(this.execute(),!this._isValid)throw new rn(this.getErrorMessage(),this.segInt.getInteriorIntersection())},getErrorMessage:function(){if(this._isValid)return"no intersections found";var t=this.segInt.getIntersectionSegments();return"found non-noded intersection between "+re.toLineString(t[0],t[1])+" and "+re.toLineString(t[2],t[3])},interfaces_:function(){return[]},getClass:function(){return an}}),an.computeIntersections=function(t){var e=new an(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()},e(un.prototype,{checkValid:function(){this.nv.checkValid()},interfaces_:function(){return[]},getClass:function(){return un}}),un.toSegmentStrings=function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next();e.add(new be(i.getCoordinates(),i))}return e},un.checkValid=function(t){new un(t).checkValid()},e(ln.prototype,{map:function(t){for(var e=new I,n=0;n<t.getNumGeometries();n++){var i=this.mapOp.map(t.getGeometryN(n));i.isEmpty()||e.add(i)}return t.getFactory().createGeometryCollection(ne.toGeometryArray(e))},interfaces_:function(){return[]},getClass:function(){return ln}}),ln.map=function(t,e){return new ln(e).map(t)},e(hn.prototype,{interfaces_:function(){return[]},getClass:function(){return hn}}),hn.opposite=function(t){return t===hn.LEFT?hn.RIGHT:t===hn.RIGHT?hn.LEFT:t},hn.ON=0,hn.LEFT=1,hn.RIGHT=2,e(cn.prototype,{setAllLocations:function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},isNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==L.NONE)return!1;return!0},setAllLocationsIfNull:function(t){for(var e=0;e<this.location.length;e++)this.location[e]===L.NONE&&(this.location[e]=t)},isLine:function(){return 1===this.location.length},merge:function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[hn.ON]=this.location[hn.ON],e[hn.LEFT]=L.NONE,e[hn.RIGHT]=L.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===L.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},getLocations:function(){return this.location},flip:function(){if(this.location.length<=1)return null;var t=this.location[hn.LEFT];this.location[hn.LEFT]=this.location[hn.RIGHT],this.location[hn.RIGHT]=t},toString:function(){var t=new P;return this.location.length>1&&t.append(L.toLocationSymbol(this.location[hn.LEFT])),t.append(L.toLocationSymbol(this.location[hn.ON])),this.location.length>1&&t.append(L.toLocationSymbol(this.location[hn.RIGHT])),t.toString()},setLocations:function(t,e,n){this.location[hn.ON]=t,this.location[hn.LEFT]=e,this.location[hn.RIGHT]=n},get:function(t){return t<this.location.length?this.location[t]:L.NONE},isArea:function(){return this.location.length>1},isAnyNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===L.NONE)return!0;return!1},setLocation:function(){if(1===arguments.length){var t=arguments[0];this.setLocation(hn.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},init:function(t){this.location=new Array(t).fill(null),this.setAllLocations(L.NONE)},isEqualOnSide:function(t,e){return this.location[e]===t.location[e]},allPositionsEqual:function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},interfaces_:function(){return[]},getClass:function(){return cn}}),e(fn.prototype,{getGeometryCount:function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},setAllLocations:function(t,e){this.elt[t].setAllLocations(e)},isNull:function(t){return this.elt[t].isNull()},setAllLocationsIfNull:function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},isLine:function(t){return this.elt[t].isLine()},merge:function(t){for(var e=0;2>e;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new cn(t.elt[e]):this.elt[e].merge(t.elt[e])},flip:function(){this.elt[0].flip(),this.elt[1].flip()},getLocation:function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(hn.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},toString:function(){var t=new P;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},isArea:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},isAnyNull:function(t){return this.elt[t].isAnyNull()},setLocation:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(hn.ON,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},isEqualOnSide:function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},allPositionsEqual:function(t,e){return this.elt[t].allPositionsEqual(e)},toLine:function(t){this.elt[t].isArea()&&(this.elt[t]=new cn(this.elt[t].location[0]))},interfaces_:function(){return[]},getClass:function(){return fn}}),fn.toLineLabel=function(t){for(var e=new fn(L.NONE),n=0;2>n;n++)e.setLocation(n,t.getLocation(n));return e},e(gn.prototype,{computeRing:function(){if(null!==this.ring)return null;for(var t=new Array(this.pts.size()).fill(null),e=0;e<this.pts.size();e++)t[e]=this.pts.get(e);this.ring=this.geometryFactory.createLinearRing(t),this._isHole=le.isCCW(this.ring.getCoordinates())},isIsolated:function(){return 1===this.label.getGeometryCount()},computePoints:function(t){this.startDe=t;var e=t,n=!0;do{if(null===e)throw new rn("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new rn("Directed Edge visited twice during ring-building at "+e.getCoordinate());this.edges.add(e);var i=e.getLabel();f.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this.startDe)},getLinearRing:function(){return this.ring},getCoordinate:function(t){return this.pts.get(t)},computeMaxNodeDegree:function(){this.maxNodeDegree=0;var t=this.startDe;do{var e=t.getNode(),n=e.getEdges().getOutgoingDegree(this);n>this.maxNodeDegree&&(this.maxNodeDegree=n),t=this.getNext(t)}while(t!==this.startDe);this.maxNodeDegree*=2},addPoints:function(t,e,n){var i=t.getCoordinates();if(e){var r=1;n&&(r=0);for(var s=r;s<i.length;s++)this.pts.add(i[s])}else{var r=i.length-2;n&&(r=i.length-1);for(var s=r;s>=0;s--)this.pts.add(i[s])}},isHole:function(){return this._isHole},setInResult:function(){var t=this.startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this.startDe)},containsPoint:function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!le.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this.holes.iterator();n.hasNext();){if(n.next().containsPoint(t))return!1}return!0},addHole:function(t){this.holes.add(t)},isShell:function(){return null===this.shell},getLabel:function(){return this.label},getEdges:function(){return this.edges},getMaxNodeDegree:function(){return this.maxNodeDegree<0&&this.computeMaxNodeDegree(),this.maxNodeDegree},getShell:function(){return this.shell},mergeLabel:function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=e.getLocation(n,hn.RIGHT);if(i===L.NONE)return null;if(this.label.getLocation(n)===L.NONE)return this.label.setLocation(n,i),null}},setShell:function(t){this.shell=t,null!==t&&t.addHole(this)},toPolygon:function(t){for(var e=new Array(this.holes.size()).fill(null),n=0;n<this.holes.size();n++)e[n]=this.holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},interfaces_:function(){return[]},getClass:function(){return gn}}),h(dn,gn),e(dn.prototype,{setEdgeRing:function(t,e){t.setMinEdgeRing(e)},getNext:function(t){return t.getNextMin()},interfaces_:function(){return[]},getClass:function(){return dn}}),h(pn,gn),e(pn.prototype,{buildMinimalRings:function(){var t=new I,e=this.startDe;do{if(null===e.getMinEdgeRing()){var n=new dn(e,this.geometryFactory);t.add(n)}e=e.getNext()}while(e!==this.startDe);return t},setEdgeRing:function(t,e){t.setEdgeRing(e)},linkDirectedEdgesForMinimalEdgeRings:function(){var t=this.startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this.startDe)},getNext:function(t){return t.getNext()},interfaces_:function(){return[]},getClass:function(){return pn}}),e(mn.prototype,{setVisited:function(t){this._isVisited=t},setInResult:function(t){this._isInResult=t},isCovered:function(){return this._isCovered},isCoveredSet:function(){return this._isCoveredSet},setLabel:function(t){this.label=t},getLabel:function(){return this.label},setCovered:function(t){this._isCovered=t,this._isCoveredSet=!0},updateIM:function(t){f.isTrue(this.label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},isInResult:function(){return this._isInResult},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return mn}}),h(vn,mn),e(vn.prototype,{isIncidentEdgeInResult:function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();){if(t.next().getEdge().isInResult())return!0}return!1},isIsolated:function(){return 1===this.label.getGeometryCount()},getCoordinate:function(){return this.coord},print:function(t){t.println("node "+this.coord+" lbl: "+this.label)},computeIM:function(t){},computeMergedLocation:function(t,e){var n=L.NONE;if(n=this.label.getLocation(e),!t.isNull(e)){var i=t.getLocation(e);n!==L.BOUNDARY&&(n=i)}return n},setLabel:function(){if(2!==arguments.length)return mn.prototype.setLabel.apply(this,arguments);var t=arguments[0],e=arguments[1];null===this.label?this.label=new fn(t,e):this.label.setLocation(t,e)},getEdges:function(){return this.edges},mergeLabel:function(){if(arguments[0]instanceof vn){var t=arguments[0];this.mergeLabel(t.label)}else if(arguments[0]instanceof fn)for(var e=arguments[0],n=0;2>n;n++){var i=this.computeMergedLocation(e,n),r=this.label.getLocation(n);r===L.NONE&&this.label.setLocation(n,i)}},add:function(t){this.edges.insert(t),t.setNode(this)},setLabelBoundary:function(t){if(null===this.label)return null;var e=L.NONE;null!==this.label&&(e=this.label.getLocation(t));var n=null;switch(e){case L.BOUNDARY:n=L.INTERIOR;break;case L.INTERIOR:n=L.BOUNDARY;break;default:n=L.BOUNDARY}this.label.setLocation(t,n)},interfaces_:function(){return[]},getClass:function(){return vn}}),e(yn.prototype,{find:function(t){return this.nodeMap.get(t)},addNode:function(){if(arguments[0]instanceof g){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof vn){var n=arguments[0],e=this.nodeMap.get(n.getCoordinate());return null===e?(this.nodeMap.put(n.getCoordinate(),n),n):(e.mergeLabel(n),e)}},print:function(t){for(var e=this.iterator();e.hasNext();){e.next().print(t)}},iterator:function(){return this.nodeMap.values().iterator()},values:function(){return this.nodeMap.values()},getBoundaryNodes:function(t){for(var e=new I,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===L.BOUNDARY&&e.add(i)}return e},add:function(t){var e=t.getCoordinate();this.addNode(e).add(t)},interfaces_:function(){return[]},getClass:function(){return yn}}),e(xn.prototype,{compareDirection:function(t){return this.dx===t.dx&&this.dy===t.dy?0:this.quadrant>t.quadrant?1:this.quadrant<t.quadrant?-1:le.computeOrientation(t.p0,t.p1,this.p1)},getDy:function(){return this.dy},getCoordinate:function(){return this.p0},setNode:function(t){this.node=t},print:function(t){var e=Math.atan2(this.dy,this.dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);t.print("  "+r+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+e+"   "+this.label)},compareTo:function(t){var e=t;return this.compareDirection(e)},getDirectedCoordinate:function(){return this.p1},getDx:function(){return this.dx},getLabel:function(){return this.label},getEdge:function(){return this.edge},getQuadrant:function(){return this.quadrant},getNode:function(){return this.node},toString:function(){var t=Math.atan2(this.dy,this.dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+t+"   "+this.label},computeLabel:function(t){},init:function(t,e){this.p0=t,this.p1=e,this.dx=e.x-t.x,this.dy=e.y-t.y,this.quadrant=Qe.quadrant(this.dx,this.dy),f.isTrue(!(0===this.dx&&0===this.dy),"EdgeEnd with identical endpoints found")},interfaces_:function(){return[s]},getClass:function(){return xn}}),h(En,xn),e(En.prototype,{getNextMin:function(){return this.nextMin},getDepth:function(t){return this.depth[t]},setVisited:function(t){this._isVisited=t},computeDirectedLabel:function(){this.label=new fn(this.edge.getLabel()),this._isForward||this.label.flip()},getNext:function(){return this.next},setDepth:function(t,e){if(-999!==this.depth[t]&&this.depth[t]!==e)throw new rn("assigned depths do not match",this.getCoordinate());this.depth[t]=e},isInteriorAreaEdge:function t(){for(var t=!0,e=0;2>e;e++)this.label.isArea(e)&&this.label.getLocation(e,hn.LEFT)===L.INTERIOR&&this.label.getLocation(e,hn.RIGHT)===L.INTERIOR||(t=!1);return t},setNextMin:function(t){this.nextMin=t},print:function(t){xn.prototype.print.call(this,t),t.print(" "+this.depth[hn.LEFT]+"/"+this.depth[hn.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},setMinEdgeRing:function(t){this.minEdgeRing=t},isLineEdge:function(){var t=this.label.isLine(0)||this.label.isLine(1),e=!this.label.isArea(0)||this.label.allPositionsEqual(0,L.EXTERIOR),n=!this.label.isArea(1)||this.label.allPositionsEqual(1,L.EXTERIOR);return t&&e&&n},setEdgeRing:function(t){this.edgeRing=t},getMinEdgeRing:function(){return this.minEdgeRing},getDepthDelta:function(){var t=this.edge.getDepthDelta();return this._isForward||(t=-t),t},setInResult:function(t){this._isInResult=t},getSym:function(){return this.sym},isForward:function(){return this._isForward},getEdge:function(){return this.edge},printEdge:function(t){this.print(t),t.print(" "),this._isForward?this.edge.print(t):this.edge.printReverse(t)},setSym:function(t){this.sym=t},setVisitedEdge:function(t){this.setVisited(t),this.sym.setVisited(t)},setEdgeDepths:function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var i=1;t===hn.LEFT&&(i=-1);var r=hn.opposite(t),s=n*i,o=e+s;this.setDepth(t,e),this.setDepth(r,o)},getEdgeRing:function(){return this.edgeRing},isInResult:function(){return this._isInResult},setNext:function(t){this.next=t},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return En}}),En.depthFactor=function(t,e){return t===L.EXTERIOR&&e===L.INTERIOR?1:t===L.INTERIOR&&e===L.EXTERIOR?-1:0},e(In.prototype,{createNode:function(t){return new vn(t,null)},interfaces_:function(){return[]},getClass:function(){return In}}),e(Nn.prototype,{printEdges:function(t){t.println("Edges:");for(var e=0;e<this.edges.size();e++){t.println("edge "+e+":");var n=this.edges.get(e);n.print(t),n.eiList.print(t)}},find:function(t){return this.nodes.find(t)},addNode:function(){if(arguments[0]instanceof vn){var t=arguments[0];return this.nodes.addNode(t)}if(arguments[0]instanceof g){var e=arguments[0];return this.nodes.addNode(e)}},getNodeIterator:function(){return this.nodes.iterator()},linkResultDirectedEdges:function(){for(var t=this.nodes.iterator();t.hasNext();){t.next().getEdges().linkResultDirectedEdges()}},debugPrintln:function(t){A.out.println(t)},isBoundaryNode:function(t,e){var n=this.nodes.find(e);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(t)===L.BOUNDARY},linkAllDirectedEdges:function(){for(var t=this.nodes.iterator();t.hasNext();){t.next().getEdges().linkAllDirectedEdges()}},matchInSameDirection:function(t,e,n,i){return!!t.equals(n)&&(le.computeOrientation(t,e,i)===le.COLLINEAR&&Qe.quadrant(t,e)===Qe.quadrant(n,i))},getEdgeEnds:function(){return this.edgeEndList},debugPrint:function(t){A.out.print(t)},getEdgeIterator:function(){return this.edges.iterator()},findEdgeInSameDirection:function(t,e){for(var n=0;n<this.edges.size();n++){var i=this.edges.get(n),r=i.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return i;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return i}return null},insertEdge:function(t){this.edges.add(t)},findEdgeEnd:function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},addEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.edges.add(n);var i=new En(n,!0),r=new En(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},add:function(t){this.nodes.add(t),this.edgeEndList.add(t)},getNodes:function(){return this.nodes.values()},findEdge:function(t,e){for(var n=0;n<this.edges.size();n++){var i=this.edges.get(n),r=i.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return i}return null},interfaces_:function(){return[]},getClass:function(){return Nn}}),Nn.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){e.next().getEdges().linkResultDirectedEdges()}},e(Cn.prototype,{sortShellsAndHoles:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):e.add(r)}},computePolygons:function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next(),r=i.toPolygon(this.geometryFactory);e.add(r)}return e},placeFreeHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,t);if(null===r)throw new rn("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},buildMinimalEdgeRings:function(t,e,n){for(var i=new I,r=t.iterator();r.hasNext();){var s=r.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var o=s.buildMinimalRings(),a=this.findShell(o);null!==a?(this.placePolygonHoles(a,o),e.add(a)):n.addAll(o)}else i.add(s)}return i},containsPoint:function(t){for(var e=this.shellList.iterator();e.hasNext();){if(e.next().containsPoint(t))return!0}return!1},buildMaximalEdgeRings:function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new pn(i,this.geometryFactory);e.add(r),r.setInResult()}}return e},placePolygonHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}},getPolygons:function(){return this.computePolygons(this.shellList)},findEdgeRingContaining:function(t,e){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,o=null,a=e.iterator();a.hasNext();){var u=a.next(),l=u.getLinearRing(),h=l.getEnvelopeInternal();null!==s&&(o=s.getLinearRing().getEnvelopeInternal());var c=!1;h.contains(i)&&le.isPointInRing(r,l.getCoordinates())&&(c=!0),c&&(null===s||o.contains(h))&&(s=u)}return s},findShell:function(t){for(var e=0,n=null,i=t.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,e++)}return f.isTrue(1>=e,"found two shells in MinimalEdgeRing list"),n},add:function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Nn.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(e),r=new I,s=this.buildMinimalEdgeRings(i,this.shellList,r);this.sortShellsAndHoles(s,this.shellList,r),this.placeFreeHoles(this.shellList,r)}},interfaces_:function(){return[]},getClass:function(){return Cn}}),e(Sn.prototype,{collectLines:function(t){for(var e=this.op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next();this.collectLineEdge(n,t,this.lineEdgesList),this.collectBoundaryTouchEdge(n,t,this.lineEdgesList)}},labelIsolatedLine:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.op.getArgGeometry(e));t.getLabel().setLocation(e,n)},build:function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this.resultLineList},collectLineEdge:function(t,e,n){var i=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!ni.isResultOfOp(i,e)||r.isCovered()||(n.add(r),t.setVisitedEdge(!0)))},findCoveredLineEdges:function(){for(var t=this.op.getGraph().getNodes().iterator();t.hasNext();){t.next().getEdges().findCoveredLineEdges()}for(var e=this.op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.op.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},labelIsolatedLines:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},buildLines:function(t){for(var e=this.lineEdgesList.iterator();e.hasNext();){var n=e.next(),i=(n.getLabel(),this.geometryFactory.createLineString(n.getCoordinates()));this.resultLineList.add(i),n.setInResult(!0)}},collectBoundaryTouchEdge:function(t,e,n){var i=t.getLabel();return t.isLineEdge()?null:t.isVisited()?null:t.isInteriorAreaEdge()?null:t.getEdge().isInResult()?null:(f.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(ni.isResultOfOp(i,e)&&e===ni.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},interfaces_:function(){return[]},getClass:function(){return Sn}}),e(wn.prototype,{filterCoveredNodeToPoint:function(t){var e=t.getCoordinate();if(!this.op.isCoveredByLA(e)){var n=this.geometryFactory.createPoint(e);this.resultPointList.add(n)}},extractNonCoveredResultNodes:function(t){for(var e=this.op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&t!==ni.INTERSECTION)){var i=n.getLabel();ni.isResultOfOp(i,t)&&this.filterCoveredNodeToPoint(n)}}},build:function(t){return this.extractNonCoveredResultNodes(t),this.resultPointList},interfaces_:function(){return[]},getClass:function(){return wn}}),e(Ln.prototype,{locate:function(t){},interfaces_:function(){return[]},getClass:function(){return Ln}}),e(Rn.prototype,{locate:function(t){return Rn.locate(t,this.geom)},interfaces_:function(){return[Ln]},getClass:function(){return Rn}}),Rn.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&le.isPointInRing(t,e.getCoordinates())},Rn.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!Rn.isPointInRing(t,n))return!1;for(var i=0;i<e.getNumInteriorRing();i++){var r=e.getInteriorRingN(i);if(Rn.isPointInRing(t,r))return!1}return!0},Rn.containsPoint=function(t,e){if(e instanceof Tt)return Rn.containsPointInPolygon(t,e);if(e instanceof ft)for(var n=new Le(e);n.hasNext();){var i=n.next();if(i!==e&&Rn.containsPoint(t,i))return!0}return!1},Rn.locate=function(t,e){return e.isEmpty()?L.EXTERIOR:Rn.containsPoint(t,e)?L.INTERIOR:L.EXTERIOR},e(Tn.prototype,{getNextCW:function(t){this.getEdges();var e=this.edgeList.indexOf(t),n=e-1;return 0===e&&(n=this.edgeList.size()-1),this.edgeList.get(n)},propagateSideLabels:function(t){for(var e=L.NONE,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea(t)&&r.getLocation(t,hn.LEFT)!==L.NONE&&(e=r.getLocation(t,hn.LEFT))}if(e===L.NONE)return null;for(var s=e,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();if(r.getLocation(t,hn.ON)===L.NONE&&r.setLocation(t,hn.ON,s),r.isArea(t)){var o=r.getLocation(t,hn.LEFT),a=r.getLocation(t,hn.RIGHT);if(a!==L.NONE){if(a!==s)throw new rn("side location conflict",i.getCoordinate());o===L.NONE&&f.shouldNeverReachHere("found single null side (at "+i.getCoordinate()+")"),s=o}else f.isTrue(r.getLocation(t,hn.LEFT)===L.NONE,"found single null side"),r.setLocation(t,hn.RIGHT,s),r.setLocation(t,hn.LEFT,s)}}},getCoordinate:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},print:function(t){A.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){e.next().print(t)}},isAreaLabelsConsistent:function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},checkAreaLabelsConsistent:function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,i=e.get(n).getLabel(),r=i.getLocation(t,hn.LEFT);f.isTrue(r!==L.NONE,"Found unlabelled area edge");for(var s=r,o=this.iterator();o.hasNext();){var a=o.next(),u=a.getLabel();f.isTrue(u.isArea(t),"Found non-area edge");var l=u.getLocation(t,hn.LEFT),h=u.getLocation(t,hn.RIGHT);if(l===h)return!1;if(h!==s)return!1;s=l}return!0},findIndex:function(t){this.iterator();for(var e=0;e<this.edgeList.size();e++){if(this.edgeList.get(e)===t)return e}return-1},iterator:function(){return this.getEdges().iterator()},getEdges:function(){return null===this.edgeList&&(this.edgeList=new I(this.edgeMap.values())),this.edgeList},getLocation:function(t,e,n){return this.ptInAreaLocation[t]===L.NONE&&(this.ptInAreaLocation[t]=Rn.locate(e,n[t].getGeometry())),this.ptInAreaLocation[t]},toString:function(){
var t=new P;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},computeEdgeEndLabels:function(t){for(var e=this.iterator();e.hasNext();){e.next().computeLabel(t)}},computeLabelling:function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next(),r=i.getLabel(),s=0;2>s;s++)r.isLine(s)&&r.getLocation(s)===L.BOUNDARY&&(e[s]=!0);for(var n=this.iterator();n.hasNext();)for(var i=n.next(),r=i.getLabel(),s=0;2>s;s++)if(r.isAnyNull(s)){var o=L.NONE;if(e[s])o=L.EXTERIOR;else{var a=i.getCoordinate();o=this.getLocation(s,a,t)}r.setAllLocationsIfNull(s,o)}},getDegree:function(){return this.edgeMap.size()},insertEdgeEnd:function(t,e){this.edgeMap.put(t,e),this.edgeList=null},interfaces_:function(){return[]},getClass:function(){return Tn}}),h(Pn,Tn),e(Pn.prototype,{linkResultDirectedEdges:function(){this.getResultAreaEdges();for(var t=null,e=null,n=this.SCANNING_FOR_INCOMING,i=0;i<this.resultAreaEdgeList.size();i++){var r=this.resultAreaEdgeList.get(i),s=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),n){case this.SCANNING_FOR_INCOMING:if(!s.isInResult())continue;e=s,n=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(!r.isInResult())continue;e.setNext(r),n=this.SCANNING_FOR_INCOMING}}if(n===this.LINKING_TO_OUTGOING){if(null===t)throw new rn("no outgoing dirEdge found",this.getCoordinate());f.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},insert:function(t){var e=t;this.insertEdgeEnd(e,e)},getRightmostEdge:function(){var t=this.getEdges(),e=t.size();if(1>e)return null;var n=t.get(0);if(1===e)return n;var i=t.get(e-1),r=n.getQuadrant(),s=i.getQuadrant();return Qe.isNorthern(r)&&Qe.isNorthern(s)?n:Qe.isNorthern(r)||Qe.isNorthern(s)?0!==n.getDy()?n:0!==i.getDy()?i:(f.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},print:function(t){A.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},getResultAreaEdges:function(){if(null!==this.resultAreaEdgeList)return this.resultAreaEdgeList;this.resultAreaEdgeList=new I;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this.resultAreaEdgeList.add(e)}return this.resultAreaEdgeList},updateLabelling:function(t){for(var e=this.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},linkAllDirectedEdges:function(){this.getEdges();for(var t=null,e=null,n=this.edgeList.size()-1;n>=0;n--){var i=this.edgeList.get(n),r=i.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=i}e.setNext(t)},computeDepths:function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=(t.getLabel(),t.getDepth(hn.LEFT)),i=t.getDepth(hn.RIGHT),r=this.computeDepths(e+1,this.edgeList.size(),n);if(this.computeDepths(0,e,r)!==i)throw new rn("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var s=arguments[0],o=arguments[1],a=arguments[2],u=a,l=s;o>l;l++){var h=this.edgeList.get(l);h.getLabel(),h.setEdgeDepths(hn.RIGHT,u),u=h.getDepth(hn.LEFT)}return u}},mergeSymLabels:function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},linkMinimalDirectedEdges:function(t){for(var e=null,n=null,i=this.SCANNING_FOR_INCOMING,r=this.resultAreaEdgeList.size()-1;r>=0;r--){var s=this.resultAreaEdgeList.get(r),o=s.getSym();switch(null===e&&s.getEdgeRing()===t&&(e=s),i){case this.SCANNING_FOR_INCOMING:if(o.getEdgeRing()!==t)continue;n=o,i=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;n.setNextMin(s),i=this.SCANNING_FOR_INCOMING}}i===this.LINKING_TO_OUTGOING&&(f.isTrue(null!==e,"found null for first outgoing dirEdge"),f.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))},getOutgoingDegree:function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var n=e.next();n.isInResult()&&t++}return t}if(1===arguments.length){for(var i=arguments[0],t=0,e=this.iterator();e.hasNext();){var n=e.next();n.getEdgeRing()===i&&t++}return t}},getLabel:function(){return this.label},findCoveredLineEdges:function(){for(var t=L.NONE,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=L.INTERIOR;break}if(i.isInResult()){t=L.EXTERIOR;break}}}if(t===L.NONE)return null;for(var r=t,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();n.isLineEdge()?n.getEdge().setCovered(r===L.INTERIOR):(n.isInResult()&&(r=L.EXTERIOR),i.isInResult()&&(r=L.INTERIOR))}},computeLabelling:function(t){Tn.prototype.computeLabelling.call(this,t),this.label=new fn(L.NONE);for(var e=this.iterator();e.hasNext();)for(var n=e.next(),i=n.getEdge(),r=i.getLabel(),s=0;2>s;s++){var o=r.getLocation(s);o!==L.INTERIOR&&o!==L.BOUNDARY||this.label.setLocation(s,L.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Pn}}),h(bn,In),e(bn.prototype,{createNode:function(t){return new vn(t,new Pn)},interfaces_:function(){return[]},getClass:function(){return bn}}),e(On.prototype,{computeIntersections:function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},interfaces_:function(){return[]},getClass:function(){return On}}),e(_n.prototype,{isDelete:function(){return this.eventType===_n.DELETE},setDeleteEventIndex:function(t){this.deleteEventIndex=t},getObject:function(){return this.obj},compareTo:function(t){var e=t;return this.xValue<e.xValue?-1:this.xValue>e.xValue?1:this.eventType<e.eventType?-1:this.eventType>e.eventType?1:0},getInsertEvent:function(){return this.insertEvent},isInsert:function(){return this.eventType===_n.INSERT},isSameLabel:function(t){return null!==this.label&&this.label===t.label},getDeleteEventIndex:function(){return this.deleteEventIndex},interfaces_:function(){return[s]},getClass:function(){return _n}}),_n.INSERT=1,_n.DELETE=2,e(Mn.prototype,{interfaces_:function(){return[]},getClass:function(){return Mn}}),e(Dn.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this.li.getIntersectionNum()){if(Dn.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},setIsDoneIfProperInt:function(t){this.isDoneWhenProperInt=t},hasProperInteriorIntersection:function(){return this.hasProperInterior},isBoundaryPointInternal:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinate();if(t.isIntersection(r))return!0}return!1},hasProperIntersection:function(){return this.hasProper},hasIntersection:function(){return this._hasIntersection},isDone:function(){return this._isDone},isBoundaryPoint:function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},setBoundaryNodes:function(t,e){this.bdyNodes=new Array(2).fill(null),this.bdyNodes[0]=t,this.bdyNodes[1]=e},addIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.li.computeIntersection(r,s,o,a),this.li.hasIntersection()&&(this.recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this.numIntersections++,this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,!this.includeProper&&this.li.isProper()||(t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1)),this.li.isProper()&&(this.properIntersectionPoint=this.li.getIntersection(0).copy(),this.hasProper=!0,this.isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this.li,this.bdyNodes)||(this.hasProperInterior=!0))))},interfaces_:function(){return[]},getClass:function(){return Dn}}),Dn.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},h(An,Mn),e(An.prototype,{prepareEvents:function(){uo.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},computeIntersections:function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Dn&&R(arguments[0],y)&&R(arguments[1],y)){var i=arguments[0],r=arguments[1],s=arguments[2];this.addEdges(i,i),this.addEdges(r,r),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&R(arguments[0],y)&&arguments[1]instanceof Dn){var o=arguments[0],a=arguments[1],u=arguments[2];u?this.addEdges(o,null):this.addEdges(o),this.computeIntersections(a)}},addEdge:function(t,e){for(var n=t.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var s=new On(n,r),o=new _n(e,n.getMinX(r),s);this.events.add(o),this.events.add(new _n(n.getMaxX(r),o))}},processOverlaps:function(t,e,n,i){for(var r=n.getObject(),s=t;e>s;s++){var o=this.events.get(s);if(o.isInsert()){var a=o.getObject();n.isSameLabel(o)||(r.computeIntersections(a,i),this.nOverlaps++)}}},addEdges:function(){if(1===arguments.length)for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.addEdge(n,n)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],e=i.iterator();e.hasNext();){var n=e.next();this.addEdge(n,r)}},interfaces_:function(){return[]},getClass:function(){return An}}),e(Fn.prototype,{getMin:function(){return this.min},intersects:function(t,e){return!(this.min>e||this.max<t)},getMax:function(){return this.max},toString:function(){return re.toLineString(new g(this.min,0),new g(this.max,0))},interfaces_:function(){return[]},getClass:function(){return Fn}}),e(Gn.prototype,{compare:function(t,e){var n=t,i=e,r=(n.min+n.max)/2,s=(i.min+i.max)/2;return s>r?-1:r>s?1:0},interfaces_:function(){return[a]},getClass:function(){return Gn}}),Fn.NodeComparator=Gn,h(qn,Fn),e(qn.prototype,{query:function(t,e,n){return this.intersects(t,e)?void n.visitItem(this.item):null},interfaces_:function(){return[]},getClass:function(){return qn}}),h(Bn,Fn),e(Bn.prototype,{buildExtent:function(t,e){this.min=Math.min(t.min,e.min),this.max=Math.max(t.max,e.max)},query:function(t,e,n){return this.intersects(t,e)?(null!==this.node1&&this.node1.query(t,e,n),void(null!==this.node2&&this.node2.query(t,e,n))):null},interfaces_:function(){return[]},getClass:function(){return Bn}}),e(zn.prototype,{buildTree:function(){uo.sort(this.leaves,new IntervalRTreeNode.NodeComparator);for(var t=this.leaves,e=null,n=new I;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},insert:function(t,e,n){if(null!==this.root)throw new IllegalStateException("Index cannot be added to once it has been queried");this.leaves.add(new qn(t,e,n))},query:function(t,e,n){this.init(),this.root.query(t,e,n)},buildRoot:function(){return null!==this.root?null:void(this.root=this.buildTree())},printNode:function(t){A.out.println(re.toLineString(new g(t.min,this.level),new g(t.max,this.level)))},init:function(){return null!==this.root?null:void this.buildRoot()},buildLevel:function(t,e){this.level++,e.clear();for(var n=0;n<t.size();n+=2){var i=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(i);else{var r=new Bn(t.get(n),t.get(n+1));e.add(r)}}},interfaces_:function(){return[]},getClass:function(){return zn}}),e(Vn.prototype,{filter:function(t){if(this.isForcedToLineString&&t instanceof bt){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this.lines.add(e),null}t instanceof St&&this.lines.add(t)},setForceToLineString:function(t){this.isForcedToLineString=t},interfaces_:function(){return[q]},getClass:function(){return Vn}}),Vn.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Vn.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Vn.getLines(e,n))}},Vn.getLines=function(){if(1===arguments.length){var t=arguments[0];return Vn.getLines(t,!1)}if(2===arguments.length){if(R(arguments[0],m)&&R(arguments[1],m)){for(var e=arguments[0],n=arguments[1],i=e.iterator();i.hasNext();){var r=i.next();Vn.getLines(r,n)}return n}if(arguments[0]instanceof B&&"boolean"==typeof arguments[1]){var s=arguments[0],o=arguments[1],a=new I;return s.apply(new Vn(a,o)),a}if(arguments[0]instanceof B&&R(arguments[1],m)){var u=arguments[0],l=arguments[1];return u instanceof St?l.add(u):u.apply(new Vn(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&R(arguments[0],m)&&R(arguments[1],m)){for(var h=arguments[0],c=arguments[1],f=arguments[2],i=h.iterator();i.hasNext();){var r=i.next();Vn.getLines(r,c,f)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof B&&R(arguments[1],m)){var g=arguments[0],d=arguments[1],p=arguments[2];return g.apply(new Vn(d,p)),d}}},e(kn.prototype,{visitItem:function(t){this.items.add(t)},getItems:function(){return this.items},interfaces_:function(){return[De]},getClass:function(){return kn}}),e(Yn.prototype,{locate:function(t){var e=new ue(t),n=new Un(e);return this.index.query(t.y,t.y,n),e.getLocation()},interfaces_:function(){return[Ln]},getClass:function(){return Yn}}),e(Un.prototype,{visitItem:function(t){var e=t;this.counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},interfaces_:function(){return[De]},getClass:function(){return Un}}),e(Xn.prototype,{init:function(t){for(var e=Vn.getLines(t),n=e.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinates();this.addLine(r)}},addLine:function(t){for(var e=1;e<t.length;e++){var n=new he(t[e-1],t[e]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.index.insert(i,r,n)}},query:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new kn;return this.index.query(t,e,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this.index.query(i,r,s)}},interfaces_:function(){return[]},getClass:function(){return Xn}}),Yn.SegmentVisitor=Un,Yn.IntervalIndexedGeometry=Xn,e(Hn.prototype,{getSegmentIndex:function(){return this.segmentIndex},getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},compareTo:function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},isEndPoint:function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},toString:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},getDistance:function(){return this.dist},compare:function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},interfaces_:function(){return[s]},getClass:function(){return Hn}}),e(Wn.prototype,{print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},addEndpoints:function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new g(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)s[o++]=this.edge.pts[a];return r&&(s[o]=e.coord),new Qn(s,new fn(this.edge.label))},add:function(t,e,n){var i=new Hn(t,e,n),r=this.nodeMap.get(i);return null!==r?r:(this.nodeMap.put(i,i),i)},isIntersection:function(t){for(var e=this.iterator();e.hasNext();){if(e.next().coord.equals(t))return!0}return!1},interfaces_:function(){return[]},getClass:function(){return Wn}}),e(jn.prototype,{getChainStartIndices:function(t){var e=0,n=new I;n.add(new b(e));do{var i=this.findChainEnd(t,e);n.add(new b(i)),e=i}while(e<t.length-1);return jn.toIntArray(n)},findChainEnd:function(t,e){for(var n=Qe.quadrant(t[e],t[e+1]),i=e+1;i<t.length;){if(Qe.quadrant(t[i-1],t[i])!==n)break;i++}return i-1},interfaces_:function(){return[]},getClass:function(){return jn}}),jn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},e(Kn.prototype,{getCoordinates:function(){return this.pts},getMaxX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},getMinX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return n>e?e:n},computeIntersectsForChain:function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],u=arguments[4],l=arguments[5],h=this.pts[r],c=this.pts[s],f=o.pts[a],g=o.pts[u];if(s-r==1&&u-a==1)return l.addIntersections(this.e,r,o.e,a),null;if(this.env1.init(h,c),this.env2.init(f,g),!this.env1.intersects(this.env2))return null;var d=Math.trunc((r+s)/2),p=Math.trunc((a+u)/2);d>r&&(p>a&&this.computeIntersectsForChain(r,d,o,a,p,l),u>p&&this.computeIntersectsForChain(r,d,o,p,u,l)),s>d&&(p>a&&this.computeIntersectsForChain(d,s,o,a,p,l),u>p&&this.computeIntersectsForChain(d,s,o,p,u,l))}},getStartIndexes:function(){return this.startIndex},computeIntersects:function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)},interfaces_:function(){return[]},getClass:function(){return Kn}}),e(Zn.prototype,{getDepth:function(t,e){return this.depth[t][e]},setDepth:function(t,e,n){this.depth[t][e]=n},isNull:function(){if(0===arguments.length){for(var t=0;2>t;t++)for(var e=0;3>e;e++)if(this.depth[t][e]!==Zn.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this.depth[n][1]===Zn.NULL_VALUE}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.depth[i][r]===Zn.NULL_VALUE}},normalize:function(){for(var t=0;2>t;t++)if(!this.isNull(t)){var e=this.depth[t][1];this.depth[t][2]<e&&(e=this.depth[t][2]),0>e&&(e=0);for(var n=1;3>n;n++){var i=0;this.depth[t][n]>e&&(i=1),this.depth[t][n]=i}}},getDelta:function(t){return this.depth[t][hn.RIGHT]-this.depth[t][hn.LEFT]},getLocation:function(t,e){return this.depth[t][e]<=0?L.EXTERIOR:L.INTERIOR},toString:function(){return"A: "+this.depth[0][1]+","+this.depth[0][2]+" B: "+this.depth[1][1]+","+this.depth[1][2]},add:function(){if(1===arguments.length)for(var t=arguments[0],e=0;2>e;e++)for(var n=1;3>n;n++){var i=t.getLocation(e,n);i!==L.EXTERIOR&&i!==L.INTERIOR||(this.isNull(e,n)?this.depth[e][n]=Zn.depthAtLocation(i):this.depth[e][n]+=Zn.depthAtLocation(i))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];o===L.INTERIOR&&this.depth[r][s]++}},interfaces_:function(){return[]},getClass:function(){return Zn}}),Zn.depthAtLocation=function(t){return t===L.EXTERIOR?0:t===L.INTERIOR?1:Zn.NULL_VALUE},Zn.NULL_VALUE=-1,h(Qn,mn),e(Qn.prototype,{getDepth:function(){return this.depth},getCollapsedEdge:function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new Qn(t,fn.toLineLabel(this.label))},isIsolated:function(){return this._isIsolated},getCoordinates:function(){return this.pts},setIsolated:function(t){this._isIsolated=t},setName:function(t){this.name=t},equals:function(t){if(!(t instanceof Qn))return!1;var e=t;if(this.pts.length!==e.pts.length)return!1;for(var n=!0,i=!0,r=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(e.pts[s])||(n=!1),this.pts[s].equals2D(e.pts[--r])||(i=!1),!n&&!i)return!1;return!0},getCoordinate:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},print:function(t){t.print("edge "+this.name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this.label+" "+this.depthDelta)},computeIM:function(t){Qn.updateIM(this.label,t)},isCollapsed:function(){return!!this.label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getMaximumSegmentIndex:function(){return this.pts.length-1},getDepthDelta:function(){return this.depthDelta},getNumPoints:function(){return this.pts.length},printReverse:function(t){t.print("edge "+this.name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},getMonotoneChainEdge:function(){return null===this.mce&&(this.mce=new Kn(this)),this.mce},getEnvelope:function(){if(null===this.env){this.env=new C;for(var t=0;t<this.pts.length;t++)this.env.expandToInclude(this.pts[t])}return this.env},addIntersection:function(t,e,n,i){var r=new g(t.getIntersection(i)),s=e,o=t.getEdgeDistance(n,i),a=s+1;if(a<this.pts.length){var u=this.pts[a];r.equals2D(u)&&(s=a,o=0)}this.eiList.add(r,s,o)},toString:function(){var t=new P;t.append("edge "+this.name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this.label+" "+this.depthDelta),t.toString()},isPointwiseEqual:function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},setDepthDelta:function(t){this.depthDelta=t},getEdgeIntersectionList:function(){return this.eiList},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[]},getClass:function(){return Qn}}),Qn.updateIM=function(){if(2!==arguments.length)return mn.prototype.updateIM.apply(this,arguments);var t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,hn.ON),t.getLocation(1,hn.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,hn.LEFT),t.getLocation(1,hn.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,hn.RIGHT),t.getLocation(1,hn.RIGHT),2))},h(Jn,Nn),e(Jn.prototype,{insertBoundaryPoint:function(t,e){var n=this.nodes.addNode(e),i=n.getLabel(),r=1;L.NONE;i.getLocation(t,hn.ON)===L.BOUNDARY&&r++;var s=Jn.determineBoundary(this.boundaryNodeRule,r);i.setLocation(t,s)},computeSelfNodes:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=new Dn(n,!0,!1);s.setIsDoneIfProperInt(r);var o=this.createEdgeSetIntersector(),a=this.parentGeom instanceof bt||this.parentGeom instanceof Tt||this.parentGeom instanceof Ot,u=i||!a;return o.computeIntersections(this.edges,s,u),this.addSelfIntersectionNodes(this.argIndex),s}},computeSplitEdges:function(t){for(var e=this.edges.iterator();e.hasNext();){e.next().eiList.addSplitEdges(t)}},computeEdgeIntersections:function(t,e,n){var i=new Dn(e,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.edges,t.edges,i),i},getGeometry:function(){return this.parentGeom},getBoundaryNodeRule:function(){return this.boundaryNodeRule},hasTooFewPoints:function(){return this._hasTooFewPoints},addPoint:function(){if(arguments[0]instanceof Lt){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this.argIndex,e,L.INTERIOR)}else if(arguments[0]instanceof g){var n=arguments[0];this.insertPoint(this.argIndex,n,L.INTERIOR)}},addPolygon:function(t){this.addPolygonRing(t.getExteriorRing(),L.EXTERIOR,L.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,L.INTERIOR,L.EXTERIOR)}},addEdge:function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this.argIndex,e[0],L.BOUNDARY),this.insertPoint(this.argIndex,e[e.length-1],L.BOUNDARY)},addLineString:function(t){var e=H.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this.invalidPoint=e[0],null;var n=new Qn(e,new fn(this.argIndex,L.INTERIOR));this.lineEdgeMap.put(t,n),this.insertEdge(n),f.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.argIndex,e[0]),this.insertBoundaryPoint(this.argIndex,e[e.length-1])},getInvalidPoint:function(){return this.invalidPoint},getBoundaryPoints:function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,i=t.iterator();i.hasNext();){var r=i.next();e[n++]=r.getCoordinate().copy()}return e},getBoundaryNodes:function(){return null===this.boundaryNodes&&(this.boundaryNodes=this.nodes.getBoundaryNodes(this.argIndex)),this.boundaryNodes},addSelfIntersectionNode:function(t,e,n){return this.isBoundaryNode(t,e)?null:void(n===L.BOUNDARY&&this.useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n))},addPolygonRing:function(t,e,n){if(t.isEmpty())return null;var i=H.removeRepeatedPoints(t.getCoordinates());if(i.length<4)return this._hasTooFewPoints=!0,this.invalidPoint=i[0],null;var r=e,s=n;le.isCCW(i)&&(r=n,s=e);var o=new Qn(i,new fn(this.argIndex,L.BOUNDARY,r,s));this.lineEdgeMap.put(t,o),this.insertEdge(o),this.insertPoint(this.argIndex,i[0],L.BOUNDARY)},insertPoint:function(t,e,n){var i=this.nodes.addNode(e),r=i.getLabel();null===r?i.label=new fn(t,n):r.setLocation(t,n)},createEdgeSetIntersector:function(){return new An},addSelfIntersectionNodes:function(t){for(var e=this.edges.iterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.eiList.iterator();r.hasNext();){var s=r.next();this.addSelfIntersectionNode(t,s.coord,i)}},add:function(){if(1!==arguments.length)return Nn.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Ot&&(this.useBoundaryDeterminationRule=!1),t instanceof Tt)this.addPolygon(t);else if(t instanceof St)this.addLineString(t);else if(t instanceof Lt)this.addPoint(t);else if(t instanceof Pt)this.addCollection(t);else if(t instanceof gt)this.addCollection(t);else if(t instanceof Ot)this.addCollection(t);else{if(!(t instanceof ft))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},locate:function(t){return R(this.parentGeom,Rt)&&this.parentGeom.getNumGeometries()>50?(null===this.areaPtLocator&&(this.areaPtLocator=new Yn(this.parentGeom)),this.areaPtLocator.locate(t)):this.ptLocator.locate(t,this.parentGeom)},findEdge:function(){if(1===arguments.length){var t=arguments[0];return this.lineEdgeMap.get(t)}return Nn.prototype.findEdge.apply(this,arguments)},interfaces_:function(){return[]},getClass:function(){return Jn}}),Jn.determineBoundary=function(t,e){return t.isInBoundary(e)?L.BOUNDARY:L.INTERIOR},e($n.prototype,{getArgGeometry:function(t){return this.arg[t].getGeometry()},setComputationPrecision:function(t){this.resultPrecisionModel=t,this.li.setPrecisionModel(this.resultPrecisionModel)},interfaces_:function(){return[]},getClass:function(){return $n}}),e(ti.prototype,{compareTo:function(t){var e=t;return ti.compareOriented(this.pts,this._orientation,e.pts,e._orientation)},interfaces_:function(){return[s]},getClass:function(){return ti}}),ti.orientation=function(t){return 1===H.increasingDirection(t)},ti.compareOriented=function(t,e,n,i){for(var r=e?1:-1,s=i?1:-1,o=e?t.length:-1,a=i?n.length:-1,u=e?0:t.length-1,l=i?0:n.length-1;;){var h=t[u].compareTo(n[l]);if(0!==h)return h;u+=r,l+=s;var c=u===o,f=l===a;if(c&&!f)return-1;if(!c&&f)return 1;if(c&&f)return 0}},e(ei.prototype,{print:function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this.edges.size();e++){var n=this.edges.get(e);e>0&&t.print(","),t.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&t.print(","),t.print(i[r].x+" "+i[r].y);t.println(")")}t.print(")  ")},addAll:function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},findEdgeIndex:function(t){for(var e=0;e<this.edges.size();e++)if(this.edges.get(e).equals(t))return e;return-1},iterator:function(){return this.edges.iterator()},getEdges:function(){return this.edges},get:function(t){return this.edges.get(t)},findEqualEdge:function(t){var e=new ti(t.getCoordinates());return this.ocaMap.get(e)},add:function(t){this.edges.add(t);var e=new ti(t.getCoordinates());this.ocaMap.put(e,t)},interfaces_:function(){return[]},getClass:function(){return ei}}),h(ni,$n),e(ni.prototype,{insertUniqueEdge:function(t){var e=this.edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new fn(t.getLabel()),i.flip());var r=e.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.edgeList.add(t)},getGraph:function(){return this.graph},cancelDuplicateResultEdges:function(){for(var t=this.graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},isCoveredByLA:function(t){return!!this.isCovered(t,this.resultLineList)||!!this.isCovered(t,this.resultPolyList)},computeGeometry:function(t,e,n,i){var r=new I;return r.addAll(t),r.addAll(e),r.addAll(n),r.isEmpty()?ni.createEmptyResult(i,this.arg[0].getGeometry(),this.arg[1].getGeometry(),this.geomFact):this.geomFact.buildGeometry(r)},mergeSymLabels:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){t.next().getEdges().mergeSymLabels()}},isCovered:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(this.ptLocator.locate(t,i)!==L.EXTERIOR)return!0}return!1},replaceCollapsedEdges:function(){for(var t=new I,e=this.edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this.edgeList.addAll(t)},updateNodeLabelling:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},getResultGeometry:function(t){return this.computeOverlay(t),this.resultGeom},insertUniqueEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},computeOverlay:function(t){this.copyPoints(0),this.copyPoints(1),this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1),this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!0);var e=new I;this.arg[0].computeSplitEdges(e),this.arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),un.checkValid(this.edgeList.getEdges()),this.graph.addEdges(this.edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Cn(this.geomFact);n.add(this.graph),this.resultPolyList=n.getPolygons();var i=new Sn(this,this.geomFact,this.ptLocator);this.resultLineList=i.build(t);var r=new wn(this,this.geomFact,this.ptLocator);this.resultPointList=r.build(t),this.resultGeom=this.computeGeometry(this.resultPointList,this.resultLineList,this.resultPolyList,t)},labelIncompleteNode:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.arg[e].getGeometry());t.getLabel().setLocation(e,n)},copyPoints:function(t){for(var e=this.arg[t].getNodeIterator();e.hasNext();){var n=e.next();this.graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},findResultAreaEdges:function(t){for(var e=this.graph.getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&ni.isResultOfOp(i.getLocation(0,hn.RIGHT),i.getLocation(1,hn.RIGHT),t)&&n.setInResult(!0)}},computeLabelsFromDepths:function(){
for(var t=this.edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),i=e.getDepth();if(!i.isNull()){i.normalize();for(var r=0;2>r;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(f.isTrue(!i.isNull(r,hn.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,hn.LEFT,i.getLocation(r,hn.LEFT)),f.isTrue(!i.isNull(r,hn.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,hn.RIGHT,i.getLocation(r,hn.RIGHT))))}}},computeLabelling:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){t.next().getEdges().computeLabelling(this.arg)}this.mergeSymLabels(),this.updateNodeLabelling()},labelIncompleteNodes:function(){for(var t=0,e=this.graph.getNodes().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(t++,i.isNull(0)?this.labelIncompleteNode(n,0):this.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(i)}},isCoveredByA:function(t){return!!this.isCovered(t,this.resultPolyList)},interfaces_:function(){return[]},getClass:function(){return ni}}),ni.overlayOp=function(t,e,n){return new ni(t,e).getResultGeometry(n)},ni.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return ni.createEmptyResult(ni.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return ln.map(t,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ri.overlayOp(t,e,ni.INTERSECTION)},ni.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return ni.createEmptyResult(ni.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ri.overlayOp(t,e,ni.SYMDIFFERENCE)},ni.resultDimension=function(t,e,n){var i=e.getDimension(),r=n.getDimension(),s=-1;switch(t){case ni.INTERSECTION:s=Math.min(i,r);break;case ni.UNION:s=Math.max(i,r);break;case ni.DIFFERENCE:s=i;break;case ni.SYMDIFFERENCE:s=Math.max(i,r)}return s},ni.createEmptyResult=function(t,e,n,i){var r=null;switch(ni.resultDimension(t,e,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},ni.difference=function(t,e){return t.isEmpty()?ni.createEmptyResult(ni.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ri.overlayOp(t,e,ni.DIFFERENCE))},ni.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return ni.isResultOfOp(n,i,e)}if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];switch(r===L.BOUNDARY&&(r=L.INTERIOR),s===L.BOUNDARY&&(s=L.INTERIOR),o){case ni.INTERSECTION:return r===L.INTERIOR&&s===L.INTERIOR;case ni.UNION:return r===L.INTERIOR||s===L.INTERIOR;case ni.DIFFERENCE:return r===L.INTERIOR&&s!==L.INTERIOR;case ni.SYMDIFFERENCE:return r===L.INTERIOR&&s!==L.INTERIOR||r!==L.INTERIOR&&s===L.INTERIOR}return!1}},ni.INTERSECTION=1,ni.UNION=2,ni.DIFFERENCE=3,ni.SYMDIFFERENCE=4,e(ii.prototype,{selfSnap:function(t){return new Ee(t).snapTo(t,this.snapTolerance)},removeCommonBits:function(t){this.cbr=new Ce,this.cbr.add(t[0]),this.cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this.cbr.removeCommonBits(t[0].copy()),e[1]=this.cbr.removeCommonBits(t[1].copy()),e},prepareResult:function(t){return this.cbr.addCommonBits(t),t},getResultGeometry:function(t){var e=this.snap(this.geom),n=ni.overlayOp(e[0],e[1],t);return this.prepareResult(n)},checkValid:function(t){t.isValid()||A.out.println("Snapped geometry is invalid")},computeSnapTolerance:function(){this.snapTolerance=Ee.computeOverlaySnapTolerance(this.geom[0],this.geom[1])},snap:function(t){var e=this.removeCommonBits(t);return Ee.snap(e[0],e[1],this.snapTolerance)},interfaces_:function(){return[]},getClass:function(){return ii}}),ii.overlayOp=function(t,e,n){return new ii(t,e).getResultGeometry(n)},ii.union=function(t,e){return ii.overlayOp(t,e,ni.UNION)},ii.intersection=function(t,e){return ii.overlayOp(t,e,ni.INTERSECTION)},ii.symDifference=function(t,e){return ii.overlayOp(t,e,ni.SYMDIFFERENCE)},ii.difference=function(t,e){return ii.overlayOp(t,e,ni.DIFFERENCE)},e(ri.prototype,{getResultGeometry:function(t){var e=null,n=!1,i=null;try{e=ni.overlayOp(this.geom[0],this.geom[1],t);n=!0}catch(t){if(!(t instanceof l))throw t;i=t}finally{}if(!n)try{e=ii.overlayOp(this.geom[0],this.geom[1],t)}catch(t){throw t instanceof l?i:t}finally{}return e},interfaces_:function(){return[]},getClass:function(){return ri}}),ri.overlayOp=function(t,e,n){return new ri(t,e).getResultGeometry(n)},ri.union=function(t,e){return ri.overlayOp(t,e,ni.UNION)},ri.intersection=function(t,e){return ri.overlayOp(t,e,ni.INTERSECTION)},ri.symDifference=function(t,e){return ri.overlayOp(t,e,ni.SYMDIFFERENCE)},ri.difference=function(t,e){return ri.overlayOp(t,e,ni.DIFFERENCE)},e(si.prototype,{addPolygon:function(t){if(t.isEmpty())return null;var e=null,n=0,i=this.horizontalBisector(t);if(0===i.getLength())n=0,e=i.getCoordinate();else{var r=ri.overlayOp(i,t,ni.INTERSECTION),s=this.widestGeometry(r);n=s.getEnvelopeInternal().getWidth(),e=si.centre(s.getEnvelopeInternal())}(null===this.interiorPoint||n>this.maxWidth)&&(this.interiorPoint=e,this.maxWidth=n)},getInteriorPoint:function(){return this.interiorPoint},widestGeometry:function t(){if(arguments[0]instanceof ft){var e=arguments[0];if(e.isEmpty())return e;for(var t=e.getGeometryN(0),n=1;n<e.getNumGeometries();n++)e.getGeometryN(n).getEnvelopeInternal().getWidth()>t.getEnvelopeInternal().getWidth()&&(t=e.getGeometryN(n));return t}if(arguments[0]instanceof B){var i=arguments[0];return i instanceof ft?this.widestGeometry(i):i}},horizontalBisector:function(t){var e=t.getEnvelopeInternal(),n=oi.getBisectorY(t);return this.factory.createLineString([new g(e.getMinX(),n),new g(e.getMaxX(),n)])},add:function(t){if(t instanceof Tt)this.addPolygon(t);else if(t instanceof ft)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))},interfaces_:function(){return[]},getClass:function(){return si}}),si.centre=function(t){return new g(si.avg(t.getMinX(),t.getMaxX()),si.avg(t.getMinY(),t.getMaxY()))},si.avg=function(t,e){return(t+e)/2},e(oi.prototype,{updateInterval:function(t){t<=this.centreY?t>this.loY&&(this.loY=t):t>this.centreY&&t<this.hiY&&(this.hiY=t)},getBisectorY:function(){this.process(this.poly.getExteriorRing());for(var t=0;t<this.poly.getNumInteriorRing();t++)this.process(this.poly.getInteriorRingN(t));return si.avg(this.hiY,this.loY)},process:function(t){for(var e=t.getCoordinateSequence(),n=0;n<e.size();n++){var i=e.getY(n);this.updateInterval(i)}},interfaces_:function(){return[]},getClass:function(){return oi}}),oi.getBisectorY=function(t){return new oi(t).getBisectorY()},si.SafeBisectorFinder=oi,e(ai.prototype,{addEndpoints:function(){if(arguments[0]instanceof B){var t=arguments[0];if(t instanceof St)this.addEndpoints(t.getCoordinates());else if(t instanceof ft)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addEndpoints(e.getGeometryN(n))}else if(arguments[0]instanceof Array){var i=arguments[0];this.add(i[0]),this.add(i[i.length-1])}},getInteriorPoint:function(){return this.interiorPoint},addInterior:function(){if(arguments[0]instanceof B){var t=arguments[0];if(t instanceof St)this.addInterior(t.getCoordinates());else if(t instanceof ft)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addInterior(e.getGeometryN(n))}else if(arguments[0]instanceof Array)for(var i=arguments[0],n=1;n<i.length-1;n++)this.add(i[n])},add:function(t){var e=t.distance(this.centroid);e<this.minDistance&&(this.interiorPoint=new g(t),this.minDistance=e)},interfaces_:function(){return[]},getClass:function(){return ai}}),e(ui.prototype,{getInteriorPoint:function(){return this.interiorPoint},add:function(){if(arguments[0]instanceof B){var t=arguments[0];if(t instanceof Lt)this.add(t.getCoordinate());else if(t instanceof ft)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))}else if(arguments[0]instanceof g){var i=arguments[0],r=i.distance(this.centroid);r<this.minDistance&&(this.interiorPoint=new g(i),this.minDistance=r)}},interfaces_:function(){return[]},getClass:function(){return ui}}),e(li.prototype,{interfaces_:function(){return[]},getClass:function(){return li}}),li.toDegrees=function(t){return 180*t/Math.PI},li.normalize=function(t){for(;t>Math.PI;)t-=li.PI_TIMES_2;for(;t<=-Math.PI;)t+=li.PI_TIMES_2;return t},li.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=n.x-e.x,r=n.y-e.y;return Math.atan2(r,i)}},li.isAcute=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)>0},li.isObtuse=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return 0>i*(n.x-e.x)+r*(n.y-e.y)},li.interiorAngle=function(t,e,n){var i=li.angle(e,t),r=li.angle(e,n);return Math.abs(r-i)},li.normalizePositive=function(t){if(0>t){for(;0>t;)t+=li.PI_TIMES_2;t>=li.PI_TIMES_2&&(t=0)}else{for(;t>=li.PI_TIMES_2;)t-=li.PI_TIMES_2;0>t&&(t=0)}return t},li.angleBetween=function(t,e,n){var i=li.angle(e,t),r=li.angle(e,n);return li.diff(i,r)},li.diff=function(t,e){var n=null;return n=e>t?e-t:t-e,n>Math.PI&&(n=2*Math.PI-n),n},li.toRadians=function(t){return t*Math.PI/180},li.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?li.COUNTERCLOCKWISE:0>n?li.CLOCKWISE:li.NONE},li.angleBetweenOriented=function(t,e,n){var i=li.angle(e,t),r=li.angle(e,n),s=r-i;return s<=-Math.PI?s+li.PI_TIMES_2:s>Math.PI?s-li.PI_TIMES_2:s},li.PI_TIMES_2=2*Math.PI,li.PI_OVER_2=Math.PI/2,li.PI_OVER_4=Math.PI/4,li.COUNTERCLOCKWISE=le.COUNTERCLOCKWISE,li.CLOCKWISE=le.CLOCKWISE,li.NONE=le.COLLINEAR,e(hi.prototype,{area:function(){return hi.area(this.p0,this.p1,this.p2)},signedArea:function(){return hi.signedArea(this.p0,this.p1,this.p2)},interpolateZ:function(t){if(null===t)throw new i("Supplied point is null.");return hi.interpolateZ(t,this.p0,this.p1,this.p2)},longestSideLength:function(){return hi.longestSideLength(this.p0,this.p1,this.p2)},isAcute:function(){return hi.isAcute(this.p0,this.p1,this.p2)},circumcentre:function(){return hi.circumcentre(this.p0,this.p1,this.p2)},area3D:function(){return hi.area3D(this.p0,this.p1,this.p2)},centroid:function(){return hi.centroid(this.p0,this.p1,this.p2)},inCentre:function(){return hi.inCentre(this.p0,this.p1,this.p2)},interfaces_:function(){return[]},getClass:function(){return hi}}),hi.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},hi.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},hi.det=function(t,e,n,i){return t*i-e*n},hi.interpolateZ=function(t,e,n,i){var r=e.x,s=e.y,o=n.x-r,a=i.x-r,u=n.y-s,l=i.y-s,h=o*l-a*u,c=t.x-r,f=t.y-s,g=(l*c-a*f)/h,d=(-u*c+o*f)/h;return e.z+g*(n.z-e.z)+d*(i.z-e.z)},hi.longestSideLength=function(t,e,n){var i=t.distance(e),r=e.distance(n),s=n.distance(t),o=i;return r>o&&(o=r),s>o&&(o=s),o},hi.isAcute=function(t,e,n){return!(!li.isAcute(t,e,n)||!li.isAcute(e,n,t))&&!!li.isAcute(n,t,e)},hi.circumcentre=function(t,e,n){var i=n.x,r=n.y,s=t.x-i,o=t.y-r,a=e.x-i,u=e.y-r,l=2*hi.det(s,o,a,u);return new g(i-hi.det(o,s*s+o*o,u,a*a+u*u)/l,r+hi.det(s,s*s+o*o,a,a*a+u*u)/l)},hi.perpendicularBisector=function(t,e){var n=e.x-t.x,i=e.y-t.y;return new F(new F(t.x+n/2,t.y+i/2,1),new F(t.x-i+n/2,t.y+n+i/2,1))},hi.angleBisector=function(t,e,n){var i=e.distance(t),r=e.distance(n),s=i/(i+r),o=n.x-t.x,a=n.y-t.y;return new g(t.x+s*o,t.y+s*a)},hi.area3D=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,o=n.x-t.x,a=n.y-t.y,u=n.z-t.z,l=r*u-s*a,h=s*o-i*u,c=i*a-r*o,f=l*l+h*h+c*c;return Math.sqrt(f)/2},hi.centroid=function(t,e,n){return new g((t.x+e.x+n.x)/3,(t.y+e.y+n.y)/3)},hi.inCentre=function(t,e,n){var i=e.distance(n),r=t.distance(n),s=t.distance(e),o=i+r+s;return new g((i*t.x+r*e.x+s*n.x)/o,(i*t.y+r*e.y+s*n.y)/o)},e(ci.prototype,{getRadius:function(){return this.compute(),this.radius},getDiameter:function(){switch(this.compute(),this.extremalPts.length){case 0:return this.input.getFactory().createLineString();case 1:return this.input.getFactory().createPoint(this.centre)}var t=this.extremalPts[0],e=this.extremalPts[1];return this.input.getFactory().createLineString([t,e])},getExtremalPoints:function(){return this.compute(),this.extremalPts},computeCirclePoints:function(){if(this.input.isEmpty())return this.extremalPts=new Array(0).fill(null),null;if(1===this.input.getNumPoints()){var t=this.input.getCoordinates();return this.extremalPts=[new g(t[0])],null}var e=this.input.convexHull(),n=e.getCoordinates(),t=n;if(n[0].equals2D(n[n.length-1])&&(t=new Array(n.length-1).fill(null),H.copyDeep(n,0,t,0,n.length-1)),t.length<=2)return this.extremalPts=H.copyDeep(t),null;for(var i=ci.lowestPoint(t),r=ci.pointWitMinAngleWithX(t,i),s=0;s<t.length;s++){var o=ci.pointWithMinAngleWithSegment(t,i,r);if(li.isObtuse(i,o,r))return this.extremalPts=[new g(i),new g(r)],null;if(li.isObtuse(o,i,r))i=o;else{if(!li.isObtuse(o,r,i))return this.extremalPts=[new g(i),new g(r),new g(o)],null;r=o}}f.shouldNeverReachHere("Logic failure in Minimum Bounding Circle algorithm!")},compute:function(){return null!==this.extremalPts?null:(this.computeCirclePoints(),this.computeCentre(),void(null!==this.centre&&(this.radius=this.centre.distance(this.extremalPts[0]))))},getFarthestPoints:function(){switch(this.compute(),this.extremalPts.length){case 0:return this.input.getFactory().createLineString();case 1:return this.input.getFactory().createPoint(this.centre)}var t=this.extremalPts[0],e=this.extremalPts[this.extremalPts.length-1];return this.input.getFactory().createLineString([t,e])},getCircle:function(){if(this.compute(),null===this.centre)return this.input.getFactory().createPolygon();var t=this.input.getFactory().createPoint(this.centre);return 0===this.radius?t:t.buffer(this.radius)},getCentre:function(){return this.compute(),this.centre},computeCentre:function(){switch(this.extremalPts.length){case 0:this.centre=null;break;case 1:this.centre=this.extremalPts[0];break;case 2:this.centre=new g((this.extremalPts[0].x+this.extremalPts[1].x)/2,(this.extremalPts[0].y+this.extremalPts[1].y)/2);break;case 3:this.centre=hi.circumcentre(this.extremalPts[0],this.extremalPts[1],this.extremalPts[2])}},interfaces_:function(){return[]},getClass:function(){return ci}}),ci.pointWitMinAngleWithX=function(t,e){for(var n=r.MAX_VALUE,i=null,s=0;s<t.length;s++){var o=t[s];if(o!==e){var a=o.x-e.x,u=o.y-e.y;0>u&&(u=-u);var l=Math.sqrt(a*a+u*u),h=u/l;n>h&&(n=h,i=o)}}return i},ci.lowestPoint=function(t){for(var e=t[0],n=1;n<t.length;n++)t[n].y<e.y&&(e=t[n]);return e},ci.pointWithMinAngleWithSegment=function(t,e,n){for(var i=r.MAX_VALUE,s=null,o=0;o<t.length;o++){var a=t[o];if(a!==e&&a!==n){var u=li.angleBetween(e,a,n);i>u&&(i=u,s=a)}}return s},e(fi.prototype,{getWidthCoordinate:function(){return this.computeMinimumDiameter(),this.minWidthPt},getSupportingSegment:function(){return this.computeMinimumDiameter(),this.inputGeom.getFactory().createLineString([this.minBaseSeg.p0,this.minBaseSeg.p1])},getDiameter:function(){if(this.computeMinimumDiameter(),null===this.minWidthPt)return this.inputGeom.getFactory().createLineString(null);var t=this.minBaseSeg.project(this.minWidthPt);return this.inputGeom.getFactory().createLineString([t,this.minWidthPt])},computeWidthConvex:function(t){this.convexHullPts=t instanceof Tt?t.getExteriorRing().getCoordinates():t.getCoordinates(),0===this.convexHullPts.length?(this.minWidth=0,this.minWidthPt=null,this.minBaseSeg=null):1===this.convexHullPts.length?(this.minWidth=0,this.minWidthPt=this.convexHullPts[0],this.minBaseSeg.p0=this.convexHullPts[0],this.minBaseSeg.p1=this.convexHullPts[0]):2===this.convexHullPts.length||3===this.convexHullPts.length?(this.minWidth=0,this.minWidthPt=this.convexHullPts[0],this.minBaseSeg.p0=this.convexHullPts[0],this.minBaseSeg.p1=this.convexHullPts[1]):this.computeConvexRingMinDiameter(this.convexHullPts)},computeConvexRingMinDiameter:function(t){this.minWidth=r.MAX_VALUE;for(var e=1,n=new he,i=0;i<t.length-1;i++)n.p0=t[i],n.p1=t[i+1],e=this.findMaxPerpDistance(t,n,e)},computeMinimumDiameter:function(){if(null!==this.minWidthPt)return null;if(this.isConvex)this.computeWidthConvex(this.inputGeom);else{var t=new me(this.inputGeom).getConvexHull();this.computeWidthConvex(t)}},getLength:function(){return this.computeMinimumDiameter(),this.minWidth},findMaxPerpDistance:function(t,e,n){for(var i=e.distancePerpendicular(t[n]),r=i,s=n,o=s;r>=i;)i=r,s=o,o=fi.nextIndex(t,s),r=e.distancePerpendicular(t[o]);return i<this.minWidth&&(this.minPtIndex=s,this.minWidth=i,this.minWidthPt=t[this.minPtIndex],this.minBaseSeg=new he(e)),s},getMinimumRectangle:function(){if(this.computeMinimumDiameter(),0===this.minWidth)return this.minBaseSeg.p0.equals2D(this.minBaseSeg.p1)?this.inputGeom.getFactory().createPoint(this.minBaseSeg.p0):this.minBaseSeg.toGeometry(this.inputGeom.getFactory());for(var t=this.minBaseSeg.p1.x-this.minBaseSeg.p0.x,e=this.minBaseSeg.p1.y-this.minBaseSeg.p0.y,n=r.MAX_VALUE,i=-r.MAX_VALUE,s=r.MAX_VALUE,o=-r.MAX_VALUE,a=0;a<this.convexHullPts.length;a++){var u=fi.computeC(t,e,this.convexHullPts[a]);u>i&&(i=u),n>u&&(n=u);var l=fi.computeC(-e,t,this.convexHullPts[a]);l>o&&(o=l),s>l&&(s=l)}var h=fi.computeSegmentForLine(-t,-e,o),c=fi.computeSegmentForLine(-t,-e,s),f=fi.computeSegmentForLine(-e,t,i),g=fi.computeSegmentForLine(-e,t,n),d=f.lineIntersection(h),p=g.lineIntersection(h),m=g.lineIntersection(c),v=f.lineIntersection(c),y=this.inputGeom.getFactory().createLinearRing([d,p,m,v,d]);return this.inputGeom.getFactory().createPolygon(y,null)},interfaces_:function(){return[]},getClass:function(){return fi}}),fi.nextIndex=function(t,e){return e++,e>=t.length&&(e=0),e},fi.computeC=function(t,e,n){return t*n.y-e*n.x},fi.getMinimumDiameter=function(t){return new fi(t).getDiameter()},fi.getMinimumRectangle=function(t){return new fi(t).getMinimumRectangle()},fi.computeSegmentForLine=function(t,e,n){var i=null,r=null;return Math.abs(e)>Math.abs(t)?(i=new g(0,n/e),r=new g(1,n/e-t/e)):(i=new g(n/t,0),r=new g(n/t-e/t,1)),new he(i,r)};var lo=Object.freeze({Centroid:fe,CGAlgorithms:le,ConvexHull:me,InteriorPointArea:si,InteriorPointLine:ai,InteriorPointPoint:ui,RobustLineIntersector:oe,MinimumBoundingCircle:ci,MinimumDiameter:fi});e(gi.prototype,{getResultGeometry:function(){return new di(this.distanceTolerance).transform(this.inputGeom)},setDistanceTolerance:function(t){if(0>=t)throw new i("Tolerance must be positive");this.distanceTolerance=t},interfaces_:function(){return[]},getClass:function(){return gi}}),gi.densifyPoints=function(t,e,n){for(var i=new he,r=new N,s=0;s<t.length-1;s++){i.p0=t[s],i.p1=t[s+1],r.add(i.p0,!1);var o=i.getLength(),a=Math.trunc(o/e)+1;if(a>1)for(var u=o/a,l=1;a>l;l++){var h=l*u/o,c=i.pointAlong(h);n.makePrecise(c),r.add(c,!1)}}return r.add(t[t.length-1],!1),r.toCoordinateArray()},gi.densify=function(t,e){var n=new gi(t);return n.setDistanceTolerance(e),n.getResultGeometry()},h(di,ye),e(di.prototype,{transformMultiPolygon:function(t,e){var n=ye.prototype.transformMultiPolygon.call(this,t,e);return this.createValidArea(n)},transformPolygon:function(t,e){var n=ye.prototype.transformPolygon.call(this,t,e);return e instanceof Ot?n:this.createValidArea(n)},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=gi.densifyPoints(n,this.distanceTolerance,e.getPrecisionModel());return e instanceof St&&1===i.length&&(i=new Array(0).fill(null)),this.factory.getCoordinateSequenceFactory().create(i)},createValidArea:function(t){return t.buffer(0)},interfaces_:function(){return[]},getClass:function(){return di}}),gi.DensifyTransformer=di;var ho=Object.freeze({Densifier:gi});e(pi.prototype,{find:function(t){var e=this;do{if(null===e)return null;if(e.dest().equals2D(t))return e;e=e.oNext()}while(e!==this);return null},dest:function(){return this._sym._orig},oNext:function(){return this._sym._next},insert:function(t){if(this.oNext()===this)return this.insertAfter(t),null;var e=this.compareTo(t),n=this;do{var i=n.oNext();if(i.compareTo(t)!==e||i===this)return n.insertAfter(t),null;n=i}while(n!==this);f.shouldNeverReachHere()},insertAfter:function(t){f.equals(this._orig,t.orig());var e=this.oNext();this._sym.setNext(t),t.sym().setNext(e)},degree:function t(){var t=0,e=this;do{t++,e=e.oNext()}while(e!==this);return t},equals:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this._orig.equals2D(t)&&this._sym._orig.equals(e)}},deltaY:function(){return this._sym._orig.y-this._orig.y},sym:function(){return this._sym},prev:function(){return this._sym.next()._sym},compareAngularDirection:function(t){var e=this.deltaX(),n=this.deltaY(),i=t.deltaX(),r=t.deltaY();if(e===i&&n===r)return 0;var s=Qe.quadrant(e,n),o=Qe.quadrant(i,r);return s>o?1:o>s?-1:le.computeOrientation(t._orig,t.dest(),this.dest())},prevNode:function(){for(var t=this;2===t.degree();)if((t=t.prev())===this)return null;return t},compareTo:function(t){var e=t;return this.compareAngularDirection(e)},next:function(){return this._next},setSym:function(t){this._sym=t},orig:function(){return this._orig},toString:function(){return"HE("+this._orig.x+" "+this._orig.y+", "+this._sym._orig.x+" "+this._sym._orig.y+")"},setNext:function(t){this._next=t},init:function(t){this.setSym(t),t.setSym(this),this.setNext(t),t.setNext(this)},deltaX:function(){return this._sym._orig.x-this._orig.x},interfaces_:function(){return[]},getClass:function(){return pi}}),pi.init=function(t,e){if(null!==t._sym||null!==e._sym||null!==t._next||null!==e._next)throw new IllegalStateException("Edges are already initialized");return t.init(e),t},pi.create=function(t,e){var n=new pi(t),i=new pi(e);return n.init(i),n},h(mi,pi),e(mi.prototype,{mark:function(){this._isMarked=!0},setMark:function(t){this._isMarked=t},isMarked:function(){return this._isMarked},interfaces_:function(){return[]},getClass:function(){return mi}}),mi.setMarkBoth=function(t,e){t.setMark(e),t.sym().setMark(e)},mi.isMarked=function(t){return t.isMarked()},mi.setMark=function(t,e){t.setMark(e)},mi.markBoth=function(t){t.mark(),t.sym().mark()},mi.mark=function(t){t.mark()},e(vi.prototype,{insert:function(t,e,n){var i=this.create(t,e);null!==n?n.insert(i):this.vertexMap.put(t,i);var r=this.vertexMap.get(e);return null!==r?r.insert(i.sym()):this.vertexMap.put(e,i.sym()),i},create:function(t,e){var n=this.createEdge(t),i=this.createEdge(e);return pi.init(n,i),n},createEdge:function(t){return new pi(t)},addEdge:function(t,e){if(!vi.isValidEdge(t,e))return null;var n=this.vertexMap.get(t),i=null;return null!==n&&(i=n.find(e)),null!==i?i:this.insert(t,e,n)},getVertexEdges:function(){return this.vertexMap.values()},findEdge:function(t,e){var n=this.vertexMap.get(t);return null===n?null:n.find(e)},interfaces_:function(){return[]},getClass:function(){return vi}}),vi.isValidEdge=function(t,e){return 0!==e.compareTo(t)},h(yi,mi),e(yi.prototype,{setStart:function(){this._isStart=!0},isStart:function(){return this._isStart},interfaces_:function(){return[]},getClass:function(){return yi}}),h(xi,vi),e(xi.prototype,{createEdge:function(t){return new yi(t)},interfaces_:function(){return[]},getClass:function(){return xi}}),e(Ei.prototype,{addLine:function(t){this.lines.add(this.factory.createLineString(t.toCoordinateArray()))},updateRingStartEdge:function(t){return t.isStart()||(t=t.sym(),t.isStart())?null===this.ringStartEdge?(this.ringStartEdge=t,null):void(t.orig().compareTo(this.ringStartEdge.orig())<0&&(this.ringStartEdge=t)):null},getResult:function(){return null===this.result&&this.computeResult(),this.result},process:function(t){var e=t.prevNode();null===e&&(e=t),this.stackEdges(e),this.buildLines()},buildRing:function(t){var e=new N,n=t;for(e.add(n.orig().copy(),!1);2===n.sym().degree();){var i=n.next();if(i===t)break;e.add(i.orig().copy(),!1),n=i}e.add(n.dest().copy(),!1),this.addLine(e)},buildLine:function(t){var e=new N,n=t;for(this.ringStartEdge=null,mi.markBoth(n),e.add(n.orig().copy(),!1);2===n.sym().degree();){this.updateRingStartEdge(n);var i=n.next();if(i===t)return this.buildRing(this.ringStartEdge),null;e.add(i.orig().copy(),!1),n=i,mi.markBoth(n)}e.add(n.dest().copy(),!1),this.stackEdges(n.sym()),this.addLine(e)},stackEdges:function(t){var e=t;do{mi.isMarked(e)||this.nodeEdgeStack.add(e),e=e.oNext()}while(e!==t)},computeResult:function(){for(var t=this.graph.getVertexEdges(),e=t.iterator();e.hasNext();){var n=e.next();mi.isMarked(n)||this.process(n)}this.result=this.factory.buildGeometry(this.lines)},buildLines:function(){for(;!this.nodeEdgeStack.empty();){var t=this.nodeEdgeStack.pop();mi.isMarked(t)||this.buildLine(t)}},add:function(){if(arguments[0]instanceof B){arguments[0].apply({interfaces_:function(){return[q]},filter:function(t){t instanceof St&&this.add(t)}})}else if(R(arguments[0],m))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.add(n)}else if(arguments[0]instanceof St){var i=arguments[0];null===this.factory&&(this.factory=i.getFactory());for(var r=i.getCoordinateSequence(),s=!1,e=1;e<r.size();e++){var o=this.graph.addEdge(r.getCoordinate(e-1),r.getCoordinate(e));null!==o&&(s||(o.setStart(),s=!0))}}},interfaces_:function(){return[]},getClass:function(){return Ei}}),Ei.dissolve=function(t){var e=new Ei;return e.add(t),e.getResult()};var co=Object.freeze({LineDissolver:Ei});e(Ii.prototype,{hasChildren:function(){for(var t=0;4>t;t++)if(null!==this.subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this.items);for(var e=0;4>e;e++)null!==this.subnode[e]&&this.subnode[e].addAllItems(t);return t},getNodeCount:function(){for(var t=0,e=0;4>e;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+1},size:function(){for(var t=0,e=0;4>e;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+this.items.size()},addAllItemsFromOverlapping:function(t,e){if(!this.isSearchMatch(t))return null;e.addAll(this.items);for(var n=0;4>n;n++)null!==this.subnode[n]&&this.subnode[n].addAllItemsFromOverlapping(t,e)},visitItems:function(t,e){for(var n=this.items.iterator();n.hasNext();)e.visitItem(n.next())},hasItems:function(){return!this.items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1;for(var n=!1,i=0;4>i;i++)if(null!==this.subnode[i]&&(n=this.subnode[i].remove(t,e))){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}return n?n:n=this.items.remove(e)},visit:function(t,e){if(!this.isSearchMatch(t))return null;this.visitItems(t,e);for(var n=0;4>n;n++)null!==this.subnode[n]&&this.subnode[n].visit(t,e)},getItems:function(){return this.items},depth:function(){for(var t=0,e=0;4>e;e++)if(null!==this.subnode[e]){var n=this.subnode[e].depth();n>t&&(t=n)}return t+1},isEmpty:function t(){var t=!0;this.items.isEmpty()||(t=!1);for(var e=0;4>e;e++)null!==this.subnode[e]&&(this.subnode[e].isEmpty()||(t=!1));return t},add:function(t){this.items.add(t)},interfaces_:function(){return[u]},getClass:function(){return Ii}}),Ii.getSubnodeIndex=function(t,e,n){var i=-1;return t.getMinX()>=e&&(t.getMinY()>=n&&(i=3),t.getMaxY()<=n&&(i=1)),t.getMaxX()<=e&&(t.getMinY()>=n&&(i=2),t.getMaxY()<=n&&(i=0)),i},Ni.exponent=function(t){return Ci(64,t)-1023},Ni.powerOf2=function(t){return Math.pow(2,t)},e(Si.prototype,{getLevel:function(){return this.level},computeKey:function(){if(1===arguments.length){var t=arguments[0];for(this.level=Si.computeQuadLevel(t),this.env=new C,this.computeKey(this.level,t);!this.env.contains(t);)this.level+=1,this.computeKey(this.level,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=Ni.powerOf2(e);this.pt.x=Math.floor(n.getMinX()/i)*i,this.pt.y=Math.floor(n.getMinY()/i)*i,this.env.init(this.pt.x,this.pt.x+i,this.pt.y,this.pt.y+i)}},getEnvelope:function(){return this.env},getCentre:function(){return new g((this.env.getMinX()+this.env.getMaxX())/2,(this.env.getMinY()+this.env.getMaxY())/2)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Si}}),Si.computeQuadLevel=function(t){var e=t.getWidth(),n=t.getHeight(),i=e>n?e:n;return Ni.exponent(i)+1},h(wi,Ii),e(wi.prototype,{find:function(t){var e=Ii.getSubnodeIndex(t,this.centrex,this.centrey);if(-1===e)return this;if(null!==this.subnode[e]){return this.subnode[e].find(t)}return this},isSearchMatch:function(t){return this.env.intersects(t)},getSubnode:function(t){return null===this.subnode[t]&&(this.subnode[t]=this.createSubnode(t)),this.subnode[t]},getEnvelope:function(){return this.env},getNode:function(t){var e=Ii.getSubnodeIndex(t,this.centrex,this.centrey);if(-1!==e){return this.getSubnode(e).getNode(t)}return this},createSubnode:function(t){var e=0,n=0,i=0,r=0;switch(t){case 0:e=this.env.getMinX(),n=this.centrex,i=this.env.getMinY(),r=this.centrey;break;case 1:e=this.centrex,n=this.env.getMaxX(),i=this.env.getMinY(),r=this.centrey;break;case 2:e=this.env.getMinX(),n=this.centrex,i=this.centrey,r=this.env.getMaxY();break;case 3:e=this.centrex,n=this.env.getMaxX(),i=this.centrey,r=this.env.getMaxY()}return new wi(new C(e,n,i,r),this.level-1)},insertNode:function(t){f.isTrue(null===this.env||this.env.contains(t.env));var e=Ii.getSubnodeIndex(t.env,this.centrex,this.centrey);if(t.level===this.level-1)this.subnode[e]=t;else{var n=this.createSubnode(e);n.insertNode(t),this.subnode[e]=n}},interfaces_:function(){return[]},getClass:function(){return wi}}),wi.createNode=function(t){var e=new Si(t);return new wi(e.getEnvelope(),e.getLevel())},wi.createExpanded=function(t,e){var n=new C(e);null!==t&&n.expandToInclude(t.env);var i=wi.createNode(n);return null!==t&&i.insertNode(t),i},e(Li.prototype,{interfaces_:function(){return[]},getClass:function(){return Li}}),Li.isZeroWidth=function(t,e){var n=e-t;if(0===n)return!0;var i=Math.max(Math.abs(t),Math.abs(e)),r=n/i;return Ni.exponent(r)<=Li.MIN_BINARY_EXPONENT},Li.MIN_BINARY_EXPONENT=-50,h(Ri,Ii),e(Ri.prototype,{insert:function(t,e){var n=Ii.getSubnodeIndex(t,Ri.origin.x,Ri.origin.y);if(-1===n)return this.add(e),null;var i=this.subnode[n];if(null===i||!i.getEnvelope().contains(t)){var r=wi.createExpanded(i,t);this.subnode[n]=r}this.insertContained(this.subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){f.isTrue(t.getEnvelope().contains(e));var i=Li.isZeroWidth(e.getMinX(),e.getMaxX()),r=Li.isZeroWidth(e.getMinY(),e.getMaxY()),s=null;s=i||r?t.find(e):t.getNode(e),s.add(n)},interfaces_:function(){return[]},getClass:function(){return Ri}}),Ri.origin=new g(0,0),e(Ti.prototype,{size:function(){return null!==this.root?this.root.size():0},insert:function(t,e){this.collectStats(t);var n=Ti.ensureExtent(t,this.minExtent);this.root.insert(n,e)},query:function(){if(1===arguments.length){var t=arguments[0],e=new kn;return this.query(t,e),e.getItems()}if(2===arguments.length){var n=arguments[0],i=arguments[1];this.root.visit(n,i)}},queryAll:function(){var t=new I;return this.root.addAllItems(t),t},remove:function(t,e){var n=Ti.ensureExtent(t,this.minExtent);return this.root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this.minExtent&&e>0&&(this.minExtent=e);var n=t.getHeight();n<this.minExtent&&n>0&&(this.minExtent=n)},depth:function(){return null!==this.root?this.root.depth():0},isEmpty:function(){return null===this.root},interfaces_:function(){return[Ae,u]},getClass:function(){return Ti}}),Ti.ensureExtent=function(t,e){var n=t.getMinX(),i=t.getMaxX(),r=t.getMinY(),s=t.getMaxY();return n!==i&&r!==s?t:(n===i&&(n-=e/2,i=n+e/2),r===s&&(r-=e/2,s=r+e/2),new C(n,i,r,s))},Ti.serialVersionUID=-0x678b60c967a25400;var fo=Object.freeze({Quadtree:Ti}),go=Object.freeze({STRtree:Ve}),po=Object.freeze({quadtree:fo,strtree:go}),mo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];e(Pi.prototype,{read:function(t){var e=void 0;e="string"==typeof t?JSON.parse(t):t;var n=e.type
;if(!vo[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==mo.indexOf(n)?vo[n].apply(this,[e.coordinates]):"GeometryCollection"===n?vo[n].apply(this,[e.geometries]):vo[n].apply(this,[e])},write:function(t){var e=t.getGeometryType();if(!yo[e])throw new Error("Geometry is not supported");return yo[e].apply(this,[t])}});var vo={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var i=t.geometry.type;if(!vo[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=vo.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function t(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(new g(i[0],i[1]))}return t},bbox:function(t){return this.geometryFactory.createLinearRing([new g(t[0],t[1]),new g(t[2],t[1]),new g(t[2],t[3]),new g(t[0],t[3]),new g(t[0],t[1])])},Point:function(t){var e=new g(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(vo.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=vo.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(vo.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=vo.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),i=[],r=1;r<t.length;++r){var s=t[r],o=vo.coordinates.apply(this,[s]),a=this.geometryFactory.createLinearRing(o);i.push(a)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(vo.Polygon.apply(this,[i]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(this.read(i))}return this.geometryFactory.createGeometryCollection(e)}},yo={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:yo.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=yo.Point.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),i=0;i<n.length;++i){var r=n[i];e.push(yo.coordinate.apply(this,[r]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=yo.LineString.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=yo.LineString.apply(this,[t.shell]);e.push(n.coordinates);for(var i=0;i<t.holes.length;++i){var r=t.holes[i],s=yo.LineString.apply(this,[r]);e.push(s.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=yo.Polygon.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=i.getGeometryType();e.push(yo[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:e}}};e(bi.prototype,{read:function(t){var e=this.parser.read(t);return this.precisionModel.getType()===te.FIXED&&this.reducePrecision(e),e},reducePrecision:function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;n>e;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;n>e;e++)this.reducePrecision(t.geometries[e])}}),e(Oi.prototype,{write:function(t){return this.parser.write(t)}}),e(_i.prototype,{read:function(t){var e=this.parser.read(t);return this.precisionModel.getType()===te.FIXED&&this.reducePrecision(e),e},reducePrecision:function(t){if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(var e=0,n=t.points.coordinates.length;n>e;e++)this.precisionModel.makePrecise(t.points.coordinates[e]);else if(t.geometries)for(var i=0,r=t.geometries.length;r>i;i++)this.reducePrecision(t.geometries[i])}}),e(Di.prototype,{read:function(t){return t instanceof ol.geom.Point?this.convertFromPoint(t):t instanceof ol.geom.LineString?this.convertFromLineString(t):t instanceof ol.geom.LinearRing?this.convertFromLinearRing(t):t instanceof ol.geom.Polygon?this.convertFromPolygon(t):t instanceof ol.geom.MultiPoint?this.convertFromMultiPoint(t):t instanceof ol.geom.MultiLineString?this.convertFromMultiLineString(t):t instanceof ol.geom.MultiPolygon?this.convertFromMultiPolygon(t):t instanceof ol.geom.GeometryCollection?this.convertFromCollection(t):void 0},convertFromPoint:function(t){var e=t.getCoordinates();return this.geometryFactory.createPoint(new g(e[0],e[1]))},convertFromLineString:function(t){return this.geometryFactory.createLineString(t.getCoordinates().map(function(t){return new g(t[0],t[1])}))},convertFromLinearRing:function(t){return this.geometryFactory.createLinearRing(t.getCoordinates().map(function(t){return new g(t[0],t[1])}))},convertFromPolygon:function(t){for(var e=t.getLinearRings(),n=null,i=[],r=0;r<e.length;r++){var s=this.convertFromLinearRing(e[r]);0===r?n=s:i.push(s)}return this.geometryFactory.createPolygon(n,i)},convertFromMultiPoint:function(t){var e=t.getPoints().map(function(t){return this.convertFromPoint(t)},this);return this.geometryFactory.createMultiPoint(e)},convertFromMultiLineString:function(t){var e=t.getLineStrings().map(function(t){return this.convertFromLineString(t)},this);return this.geometryFactory.createMultiLineString(e)},convertFromMultiPolygon:function(t){var e=t.getPolygons().map(function(t){return this.convertFromPolygon(t)},this);return this.geometryFactory.createMultiPolygon(e)},convertFromCollection:function(t){var e=t.getGeometries().map(function(t){return this.read(t)},this);return this.geometryFactory.createGeometryCollection(e)},write:function(t){return"Point"===t.getGeometryType()?this.convertToPoint(t.getCoordinate()):"LineString"===t.getGeometryType()?this.convertToLineString(t):"LinearRing"===t.getGeometryType()?this.convertToLinearRing(t):"Polygon"===t.getGeometryType()?this.convertToPolygon(t):"MultiPoint"===t.getGeometryType()?this.convertToMultiPoint(t):"MultiLineString"===t.getGeometryType()?this.convertToMultiLineString(t):"MultiPolygon"===t.getGeometryType()?this.convertToMultiPolygon(t):"GeometryCollection"===t.getGeometryType()?this.convertToCollection(t):void 0},convertToPoint:function(t){return new ol.geom.Point([t.x,t.y])},convertToLineString:function(t){var e=t.points.coordinates.map(Mi);return new ol.geom.LineString(e)},convertToLinearRing:function(t){var e=t.points.coordinates.map(Mi);return new ol.geom.LinearRing(e)},convertToPolygon:function(t){for(var e=[t.shell.points.coordinates.map(Mi)],n=0;n<t.holes.length;n++)e.push(t.holes[n].points.coordinates.map(Mi));return new ol.geom.Polygon(e)},convertToMultiPoint:function(t){return new ol.geom.MultiPoint(t.getCoordinates().map(Mi))},convertToMultiLineString:function(t){for(var e=[],n=0;n<t.geometries.length;n++)e.push(this.convertToLineString(t.geometries[n]).getCoordinates());return new ol.geom.MultiLineString(e)},convertToMultiPolygon:function(t){for(var e=[],n=0;n<t.geometries.length;n++)e.push(this.convertToPolygon(t.geometries[n]).getCoordinates());return new ol.geom.MultiPolygon(e)},convertToCollection:function(t){for(var e=[],n=0;n<t.geometries.length;n++){var i=t.geometries[n];e.push(this.write(i))}return new ol.geom.GeometryCollection(e)}});var xo=Object.freeze({GeoJSONReader:bi,GeoJSONWriter:Oi,OL3Parser:Di,WKTReader:_i,WKTWriter:re});e(Ai.prototype,{rescale:function(){if(R(arguments[0],m))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){var i=arguments[0];2===i.length&&(new g(i[0]),new g(i[1]));for(var e=0;e<i.length;e++)i[e].x=i[e].x/this.scaleFactor+this.offsetX,i[e].y=i[e].y/this.scaleFactor+this.offsetY;2===i.length&&i[0].equals2D(i[1])&&A.out.println(i)}},scale:function(){if(R(arguments[0],m)){for(var t=arguments[0],e=new I,n=t.iterator();n.hasNext();){var i=n.next();e.add(new je(this.scale(i.getCoordinates()),i.getData()))}return e}if(arguments[0]instanceof Array){for(var r=arguments[0],s=new Array(r.length).fill(null),n=0;n<r.length;n++)s[n]=new g(Math.round((r[n].x-this.offsetX)*this.scaleFactor),Math.round((r[n].y-this.offsetY)*this.scaleFactor),r[n].z);return H.removeRepeatedPoints(s)}},isIntegerPrecision:function(){return 1===this.scaleFactor},getNodedSubstrings:function(){var t=this.noder.getNodedSubstrings();return this.isScaled&&this.rescale(t),t},computeNodes:function(t){var e=t;this.isScaled&&(e=this.scale(t)),this.noder.computeNodes(e)},interfaces_:function(){return[$e]},getClass:function(){return Ai}});var Eo=Object.freeze({MCIndexNoder:en,ScaledNoder:Ai,SegmentString:Pe});e(Fi.prototype,{isSimpleMultiPoint:function(t){if(t.isEmpty())return!0;for(var e=new at,n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n),r=i.getCoordinate();if(e.contains(r))return this.nonSimpleLocation=r,!1;e.add(r)}return!0},isSimplePolygonal:function(t){for(var e=Vn.getLines(t),n=e.iterator();n.hasNext();){var i=n.next();if(!this.isSimpleLinearGeometry(i))return!1}return!0},hasClosedEndpointIntersection:function(t){for(var e=new rt,n=t.getEdgeIterator();n.hasNext();){var i=n.next(),r=(i.getMaximumSegmentIndex(),i.isClosed()),s=i.getCoordinate(0);this.addEndpoint(e,s,r);var o=i.getCoordinate(i.getNumPoints()-1);this.addEndpoint(e,o,r)}for(var n=e.values().iterator();n.hasNext();){var a=n.next();if(a.isClosed&&2!==a.degree)return this.nonSimpleLocation=a.getCoordinate(),!0}return!1},getNonSimpleLocation:function(){return this.nonSimpleLocation},isSimpleLinearGeometry:function(t){if(t.isEmpty())return!0;var e=new Jn(0,t),n=new oe,i=e.computeSelfNodes(n,!0);return!i.hasIntersection()||(i.hasProperIntersection()?(this.nonSimpleLocation=i.getProperIntersectionPoint(),!1):!this.hasNonEndpointIntersection(e)&&(!this.isClosedEndpointsInInterior||!this.hasClosedEndpointIntersection(e)))},hasNonEndpointIntersection:function(t){for(var e=t.getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getMaximumSegmentIndex(),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next();if(!s.isEndPoint(i))return this.nonSimpleLocation=s.getCoordinate(),!0}return!1},addEndpoint:function(t,e,n){var i=t.get(e);null===i&&(i=new Gi(e),t.put(e,i)),i.addEndpoint(n)},computeSimple:function(t){return this.nonSimpleLocation=null,!!t.isEmpty()||(t instanceof St?this.isSimpleLinearGeometry(t):t instanceof gt?this.isSimpleLinearGeometry(t):t instanceof Pt?this.isSimpleMultiPoint(t):R(t,Rt)?this.isSimplePolygonal(t):!(t instanceof ft)||this.isSimpleGeometryCollection(t))},isSimple:function(){return this.nonSimpleLocation=null,this.computeSimple(this.inputGeom)},isSimpleGeometryCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.computeSimple(n))return!1}return!0},interfaces_:function(){return[]},getClass:function(){return Fi}}),e(Gi.prototype,{addEndpoint:function(t){this.degree++,this.isClosed|=t},getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Gi}}),Fi.EndpointInfo=Gi,e(qi.prototype,{getEndCapStyle:function(){return this.endCapStyle},isSingleSided:function(){return this._isSingleSided},setQuadrantSegments:function(t){this.quadrantSegments=t,0===this.quadrantSegments&&(this.joinStyle=qi.JOIN_BEVEL),this.quadrantSegments<0&&(this.joinStyle=qi.JOIN_MITRE,this.mitreLimit=Math.abs(this.quadrantSegments)),0>=t&&(this.quadrantSegments=1),this.joinStyle!==qi.JOIN_ROUND&&(this.quadrantSegments=qi.DEFAULT_QUADRANT_SEGMENTS)},getJoinStyle:function(){return this.joinStyle},setJoinStyle:function(t){this.joinStyle=t},setSimplifyFactor:function(t){this.simplifyFactor=0>t?0:t},getSimplifyFactor:function(){return this.simplifyFactor},getQuadrantSegments:function(){return this.quadrantSegments},setEndCapStyle:function(t){this.endCapStyle=t},getMitreLimit:function(){return this.mitreLimit},setMitreLimit:function(t){this.mitreLimit=t},setSingleSided:function(t){this._isSingleSided=t},interfaces_:function(){return[]},getClass:function(){return qi}}),qi.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},qi.CAP_ROUND=1,qi.CAP_FLAT=2,qi.CAP_SQUARE=3,qi.JOIN_ROUND=1,qi.JOIN_MITRE=2,qi.JOIN_BEVEL=3,qi.DEFAULT_QUADRANT_SEGMENTS=8,qi.DEFAULT_MITRE_LIMIT=5,qi.DEFAULT_SIMPLIFY_FACTOR=.01,e(Bi.prototype,{getCoordinate:function(){return this.minCoord},getRightmostSide:function(t,e){var n=this.getRightmostSideOfSegment(t,e);return 0>n&&(n=this.getRightmostSideOfSegment(t,e-1)),0>n&&(this.minCoord=null,this.checkForRightmostCoordinate(t)),n},findRightmostEdgeAtVertex:function(){var t=this.minDe.getEdge().getCoordinates();f.isTrue(this.minIndex>0&&this.minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this.minIndex-1],n=t[this.minIndex+1],i=le.computeOrientation(this.minCoord,n,e),r=!1;e.y<this.minCoord.y&&n.y<this.minCoord.y&&i===le.COUNTERCLOCKWISE?r=!0:e.y>this.minCoord.y&&n.y>this.minCoord.y&&i===le.CLOCKWISE&&(r=!0),r&&(this.minIndex=this.minIndex-1)},getRightmostSideOfSegment:function(t,e){var n=t.getEdge(),i=n.getCoordinates();if(0>e||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var r=hn.LEFT;return i[e].y<i[e+1].y&&(r=hn.RIGHT),r},getEdge:function(){return this.orientedDe},checkForRightmostCoordinate:function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this.minCoord||e[n].x>this.minCoord.x)&&(this.minDe=t,this.minIndex=n,this.minCoord=e[n])},findRightmostEdgeAtNode:function(){var t=this.minDe.getNode(),e=t.getEdges();this.minDe=e.getRightmostEdge(),this.minDe.isForward()||(this.minDe=this.minDe.getSym(),this.minIndex=this.minDe.getEdge().getCoordinates().length-1)},findEdge:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}f.isTrue(0!==this.minIndex||this.minCoord.equals(this.minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this.minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.orientedDe=this.minDe,this.getRightmostSide(this.minDe,this.minIndex)===hn.LEFT&&(this.orientedDe=this.minDe.getSym())},interfaces_:function(){return[]},getClass:function(){return Bi}}),zi.prototype.addLast=function(t){this.array_.push(t)},zi.prototype.removeFirst=function(){return this.array_.shift()},zi.prototype.isEmpty=function(){return 0===this.array_.length},e(Vi.prototype,{clearVisitedEdges:function(){for(var t=this.dirEdgeList.iterator();t.hasNext();){t.next().setVisited(!1)}},getRightmostCoordinate:function(){return this.rightMostCoord},computeNodeDepth:function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){e=i;break}}if(null===e)throw new rn("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();i.setVisited(!0),this.copySymDepths(i)}},computeDepth:function(t){this.clearVisitedEdges();var e=this.finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(hn.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},create:function(t){this.addReachable(t),this.finder.findEdge(this.dirEdgeList),this.rightMostCoord=this.finder.getCoordinate()},findResultEdges:function(){for(var t=this.dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(hn.RIGHT)>=1&&e.getDepth(hn.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},computeDepths:function(t){var e=new J,n=new zi,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();e.add(r),this.computeNodeDepth(r);for(var s=r.getEdges().iterator();s.hasNext();){var o=s.next(),a=o.getSym();if(!a.isVisited()){var u=a.getNode();e.contains(u)||(n.addLast(u),e.add(u))}}}},compareTo:function(t){var e=t;return this.rightMostCoord.x<e.rightMostCoord.x?-1:this.rightMostCoord.x>e.rightMostCoord.x?1:0},getEnvelope:function(){if(null===this.env){for(var t=new C,e=this.dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),i=n.getEdge().getCoordinates(),r=0;r<i.length-1;r++)t.expandToInclude(i[r]);this.env=t}return this.env},addReachable:function(t){var e=new de;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},copySymDepths:function(t){var e=t.getSym();e.setDepth(hn.LEFT,t.getDepth(hn.RIGHT)),e.setDepth(hn.RIGHT,t.getDepth(hn.LEFT))},add:function(t,e){t.setVisited(!0),this.nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();this.dirEdgeList.add(i);var r=i.getSym(),s=r.getNode();s.isVisited()||e.push(s)}},getNodes:function(){return this.nodes},getDirectedEdges:function(){return this.dirEdgeList},interfaces_:function(){return[s]},getClass:function(){return Vi}}),e(ki.prototype,{isDeletable:function(t,e,n,i){var r=this.inputLine[t],s=this.inputLine[e],o=this.inputLine[n];return!(!this.isConcave(r,s,o)||!this.isShallow(r,s,o,i))&&this.isShallowSampled(r,s,t,n,i)},deleteShallowConcavities:function(){for(var t=1,e=(this.inputLine.length,this.findNextNonDeletedIndex(t)),n=this.findNextNonDeletedIndex(e),i=!1;n<this.inputLine.length;){var r=!1;this.isDeletable(t,e,n,this.distanceTol)&&(this.isDeleted[e]=ki.DELETE,r=!0,i=!0),t=r?n:e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return i},isShallowConcavity:function(t,e,n,i){return le.computeOrientation(t,e,n)===this.angleOrientation&&i>le.distancePointLine(e,t,n)},isShallowSampled:function(t,e,n,i,r){var s=Math.trunc((i-n)/ki.NUM_PTS_TO_CHECK);0>=s&&(s=1);for(var o=n;i>o;o+=s)if(!this.isShallow(t,e,this.inputLine[o],r))return!1;return!0},isConcave:function(t,e,n){return le.computeOrientation(t,e,n)===this.angleOrientation},simplify:function(t){this.distanceTol=Math.abs(t),0>t&&(this.angleOrientation=le.CLOCKWISE),this.isDeleted=new Array(this.inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},findNextNonDeletedIndex:function(t){for(var e=t+1;e<this.inputLine.length&&this.isDeleted[e]===ki.DELETE;)e++;return e},isShallow:function(t,e,n,i){return i>le.distancePointLine(e,t,n)},collapseLine:function(){for(var t=new N,e=0;e<this.inputLine.length;e++)this.isDeleted[e]!==ki.DELETE&&t.add(this.inputLine[e]);return t.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return ki}}),ki.simplify=function(t,e){return new ki(t).simplify(e)},ki.INIT=0,ki.DELETE=1,ki.KEEP=1,ki.NUM_PTS_TO_CHECK=10,e(Yi.prototype,{getCoordinates:function(){return this.ptList.toArray(Yi.COORDINATE_ARRAY_TYPE)},setPrecisionModel:function(t){this.precisionModel=t},addPt:function(t){var e=new g(t);return this.precisionModel.makePrecise(e),this.isRedundant(e)?null:void this.ptList.add(e)},reverse:function(){},addPts:function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},isRedundant:function(t){if(this.ptList.size()<1)return!1;var e=this.ptList.get(this.ptList.size()-1);return t.distance(e)<this.minimimVertexDistance},toString:function(){return(new ne).createLineString(this.getCoordinates()).toString()},closeRing:function(){if(this.ptList.size()<1)return null;var t=new g(this.ptList.get(0)),e=this.ptList.get(this.ptList.size()-1);return this.ptList.size()>=2&&this.ptList.get(this.ptList.size()-2),t.equals(e)?null:void this.ptList.add(t)},setMinimumVertexDistance:function(t){this.minimimVertexDistance=t},interfaces_:function(){return[]},getClass:function(){return Yi}}),Yi.COORDINATE_ARRAY_TYPE=new Array(0).fill(null),e(Ui.prototype,{addNextSegment:function(t,e){if(this.s0=this.s1,this.s1=this.s2,this.s2=t,this.seg0.setCoordinates(this.s0,this.s1),this.computeOffsetSegment(this.seg0,this.side,this.distance,this.offset0),this.seg1.setCoordinates(this.s1,this.s2),this.computeOffsetSegment(this.seg1,this.side,this.distance,this.offset1),this.s1.equals(this.s2))return null;var n=le.computeOrientation(this.s0,this.s1,this.s2),i=n===le.CLOCKWISE&&this.side===hn.LEFT||n===le.COUNTERCLOCKWISE&&this.side===hn.RIGHT;0===n?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},addLineEndCap:function(t,e){var n=new he(t,e),i=new he;this.computeOffsetSegment(n,hn.LEFT,this.distance,i);var r=new he;this.computeOffsetSegment(n,hn.RIGHT,this.distance,r);var s=e.x-t.x,o=e.y-t.y,a=Math.atan2(o,s);switch(this.bufParams.getEndCapStyle()){case qi.CAP_ROUND:this.segList.addPt(i.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,le.CLOCKWISE,this.distance),this.segList.addPt(r.p1);break;case qi.CAP_FLAT:this.segList.addPt(i.p1),this.segList.addPt(r.p1);break;case qi.CAP_SQUARE:var u=new g;u.x=Math.abs(this.distance)*Math.cos(a),u.y=Math.abs(this.distance)*Math.sin(a);var l=new g(i.p1.x+u.x,i.p1.y+u.y),h=new g(r.p1.x+u.x,r.p1.y+u.y);this.segList.addPt(l),this.segList.addPt(h)}},getCoordinates:function(){return this.segList.getCoordinates()},addMitreJoin:function(t,e,n,i){var r=!0,s=null;try{s=F.intersection(e.p0,e.p1,n.p0,n.p1);(0>=i?1:s.distance(t)/Math.abs(i))>this.bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof w))throw t;s=new g(0,0),r=!1}finally{}r?this.segList.addPt(s):this.addLimitedMitreJoin(e,n,i,this.bufParams.getMitreLimit())},addFilletCorner:function(t,e,n,i,r){var s=e.x-t.x,o=e.y-t.y,a=Math.atan2(o,s),u=n.x-t.x,l=n.y-t.y,h=Math.atan2(l,u);i===le.CLOCKWISE?h>=a&&(a+=2*Math.PI):a>=h&&(a-=2*Math.PI),this.segList.addPt(e),this.addFilletArc(t,a,h,i,r),this.segList.addPt(n)},addOutsideTurn:function(t,e){return this.offset0.p1.distance(this.offset1.p0)<this.distance*Ui.OFFSET_SEGMENT_SEPARATION_FACTOR?(this.segList.addPt(this.offset0.p1),null):void(this.bufParams.getJoinStyle()===qi.JOIN_MITRE?this.addMitreJoin(this.s1,this.offset0,this.offset1,this.distance):this.bufParams.getJoinStyle()===qi.JOIN_BEVEL?this.addBevelJoin(this.offset0,this.offset1):(e&&this.segList.addPt(this.offset0.p1),this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,t,this.distance),this.segList.addPt(this.offset1.p0)))},createSquare:function(t){this.segList.addPt(new g(t.x+this.distance,t.y+this.distance)),this.segList.addPt(new g(t.x+this.distance,t.y-this.distance)),this.segList.addPt(new g(t.x-this.distance,t.y-this.distance)),this.segList.addPt(new g(t.x-this.distance,t.y+this.distance)),this.segList.closeRing()},addSegments:function(t,e){this.segList.addPts(t,e)},addFirstSegment:function(){this.segList.addPt(this.offset1.p0)},addLastSegment:function(){this.segList.addPt(this.offset1.p1)},initSideSegments:function(t,e,n){this.s1=t,this.s2=e,this.side=n,this.seg1.setCoordinates(t,e),this.computeOffsetSegment(this.seg1,n,this.distance,this.offset1)},addLimitedMitreJoin:function(t,e,n,i){var r=this.seg0.p1,s=li.angle(r,this.seg0.p0),o=(li.angle(r,this.seg1.p1),li.angleBetweenOriented(this.seg0.p0,r,this.seg1.p1)),a=o/2,u=li.normalize(s+a),l=li.normalize(u+Math.PI),h=i*n,c=h*Math.abs(Math.sin(a)),f=n-c,d=r.x+h*Math.cos(l),p=r.y+h*Math.sin(l),m=new g(d,p),v=new he(r,m),y=v.pointAlongOffset(1,f),x=v.pointAlongOffset(1,-f);this.side===hn.LEFT?(this.segList.addPt(y),this.segList.addPt(x)):(this.segList.addPt(x),this.segList.addPt(y))},computeOffsetSegment:function(t,e,n,i){var r=e===hn.LEFT?1:-1,s=t.p1.x-t.p0.x,o=t.p1.y-t.p0.y,a=Math.sqrt(s*s+o*o),u=r*n*s/a,l=r*n*o/a;i.p0.x=t.p0.x-l,i.p0.y=t.p0.y+u,i.p1.x=t.p1.x-l,i.p1.y=t.p1.y+u},addFilletArc:function(t,e,n,i,r){var s=i===le.CLOCKWISE?-1:1,o=Math.abs(e-n),a=Math.trunc(o/this.filletAngleQuantum+.5);if(1>a)return null;var u=null,l=null;u=0,l=o/a;for(var h=u,c=new g;o>h;){var f=e+s*h;c.x=t.x+r*Math.cos(f),c.y=t.y+r*Math.sin(f),this.segList.addPt(c),h+=l}},addInsideTurn:function(t,e){if(this.li.computeIntersection(this.offset0.p0,this.offset0.p1,this.offset1.p0,this.offset1.p1),this.li.hasIntersection())this.segList.addPt(this.li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this.offset0.p1.distance(this.offset1.p0)<this.distance*Ui.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.segList.addPt(this.offset0.p1);else{if(this.segList.addPt(this.offset0.p1),this.closingSegLengthFactor>0){var n=new g((this.closingSegLengthFactor*this.offset0.p1.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset0.p1.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(n);var i=new g((this.closingSegLengthFactor*this.offset1.p0.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset1.p0.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(i)}else this.segList.addPt(this.s1);this.segList.addPt(this.offset1.p0)}},createCircle:function(t){var e=new g(t.x+this.distance,t.y);this.segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this.distance),this.segList.closeRing()},addBevelJoin:function(t,e){this.segList.addPt(t.p1),this.segList.addPt(e.p0)},init:function(t){this.distance=t,this.maxCurveSegmentError=t*(1-Math.cos(this.filletAngleQuantum/2)),this.segList=new Yi,this.segList.setPrecisionModel(this.precisionModel),this.segList.setMinimumVertexDistance(t*Ui.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},addCollinear:function(t){this.li.computeIntersection(this.s0,this.s1,this.s1,this.s2),this.li.getIntersectionNum()>=2&&(this.bufParams.getJoinStyle()===qi.JOIN_BEVEL||this.bufParams.getJoinStyle()===qi.JOIN_MITRE?(t&&this.segList.addPt(this.offset0.p1),this.segList.addPt(this.offset1.p0)):this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,le.CLOCKWISE,this.distance))},closeRing:function(){this.segList.closeRing()},hasNarrowConcaveAngle:function(){return this._hasNarrowConcaveAngle},interfaces_:function(){return[]},getClass:function(){return Ui}}),Ui.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Ui.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Ui.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Ui.MAX_CLOSING_SEG_LEN_FACTOR=80,e(Xi.prototype,{getOffsetCurve:function(t,e){if(this.distance=e,0===e)return null;var n=0>e,i=Math.abs(e),r=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,n,r);var s=r.getCoordinates();return n&&H.reverse(s),s},computeSingleSidedBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);if(e){n.addSegments(t,!0);var r=ki.simplify(t,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],hn.LEFT),n.addFirstSegment();for(var o=s-2;o>=0;o--)n.addNextSegment(r[o],!0)}else{n.addSegments(t,!1);var a=ki.simplify(t,i),u=a.length-1;n.initSideSegments(a[0],a[1],hn.LEFT),n.addFirstSegment();for(var o=2;u>=o;o++)n.addNextSegment(a[o],!0)}n.addLastSegment(),n.closeRing()},computeRingBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);e===hn.RIGHT&&(i=-i);var r=ki.simplify(t,i),s=r.length-1;n.initSideSegments(r[s-1],r[0],e);for(var o=1;s>=o;o++){var a=1!==o;n.addNextSegment(r[o],a)}n.closeRing()},computeLineBufferCurve:function(t,e){var n=this.simplifyTolerance(this.distance),i=ki.simplify(t,n),r=i.length-1;e.initSideSegments(i[0],i[1],hn.LEFT);for(var s=2;r>=s;s++)e.addNextSegment(i[s],!0);e.addLastSegment(),e.addLineEndCap(i[r-1],i[r]);var o=ki.simplify(t,-n),a=o.length-1;e.initSideSegments(o[a],o[a-1],hn.LEFT);for(var s=a-2;s>=0;s--)e.addNextSegment(o[s],!0);e.addLastSegment(),e.addLineEndCap(o[1],o[0]),e.closeRing()},computePointCurve:function(t,e){switch(this.bufParams.getEndCapStyle()){case qi.CAP_ROUND:e.createCircle(t);break;case qi.CAP_SQUARE:e.createSquare(t)}},getLineCurve:function(t,e){if(this.distance=e,0>e&&!this.bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this.bufParams.isSingleSided()){var r=0>e;this.computeSingleSidedBufferCurve(t,r,i)}else this.computeLineBufferCurve(t,i);return i.getCoordinates()},getBufferParameters:function(){return this.bufParams},simplifyTolerance:function(t){return t*this.bufParams.getSimplifyFactor()},getRingCurve:function(t,e,n){if(this.distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Xi.copyCoordinates(t);var i=this.getSegGen(n);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()},computeOffsetCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);if(e){var r=ki.simplify(t,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],hn.LEFT),n.addFirstSegment();for(var o=s-2;o>=0;o--)n.addNextSegment(r[o],!0)}else{var a=ki.simplify(t,i),u=a.length-1;n.initSideSegments(a[0],a[1],hn.LEFT),n.addFirstSegment();for(var o=2;u>=o;o++)n.addNextSegment(a[o],!0)}n.addLastSegment()},getSegGen:function(t){return new Ui(this.precisionModel,this.bufParams,t)},interfaces_:function(){return[]},getClass:function(){return Xi}}),Xi.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new g(t[n]);return e},e(Hi.prototype,{findStabbedSegments:function(){if(1===arguments.length){for(var t=arguments[0],e=new I,n=this.subgraphs.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,i.getDirectedEdges(),e)}return e}if(3===arguments.length)if(R(arguments[2],y)&&arguments[0]instanceof g&&arguments[1]instanceof En)for(var s=arguments[0],o=arguments[1],a=arguments[2],u=o.getEdge().getCoordinates(),n=0;n<u.length-1;n++){this.seg.p0=u[n],this.seg.p1=u[n+1],this.seg.p0.y>this.seg.p1.y&&this.seg.reverse();var l=Math.max(this.seg.p0.x,this.seg.p1.x);if(!(l<s.x||this.seg.isHorizontal()||s.y<this.seg.p0.y||s.y>this.seg.p1.y||le.computeOrientation(this.seg.p0,this.seg.p1,s)===le.RIGHT)){var h=o.getDepth(hn.LEFT);this.seg.p0.equals(u[n])||(h=o.getDepth(hn.RIGHT));var c=new Wi(this.seg,h);a.add(c)}}else if(R(arguments[2],y)&&arguments[0]instanceof g&&R(arguments[1],y))for(var f=arguments[0],d=arguments[1],p=arguments[2],n=d.iterator();n.hasNext();){var m=n.next();m.isForward()&&this.findStabbedSegments(f,m,p)}},getDepth:function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:uo.min(e).leftDepth},interfaces_:function(){return[]},getClass:function(){return Hi}}),e(Wi.prototype,{compareTo:function(t){var e=t;if(this.upwardSeg.minX()>=e.upwardSeg.maxX())return 1;if(this.upwardSeg.maxX()<=e.upwardSeg.minX())return-1;var n=this.upwardSeg.orientationIndex(e.upwardSeg);return 0!==n?n:(n=-1*e.upwardSeg.orientationIndex(this.upwardSeg),0!==n?n:this.upwardSeg.compareTo(e.upwardSeg))},compareX:function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},toString:function(){return this.upwardSeg.toString()},interfaces_:function(){return[s]},getClass:function(){return Wi}}),Hi.DepthSegment=Wi,e(ji.prototype,{addPoint:function(t){if(this.distance<=0)return null;var e=t.getCoordinates(),n=this.curveBuilder.getLineCurve(e,this.distance);this.addCurve(n,L.EXTERIOR,L.INTERIOR)},addPolygon:function(t){var e=this.distance,n=hn.LEFT;this.distance<0&&(e=-this.distance,n=hn.RIGHT);var i=t.getExteriorRing(),r=H.removeRepeatedPoints(i.getCoordinates());if(this.distance<0&&this.isErodedCompletely(i,this.distance))return null;if(this.distance<=0&&r.length<3)return null;this.addPolygonRing(r,e,n,L.EXTERIOR,L.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var o=t.getInteriorRingN(s),a=H.removeRepeatedPoints(o.getCoordinates());this.distance>0&&this.isErodedCompletely(o,-this.distance)||this.addPolygonRing(a,e,hn.opposite(n),L.INTERIOR,L.EXTERIOR)}},isTriangleErodedCompletely:function(t,e){var n=new hi(t[0],t[1],t[2]),i=n.inCentre();return le.distancePointLine(i,n.p0,n.p1)<Math.abs(e)},addLineString:function(t){if(this.distance<=0&&!this.curveBuilder.getBufferParameters().isSingleSided())return null;var e=H.removeRepeatedPoints(t.getCoordinates()),n=this.curveBuilder.getLineCurve(e,this.distance);this.addCurve(n,L.EXTERIOR,L.INTERIOR)},
addCurve:function(t,e,n){if(null===t||t.length<2)return null;var i=new je(t,new fn(0,L.BOUNDARY,e,n));this.curveList.add(i)},getCurves:function(){return this.add(this.inputGeom),this.curveList},addPolygonRing:function(t,e,n,i,r){if(0===e&&t.length<bt.MINIMUM_VALID_SIZE)return null;var s=i,o=r;t.length>=bt.MINIMUM_VALID_SIZE&&le.isCCW(t)&&(s=r,o=i,n=hn.opposite(n));var a=this.curveBuilder.getRingCurve(t,n,e);this.addCurve(a,s,o)},add:function(t){if(t.isEmpty())return null;if(t instanceof Tt)this.addPolygon(t);else if(t instanceof St)this.addLineString(t);else if(t instanceof Lt)this.addPoint(t);else if(t instanceof Pt)this.addCollection(t);else if(t instanceof gt)this.addCollection(t);else if(t instanceof Ot)this.addCollection(t);else{if(!(t instanceof ft))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},isErodedCompletely:function(t,e){var n=t.getCoordinates();if(n.length<4)return 0>e;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var i=t.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return 0>e&&2*Math.abs(e)>r},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},interfaces_:function(){return[]},getClass:function(){return ji}}),e(Ki.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this.li.getIntersectionNum()){if(Ki.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},hasProperInteriorIntersection:function(){return this.hasProperInterior},getLineIntersector:function(){return this.li},hasProperIntersection:function(){return this.hasProper},processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.li.computeIntersection(r,s,o,a),this.li.hasIntersection()&&(this.numIntersections++,this.li.isInteriorIntersection()&&(this.numInteriorIntersections++,this.hasInterior=!0),this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1),this.li.isProper()&&(this.numProperIntersections++,this.hasProper=!0,this.hasProperInterior=!0)))},hasIntersection:function(){return this._hasIntersection},isDone:function(){return!1},hasInteriorIntersection:function(){return this.hasInterior},interfaces_:function(){return[sn]},getClass:function(){return Ki}}),Ki.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},e(Zi.prototype,{setWorkingPrecisionModel:function(t){this.workingPrecisionModel=t},insertUniqueEdge:function(t){var e=this.edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new fn(t.getLabel()),i.flip()),n.merge(i);var r=Zi.depthDelta(i),s=e.getDepthDelta(),o=s+r;e.setDepthDelta(o)}else this.edgeList.add(t),t.setDepthDelta(Zi.depthDelta(t.getLabel()))},buildSubgraphs:function(t,e){for(var n=new I,i=t.iterator();i.hasNext();){var r=i.next(),s=r.getRightmostCoordinate(),o=new Hi(n),a=o.getDepth(s);r.computeDepth(a),r.findResultEdges(),n.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},createSubgraphs:function(t){for(var e=new I,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new Vi;r.create(i),e.add(r)}}return uo.sort(e,uo.reverseOrder()),e},createEmptyResultGeometry:function(){return this.geomFact.createPolygon()},getNoder:function(t){if(null!==this.workingNoder)return this.workingNoder;var e=new en,n=new oe;return n.setPrecisionModel(t),e.setSegmentIntersector(new Ki(n)),e},buffer:function(t,e){var n=this.workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this.geomFact=t.getFactory();var i=new Xi(n,this.bufParams),r=new ji(t,e,i),s=r.getCurves();if(s.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(s,n),this.graph=new Nn(new bn),this.graph.addEdges(this.edgeList.getEdges());var o=this.createSubgraphs(this.graph),a=new Cn(this.geomFact);this.buildSubgraphs(o,a);var u=a.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this.geomFact.buildGeometry(u)},computeNodedEdges:function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var i=n.getNodedSubstrings(),r=i.iterator();r.hasNext();){var s=r.next(),o=s.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var a=s.getData(),u=new Qn(s.getCoordinates(),new fn(a));this.insertUniqueEdge(u)}}},setNoder:function(t){this.workingNoder=t},interfaces_:function(){return[]},getClass:function(){return Zi}}),Zi.depthDelta=function(t){var e=t.getLocation(0,hn.LEFT),n=t.getLocation(0,hn.RIGHT);return e===L.INTERIOR&&n===L.EXTERIOR?1:e===L.EXTERIOR&&n===L.INTERIOR?-1:0},Zi.convertSegStrings=function(t){for(var e=new ne,n=new I;t.hasNext();){var i=t.next(),r=e.createLineString(i.getCoordinates());n.add(r)}return e.buildGeometry(n)},e(Qi.prototype,{checkEndPtVertexIntersections:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();){var e=t.next(),n=e.getCoordinates();this.checkEndPtVertexIntersections(n[0],this.segStrings),this.checkEndPtVertexIntersections(n[n.length-1],this.segStrings)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],t=r.iterator();t.hasNext();)for(var e=t.next(),n=e.getCoordinates(),s=1;s<n.length-1;s++)if(n[s].equals(i))throw new l("found endpt/interior pt intersection at index "+s+" :pt "+i)},checkInteriorIntersections:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();)for(var e=t.next(),n=this.segStrings.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(e,i)}else if(2===arguments.length)for(var r=arguments[0],s=arguments[1],o=r.getCoordinates(),a=s.getCoordinates(),u=0;u<o.length-1;u++)for(var h=0;h<a.length-1;h++)this.checkInteriorIntersections(r,u,s,h);else if(4===arguments.length){var c=arguments[0],f=arguments[1],g=arguments[2],d=arguments[3];if(c===g&&f===d)return null;var p=c.getCoordinates()[f],m=c.getCoordinates()[f+1],v=g.getCoordinates()[d],y=g.getCoordinates()[d+1];if(this.li.computeIntersection(p,m,v,y),this.li.hasIntersection()&&(this.li.isProper()||this.hasInteriorIntersection(this.li,p,m)||this.hasInteriorIntersection(this.li,v,y)))throw new l("found non-noded intersection at "+p+"-"+m+" and "+v+"-"+y)}},checkValid:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},checkCollapses:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0],i=n.getCoordinates(),t=0;t<i.length-2;t++)this.checkCollapse(i[t],i[t+1],i[t+2])},hasInteriorIntersection:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++){var r=t.getIntersection(i);if(!r.equals(e)&&!r.equals(n))return!0}return!1},checkCollapse:function(t,e,n){if(t.equals(n))throw new l("found non-noded collapse at "+Qi.fact.createLineString([t,e,n]))},interfaces_:function(){return[]},getClass:function(){return Qi}}),Qi.fact=new ne,e(Ji.prototype,{intersectsScaled:function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),r=Math.min(t.y,e.y),s=Math.max(t.y,e.y),o=this.maxx<n||this.minx>i||this.maxy<r||this.miny>s;if(o)return!1;var a=this.intersectsToleranceSquare(t,e);return f.isTrue(!(o&&a),"Found bad envelope test"),a},initCorners:function(t){this.minx=t.x-.5,this.maxx=t.x+.5,this.miny=t.y-.5,this.maxy=t.y+.5,this.corner[0]=new g(this.maxx,this.maxy),this.corner[1]=new g(this.minx,this.maxy),this.corner[2]=new g(this.minx,this.miny),this.corner[3]=new g(this.maxx,this.miny)},intersects:function(t,e){return 1===this.scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this.p0Scaled),this.copyScaled(e,this.p1Scaled),this.intersectsScaled(this.p0Scaled,this.p1Scaled))},scale:function(t){return Math.round(t*this.scaleFactor)},getCoordinate:function(){return this.originalPt},copyScaled:function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},getSafeEnvelope:function(){if(null===this.safeEnv){var t=Ji.SAFE_ENV_EXPANSION_FACTOR/this.scaleFactor;this.safeEnv=new C(this.originalPt.x-t,this.originalPt.x+t,this.originalPt.y-t,this.originalPt.y+t)}return this.safeEnv},intersectsPixelClosure:function(t,e){return this.li.computeIntersection(t,e,this.corner[0],this.corner[1]),!!this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[1],this.corner[2]),!!this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[2],this.corner[3]),!!this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[3],this.corner[0]),!!this.li.hasIntersection())))},intersectsToleranceSquare:function(t,e){var n=!1,i=!1;return this.li.computeIntersection(t,e,this.corner[0],this.corner[1]),!!this.li.isProper()||(this.li.computeIntersection(t,e,this.corner[1],this.corner[2]),!!this.li.isProper()||(this.li.hasIntersection()&&(n=!0),this.li.computeIntersection(t,e,this.corner[2],this.corner[3]),!!this.li.isProper()||(this.li.hasIntersection()&&(i=!0),this.li.computeIntersection(t,e,this.corner[3],this.corner[0]),!!this.li.isProper()||(!(!n||!i)||(!!t.equals(this.pt)||!!e.equals(this.pt))))))},addSnappedNode:function(t,e){var n=t.getCoordinate(e),i=t.getCoordinate(e+1);return!!this.intersects(n,i)&&(t.addIntersection(this.getCoordinate(),e),!0)},interfaces_:function(){return[]},getClass:function(){return Ji}}),Ji.SAFE_ENV_EXPANSION_FACTOR=.75,e($i.prototype,{select:function(){if(1===arguments.length)arguments[0];else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},interfaces_:function(){return[]},getClass:function(){return $i}}),e(tr.prototype,{snap:function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2],r=e.getSafeEnvelope(),s=new er(e,n,i);return this.index.query(r,{interfaces_:function(){return[De]},visitItem:function(t){t.select(r,s)}}),s.isNodeAdded()}},interfaces_:function(){return[]},getClass:function(){return tr}}),h(er,$i),e(er.prototype,{isNodeAdded:function(){return this._isNodeAdded},select:function(){if(2!==arguments.length)return $i.prototype.select.apply(this,arguments);var t=arguments[0],e=arguments[1],n=t.getContext();return null!==this.parentEdge&&n===this.parentEdge&&e===this.hotPixelVertexIndex?null:void(this._isNodeAdded=this.hotPixel.addSnappedNode(n,e))},interfaces_:function(){return[]},getClass:function(){return er}}),tr.HotPixelSnapAction=er,e(nr.prototype,{processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];if(this.li.computeIntersection(r,s,o,a),this.li.hasIntersection()&&this.li.isInteriorIntersection()){for(var u=0;u<this.li.getIntersectionNum();u++)this.interiorIntersections.add(this.li.getIntersection(u));t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1)}},isDone:function(){return!1},getInteriorIntersections:function(){return this.interiorIntersections},interfaces_:function(){return[sn]},getClass:function(){return nr}}),e(ir.prototype,{checkCorrectness:function(t){var e=je.getNodedSubstrings(t),n=new Qi(e);try{n.checkValid()}catch(t){if(!(t instanceof S))throw t;t.printStackTrace()}finally{}},getNodedSubstrings:function(){return je.getNodedSubstrings(this.nodedSegStrings)},snapRound:function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},findInteriorIntersections:function(t,e){var n=new nr(e);return this.noder.setSegmentIntersector(n),this.noder.computeNodes(t),n.getInteriorIntersections()},computeVertexSnaps:function(){if(R(arguments[0],m))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.computeVertexSnaps(n)}else if(arguments[0]instanceof je)for(var i=arguments[0],r=i.getCoordinates(),s=0;s<r.length;s++){var o=new Ji(r[s],this.scaleFactor,this.li),a=this.pointSnapper.snap(o,i,s);a&&i.addIntersection(r[s],s)}},computeNodes:function(t){this.nodedSegStrings=t,this.noder=new en,this.pointSnapper=new tr(this.noder.getIndex()),this.snapRound(t,this.li)},computeIntersectionSnaps:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=new Ji(n,this.scaleFactor,this.li);this.pointSnapper.snap(i)}},interfaces_:function(){return[$e]},getClass:function(){return ir}}),e(rr.prototype,{bufferFixedPrecision:function(t){var e=new Ai(new ir(new te(1)),t.getScale()),n=new Zi(this.bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this.resultGeometry=n.buffer(this.argGeom,this.distance)},bufferReducedPrecision:function(){if(0===arguments.length){for(var t=rr.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(t){if(!(t instanceof rn))throw t;this.saveException=t}finally{}if(null!==this.resultGeometry)return null}throw this.saveException}if(1===arguments.length){var e=arguments[0],n=rr.precisionScaleFactor(this.argGeom,this.distance,e),i=new te(n);this.bufferFixedPrecision(i)}},computeGeometry:function(){if(this.bufferOriginalPrecision(),null!==this.resultGeometry)return null;var t=this.argGeom.getFactory().getPrecisionModel();t.getType()===te.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},setQuadrantSegments:function(t){this.bufParams.setQuadrantSegments(t)},bufferOriginalPrecision:function(){try{var t=new Zi(this.bufParams);this.resultGeometry=t.buffer(this.argGeom,this.distance)}catch(t){if(!(t instanceof l))throw t;this.saveException=t}finally{}},getResultGeometry:function(t){return this.distance=t,this.computeGeometry(),this.resultGeometry},setEndCapStyle:function(t){this.bufParams.setEndCapStyle(t)},interfaces_:function(){return[]},getClass:function(){return rr}}),rr.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new rr(t),i=n.getResultGeometry(e);return i}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof B&&"number"==typeof arguments[1]){var r=arguments[0],s=arguments[1],o=arguments[2],a=new rr(r);a.setQuadrantSegments(o);var i=a.getResultGeometry(s);return i}if(arguments[2]instanceof qi&&arguments[0]instanceof B&&"number"==typeof arguments[1]){var u=arguments[0],l=arguments[1],h=arguments[2],a=new rr(u,h),i=a.getResultGeometry(l);return i}}else if(4===arguments.length){var c=arguments[0],f=arguments[1],g=arguments[2],d=arguments[3],a=new rr(c);a.setQuadrantSegments(g),a.setEndCapStyle(d);var i=a.getResultGeometry(f);return i}},rr.precisionScaleFactor=function(t,e,n){var i=t.getEnvelopeInternal(),r=T.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),s=e>0?e:0,o=r+2*s,a=Math.trunc(Math.log(o)/Math.log(10)+1),u=n-a;return Math.pow(10,u)},rr.CAP_ROUND=qi.CAP_ROUND,rr.CAP_BUTT=qi.CAP_FLAT,rr.CAP_FLAT=qi.CAP_FLAT,rr.CAP_SQUARE=qi.CAP_SQUARE,rr.MAX_PRECISION_DIGITS=12;var Io=Object.freeze({BufferOp:rr,BufferParameters:qi});e(sr.prototype,{filter:function(t){t instanceof Tt&&this.comps.add(t)},interfaces_:function(){return[ht]},getClass:function(){return sr}}),sr.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return sr.getPolygons(t,new I)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Tt?n.add(e):e instanceof ft&&e.apply(new sr(n)),n}},e(or.prototype,{isInsideArea:function(){return this.segIndex===or.INSIDE_AREA},getCoordinate:function(){return this.pt},getGeometryComponent:function(){return this.component},getSegmentIndex:function(){return this.segIndex},interfaces_:function(){return[]},getClass:function(){return or}}),or.INSIDE_AREA=-1,e(ar.prototype,{filter:function(t){t instanceof Lt&&this.pts.add(t)},interfaces_:function(){return[ht]},getClass:function(){return ar}}),ar.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Lt?uo.singletonList(t):ar.getPoints(t,new I)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Lt?n.add(e):e instanceof ft&&e.apply(new ar(n)),n}},e(ur.prototype,{filter:function(t){(t instanceof Lt||t instanceof St||t instanceof Tt)&&this.locations.add(new or(t,0,t.getCoordinate()))},interfaces_:function(){return[ht]},getClass:function(){return ur}}),ur.getLocations=function(t){var e=new I;return t.apply(new ur(e)),e},e(lr.prototype,{computeContainmentDistance:function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this.minDistance<=this.terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=1-e,r=sr.getPolygons(this.geom[e]);if(r.size()>0){var s=ur.getLocations(this.geom[i]);if(this.computeContainmentDistance(s,r,n),this.minDistance<=this.terminateDistance)return this.minDistanceLocation[i]=n[0],this.minDistanceLocation[e]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&R(arguments[0],y)&&R(arguments[1],y)){for(var o=arguments[0],a=arguments[1],u=arguments[2],l=0;l<o.size();l++)for(var h=o.get(l),c=0;c<a.size();c++)if(this.computeContainmentDistance(h,a.get(c),u),this.minDistance<=this.terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof or&&arguments[1]instanceof Tt){var f=arguments[0],g=arguments[1],d=arguments[2],p=f.getCoordinate();if(L.EXTERIOR!==this.ptLocator.locate(p,g))return this.minDistance=0,d[0]=f,d[1]=new or(g,p),null}},computeMinDistanceLinesPoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s);if(this.computeMinDistance(r,o,n),this.minDistance<=this.terminateDistance)return null}},computeFacetDistance:function(){var t=new Array(2).fill(null),e=Vn.getLines(this.geom[0]),n=Vn.getLines(this.geom[1]),i=ar.getPoints(this.geom[0]),r=ar.getPoints(this.geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(i,r,t),void this.updateMinDistance(t,!1))))},nearestLocations:function(){return this.computeMinDistance(),this.minDistanceLocation},updateMinDistance:function(t,e){return null===t[0]?null:void(e?(this.minDistanceLocation[0]=t[1],this.minDistanceLocation[1]=t[0]):(this.minDistanceLocation[0]=t[0],this.minDistanceLocation[1]=t[1]))},nearestPoints:function(){return this.computeMinDistance(),[this.minDistanceLocation[0].getCoordinate(),this.minDistanceLocation[1].getCoordinate()]},computeMinDistance:function(){if(0===arguments.length){if(null!==this.minDistanceLocation)return null;if(this.minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this.minDistance<=this.terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof St&&arguments[1]instanceof Lt){var t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this.minDistance)return null;for(var i=t.getCoordinates(),r=e.getCoordinate(),s=0;s<i.length-1;s++){var o=le.distancePointLine(r,i[s],i[s+1]);if(o<this.minDistance){this.minDistance=o;var a=new he(i[s],i[s+1]),u=a.closestPoint(r);n[0]=new or(t,s,u),n[1]=new or(e,0,r)}if(this.minDistance<=this.terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof St&&arguments[1]instanceof St){var l=arguments[0],h=arguments[1],c=arguments[2];if(l.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this.minDistance)return null;for(var i=l.getCoordinates(),f=h.getCoordinates(),s=0;s<i.length-1;s++)for(var g=0;g<f.length-1;g++){var o=le.distanceLineLine(i[s],i[s+1],f[g],f[g+1]);if(o<this.minDistance){this.minDistance=o;var d=new he(i[s],i[s+1]),p=new he(f[g],f[g+1]),m=d.closestPoints(p);c[0]=new or(l,s,m[0]),c[1]=new or(h,g,m[1])}if(this.minDistance<=this.terminateDistance)return null}}},computeMinDistancePoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s),a=r.getCoordinate().distance(o.getCoordinate());if(a<this.minDistance&&(this.minDistance=a,n[0]=new or(r,0,r.getCoordinate()),n[1]=new or(o,0,o.getCoordinate())),this.minDistance<=this.terminateDistance)return null}},distance:function(){if(null===this.geom[0]||null===this.geom[1])throw new i("null geometries are not supported");return this.geom[0].isEmpty()||this.geom[1].isEmpty()?0:(this.computeMinDistance(),this.minDistance)},computeMinDistanceLines:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s);if(this.computeMinDistance(r,o,n),this.minDistance<=this.terminateDistance)return null}},interfaces_:function(){return[]},getClass:function(){return lr}}),lr.distance=function(t,e){return new lr(t,e).distance()},lr.isWithinDistance=function(t,e,n){return new lr(t,e,n).distance()<=n},lr.nearestPoints=function(t,e){return new lr(t,e).nearestPoints()};var No=Object.freeze({DistanceOp:lr});e(hr.prototype,{getCoordinates:function(){if(null===this.coordinates){for(var t=0,e=0,n=new N,i=this.directedEdges.iterator();i.hasNext();){var r=i.next();r.getEdgeDirection()?t++:e++,n.add(r.getEdge().getLine().getCoordinates(),!1,r.getEdgeDirection())}this.coordinates=n.toCoordinateArray(),e>t&&H.reverse(this.coordinates)}return this.coordinates},toLineString:function(){return this.factory.createLineString(this.getCoordinates())},add:function(t){this.directedEdges.add(t)},interfaces_:function(){return[]},getClass:function(){return hr}}),e(cr.prototype,{setVisited:function(t){this._isVisited=t},isMarked:function(){return this._isMarked},setData:function(t){this.data=t},getData:function(){return this.data},setMarked:function(t){this._isMarked=t},getContext:function(){return this.data},isVisited:function(){return this._isVisited},setContext:function(t){this.data=t},interfaces_:function(){return[]},getClass:function(){return cr}}),cr.getComponentWithVisitedState=function(t,e){for(;t.hasNext();){var n=t.next();if(n.isVisited()===e)return n}return null},cr.setVisited=function(t,e){for(;t.hasNext();){t.next().setVisited(e)}},cr.setMarked=function(t,e){for(;t.hasNext();){t.next().setMarked(e)}},h(fr,cr),e(fr.prototype,{isRemoved:function(){return null===this.parentEdge},compareDirection:function(t){return this.quadrant>t.quadrant?1:this.quadrant<t.quadrant?-1:le.computeOrientation(t.p0,t.p1,this.p1)},getCoordinate:function(){return this.from.getCoordinate()},print:function(t){var e=this.getClass().getName(),n=e.lastIndexOf("."),i=e.substring(n+1);t.print("  "+i+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+this.angle)},getDirectionPt:function(){return this.p1},getAngle:function(){return this.angle},compareTo:function(t){var e=t;return this.compareDirection(e)},getFromNode:function(){return this.from},getSym:function(){return this.sym},setEdge:function(t){this.parentEdge=t},remove:function(){this.sym=null,this.parentEdge=null},getEdge:function(){return this.parentEdge},getQuadrant:function(){return this.quadrant},setSym:function(t){this.sym=t},getToNode:function(){return this.to},getEdgeDirection:function(){return this.edgeDirection},interfaces_:function(){return[s]},getClass:function(){return fr}}),fr.toEdges=function(t){for(var e=new I,n=t.iterator();n.hasNext();)e.add(n.next().parentEdge);return e},h(gr,fr),e(gr.prototype,{getNext:function(){return 2!==this.getToNode().getDegree()?null:this.getToNode().getOutEdges().getEdges().get(0)===this.getSym()?this.getToNode().getOutEdges().getEdges().get(1):(f.isTrue(this.getToNode().getOutEdges().getEdges().get(1)===this.getSym()),this.getToNode().getOutEdges().getEdges().get(0))},interfaces_:function(){return[]},getClass:function(){return gr}}),h(dr,cr),e(dr.prototype,{isRemoved:function(){return null===this.dirEdge},setDirectedEdges:function(t,e){this.dirEdge=[t,e],t.setEdge(this),e.setEdge(this),t.setSym(e),e.setSym(t),t.getFromNode().addOutEdge(t),e.getFromNode().addOutEdge(e)},getDirEdge:function(){if(Number.isInteger(arguments[0])){var t=arguments[0];return this.dirEdge[t]}if(arguments[0]instanceof mr){var e=arguments[0];return this.dirEdge[0].getFromNode()===e?this.dirEdge[0]:this.dirEdge[1].getFromNode()===e?this.dirEdge[1]:null}},remove:function(){this.dirEdge=null},getOppositeNode:function(t){return this.dirEdge[0].getFromNode()===t?this.dirEdge[0].getToNode():this.dirEdge[1].getFromNode()===t?this.dirEdge[1].getToNode():null},interfaces_:function(){return[]},getClass:function(){return dr}}),e(pr.prototype,{getNextEdge:function(t){var e=this.getIndex(t);return this.outEdges.get(this.getIndex(e+1))},getCoordinate:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},iterator:function(){return this.sortEdges(),this.outEdges.iterator()},sortEdges:function(){this.sorted||(uo.sort(this.outEdges),this.sorted=!0)},remove:function(t){this.outEdges.remove(t)},getEdges:function(){return this.sortEdges(),this.outEdges},getNextCWEdge:function(t){var e=this.getIndex(t);return this.outEdges.get(this.getIndex(e-1))},getIndex:function(){if(arguments[0]instanceof dr){var t=arguments[0];this.sortEdges();for(var e=0;e<this.outEdges.size();e++){var n=this.outEdges.get(e);if(n.getEdge()===t)return e}return-1}if(arguments[0]instanceof fr){var i=arguments[0];this.sortEdges();for(var e=0;e<this.outEdges.size();e++){var n=this.outEdges.get(e);if(n===i)return e}return-1}if(Number.isInteger(arguments[0])){var r=arguments[0],s=r%this.outEdges.size();return 0>s&&(s+=this.outEdges.size()),s}},add:function(t){this.outEdges.add(t),this.sorted=!1},getDegree:function(){return this.outEdges.size()},interfaces_:function(){return[]},getClass:function(){return pr}}),h(mr,cr),e(mr.prototype,{isRemoved:function(){return null===this.pt},addOutEdge:function(t){this.deStar.add(t)},getCoordinate:function(){return this.pt},getOutEdges:function(){return this.deStar},remove:function(){if(0===arguments.length)this.pt=null;else if(1===arguments.length){var t=arguments[0];this.deStar.remove(t)}},getIndex:function(t){return this.deStar.getIndex(t)},getDegree:function(){return this.deStar.getDegree()},interfaces_:function(){return[]},getClass:function(){return mr}}),mr.getEdgesBetween=function(t,e){var n=fr.toEdges(t.getOutEdges().getEdges()),i=new J(n),r=fr.toEdges(e.getOutEdges().getEdges());return i.retainAll(r),i},h(vr,dr),e(vr.prototype,{getLine:function(){return this.line},interfaces_:function(){return[]},getClass:function(){return vr}}),e(yr.prototype,{find:function(t){return this.nodeMap.get(t)},iterator:function(){return this.nodeMap.values().iterator()},remove:function(t){return this.nodeMap.remove(t)},values:function(){return this.nodeMap.values()},add:function(t){return this.nodeMap.put(t.getCoordinate(),t),t},interfaces_:function(){return[]},getClass:function(){return yr}}),e(xr.prototype,{findNodesOfDegree:function(t){for(var e=new I,n=this.nodeIterator();n.hasNext();){var i=n.next();i.getDegree()===t&&e.add(i)}return e},dirEdgeIterator:function(){return this.dirEdges.iterator()},edgeIterator:function(){return this.edges.iterator()},remove:function(){if(arguments[0]instanceof dr){var t=arguments[0];this.remove(t.getDirEdge(0)),this.remove(t.getDirEdge(1)),this.edges.remove(t),t.remove()}else if(arguments[0]instanceof fr){var e=arguments[0],n=e.getSym();null!==n&&n.setSym(null),e.getFromNode().remove(e),e.remove(),this.dirEdges.remove(e)}else if(arguments[0]instanceof mr){for(var i=arguments[0],r=i.getOutEdges().getEdges(),s=r.iterator();s.hasNext();){var o=s.next(),n=o.getSym();null!==n&&this.remove(n),this.dirEdges.remove(o);var a=o.getEdge();null!==a&&this.edges.remove(a)}this.nodeMap.remove(i.getCoordinate()),i.remove()}},findNode:function(t){return this.nodeMap.find(t)},getEdges:function(){return this.edges},nodeIterator:function(){return this.nodeMap.iterator()},contains:function(){if(arguments[0]instanceof dr){var t=arguments[0];return this.edges.contains(t)}if(arguments[0]instanceof fr){var e=arguments[0];return this.dirEdges.contains(e)}},add:function(){if(arguments[0]instanceof mr){var t=arguments[0];this.nodeMap.add(t)}else if(arguments[0]instanceof dr){var e=arguments[0];this.edges.add(e),this.add(e.getDirEdge(0)),this.add(e.getDirEdge(1))}else if(arguments[0]instanceof fr){var n=arguments[0];this.dirEdges.add(n)}},getNodes:function(){return this.nodeMap.values()},interfaces_:function(){return[]},getClass:function(){return xr}}),h(Er,xr),e(Er.prototype,{addEdge:function(t){if(t.isEmpty())return null;var e=H.removeRepeatedPoints(t.getCoordinates());if(e.length<=1)return null;var n=e[0],i=e[e.length-1],r=this.getNode(n),s=this.getNode(i),o=new gr(r,s,e[1],!0),a=new gr(s,r,e[e.length-2],!1),u=new vr(t);u.setDirectedEdges(o,a),this.add(u)},getNode:function(t){var e=this.findNode(t);return null===e&&(e=new mr(t),this.add(e)),e},interfaces_:function(){return[]},getClass:function(){return Er}}),e(Ir.prototype,{buildEdgeStringsForUnprocessedNodes:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){var e=t.next();e.isMarked()||(f.isTrue(2===e.getDegree()),this.buildEdgeStringsStartingAt(e),e.setMarked(!0))}},buildEdgeStringsForNonDegree2Nodes:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){var e=t.next();2!==e.getDegree()&&(this.buildEdgeStringsStartingAt(e),e.setMarked(!0))}},buildEdgeStringsForObviousStartNodes:function(){this.buildEdgeStringsForNonDegree2Nodes()},getMergedLineStrings:function(){return this.merge(),this.mergedLineStrings},buildEdgeStringsStartingAt:function(t){for(var e=t.getOutEdges().iterator();e.hasNext();){var n=e.next();n.getEdge().isMarked()||this.edgeStrings.add(this.buildEdgeStringStartingWith(n))}},merge:function(){if(null!==this.mergedLineStrings)return null;cr.setMarked(this.graph.nodeIterator(),!1),cr.setMarked(this.graph.edgeIterator(),!1),this.edgeStrings=new I,this.buildEdgeStringsForObviousStartNodes(),this.buildEdgeStringsForIsolatedLoops(),this.mergedLineStrings=new I;for(var t=this.edgeStrings.iterator();t.hasNext();){var e=t.next();this.mergedLineStrings.add(e.toLineString())}},buildEdgeStringStartingWith:function(t){var e=new hr(this.factory),n=t;do{e.add(n),n.getEdge().setMarked(!0),n=n.getNext()}while(null!==n&&n!==t);return e},add:function(){if(arguments[0]instanceof B){arguments[0].apply({interfaces_:function(){return[q]},filter:function(t){t instanceof St&&this.add(t)}})}else if(R(arguments[0],m)){var t=arguments[0];this.mergedLineStrings=null;for(var e=t.iterator();e.hasNext();){var n=e.next();this.add(n)}}else if(arguments[0]instanceof St){var i=arguments[0];null===this.factory&&(this.factory=i.getFactory()),this.graph.addEdge(i)}},buildEdgeStringsForIsolatedLoops:function(){this.buildEdgeStringsForUnprocessedNodes()},interfaces_:function(){return[]},getClass:function(){return Ir}});var Co=Object.freeze({LineMerger:Ir}),So=Object.freeze({OverlayOp:ni});h(Nr,fr),e(Nr.prototype,{getNext:function(){return this.next},isInRing:function(){return null!==this.edgeRing},setRing:function(t){this.edgeRing=t},setLabel:function(t){this.label=t},getLabel:function(){return this.label},setNext:function(t){this.next=t},getRing:function(){return this.edgeRing},interfaces_:function(){return[]},getClass:function(){return Nr}}),h(Cr,dr),e(Cr.prototype,{getLine:function(){return this.line},interfaces_:function(){return[]},getClass:function(){return Cr}}),e(Sr.prototype,{isIncluded:function(){return this._isIncluded},getCoordinates:function(){if(null===this.ringPts){for(var t=new N,e=this.deList.iterator();e.hasNext();){var n=e.next(),i=n.getEdge();Sr.addEdge(i.getLine().getCoordinates(),n.getEdgeDirection(),t)}this.ringPts=t.toCoordinateArray()}return this.ringPts},
isIncludedSet:function(){return this._isIncludedSet},isValid:function(){return this.getCoordinates(),!(this.ringPts.length<=3)&&(this.getRing(),this.ring.isValid())},build:function(t){var e=t;do{this.add(e),e.setRing(this),e=e.getNext(),f.isTrue(null!==e,"found null DE in ring"),f.isTrue(e===t||!e.isInRing(),"found DE already in ring")}while(e!==t)},isOuterHole:function(){return!!this._isHole&&!this.hasShell()},getPolygon:function(){var t=null;if(null!==this.holes){t=new Array(this.holes.size()).fill(null);for(var e=0;e<this.holes.size();e++)t[e]=this.holes.get(e)}return this.factory.createPolygon(this.ring,t)},isHole:function(){return this._isHole},isProcessed:function(){return this._isProcessed},addHole:function(){if(arguments[0]instanceof bt){var t=arguments[0];null===this.holes&&(this.holes=new I),this.holes.add(t)}else if(arguments[0]instanceof Sr){var e=arguments[0];e.setShell(this);var n=e.getRing();null===this.holes&&(this.holes=new I),this.holes.add(n)}},setIncluded:function(t){this._isIncluded=t,this._isIncludedSet=!0},getOuterHole:function(){if(this.isHole())return null;for(var t=0;t<this.deList.size();t++){var e=this.deList.get(t),n=e.getSym().getRing();if(n.isOuterHole())return n}return null},computeHole:function(){var t=this.getRing();this._isHole=le.isCCW(t.getCoordinates())},hasShell:function(){return null!==this.shell},isOuterShell:function(){return null!==this.getOuterHole()},getLineString:function(){return this.getCoordinates(),this.factory.createLineString(this.ringPts)},toString:function(){return re.toLineString(new Gt(this.getCoordinates()))},getShell:function(){return this.isHole()?this.shell:this},add:function(t){this.deList.add(t)},getRing:function(){if(null!==this.ring)return this.ring;this.getCoordinates(),this.ringPts.length<3&&A.out.println(this.ringPts);try{this.ring=this.factory.createLinearRing(this.ringPts)}catch(t){if(!(t instanceof S))throw t;A.out.println(this.ringPts)}finally{}return this.ring},updateIncluded:function(){if(this.isHole())return null;for(var t=0;t<this.deList.size();t++){var e=this.deList.get(t),n=e.getSym().getRing().getShell();if(null!==n&&n.isIncludedSet())return this.setIncluded(!n.isIncluded()),null}},setShell:function(t){this.shell=t},setProcessed:function(t){this._isProcessed=t},interfaces_:function(){return[]},getClass:function(){return Sr}}),Sr.findDirEdgesInRing=function(t){var e=t,n=new I;do{n.add(e),e=e.getNext(),f.isTrue(null!==e,"found null DE in ring"),f.isTrue(e===t||!e.isInRing(),"found DE already in ring")}while(e!==t);return n},Sr.addEdge=function(t,e,n){if(e)for(var i=0;i<t.length;i++)n.add(t[i],!1);else for(var i=t.length-1;i>=0;i--)n.add(t[i],!1)},Sr.findEdgeRingContaining=function(t,e){for(var n=t.getRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,o=null,a=e.iterator();a.hasNext();){var u=a.next(),l=u.getRing(),h=l.getEnvelopeInternal();if(!h.equals(i)&&h.contains(i)){r=H.ptNotInList(n.getCoordinates(),l.getCoordinates());var c=!1;le.isPointInRing(r,l.getCoordinates())&&(c=!0),c&&(null===s||o.contains(h))&&(s=u,o=s.getRing().getEnvelopeInternal())}}return s},e(wr.prototype,{compare:function(t,e){var n=t,i=e;return n.getRing().getEnvelope().compareTo(i.getRing().getEnvelope())},interfaces_:function(){return[a]},getClass:function(){return wr}}),Sr.EnvelopeComparator=wr,h(Lr,xr),e(Lr.prototype,{findEdgeRing:function(t){var e=new Sr(this.factory);return e.build(t),e},computeDepthParity:function(){if(0===arguments.length)for(;;){return null}else 1===arguments.length&&arguments[0]},computeNextCWEdges:function(){for(var t=this.nodeIterator();t.hasNext();){var e=t.next();Lr.computeNextCWEdges(e)}},addEdge:function(t){if(t.isEmpty())return null;var e=H.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return null;var n=e[0],i=e[e.length-1],r=this.getNode(n),s=this.getNode(i),o=new Nr(r,s,e[1],!0),a=new Nr(s,r,e[e.length-2],!1),u=new Cr(t);u.setDirectedEdges(o,a),this.add(u)},deleteCutEdges:function(){this.computeNextCWEdges(),Lr.findLabeledEdgeRings(this.dirEdges);for(var t=new I,e=this.dirEdges.iterator();e.hasNext();){var n=e.next();if(!n.isMarked()){var i=n.getSym();if(n.getLabel()===i.getLabel()){n.setMarked(!0),i.setMarked(!0);var r=n.getEdge();t.add(r.getLine())}}}return t},getEdgeRings:function(){this.computeNextCWEdges(),Lr.label(this.dirEdges,-1);var t=Lr.findLabeledEdgeRings(this.dirEdges);this.convertMaximalToMinimalEdgeRings(t);for(var e=new I,n=this.dirEdges.iterator();n.hasNext();){var i=n.next();if(!i.isMarked()&&!i.isInRing()){var r=this.findEdgeRing(i);e.add(r)}}return e},getNode:function(t){var e=this.findNode(t);return null===e&&(e=new mr(t),this.add(e)),e},convertMaximalToMinimalEdgeRings:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel(),r=Lr.findIntersectionNodes(n,i);if(null!==r)for(var s=r.iterator();s.hasNext();){var o=s.next();Lr.computeNextCCWEdges(o,i)}}},deleteDangles:function(){for(var t=this.findNodesOfDegree(1),e=new J,n=new de,i=t.iterator();i.hasNext();)n.push(i.next());for(;!n.isEmpty();){var r=n.pop();Lr.deleteAllEdges(r);for(var s=r.getOutEdges().getEdges(),i=s.iterator();i.hasNext();){var o=i.next();o.setMarked(!0);var a=o.getSym();null!==a&&a.setMarked(!0);var u=o.getEdge();e.add(u.getLine());var l=o.getToNode();1===Lr.getDegreeNonDeleted(l)&&n.push(l)}}return e},interfaces_:function(){return[]},getClass:function(){return Lr}}),Lr.findLabeledEdgeRings=function(t){for(var e=new I,n=1,i=t.iterator();i.hasNext();){var r=i.next();if(!(r.isMarked()||r.getLabel()>=0)){e.add(r);var s=Sr.findDirEdgesInRing(r);Lr.label(s,n),n++}}return e},Lr.getDegreeNonDeleted=function(t){for(var e=t.getOutEdges().getEdges(),n=0,i=e.iterator();i.hasNext();){i.next().isMarked()||n++}return n},Lr.deleteAllEdges=function(t){for(var e=t.getOutEdges().getEdges(),n=e.iterator();n.hasNext();){var i=n.next();i.setMarked(!0);var r=i.getSym();null!==r&&r.setMarked(!0)}},Lr.label=function(t,e){for(var n=t.iterator();n.hasNext();){n.next().setLabel(e)}},Lr.computeNextCWEdges=function(t){for(var e=t.getOutEdges(),n=null,i=null,r=e.getEdges().iterator();r.hasNext();){var s=r.next();if(!s.isMarked()){if(null===n&&(n=s),null!==i){var o=i.getSym();o.setNext(s)}i=s}}if(null!==i){var o=i.getSym();o.setNext(n)}},Lr.computeNextCCWEdges=function(t,e){for(var n=t.getOutEdges(),i=null,r=null,s=n.getEdges(),o=s.size()-1;o>=0;o--){var a=s.get(o),u=a.getSym(),l=null;a.getLabel()===e&&(l=a);var h=null;u.getLabel()===e&&(h=u),null===l&&null===h||(null!==h&&(r=h),null!==l&&(null!==r&&(r.setNext(l),r=null),null===i&&(i=l)))}null!==r&&(f.isTrue(null!==i),r.setNext(i))},Lr.getDegree=function(t,e){for(var n=t.getOutEdges().getEdges(),i=0,r=n.iterator();r.hasNext();){r.next().getLabel()===e&&i++}return i},Lr.findIntersectionNodes=function(t,e){var n=t,i=null;do{var r=n.getFromNode();Lr.getDegree(r,e)>1&&(null===i&&(i=new I),i.add(r)),n=n.getNext(),f.isTrue(null!==n,"found null DE in ring"),f.isTrue(n===t||!n.isInRing(),"found DE already in ring")}while(n!==t);return i},e(Rr.prototype,{getGeometry:function(){return null===this.geomFactory&&(this.geomFactory=new ne),this.polygonize(),this.extractOnlyPolygonal?this.geomFactory.buildGeometry(this.polyList):this.geomFactory.createGeometryCollection(ne.toGeometryArray(this.polyList))},getInvalidRingLines:function(){return this.polygonize(),this.invalidRingLines},findValidRings:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isValid()?e.add(r):n.add(r.getLineString())}},polygonize:function(){if(null!==this.polyList)return null;if(this.polyList=new I,null===this.graph)return null;this.dangles=this.graph.deleteDangles(),this.cutEdges=this.graph.deleteCutEdges();var t=this.graph.getEdgeRings(),e=new I;this.invalidRingLines=new I,this.isCheckingRingsValid?this.findValidRings(t,e,this.invalidRingLines):e=t,this.findShellsAndHoles(e),Rr.assignHolesToShells(this.holeList,this.shellList),uo.sort(this.shellList,new Sr.EnvelopeComparator);var n=!0;this.extractOnlyPolygonal&&(Rr.findDisjointShells(this.shellList),n=!1),this.polyList=Rr.extractPolygons(this.shellList,n)},getDangles:function(){return this.polygonize(),this.dangles},getCutEdges:function(){return this.polygonize(),this.cutEdges},getPolygons:function(){return this.polygonize(),this.polyList},add:function(){if(R(arguments[0],m))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.add(n)}else if(arguments[0]instanceof St){var i=arguments[0];this.geomFactory=i.getFactory(),null===this.graph&&(this.graph=new Lr(this.geomFactory)),this.graph.addEdge(i)}else if(arguments[0]instanceof B){var r=arguments[0];r.apply(this.lineStringAdder)}},setCheckRingsValid:function(t){this.isCheckingRingsValid=t},findShellsAndHoles:function(t){this.holeList=new I,this.shellList=new I;for(var e=t.iterator();e.hasNext();){var n=e.next();n.computeHole(),n.isHole()?this.holeList.add(n):this.shellList.add(n)}},interfaces_:function(){return[]},getClass:function(){return Rr}}),Rr.findOuterShells=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getOuterHole();null===i||i.isProcessed()||(n.setIncluded(!0),i.setProcessed(!0))}},Rr.extractPolygons=function(t,e){for(var n=new I,i=t.iterator();i.hasNext();){var r=i.next();(e||r.isIncluded())&&n.add(r.getPolygon())}return n},Rr.assignHolesToShells=function(t,e){for(var n=t.iterator();n.hasNext();){var i=n.next();Rr.assignHoleToShell(i,e)}},Rr.assignHoleToShell=function(t,e){var n=Sr.findEdgeRingContaining(t,e);null!==n&&n.addHole(t)},Rr.findDisjointShells=function(t){Rr.findOuterShells(t);var e=null;do{e=!1;for(var n=t.iterator();n.hasNext();){var i=n.next();i.isIncludedSet()||(i.updateIncluded(),i.isIncludedSet()||(e=!0))}}while(e)},e(Tr.prototype,{filter:function(t){t instanceof St&&this.p.add(t)},interfaces_:function(){return[q]},getClass:function(){return Tr}}),Rr.LineStringAdder=Tr;var wo=Object.freeze({Polygonizer:Rr});e(Pr.prototype,{createEdgeEndForNext:function(t,e,n,i){var r=n.segmentIndex+1;if(r>=t.getNumPoints()&&null===i)return null;var s=t.getCoordinate(r);null!==i&&i.segmentIndex===n.segmentIndex&&(s=i.coord);var o=new xn(t,n.coord,s,new fn(t.getLabel()));e.add(o)},createEdgeEndForPrev:function(t,e,n,i){var r=n.segmentIndex;if(0===n.dist){if(0===r)return null;r--}var s=t.getCoordinate(r);null!==i&&i.segmentIndex>=r&&(s=i.coord);var o=new fn(t.getLabel());o.flip();var a=new xn(t,n.coord,s,o);e.add(a)},computeEdgeEnds:function(){if(1===arguments.length){for(var t=arguments[0],e=new I,n=t;n.hasNext();){var i=n.next();this.computeEdgeEnds(i,e)}return e}if(2===arguments.length){var r=arguments[0],s=arguments[1],o=r.getEdgeIntersectionList();o.addEndpoints();var a=o.iterator(),u=null,l=null;if(!a.hasNext())return null;var h=a.next();do{u=l,l=h,h=null,a.hasNext()&&(h=a.next()),null!==l&&(this.createEdgeEndForPrev(r,s,l,u),this.createEdgeEndForNext(r,s,l,h))}while(null!==l)}},interfaces_:function(){return[]},getClass:function(){return Pr}}),h(br,xn),e(br.prototype,{insert:function(t){this.edgeEnds.add(t)},print:function(t){t.println("EdgeEndBundle--> Label: "+this.label);for(var e=this.iterator();e.hasNext();){e.next().print(t),t.println()}},iterator:function(){return this.edgeEnds.iterator()},getEdgeEnds:function(){return this.edgeEnds},computeLabelOn:function(t,e){for(var n=0,i=!1,r=this.iterator();r.hasNext();){var s=r.next(),o=s.getLabel().getLocation(t);o===L.BOUNDARY&&n++,o===L.INTERIOR&&(i=!0)}var o=L.NONE;i&&(o=L.INTERIOR),n>0&&(o=Jn.determineBoundary(e,n)),this.label.setLocation(t,o)},computeLabelSide:function(t,e){for(var n=this.iterator();n.hasNext();){var i=n.next();if(i.getLabel().isArea()){var r=i.getLabel().getLocation(t,e);if(r===L.INTERIOR)return this.label.setLocation(t,e,L.INTERIOR),null;r===L.EXTERIOR&&this.label.setLocation(t,e,L.EXTERIOR)}}},getLabel:function(){return this.label},computeLabelSides:function(t){this.computeLabelSide(t,hn.LEFT),this.computeLabelSide(t,hn.RIGHT)},updateIM:function(t){Qn.updateIM(this.label,t)},computeLabel:function(t){for(var e=!1,n=this.iterator();n.hasNext();){n.next().getLabel().isArea()&&(e=!0)}this.label=e?new fn(L.NONE,L.NONE,L.NONE):new fn(L.NONE);for(var i=0;2>i;i++)this.computeLabelOn(i,t),e&&this.computeLabelSides(i)},interfaces_:function(){return[]},getClass:function(){return br}}),h(Or,Tn),e(Or.prototype,{updateIM:function(t){for(var e=this.iterator();e.hasNext();){e.next().updateIM(t)}},insert:function(t){var e=this.edgeMap.get(t);null===e?(e=new br(t),this.insertEdgeEnd(t,e)):e.insert(t)},interfaces_:function(){return[]},getClass:function(){return Or}}),h(_r,vn),e(_r.prototype,{updateIMFromEdges:function(t){this.edges.updateIM(t)},computeIM:function(t){t.setAtLeastIfValid(this.label.getLocation(0),this.label.getLocation(1),0)},interfaces_:function(){return[]},getClass:function(){return _r}}),h(Mr,In),e(Mr.prototype,{createNode:function(t){return new _r(t,new Or)},interfaces_:function(){return[]},getClass:function(){return Mr}}),e(Dr.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.nodes.add(n)}},computeProperIntersectionIM:function(t,e){var n=this.arg[0].getGeometry().getDimension(),i=this.arg[1].getGeometry().getDimension(),r=t.hasProperIntersection(),s=t.hasProperInteriorIntersection();2===n&&2===i?r&&e.setAtLeast("212101212"):2===n&&1===i?(r&&e.setAtLeast("FFF0FFFF2"),s&&e.setAtLeast("1FFFFF1FF")):1===n&&2===i?(r&&e.setAtLeast("F0FFFFFF2"),s&&e.setAtLeast("1F1FFFFFF")):1===n&&1===i&&s&&e.setAtLeast("0FFFFFFFF")},labelIsolatedEdges:function(t,e){for(var n=this.arg[t].getEdgeIterator();n.hasNext();){var i=n.next();i.isIsolated()&&(this.labelIsolatedEdge(i,e,this.arg[e].getGeometry()),this.isolatedEdges.add(i))}},labelIsolatedEdge:function(t,e,n){if(n.getDimension()>0){var i=this.ptLocator.locate(t.getCoordinate(),n);t.getLabel().setAllLocations(e,i)}else t.getLabel().setAllLocations(e,L.EXTERIOR)},computeIM:function(){var t=new ce;if(t.set(L.EXTERIOR,L.EXTERIOR,2),!this.arg[0].getGeometry().getEnvelopeInternal().intersects(this.arg[1].getGeometry().getEnvelopeInternal()))return this.computeDisjointIM(t),t;this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1);var e=this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!1);this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(e,t);var n=new Pr,i=n.computeEdgeEnds(this.arg[0].getEdgeIterator());this.insertEdgeEnds(i);var r=n.computeEdgeEnds(this.arg[1].getEdgeIterator());return this.insertEdgeEnds(r),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(t),t},labelNodeEdges:function(){for(var t=this.nodes.iterator();t.hasNext();){t.next().getEdges().computeLabelling(this.arg)}},copyNodesAndLabels:function(t){for(var e=this.arg[t].getNodeIterator();e.hasNext();){var n=e.next();this.nodes.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},labelIntersectionNodes:function(t){for(var e=this.arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next(),o=this.nodes.find(s.coord);o.getLabel().isNull(t)&&(i===L.BOUNDARY?o.setLabelBoundary(t):o.setLabel(t,L.INTERIOR))}},labelIsolatedNode:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.arg[e].getGeometry());t.getLabel().setAllLocations(e,n)},computeIntersectionNodes:function(t){for(var e=this.arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next(),o=this.nodes.addNode(s.coord);i===L.BOUNDARY?o.setLabelBoundary(t):o.getLabel().isNull(t)&&o.setLabel(t,L.INTERIOR)}},labelIsolatedNodes:function(){for(var t=this.nodes.iterator();t.hasNext();){var e=t.next(),n=e.getLabel();f.isTrue(n.getGeometryCount()>0,"node with empty label found"),e.isIsolated()&&(n.isNull(0)?this.labelIsolatedNode(e,0):this.labelIsolatedNode(e,1))}},updateIM:function(t){for(var e=this.isolatedEdges.iterator();e.hasNext();){e.next().updateIM(t)}for(var n=this.nodes.iterator();n.hasNext();){var i=n.next();i.updateIM(t),i.updateIMFromEdges(t)}},computeDisjointIM:function(t){var e=this.arg[0].getGeometry();e.isEmpty()||(t.set(L.INTERIOR,L.EXTERIOR,e.getDimension()),t.set(L.BOUNDARY,L.EXTERIOR,e.getBoundaryDimension()));var n=this.arg[1].getGeometry();n.isEmpty()||(t.set(L.EXTERIOR,L.INTERIOR,n.getDimension()),t.set(L.EXTERIOR,L.BOUNDARY,n.getBoundaryDimension()))},interfaces_:function(){return[]},getClass:function(){return Dr}}),e(Ar.prototype,{isContainedInBoundary:function(t){if(t instanceof Tt)return!1;if(t instanceof Lt)return this.isPointContainedInBoundary(t);if(t instanceof St)return this.isLineStringContainedInBoundary(t);for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.isContainedInBoundary(n))return!1}return!0},isLineSegmentContainedInBoundary:function(t,e){if(t.equals(e))return this.isPointContainedInBoundary(t);if(t.x===e.x){if(t.x===this.rectEnv.getMinX()||t.x===this.rectEnv.getMaxX())return!0}else if(t.y===e.y&&(t.y===this.rectEnv.getMinY()||t.y===this.rectEnv.getMaxY()))return!0;return!1},isLineStringContainedInBoundary:function(t){for(var e=t.getCoordinateSequence(),n=new g,i=new g,r=0;r<e.size()-1;r++)if(e.getCoordinate(r,n),e.getCoordinate(r+1,i),!this.isLineSegmentContainedInBoundary(n,i))return!1;return!0},isPointContainedInBoundary:function(){if(arguments[0]instanceof Lt){var t=arguments[0];return this.isPointContainedInBoundary(t.getCoordinate())}if(arguments[0]instanceof g){var e=arguments[0];return e.x===this.rectEnv.getMinX()||e.x===this.rectEnv.getMaxX()||e.y===this.rectEnv.getMinY()||e.y===this.rectEnv.getMaxY()}},contains:function(t){return!!this.rectEnv.contains(t.getEnvelopeInternal())&&!this.isContainedInBoundary(t)},interfaces_:function(){return[]},getClass:function(){return Ar}}),Ar.contains=function(t,e){return new Ar(t).contains(e)},e(Fr.prototype,{intersects:function(t,e){var n=new C(t,e);if(!this.rectEnv.intersects(n))return!1;if(this.rectEnv.intersects(t))return!0;if(this.rectEnv.intersects(e))return!0;if(t.compareTo(e)>0){var i=t;t=e,e=i}var r=!1;return e.y>t.y&&(r=!0),r?this.li.computeIntersection(t,e,this.diagDown0,this.diagDown1):this.li.computeIntersection(t,e,this.diagUp0,this.diagUp1),!!this.li.hasIntersection()},interfaces_:function(){return[]},getClass:function(){return Fr}}),e(Gr.prototype,{applyTo:function(t){for(var e=0;e<t.getNumGeometries()&&!this._isDone;e++){var n=t.getGeometryN(e);if(n instanceof ft)this.applyTo(n);else if(this.visit(n),this.isDone())return this._isDone=!0,null}},interfaces_:function(){return[]},getClass:function(){return Gr}}),e(qr.prototype,{intersects:function(t){if(!this.rectEnv.intersects(t.getEnvelopeInternal()))return!1;var e=new Br(this.rectEnv);if(e.applyTo(t),e.intersects())return!0;var n=new zr(this.rectangle);if(n.applyTo(t),n.containsPoint())return!0;var i=new Vr(this.rectangle);return i.applyTo(t),!!i.intersects()},interfaces_:function(){return[]},getClass:function(){return qr}}),qr.intersects=function(t,e){return new qr(t).intersects(e)},h(Br,Gr),e(Br.prototype,{isDone:function(){return this._intersects===!0},visit:function(t){var e=t.getEnvelopeInternal();return this.rectEnv.intersects(e)?this.rectEnv.contains(e)?(this._intersects=!0,null):e.getMinX()>=this.rectEnv.getMinX()&&e.getMaxX()<=this.rectEnv.getMaxX()?(this._intersects=!0,null):e.getMinY()>=this.rectEnv.getMinY()&&e.getMaxY()<=this.rectEnv.getMaxY()?(this._intersects=!0,null):void 0:null},intersects:function(){return this._intersects},interfaces_:function(){return[]},getClass:function(){return Br}}),h(zr,Gr),e(zr.prototype,{isDone:function(){return this._containsPoint===!0},visit:function(t){if(!(t instanceof Tt))return null;var e=t.getEnvelopeInternal();if(!this.rectEnv.intersects(e))return null;for(var n=new g,i=0;4>i;i++)if(this.rectSeq.getCoordinate(i,n),e.contains(n)&&Rn.containsPointInPolygon(n,t))return this._containsPoint=!0,null},containsPoint:function(){return this._containsPoint},interfaces_:function(){return[]},getClass:function(){return zr}}),h(Vr,Gr),e(Vr.prototype,{intersects:function(){return this.hasIntersection},isDone:function(){return this.hasIntersection===!0},visit:function(t){var e=t.getEnvelopeInternal();if(!this.rectEnv.intersects(e))return null;var n=Vn.getLines(t);this.checkIntersectionWithLineStrings(n)},checkIntersectionWithLineStrings:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();if(this.checkIntersectionWithSegments(n),this.hasIntersection)return null}},checkIntersectionWithSegments:function(t){for(var e=t.getCoordinateSequence(),n=1;n<e.size();n++)if(e.getCoordinate(n-1,this.p0),e.getCoordinate(n,this.p1),this.rectIntersector.intersects(this.p0,this.p1))return this.hasIntersection=!0,null},interfaces_:function(){return[]},getClass:function(){return Vr}}),h(kr,$n),e(kr.prototype,{getIntersectionMatrix:function(){return this._relate.computeIM()},interfaces_:function(){return[]},getClass:function(){return kr}}),kr.covers=function(t,e){return!!t.getEnvelopeInternal().covers(e.getEnvelopeInternal())&&(!!t.isRectangle()||kr.relate(t,e).isCovers())},kr.intersects=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&(t.isRectangle()?qr.intersects(t,e):e.isRectangle()?qr.intersects(e,t):kr.relate(t,e).isIntersects())},kr.touches=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&kr.relate(t,e).isTouches(t.getDimension(),e.getDimension())},kr.within=function(t,e){return e.contains(t)},kr.coveredBy=function(t,e){return kr.covers(e,t)},kr.relate=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new kr(t,e),i=n.getIntersectionMatrix();return i}if(3===arguments.length){if("string"==typeof arguments[2]&&arguments[0]instanceof B&&arguments[1]instanceof B){var r=arguments[0],s=arguments[1],o=arguments[2];return kr.relateWithCheck(r,s).matches(o)}if(R(arguments[2],V)&&arguments[0]instanceof B&&arguments[1]instanceof B){var a=arguments[0],u=arguments[1],l=arguments[2],n=new kr(a,u,l),i=n.getIntersectionMatrix();return i}}},kr.overlaps=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&kr.relate(t,e).isOverlaps(t.getDimension(),e.getDimension())},kr.disjoint=function(t,e){return!t.intersects(e)},kr.relateWithCheck=function(t,e){return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),kr.relate(t,e)},kr.crosses=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&kr.relate(t,e).isCrosses(t.getDimension(),e.getDimension())},kr.contains=function(t,e){return!!t.getEnvelopeInternal().contains(e.getEnvelopeInternal())&&(t.isRectangle()?Ar.contains(t,e):kr.relate(t,e).isContains())};var Lo=Object.freeze({RelateOp:kr});e(Yr.prototype,{extractElements:function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);this.skipEmpty&&i.isEmpty()||e.add(i)}},combine:function(){for(var t=new I,e=this.inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this.geomFactory?this.geomFactory.createGeometryCollection(null):null:this.geomFactory.buildGeometry(t)},interfaces_:function(){return[]},getClass:function(){return Yr}}),Yr.combine=function(){if(1===arguments.length){var t=arguments[0],e=new Yr(t);return e.combine()}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=new Yr(Yr.createList(n,i));return e.combine()}if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],e=new Yr(Yr.createList(r,s,o));return e.combine()}},Yr.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Yr.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new I;return n.add(t),n.add(e),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],n=new I;return n.add(i),n.add(r),n.add(s),n}},e(Ur.prototype,{union:function(){for(var t=new Re,e=new at,n=0;n<this.pointGeom.getNumGeometries();n++){var i=this.pointGeom.getGeometryN(n),r=i.getCoordinate();t.locate(r,this.otherGeom)===L.EXTERIOR&&e.add(r)}if(0===e.size())return this.otherGeom;var s=null,o=H.toCoordinateArray(e);return s=1===o.length?this.geomFact.createPoint(o[0]):this.geomFact.createMultiPointFromCoords(o),Yr.combine(s,this.otherGeom)},interfaces_:function(){return[]},getClass:function(){return Ur}}),Ur.union=function(t,e){return new Ur(t,e).union()},e(Xr.prototype,{filter:function(t){-1!==this.sortIndex&&t.getSortIndex()!==this.sortIndex||this.comps.add(t)},interfaces_:function(){return[ht]},getClass:function(){return Xr}}),Xr.extract=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return Xr.extract(t,e,new I)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];return n.getSortIndex()===i?r.add(n):n instanceof ft&&n.apply(new Xr(i,r)),r}},e(Hr.prototype,{reduceToGeometries:function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next(),r=null;R(i,y)?r=this.unionTree(i):i instanceof B&&(r=i),e.add(r)}return e},extractByEnvelope:function(t,e,n){for(var i=new I,r=0;r<e.getNumGeometries();r++){var s=e.getGeometryN(r);s.getEnvelopeInternal().intersects(t)?i.add(s):n.add(s)}return this.geomFactory.buildGeometry(i)},unionOptimized:function(t,e){var n=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();if(!n.intersects(i)){return Yr.combine(t,e)}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(t,e,r)},union:function(){if(null===this.inputPolys)throw new IllegalStateException("union() method cannot be called twice");if(this.inputPolys.isEmpty())return null;this.geomFactory=this.inputPolys.iterator().next().getFactory();for(var t=new Ve(Hr.STRTREE_NODE_CAPACITY),e=this.inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this.inputPolys=null;var i=t.itemsTree();return this.unionTree(i)},binaryUnion:function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];if(1>=i-n){var r=Hr.getGeometry(e,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(Hr.getGeometry(e,n),Hr.getGeometry(e,n+1));var s=Math.trunc((i+n)/2),r=this.binaryUnion(e,n,s),o=this.binaryUnion(e,s,i);return this.unionSafe(r,o)}},repeatedUnion:function(t){for(var e=null,n=t.iterator();n.hasNext();){var i=n.next();e=null===e?i.copy():e.union(i)}return e},unionSafe:function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},unionActual:function(t,e){return Hr.restrictToPolygons(t.union(e))},unionTree:function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},unionUsingEnvelopeIntersection:function(t,e,n){var i=new I,r=this.extractByEnvelope(n,t,i),s=this.extractByEnvelope(n,e,i),o=this.unionActual(r,s);return i.add(o),Yr.combine(i)},bufferUnion:function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),i=n.buffer(0);return i}if(2===arguments.length){var r=arguments[0],s=arguments[1],e=r.getFactory(),n=e.createGeometryCollection([r,s]),i=n.buffer(0);return i}},interfaces_:function(){return[]},getClass:function(){return Hr}}),Hr.restrictToPolygons=function(t){if(R(t,Rt))return t;var e=sr.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(ne.toPolygonArray(e))},Hr.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Hr.union=function(t){return new Hr(t).union()},Hr.STRTREE_NODE_CAPACITY=4,e(Wr.prototype,{unionNoOpt:function(t){var e=this.geomFact.createPoint();return ri.overlayOp(t,e,ni.UNION)},unionWithNull:function(t,e){return null===t&&null===e?null:null===e?t:null===t?e:t.union(e)},extract:function(){if(R(arguments[0],m))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.extract(n)}else if(arguments[0]instanceof B){var i=arguments[0];null===this.geomFact&&(this.geomFact=i.getFactory()),Xr.extract(i,B.SORTINDEX_POLYGON,this.polygons),Xr.extract(i,B.SORTINDEX_LINESTRING,this.lines),Xr.extract(i,B.SORTINDEX_POINT,this.points)}},union:function t(){if(null===this.geomFact)return null;var e=null;if(this.points.size()>0){var n=this.geomFact.buildGeometry(this.points);e=this.unionNoOpt(n)}var i=null;if(this.lines.size()>0){var r=this.geomFact.buildGeometry(this.lines);i=this.unionNoOpt(r)}var s=null;this.polygons.size()>0&&(s=Hr.union(this.polygons));var o=this.unionWithNull(i,s),t=null;return t=null===e?o:null===o?e:Ur.union(e,o),null===t?this.geomFact.createGeometryCollection():t},interfaces_:function(){return[]},getClass:function(){return Wr}}),Wr.union=function(){if(1===arguments.length){if(R(arguments[0],m)){var t=arguments[0],e=new Wr(t);return e.union()}if(arguments[0]instanceof B){var n=arguments[0],e=new Wr(n);return e.union()}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],e=new Wr(i,r);return e.union()}};var Ro=Object.freeze({UnaryUnionOp:Wr});e(jr.prototype,{visitInteriorRing:function(t,e){var n=t.getCoordinates(),i=n[0],r=jr.findDifferentPoint(n,i),s=e.findEdgeInSameDirection(i,r),o=e.findEdgeEnd(s),a=null;o.getLabel().getLocation(0,hn.RIGHT)===L.INTERIOR?a=o:o.getSym().getLabel().getLocation(0,hn.RIGHT)===L.INTERIOR&&(a=o.getSym()),f.isTrue(null!==a,"unable to find dirEdge with Interior on RHS"),this.visitLinkedDirectedEdges(a)},visitShellInteriors:function(t,e){if(t instanceof Tt){var n=t;this.visitInteriorRing(n.getExteriorRing(),e)}if(t instanceof Ot)for(var i=t,r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.visitInteriorRing(n.getExteriorRing(),e)}},getCoordinate:function(){return this.disconnectedRingcoord},setInteriorEdgesInResult:function(t){for(var e=t.getEdgeEnds().iterator();e.hasNext();){var n=e.next();n.getLabel().getLocation(0,hn.RIGHT)===L.INTERIOR&&n.setInResult(!0)}},visitLinkedDirectedEdges:function(t){var e=t,n=t;do{f.isTrue(null!==n,"found null Directed Edge"),n.setVisited(!0),n=n.getNext()}while(n!==e)},buildEdgeRings:function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&null===i.getEdgeRing()){var r=new pn(i,this.geometryFactory);r.linkDirectedEdgesForMinimalEdgeRings();var s=r.buildMinimalRings();e.addAll(s)}}return e},hasUnvisitedShellEdge:function(t){for(var e=0;e<t.size();e++){var n=t.get(e);if(!n.isHole()){var i=n.getEdges(),r=i.get(0);if(r.getLabel().getLocation(0,hn.RIGHT)===L.INTERIOR)for(var s=0;s<i.size();s++)if(r=i.get(s),!r.isVisited())return this.disconnectedRingcoord=r.getCoordinate(),!0}}return!1},isInteriorsConnected:function(){var t=new I;this.geomGraph.computeSplitEdges(t);var e=new Nn(new bn);e.addEdges(t),this.setInteriorEdgesInResult(e),e.linkResultDirectedEdges();var n=this.buildEdgeRings(e.getEdgeEnds());return this.visitShellInteriors(this.geomGraph.getGeometry(),e),!this.hasUnvisitedShellEdge(n)},interfaces_:function(){return[]},getClass:function(){return jr}}),jr.findDifferentPoint=function(t,e){for(var n=0;n<t.length;n++)if(!t[n].equals(e))return t[n];return null},e(Kr.prototype,{hasChildren:function(){for(var t=0;2>t;t++)if(null!==this.subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this.items);for(var e=0;2>e;e++)null!==this.subnode[e]&&this.subnode[e].addAllItems(t);return t},size:function(){for(var t=0,e=0;2>e;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+this.items.size()},addAllItemsFromOverlapping:function(t,e){return null===t||this.isSearchMatch(t)?(e.addAll(this.items),null!==this.subnode[0]&&this.subnode[0].addAllItemsFromOverlapping(t,e),void(null!==this.subnode[1]&&this.subnode[1].addAllItemsFromOverlapping(t,e))):null},hasItems:function(){return!this.items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1
;for(var n=!1,i=0;2>i;i++)if(null!==this.subnode[i]&&(n=this.subnode[i].remove(t,e))){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}return n?n:n=this.items.remove(e)},getItems:function(){return this.items},depth:function(){for(var t=0,e=0;2>e;e++)if(null!==this.subnode[e]){var n=this.subnode[e].depth();n>t&&(t=n)}return t+1},nodeSize:function(){for(var t=0,e=0;2>e;e++)null!==this.subnode[e]&&(t+=this.subnode[e].nodeSize());return t+1},add:function(t){this.items.add(t)},interfaces_:function(){return[]},getClass:function(){return Kr}}),Kr.getSubnodeIndex=function(t,e){var n=-1;return t.min>=e&&(n=1),t.max<=e&&(n=0),n},e(Zr.prototype,{expandToInclude:function(t){t.max>this.max&&(this.max=t.max),t.min<this.min&&(this.min=t.min)},getWidth:function(){return this.max-this.min},overlaps:function(){if(1===arguments.length){var t=arguments[0];return this.overlaps(t.min,t.max)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!(this.min>n||this.max<e)}},getMin:function(){return this.min},toString:function(){return"["+this.min+", "+this.max+"]"},contains:function(){if(1===arguments.length){if(arguments[0]instanceof Zr){var t=arguments[0];return this.contains(t.min,t.max)}if("number"==typeof arguments[0]){var e=arguments[0];return e>=this.min&&e<=this.max}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return n>=this.min&&i<=this.max}},init:function(t,e){this.min=t,this.max=e,t>e&&(this.min=e,this.max=t)},getMax:function(){return this.max},interfaces_:function(){return[]},getClass:function(){return Zr}}),e(Qr.prototype,{getInterval:function(){return this.interval},getLevel:function(){return this.level},computeKey:function(t){for(this.level=Qr.computeLevel(t),this.interval=new Zr,this.computeInterval(this.level,t);!this.interval.contains(t);)this.level+=1,this.computeInterval(this.level,t)},computeInterval:function(t,e){var n=Ni.powerOf2(t);this.pt=Math.floor(e.getMin()/n)*n,this.interval.init(this.pt,this.pt+n)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Qr}}),Qr.computeLevel=function(t){var e=t.getWidth();return Ni.exponent(e)+1},h(Jr,Kr),e(Jr.prototype,{getInterval:function(){return this.interval},find:function(t){var e=Kr.getSubnodeIndex(t,this.centre);if(-1===e)return this;if(null!==this.subnode[e]){return this.subnode[e].find(t)}return this},insert:function(t){f.isTrue(null===this.interval||this.interval.contains(t.interval));var e=Kr.getSubnodeIndex(t.interval,this.centre);if(t.level===this.level-1)this.subnode[e]=t;else{var n=this.createSubnode(e);n.insert(t),this.subnode[e]=n}},isSearchMatch:function(t){return t.overlaps(this.interval)},getSubnode:function(t){return null===this.subnode[t]&&(this.subnode[t]=this.createSubnode(t)),this.subnode[t]},getNode:function(t){var e=Kr.getSubnodeIndex(t,this.centre);if(-1!==e){return this.getSubnode(e).getNode(t)}return this},createSubnode:function(t){var e=0,n=0;switch(t){case 0:e=this.interval.getMin(),n=this.centre;break;case 1:e=this.centre,n=this.interval.getMax()}return new Jr(new Zr(e,n),this.level-1)},interfaces_:function(){return[]},getClass:function(){return Jr}}),Jr.createNode=function(t){var e=new Qr(t);return new Jr(e.getInterval(),e.getLevel())},Jr.createExpanded=function(t,e){var n=new Zr(e);null!==t&&n.expandToInclude(t.interval);var i=Jr.createNode(n);return null!==t&&i.insert(t),i},h($r,Kr),e($r.prototype,{insert:function(t,e){var n=Kr.getSubnodeIndex(t,$r.origin);if(-1===n)return this.add(e),null;var i=this.subnode[n];if(null===i||!i.getInterval().contains(t)){var r=Jr.createExpanded(i,t);this.subnode[n]=r}this.insertContained(this.subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){f.isTrue(t.getInterval().contains(e));var i=Li.isZeroWidth(e.getMin(),e.getMax()),r=null;r=i?t.find(e):t.getNode(e),r.add(n)},interfaces_:function(){return[]},getClass:function(){return $r}}),$r.origin=0,e(ts.prototype,{size:function(){return null!==this.root?this.root.size():0},insert:function(t,e){this.collectStats(t);var n=ts.ensureExtent(t,this.minExtent);this.root.insert(n,e)},query:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];return this.query(new Zr(t,t))}if(arguments[0]instanceof Zr){var e=arguments[0],n=new I;return this.query(e,n),n}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.root.addAllItemsFromOverlapping(i,r)}},iterator:function(){var t=new I;return this.root.addAllItems(t),t.iterator()},remove:function(t,e){var n=ts.ensureExtent(t,this.minExtent);return this.root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this.minExtent&&e>0&&(this.minExtent=e)},depth:function(){return null!==this.root?this.root.depth():0},nodeSize:function(){return null!==this.root?this.root.nodeSize():0},interfaces_:function(){return[]},getClass:function(){return ts}}),ts.ensureExtent=function(t,e){var n=t.getMin(),i=t.getMax();return n!==i?t:(n===i&&(n-=e/2,i=n+e/2),new Zr(n,i))},e(es.prototype,{isInside:function(t){},interfaces_:function(){return[]},getClass:function(){return es}}),e(ns.prototype,{testLineSegment:function(t,e){var n=null,i=null,r=null,s=null,o=e.p0,a=e.p1;n=o.x-t.x,i=o.y-t.y,r=a.x-t.x,s=a.y-t.y,(i>0&&0>=s||s>0&&0>=i)&&ae.signOfDet2x2(n,i,r,s)/(s-i)>0&&this.crossings++},buildIndex:function(){this.tree=new ts;for(var t=H.removeRepeatedPoints(this.ring.getCoordinates()),e=Je.getChains(t),n=0;n<e.size();n++){var i=e.get(n),r=i.getEnvelope();this.interval.min=r.getMinY(),this.interval.max=r.getMaxY(),this.tree.insert(this.interval,i)}},testMonotoneChain:function(t,e,n){n.select(t,e)},isInside:function(t){this.crossings=0;var e=new C(r.NEGATIVE_INFINITY,r.POSITIVE_INFINITY,t.y,t.y);this.interval.min=t.y,this.interval.max=t.y;for(var n=this.tree.query(this.interval),i=new is(this,t),s=n.iterator();s.hasNext();){var o=s.next();this.testMonotoneChain(e,i,o)}return this.crossings%2==1},interfaces_:function(){return[es]},getClass:function(){return ns}}),h(is,$i),e(is.prototype,{select:function(){if(1!==arguments.length)return $i.prototype.select.apply(this,arguments);var t=arguments[0];this.mcp.testLineSegment(this.p,t)},interfaces_:function(){return[]},getClass:function(){return is}}),ns.MCSelecter=is,e(rs.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.nodes.add(n)}},getNodeIterator:function(){return this.nodes.iterator()},copyNodesAndLabels:function(t,e){for(var n=t.getNodeIterator();n.hasNext();){var i=n.next();this.nodes.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},build:function(t){this.computeIntersectionNodes(t,0),this.copyNodesAndLabels(t,0);var e=new Pr,n=e.computeEdgeEnds(t.getEdgeIterator());this.insertEdgeEnds(n)},computeIntersectionNodes:function(t,e){for(var n=t.getEdgeIterator();n.hasNext();)for(var i=n.next(),r=i.getLabel().getLocation(e),s=i.getEdgeIntersectionList().iterator();s.hasNext();){var o=s.next(),a=this.nodes.addNode(o.coord);r===L.BOUNDARY?a.setLabelBoundary(e):a.getLabel().isNull(e)&&a.setLabel(e,L.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return rs}}),e(ss.prototype,{isNodeEdgeAreaLabelsConsistent:function(){for(var t=this.nodeGraph.getNodeIterator();t.hasNext();){var e=t.next();if(!e.getEdges().isAreaLabelsConsistent(this.geomGraph))return this.invalidPoint=e.getCoordinate().copy(),!1}return!0},getInvalidPoint:function(){return this.invalidPoint},hasDuplicateRings:function(){for(var t=this.nodeGraph.getNodeIterator();t.hasNext();)for(var e=t.next(),n=e.getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdgeEnds().size()>1)return this.invalidPoint=i.getEdge().getCoordinate(0),!0}return!1},isNodeConsistentArea:function(){var t=this.geomGraph.computeSelfNodes(this.li,!0,!0);return t.hasProperIntersection()?(this.invalidPoint=t.getProperIntersectionPoint(),!1):(this.nodeGraph.build(this.geomGraph),this.isNodeEdgeAreaLabelsConsistent())},interfaces_:function(){return[]},getClass:function(){return ss}}),e(os.prototype,{buildIndex:function(){this.index=new Ve;for(var t=0;t<this.rings.size();t++){var e=this.rings.get(t),n=e.getEnvelopeInternal();this.index.insert(n,e)}},getNestedPoint:function(){return this.nestedPt},isNonNested:function(){this.buildIndex();for(var t=0;t<this.rings.size();t++)for(var e=this.rings.get(t),n=e.getCoordinates(),i=this.index.query(e.getEnvelopeInternal()),r=0;r<i.size();r++){var s=i.get(r),o=s.getCoordinates();if(e!==s&&e.getEnvelopeInternal().intersects(s.getEnvelopeInternal())){var a=us.findPtNotNode(n,s,this.graph);if(null!==a){var u=le.isPointInRing(a,o);if(u)return this.nestedPt=a,!1}}}return!0},add:function(t){this.rings.add(t),this.totalEnv.expandToInclude(t.getEnvelopeInternal())},interfaces_:function(){return[]},getClass:function(){return os}}),e(as.prototype,{getErrorType:function(){return this.errorType},getMessage:function(){return as.errMsg[this.errorType]},getCoordinate:function(){return this.pt},toString:function(){var t="";return null!==this.pt&&(t=" at or near point "+this.pt),this.getMessage()+t},interfaces_:function(){return[]},getClass:function(){return as}}),as.ERROR=0,as.REPEATED_POINT=1,as.HOLE_OUTSIDE_SHELL=2,as.NESTED_HOLES=3,as.DISCONNECTED_INTERIOR=4,as.SELF_INTERSECTION=5,as.RING_SELF_INTERSECTION=6,as.NESTED_SHELLS=7,as.DUPLICATE_RINGS=8,as.TOO_FEW_POINTS=9,as.INVALID_COORDINATE=10,as.RING_NOT_CLOSED=11,as.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"],e(us.prototype,{checkInvalidCoordinates:function(){if(arguments[0]instanceof Array){for(var t=arguments[0],e=0;e<t.length;e++)if(!us.isValid(t[e]))return this.validErr=new as(as.INVALID_COORDINATE,t[e]),null}else if(arguments[0]instanceof Tt){var n=arguments[0];if(this.checkInvalidCoordinates(n.getExteriorRing().getCoordinates()),null!==this.validErr)return null;for(var e=0;e<n.getNumInteriorRing();e++)if(this.checkInvalidCoordinates(n.getInteriorRingN(e).getCoordinates()),null!==this.validErr)return null}},checkHolesNotNested:function(t,e){for(var n=new os(e),i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);n.add(r)}n.isNonNested()||(this.validErr=new as(as.NESTED_HOLES,n.getNestedPoint()))},checkConsistentArea:function(t){var e=new ss(t);return e.isNodeConsistentArea()?void(e.hasDuplicateRings()&&(this.validErr=new as(as.DUPLICATE_RINGS,e.getInvalidPoint()))):(this.validErr=new as(as.SELF_INTERSECTION,e.getInvalidPoint()),null)},isValid:function(){return this.checkValid(this.parentGeometry),null===this.validErr},checkShellInsideHole:function(t,e,n){var i=t.getCoordinates(),r=e.getCoordinates(),s=us.findPtNotNode(i,e,n);if(null!==s){if(!le.isPointInRing(s,r))return s}var o=us.findPtNotNode(r,t,n);if(null!==o){return le.isPointInRing(o,i)?o:null}return f.shouldNeverReachHere("points in shell and hole appear to be equal"),null},checkNoSelfIntersectingRings:function(t){for(var e=t.getEdgeIterator();e.hasNext();){var n=e.next();if(this.checkNoSelfIntersectingRing(n.getEdgeIntersectionList()),null!==this.validErr)return null}},checkConnectedInteriors:function(t){var e=new jr(t);e.isInteriorsConnected()||(this.validErr=new as(as.DISCONNECTED_INTERIOR,e.getCoordinate()))},checkNoSelfIntersectingRing:function(t){for(var e=new at,n=!0,i=t.iterator();i.hasNext();){var r=i.next();if(n)n=!1;else{if(e.contains(r.coord))return this.validErr=new as(as.RING_SELF_INTERSECTION,r.coord),null;e.add(r.coord)}}},checkHolesInShell:function(t,e){for(var n=t.getExteriorRing(),i=new ns(n),r=0;r<t.getNumInteriorRing();r++){var s=t.getInteriorRingN(r),o=us.findPtNotNode(s.getCoordinates(),n,e);if(null===o)return null;if(!i.isInside(o))return this.validErr=new as(as.HOLE_OUTSIDE_SHELL,o),null}},checkTooFewPoints:function(t){return t.hasTooFewPoints()?(this.validErr=new as(as.TOO_FEW_POINTS,t.getInvalidPoint()),null):void 0},getValidationError:function(){return this.checkValid(this.parentGeometry),this.validErr},checkValid:function(){if(arguments[0]instanceof Lt){var t=arguments[0];this.checkInvalidCoordinates(t.getCoordinates())}else if(arguments[0]instanceof Pt){var e=arguments[0];this.checkInvalidCoordinates(e.getCoordinates())}else if(arguments[0]instanceof bt){var n=arguments[0];if(this.checkInvalidCoordinates(n.getCoordinates()),null!==this.validErr)return null;if(this.checkClosedRing(n),null!==this.validErr)return null;var i=new Jn(0,n);if(this.checkTooFewPoints(i),null!==this.validErr)return null;var r=new oe;i.computeSelfNodes(r,!0,!0),this.checkNoSelfIntersectingRings(i)}else if(arguments[0]instanceof St){var s=arguments[0];if(this.checkInvalidCoordinates(s.getCoordinates()),null!==this.validErr)return null;var i=new Jn(0,s);this.checkTooFewPoints(i)}else if(arguments[0]instanceof Tt){var o=arguments[0];if(this.checkInvalidCoordinates(o),null!==this.validErr)return null;if(this.checkClosedRings(o),null!==this.validErr)return null;var i=new Jn(0,o);if(this.checkTooFewPoints(i),null!==this.validErr)return null;if(this.checkConsistentArea(i),null!==this.validErr)return null;if(!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this.validErr))return null;if(this.checkHolesInShell(o,i),null!==this.validErr)return null;if(this.checkHolesNotNested(o,i),null!==this.validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof Ot){for(var a=arguments[0],u=0;u<a.getNumGeometries();u++){var l=a.getGeometryN(u);if(this.checkInvalidCoordinates(l),null!==this.validErr)return null;if(this.checkClosedRings(l),null!==this.validErr)return null}var i=new Jn(0,a);if(this.checkTooFewPoints(i),null!==this.validErr)return null;if(this.checkConsistentArea(i),null!==this.validErr)return null;if(!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this.validErr))return null;for(var u=0;u<a.getNumGeometries();u++){var l=a.getGeometryN(u);if(this.checkHolesInShell(l,i),null!==this.validErr)return null}for(var u=0;u<a.getNumGeometries();u++){var l=a.getGeometryN(u);if(this.checkHolesNotNested(l,i),null!==this.validErr)return null}if(this.checkShellsNotNested(a,i),null!==this.validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof ft)for(var h=arguments[0],u=0;u<h.getNumGeometries();u++){var c=h.getGeometryN(u);if(this.checkValid(c),null!==this.validErr)return null}else if(arguments[0]instanceof B){var f=arguments[0];if(this.validErr=null,f.isEmpty())return null;if(f instanceof Lt)this.checkValid(f);else if(f instanceof Pt)this.checkValid(f);else if(f instanceof bt)this.checkValid(f);else if(f instanceof St)this.checkValid(f);else if(f instanceof Tt)this.checkValid(f);else if(f instanceof Ot)this.checkValid(f);else{if(!(f instanceof ft))throw new UnsupportedOperationException(f.getClass().getName());this.checkValid(f)}}},setSelfTouchingRingFormingHoleValid:function(t){this.isSelfTouchingRingFormingHoleValid=t},checkShellNotNested:function(t,e,n){var i=t.getCoordinates(),r=e.getExteriorRing(),s=r.getCoordinates(),o=us.findPtNotNode(i,r,n);if(null===o)return null;if(!le.isPointInRing(o,s))return null;if(e.getNumInteriorRing()<=0)return this.validErr=new as(as.NESTED_SHELLS,o),null;for(var a=null,u=0;u<e.getNumInteriorRing();u++){var l=e.getInteriorRingN(u);if(null===(a=this.checkShellInsideHole(t,l,n)))return null}this.validErr=new as(as.NESTED_SHELLS,a)},checkClosedRings:function(t){if(this.checkClosedRing(t.getExteriorRing()),null!==this.validErr)return null;for(var e=0;e<t.getNumInteriorRing();e++)if(this.checkClosedRing(t.getInteriorRingN(e)),null!==this.validErr)return null},checkClosedRing:function(t){if(!t.isClosed()){var e=null;t.getNumPoints()>=1&&(e=t.getCoordinateN(0)),this.validErr=new as(as.RING_NOT_CLOSED,e)}},checkShellsNotNested:function(t,e){for(var n=0;n<t.getNumGeometries();n++)for(var i=t.getGeometryN(n),r=i.getExteriorRing(),s=0;s<t.getNumGeometries();s++)if(n!==s){var o=t.getGeometryN(s);if(this.checkShellNotNested(r,o,e),null!==this.validErr)return null}},interfaces_:function(){return[]},getClass:function(){return us}}),us.findPtNotNode=function(t,e,n){for(var i=n.findEdge(e),r=i.getEdgeIntersectionList(),s=0;s<t.length;s++){var o=t[s];if(!r.isIntersection(o))return o}return null},us.isValid=function(){if(arguments[0]instanceof B){return new us(arguments[0]).isValid()}if(arguments[0]instanceof g){var t=arguments[0];return!r.isNaN(t.x)&&(!r.isInfinite(t.x)&&(!r.isNaN(t.y)&&!r.isInfinite(t.y)))}};var To=Object.freeze({IsValidOp:us}),Po=Object.freeze({BoundaryOp:dt,IsSimpleOp:Fi,buffer:Io,distance:No,linemerge:Co,overlay:So,polygonize:wo,relate:Lo,union:Ro,valid:To});h(ls,_t.CoordinateOperation),e(ls.prototype,{editCoordinates:function(t,e){if(0===t.length)return null;for(var n=new Array(t.length).fill(null),i=0;i<t.length;i++){var r=new g(t[i]);this.targetPM.makePrecise(r),n[i]=r}var s=new N(n,!1),o=s.toCoordinateArray(),a=0;e instanceof St&&(a=2),e instanceof bt&&(a=4);var u=n;return this.removeCollapsed&&(u=null),o.length<a?u:o},interfaces_:function(){return[]},getClass:function(){return ls}}),e(hs.prototype,{fixPolygonalTopology:function(t){var e=t;this.changePrecisionModel||(e=this.changePM(t,this.targetPM));var n=e.buffer(0),i=n;return this.changePrecisionModel||(i=t.getFactory().createGeometry(n)),i},reducePointwise:function(t){var e=null;if(this.changePrecisionModel){e=new _t(this.createFactory(t.getFactory(),this.targetPM))}else e=new _t;var n=this.removeCollapsed;return t.getDimension()>=2&&(n=!0),e.edit(t,new ls(this.targetPM,n))},changePM:function(t,e){return this.createEditor(t.getFactory(),e).edit(t,new _t.NoOpGeometryOperation)},setRemoveCollapsedComponents:function(t){this.removeCollapsed=t},createFactory:function(t,e){return new ne(e,t.getSRID(),t.getCoordinateSequenceFactory())},setChangePrecisionModel:function(t){this.changePrecisionModel=t},reduce:function(t){var e=this.reducePointwise(t);return this.isPointwise?e:R(e,Rt)?e.isValid()?e:this.fixPolygonalTopology(e):e},setPointwise:function(t){this.isPointwise=t},createEditor:function(t,e){return t.getPrecisionModel()===e?new _t:new _t(this.createFactory(t,e))},interfaces_:function(){return[]},getClass:function(){return hs}}),hs.reduce=function(t,e){return new hs(e).reduce(t)},hs.reducePointwise=function(t,e){var n=new hs(e);return n.setPointwise(!0),n.reduce(t)};var bo=Object.freeze({GeometryPrecisionReducer:hs});e(cs.prototype,{simplifySection:function(t,e){if(t+1===e)return null;this.seg.p0=this.pts[t],this.seg.p1=this.pts[e];for(var n=-1,i=t,r=t+1;e>r;r++){var s=this.seg.distance(this.pts[r]);s>n&&(n=s,i=r)}if(n<=this.distanceTolerance)for(var r=t+1;e>r;r++)this.usePt[r]=!1;else this.simplifySection(t,i),this.simplifySection(i,e)},setDistanceTolerance:function(t){this.distanceTolerance=t},simplify:function(){this.usePt=new Array(this.pts.length).fill(null);for(var t=0;t<this.pts.length;t++)this.usePt[t]=!0;this.simplifySection(0,this.pts.length-1);for(var e=new N,t=0;t<this.pts.length;t++)this.usePt[t]&&e.add(new g(this.pts[t]));return e.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return cs}}),cs.simplify=function(t,e){var n=new cs(t);return n.setDistanceTolerance(e),n.simplify()},e(fs.prototype,{setEnsureValid:function(t){this.isEnsureValidTopology=t},getResultGeometry:function(){return this.inputGeom.isEmpty()?this.inputGeom.copy():new gs(this.isEnsureValidTopology,this.distanceTolerance).transform(this.inputGeom)},setDistanceTolerance:function(t){if(0>t)throw new i("Tolerance must be non-negative");this.distanceTolerance=t},interfaces_:function(){return[]},getClass:function(){return fs}}),fs.simplify=function(t,e){var n=new fs(t);return n.setDistanceTolerance(e),n.getResultGeometry()},h(gs,ye),e(gs.prototype,{transformPolygon:function(t,e){if(t.isEmpty())return null;var n=ye.prototype.transformPolygon.call(this,t,e);return e instanceof Ot?n:this.createValidArea(n)},createValidArea:function(t){return this.isEnsureValidTopology?t.buffer(0):t},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=null;return i=0===n.length?new Array(0).fill(null):cs.simplify(n,this.distanceTolerance),this.factory.getCoordinateSequenceFactory().create(i)},transformMultiPolygon:function(t,e){var n=ye.prototype.transformMultiPolygon.call(this,t,e);return this.createValidArea(n)},transformLinearRing:function(t,e){var n=e instanceof Tt,i=ye.prototype.transformLinearRing.call(this,t,e);return!n||i instanceof bt?i:null},interfaces_:function(){return[]},getClass:function(){return gs}}),fs.DPTransformer=gs,h(ds,he),e(ds.prototype,{getIndex:function(){return this.index},getParent:function(){return this.parent},interfaces_:function(){return[]},getClass:function(){return ds}}),e(ps.prototype,{addToResult:function(t){this.resultSegs.add(t)},asLineString:function(){return this.parentLine.getFactory().createLineString(ps.extractCoordinates(this.resultSegs))},getResultSize:function(){var t=this.resultSegs.size();return 0===t?0:t+1},getParent:function(){return this.parentLine},getSegment:function(t){return this.segs[t]},getParentCoordinates:function(){return this.parentLine.getCoordinates()},getMinimumSize:function(){return this.minimumSize},asLinearRing:function(){return this.parentLine.getFactory().createLinearRing(ps.extractCoordinates(this.resultSegs))},getSegments:function(){return this.segs},init:function(){var t=this.parentLine.getCoordinates();this.segs=new Array(t.length-1).fill(null);for(var e=0;e<t.length-1;e++){var n=new ds(t[e],t[e+1],this.parentLine,e);this.segs[e]=n}},getResultCoordinates:function(){return ps.extractCoordinates(this.resultSegs)},interfaces_:function(){return[]},getClass:function(){return ps}}),ps.extractCoordinates=function(t){for(var e=new Array(t.size()+1).fill(null),n=null,i=0;i<t.size();i++)n=t.get(i),e[i]=n.p0;return e[e.length-1]=n.p1,e},e(ms.prototype,{remove:function(t){this.index.remove(new C(t.p0,t.p1),t)},add:function(){if(arguments[0]instanceof ps)for(var t=arguments[0],e=t.getSegments(),n=0;n<e.length;n++){var i=e[n];this.add(i)}else if(arguments[0]instanceof he){var r=arguments[0];this.index.insert(new C(r.p0,r.p1),r)}},query:function(t){var e=new C(t.p0,t.p1),n=new vs(t);return this.index.query(e,n),n.getItems()},interfaces_:function(){return[]},getClass:function(){return ms}}),e(vs.prototype,{visitItem:function(t){var e=t;C.intersects(e.p0,e.p1,this.querySeg.p0,this.querySeg.p1)&&this.items.add(t)},getItems:function(){return this.items},interfaces_:function(){return[De]},getClass:function(){return vs}}),e(ys.prototype,{flatten:function(t,e){var n=this.linePts[t],i=this.linePts[e],r=new he(n,i);return this.remove(this.line,t,e),this.outputIndex.add(r),r},hasBadIntersection:function(t,e,n){return!!this.hasBadOutputIntersection(n)||!!this.hasBadInputIntersection(t,e,n)},setDistanceTolerance:function(t){this.distanceTolerance=t},simplifySection:function(t,e,n){n+=1;var i=new Array(2).fill(null);if(t+1===e){var r=this.line.getSegment(t);return this.line.addToResult(r),null}var s=!0;if(this.line.getResultSize()<this.line.getMinimumSize()){n+1<this.line.getMinimumSize()&&(s=!1)}var o=new Array(1).fill(null),a=this.findFurthestPoint(this.linePts,t,e,o);o[0]>this.distanceTolerance&&(s=!1);var u=new he;if(u.p0=this.linePts[t],u.p1=this.linePts[e],i[0]=t,i[1]=e,this.hasBadIntersection(this.line,i,u)&&(s=!1),s){var r=this.flatten(t,e);return this.line.addToResult(r),null}this.simplifySection(t,a,n),this.simplifySection(a,e,n)},hasBadOutputIntersection:function(t){for(var e=this.outputIndex.query(t),n=e.iterator();n.hasNext();){var i=n.next();if(this.hasInteriorIntersection(i,t))return!0}return!1},findFurthestPoint:function(t,e,n,i){var r=new he;r.p0=t[e],r.p1=t[n];for(var s=-1,o=e,a=e+1;n>a;a++){var u=t[a],l=r.distance(u);l>s&&(s=l,o=a)}return i[0]=s,o},simplify:function(t){this.line=t,this.linePts=t.getParentCoordinates(),this.simplifySection(0,this.linePts.length-1,0)},remove:function(t,e,n){for(var i=e;n>i;i++){var r=t.getSegment(i);this.inputIndex.remove(r)}},hasInteriorIntersection:function(t,e){return this.li.computeIntersection(t.p0,t.p1,e.p0,e.p1),this.li.isInteriorIntersection()},hasBadInputIntersection:function(t,e,n){for(var i=this.inputIndex.query(n),r=i.iterator();r.hasNext();){var s=r.next();if(this.hasInteriorIntersection(s,n)){if(ys.isInLineSection(t,e,s))continue;return!0}}return!1},interfaces_:function(){return[]},getClass:function(){return ys}}),ys.isInLineSection=function(t,e,n){if(n.getParent()!==t.getParent())return!1;var i=n.getIndex();return i>=e[0]&&i<e[1]},e(xs.prototype,{setDistanceTolerance:function(t){this.distanceTolerance=t},simplify:function(t){for(var e=t.iterator();e.hasNext();)this.inputIndex.add(e.next());for(var e=t.iterator();e.hasNext();){var n=new ys(this.inputIndex,this.outputIndex);n.setDistanceTolerance(this.distanceTolerance),n.simplify(e.next())}},interfaces_:function(){return[]},getClass:function(){return xs}}),e(Es.prototype,{getResultGeometry:function(){return this.inputGeom.isEmpty()?this.inputGeom.copy():(this.linestringMap=new $t,this.inputGeom.apply(new Ns(this)),this.lineSimplifier.simplify(this.linestringMap.values()),new Is(this.linestringMap).transform(this.inputGeom))},setDistanceTolerance:function(t){if(0>t)throw new i("Tolerance must be non-negative");this.lineSimplifier.setDistanceTolerance(t)},interfaces_:function(){return[]},getClass:function(){return Es}}),Es.simplify=function(t,e){var n=new Es(t);return n.setDistanceTolerance(e),n.getResultGeometry()},h(Is,ye),e(Is.prototype,{transformCoordinates:function(t,e){if(0===t.size())return null;if(e instanceof St){var n=this.linestringMap.get(e);return this.createCoordinateSequence(n.getResultCoordinates())}return ye.prototype.transformCoordinates.call(this,t,e)},interfaces_:function(){return[]},getClass:function(){return Is}}),e(Ns.prototype,{filter:function(t){if(t instanceof St){var e=t;if(e.isEmpty())return null;var n=e.isClosed()?4:2,i=new ps(e,n);this.tps.linestringMap.put(e,i)}},interfaces_:function(){return[q]},getClass:function(){return Ns}}),Es.LineStringTransformer=Is,Es.LineStringMapBuilderFilter=Ns;var Oo=Object.freeze({DouglasPeuckerSimplifier:fs,TopologyPreservingSimplifier:Es});e(Cs.prototype,{splitAt:function(){if(1===arguments.length){var t=arguments[0],e=this.minimumLen/this.segLen;if(t.distance(this.seg.p0)<this.minimumLen)return this.splitPt=this.seg.pointAlong(e),null;if(t.distance(this.seg.p1)<this.minimumLen)return this.splitPt=Cs.pointAlongReverse(this.seg,e),null;this.splitPt=t}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=this.getConstrainedLength(n),s=r/this.segLen;i.equals2D(this.seg.p0)?this.splitPt=this.seg.pointAlong(s):this.splitPt=Cs.pointAlongReverse(this.seg,s)}},setMinimumLength:function(t){this.minimumLen=t},getConstrainedLength:function(t){return t<this.minimumLen?this.minimumLen:t},getSplitPoint:function(){return this.splitPt},interfaces_:function(){return[]},getClass:function(){return Cs}}),Cs.pointAlongReverse=function(t,e){var n=new g;return n.x=t.p1.x-e*(t.p1.x-t.p0.x),n.y=t.p1.y-e*(t.p1.y-t.p0.y),n},e(Ss.prototype,{findSplitPoint:function(t,e){},interfaces_:function(){return[]},getClass:function(){return Ss}}),e(ws.prototype,{findSplitPoint:function(t,e){var n=t.getLineSegment(),i=n.getLength(),r=i/2,s=new Cs(n),o=ws.projectedSplitPoint(t,e),a=2*o.distance(e)*.8,u=a;return u>r&&(u=r),s.setMinimumLength(u),s.splitAt(o),s.getSplitPoint()},interfaces_:function(){return[Ss]},getClass:function(){return ws}}),ws.projectedSplitPoint=function(t,e){return t.getLineSegment().project(e)},e(Ls.prototype,{interfaces_:function(){return[]},getClass:function(){return Ls}}),Ls.triArea=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)},Ls.isInCircleDDNormalized=function(t,e,n,i){var r=_.valueOf(t.x).selfSubtract(i.x),s=_.valueOf(t.y).selfSubtract(i.y),o=_.valueOf(e.x).selfSubtract(i.x),a=_.valueOf(e.y).selfSubtract(i.y),u=_.valueOf(n.x).selfSubtract(i.x),l=_.valueOf(n.y).selfSubtract(i.y),h=r.multiply(a).selfSubtract(o.multiply(s)),c=o.multiply(l).selfSubtract(u.multiply(a)),f=u.multiply(s).selfSubtract(r.multiply(l)),g=r.multiply(r).selfAdd(s.multiply(s)),d=o.multiply(o).selfAdd(a.multiply(a)),p=u.multiply(u).selfAdd(l.multiply(l));return g.selfMultiply(c).selfAdd(d.selfMultiply(f)).selfAdd(p.selfMultiply(h)).doubleValue()>0},Ls.checkRobustInCircle=function(t,e,n,i){var r=Ls.isInCircleNonRobust(t,e,n,i),s=Ls.isInCircleDDSlow(t,e,n,i),o=Ls.isInCircleCC(t,e,n,i),a=hi.circumcentre(t,e,n);A.out.println("p radius diff a = "+Math.abs(i.distance(a)-t.distance(a))/t.distance(a)),r===s&&r===o||(A.out.println("inCircle robustness failure (double result = "+r+", DD result = "+s+", CC result = "+o+")"),A.out.println(re.toLineString(new Gt([t,e,n,i]))),A.out.println("Circumcentre = "+re.toPoint(a)+" radius = "+t.distance(a)),A.out.println("p radius diff a = "+Math.abs(i.distance(a)/t.distance(a)-1)),A.out.println("p radius diff b = "+Math.abs(i.distance(a)/e.distance(a)-1)),A.out.println("p radius diff c = "+Math.abs(i.distance(a)/n.distance(a)-1)),A.out.println())},Ls.isInCircleDDFast=function(t,e,n,i){var r=_.sqr(t.x).selfAdd(_.sqr(t.y)).selfMultiply(Ls.triAreaDDFast(e,n,i)),s=_.sqr(e.x).selfAdd(_.sqr(e.y)).selfMultiply(Ls.triAreaDDFast(t,n,i)),o=_.sqr(n.x).selfAdd(_.sqr(n.y)).selfMultiply(Ls.triAreaDDFast(t,e,i)),a=_.sqr(i.x).selfAdd(_.sqr(i.y)).selfMultiply(Ls.triAreaDDFast(t,e,n));return r.selfSubtract(s).selfAdd(o).selfSubtract(a).doubleValue()>0},Ls.isInCircleCC=function(t,e,n,i){var r=hi.circumcentre(t,e,n),s=t.distance(r);return 0>=i.distance(r)-s},Ls.isInCircleNormalized=function(t,e,n,i){var r=t.x-i.x,s=t.y-i.y,o=e.x-i.x,a=e.y-i.y,u=n.x-i.x,l=n.y-i.y;return(r*r+s*s)*(o*l-u*a)+(o*o+a*a)*(u*s-r*l)+(u*u+l*l)*(r*a-o*s)>0},Ls.isInCircleDDSlow=function(t,e,n,i){var r=_.valueOf(i.x),s=_.valueOf(i.y),o=_.valueOf(t.x),a=_.valueOf(t.y),u=_.valueOf(e.x),l=_.valueOf(e.y),h=_.valueOf(n.x),c=_.valueOf(n.y),f=o.multiply(o).add(a.multiply(a)).multiply(Ls.triAreaDDSlow(u,l,h,c,r,s)),g=u.multiply(u).add(l.multiply(l)).multiply(Ls.triAreaDDSlow(o,a,h,c,r,s)),d=h.multiply(h).add(c.multiply(c)).multiply(Ls.triAreaDDSlow(o,a,u,l,r,s)),p=r.multiply(r).add(s.multiply(s)).multiply(Ls.triAreaDDSlow(o,a,u,l,h,c));return f.subtract(g).add(d).subtract(p).doubleValue()>0},Ls.isInCircleNonRobust=function(t,e,n,i){return(t.x*t.x+t.y*t.y)*Ls.triArea(e,n,i)-(e.x*e.x+e.y*e.y)*Ls.triArea(t,n,i)+(n.x*n.x+n.y*n.y)*Ls.triArea(t,e,i)-(i.x*i.x+i.y*i.y)*Ls.triArea(t,e,n)>0},Ls.isInCircleRobust=function(t,e,n,i){return Ls.isInCircleNormalized(t,e,n,i)},Ls.triAreaDDSlow=function(t,e,n,i,r,s){return n.subtract(t).multiply(s.subtract(e)).subtract(i.subtract(e).multiply(r.subtract(t)))},Ls.triAreaDDFast=function(t,e,n){var i=_.valueOf(e.x).selfSubtract(t.x).selfMultiply(_.valueOf(n.y).selfSubtract(t.y)),r=_.valueOf(e.y).selfSubtract(t.y).selfMultiply(_.valueOf(n.x).selfSubtract(t.x));return i.selfSubtract(r)},e(Rs.prototype,{circleCenter:function(t,e){var n=new Rs(this.getX(),this.getY()),i=this.bisector(n,t),r=this.bisector(t,e),s=new F(i,r),o=null;try{o=new Rs(s.getX(),s.getY())}catch(i){if(!(i instanceof w))throw i;A.err.println("a: "+n+"  b: "+t+"  c: "+e),A.err.println(i)}finally{}return o},dot:function(t){return this.p.x*t.getX()+this.p.y*t.getY()},magn:function(){return Math.sqrt(this.p.x*this.p.x+this.p.y*this.p.y)},getZ:function(){return this.p.z},bisector:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return new F(new F(t.getX()+n/2,t.getY()+i/2,1),new F(t.getX()-i+n/2,t.getY()+n+i/2,1))},equals:function(){if(1===arguments.length){var t=arguments[0];return this.p.x===t.getX()&&this.p.y===t.getY()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.p.distance(e.getCoordinate())<n}},getCoordinate:function(){return this.p},isInCircle:function(t,e,n){return Ls.isInCircleRobust(t.p,e.p,n.p,this.p)},
interpolateZValue:function(t,e,n){var i=t.getX(),r=t.getY(),s=e.getX()-i,o=n.getX()-i,a=e.getY()-r,u=n.getY()-r,l=s*u-o*a,h=this.getX()-i,c=this.getY()-r,f=(u*h-o*c)/l,g=(-a*h+s*c)/l;return t.getZ()+f*(e.getZ()-t.getZ())+g*(n.getZ()-t.getZ())},midPoint:function(t){return new Rs((this.p.x+t.getX())/2,(this.p.y+t.getY())/2,(this.p.z+t.getZ())/2)},rightOf:function(t){return this.isCCW(t.dest(),t.orig())},isCCW:function(t,e){return(t.p.x-this.p.x)*(e.p.y-this.p.y)-(t.p.y-this.p.y)*(e.p.x-this.p.x)>0},getX:function(){return this.p.x},crossProduct:function(t){return this.p.x*t.getY()-this.p.y*t.getX()},setZ:function(t){this.p.z=t},times:function(t){return new Rs(t*this.p.x,t*this.p.y)},cross:function(){return new Rs(this.p.y,-this.p.x)},leftOf:function(t){return this.isCCW(t.orig(),t.dest())},toString:function(){return"POINT ("+this.p.x+" "+this.p.y+")"},sub:function(t){return new Rs(this.p.x-t.getX(),this.p.y-t.getY())},getY:function(){return this.p.y},classify:function(t,e){var n=this,i=e.sub(t),r=n.sub(t),s=i.crossProduct(r);return s>0?Rs.LEFT:0>s?Rs.RIGHT:i.getX()*r.getX()<0||i.getY()*r.getY()<0?Rs.BEHIND:i.magn()<r.magn()?Rs.BEYOND:t.equals(n)?Rs.ORIGIN:e.equals(n)?Rs.DESTINATION:Rs.BETWEEN},sum:function(t){return new Rs(this.p.x+t.getX(),this.p.y+t.getY())},distance:function(t,e){return Math.sqrt(Math.pow(e.getX()-t.getX(),2)+Math.pow(e.getY()-t.getY(),2))},circumRadiusRatio:function(t,e){var n=this.circleCenter(t,e),i=this.distance(n,t),r=this.distance(this,t),s=this.distance(t,e);return r>s&&(r=s),s=this.distance(e,this),r>s&&(r=s),i/r},interfaces_:function(){return[]},getClass:function(){return Rs}}),Rs.interpolateZ=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=e.distance(n),r=t.distance(e),s=n.z-e.z;return e.z+s*(r/i)}if(4===arguments.length){var o=arguments[0],a=arguments[1],u=arguments[2],l=arguments[3],h=a.x,c=a.y,f=u.x-h,g=l.x-h,d=u.y-c,p=l.y-c,m=f*p-g*d,v=o.x-h,y=o.y-c,x=(p*v-g*y)/m,E=(-d*v+f*y)/m;return a.z+x*(u.z-a.z)+E*(l.z-a.z)}},Rs.LEFT=0,Rs.RIGHT=1,Rs.BEYOND=2,Rs.BEHIND=3,Rs.BETWEEN=4,Rs.ORIGIN=5,Rs.DESTINATION=6,h(Ts,Rs),e(Ts.prototype,{getConstraint:function(){return this.constraint},setOnConstraint:function(t){this._isOnConstraint=t},merge:function(t){t._isOnConstraint&&(this._isOnConstraint=!0,this.constraint=t.constraint)},isOnConstraint:function(){return this._isOnConstraint},setConstraint:function(t){this._isOnConstraint=!0,this.constraint=t},interfaces_:function(){return[]},getClass:function(){return Ts}}),e(Ps.prototype,{equalsNonOriented:function(t){return!!this.equalsOriented(t)||!!this.equalsOriented(t.sym())},toLineSegment:function(){return new he(this.vertex.getCoordinate(),this.dest().getCoordinate())},dest:function(){return this.sym().orig()},oNext:function(){return this.next},equalsOriented:function(t){return!(!this.orig().getCoordinate().equals2D(t.orig().getCoordinate())||!this.dest().getCoordinate().equals2D(t.dest().getCoordinate()))},dNext:function(){return this.sym().oNext().sym()},lPrev:function(){return this.next.sym()},rPrev:function(){return this.sym().oNext()},rot:function(){return this._rot},oPrev:function(){return this._rot.next._rot},sym:function(){return this._rot._rot},setOrig:function(t){this.vertex=t},lNext:function(){return this.invRot().oNext().rot()},getLength:function(){return this.orig().getCoordinate().distance(this.dest().getCoordinate())},invRot:function(){return this._rot.sym()},setDest:function(t){this.sym().setOrig(t)},setData:function(t){this.data=t},getData:function(){return this.data},delete:function(){this._rot=null},orig:function(){return this.vertex},rNext:function(){return this._rot.next.invRot()},toString:function(){var t=this.vertex.getCoordinate(),e=this.dest().getCoordinate();return re.toLineString(t,e)},isLive:function(){return null!==this._rot},getPrimary:function(){return this.orig().getCoordinate().compareTo(this.dest().getCoordinate())<=0?this:this.sym()},dPrev:function(){return this.invRot().oNext().invRot()},setNext:function(t){this.next=t},interfaces_:function(){return[]},getClass:function(){return Ps}}),Ps.makeEdge=function(t,e){var n=new Ps,i=new Ps,r=new Ps,s=new Ps;n._rot=i,i._rot=r,r._rot=s,s._rot=n,n.setNext(n),i.setNext(s),r.setNext(r),s.setNext(i);var o=n;return o.setOrig(t),o.setDest(e),o},Ps.swap=function(t){var e=t.oPrev(),n=t.sym().oPrev();Ps.splice(t,e),Ps.splice(t.sym(),n),Ps.splice(t,e.lNext()),Ps.splice(t.sym(),n.lNext()),t.setOrig(e.dest()),t.setDest(n.dest())},Ps.splice=function(t,e){var n=t.oNext().rot(),i=e.oNext().rot(),r=e.oNext(),s=t.oNext(),o=i.oNext(),a=n.oNext();t.setNext(r),e.setNext(s),n.setNext(o),i.setNext(a)},Ps.connect=function(t,e){var n=Ps.makeEdge(t.dest(),e.orig());return Ps.splice(n,t.lNext()),Ps.splice(n.sym(),e),n},e(bs.prototype,{insertSite:function(t){var e=this.subdiv.locate(t);if(this.subdiv.isVertexOfEdge(e,t))return e;this.subdiv.isOnEdge(e,t.getCoordinate())&&(e=e.oPrev(),this.subdiv.delete(e.oNext()));var n=this.subdiv.makeEdge(e.orig(),t);Ps.splice(n,e);var i=n;do{n=this.subdiv.connect(e,n.sym()),e=n.oPrev()}while(e.lNext()!==i);for(;;){var r=e.oPrev();if(r.dest().rightOf(e)&&t.isInCircle(e.orig(),r.dest(),e.dest()))Ps.swap(e),e=e.oPrev();else{if(e.oNext()===i)return n;e=e.oNext().lPrev()}}},insertSites:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertSite(n)}},interfaces_:function(){return[]},getClass:function(){return bs}}),e(Os.prototype,{locate:function(t){},interfaces_:function(){return[]},getClass:function(){return Os}}),e(_s.prototype,{init:function(){this.lastEdge=this.findEdge()},locate:function(t){this.lastEdge.isLive()||this.init();var e=this.subdiv.locateFromEdge(t,this.lastEdge);return this.lastEdge=e,e},findEdge:function(){return this.subdiv.getEdges().iterator().next()},interfaces_:function(){return[Os]},getClass:function(){return _s}}),h(Ms,l),e(Ms.prototype,{getSegment:function(){return this.seg},interfaces_:function(){return[]},getClass:function(){return Ms}}),Ms.msgWithSpatial=function(t,e){return null!==e?t+" [ "+e+" ]":t},e(Ds.prototype,{visit:function(t){},interfaces_:function(){return[]},getClass:function(){return Ds}}),e(As.prototype,{getTriangleVertices:function(t){var e=new qs;return this.visitTriangles(e,t),e.getTriangleVertices()},isFrameVertex:function(t){return!!t.equals(this.frameVertex[0])||(!!t.equals(this.frameVertex[1])||!!t.equals(this.frameVertex[2]))},isVertexOfEdge:function(t,e){return!(!e.equals(t.orig(),this.tolerance)&&!e.equals(t.dest(),this.tolerance))},connect:function(t,e){var n=Ps.connect(t,e);return this.quadEdges.add(n),n},getVoronoiCellPolygon:function(t,e){var n=new I,i=t;do{var r=t.rot().orig().getCoordinate();n.add(r),t=t.oPrev()}while(t!==i);var s=new N;s.addAll(n,!1),s.closeRing(),s.size()<4&&(A.out.println(s),s.add(s.get(s.size()-1),!0));var o=s.toCoordinateArray(),a=e.createPolygon(e.createLinearRing(o),null),u=i.orig();return a.setUserData(u.getCoordinate()),a},setLocator:function(t){this.locator=t},initSubdiv:function(){var t=this.makeEdge(this.frameVertex[0],this.frameVertex[1]),e=this.makeEdge(this.frameVertex[1],this.frameVertex[2]);Ps.splice(t.sym(),e);var n=this.makeEdge(this.frameVertex[2],this.frameVertex[0]);return Ps.splice(e.sym(),n),Ps.splice(n.sym(),t),t},isFrameBorderEdge:function(t){var e=new Array(3).fill(null);As.getTriangleEdges(t,e);var n=new Array(3).fill(null);As.getTriangleEdges(t.sym(),n);var i=t.lNext().dest();if(this.isFrameVertex(i))return!0;var r=t.sym().lNext().dest();return!!this.isFrameVertex(r)},makeEdge:function(t,e){var n=Ps.makeEdge(t,e);return this.quadEdges.add(n),n},visitTriangles:function(t,e){this.visitedKey++;var n=new de;n.push(this.startingEdge);for(var i=new J;!n.empty();){var r=n.pop();if(!i.contains(r)){var s=this.fetchTriangleToVisit(r,n,e,i);null!==s&&t.visit(s)}}},isFrameEdge:function(t){return!(!this.isFrameVertex(t.orig())&&!this.isFrameVertex(t.dest()))},isOnEdge:function(t,e){return this.seg.setCoordinates(t.orig().getCoordinate(),t.dest().getCoordinate()),this.seg.distance(e)<this.edgeCoincidenceTolerance},getEnvelope:function(){return new C(this.frameEnv)},createFrame:function(t){var e=t.getWidth(),n=t.getHeight(),i=0;i=e>n?10*e:10*n,this.frameVertex[0]=new Rs((t.getMaxX()+t.getMinX())/2,t.getMaxY()+i),this.frameVertex[1]=new Rs(t.getMinX()-i,t.getMinY()-i),this.frameVertex[2]=new Rs(t.getMaxX()+i,t.getMinY()-i),this.frameEnv=new C(this.frameVertex[0].getCoordinate(),this.frameVertex[1].getCoordinate()),this.frameEnv.expandToInclude(this.frameVertex[2].getCoordinate())},getTriangleCoordinates:function(t){var e=new Bs;return this.visitTriangles(e,t),e.getTriangles()},getVertices:function(t){for(var e=new J,n=this.quadEdges.iterator();n.hasNext();){var i=n.next(),r=i.orig();!t&&this.isFrameVertex(r)||e.add(r);var s=i.dest();!t&&this.isFrameVertex(s)||e.add(s)}return e},fetchTriangleToVisit:function(t,e,n,i){var r=t,s=0,o=!1;do{this.triEdges[s]=r,this.isFrameEdge(r)&&(o=!0);var a=r.sym();i.contains(a)||e.push(a),i.add(r),s++,r=r.lNext()}while(r!==t);return o&&!n?null:this.triEdges},getEdges:function(){if(0===arguments.length)return this.quadEdges;if(1===arguments.length){for(var t=arguments[0],e=this.getPrimaryEdges(!1),n=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var s=r.next();n[i++]=t.createLineString([s.orig().getCoordinate(),s.dest().getCoordinate()])}return t.createMultiLineString(n)}},getVertexUniqueEdges:function(t){for(var e=new I,n=new J,i=this.quadEdges.iterator();i.hasNext();){var r=i.next(),s=r.orig();n.contains(s)||(n.add(s),!t&&this.isFrameVertex(s)||e.add(r));var o=r.sym(),a=o.orig();n.contains(a)||(n.add(a),!t&&this.isFrameVertex(a)||e.add(o))}return e},getTriangleEdges:function(t){var e=new Gs;return this.visitTriangles(e,t),e.getTriangleEdges()},getPrimaryEdges:function(t){this.visitedKey++;var e=new I,n=new de;n.push(this.startingEdge);for(var i=new J;!n.empty();){var r=n.pop();if(!i.contains(r)){var s=r.getPrimary();!t&&this.isFrameEdge(s)||e.add(s),n.push(r.oNext()),n.push(r.sym().oNext()),i.add(r),i.add(r.sym())}}return e},delete:function(t){Ps.splice(t,t.oPrev()),Ps.splice(t.sym(),t.sym().oPrev());var e=t.sym(),n=t.rot(),i=t.rot().sym();this.quadEdges.remove(t),this.quadEdges.remove(e),this.quadEdges.remove(n),this.quadEdges.remove(i),t.delete(),e.delete(),n.delete(),i.delete()},locateFromEdge:function(t,e){for(var n=0,i=this.quadEdges.size(),r=e;;){if(++n>i)throw new Ms(r.toLineSegment());if(t.equals(r.orig())||t.equals(r.dest()))break;if(t.rightOf(r))r=r.sym();else if(t.rightOf(r.oNext())){if(t.rightOf(r.dPrev()))break;r=r.dPrev()}else r=r.oNext()}return r},getTolerance:function(){return this.tolerance},getVoronoiCellPolygons:function(t){this.visitTriangles(new Fs,!0);for(var e=new I,n=this.getVertexUniqueEdges(!1),i=n.iterator();i.hasNext();){var r=i.next();e.add(this.getVoronoiCellPolygon(r,t))}return e},getVoronoiDiagram:function(t){var e=this.getVoronoiCellPolygons(t);return t.createGeometryCollection(ne.toGeometryArray(e))},getTriangles:function(t){for(var e=this.getTriangleCoordinates(!1),n=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var s=r.next();n[i++]=t.createPolygon(t.createLinearRing(s),null)}return t.createGeometryCollection(n)},insertSite:function(t){var e=this.locate(t);if(t.equals(e.orig(),this.tolerance)||t.equals(e.dest(),this.tolerance))return e;var n=this.makeEdge(e.orig(),t);Ps.splice(n,e);var i=n;do{n=this.connect(e,n.sym()),e=n.oPrev()}while(e.lNext()!==i);return i},locate:function(){if(1===arguments.length){if(arguments[0]instanceof Rs){var t=arguments[0];return this.locator.locate(t)}if(arguments[0]instanceof g){var e=arguments[0];return this.locator.locate(new Rs(e))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=this.locator.locate(new Rs(n));if(null===r)return null;var s=r;r.dest().getCoordinate().equals2D(n)&&(s=r.sym());var o=s;do{if(o.dest().getCoordinate().equals2D(i))return o;o=o.oNext()}while(o!==s);return null}},interfaces_:function(){return[]},getClass:function(){return As}}),As.getTriangleEdges=function(t,e){if(e[0]=t,e[1]=e[0].lNext(),e[2]=e[1].lNext(),e[2].lNext()!==e[0])throw new i("Edges do not form a triangle")},e(Fs.prototype,{visit:function(t){for(var e=t[0].orig().getCoordinate(),n=t[1].orig().getCoordinate(),i=t[2].orig().getCoordinate(),r=hi.circumcentre(e,n,i),s=new Rs(r),o=0;3>o;o++)t[o].rot().setOrig(s)},interfaces_:function(){return[Ds]},getClass:function(){return Fs}}),e(Gs.prototype,{getTriangleEdges:function(){return this.triList},visit:function(t){this.triList.add(t.clone())},interfaces_:function(){return[Ds]},getClass:function(){return Gs}}),e(qs.prototype,{visit:function(t){this.triList.add([t[0].orig(),t[1].orig(),t[2].orig()])},getTriangleVertices:function(){return this.triList},interfaces_:function(){return[Ds]},getClass:function(){return qs}}),e(Bs.prototype,{checkTriangleSize:function(t){t.length>=2?re.toLineString(t[0],t[1]):t.length>=1&&re.toPoint(t[0])},visit:function(t){this.coordList.clear();for(var e=0;3>e;e++){var n=t[e].orig();this.coordList.add(n.getCoordinate())}if(this.coordList.size()>0){this.coordList.closeRing();var i=this.coordList.toCoordinateArray();if(4!==i.length)return null;this.triCoords.add(i)}},getTriangles:function(){return this.triCoords},interfaces_:function(){return[Ds]},getClass:function(){return Bs}}),As.TriangleCircumcentreVisitor=Fs,As.TriangleEdgesListVisitor=Gs,As.TriangleVertexListVisitor=qs,As.TriangleCoordinatesVisitor=Bs,As.EDGE_COINCIDENCE_TOL_FACTOR=1e3,e(zs.prototype,{getLineSegment:function(){return this.ls},getEndZ:function(){return this.ls.getCoordinate(1).z},getStartZ:function(){return this.ls.getCoordinate(0).z},intersection:function(t){return this.ls.intersection(t.getLineSegment())},getStart:function(){return this.ls.getCoordinate(0)},getEnd:function(){return this.ls.getCoordinate(1)},getEndY:function(){return this.ls.getCoordinate(1).y},getStartX:function(){return this.ls.getCoordinate(0).x},equalsTopo:function(t){return this.ls.equalsTopo(t.getLineSegment())},getStartY:function(){return this.ls.getCoordinate(0).y},setData:function(t){this.data=t},getData:function(){return this.data},getEndX:function(){return this.ls.getCoordinate(1).x},toString:function(){return this.ls.toString()},interfaces_:function(){return[]},getClass:function(){return zs}}),e(Vs.prototype,{visit:function(t){},interfaces_:function(){return[]},getClass:function(){return Vs}}),e(ks.prototype,{isRepeated:function(){return this.count>1},getRight:function(){return this.right},getCoordinate:function(){return this.p},setLeft:function(t){this.left=t},getX:function(){return this.p.x},getData:function(){return this.data},getCount:function(){return this.count},getLeft:function(){return this.left},getY:function(){return this.p.y},increment:function(){this.count=this.count+1},setRight:function(t){this.right=t},interfaces_:function(){return[]},getClass:function(){return ks}}),e(Ys.prototype,{insert:function(){if(1===arguments.length){var t=arguments[0];return this.insert(t,null)}if(2===arguments.length){var e=arguments[0],n=arguments[1];if(null===this.root)return this.root=new ks(e,n),this.root;if(this.tolerance>0){var i=this.findBestMatchNode(e);if(null!==i)return i.increment(),i}return this.insertExact(e,n)}},query:function(){var t=arguments,e=this;if(1===arguments.length){var n=arguments[0],i=new I;return this.query(n,i),i}if(2===arguments.length)if(arguments[0]instanceof C&&R(arguments[1],y))!function(){var n=t[0],i=t[1];e.queryNode(e.root,n,!0,{interfaces_:function(){return[Vs]},visit:function(t){i.add(t)}})}();else if(arguments[0]instanceof C&&R(arguments[1],Vs)){var r=arguments[0],s=arguments[1];this.queryNode(this.root,r,!0,s)}},queryNode:function(t,e,n,i){if(null===t)return null;var r=null,s=null,o=null;n?(r=e.getMinX(),s=e.getMaxX(),o=t.getX()):(r=e.getMinY(),s=e.getMaxY(),o=t.getY());var a=o>r,u=s>=o;a&&this.queryNode(t.getLeft(),e,!n,i),e.contains(t.getCoordinate())&&i.visit(t),u&&this.queryNode(t.getRight(),e,!n,i)},findBestMatchNode:function(t){var e=new Us(t,this.tolerance);return this.query(e.queryEnvelope(),e),e.getNode()},isEmpty:function(){return null===this.root},insertExact:function(t,e){for(var n=this.root,i=this.root,r=!0,s=!0;null!==n;){if(null!==n){if(t.distance(n.getCoordinate())<=this.tolerance)return n.increment(),n}s=r?t.x<n.getX():t.y<n.getY(),i=n,n=s?n.getLeft():n.getRight(),r=!r}this.numberOfNodes=this.numberOfNodes+1;var o=new ks(t,e);return s?i.setLeft(o):i.setRight(o),o},interfaces_:function(){return[]},getClass:function(){return Ys}}),Ys.toCoordinates=function(){if(1===arguments.length){var t=arguments[0];return Ys.toCoordinates(t,!1)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new N,r=e.iterator();r.hasNext();)for(var s=r.next(),o=n?s.getCount():1,a=0;o>a;a++)i.add(s.getCoordinate(),!0);return i.toCoordinateArray()}},e(Us.prototype,{visit:function(t){var e=this.p.distance(t.getCoordinate());if(!(e<=this.tolerance))return null;var n=!1;(null===this.matchNode||e<this.matchDist||null!==this.matchNode&&e===this.matchDist&&t.getCoordinate().compareTo(this.matchNode.getCoordinate())<1)&&(n=!0),n&&(this.matchNode=t,this.matchDist=e)},queryEnvelope:function(){var t=new C(this.p);return t.expandBy(this.tolerance),t},getNode:function(){return this.matchNode},interfaces_:function(){return[Vs]},getClass:function(){return Us}}),Ys.BestMatchVisitor=Us,e(Xs.prototype,{getInitialVertices:function(){return this.initialVertices},getKDT:function(){return this.kdt},enforceConstraints:function(){this.addConstraintVertices();var t=0,e=0;do{e=this.enforceGabriel(this.segments),t++}while(e>0&&t<Xs.MAX_SPLIT_ITER)},insertSites:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertSite(n)}},getVertexFactory:function(){return this.vertexFactory},getPointArray:function(){for(var t=new Array(this.initialVertices.size()+this.segVertices.size()).fill(null),e=0,n=this.initialVertices.iterator();n.hasNext();){var i=n.next();t[e++]=i.getCoordinate()}for(var r=this.segVertices.iterator();r.hasNext();){var i=r.next();t[e++]=i.getCoordinate()}return t},setConstraints:function(t,e){this.segments=t,this.segVertices=e},computeConvexHull:function(){var t=new ne,e=this.getPointArray(),n=new me(e,t);this.convexHull=n.getConvexHull()},addConstraintVertices:function(){this.computeConvexHull(),this.insertSites(this.segVertices)},findNonGabrielPoint:function(t){var e=t.getStart(),n=t.getEnd(),i=new g((e.x+n.x)/2,(e.y+n.y)/2),s=e.distance(i),o=new C(i);o.expandBy(s);for(var a=this.kdt.query(o),u=null,l=r.MAX_VALUE,h=a.iterator();h.hasNext();){var c=h.next(),f=c.getCoordinate();if(!f.equals2D(e)&&!f.equals2D(n)){var d=i.distance(f);if(s>d){var p=d;(null===u||l>p)&&(u=f,l=p)}}}return u},getConstraintSegments:function(){return this.segments},setSplitPointFinder:function(t){this.splitFinder=t},getConvexHull:function(){return this.convexHull},getTolerance:function(){return this.tolerance},enforceGabriel:function(t){for(var e=new I,n=0,i=new I,r=t.iterator();r.hasNext();){var s=r.next(),o=this.findNonGabrielPoint(s);if(null!==o){this.splitPt=this.splitFinder.findSplitPoint(s,o);var a=this.createVertex(this.splitPt,s),u=(this.insertSite(a),new zs(s.getStartX(),s.getStartY(),s.getStartZ(),a.getX(),a.getY(),a.getZ(),s.getData())),l=new zs(a.getX(),a.getY(),a.getZ(),s.getEndX(),s.getEndY(),s.getEndZ(),s.getData());e.add(u),e.add(l),i.add(s),n+=1}}return t.removeAll(i),t.addAll(e),n},createVertex:function(){if(1===arguments.length){var t=arguments[0],e=null;return e=null!==this.vertexFactory?this.vertexFactory.createVertex(t,null):new Ts(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=null;return e=null!==this.vertexFactory?this.vertexFactory.createVertex(n,i):new Ts(n),e.setOnConstraint(!0),e}},getSubdivision:function(){return this.subdiv},computeBoundingBox:function(){var t=Xs.computeVertexEnvelope(this.initialVertices),e=Xs.computeVertexEnvelope(this.segVertices),n=new C(t);n.expandToInclude(e);var i=.2*n.getWidth(),r=.2*n.getHeight(),s=Math.max(i,r);this.computeAreaEnv=new C(n),this.computeAreaEnv.expandBy(s)},setVertexFactory:function(t){this.vertexFactory=t},formInitialDelaunay:function(){this.computeBoundingBox(),this.subdiv=new As(this.computeAreaEnv,this.tolerance),this.subdiv.setLocator(new _s(this.subdiv)),this.incDel=new bs(this.subdiv),this.insertSites(this.initialVertices)},insertSite:function(){if(arguments[0]instanceof Ts){var t=arguments[0],e=this.kdt.insert(t.getCoordinate(),t);if(e.isRepeated()){var n=e.getData();return n.merge(t),n}return this.incDel.insertSite(t),t}if(arguments[0]instanceof g){var i=arguments[0];this.insertSite(this.createVertex(i))}},interfaces_:function(){return[]},getClass:function(){return Xs}}),Xs.computeVertexEnvelope=function(t){for(var e=new C,n=t.iterator();n.hasNext();){var i=n.next();e.expandToInclude(i.getCoordinate())}return e},Xs.MAX_SPLIT_ITER=99,e(Hs.prototype,{create:function(){if(null!==this.subdiv)return null;var t=Hs.envelope(this.siteCoords),e=Hs.toVertices(this.siteCoords);this.subdiv=new As(t,this.tolerance),new bs(this.subdiv).insertSites(e)},setTolerance:function(t){this.tolerance=t},setSites:function(){if(arguments[0]instanceof B){var t=arguments[0];this.siteCoords=Hs.extractUniqueCoordinates(t)}else if(R(arguments[0],m)){var e=arguments[0];this.siteCoords=Hs.unique(H.toCoordinateArray(e))}},getEdges:function(t){return this.create(),this.subdiv.getEdges(t)},getSubdivision:function(){return this.create(),this.subdiv},getTriangles:function(t){return this.create(),this.subdiv.getTriangles(t)},interfaces_:function(){return[]},getClass:function(){return Hs}}),Hs.extractUniqueCoordinates=function(t){if(null===t)return new N;var e=t.getCoordinates();return Hs.unique(e)},Hs.envelope=function(t){for(var e=new C,n=t.iterator();n.hasNext();){var i=n.next();e.expandToInclude(i)}return e},Hs.unique=function(t){var e=H.copyDeep(t);return ut.sort(e),new N(e,!1)},Hs.toVertices=function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next();e.add(new Rs(i))}return e},e(Ws.prototype,{createSiteVertices:function(t){for(var e=new I,n=t.iterator();n.hasNext();){var i=n.next();this.constraintVertexMap.containsKey(i)||e.add(new Ts(i))}return e},create:function(){if(null!==this.subdiv)return null;var t=Hs.envelope(this.siteCoords),e=new I;null!==this.constraintLines&&(t.expandToInclude(this.constraintLines.getEnvelopeInternal()),this.createVertices(this.constraintLines),e=Ws.createConstraintSegments(this.constraintLines));var n=this.createSiteVertices(this.siteCoords),i=new Xs(n,this.tolerance);i.setConstraints(e,new I(this.constraintVertexMap.values())),i.formInitialDelaunay(),i.enforceConstraints(),this.subdiv=i.getSubdivision()},setTolerance:function(t){this.tolerance=t},setConstraints:function(t){this.constraintLines=t},setSites:function(t){this.siteCoords=Hs.extractUniqueCoordinates(t)},getEdges:function(t){return this.create(),this.subdiv.getEdges(t)},getSubdivision:function(){return this.create(),this.subdiv},getTriangles:function(t){return this.create(),this.subdiv.getTriangles(t)},createVertices:function(t){for(var e=t.getCoordinates(),n=0;n<e.length;n++){var i=new Ts(e[n]);this.constraintVertexMap.put(e[n],i)}},interfaces_:function(){return[]},getClass:function(){return Ws}}),Ws.createConstraintSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=Vn.getLines(t),n=new I,i=e.iterator();i.hasNext();){var r=i.next();Ws.createConstraintSegments(r,n)}return n}if(2===arguments.length)for(var s=arguments[0],o=arguments[1],a=s.getCoordinates(),i=1;i<a.length;i++)o.add(new zs(a[i-1],a[i]))},e(js.prototype,{create:function(){if(null!==this.subdiv)return null;var t=Hs.envelope(this.siteCoords);this.diagramEnv=t;var e=Math.max(this.diagramEnv.getWidth(),this.diagramEnv.getHeight());this.diagramEnv.expandBy(e),null!==this.clipEnv&&this.diagramEnv.expandToInclude(this.clipEnv);var n=Hs.toVertices(this.siteCoords);this.subdiv=new As(t,this.tolerance),new bs(this.subdiv).insertSites(n)},getDiagram:function(t){this.create();var e=this.subdiv.getVoronoiDiagram(t);return js.clipGeometryCollection(e,this.diagramEnv)},setTolerance:function(t){this.tolerance=t},setSites:function(){if(arguments[0]instanceof B){var t=arguments[0];this.siteCoords=Hs.extractUniqueCoordinates(t)}else if(R(arguments[0],m)){var e=arguments[0];this.siteCoords=Hs.unique(H.toCoordinateArray(e))}},setClipEnvelope:function(t){this.clipEnv=t},getSubdivision:function(){return this.create(),this.subdiv},interfaces_:function(){return[]},getClass:function(){return js}}),js.clipGeometryCollection=function(t,e){for(var n=t.getFactory().toGeometry(e),i=new I,r=0;r<t.getNumGeometries();r++){var s=t.getGeometryN(r),o=null;e.contains(s.getEnvelopeInternal())?o=s:e.intersects(s.getEnvelopeInternal())&&(o=n.intersection(s),o.setUserData(s.getUserData())),null===o||o.isEmpty()||i.add(o)}return t.getFactory().createGeometryCollection(ne.toGeometryArray(i))};var _o=Object.freeze({ConformingDelaunayTriangulationBuilder:Ws,DelaunayTriangulationBuilder:Hs,VoronoiDiagramBuilder:js});e(Ks.prototype,{interfaces_:function(){return[]},getClass:function(){return Ks}}),Ks.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return ni.createEmptyResult(ni.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ri.overlayOp(t,e,ni.UNION)},e(B.prototype,{equalsTopo:function(t){return!!this.getEnvelopeInternal().equals(t.getEnvelopeInternal())&&kr.relate(this,t).isEquals(this.getDimension(),t.getDimension())},union:function(){if(0===arguments.length)return Wr.union(this);if(1===arguments.length){var t=arguments[0];return Ks.union(this,t)}},isValid:function(){return us.isValid(this)},intersection:function(t){if(this.isEmpty()||t.isEmpty())return ni.createEmptyResult(ni.INTERSECTION,this,t,this.factory);if(this.isGeometryCollection()){var e=t;return ln.map(this,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(e)}})}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),ri.overlayOp(this,t,ni.INTERSECTION)},covers:function(t){return kr.covers(this,t)},coveredBy:function(t){return kr.coveredBy(this,t)},touches:function(t){return kr.touches(this,t)},intersects:function(t){return kr.intersects(this,t)},within:function(t){return kr.within(this,t)},overlaps:function(t){return kr.overlaps(this,t)},disjoint:function(t){return kr.disjoint(this,t)},crosses:function(t){return kr.crosses(this,t)},buffer:function(){if(1===arguments.length){var t=arguments[0];return rr.bufferOp(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return rr.bufferOp(this,e,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];return rr.bufferOp(this,i,r,s)}},convexHull:function(){return new me(this).getConvexHull()},relate:function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return kr.relate.apply(kr,[this].concat(e))},getCentroid:function(){if(this.isEmpty())return this.factory.createPoint();var t=fe.getCentroid(this);return this.createPointFromInternalCoord(t,this)},getInteriorPoint:function(){if(this.isEmpty())return this.factory.createPoint();var t=null,e=this.getDimension();if(0===e){var n=new ui(this);t=n.getInteriorPoint()}else if(1===e){var n=new ai(this);t=n.getInteriorPoint()}else{var n=new si(this);t=n.getInteriorPoint()}return this.createPointFromInternalCoord(t,this)},symDifference:function(t){if(this.isEmpty()||t.isEmpty()){if(this.isEmpty()&&t.isEmpty())return ni.createEmptyResult(ni.SYMDIFFERENCE,this,t,this.factory);if(this.isEmpty())return t.copy();if(t.isEmpty())return this.copy()}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),ri.overlayOp(this,t,ni.SYMDIFFERENCE)},createPointFromInternalCoord:function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},toText:function(){return(new re).write(this)},toString:function(){this.toText()},contains:function(t){return kr.contains(this,t)},difference:function(t){return this.isEmpty()?ni.createEmptyResult(ni.DIFFERENCE,this,t,this.factory):t.isEmpty()?this.copy():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),ri.overlayOp(this,t,ni.DIFFERENCE))},isSimple:function(){return new Fi(this).isSimple()},isWithinDistance:function(t,e){return!(this.getEnvelopeInternal().distance(t.getEnvelopeInternal())>e)&&lr.isWithinDistance(this,t,e)},distance:function(t){return lr.distance(this,t)},isEquivalentClass:function(t){return this.getClass()===t.getClass()}});t.version="1.1.2 (248dab8)",t.algorithm=lo,t.densify=ho,t.dissolve=co,t.geom=ao,t.index=po,t.io=xo,t.noding=Eo,t.operation=Po,t.precision=bo,t.simplify=Oo,t.triangulate=_o});
},{}],141:[function(require,module,exports){
"use strict";function kdbush(t,i,e,s,n){return new KDBush(t,i,e,s,n)}function KDBush(t,i,e,s,n){i=i||defaultGetX,e=e||defaultGetY,n=n||Array,this.nodeSize=s||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var r=0;r<t.length;r++)this.ids[r]=r,this.coords[2*r]=i(t[r]),this.coords[2*r+1]=e(t[r]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}var sort=require("./sort"),range=require("./range"),within=require("./within");module.exports=kdbush,KDBush.prototype={range:function(t,i,e,s){return range(this.ids,this.coords,t,i,e,s,this.nodeSize)},within:function(t,i,e){return within(this.ids,this.coords,t,i,e,this.nodeSize)}};
},{"./range":142,"./sort":143,"./within":144}],142:[function(require,module,exports){
"use strict";function range(p,r,s,u,h,e,o){for(var a,t,n=[0,p.length-1,0],f=[];n.length;){var l=n.pop(),v=n.pop(),g=n.pop();if(v-g<=o)for(var i=g;i<=v;i++)a=r[2*i],t=r[2*i+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[i]);else{var c=Math.floor((g+v)/2);a=r[2*c],t=r[2*c+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[c]);var d=(l+1)%2;(0===l?s<=a:u<=t)&&(n.push(g),n.push(c-1),n.push(d)),(0===l?h>=a:e>=t)&&(n.push(c+1),n.push(v),n.push(d))}}return f}module.exports=range;
},{}],143:[function(require,module,exports){
"use strict";function sortKD(t,a,o,s,r,e){if(!(r-s<=o)){var f=Math.floor((s+r)/2);select(t,a,f,s,r,e%2),sortKD(t,a,o,s,f-1,e+1),sortKD(t,a,o,f+1,r,e+1)}}function select(t,a,o,s,r,e){for(;r>s;){if(r-s>600){var f=r-s+1,p=o-s+1,w=Math.log(f),m=.5*Math.exp(2*w/3),n=.5*Math.sqrt(w*m*(f-m)/f)*(p-f/2<0?-1:1);select(t,a,o,Math.max(s,Math.floor(o-p*m/f+n)),Math.min(r,Math.floor(o+(f-p)*m/f+n)),e)}var c=a[2*o+e],h=s,i=r;for(swapItem(t,a,s,o),a[2*r+e]>c&&swapItem(t,a,s,r);h<i;){for(swapItem(t,a,h,i),h++,i--;a[2*h+e]<c;)h++;for(;a[2*i+e]>c;)i--}a[2*s+e]===c?swapItem(t,a,s,i):(i++,swapItem(t,a,i,r)),i<=o&&(s=i+1),o<=i&&(r=i-1)}}function swapItem(t,a,o,s){swap(t,o,s),swap(a,2*o,2*s),swap(a,2*o+1,2*s+1)}function swap(t,a,o){var s=t[a];t[a]=t[o],t[o]=s}module.exports=sortKD;
},{}],144:[function(require,module,exports){
"use strict";function within(s,p,r,t,u,h){for(var i=[0,s.length-1,0],o=[],n=u*u;i.length;){var e=i.pop(),a=i.pop(),f=i.pop();if(a-f<=h)for(var v=f;v<=a;v++)sqDist(p[2*v],p[2*v+1],r,t)<=n&&o.push(s[v]);else{var l=Math.floor((f+a)/2),c=p[2*l],q=p[2*l+1];sqDist(c,q,r,t)<=n&&o.push(s[l]);var D=(e+1)%2;(0===e?r-u<=c:t-u<=q)&&(i.push(f),i.push(l-1),i.push(D)),(0===e?r+u>=c:t+u>=q)&&(i.push(l+1),i.push(a),i.push(D))}}return o}function sqDist(s,p,r,t){var u=s-r,h=p-t;return u*u+h*h}module.exports=within;
},{}],145:[function(require,module,exports){
"use strict";function lineclip(e,i,n){var t,l,o,r,p,u=e.length,c=bitCode(e[0],i),s=[];for(n||(n=[]),t=1;t<u;t++){for(l=e[t-1],o=e[t],r=p=bitCode(o,i);;){if(!(c|r)){s.push(l),r!==p?(s.push(o),t<u-1&&(n.push(s),s=[])):t===u-1&&s.push(o);break}if(c&r)break;c?(l=intersect(l,o,c,i),c=bitCode(l,i)):(o=intersect(l,o,r,i),r=bitCode(o,i))}c=p}return s.length&&n.push(s),n}function polygonclip(e,i){var n,t,l,o,r,p,u;for(t=1;t<=8;t*=2){for(n=[],l=e[e.length-1],o=!(bitCode(l,i)&t),r=0;r<e.length;r++)p=e[r],u=!(bitCode(p,i)&t),u!==o&&n.push(intersect(l,p,t,i)),u&&n.push(p),l=p,o=u;if(e=n,!e.length)break}return n}function intersect(e,i,n,t){return 8&n?[e[0]+(i[0]-e[0])*(t[3]-e[1])/(i[1]-e[1]),t[3]]:4&n?[e[0]+(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1]),t[1]]:2&n?[t[2],e[1]+(i[1]-e[1])*(t[2]-e[0])/(i[0]-e[0])]:1&n?[t[0],e[1]+(i[1]-e[1])*(t[0]-e[0])/(i[0]-e[0])]:null}function bitCode(e,i){var n=0;return e[0]<i[0]?n|=1:e[0]>i[2]&&(n|=2),e[1]<i[1]?n|=4:e[1]>i[3]&&(n|=8),n}module.exports=lineclip,lineclip.polyline=lineclip,lineclip.polygon=polygonclip;
},{}],146:[function(require,module,exports){
!function(t,o){"function"==typeof define&&define.amd?define([],function(){return{isoBands:o()}}):"object"==typeof module&&module.exports?module.exports={isoBands:o()}:t.MarchingSquaresJS={isoBands:o(),isoContours:t.MarchingSquaresJS?t.MarchingSquaresJS.isoContours:null}}(this,function(){function t(t,o,e,u){u=u?u:{};for(var p=Object.keys(l),h=0;h<p.length;h++){var i=p[h],a=u[i];a=void 0!==a&&null!==a?a:l[i],f[i]=a}f.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+o+":"+(o+e)+"]");var c,g=r(t,o,e);return f.polygons?(f.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),c=n(g)):(f.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),c=s(g)),"function"==typeof f.successCallback&&f.successCallback(c),c}function o(t,o,e){return(t-o)/(e-o)}function e(t){return t.constructor.toString().indexOf("Array")>-1}function r(t,e,r){for(var s=t.length-1,u=t[0].length-1,p={rows:s,cols:u,cells:[]},h=e+Math.abs(r),i=0;i<s;++i){p.cells[i]=[];for(var n=0;n<u;++n){var l=0,f=t[i+1][n],a=t[i+1][n+1],c=t[i][n+1],g=t[i][n];if(!(isNaN(f)||isNaN(a)||isNaN(c)||isNaN(g))){l|=f<e?0:f>h?128:64,l|=a<e?0:a>h?32:16,l|=c<e?0:c>h?8:4,l|=g<e?0:g>h?2:1;var b=+l,m=0;if(17===l||18===l||33===l||34===l||38===l||68===l||72===l||98===l||102===l||132===l||136===l||137===l||152===l||153===l){var d=(f+a+c+g)/4;m=d>h?2:d<e?0:1,34===l?1===m?l=35:0===m&&(l=136):136===l?1===m?(l=35,m=4):0===m&&(l=34):17===l?1===m?(l=155,m=4):0===m&&(l=153):68===l?1===m?(l=103,m=4):0===m&&(l=102):153===l?1===m&&(l=155):102===l?1===m&&(l=103):152===l?m<2&&(l=156,m=1):137===l?m<2&&(l=139,m=1):98===l?m<2&&(l=99,m=1):38===l?m<2&&(l=39,m=1):18===l?m>0?(l=156,m=4):l=152:33===l?m>0?(l=139,m=4):l=137:72===l?m>0?(l=99,m=4):l=98:132===l&&(m>0?(l=39,m=4):l=38)}if(0!=l&&170!=l){var y,x,k,v,S,w,M,q;y=x=k=v=S=w=M=q=.5;var B=[];1===l?(k=1-o(e,c,g),q=1-o(e,f,g),B.push(jt[l])):169===l?(k=o(h,g,c),q=o(h,g,f),B.push(jt[l])):4===l?(w=1-o(e,a,c),v=o(e,g,c),B.push(Jt[l])):166===l?(w=o(h,c,a),v=1-o(h,c,g),B.push(Jt[l])):16===l?(S=o(e,c,a),x=o(e,f,a),B.push(Bt[l])):154===l?(S=1-o(h,a,c),x=1-o(h,a,f),B.push(Bt[l])):64===l?(M=o(e,g,f),y=1-o(e,a,f),B.push(_t[l])):106===l?(M=1-o(h,f,g),y=o(h,f,a),B.push(_t[l])):168===l?(v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),B.push(Nt[l]),B.push(jt[l])):2===l?(v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),B.push(Nt[l]),B.push(jt[l])):162===l?(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),B.push(Nt[l]),B.push(jt[l])):8===l?(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),B.push(Bt[l]),B.push(Jt[l])):138===l?(S=1-o(e,a,c),w=1-o(h,a,c),y=1-o(h,a,f),x=1-o(e,a,f),B.push(Bt[l]),B.push(Jt[l])):32===l?(S=o(h,c,a),w=o(e,c,a),y=o(e,f,a),x=o(h,f,a),B.push(Bt[l]),B.push(Jt[l])):42===l?(q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a),B.push(Et[l]),B.push(_t[l])):128===l&&(q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f),B.push(Et[l]),B.push(_t[l])),5===l?(w=1-o(e,a,c),q=1-o(e,f,g),B.push(Jt[l])):165===l?(w=o(h,c,a),q=o(h,g,f),B.push(Jt[l])):20===l?(v=o(e,g,c),x=o(e,f,a),B.push(Nt[l])):150===l?(v=1-o(h,c,g),x=1-o(h,a,f),B.push(Nt[l])):80===l?(S=o(e,c,a),M=o(e,g,f),B.push(Bt[l])):90===l?(S=1-o(h,a,c),M=1-o(h,f,g),B.push(Bt[l])):65===l?(k=1-o(e,c,g),y=1-o(e,a,f),B.push(jt[l])):105===l?(k=o(h,g,c),y=o(h,f,a),B.push(jt[l])):160===l?(S=o(h,c,a),w=o(e,c,a),q=o(e,g,f),M=o(h,g,f),B.push(Bt[l]),B.push(Jt[l])):10===l?(S=1-o(e,a,c),w=1-o(h,a,c),q=1-o(h,f,g),M=1-o(e,f,g),B.push(Bt[l]),B.push(Jt[l])):130===l?(v=1-o(e,c,g),k=1-o(h,c,g),y=1-o(h,a,f),x=1-o(e,a,f),B.push(Nt[l]),B.push(jt[l])):40===l?(v=o(h,g,c),k=o(e,g,c),y=o(e,f,a),x=o(h,f,a),B.push(Nt[l]),B.push(jt[l])):101===l?(w=o(h,c,a),y=o(h,f,a),B.push(Jt[l])):69===l?(w=1-o(e,a,c),y=1-o(e,a,f),B.push(Jt[l])):149===l?(q=o(h,g,f),x=1-o(h,a,f),B.push(Et[l])):21===l?(q=1-o(e,f,g),x=o(e,f,a),B.push(Et[l])):86===l?(v=1-o(h,c,g),M=1-o(h,f,g),B.push(Nt[l])):84===l?(v=o(e,g,c),M=o(e,g,f),B.push(Nt[l])):89===l?(S=1-o(h,a,c),k=o(h,g,c),B.push(jt[l])):81===l?(S=o(e,c,a),k=1-o(e,c,g),B.push(jt[l])):96===l?(S=o(h,c,a),w=o(e,c,a),M=o(e,g,f),y=o(h,f,a),B.push(Bt[l]),B.push(Jt[l])):74===l?(S=1-o(e,a,c),w=1-o(h,a,c),M=1-o(h,f,g),y=1-o(e,a,f),B.push(Bt[l]),B.push(Jt[l])):24===l?(S=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),x=o(e,f,a),B.push(Bt[l]),B.push(jt[l])):146===l?(S=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),x=1-o(h,a,f),B.push(Bt[l]),B.push(jt[l])):6===l?(w=1-o(e,a,c),v=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),B.push(Jt[l]),B.push(Nt[l])):164===l?(w=o(h,c,a),v=o(e,g,c),q=o(e,g,f),M=o(h,g,f),B.push(Jt[l]),B.push(Nt[l])):129===l?(k=1-o(e,c,g),q=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f),B.push(jt[l]),B.push(Et[l])):41===l?(k=o(h,g,c),q=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a),B.push(jt[l]),B.push(Et[l])):66===l?(v=1-o(e,c,g),k=1-o(h,c,g),M=1-o(h,f,g),y=1-o(e,a,f),B.push(Nt[l]),B.push(jt[l])):104===l?(v=o(h,g,c),k=o(e,g,c),M=o(e,g,f),y=o(h,f,a),B.push(jt[l]),B.push(Ct[l])):144===l?(S=o(e,c,a),q=o(e,g,f),M=o(h,g,f),x=1-o(h,a,f),B.push(Bt[l]),B.push(_t[l])):26===l?(S=1-o(h,a,c),q=1-o(h,f,g),M=1-o(e,f,g),x=o(e,f,a),B.push(Bt[l]),B.push(_t[l])):36===l?(w=o(h,c,a),v=o(e,g,c),y=o(e,f,a),x=o(h,f,a),B.push(Jt[l]),B.push(Nt[l])):134===l?(w=1-o(e,a,c),v=1-o(h,c,g),y=1-o(h,a,f),x=1-o(e,a,f),B.push(Jt[l]),B.push(Nt[l])):9===l?(S=1-o(e,a,c),w=1-o(h,a,c),k=o(h,g,c),q=1-o(e,f,g),B.push(Bt[l]),B.push(Jt[l])):161===l?(S=o(h,c,a),w=o(e,c,a),k=1-o(e,c,g),q=o(h,g,f),B.push(Bt[l]),B.push(Jt[l])):37===l?(w=o(h,c,a),q=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a),B.push(Jt[l]),B.push(Et[l])):133===l?(w=1-o(e,a,c),q=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f),B.push(Jt[l]),B.push(Et[l])):148===l?(v=o(e,g,c),q=o(e,g,f),M=o(h,g,f),x=1-o(h,a,f),B.push(Nt[l]),B.push(_t[l])):22===l?(v=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),x=o(e,f,a),B.push(Nt[l]),B.push(_t[l])):82===l?(S=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),M=1-o(h,f,g),B.push(Bt[l]),B.push(jt[l])):88===l?(S=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),M=o(e,g,f),B.push(Bt[l]),B.push(jt[l])):73===l?(S=1-o(e,a,c),w=1-o(h,a,c),k=o(h,g,c),y=1-o(e,a,f),B.push(Bt[l]),B.push(Jt[l])):97===l?(S=o(h,c,a),w=o(e,c,a),k=1-o(e,c,g),y=o(h,f,a),B.push(Bt[l]),B.push(Jt[l])):145===l?(S=o(e,c,a),k=1-o(e,c,g),q=o(h,g,f),x=1-o(h,a,f),B.push(Bt[l]),B.push(Et[l])):25===l?(S=1-o(h,a,c),k=o(h,g,c),q=1-o(e,f,g),x=o(e,f,a),B.push(Bt[l]),B.push(Et[l])):70===l?(w=1-o(e,a,c),v=1-o(h,c,g),M=1-o(h,f,g),y=1-o(e,a,f),B.push(Jt[l]),B.push(Nt[l])):100===l?(w=o(h,c,a),v=o(e,g,c),M=o(e,g,f),y=o(h,f,a),B.push(Jt[l]),B.push(Nt[l])):34===l?(0===m?(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)):(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)),B.push(Bt[l]),B.push(Jt[l]),B.push(Et[l]),B.push(_t[l])):35===l?(4===m?(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)):(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)),B.push(Bt[l]),B.push(Jt[l]),B.push(jt[l]),B.push(_t[l])):136===l?(0===m?(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)):(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)),B.push(Bt[l]),B.push(Jt[l]),B.push(Et[l]),B.push(_t[l])):153===l?(0===m?(S=o(e,c,a),k=1-o(e,c,g),q=1-o(e,f,g),x=o(e,f,a)):(S=1-o(h,a,c),k=o(h,g,c),q=o(h,g,f),x=1-o(h,a,f)),B.push(Bt[l]),B.push(jt[l])):102===l?(0===m?(w=1-o(e,a,c),v=o(e,g,c),M=o(e,g,f),y=1-o(e,a,f)):(w=o(h,c,a),v=1-o(h,c,g),M=1-o(h,f,g),y=o(h,f,a)),B.push(Jt[l]),B.push(_t[l])):155===l?(4===m?(S=o(e,c,a),k=1-o(e,c,g),q=1-o(e,f,g),x=o(e,f,a)):(S=1-o(h,a,c),k=o(h,g,c),q=o(h,g,f),x=1-o(h,a,f)),B.push(Bt[l]),B.push(Et[l])):103===l?(4===m?(w=1-o(e,a,c),v=o(e,g,c),M=o(e,g,f),y=1-o(e,a,f)):(w=o(h,c,a),v=1-o(h,c,g),M=1-o(h,f,g),y=o(h,f,a)),B.push(Jt[l]),B.push(Nt[l])):152===l?(0===m?(S=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),x=o(e,f,a)):(S=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),x=1-o(h,a,f)),B.push(Bt[l]),B.push(Nt[l]),B.push(jt[l])):156===l?(4===m?(S=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),x=o(e,f,a)):(S=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),q=o(e,g,f),M=o(h,g,f),x=1-o(h,a,f)),B.push(Bt[l]),B.push(jt[l]),B.push(_t[l])):137===l?(0===m?(S=o(h,c,a),w=o(e,c,a),k=1-o(e,c,g),q=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)):(S=1-o(e,a,c),w=1-o(h,a,c),k=o(h,g,c),q=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)),B.push(Bt[l]),B.push(Jt[l]),B.push(jt[l])):139===l?(4===m?(S=o(h,c,a),w=o(e,c,a),k=1-o(e,c,g),q=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)):(S=1-o(e,a,c),w=1-o(h,a,c),k=o(h,g,c),q=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)),B.push(Bt[l]),B.push(Jt[l]),B.push(Et[l])):98===l?(0===m?(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),M=o(e,g,f),y=1-o(e,a,f)):(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),M=1-o(h,f,g),y=o(h,f,a)),B.push(Bt[l]),B.push(Jt[l]),B.push(_t[l])):99===l?(4===m?(S=1-o(e,a,c),w=1-o(h,a,c),v=o(h,g,c),k=o(e,g,c),M=o(e,g,f),y=1-o(e,a,f)):(S=o(h,c,a),w=o(e,c,a),v=1-o(e,c,g),k=1-o(h,c,g),M=1-o(h,f,g),y=o(h,f,a)),B.push(Bt[l]),B.push(Jt[l]),B.push(jt[l])):38===l?(0===m?(w=1-o(e,a,c),v=o(e,g,c),q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)):(w=o(h,c,a),v=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)),B.push(Jt[l]),B.push(Et[l]),B.push(_t[l])):39===l?(4===m?(w=1-o(e,a,c),v=o(e,g,c),q=o(e,g,f),M=o(h,g,f),y=1-o(h,a,f),x=1-o(e,a,f)):(w=o(h,c,a),v=1-o(h,c,g),q=1-o(h,f,g),M=1-o(e,f,g),y=o(e,f,a),x=o(h,f,a)),B.push(Jt[l]),B.push(Nt[l]),B.push(_t[l])):85===l&&(S=1,w=0,v=1,k=0,q=0,M=1,y=0,x=1),(y<0||y>1||x<0||x>1||S<0||S>1||v<0||v>1||q<0||q>1||M<0||M>1)&&console.log("MarchingSquaresJS-isoBands: "+l+" "+b+" "+f+","+a+","+c+","+g+" "+m+" "+y+" "+x+" "+S+" "+w+" "+v+" "+k+" "+q+" "+M),p.cells[i][n]={cval:l,cval_real:b,flipped:m,topleft:y,topright:x,righttop:S,rightbottom:w,bottomright:v,bottomleft:k,leftbottom:q,lefttop:M,edges:B}}}}}return p}function s(t){for(var o=[],e=t.rows,r=t.cols,s=[],p=0;p<e;p++)for(var n=0;n<r;n++)if(void 0!==t.cells[p][n]&&t.cells[p][n].edges.length>0){var l=t.cells[p][n],f=h(l),a=null,c=n,g=p;null!==f&&s.push([f.p[0]+c,f.p[1]+g]);do{if(null===(a=i(t.cells[g][c],f.x,f.y,f.o)))break;if(s.push([a.p[0]+c,a.p[1]+g]),c+=a.x,g+=a.y,f=a,g<0||g>=e||c<0||c>=r||void 0===t.cells[g][c]){c-=a.x,g-=a.y;var b=u(t,c,g,a.x,a.y,a.o);if(null===b)break;b.path.forEach(function(t){s.push(t)}),c=b.i,g=b.j,f=b}}while(void 0!==t.cells[g][c]&&t.cells[g][c].edges.length>0);o.push(s),s=[],t.cells[p][n].edges.length>0&&n--}return o}function u(t,o,e,r,s,u){for(var p=t.cells[e][o],h=p.cval_real,i=o+r,n=e+s,l=[],f=!1;!f;){if(void 0===t.cells[n]||void 0===t.cells[n][i])if(n-=s,i-=r,p=t.cells[n][i],h=p.cval_real,s===-1)if(0===u)if(h&b)l.push([i,n]),r=-1,s=0,u=0;else{if(!(h&g)){l.push([i+p.bottomright,n]),r=0,s=1,u=1,f=!0;break}l.push([i+1,n]),r=1,s=0,u=0}else{if(!(h&b)){if(h&g){l.push([i+p.bottomright,n]),r=0,s=1,u=1,f=!0;break}l.push([i+p.bottomleft,n]),r=0,s=1,u=0,f=!0;break}l.push([i,n]),r=-1,s=0,u=0}else if(1===s)if(0===u){if(!(h&c)){if(h&a){l.push([i+p.topleft,n+1]),r=0,s=-1,u=0,f=!0;break}l.push([i+p.topright,n+1]),r=0,s=-1,u=1,f=!0;break}l.push([i+1,n+1]),r=1,s=0,u=1}else l.push([i+1,n+1]),r=1,s=0,u=1;else if(r===-1)if(0===u){if(!(h&a)){if(h&b){l.push([i,n+p.leftbottom]),r=1,s=0,u=0,f=!0;break}l.push([i,n+p.lefttop]),r=1,s=0,u=1,f=!0;break}l.push([i,n+1]),r=0,s=1,u=0}else{if(!(h&a)){console.log("MarchingSquaresJS-isoBands: wtf");break}l.push([i,n+1]),r=0,s=1,u=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===u){if(!(h&g)){l.push([i+1,n+p.rightbottom]),r=-1,s=0,u=0,f=!0;break}l.push([i+1,n]),r=0,s=-1,u=1}else{if(!(h&g)){if(h&c){l.push([i+1,n+p.righttop]),r=-1,s=0,u=1;break}l.push([i+1,n+p.rightbottom]),r=-1,s=0,u=0,f=!0;break}l.push([i+1,n]),r=0,s=-1,u=1}}else if(p=t.cells[n][i],h=p.cval_real,r===-1)if(0===u)if(void 0!==t.cells[n-1]&&void 0!==t.cells[n-1][i])r=0,s=-1,u=1;else{if(!(h&b)){l.push([i+p.bottomright,n]),r=0,s=1,u=1,f=!0;break}l.push([i,n])}else{if(!(h&a)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+i+","+n);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===u){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[n+1]&&void 0!==t.cells[n+1][i])r=0,s=1,u=0;else{if(!(h&c)){l.push([i+p.topleft,n+1]),r=0,s=-1,u=0,f=!0;break}l.push([i+1,n+1]),r=1,s=0,u=1}}else if(s===-1){if(1!==u){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[n][i+1])r=1,s=0,u=1;else{if(!(h&g)){l.push([i+1,n+p.righttop]),r=-1,s=0,u=1,f=!0;break}l.push([i+1,n]),r=0,s=-1,u=1}}else{if(1!==s){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==u){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[n][i-1])r=-1,s=0,u=0;else{if(!(h&a)){l.push([i,n+p.leftbottom]),r=1,s=0,u=0,f=!0;break}l.push([i,n+1]),r=0,s=1,u=0}}if(i+=r,n+=s,i===o&&n===e)break}return{path:l,i:i,j:n,x:r,y:s,o:u}}function p(t,o){delete t.edges[o];for(var e=o+1;e<t.edges.length;e++)t.edges[e-1]=t.edges[e];t.edges.pop()}function h(t){if(t.edges.length>0){var o=t.edges[t.edges.length-1],e=t.cval_real;switch(o){case 0:return e&c?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return e&g?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return e&g?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return e&b?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return e&c?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return e&g?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return e&g?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return e&b?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return e&g?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return e&b?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return e&b?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return e&a?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return e&g?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return e&b?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return e&b?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return e&a?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return e&g?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return e&a?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return e&b?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return e&a?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return e&a?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return e&c?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return e&a?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return e&c?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function i(t,o,e,r){var s,u,h,i,n,l=t.cval;switch(o){case-1:switch(r){case 0:s=Jt[l],h=q[l],i=B[l],n=J[l];break;default:s=Bt[l],h=S[l],i=w[l],n=M[l]}break;case 1:switch(r){case 0:s=Et[l],h=F[l],i=G[l],n=H[l];break;default:s=_t[l],h=A[l],i=z[l],n=D[l]}break;default:switch(e){case-1:switch(r){case 0:s=Ct[l],h=m[l],i=d[l],n=y[l];break;default:s=Ot[l],h=x[l],i=k[l],n=v[l]}break;case 1:switch(r){case 0:s=jt[l],h=N[l],i=j[l],n=E[l];break;default:s=Nt[l],h=_[l],i=C[l],n=O[l]}}}if(u=t.edges.indexOf(s),void 0===t.edges[u])return null;switch(p(t,u),l=t.cval_real,s){case 0:l&c?(o=t.topleft,e=1):(o=1,e=t.righttop);break;case 1:l&g?(o=1,e=t.rightbottom):(o=t.topleft,e=1);break;case 2:l&g?(o=t.topleft,e=1):(o=t.bottomright,e=0);break;case 3:l&b?(o=t.bottomleft,e=0):(o=t.topleft,e=1);break;case 4:l&c?(o=t.topright,e=1):(o=1,e=t.righttop);break;case 5:l&g?(o=1,e=t.rightbottom):(o=t.topright,e=1);break;case 6:l&g?(o=t.topright,e=1):(o=t.bottomright,e=0);break;case 7:l&b?(o=t.bottomleft,e=0):(o=t.topright,e=1);break;case 8:l&g?(o=1,e=t.righttop):(o=t.bottomright,e=0);break;case 9:l&b?(o=t.bottomleft,e=0):(o=1,e=t.righttop);break;case 10:l&b?(o=1,e=t.righttop):(o=0,e=t.leftbottom);break;case 11:l&a?(o=0,e=t.lefttop):(o=1,e=t.righttop);break;case 12:l&g?(o=1,e=t.rightbottom):(o=t.bottomright,e=0);break;case 13:l&b?(o=t.bottomleft,e=0):(o=1,e=t.rightbottom);break;case 14:l&b?(o=1,e=t.rightbottom):(o=0,e=t.leftbottom);break;case 15:l&a?(o=0,e=t.lefttop):(o=1,e=t.rightbottom);break;case 16:l&g?(o=0,e=t.leftbottom):(o=t.bottomright,e=0);break;case 17:l&a?(o=0,e=t.lefttop):(o=t.bottomright,e=0);break;case 18:l&b?(o=t.bottomleft,e=0):(o=0,e=t.leftbottom);break;case 19:l&a?(o=0,e=t.lefttop):(o=t.bottomleft,e=0);break;case 20:l&a?(o=0,e=t.leftbottom):(o=t.topleft,e=1);break;case 21:l&c?(o=t.topright,e=1):(o=0,e=t.leftbottom);break;case 22:l&a?(o=0,e=t.lefttop):(o=t.topleft,e=1);break;case 23:l&c?(o=t.topright,e=1):(o=0,e=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==o&&void 0!==e&&void 0!==h&&void 0!==i&&void 0!==n||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(o+" "+e+" "+h+" "+i+" "+n)),{p:[o,e],x:h,y:i,o:n}}function n(t){var o=[],r=0;return t.cells.forEach(function(t,s){t.forEach(function(t,u){if(void 0!==t){var p=At[t.cval](t);"object"==typeof p&&e(p)?"object"==typeof p[0]&&e(p[0])?"object"==typeof p[0][0]&&e(p[0][0])?p.forEach(function(t){t.forEach(function(t){t[0]+=u,t[1]+=s}),o[r++]=t}):(p.forEach(function(t){t[0]+=u,t[1]+=s}),o[r++]=p):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),o}var l={successCallback:null,verbose:!1,polygons:!1},f={},a=64,c=16,g=4,b=1,m=[],d=[],y=[],x=[],k=[],v=[],S=[],w=[],M=[],q=[],B=[],J=[],N=[],j=[],E=[],_=[],C=[],O=[],A=[],z=[],D=[],F=[],G=[],H=[];S[85]=q[85]=-1,w[85]=B[85]=0,M[85]=J[85]=1,A[85]=F[85]=1,z[85]=G[85]=0,D[85]=H[85]=1,m[85]=x[85]=0,d[85]=k[85]=-1,y[85]=E[85]=0,_[85]=N[85]=0,C[85]=j[85]=1,v[85]=O[85]=1,F[1]=F[169]=0,G[1]=G[169]=-1,H[1]=H[169]=0,N[1]=N[169]=-1,j[1]=j[169]=0,E[1]=E[169]=0,q[4]=q[166]=0,B[4]=B[166]=-1,J[4]=J[166]=1,_[4]=_[166]=1,C[4]=C[166]=0,O[4]=O[166]=0,S[16]=S[154]=0,w[16]=w[154]=1,M[16]=M[154]=1,x[16]=x[154]=1,k[16]=k[154]=0,v[16]=v[154]=1,A[64]=A[106]=0,z[64]=z[106]=1,D[64]=D[106]=0,m[64]=m[106]=-1,d[64]=d[106]=0,y[64]=y[106]=1,A[2]=A[168]=0,z[2]=z[168]=-1,D[2]=D[168]=1,F[2]=F[168]=0,G[2]=G[168]=-1,H[2]=H[168]=0,N[2]=N[168]=-1,j[2]=j[168]=0,E[2]=E[168]=0,_[2]=_[168]=-1,C[2]=C[168]=0,O[2]=O[168]=1,S[8]=S[162]=0,w[8]=w[162]=-1,M[8]=M[162]=0,q[8]=q[162]=0,B[8]=B[162]=-1,J[8]=J[162]=1,N[8]=N[162]=1,j[8]=j[162]=0,E[8]=E[162]=1,_[8]=_[162]=1,C[8]=C[162]=0,O[8]=O[162]=0,S[32]=S[138]=0,w[32]=w[138]=1,M[32]=M[138]=1,q[32]=q[138]=0,B[32]=B[138]=1,J[32]=J[138]=0,m[32]=m[138]=1,d[32]=d[138]=0,y[32]=y[138]=0,x[32]=x[138]=1,k[32]=k[138]=0,v[32]=v[138]=1,F[128]=F[42]=0,G[128]=G[42]=1,H[128]=H[42]=1,A[128]=A[42]=0,z[128]=z[42]=1,D[128]=D[42]=0,m[128]=m[42]=-1,d[128]=d[42]=0,y[128]=y[42]=1,x[128]=x[42]=-1,k[128]=k[42]=0,v[128]=v[42]=0,q[5]=q[165]=-1,B[5]=B[165]=0,J[5]=J[165]=0,F[5]=F[165]=1,G[5]=G[165]=0,H[5]=H[165]=0,_[20]=_[150]=0,C[20]=C[150]=1,O[20]=O[150]=1,x[20]=x[150]=0,k[20]=k[150]=-1,v[20]=v[150]=1,S[80]=S[90]=-1,w[80]=w[90]=0,M[80]=M[90]=1,A[80]=A[90]=1,z[80]=z[90]=0,D[80]=D[90]=1,N[65]=N[105]=0,j[65]=j[105]=1,E[65]=E[105]=0,m[65]=m[105]=0,d[65]=d[105]=-1,y[65]=y[105]=0,S[160]=S[10]=-1,w[160]=w[10]=0,M[160]=M[10]=1,q[160]=q[10]=-1,B[160]=B[10]=0,J[160]=J[10]=0,F[160]=F[10]=1,G[160]=G[10]=0,H[160]=H[10]=0,A[160]=A[10]=1,z[160]=z[10]=0,D[160]=D[10]=1,_[130]=_[40]=0,C[130]=C[40]=1,O[130]=O[40]=1,N[130]=N[40]=0,j[130]=j[40]=1,E[130]=E[40]=0,m[130]=m[40]=0,d[130]=d[40]=-1,y[130]=y[40]=0,x[130]=x[40]=0,k[130]=k[40]=-1,v[130]=v[40]=1,q[37]=q[133]=0,B[37]=B[133]=1,J[37]=J[133]=1,F[37]=F[133]=0,G[37]=G[133]=1,H[37]=H[133]=0,m[37]=m[133]=-1,d[37]=d[133]=0,y[37]=y[133]=0,x[37]=x[133]=1,k[37]=k[133]=0,v[37]=v[133]=0,_[148]=_[22]=-1,C[148]=C[22]=0,O[148]=O[22]=0,F[148]=F[22]=0,G[148]=G[22]=-1,H[148]=H[22]=1,A[148]=A[22]=0,z[148]=z[22]=1,D[148]=D[22]=1,x[148]=x[22]=-1,k[148]=k[22]=0,v[148]=v[22]=1,S[82]=S[88]=0,w[82]=w[88]=-1,M[82]=M[88]=1,_[82]=_[88]=1,C[82]=C[88]=0,O[82]=O[88]=1,N[82]=N[88]=-1,j[82]=j[88]=0,E[82]=E[88]=1,A[82]=A[88]=0,z[82]=z[88]=-1,D[82]=D[88]=0,S[73]=S[97]=0,w[73]=w[97]=1,M[73]=M[97]=0,q[73]=q[97]=0,B[73]=B[97]=-1,J[73]=J[97]=0,N[73]=N[97]=1,j[73]=j[97]=0,E[73]=E[97]=0,m[73]=m[97]=1,d[73]=d[97]=0,y[73]=y[97]=1,S[145]=S[25]=0,w[145]=w[25]=-1,M[145]=M[25]=0,N[145]=N[25]=1,j[145]=j[25]=0,E[145]=E[25]=1,F[145]=F[25]=0,G[145]=G[25]=1,H[145]=H[25]=1,x[145]=x[25]=-1,k[145]=k[25]=0,v[145]=v[25]=0,q[70]=q[100]=0,B[70]=B[100]=1,J[70]=J[100]=0,_[70]=_[100]=-1,C[70]=C[100]=0,O[70]=O[100]=1,A[70]=A[100]=0,z[70]=z[100]=-1;D[70]=D[100]=1,m[70]=m[100]=1,d[70]=d[100]=0,y[70]=y[100]=0,q[101]=q[69]=0,B[101]=B[69]=1,J[101]=J[69]=0,m[101]=m[69]=1,d[101]=d[69]=0,y[101]=y[69]=0,F[149]=F[21]=0,G[149]=G[21]=1,H[149]=H[21]=1,x[149]=x[21]=-1,k[149]=k[21]=0,v[149]=v[21]=0,_[86]=_[84]=-1,C[86]=C[84]=0,O[86]=O[84]=1,A[86]=A[84]=0,z[86]=z[84]=-1,D[86]=D[84]=1,S[89]=S[81]=0,w[89]=w[81]=-1,M[89]=M[81]=0,N[89]=N[81]=1,j[89]=j[81]=0,E[89]=E[81]=1,S[96]=S[74]=0,w[96]=w[74]=1,M[96]=M[74]=0,q[96]=q[74]=-1,B[96]=B[74]=0,J[96]=J[74]=1,A[96]=A[74]=1,z[96]=z[74]=0,D[96]=D[74]=0,m[96]=m[74]=1,d[96]=d[74]=0,y[96]=y[74]=1,S[24]=S[146]=0,w[24]=w[146]=-1,M[24]=M[146]=1,_[24]=_[146]=1,C[24]=C[146]=0,O[24]=O[146]=1,N[24]=N[146]=0,j[24]=j[146]=1,E[24]=E[146]=1,x[24]=x[146]=0,k[24]=k[146]=-1,v[24]=v[146]=0,q[6]=q[164]=-1,B[6]=B[164]=0,J[6]=J[164]=1,_[6]=_[164]=-1,C[6]=C[164]=0,O[6]=O[164]=0,F[6]=F[164]=0,G[6]=G[164]=-1,H[6]=H[164]=1,A[6]=A[164]=1,z[6]=z[164]=0,D[6]=D[164]=0,N[129]=N[41]=0,j[129]=j[41]=1,E[129]=E[41]=1,F[129]=F[41]=0,G[129]=G[41]=1,H[129]=H[41]=0,m[129]=m[41]=-1,d[129]=d[41]=0,y[129]=y[41]=0,x[129]=x[41]=0,k[129]=k[41]=-1,v[129]=v[41]=0,_[66]=_[104]=0,C[66]=C[104]=1,O[66]=O[104]=0,N[66]=N[104]=-1,j[66]=j[104]=0,E[66]=E[104]=1,A[66]=A[104]=0,z[66]=z[104]=-1,D[66]=D[104]=0,m[66]=m[104]=0,d[66]=d[104]=-1,y[66]=y[104]=1,S[144]=S[26]=-1,w[144]=w[26]=0,M[144]=M[26]=0,F[144]=F[26]=1,G[144]=G[26]=0,H[144]=H[26]=1,A[144]=A[26]=0,z[144]=z[26]=1,D[144]=D[26]=1,x[144]=x[26]=-1,k[144]=k[26]=0,v[144]=v[26]=1,q[36]=q[134]=0,B[36]=B[134]=1,J[36]=J[134]=1,_[36]=_[134]=0,C[36]=C[134]=1,O[36]=O[134]=0,m[36]=m[134]=0,d[36]=d[134]=-1,y[36]=y[134]=1,x[36]=x[134]=1,k[36]=k[134]=0,v[36]=v[134]=0,S[9]=S[161]=-1,w[9]=w[161]=0,M[9]=M[161]=0,q[9]=q[161]=0,B[9]=B[161]=-1,J[9]=J[161]=0,N[9]=N[161]=1,j[9]=j[161]=0,E[9]=E[161]=0,F[9]=F[161]=1,G[9]=G[161]=0,H[9]=H[161]=1,S[136]=0,w[136]=1,M[136]=1,q[136]=0,B[136]=1,J[136]=0,_[136]=-1,C[136]=0,O[136]=1,N[136]=-1,j[136]=0,E[136]=0,F[136]=0,G[136]=-1,H[136]=0,A[136]=0,z[136]=-1,D[136]=1,m[136]=1,d[136]=0,y[136]=0,x[136]=1,k[136]=0,v[136]=1,S[34]=0,w[34]=-1,M[34]=0,q[34]=0,B[34]=-1,J[34]=1,_[34]=1,C[34]=0,O[34]=0,N[34]=1,j[34]=0,E[34]=1,F[34]=0,G[34]=1,H[34]=1,A[34]=0,z[34]=1,D[34]=0,m[34]=-1,d[34]=0,y[34]=1,x[34]=-1,k[34]=0,v[34]=0,S[35]=0,w[35]=1,M[35]=1,q[35]=0,B[35]=-1,J[35]=1,_[35]=1,C[35]=0,O[35]=0,N[35]=-1,j[35]=0,E[35]=0,F[35]=0,G[35]=-1,H[35]=0,A[35]=0,z[35]=1,D[35]=0,m[35]=-1,d[35]=0,y[35]=1,x[35]=1,k[35]=0,v[35]=1,S[153]=0,w[153]=1,M[153]=1,N[153]=-1;j[153]=0,E[153]=0,F[153]=0,G[153]=-1,H[153]=0,x[153]=1,k[153]=0,v[153]=1,q[102]=0,B[102]=-1,J[102]=1,_[102]=1,C[102]=0,O[102]=0,A[102]=0,z[102]=1,D[102]=0,m[102]=-1,d[102]=0,y[102]=1,S[155]=0,w[155]=-1,M[155]=0,N[155]=1,j[155]=0,E[155]=1,F[155]=0,G[155]=1,H[155]=1,x[155]=-1,k[155]=0,v[155]=0,q[103]=0,B[103]=1,J[103]=0,_[103]=-1,C[103]=0,O[103]=1,A[103]=0,z[103]=-1,D[103]=1,m[103]=1,d[103]=0,y[103]=0,S[152]=0,w[152]=1,M[152]=1,_[152]=-1,C[152]=0,O[152]=1,N[152]=-1,j[152]=0,E[152]=0,F[152]=0,G[152]=-1,H[152]=0,A[152]=0,z[152]=-1,D[152]=1,x[152]=1,k[152]=0,v[152]=1,S[156]=0,w[156]=-1,M[156]=1,_[156]=1,C[156]=0,O[156]=1,N[156]=-1,j[156]=0,E[156]=0,F[156]=0,G[156]=-1,H[156]=0,A[156]=0,z[156]=1,D[156]=1,x[156]=-1,k[156]=0,v[156]=1,S[137]=0,w[137]=1,M[137]=1,q[137]=0,B[137]=1,J[137]=0,N[137]=-1,j[137]=0,E[137]=0,F[137]=0,G[137]=-1,H[137]=0,m[137]=1,d[137]=0,y[137]=0,x[137]=1,k[137]=0,v[137]=1,S[139]=0,w[139]=1,M[139]=1,q[139]=0,B[139]=-1,J[139]=0,N[139]=1,j[139]=0,E[139]=0,F[139]=0,G[139]=1,H[139]=0,m[139]=-1,d[139]=0,y[139]=0,x[139]=1,k[139]=0,v[139]=1,S[98]=0,w[98]=-1,M[98]=0,q[98]=0,B[98]=-1,J[98]=1,_[98]=1,C[98]=0,O[98]=0,N[98]=1,j[98]=0,E[98]=1,A[98]=0,z[98]=1,D[98]=0,m[98]=-1,d[98]=0,y[98]=1,S[99]=0,w[99]=1,M[99]=0,q[99]=0,B[99]=-1,J[99]=1,_[99]=1,C[99]=0,O[99]=0,N[99]=-1,j[99]=0,E[99]=1,A[99]=0,z[99]=-1,D[99]=0,m[99]=1,d[99]=0,y[99]=1,q[38]=0,B[38]=-1,J[38]=1,_[38]=1,C[38]=0,O[38]=0,F[38]=0,G[38]=1,H[38]=1,A[38]=0,z[38]=1,D[38]=0,m[38]=-1,d[38]=0,y[38]=1,x[38]=-1,k[38]=0,v[38]=0,q[39]=0,B[39]=1,J[39]=1,_[39]=-1,C[39]=0,O[39]=0,F[39]=0,G[39]=-1,H[39]=1,A[39]=0,z[39]=1,D[39]=0,m[39]=-1,d[39]=0,y[39]=1,x[39]=1,k[39]=0,v[39]=0;var I=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},K=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},L=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},P=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Q=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},R=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},T=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},U=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},V=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},W=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},X=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Y=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Z=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},$=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},tt=function(){return[[0,0],[0,1],[1,1],[1,0]]},ot=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},et=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},rt=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},st=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},ut=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},pt=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},ht=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},it=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},nt=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},lt=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ft=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},at=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},ct=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},gt=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},bt=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},mt=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},dt=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},yt=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},xt=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},kt=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},vt=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},St=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},wt=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Mt=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},qt=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Bt=[],Jt=[],Nt=[],jt=[],Et=[],_t=[],Ct=[],Ot=[];jt[1]=Et[1]=18,jt[169]=Et[169]=18,Nt[4]=Jt[4]=12,Nt[166]=Jt[166]=12,Bt[16]=Ot[16]=4,Bt[154]=Ot[154]=4,_t[64]=Ct[64]=22,_t[106]=Ct[106]=22,Nt[2]=_t[2]=17,jt[2]=Et[2]=18,Nt[168]=_t[168]=17,jt[168]=Et[168]=18,Bt[8]=jt[8]=9,Jt[8]=Nt[8]=12,Bt[162]=jt[162]=9,Jt[162]=Nt[162]=12,Bt[32]=Ot[32]=4,Jt[32]=Ct[32]=1,Bt[138]=Ot[138]=4,Jt[138]=Ct[138]=1,Et[128]=Ot[128]=21,_t[128]=Ct[128]=22,Et[42]=Ot[42]=21,_t[42]=Ct[42]=22,Jt[5]=Et[5]=14,Jt[165]=Et[165]=14,Nt[20]=Ot[20]=6,Nt[150]=Ot[150]=6,Bt[80]=_t[80]=11,Bt[90]=_t[90]=11,jt[65]=Ct[65]=3,jt[105]=Ct[105]=3,Bt[160]=_t[160]=11,Jt[160]=Et[160]=14,Bt[10]=_t[10]=11,Jt[10]=Et[10]=14,Nt[130]=Ot[130]=6,jt[130]=Ct[130]=3,Nt[40]=Ot[40]=6,jt[40]=Ct[40]=3,Jt[101]=Ct[101]=1,Jt[69]=Ct[69]=1,Et[149]=Ot[149]=21,Et[21]=Ot[21]=21,Nt[86]=_t[86]=17,Nt[84]=_t[84]=17,Bt[89]=jt[89]=9,Bt[81]=jt[81]=9,Bt[96]=Ct[96]=0,Jt[96]=_t[96]=15,Bt[74]=Ct[74]=0,Jt[74]=_t[74]=15,Bt[24]=Nt[24]=8,jt[24]=Ot[24]=7,Bt[146]=Nt[146]=8,jt[146]=Ot[146]=7,Jt[6]=_t[6]=15,Nt[6]=Et[6]=16,Jt[164]=_t[164]=15,Nt[164]=Et[164]=16,jt[129]=Ot[129]=7,Et[129]=Ct[129]=20,jt[41]=Ot[41]=7,Et[41]=Ct[41]=20,Nt[66]=Ct[66]=2,jt[66]=_t[66]=19,Nt[104]=Ct[104]=2,jt[104]=_t[104]=19,Bt[144]=Et[144]=10,_t[144]=Ot[144]=23,Bt[26]=Et[26]=10,_t[26]=Ot[26]=23,Jt[36]=Ot[36]=5,Nt[36]=Ct[36]=2,Jt[134]=Ot[134]=5,Nt[134]=Ct[134]=2,Bt[9]=Et[9]=10,Jt[9]=jt[9]=13,Bt[161]=Et[161]=10,Jt[161]=jt[161]=13,Jt[37]=Ot[37]=5,Et[37]=Ct[37]=20,Jt[133]=Ot[133]=5,Et[133]=Ct[133]=20,Nt[148]=Et[148]=16,_t[148]=Ot[148]=23,Nt[22]=Et[22]=16,_t[22]=Ot[22]=23,Bt[82]=Nt[82]=8,jt[82]=_t[82]=19,Bt[88]=Nt[88]=8,jt[88]=_t[88]=19,Bt[73]=Ct[73]=0,Jt[73]=jt[73]=13,Bt[97]=Ct[97]=0,Jt[97]=jt[97]=13,Bt[145]=jt[145]=9,Et[145]=Ot[145]=21,Bt[25]=jt[25]=9,Et[25]=Ot[25]=21,Jt[70]=Ct[70]=1,Nt[70]=_t[70]=17,Jt[100]=Ct[100]=1,Nt[100]=_t[100]=17,Bt[34]=jt[34]=9,Jt[34]=Nt[34]=12,Et[34]=Ot[34]=21,_t[34]=Ct[34]=22,Bt[136]=Ot[136]=4,Jt[136]=Ct[136]=1,Nt[136]=_t[136]=17,jt[136]=Et[136]=18,Bt[35]=Ot[35]=4,Jt[35]=Nt[35]=12,jt[35]=Et[35]=18,_t[35]=Ct[35]=22,Bt[153]=Ot[153]=4,jt[153]=Et[153]=18,Jt[102]=Nt[102]=12,_t[102]=Ct[102]=22,Bt[155]=jt[155]=9,Et[155]=Ot[155]=23,Jt[103]=Ct[103]=1,Nt[103]=_t[103]=17,Bt[152]=Ot[152]=4,Nt[152]=_t[152]=17,jt[152]=Et[152]=18,Bt[156]=Nt[156]=8,jt[156]=Et[156]=18,_t[156]=Ot[156]=23,Bt[137]=Ot[137]=4,Jt[137]=Ct[137]=1,jt[137]=Et[137]=18,Bt[139]=Ot[139]=4,Jt[139]=jt[139]=13,Et[139]=Ct[139]=20,Bt[98]=jt[98]=9,Jt[98]=Nt[98]=12,_t[98]=Ct[98]=22,Bt[99]=Ct[99]=0,Jt[99]=Nt[99]=12,jt[99]=_t[99]=19,Jt[38]=Nt[38]=12,Et[38]=Ot[38]=21,_t[38]=Ct[38]=22,Jt[39]=Ot[39]=5,Nt[39]=Et[39]=16,_t[39]=Ct[39]=22;var At=[];return At[1]=At[169]=I,At[4]=At[166]=K,At[16]=At[154]=L,At[64]=At[106]=P,At[168]=At[2]=Q,At[162]=At[8]=R,At[138]=At[32]=T,At[42]=At[128]=U,At[5]=At[165]=V,At[20]=At[150]=W,At[80]=At[90]=X,At[65]=At[105]=Y,At[160]=At[10]=Z,At[130]=At[40]=$,At[85]=tt,At[101]=At[69]=ot,At[149]=At[21]=et,At[86]=At[84]=rt,At[89]=At[81]=st,At[96]=At[74]=ut,At[24]=At[146]=pt,At[6]=At[164]=ht,At[129]=At[41]=it,At[66]=At[104]=nt,At[144]=At[26]=lt,At[36]=At[134]=ft,At[9]=At[161]=at,At[37]=At[133]=ct,At[148]=At[22]=gt,
At[82]=At[88]=bt,At[73]=At[97]=mt,At[145]=At[25]=dt,At[70]=At[100]=yt,At[34]=function(t){return[U(t),R(t)]},At[35]=xt,At[136]=function(t){return[T(t),Q(t)]},At[153]=function(t){return[L(t),I(t)]},At[102]=function(t){return[K(t),P(t)]},At[155]=kt,At[103]=vt,At[152]=function(t){return[L(t),Q(t)]},At[156]=St,At[137]=function(t){return[T(t),I(t)]},At[139]=wt,At[98]=function(t){return[R(t),P(t)]},At[99]=Mt,At[38]=function(t){return[K(t),U(t)]},At[39]=qt,t});
},{}],147:[function(require,module,exports){
!function(t,o){"function"==typeof define&&define.amd?define([],function(){return{isoContours:o()}}):"object"==typeof module&&module.exports?module.exports={isoContours:o()}:t.MarchingSquaresJS={isoContours:o(),isoBands:t.MarchingSquaresJS?t.MarchingSquaresJS.isoBands:null}}(this,function(){function t(t,o,n){n=n?n:{};for(var r=Object.keys(s),a=0;a<r.length;a++){var l=r[a],c=n[l];c=void 0!==c&&null!==c?c:s[l],f[l]=c}f.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+o);var u=i(e(t,o));return"function"==typeof f.successCallback&&f.successCallback(u),u}function o(t,o,e){return(t-o)/(e-o)}function e(t,e){for(var n=t.length-1,r=t[0].length-1,a={rows:n,cols:r,cells:[]},l=0;l<n;++l){a.cells[l]=[];for(var i=0;i<r;++i){var c=0,s=t[l+1][i],f=t[l+1][i+1],u=t[l][i+1],h=t[l][i];if(!(isNaN(s)||isNaN(f)||isNaN(u)||isNaN(h))){c|=s>=e?8:0,c|=f>=e?4:0,c|=u>=e?2:0,c|=h>=e?1:0;var p=!1;if(5===c||10===c){var v=(s+f+u+h)/4;5===c&&v<e?(c=10,p=!0):10===c&&v<e&&(c=5,p=!0)}if(0!=c&&15!=c){var g,b,d,m;g=b=d=m=.5,1===c?(d=1-o(e,s,h),b=1-o(e,u,h)):2===c?(b=o(e,h,u),m=1-o(e,f,u)):3===c?(d=1-o(e,s,h),m=1-o(e,f,u)):4===c?(g=o(e,s,f),m=o(e,u,f)):5===c?(g=o(e,s,f),m=o(e,u,f),b=1-o(e,u,h),d=1-o(e,s,h)):6===c?(b=o(e,h,u),g=o(e,s,f)):7===c?(d=1-o(e,s,h),g=o(e,s,f)):8===c?(d=o(e,h,s),g=1-o(e,f,s)):9===c?(b=1-o(e,u,h),g=1-o(e,f,s)):10===c?(g=1-o(e,f,s),m=1-o(e,f,u),b=o(e,h,u),d=o(e,h,s)):11===c?(g=1-o(e,f,s),m=1-o(e,f,u)):12===c?(d=o(e,h,s),m=o(e,u,f)):13===c?(b=1-o(e,u,h),m=o(e,u,f)):14===c?(d=o(e,h,s),b=o(e,h,u)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+c),a.cells[l][i]={cval:c,flipped:p,top:g,right:m,bottom:b,left:d}}}}}return a}function n(t){return 5===t.cval||10===t.cval}function r(t){return 0===t.cval||15===t.cval}function a(t){r(t)||5===t.cval||10===t.cval||(t.cval=15)}function l(t,o){return"top"===o?[t.top,1]:"bottom"===o?[t.bottom,0]:"right"===o?[1,t.right]:"left"===o?[0,t.left]:void 0}function i(t){var o=[],e=0;t.rows,t.cols;return t.cells.forEach(function(a,l){a.forEach(function(a,i){if(void 0!==a&&!n(a)&&!r(a)){var s=c(t.cells,l,i),f=!1;if("mergeable"===s.info)for(var u=s.path[s.path.length-1][0],h=s.path[s.path.length-1][1],p=e-1;p>=0;p--)if(Math.abs(o[p][0][0]-u)<=1e-7&&Math.abs(o[p][0][1]-h)<=1e-7){for(var v=s.path.length-2;v>=0;--v)o[p].unshift(s.path[v]);f=!0;break}f||(o[e++]=s.path)}})}),o}function c(t,o,e){var n,r,i,c=t.length,s=[],f=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],u=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],h=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],p=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],v=(t[o][e],t[o][e]),g=v.cval,i=h[g],b=l(v,i);s.push([e+b[0],o+b[1]]),i=p[g],b=l(v,i),s.push([e+b[0],o+b[1]]),a(v);for(var d=e+f[g],m=o+u[g],S=g;d>=0&&m>=0&&m<c&&(d!=e||m!=o)&&void 0!==(v=t[m][d]);){if(0===(g=v.cval)||15===g)return{path:s,info:"mergeable"};i=p[g],n=f[g],r=u[g],5!==g&&10!==g||(5===g?v.flipped?u[S]===-1?(i="left",n=-1,r=0):(i="right",n=1,r=0):f[S]===-1&&(i="bottom",n=0,r=-1):10===g&&(v.flipped?f[S]===-1?(i="top",n=0,r=1):(i="bottom",n=0,r=-1):1===u[S]&&(i="left",n=-1,r=0))),b=l(v,i),s.push([d+b[0],m+b[1]]),a(v),d+=n,m+=r,S=g}return{path:s,info:"closed"}}var s={successCallback:null,verbose:!1},f={};return t});
},{}],148:[function(require,module,exports){
!function(o,n){"function"==typeof define&&define.amd?define(["./marchingsquares-isobands","./marchingsquares-isocontours"],n):"object"==typeof module&&module.exports?module.exports=n(require("./marchingsquares-isobands"),require("./marchingsquares-isocontours")):o.MarchingSquaresJS=n(o.MarchingSquaresJS?o.MarchingSquaresJS.isoBands:null,o.MarchingSquaresJS?o.MarchingSquaresJS.isoContours:null)}(this,function(o,n){return{isoBands:"function"==typeof o?o:"object"==typeof o&&"function"==typeof o.isoBands?o.isoBands:null,isoContours:"function"==typeof n?n:"object"==typeof n&&"function"==typeof n.isoContours?n.isoContours:null}});
},{"./marchingsquares-isobands":146,"./marchingsquares-isocontours":147}],149:[function(require,module,exports){
"use strict";function isSupported(e){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(e&&e.failIfMajorPerformanceCaveat))}function isBrowser(){return"undefined"!=typeof window&&"undefined"!=typeof document}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){return"Worker"in window}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}function isWebGLSupportedCached(e){return void 0===isWebGLSupportedCache[e]&&(isWebGLSupportedCache[e]=isWebGLSupported(e)),isWebGLSupportedCache[e]}function isWebGLSupported(e){var t=document.createElement("canvas"),r=Object.create(isSupported.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.probablySupportsContext?t.probablySupportsContext("webgl",r)||t.probablySupportsContext("experimental-webgl",r):t.supportsContext?t.supportsContext("webgl",r)||t.supportsContext("experimental-webgl",r):t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}"undefined"!=typeof module&&module.exports?module.exports=isSupported:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=isSupported);var isWebGLSupportedCache={};isSupported.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};
},{}],150:[function(require,module,exports){
"use strict";function monotoneConvexHull2D(r){var n=r.length;if(n<3){for(var o=new Array(n),e=0;e<n;++e)o[e]=e;return 2===n&&r[0][0]===r[1][0]&&r[0][1]===r[1][1]?[0]:o}for(var t=new Array(n),e=0;e<n;++e)t[e]=e;t.sort(function(n,o){var e=r[n][0]-r[o][0];return e?e:r[n][1]-r[o][1]});for(var a=[t[0],t[1]],u=[t[0],t[1]],e=2;e<n;++e){for(var l=t[e],v=r[l],f=a.length;f>1&&orient(r[a[f-2]],r[a[f-1]],v)<=0;)f-=1,a.pop();for(a.push(l),f=u.length;f>1&&orient(r[u[f-2]],r[u[f-1]],v)>=0;)f-=1,u.pop();u.push(l)}for(var o=new Array(u.length+a.length-2),i=0,e=0,h=a.length;e<h;++e)o[i++]=a[e];for(var g=u.length-2;g>0;--g)o[i++]=u[g];return o}module.exports=monotoneConvexHull2D;var orient=require("robust-orientation")[3];
},{"robust-orientation":164}],151:[function(require,module,exports){
(function (process){
function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var s=r[n];"."===s?r.splice(n,1):".."===s?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(r){return splitPathRe.exec(r).slice(1)};exports.resolve=function(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:process.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,t="/"===n.charAt(0))}return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+r||"."},exports.normalize=function(r){var t=exports.isAbsolute(r),e="/"===substr(r,-1);return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),r||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(r,function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),s=e(t.split("/")),i=Math.min(n.length,s.length),o=i,u=0;u<i;u++)if(n[u]!==s[u]){o=u;break}for(var l=[],u=o;u<n.length;u++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){var t=splitPath(r),e=t[0],n=t[1];return e||n?(n&&(n=n.substr(0,n.length-1)),e+n):"."},exports.basename=function(r,t){var e=splitPath(r)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){return splitPath(r)[3]};var substr="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};
}).call(this,require('_process'))

},{"_process":161}],152:[function(require,module,exports){
"use strict";function Buffer(t){var e;t&&t.length&&(e=t,t=e.length);var r=new Uint8Array(t||0);return e&&r.set(e),r.readUInt32LE=BufferMethods.readUInt32LE,r.writeUInt32LE=BufferMethods.writeUInt32LE,r.readInt32LE=BufferMethods.readInt32LE,r.writeInt32LE=BufferMethods.writeInt32LE,r.readFloatLE=BufferMethods.readFloatLE,r.writeFloatLE=BufferMethods.writeFloatLE,r.readDoubleLE=BufferMethods.readDoubleLE,r.writeDoubleLE=BufferMethods.writeDoubleLE,r.toString=BufferMethods.toString,r.write=BufferMethods.write,r.slice=BufferMethods.slice,r.copy=BufferMethods.copy,r._isBuffer=!0,r}function encodeString(t){for(var e,r,n=t.length,i=[],o=0;o<n;o++){if((e=t.charCodeAt(o))>55295&&e<57344){if(!r){e>56319||o+1===n?i.push(239,191,189):r=e;continue}if(e<56320){i.push(239,191,189),r=e;continue}e=r-55296<<10|e-56320|65536,r=null}else r&&(i.push(239,191,189),r=null);e<128?i.push(e):e<2048?i.push(e>>6|192,63&e|128):e<65536?i.push(e>>12|224,e>>6&63|128,63&e|128):i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return i}module.exports=Buffer;var ieee754=require("ieee754"),BufferMethods,lastStr,lastStrEncoded;BufferMethods={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return ieee754.read(this,t,!0,23,4)},readDoubleLE:function(t){return ieee754.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return ieee754.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return ieee754.write(this,t,e,!0,52,8)},toString:function(t,e,r){var n="",i="";e=e||0,r=Math.min(this.length,r||this.length);for(var o=e;o<r;o++){var u=this[o];u<=127?(n+=decodeURIComponent(i)+String.fromCharCode(u),i=""):i+="%"+u.toString(16)}return n+=decodeURIComponent(i)},write:function(t,e){for(var r=t===lastStr?lastStrEncoded:encodeString(t),n=0;n<r.length;n++)this[e+n]=r[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var r=0;r<this.length;r++)t[e+r]=this[r]}},BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE,Buffer.byteLength=function(t){return lastStr=t,lastStrEncoded=encodeString(t),lastStrEncoded.length},Buffer.isBuffer=function(t){return!(!t||!t._isBuffer)};
},{"ieee754":138}],153:[function(require,module,exports){
(function (global){
"use strict";function Pbf(t){this.buf=Buffer.isBuffer(t)?t:new Buffer(t||0),this.pos=0,this.length=this.buf.length}function readVarintRemainder(t,i){var e,r=i.buf;if(e=r[i.pos++],t+=268435456*(127&e),e<128)return t;if(e=r[i.pos++],t+=34359738368*(127&e),e<128)return t;if(e=r[i.pos++],t+=4398046511104*(127&e),e<128)return t;if(e=r[i.pos++],t+=562949953421312*(127&e),e<128)return t;if(e=r[i.pos++],t+=72057594037927940*(127&e),e<128)return t;if(e=r[i.pos++],t+=0x8000000000000000*(127&e),e<128)return t;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(t,i){i.realloc(10);for(var e=i.pos+10;t>=1;){if(i.pos>=e)throw new Error("Given varint doesn't fit into 10 bytes");var r=255&t;i.buf[i.pos++]=r|(t>=128?128:0),t/=128}}function reallocForRawMessage(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.ceil(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var s=e.pos-1;s>=t;s--)e.buf[s+r]=e.buf[s]}function writePackedVarint(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function writePackedSVarint(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function writePackedFloat(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function writePackedDouble(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function writePackedBoolean(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function writePackedFixed32(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function writePackedSFixed32(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function writePackedFixed64(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function writePackedSFixed64(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,POW_2_63=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),s=r>>3,n=this.pos;t(s,i,this),this.pos===n&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,i,e=this.buf;return i=e[this.pos++],t=127&i,i<128?t:(i=e[this.pos++],t|=(127&i)<<7,i<128?t:(i=e[this.pos++],t|=(127&i)<<14,i<128?t:(i=e[this.pos++],t|=(127&i)<<21,i<128?t:readVarintRemainder(t,this))))},readVarint64:function(){var t=this.pos,i=this.readVarint();if(i<POW_2_63)return i;for(var e=this.pos-2;255===this.buf[e];)e--;e<t&&(e=t),i=0;for(var r=0;r<e-t+1;r++){var s=127&~this.buf[t+r];i+=r<4?s<<7*r:s*Math.pow(2,7*r)}return-i-1},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=this.buf.toString("utf8",this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.slice(this.pos,t);return this.pos=t,i},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readVarint());return i},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(t){var i=7&t;if(i===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(i===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Pbf.Fixed32)this.pos+=4;else{if(i!==Pbf.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Buffer(i);this.buf.copy(e),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeUInt32LE(Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeInt32LE(Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t)>268435455)return void writeBigVarint(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var i=Buffer.byteLength(t);this.writeVarint(i),this.realloc(i),this.buf.write(t,this.pos),this.pos+=i},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);var r=this.pos-e;r>=128&&reallocForRawMessage(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,e){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(t,i){this.writeMessage(t,writePackedVarint,i)},writePackedSVarint:function(t,i){this.writeMessage(t,writePackedSVarint,i)},writePackedBoolean:function(t,i){this.writeMessage(t,writePackedBoolean,i)},writePackedFloat:function(t,i){this.writeMessage(t,writePackedFloat,i)},writePackedDouble:function(t,i){this.writeMessage(t,writePackedDouble,i)},writePackedFixed32:function(t,i){this.writeMessage(t,writePackedFixed32,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,writePackedSFixed32,i)},writePackedFixed64:function(t,i){this.writeMessage(t,writePackedFixed64,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,writePackedSFixed64,i)},writeBytesField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./buffer":152}],154:[function(require,module,exports){
"use strict";function Point(t,n){this.x=t,this.y=n}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),i=Math.sin(t),s=n*this.x-i*this.y,r=i*this.x+n*this.y;return this.x=s,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t};
},{}],155:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),_require=require("@turf/helpers"),lineString=_require.lineString,_require2=require("./util"),orientationIndex=_require2.orientationIndex,Edge=function(){function e(t,i){_classCallCheck(this,e),this.from=t,this.to=i,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return _createClass(e,[{key:"getSymetric",value:function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric}}]),_createClass(e,[{key:"deleteEdge",value:function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)}},{key:"isEqual",value:function(e){return this.from.id===e.from.id&&this.to.id===e.to.id}},{key:"toString",value:function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"}},{key:"toLineString",value:function(){return lineString([this.from.coordinates,this.to.coordinates])}},{key:"compareTo",value:function(e){return orientationIndex(e.from.coordinates,e.to.coordinates,this.to.coordinates)}}]),e}();module.exports=Edge;
},{"./util":160,"@turf/helpers":33}],156:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,o,t){return o&&e(n.prototype,o),t&&e(n,t),n}}(),_require=require("./util"),orientationIndex=_require.orientationIndex,envelopeIsEqual=_require.envelopeIsEqual,envelopeContains=_require.envelopeContains,coordinatesEqual=_require.coordinatesEqual,_require2=require("@turf/helpers"),multiPoint=_require2.multiPoint,polygon=_require2.polygon,point=_require2.point,envelope=require("@turf/envelope"),_inside=require("@turf/inside"),EdgeRing=function(){function e(){_classCallCheck(this,e),this.edges=[],this.polygon=void 0,this.envelope=void 0}return _createClass(e,[{key:"push",value:function(e){this[this.edges.length]=e,this.edges.push(e),this.polygon=this.envelope=void 0}},{key:"get",value:function(e){return this.edges[e]}},{key:"forEach",value:function(e){this.edges.forEach(e)}},{key:"map",value:function(e){return this.edges.map(e)}},{key:"some",value:function(e){return this.edges.some(e)}},{key:"isValid",value:function(){return!0}},{key:"isHole",value:function(){var e=this,n=this.edges.reduce(function(n,o,t){return o.from.coordinates[1]>e.edges[n].from.coordinates[1]&&(n=t),n},0),o=(0===n?this.length:n)-1,t=(n+1)%this.length,i=orientationIndex(this.edges[o].from.coordinates,this.edges[n].from.coordinates,this.edges[t].from.coordinates);return 0===i?this.edges[o].from.coordinates[0]>this.edges[t].from.coordinates[0]:i>0}},{key:"toMultiPoint",value:function(){return multiPoint(this.edges.map(function(e){return e.from.coordinates}))}},{key:"toPolygon",value:function(){if(this.polygon)return this.polygon;var e=this.edges.map(function(e){return e.from.coordinates});return e.push(this.edges[0].from.coordinates),this.polygon=polygon([e])}},{key:"getEnvelope",value:function(){return this.envelope?this.envelope:this.envelope=envelope(this.toPolygon())}},{key:"inside",value:function(e){return _inside(e,this.toPolygon())}},{key:"length",get:function(){return this.edges.length}}],[{key:"findEdgeRingContaining",value:function(e,n){var o=e.getEnvelope(),t=void 0,i=void 0;return n.forEach(function(n){var r=n.getEnvelope();if(i&&(t=i.getEnvelope()),!envelopeIsEqual(r,o)&&envelopeContains(r,o)){var s=e.map(function(e){return e.from.coordinates}).find(function(e){return!n.some(function(n){return coordinatesEqual(e,n.from.coordinates)})});s&&n.inside(point(s))&&(i&&!envelopeContains(t,r)||(i=n))}}),i}}]),e}();module.exports=EdgeRing;
},{"./util":160,"@turf/envelope":27,"@turf/helpers":33,"@turf/inside":36}],157:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function validateGeoJson(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Node=require("./Node"),Edge=require("./Edge"),EdgeRing=require("./EdgeRing"),_require=require("@turf/meta"),flattenEach=_require.flattenEach,coordReduce=_require.coordReduce,_require2=require("@turf/invariant"),featureOf=_require2.featureOf,Graph=function(){function e(){_classCallCheck(this,e),this.edges=[],this.nodes={}}return _createClass(e,[{key:"getNode",value:function(e){var t=Node.buildId(e),n=this.nodes[t];return n||(n=this.nodes[t]=new Node(e)),n}},{key:"addEdge",value:function(e,t){var n=new Edge(e,t),r=n.getSymetric();this.edges.push(n),this.edges.push(r)}}],[{key:"fromGeoJson",value:function(t){validateGeoJson(t);var n=new e;return flattenEach(t,function(e){featureOf(e,"LineString","Graph::fromGeoJson"),coordReduce(e,function(e,t){if(e){var r=n.getNode(e),i=n.getNode(t);n.addEdge(r,i)}return t})}),n}}]),_createClass(e,[{key:"deleteDangles",value:function(){var e=this;Object.keys(this.nodes).map(function(t){return e.nodes[t]}).forEach(function(t){return e._removeIfDangle(t)})}},{key:"_removeIfDangle",value:function(e){var t=this;if(e.innerEdges.length<=1){var n=e.getOuterEdges().map(function(e){return e.to});this.removeNode(e),n.forEach(function(e){return t._removeIfDangle(e)})}}},{key:"deleteCutEdges",value:function(){var e=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(t){t.label===t.symetric.label&&(e.removeEdge(t.symetric),e.removeEdge(t))})}},{key:"_computeNextCWEdges",value:function(e){var t=this;void 0===e?Object.keys(this.nodes).forEach(function(e){return t._computeNextCWEdges(t.nodes[e])}):e.getOuterEdges().forEach(function(t,n){e.getOuterEdge((0===n?e.getOuterEdges().length:n)-1).symetric.next=t})}},{key:"_computeNextCCWEdges",value:function(e,t){for(var n=e.getOuterEdges(),r=void 0,i=void 0,o=n.length-1;o>=0;--o){var u=n[o],a=u.symetric,s=void 0,d=void 0;u.label===t&&(s=u),a.label===t&&(d=a),s&&d&&(d&&(i=d),s&&(i&&(i.next=s,i=void 0),r||(r=s)))}i&&(i.next=r)}},{key:"_findLabeledEdgeRings",value:function(){var e=[],t=0;return this.edges.forEach(function(n){if(!(n.label>=0)){e.push(n);var r=n;do{r.label=t,r=r.next}while(!n.isEqual(r));t++}}),e}},{key:"getEdgeRings",value:function(){var e=this;this._computeNextCWEdges(),this.edges.forEach(function(e){e.label=void 0}),this._findLabeledEdgeRings().forEach(function(t){e._findIntersectionNodes(t).forEach(function(n){e._computeNextCCWEdges(n,t.label)})});var t=[];return this.edges.forEach(function(n){n.ring||t.push(e._findEdgeRing(n))}),t}},{key:"_findIntersectionNodes",value:function(e){var t=[],n=e;do{!function(){var r=0;n.from.getOuterEdges().forEach(function(t){t.label===e.label&&++r}),r>1&&t.push(n.from),n=n.next}()}while(!e.isEqual(n));return t}},{key:"_findEdgeRing",value:function(e){var t=e,n=new EdgeRing;do{n.push(t),t.ring=n,t=t.next}while(!e.isEqual(t));return n}},{key:"removeNode",value:function(e){var t=this;e.getOuterEdges().forEach(function(e){return t.removeEdge(e)}),e.innerEdges.forEach(function(e){return t.removeEdge(e)}),delete this.nodes[e.id]}},{key:"removeEdge",value:function(e){this.edges=this.edges.filter(function(t){return!t.isEqual(e)}),e.deleteEdge()}}]),e}();module.exports=Graph;
},{"./Edge":155,"./EdgeRing":156,"./Node":158,"@turf/invariant":38,"@turf/meta":63}],158:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),_require=require("./util"),orientationIndex=_require.orientationIndex,Node=function(){function e(t){_classCallCheck(this,e),this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return _createClass(e,null,[{key:"buildId",value:function(e){return e.join(",")}}]),_createClass(e,[{key:"removeInnerEdge",value:function(e){this.innerEdges=this.innerEdges.filter(function(t){return t.from.id!==e.from.id})}},{key:"removeOuterEdge",value:function(e){this.outerEdges=this.outerEdges.filter(function(t){return t.to.id!==e.to.id})}},{key:"addOuterEdge",value:function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1}},{key:"sortOuterEdges",value:function(){var e=this;this.outerEdgesSorted||(this.outerEdges.sort(function(t,o){var r=t.to,n=o.to;if(r.coordinates[0]-e.coordinates[0]>=0&&n.coordinates[0]-e.coordinates[0]<0)return 1;if(r.coordinates[0]-e.coordinates[0]<0&&n.coordinates[0]-e.coordinates[0]>=0)return-1;if(r.coordinates[0]-e.coordinates[0]==0&&n.coordinates[0]-e.coordinates[0]==0)return r.coordinates[1]-e.coordinates[1]>=0||n.coordinates[1]-e.coordinates[1]>=0?r.coordinates[1]-n.coordinates[1]:n.coordinates[1]-r.coordinates[1];var i=orientationIndex(e.coordinates,r.coordinates,n.coordinates);return i<0?1:i>0?-1:Math.pow(r.coordinates[0]-e.coordinates[0],2)+Math.pow(r.coordinates[1]-e.coordinates[1],2)-(Math.pow(n.coordinates[0]-e.coordinates[0],2)+Math.pow(n.coordinates[1]-e.coordinates[1],2))}),this.outerEdgesSorted=!0)}},{key:"getOuterEdges",value:function(){return this.sortOuterEdges(),this.outerEdges}},{key:"getOuterEdge",value:function(e){return this.sortOuterEdges(),this.outerEdges[e]}},{key:"addInnerEdge",value:function(e){this.innerEdges.push(e)}}]),e}();module.exports=Node;
},{"./util":160}],159:[function(require,module,exports){
"use strict";var Graph=require("./Graph"),EdgeRing=require("./EdgeRing"),_require=require("@turf/helpers"),featureCollection=_require.featureCollection;module.exports=function(e){var r=Graph.fromGeoJson(e);r.deleteDangles(),r.deleteCutEdges();var n=[],i=[];return r.getEdgeRings().filter(function(e){return e.isValid()}).forEach(function(e){e.isHole()?n.push(e):i.push(e)}),n.forEach(function(e){EdgeRing.findEdgeRingContaining(e,i)&&i.push(e)}),featureCollection(i.map(function(e){return e.toPolygon()}))};
},{"./EdgeRing":156,"./Graph":157,"@turf/helpers":33}],160:[function(require,module,exports){
"use strict";function orientationIndex(n,e,t){var r=e[0]-n[0],o=e[1]-n[1],i=t[0]-e[0],a=t[1]-e[1];return Math.sign(r*a-i*o)}function envelopeIsEqual(n,e){var t=n.geometry.coordinates.map(function(n){return n[0]}),r=n.geometry.coordinates.map(function(n){return n[1]}),o=e.geometry.coordinates.map(function(n){return n[0]}),i=e.geometry.coordinates.map(function(n){return n[1]});return Math.max(null,t)===Math.max(null,o)&&Math.max(null,r)===Math.max(null,i)&&Math.min(null,t)===Math.min(null,o)&&Math.min(null,r)===Math.min(null,i)}function envelopeContains(n,e){return e.geometry.coordinates[0].every(function(e){return inside(point(e),n)})}function coordinatesEqual(n,e){return n[0]===e[0]&&n[1]===e[1]}var inside=require("@turf/inside"),_require=require("@turf/helpers"),point=_require.point;module.exports={orientationIndex:orientationIndex,envelopeIsEqual:envelopeIsEqual,envelopeContains:envelopeContains,coordinatesEqual:coordinatesEqual};
},{"@turf/helpers":33,"@turf/inside":36}],161:[function(require,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)t[u-1]=arguments[u];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],162:[function(require,module,exports){
"use strict";function partialSort(a,t,r,o,p){for(r=r||0,o=o||a.length-1,p=p||defaultCompare;o>r;){if(o-r>600){var f=o-r+1,e=t-r+1,l=Math.log(f),s=.5*Math.exp(2*l/3),i=.5*Math.sqrt(l*s*(f-s)/f)*(e-f/2<0?-1:1);partialSort(a,t,Math.max(r,Math.floor(t-e*s/f+i)),Math.min(o,Math.floor(t+(f-e)*s/f+i)),p)}var n=a[t],h=r,u=o;for(swap(a,r,t),p(a[o],n)>0&&swap(a,r,o);h<u;){for(swap(a,h,u),h++,u--;p(a[h],n)<0;)h++;for(;p(a[u],n)>0;)u--}0===p(a[r],n)?swap(a,r,u):(u++,swap(a,u,o)),u<=t&&(r=u+1),t<=u&&(o=u-1)}}function swap(a,t,r){var o=a[t];a[t]=a[r],a[r]=o}function defaultCompare(a,t){return a<t?-1:a>t?1:0}module.exports=partialSort;
},{}],163:[function(require,module,exports){
"use strict";function rbush(t,i){if(!(this instanceof rbush))return new rbush(t,i);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),this.clear()}function findItem(t,i,n){if(!n)return i.indexOf(t);for(var e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function calcBBox(t,i){distBBox(t,0,t.children.length,i,t)}function distBBox(t,i,n,e,a){a||(a=createNode(null)),a.minX=1/0,a.minY=1/0,a.maxX=-(1/0),a.maxY=-(1/0);for(var r,h=i;h<n;h++)r=t.children[h],extend(a,t.leaf?e(r):r);return a}function extend(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function compareNodeMinX(t,i){return t.minX-i.minX}function compareNodeMinY(t,i){return t.minY-i.minY}function bboxArea(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function bboxMargin(t){return t.maxX-t.minX+(t.maxY-t.minY)}function enlargedArea(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function intersectionArea(t,i){var n=Math.max(t.minX,i.minX),e=Math.max(t.minY,i.minY),a=Math.min(t.maxX,i.maxX),r=Math.min(t.maxY,i.maxY);return Math.max(0,a-n)*Math.max(0,r-e)}function contains(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function intersects(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function createNode(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function multiSelect(t,i,n,e,a){for(var r,h=[i,n];h.length;)n=h.pop(),i=h.pop(),n-i<=e||(r=i+Math.ceil((n-i)/e/2)*e,quickselect(t,r,i,n,a),h.push(i,r,r,n))}module.exports=rbush;var quickselect=require("quickselect");rbush.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],e=this.toBBox;if(!intersects(t,i))return n;for(var a,r,h,o,s=[];i;){for(a=0,r=i.children.length;a<r;a++)h=i.children[a],o=i.leaf?e(h):h,intersects(t,o)&&(i.leaf?n.push(h):contains(t,o)?this._all(h,n):s.push(h));i=s.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!intersects(t,i))return!1;for(var e,a,r,h,o=[];i;){for(e=0,a=i.children.length;e<a;e++)if(r=i.children[e],h=i.leaf?n(r):r,intersects(t,h)){if(i.leaf||contains(t,h))return!0;o.push(r)}i=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var a=this.data;this.data=e,e=a}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(t,i){if(!t)return this;for(var n,e,a,r,h=this.data,o=this.toBBox(t),s=[],c=[];h||s.length;){if(h||(h=s.pop(),e=s[s.length-1],n=c.pop(),r=!0),h.leaf&&(a=findItem(t,h.children,i))!==-1)return h.children.splice(a,1),s.push(h),this._condense(s),this;r||h.leaf||!contains(h,o)?e?(n++,h=e.children[n],r=!1):h=null:(s.push(h),c.push(n),n=0,e=h,h=h.children[0])}return this},toBBox:function(t){return t},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,i,n,e){var a,r=n-i+1,h=this._maxEntries;if(r<=h)return a=createNode(t.slice(i,n+1)),calcBBox(a,this.toBBox),a;e||(e=Math.ceil(Math.log(r)/Math.log(h)),h=Math.ceil(r/Math.pow(h,e-1))),a=createNode([]),a.leaf=!1,a.height=e;var o,s,c,l,m=Math.ceil(r/h),u=m*Math.ceil(Math.sqrt(h));for(multiSelect(t,i,n,u,this.compareMinX),o=i;o<=n;o+=u)for(c=Math.min(o+u-1,n),multiSelect(t,o,c,m,this.compareMinY),s=o;s<=c;s+=m)l=Math.min(s+m-1,c),a.children.push(this._build(t,s,l,e-1));return calcBBox(a,this.toBBox),a},_chooseSubtree:function(t,i,n,e){for(var a,r,h,o,s,c,l,m;;){if(e.push(i),i.leaf||e.length-1===n)break;for(l=m=1/0,a=0,r=i.children.length;a<r;a++)h=i.children[a],s=bboxArea(h),c=enlargedArea(t,h)-s,c<m?(m=c,l=s<l?s:l,o=h):c===m&&s<l&&(l=s,o=h);i=o||i.children[0]}return i},_insert:function(t,i,n){var e=this.toBBox,a=n?t:e(t),r=[],h=this._chooseSubtree(a,this.data,i,r);for(h.children.push(t),extend(h,a);i>=0&&r[i].children.length>this._maxEntries;)this._split(r,i),i--;this._adjustParentBBoxes(a,r,i)},_split:function(t,i){var n=t[i],e=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,e);var r=this._chooseSplitIndex(n,a,e),h=createNode(n.children.splice(r,n.children.length-r));h.height=n.height,h.leaf=n.leaf,calcBBox(n,this.toBBox),calcBBox(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)},_splitRoot:function(t,i){this.data=createNode([t,i]),this.data.height=t.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){var e,a,r,h,o,s,c,l;for(s=c=1/0,e=i;e<=n-i;e++)a=distBBox(t,0,e,this.toBBox),r=distBBox(t,e,n,this.toBBox),h=intersectionArea(a,r),o=bboxArea(a)+bboxArea(r),h<s?(s=h,l=e,c=o<c?o:c):h===s&&o<c&&(c=o,l=e);return l},_chooseSplitAxis:function(t,i,n){var e=t.leaf?this.compareMinX:compareNodeMinX,a=t.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,a)&&t.children.sort(e)},_allDistMargin:function(t,i,n,e){t.children.sort(e);var a,r,h=this.toBBox,o=distBBox(t,0,i,h),s=distBBox(t,n-i,n,h),c=bboxMargin(o)+bboxMargin(s);for(a=i;a<n-i;a++)r=t.children[a],extend(o,t.leaf?h(r):r),c+=bboxMargin(o);for(a=n-i-1;a>=i;a--)r=t.children[a],extend(s,t.leaf?h(r):r),c+=bboxMargin(s);return c},_adjustParentBBoxes:function(t,i,n){for(var e=n;e>=0;e--)extend(i[e],t)},_condense:function(t){for(var i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children,i.splice(i.indexOf(t[n]),1)):this.clear():calcBBox(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};
},{"quickselect":162}],164:[function(require,module,exports){
"use strict";function cofactor(r,t){for(var n=new Array(r.length-1),e=1;e<r.length;++e)for(var o=n[e-1]=new Array(r.length-1),a=0,u=0;a<r.length;++a)a!==t&&(o[u++]=r[e][a]);return n}function matrix(r){for(var t=new Array(r),n=0;n<r;++n){t[n]=new Array(r);for(var e=0;e<r;++e)t[n][e]=["m",e,"[",r-n-1,"]"].join("")}return t}function sign(r){return 1&r?"-":""}function generateSum(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var t=r.length>>1;return["sum(",generateSum(r.slice(0,t)),",",generateSum(r.slice(t)),")"].join("")}function determinant(r){if(2===r.length)return[["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],n=0;n<r.length;++n)t.push(["scale(",generateSum(determinant(cofactor(r,n))),",",sign(n),r[0][n],")"].join(""));return t}function orientation(r){for(var t=[],n=[],e=matrix(r),o=[],a=0;a<r;++a)0==(1&a)?t.push.apply(t,determinant(cofactor(e,a))):n.push.apply(n,determinant(cofactor(e,a))),o.push("m"+a);var u=generateSum(t),i=generateSum(n),s="orientation"+r+"Exact",c=["function ",s,"(",o.join(),"){var p=",u,",n=",i,",d=sub(p,n);return d[d.length-1];};return ",s].join("");return new Function("sum","prod","scale","sub",c)(robustSum,twoProduct,robustScale,robustSubtract)}function slowOrient(r){var t=CACHED[r.length];return t||(t=CACHED[r.length]=orientation(r.length)),t.apply(void 0,r)}function generateOrientationProc(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation(CACHED.length));for(var r=[],t=["slow"],n=0;n<=NUM_EXPAND;++n)r.push("a"+n),t.push("o"+n);for(var e=["function getOrientation(",r.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;n<=NUM_EXPAND;++n)e.push("case ",n,":return o",n,"(",r.slice(0,n).join(),");");e.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(e.join(""));var o=Function.apply(void 0,t);module.exports=o.apply(void 0,[slowOrient].concat(CACHED));for(var n=0;n<=NUM_EXPAND;++n)module.exports[n]=CACHED[n]}var twoProduct=require("two-product"),robustSum=require("robust-sum"),robustScale=require("robust-scale"),robustSubtract=require("robust-subtract"),NUM_EXPAND=5,EPSILON=1.1102230246251565e-16,ERRBOUND3=(3+16*EPSILON)*EPSILON,ERRBOUND4=(7+56*EPSILON)*EPSILON,orientation3Exact=orientation(3),orientation4Exact=orientation(4),CACHED=[function(){return 0},function(){return 0},function(r,t){return t[0]-r[0]},function(r,t,n){var e,o=(r[1]-n[1])*(t[0]-n[0]),a=(r[0]-n[0])*(t[1]-n[1]),u=o-a;if(o>0){if(a<=0)return u;e=o+a}else{if(!(o<0))return u;if(a>=0)return u;e=-(o+a)}var i=ERRBOUND3*e;return u>=i||u<=-i?u:orientation3Exact(r,t,n)},function(r,t,n,e){var o=r[0]-e[0],a=t[0]-e[0],u=n[0]-e[0],i=r[1]-e[1],s=t[1]-e[1],c=n[1]-e[1],h=r[2]-e[2],l=t[2]-e[2],f=n[2]-e[2],g=a*c,p=u*s,m=u*i,E=o*c,b=o*s,v=a*i,N=h*(g-p)+l*(m-E)+f*(b-v),d=(Math.abs(g)+Math.abs(p))*Math.abs(h)+(Math.abs(m)+Math.abs(E))*Math.abs(l)+(Math.abs(b)+Math.abs(v))*Math.abs(f),A=ERRBOUND4*d;return N>A||-N>A?N:orientation4Exact(r,t,n,e)}];generateOrientationProc();
},{"robust-scale":165,"robust-subtract":166,"robust-sum":167,"two-product":184}],165:[function(require,module,exports){
"use strict";function scaleLinearExpansion(r,t){var o=r.length;if(1===o){var e=twoProduct(r[0],t);return e[0]?e:[e[1]]}var u=new Array(2*o),a=[.1,.1],n=[.1,.1],c=0;twoProduct(r[0],t,a),a[0]&&(u[c++]=a[0]);for(var i=1;i<o;++i){twoProduct(r[i],t,n);var w=a[1];twoSum(w,n[0],a),a[0]&&(u[c++]=a[0]);var s=n[1],v=a[1],d=s+v,l=d-s,m=v-l;a[1]=d,m&&(u[c++]=m)}return a[1]&&(u[c++]=a[1]),0===c&&(u[c++]=0),u.length=c,u}var twoProduct=require("two-product"),twoSum=require("two-sum");module.exports=scaleLinearExpansion;
},{"two-product":184,"two-sum":185}],166:[function(require,module,exports){
"use strict";function scalarScalar(r,t){var a=r+t,n=a-r,u=a-n,e=t-n,c=r-u,o=c+e;return o?[o,a]:[a]}function robustSubtract(r,t){var a=0|r.length,n=0|t.length;if(1===a&&1===n)return scalarScalar(r[0],-t[0]);var u,e,c=a+n,o=new Array(c),l=0,s=0,f=0,b=Math.abs,h=r[s],i=b(h),v=-t[f],S=b(v);i<S?(e=h,(s+=1)<a&&(h=r[s],i=b(h))):(e=v,(f+=1)<n&&(v=-t[f],S=b(v))),s<a&&i<S||f>=n?(u=h,(s+=1)<a&&(h=r[s],i=b(h))):(u=v,(f+=1)<n&&(v=-t[f],S=b(v)));for(var g,d,m,p,w,x=u+e,y=x-u,A=e-y,M=A,j=x;s<a&&f<n;)i<S?(u=h,(s+=1)<a&&(h=r[s],i=b(h))):(u=v,(f+=1)<n&&(v=-t[f],S=b(v))),e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g;for(;s<a;)u=h,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,(s+=1)<a&&(h=r[s]);for(;f<n;)u=v,e=M,x=u+e,y=x-u,A=e-y,A&&(o[l++]=A),g=j+x,d=g-j,m=g-d,p=x-d,w=j-m,M=w+p,j=g,(f+=1)<n&&(v=-t[f]);return M&&(o[l++]=M),j&&(o[l++]=j),l||(o[l++]=0),o.length=l,o}module.exports=robustSubtract;
},{}],167:[function(require,module,exports){
"use strict";function scalarScalar(r,a){var n=r+a,e=n-r,t=n-e,l=a-e,o=r-t,u=o+l;return u?[u,n]:[n]}function linearExpansionSum(r,a){var n=0|r.length,e=0|a.length;if(1===n&&1===e)return scalarScalar(r[0],a[0]);var t,l,o=n+e,u=new Array(o),i=0,s=0,c=0,f=Math.abs,h=r[s],v=f(h),S=a[c],g=f(S);v<g?(l=h,(s+=1)<n&&(h=r[s],v=f(h))):(l=S,(c+=1)<e&&(S=a[c],g=f(S))),s<n&&v<g||c>=e?(t=h,(s+=1)<n&&(h=r[s],v=f(h))):(t=S,(c+=1)<e&&(S=a[c],g=f(S)));for(var m,p,x,E,b,d=t+l,w=d-t,y=l-w,A=y,M=d;s<n&&c<e;)v<g?(t=h,(s+=1)<n&&(h=r[s],v=f(h))):(t=S,(c+=1)<e&&(S=a[c],g=f(S))),l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m;for(;s<n;)t=h,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,(s+=1)<n&&(h=r[s]);for(;c<e;)t=S,l=A,d=t+l,w=d-t,y=l-w,y&&(u[i++]=y),m=M+d,p=m-M,x=m-p,E=d-p,b=M-x,A=b+E,M=m,(c+=1)<e&&(S=a[c]);return A&&(u[i++]=A),M&&(u[i++]=M),i||(u[i++]=0),u.length=i,u}module.exports=linearExpansionSum;
},{}],168:[function(require,module,exports){
function isConvex(e,n){if(void 0===n&&(n=!0),3!=e.length)throw new Error("This function requires an array of three points [x,y]");return(e[1][0]-e[0][0])*(e[2][1]-e[0][1])-(e[1][1]-e[0][1])*(e[2][0]-e[0][0])>=0==n}function windingOfRing(e){for(var n=0,r=0;r<e.length-1;r++)e[r][0]<e[n][0]&&(n=r);if(isConvex([e[(n-1).modulo(e.length-1)],e[n],e[(n+1).modulo(e.length-1)]],!0))var t=1;else var t=-1;return t}function equalArrays(e,n){if(!e||!n)return!1;if(e.length!=n.length)return!1;for(var r=0,t=e.length;r<t;r++)if(e[r]instanceof Array&&n[r]instanceof Array){if(!equalArrays(e[r],n[r]))return!1}else if(e[r]!=n[r])return!1;return!0}function getUnique(e){for(var n={},r=[],t=0,o=e.length;t<o;++t)n.hasOwnProperty(e[t])||(r.push(e[t]),n[e[t]]=1);return r}function isUnique(e){for(var n={},r=1,t=0,o=e.length;t<o;++t){if(n.hasOwnProperty(e[t])){r=0;break}n[e[t]]=1}return r}var isects=require("geojson-polygon-self-intersections"),helpers=require("@turf/helpers"),within=require("@turf/within"),area=require("@turf/area"),rbush=require("rbush"),debug=require("debug")("simplepolygon"),debugAll=require("debug")("simplepolygon:all");module.exports=function(e){function n(){for(var e=[],n=0;n<c.features.length;n++)debugAll("Output ring "+n+" has parent "+c.features[n].properties.parent),c.features[n].properties.parent==-1&&e.push(n);if(debugAll("The following output ring(s) have no parent: "+e),e.length>1)for(var n=0;n<e.length;n++){for(var r=-1,t=1/0,o=0;o<c.features.length;o++)e[n]!=o&&1==within(helpers.featureCollection([helpers.point(c.features[e[n]].geometry.coordinates[0][0])]),helpers.featureCollection([c.features[o]])).features.length&&area(c.features[o])<t&&(r=o,debugAll("Ring "+e[n]+" lies within output ring "+o));c.features[e[n]].properties.parent=r,debugAll("Ring "+e[n]+" is assigned parent "+r)}}function r(){for(var e=0;e<c.features.length;e++)if(c.features[e].properties.parent==-1){var n=c.features[e].properties.winding;c.features[e].properties.netWinding=n,t(e,n)}}function t(e,n){for(var r=0;r<c.features.length;r++)if(c.features[r].properties.parent==e){var o=n+c.features[r].properties.winding;c.features[r].properties.netWinding=o,t(r,o)}}if("Feature"!=e.type)throw new Error("The input must a geojson object of type Feature");if(void 0===e.geometry||null==e.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=e.geometry.type)throw new Error("The input must be a geojson Polygon");for(var o=e.geometry.coordinates.length,i=[],g=0;g<o;g++){var s=e.geometry.coordinates[g];equalArrays(s[0],s[s.length-1])||s.push(s[0]),i.push.apply(i,s.slice(0,s.length-1))}if(!isUnique(i))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var d=i.length;debug("Processing input");var a=isects(e,function(e,n,r,t,o,i,g,s,d,a,u,l){return[e,n,r,t,o,i,g,s,d,a,u,l]}),u=a.length;if(debug("Computing self-intersections"),0==u){for(var l=[],g=0;g<o;g++)l.push(helpers.polygon([e.geometry.coordinates[g]],{parent:-1,winding:windingOfRing(e.geometry.coordinates[g])}));var c=helpers.featureCollection(l);return n(),r(),debugAll("No self-intersections found. Input rings are output rings. Computed winding numbers, net winding numbers and parents"),debug("Finishing without self-intersections"),c}for(var h=[],f=[],g=0;g<o;g++){h.push([]);for(var p=0;p<e.geometry.coordinates[g].length-1;p++)h[g].push([new PseudoVtx(e.geometry.coordinates[g][(p+1).modulo(e.geometry.coordinates[g].length-1)],1,[g,p],[g,(p+1).modulo(e.geometry.coordinates[g].length-1)],void 0)]),f.push(new Isect(e.geometry.coordinates[g][p],[g,(p-1).modulo(e.geometry.coordinates[g].length-1)],[g,p],void 0,void 0,!1,!0))}for(var g=0;g<u;g++)h[a[g][1]][a[g][2]].push(new PseudoVtx(a[g][0],a[g][5],[a[g][1],a[g][2]],[a[g][6],a[g][7]],void 0)),a[g][11]&&f.push(new Isect(a[g][0],[a[g][1],a[g][2]],[a[g][6],a[g][7]],void 0,void 0,!0,!0));for(var A=f.length,g=0;g<h.length;g++)for(var p=0;p<h[g].length;p++)h[g][p].sort(function(e,n){return e.param<n.param?-1:1});debug("Setting up pseudoVtxListByRingAndEdge and isectList"),allIsectsAsIsectRbushTreeItem=[];for(var g=0;g<A;g++)allIsectsAsIsectRbushTreeItem.push({minX:f[g].coord[0],minY:f[g].coord[1],maxX:f[g].coord[0],maxY:f[g].coord[1],index:g});var v=rbush();v.load(allIsectsAsIsectRbushTreeItem);for(var g=0;g<h.length;g++)for(var p=0;p<h[g].length;p++)for(var m=0;m<h[g][p].length;m++){var b;b=m==h[g][p].length-1?h[g][(p+1).modulo(e.geometry.coordinates[g].length-1)][0].coord:h[g][p][m+1].coord;var y=v.search({minX:b[0],minY:b[1],maxX:b[0],maxY:b[1]})[0];h[g][p][m].nxtIsectAlongEdgeIn=y.index}debug("Computing nextIsect for pseudoVtxListByRingAndEdge");for(var g=0;g<h.length;g++)for(var p=0;p<h[g].length;p++)for(var m=0;m<h[g][p].length;m++){var b=h[g][p][m].coord,y=v.search({minX:b[0],minY:b[1],maxX:b[0],maxY:b[1]})[0],x=y.index;x<d?f[x].nxtIsectAlongRingAndEdge2=h[g][p][m].nxtIsectAlongEdgeIn:equalArrays(f[x].ringAndEdge1,h[g][p][m].ringAndEdgeIn)?f[x].nxtIsectAlongRingAndEdge1=h[g][p][m].nxtIsectAlongEdgeIn:f[x].nxtIsectAlongRingAndEdge2=h[g][p][m].nxtIsectAlongEdgeIn}debug("Porting nextIsect to isectList");for(var E=[],g=0,p=0;p<o;p++){for(var I=g,m=0;m<e.geometry.coordinates[p].length-1;m++)f[g].coord[0]<f[I].coord[0]&&(I=g),g++;for(var w=f[I].nxtIsectAlongRingAndEdge2,m=0;m<f.length;m++)if(f[m].nxtIsectAlongRingAndEdge1==I||f[m].nxtIsectAlongRingAndEdge2==I){var R=m;break}var q=isConvex([f[R].coord,f[I].coord,f[w].coord],!0)?1:-1;E.push({isect:I,parent:-1,winding:q})}E.sort(function(e,n){return f[e.isect].coord>f[n.isect].coord?-1:1}),debugAll("Initial state of the queue: "+JSON.stringify(E)),debug("Setting up queue");for(var l=[];E.length>0;){var k=E.pop(),C=k.isect,W=k.parent,T=k.winding,P=l.length,O=[f[C].coord];debugAll("# Starting output ring number "+l.length+" with winding "+T+" from intersection "+C),C<d&&debugAll("This is a ring-vertex-intersections, which means this output ring does not touch existing output rings");var j=C;if(f[C].ringAndEdge1Walkable)var S=f[C].ringAndEdge1,X=f[C].nxtIsectAlongRingAndEdge1;else var S=f[C].ringAndEdge2,X=f[C].nxtIsectAlongRingAndEdge2;for(;!equalArrays(f[C].coord,f[X].coord);){debugAll("Walking from intersection "+j+" to "+X+" over ring "+S[0]+" and edge "+S[1]),O.push(f[X].coord),debugAll("Adding intersection "+X+" to current output ring");for(var Y=void 0,g=0;g<E.length;g++)if(E[g].isect==X){Y=g;break}if(void 0!=Y&&(debugAll("Removing intersection "+X+" from queue"),E.splice(Y,1)),equalArrays(S,f[X].ringAndEdge1)){if(S=f[X].ringAndEdge2,f[X].ringAndEdge2Walkable=!1,f[X].ringAndEdge1Walkable){debugAll("Adding intersection "+X+" to queue");var V={isect:X};isConvex([f[j].coord,f[X].coord,f[f[X].nxtIsectAlongRingAndEdge2].coord],1==T)?(V.parent=W,V.winding=-T):(V.parent=P,V.winding=T),E.push(V)}j=X,X=f[X].nxtIsectAlongRingAndEdge2}else{if(S=f[X].ringAndEdge1,f[X].ringAndEdge1Walkable=!1,f[X].ringAndEdge2Walkable){debugAll("Adding intersection "+X+" to queue");var V={isect:X};isConvex([f[j].coord,f[X].coord,f[f[X].nxtIsectAlongRingAndEdge1].coord],1==T)?(V.parent=W,V.winding=-T):(V.parent=P,V.winding=T),E.push(V)}j=X,X=f[X].nxtIsectAlongRingAndEdge1}debugAll("Current state of the queue: "+JSON.stringify(E))}debugAll("Walking from intersection "+j+" to "+X+" over ring "+S[0]+" and edge "+S[1]+" and closing ring"),O.push(f[X].coord),l.push(helpers.polygon([O],{index:P,parent:W,winding:T,netWinding:void 0}))}var c=helpers.featureCollection(l);return debug("Walking"),n(),debug("Determining parents"),r(),debug("Setting winding number"),debugAll("# Total of "+c.features.length+" rings"),c};var PseudoVtx=function(e,n,r,t,o){this.coord=e,this.param=n,this.ringAndEdgeIn=r,this.ringAndEdgeOut=t,this.nxtIsectAlongEdgeIn=o},Isect=function(e,n,r,t,o,i,g){this.coord=e,this.ringAndEdge1=n,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=t,this.nxtIsectAlongRingAndEdge2=o,this.ringAndEdge1Walkable=i,this.ringAndEdge2Walkable=g};Number.prototype.modulo=function(e){return(this%e+e)%e};
},{"@turf/area":169,"@turf/helpers":170,"@turf/within":174,"debug":175,"geojson-polygon-self-intersections":119,"rbush":163}],169:[function(require,module,exports){
arguments[4][7][0].apply(exports,arguments)
},{"@mapbox/geojson-area":1,"@turf/meta":173,"dup":7}],170:[function(require,module,exports){
arguments[4][43][0].apply(exports,arguments)
},{"dup":43}],171:[function(require,module,exports){
arguments[4][44][0].apply(exports,arguments)
},{"@turf/invariant":172,"dup":44}],172:[function(require,module,exports){
arguments[4][45][0].apply(exports,arguments)
},{"dup":45}],173:[function(require,module,exports){
arguments[4][46][0].apply(exports,arguments)
},{"dup":46}],174:[function(require,module,exports){
arguments[4][94][0].apply(exports,arguments)
},{"@turf/helpers":170,"@turf/inside":171,"dup":94}],175:[function(require,module,exports){
(function (process){
function useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function formatArgs(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+exports.humanize(this.diff),o){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var t=0,n=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(n=t))}),e.splice(n,0,r)}}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(e){try{null==e?exports.storage.removeItem("debug"):exports.storage.debug=e}catch(e){}}function load(){var e;try{e=exports.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}function localstorage(){try{return window.localStorage}catch(e){}}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},exports.enable(load());
}).call(this,require('_process'))

},{"./debug":176,"_process":161}],176:[function(require,module,exports){
function selectColor(e){var r,t=0;for(r in e)t=(t<<5)-t+e.charCodeAt(r),t|=0;return exports.colors[Math.abs(t)%exports.colors.length]}function createDebug(e){function r(){if(r.enabled){var e=r,t=+new Date,o=t-(prevTime||t);e.diff=o,e.prev=prevTime,e.curr=t,prevTime=t;for(var s=new Array(arguments.length),n=0;n<s.length;n++)s[n]=arguments[n];s[0]=exports.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var p=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(r,t){if("%%"===r)return r;p++;var o=exports.formatters[t];if("function"==typeof o){var n=s[p];r=o.call(e,n),s.splice(p,1),p--}return r}),exports.formatArgs.call(e,s);(r.log||exports.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=exports.enabled(e),r.useColors=exports.useColors(),r.color=selectColor(e),"function"==typeof exports.init&&exports.init(r),r}function enable(e){exports.save(e),exports.names=[],exports.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),t=r.length,o=0;o<t;o++)r[o]&&(e=r[o].replace(/\*/g,".*?"),"-"===e[0]?exports.skips.push(new RegExp("^"+e.substr(1)+"$")):exports.names.push(new RegExp("^"+e+"$")))}function disable(){exports.enable("")}function enabled(e){var r,t;for(r=0,t=exports.skips.length;r<t;r++)if(exports.skips[r].test(e))return!1;for(r=0,t=exports.names.length;r<t;r++)if(exports.names[r].test(e))return!0;return!1}function coerce(e){return e instanceof Error?e.stack||e.message:e}exports=module.exports=createDebug.debug=createDebug.default=createDebug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime;
},{"ms":177}],177:[function(require,module,exports){
function parse(e){if(e=String(e),!(e.length>100)){var r=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(r){var a=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*y;case"days":case"day":case"d":return a*d;case"hours":case"hour":case"hrs":case"hr":case"h":return a*h;case"minutes":case"minute":case"mins":case"min":case"m":return a*m;case"seconds":case"second":case"secs":case"sec":case"s":return a*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}function fmtShort(e){return e>=d?Math.round(e/d)+"d":e>=h?Math.round(e/h)+"h":e>=m?Math.round(e/m)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){return plural(e,d,"day")||plural(e,h,"hour")||plural(e,m,"minute")||plural(e,s,"second")||e+" ms"}function plural(s,e,r){if(!(s<e))return s<1.5*e?Math.floor(s/e)+" "+r:Math.ceil(s/e)+" "+r+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(s,e){e=e||{};var r=typeof s;if("string"===r&&s.length>0)return parse(s);if("number"===r&&isNaN(s)===!1)return e.long?fmtLong(s):fmtShort(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};
},{}],178:[function(require,module,exports){
"use strict";"use restrict";function dimension(e){for(var n=0,r=Math.max,t=0,o=e.length;t<o;++t)n=r(n,e[t].length);return n-1}function countVertices(e){for(var n=-1,r=Math.max,t=0,o=e.length;t<o;++t)for(var l=e[t],i=0,a=l.length;i<a;++i)n=r(n,l[i]);return n+1}function cloneCells(e){for(var n=new Array(e.length),r=0,t=e.length;r<t;++r)n[r]=e[r].slice(0);return n}function compareCells(e,n){var r=e.length,t=e.length-n.length,o=Math.min;if(t)return t;switch(r){case 0:return 0;case 1:return e[0]-n[0];case 2:var l=e[0]+e[1]-n[0]-n[1];return l?l:o(e[0],e[1])-o(n[0],n[1]);case 3:var i=e[0]+e[1],a=n[0]+n[1];if(l=i+e[2]-(a+n[2]))return l;var s=o(e[0],e[1]),u=o(n[0],n[1]),l=o(s,e[2])-o(u,n[2]);return l?l:o(s+e[2],i)-o(u+n[2],a);default:var f=e.slice(0);f.sort();var c=n.slice(0);c.sort();for(var h=0;h<r;++h)if(t=f[h]-c[h])return t;return 0}}function compareZipped(e,n){return compareCells(e[0],n[0])}function normalize(e,n){if(n){for(var r=e.length,t=new Array(r),o=0;o<r;++o)t[o]=[e[o],n[o]];t.sort(compareZipped);for(var o=0;o<r;++o)e[o]=t[o][0],n[o]=t[o][1];return e}return e.sort(compareCells),e}function unique(e){if(0===e.length)return[];for(var n=1,r=e.length,t=1;t<r;++t){var o=e[t];if(compareCells(o,e[t-1])){if(t===n){n++;continue}e[n++]=o}}return e.length=n,e}function findCell(e,n){for(var r=0,t=e.length-1,o=-1;r<=t;){var l=r+t>>1,i=compareCells(e[l],n);i<=0?(0===i&&(o=l),r=l+1):i>0&&(t=l-1)}return o}function incidence(e,n){for(var r=new Array(e.length),t=0,o=r.length;t<o;++t)r[t]=[];for(var l=[],t=0,i=n.length;t<i;++t)for(var a=n[t],s=a.length,u=1,f=1<<s;u<f;++u){l.length=bits.popCount(u);for(var c=0,h=0;h<s;++h)u&1<<h&&(l[c++]=a[h]);var p=findCell(e,l);if(!(p<0))for(;;)if(r[p++].push(t),p>=e.length||0!==compareCells(e[p],l))break}return r}function dual(e,n){if(!n)return incidence(unique(skeleton(e,0)),e,0);for(var r=new Array(n),t=0;t<n;++t)r[t]=[];for(var t=0,o=e.length;t<o;++t)for(var l=e[t],i=0,a=l.length;i<a;++i)r[l[i]].push(t);return r}function explode(e){for(var n=[],r=0,t=e.length;r<t;++r)for(var o=e[r],l=0|o.length,i=1,a=1<<l;i<a;++i){for(var s=[],u=0;u<l;++u)i>>>u&1&&s.push(o[u]);n.push(s)}return normalize(n)}function skeleton(e,n){if(n<0)return[];for(var r=[],t=(1<<n+1)-1,o=0;o<e.length;++o)for(var l=e[o],i=t;i<1<<l.length;i=bits.nextCombination(i)){for(var a=new Array(n+1),s=0,u=0;u<l.length;++u)i&1<<u&&(a[s++]=l[u]);r.push(a)}return normalize(r)}function boundary(e){for(var n=[],r=0,t=e.length;r<t;++r)for(var o=e[r],l=0,i=o.length;l<i;++l){for(var a=new Array(o.length-1),s=0,u=0;s<i;++s)s!==l&&(a[u++]=o[s]);n.push(a)}return normalize(n)}function connectedComponents_dense(e,n){for(var r=new UnionFind(n),t=0;t<e.length;++t)for(var o=e[t],l=0;l<o.length;++l)for(var i=l+1;i<o.length;++i)r.link(o[l],o[i]);for(var a=[],s=r.ranks,t=0;t<s.length;++t)s[t]=-1;for(var t=0;t<e.length;++t){var u=r.find(e[t][0]);s[u]<0?(s[u]=a.length,a.push([e[t].slice(0)])):a[s[u]].push(e[t].slice(0))}return a}function connectedComponents_sparse(e){for(var n=unique(normalize(skeleton(e,0))),r=new UnionFind(n.length),t=0;t<e.length;++t)for(var o=e[t],l=0;l<o.length;++l)for(var i=findCell(n,[o[l]]),a=l+1;a<o.length;++a)r.link(i,findCell(n,[o[a]]));for(var s=[],u=r.ranks,t=0;t<u.length;++t)u[t]=-1;for(var t=0;t<e.length;++t){var f=r.find(findCell(n,[e[t][0]]));u[f]<0?(u[f]=s.length,s.push([e[t].slice(0)])):s[u[f]].push(e[t].slice(0))}return s}function connectedComponents(e,n){return n?connectedComponents_dense(e,n):connectedComponents_sparse(e)}var bits=require("bit-twiddle"),UnionFind=require("union-find");exports.dimension=dimension,exports.countVertices=countVertices,exports.cloneCells=cloneCells,exports.compareCells=compareCells,exports.normalize=normalize,exports.unique=unique,exports.findCell=findCell,exports.incidence=incidence,exports.dual=dual,exports.explode=explode,exports.skeleton=skeleton,exports.boundary=boundary,exports.connectedComponents=connectedComponents;
},{"bit-twiddle":96,"union-find":186}],179:[function(require,module,exports){
!function(){"use strict";function n(n,e){var r=n.x-e.x,f=n.y-e.y;return r*r+f*f}function e(n,e,r){var f=e.x,t=e.y,i=r.x-f,u=r.y-t;if(0!==i||0!==u){var o=((n.x-f)*i+(n.y-t)*u)/(i*i+u*u);o>1?(f=r.x,t=r.y):o>0&&(f+=i*o,t+=u*o)}return i=n.x-f,u=n.y-t,i*i+u*u}function r(e,r){for(var f,t=e[0],i=[t],u=1,o=e.length;u<o;u++)f=e[u],n(f,t)>r&&(i.push(f),t=f);return t!==f&&i.push(f),i}function f(n,r){var f,t,i,u,o=n.length,y="undefined"!=typeof Uint8Array?Uint8Array:Array,p=new y(o),d=0,s=o-1,a=[],c=[];for(p[d]=p[s]=1;s;){for(t=0,f=d+1;f<s;f++)(i=e(n[f],n[d],n[s]))>t&&(u=f,t=i);t>r&&(p[u]=1,a.push(d,u,u,s)),s=a.pop(),d=a.pop()}for(f=0;f<o;f++)p[f]&&c.push(n[f]);return c}function t(n,e,t){var i=void 0!==e?e*e:1;return n=t?n:r(n,i),n=f(n,i)}"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module?module.exports=t:"undefined"!=typeof self?self.simplify=t:window.simplify=t}();
},{}],180:[function(require,module,exports){
"use strict";function supercluster(t){return new SuperCluster(t)}function SuperCluster(t){this.options=extend(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function createCluster(t,e,n,o,i){return{x:t,y:e,zoom:1/0,id:o,properties:i,parentId:-1,numPoints:n}}function createPointCluster(t,e){var n=t.geometry.coordinates;return{x:lngX(n[0]),y:latY(n[1]),zoom:1/0,id:e,parentId:-1}}function getClusterJSON(t){return{type:"Feature",properties:getClusterProperties(t),geometry:{type:"Point",coordinates:[xLng(t.x),yLat(t.y)]}}}function getClusterProperties(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return extend(extend({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function lngX(t){return t/360+.5}function latY(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function xLng(t){return 360*(t-.5)}function yLat(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function extend(t,e){for(var n in e)t[n]=e[n];return t}function getX(t){return t.x}function getY(t){return t.y}var kdbush=require("kdbush");module.exports=supercluster,SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n),this.points=t;var o=t.map(createPointCluster);e&&console.timeEnd(n);for(var i=this.options.maxZoom;i>=this.options.minZoom;i--){var r=+Date.now();this.trees[i+1]=kdbush(o,getX,getY,this.options.nodeSize,Float32Array),o=this._cluster(o,i),e&&console.log("z%d: %d clusters in %dms",i,o.length,+Date.now()-r)}return this.trees[this.options.minZoom]=kdbush(o,getX,getY,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var n=this.trees[this._limitZoom(e)],o=n.range(lngX(t[0]),latY(t[3]),lngX(t[2]),latY(t[1])),i=[],r=0;r<o.length;r++){var s=n.points[o[r]];i.push(s.numPoints?getClusterJSON(s):this.points[s.id])}return i},getChildren:function(t,e){for(var n=this.trees[e+1].points[t],o=this.options.radius/(this.options.extent*Math.pow(2,e)),i=this.trees[e+1].within(n.x,n.y,o),r=[],s=0;s<i.length;s++){var u=this.trees[e+1].points[i[s]];u.parentId===t&&r.push(u.numPoints?getClusterJSON(u):this.points[u.id])}return r},getLeaves:function(t,e,n,o){n=n||10,o=o||0;var i=[];return this._appendLeaves(i,t,e,n,o,0),i},getTile:function(t,e,n){var o=this.trees[this._limitZoom(t)],i=Math.pow(2,t),r=this.options.extent,s=this.options.radius,u=s/r,a=(n-u)/i,p=(n+1+u)/i,h={features:[]};return this._addTileFeatures(o.range((e-u)/i,a,(e+1+u)/i,p),o.points,e,n,i,h),0===e&&this._addTileFeatures(o.range(1-u/i,a,1,p),o.points,i,n,i,h),e===i-1&&this._addTileFeatures(o.range(0,a,u/i,p),o.points,-1,n,i,h),h.features.length?h:null},getClusterExpansionZoom:function(t,e){for(;e<this.options.maxZoom;){var n=this.getChildren(t,e);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},_appendLeaves:function(t,e,n,o,i,r){for(var s=this.getChildren(e,n),u=0;u<s.length;u++){var a=s[u].properties;if(a.cluster?r+a.point_count<=i?r+=a.point_count:r=this._appendLeaves(t,a.cluster_id,n+1,o,i,r):r<i?r++:t.push(s[u]),t.length===o)break}return r},_addTileFeatures:function(t,e,n,o,i,r){for(var s=0;s<t.length;s++){var u=e[t[s]];r.features.push({type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-o))]],tags:u.numPoints?getClusterProperties(u):this.points[u.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],o=this.options.radius/(this.options.extent*Math.pow(2,e)),i=0;i<t.length;i++){var r=t[i];if(!(r.zoom<=e)){r.zoom=e;var s=this.trees[e+1],u=s.within(r.x,r.y,o),a=r.numPoints||1,p=r.x*a,h=r.y*a,l=null;this.options.reduce&&(l=this.options.initial(),this._accumulate(l,r));for(var c=0;c<u.length;c++){var d=s.points[u[c]];if(e<d.zoom){var m=d.numPoints||1;d.zoom=e,p+=d.x*m,h+=d.y*m,a+=m,d.parentId=i,this.options.reduce&&this._accumulate(l,d)}}1===a?n.push(r):(r.parentId=i,n.push(createCluster(p/a,h/a,a,i,l)))}}return n},_accumulate:function(t,e){var n=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,n)}};
},{"kdbush":141}],181:[function(require,module,exports){
"use strict";function TinyQueue(t,i){if(!(this instanceof TinyQueue))return new TinyQueue(t,i);if(this.data=t||[],this.length=this.data.length,this.compare=i||defaultCompare,this.length>0)for(var e=this.length>>1;e>=0;e--)this._down(e)}function defaultCompare(t,i){return t<i?-1:t>i?1:0}module.exports=TinyQueue,TinyQueue.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var i=this.data,e=this.compare,h=i[t];t>0;){var n=t-1>>1,a=i[n];if(e(h,a)>=0)break;i[t]=a,t=n}i[t]=h},_down:function(t){for(var i=this.data,e=this.compare,h=this.length,n=h>>1,a=i[t];t<n;){var s=1+(t<<1),u=s+1,r=i[s];if(u<h&&e(i[u],r)<0&&(s=u,r=i[u]),e(r,a)>=0)break;i[t]=r,t=s}i[t]=a}};
},{}],182:[function(require,module,exports){
module.exports=function(r){for(var e,n,o=0,t=1,u=r.length;t<u;)e=n||r[0],n=r[t],o+=(n[0]-e[0])*(n[1]+e[1]),t++;return o>0};
},{}],183:[function(require,module,exports){
function doLinesIntersect(e,r){var t=e[0],o=e[1],n=r[0],i=r[1];return clockwise([t,n,i,t])!=clockwise([o,n,i,o])&&clockwise([t,o,n,t])!=clockwise([t,o,i,t])}function testLines(e,r){for(var t=0;t<e.length-1;t++)for(var o=[e[t],e[t+1]],n=0;n<r.length-1;n++){var i=[r[n],r[n+1]];if(doLinesIntersect(o,i))return!0}return!1}function getCoordinates(e){var r=[[[]]];switch(e.geometry.type){case"LineString":r=[[e.geometry.coordinates]];break;case"Polygon":r=[e.geometry.coordinates];break;case"MultiPolygon":r=e.geometry.coordinates}return r}var clockwise=require("turf-is-clockwise");module.exports=function(e,r){var t=getCoordinates(e),o=getCoordinates(r);return t.some(function(e){return o.some(function(r){return e.some(function(e){return r.some(function(r){return testLines(e,r)})})})})};
},{"turf-is-clockwise":182}],184:[function(require,module,exports){
"use strict";function twoProduct(t,o,r){var u=t*o,T=SPLITTER*t,P=T-t,c=T-P,e=t-c,a=SPLITTER*o,d=a-o,n=a-d,s=o-n,w=u-c*n,E=w-e*n,I=E-c*s,L=e*s-I;return r?(r[0]=L,r[1]=u,r):[L,u]}module.exports=twoProduct;var SPLITTER=+(Math.pow(2,27)+1);
},{}],185:[function(require,module,exports){
"use strict";function fastTwoSum(t,u,o){var r=t+u,s=r-t,e=r-s,a=u-s,f=t-e;return o?(o[0]=f+a,o[1]=r,o):[f+a,r]}module.exports=fastTwoSum;
},{}],186:[function(require,module,exports){
"use strict";"use restrict";function UnionFind(t){this.roots=new Array(t),this.ranks=new Array(t);for(var r=0;r<t;++r)this.roots[r]=r,this.ranks[r]=0}module.exports=UnionFind;var proto=UnionFind.prototype;Object.defineProperty(proto,"length",{get:function(){return this.roots.length}}),proto.makeSet=function(){var t=this.roots.length;return this.roots.push(t),this.ranks.push(0),t},proto.find=function(t){for(var r=t,o=this.roots;o[t]!==t;)t=o[t];for(;o[r]!==t;){var n=o[r];o[r]=t,r=n}return t},proto.link=function(t,r){var o=this.find(t),n=this.find(r);if(o!==n){var i=this.ranks,s=this.roots,e=i[o],h=i[n];e<h?s[o]=n:h<e?s[n]=o:(s[n]=o,++i[o])}};
},{}],187:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],188:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],189:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c="",a=!1,l=["{","}"];if(isArray(r)&&(a=!0,l=["[","]"]),isFunction(r)){c=" [Function"+(r.name?": "+r.name:"")+"]"}if(isRegExp(r)&&(c=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(c=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(c=" "+formatError(r)),0===o.length&&(!a||0==r.length))return l[0]+c+l[1];if(t<0)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var p;return p=a?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,a)}),e.seen.pop(),reduceToSingleString(p,c,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0;return e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(process.noDeprecation===!0)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./support/isBuffer":188,"_process":161,"inherits":187}],190:[function(require,module,exports){
module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js");
},{"./lib/vectortile.js":191,"./lib/vectortilefeature.js":192,"./lib/vectortilelayer.js":193}],191:[function(require,module,exports){
"use strict";function VectorTile(e,r){this.layers=e.readFields(readTile,{},r)}function readTile(e,r,i){if(3===e){var t=new VectorTileLayer(i,i.readVarint()+i.pos);t.length&&(r[t.name]=t)}}var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile;
},{"./vectortilelayer":193}],192:[function(require,module,exports){
"use strict";function VectorTileFeature(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?readTag(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function readTag(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[i]=a}}function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,i,a=[],o=0;o<t;o++){var n=signedArea(e[o]);0!==n&&(void 0===i&&(i=n<0),i===n<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}return r&&a.push(r),a}function signedArea(e){for(var t,r,i=0,a=0,o=e.length,n=o-1;a<o;n=a++)t=e[a],r=e[n],i+=(r.x-t.x)*(t.y+r.y);return i}var Point=require("point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,o=0,n=0,s=[];e.pos<r;){if(!a){var p=e.readVarint();i=7&p,a=p>>3}if(a--,1===i||2===i)o+=e.readSVarint(),n+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new Point(o,n));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,o=0,n=1/0,s=-(1/0),p=1/0,h=-(1/0);e.pos<t;){if(!i){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),a<n&&(n=a),a>s&&(s=a),o<p&&(p=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[n,p,s,h]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){function i(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+p)/n;e[t]=[360*(r.x+s)/n-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}var a,o,n=this.extent*Math.pow(2,r),s=this.extent*e,p=this.extent*t,h=this.loadGeometry(),u=VectorTileFeature.types[this.type];switch(this.type){case 1:var d=[];for(a=0;a<h.length;a++)d[a]=h[a][0];h=d,i(h);break;case 2:for(a=0;a<h.length;a++)i(h[a]);break;case 3:for(h=classifyRings(h),a=0;a<h.length;a++)for(o=0;o<h[a].length;o++)i(h[a][o])}1===h.length?h=h[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:h},properties:this.properties};return"id"in this&&(f.id=this.id),f};
},{"point-geometry":154}],193:[function(require,module,exports){
"use strict";function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r))}function readValueMessage(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var a=e.readVarint()>>3;t=1===a?e.readString():2===a?e.readFloat():3===a?e.readDouble():4===a?e.readVarint64():5===a?e.readVarint():6===a?e.readSVarint():7===a?e.readBoolean():null}return t}var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)};
},{"./vectortilefeature.js":192}],194:[function(require,module,exports){
function fromVectorTileJs(e){var r=[];for(var o in e.layers)r.push(prepareLayer(e.layers[o]));var t=new Pbf;return vtpb.tile.write({layers:r},t),t.finish()}function fromGeojsonVt(e){var r={};for(var o in e)r[o]=new GeoJSONWrapper(e[o].features),r[o].name=o;return fromVectorTileJs({layers:r})}function prepareLayer(e){for(var r={name:e.name||"",version:e.version||1,extent:e.extent||4096,keys:[],values:[],features:[]},o={},t={},a=0;a<e.length;a++){var n=e.feature(a);n.geometry=encodeGeometry(n.loadGeometry());var u=[];for(var s in n.properties){var i=o[s];void 0===i&&(r.keys.push(s),i=r.keys.length-1,o[s]=i);var p=wrapValue(n.properties[s]),l=t[p.key];void 0===l&&(r.values.push(p),l=r.values.length-1,t[p.key]=l),u.push(i),u.push(l)}n.tags=u,r.features.push(n)}return r}function command(e,r){return(r<<3)+(7&e)}function zigzag(e){return e<<1^e>>31}function encodeGeometry(e){for(var r=[],o=0,t=0,a=e.length,n=0;n<a;n++){var u=e[n];r.push(command(1,1));for(var s=0;s<u.length;s++){1===s&&r.push(command(2,u.length-1));var i=u[s].x-o,p=u[s].y-t;r.push(zigzag(i),zigzag(p)),o+=i,t+=p}}return r}function wrapValue(e){var r,o=typeof e;return"string"===o?r={string_value:e}:"boolean"===o?r={bool_value:e}:"number"===o?r=e%1!=0?{double_value:e}:e<0?{sint_value:e}:{uint_value:e}:(e=JSON.stringify(e),r={string_value:e}),r.key=o+":"+e,r}var Pbf=require("pbf"),vtpb=require("./vector-tile-pb"),GeoJSONWrapper=require("./lib/geojson_wrapper");module.exports=fromVectorTileJs,module.exports.fromVectorTileJs=fromVectorTileJs,module.exports.fromGeojsonVt=fromGeojsonVt,module.exports.GeoJSONWrapper=GeoJSONWrapper;
},{"./lib/geojson_wrapper":195,"./vector-tile-pb":196,"pbf":153}],195:[function(require,module,exports){
"use strict";function GeoJSONWrapper(e){this.features=e,this.length=e.length}function FeatureWrapper(e){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=4096}var Point=require("point-geometry"),VectorTileFeature=require("vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e])},FeatureWrapper.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],a=0;a<r.length;a++)o.push(new Point(r[a][0],r[a][1]));this.geometry.push(o)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-(1/0),o=1/0,a=-(1/0),i=0;i<e.length;i++)for(var p=e[i],n=0;n<p.length;n++){var h=p[n];t=Math.min(t,h.x),r=Math.max(r,h.x),o=Math.min(o,h.y),a=Math.max(a,h.y)}return[t,o,r,a]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON;
},{"point-geometry":154,"vector-tile":190}],196:[function(require,module,exports){
"use strict";function readTile(e,r){return e.readFields(readTileField,{layers:[]},r)}function readTileField(e,r,i){3===e&&r.layers.push(readLayer(i,i.readVarint()+i.pos))}function writeTile(e,r){var i;if(void 0!==e.layers)for(i=0;i<e.layers.length;i++)r.writeMessage(3,writeLayer,e.layers[i])}function readValue(e,r){return e.readFields(readValueField,{},r)}function readValueField(e,r,i){1===e?r.string_value=i.readString():2===e?r.float_value=i.readFloat():3===e?r.double_value=i.readDouble():4===e?r.int_value=i.readVarint():5===e?r.uint_value=i.readVarint():6===e?r.sint_value=i.readSVarint():7===e&&(r.bool_value=i.readBoolean())}function writeValue(e,r){void 0!==e.string_value&&r.writeStringField(1,e.string_value),void 0!==e.float_value&&r.writeFloatField(2,e.float_value),void 0!==e.double_value&&r.writeDoubleField(3,e.double_value),void 0!==e.int_value&&r.writeVarintField(4,e.int_value),void 0!==e.uint_value&&r.writeVarintField(5,e.uint_value),void 0!==e.sint_value&&r.writeSVarintField(6,e.sint_value),void 0!==e.bool_value&&r.writeBooleanField(7,e.bool_value)}function readFeature(e,r){var i=e.readFields(readFeatureField,{},r);return void 0===i.type&&(i.type="Unknown"),i}function readFeatureField(e,r,i){1===e?r.id=i.readVarint():2===e?r.tags=i.readPackedVarint():3===e?r.type=i.readVarint():4===e&&(r.geometry=i.readPackedVarint())}function writeFeature(e,r){void 0!==e.id&&r.writeVarintField(1,e.id),void 0!==e.tags&&r.writePackedVarint(2,e.tags),void 0!==e.type&&r.writeVarintField(3,e.type),void 0!==e.geometry&&r.writePackedVarint(4,e.geometry)}function readLayer(e,r){return e.readFields(readLayerField,{features:[],keys:[],values:[]},r)}function readLayerField(e,r,i){15===e?r.version=i.readVarint():1===e?r.name=i.readString():2===e?r.features.push(readFeature(i,i.readVarint()+i.pos)):3===e?r.keys.push(i.readString()):4===e?r.values.push(readValue(i,i.readVarint()+i.pos)):5===e&&(r.extent=i.readVarint())}function writeLayer(e,r){void 0!==e.version&&r.writeVarintField(15,e.version),void 0!==e.name&&r.writeStringField(1,e.name);var i;if(void 0!==e.features)for(i=0;i<e.features.length;i++)r.writeMessage(2,writeFeature,e.features[i]);if(void 0!==e.keys)for(i=0;i<e.keys.length;i++)r.writeStringField(3,e.keys[i]);if(void 0!==e.values)for(i=0;i<e.values.length;i++)r.writeMessage(4,writeValue,e.values[i]);void 0!==e.extent&&r.writeVarintField(5,e.extent)}var tile=exports.tile={read:readTile,write:writeTile};tile.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},tile.value={read:readValue,write:writeValue},tile.feature={read:readFeature,write:writeFeature},tile.layer={read:readLayer,write:writeLayer};
},{}],197:[function(require,module,exports){
var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(r,e){function t(r){d[r]=!0;for(var e in sources[r][1]){var n=sources[r][1][e];d[n]||t(n)}}for(var n,o=Object.keys(cache),a=0,i=o.length;a<i;a++){var s=o[a],u=cache[s].exports;if(u===r||u&&u.default===r){n=s;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},a=0,i=o.length;a<i;a++){var s=o[a];f[s]=s}sources[n]=[Function(["require","module","exports"],"("+r+")(self)"),f]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),l={};l[n]=n,sources[c]=[Function(["require"],"var f = require("+stringify(n)+");(f.default ? f.default : f)(self);"),l];var d={};t(c);var g="("+bundleFn+")({"+Object.keys(d).map(function(r){return stringify(r)+":["+sources[r][0]+","+stringify(sources[r][1])+"]"}).join(",")+"},{},["+stringify(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,w=new Blob([g],{type:"text/javascript"});if(e&&e.bare)return w;var h=v.createObjectURL(w),b=new Worker(h);return b.objectURL=h,b};
},{}],198:[function(require,module,exports){
module.exports.RADIUS=6378137,module.exports.FLATTENING=1/298.257223563,module.exports.POLAR_RADIUS=6356752.3142;
},{}],199:[function(require,module,exports){
module.exports={"version":"0.1.3"}
},{}],200:[function(require,module,exports){
"use strict";function serializePaintVertexArrays(r,e){var t={};for(var a in r){var i=r[a].paintVertexArray;if(0!==i.length){var n=i.serialize(e),s=i.constructor.serialize();t[a]={array:n,type:s}}}return t}var ProgramConfiguration=require("./program_configuration"),Segment=function(r,e){this.vertexOffset=r,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},ArrayGroup=function(r,e,t){var a=this;this.globalProperties={zoom:t};var i=r.layoutVertexArrayType;this.layoutVertexArray=new i;var n=r.elementArrayType;n&&(this.elementArray=new n);var s=r.elementArrayType2;s&&(this.elementArray2=new s),this.layerData={};for(var y=0,o=e;y<o.length;y+=1){var p=o[y],l=ProgramConfiguration.createDynamic(r.paintAttributes||[],p,t);a.layerData[p.id]={layer:p,programConfiguration:l,paintVertexArray:new l.PaintVertexArray,paintPropertyStatistics:l.createPaintPropertyStatistics()}}this.segments=[],this.segments2=[]};ArrayGroup.prototype.prepareSegment=function(r){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+r>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH)&&(e=new Segment(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},ArrayGroup.prototype.prepareSegment2=function(r){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+r>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH)&&(e=new Segment(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},ArrayGroup.prototype.populatePaintArrays=function(r){var e=this;for(var t in e.layerData){var a=e.layerData[t];0!==a.paintVertexArray.bytesPerElement&&a.programConfiguration.populatePaintArray(a.layer,a.paintVertexArray,a.paintPropertyStatistics,e.layoutVertexArray.length,e.globalProperties,r)}},ArrayGroup.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ArrayGroup.prototype.serialize=function(r){return{layoutVertexArray:this.layoutVertexArray.serialize(r),elementArray:this.elementArray&&this.elementArray.serialize(r),elementArray2:this.elementArray2&&this.elementArray2.serialize(r),paintVertexArrays:serializePaintVertexArrays(this.layerData,r),segments:this.segments,segments2:this.segments2}},ArrayGroup.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,module.exports=ArrayGroup;
},{"./program_configuration":221}],201:[function(require,module,exports){
"use strict";var ArrayGroup=require("./array_group"),BufferGroup=require("./buffer_group"),util=require("../util/util"),Bucket=function(r,t){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.index=r.index,r.arrays?this.buffers=new BufferGroup(t,r.layers,r.zoom,r.arrays):this.arrays=new ArrayGroup(t,r.layers,r.zoom)};Bucket.prototype.populate=function(r,t){for(var e=this,i=0,a=r;i<a.length;i+=1){var u=a[i];e.layers[0].filter(u)&&(e.addFeature(u),t.featureIndex.insert(u,e.index))}},Bucket.prototype.getPaintPropertyStatistics=function(){return util.mapObject(this.arrays.layerData,function(r){return r.paintPropertyStatistics})},Bucket.prototype.isEmpty=function(){return this.arrays.isEmpty()},Bucket.prototype.serialize=function(r){return{zoom:this.zoom,layerIds:this.layers.map(function(r){return r.id}),arrays:this.arrays.serialize(r)}},Bucket.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},module.exports=Bucket,Bucket.deserialize=function(r,t){if(t){for(var e={},i=0,a=r;i<a.length;i+=1){var u=a[i],o=u.layerIds.map(function(r){return t.getLayer(r)}).filter(Boolean);if(0!==o.length)for(var s=o[0].createBucket(util.extend({layers:o},u)),n=0,f=o;n<f.length;n+=1){var y=f[n];e[y.id]=s}}return e}};
},{"../util/util":399,"./array_group":200,"./buffer_group":215}],202:[function(require,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,p){e.emplaceBack(t.x<<1|i,t.y<<1|a,h_seq,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(p*LINE_DISTANCE_SCALE&63)<<2,p*LINE_DISTANCE_SCALE>>6,seq,_count)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),h_seq=0,seq=0,_count=0,EXTRUDE_SCALE=63,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,airlineInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:2,type:"Uint16"}]),paintAttributes:[{property:"airline-color",type:"Uint8"},{property:"airline-blur",multiplier:10,type:"Uint8"},{property:"airline-opacity",multiplier:10,type:"Uint8"},{property:"airline-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"airline-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()},AirlineBucket=function(e){function t(t){e.call(this,t,airlineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=r["airline-join"],a=r["airline-cap"];seq=e.properties.link_seq,_count=e.properties.total;for(var n=0,p=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);n<p.length;n+=1){var s=p[n];t.addLine(s,e,i,a)}},t.prototype.addLine=function(e,t,r,i){for(var a=this,n=t.properties,p=e.length;p>=2&&e[p-1].equals(e[p-2]);)p--;var s=this.arrays,o=s.prepareSegment(10*p);this.distance=0;var _,y,h,l,u;this.e1=this.e2=this.e3=-1;for(var c=0;c<p;c++){h_seq=0===c?10*t.properties.start_height:10*t.properties.end_height,h=e[c+1],u&&(l=u),_&&(y=_),_=e[c],u=h?h.sub(_)._unit()._perp():l,l=l||u;var E=l.add(u);0===E.x&&0===E.y||E._unit();var d=E.x*u.x+E.y*u.y,m=0!==d?1/d:1/0;y&&(a.distance+=_.dist(y)),E._mult(m),a.addCurrentVertex(_,a.distance,E,0,0,!1,o),!1}s.populatePaintArrays(n)},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,p){var s,o=n?1:0,_=this.arrays,y=_.layoutVertexArray,h=_.elementArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),addLineVertex(y,e,s,o,0,i,t),this.e3=p.vertexLength++,this.e1>=0&&this.e2>=0&&(h.emplaceBack(this.e1,this.e2,this.e3),p.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),a&&s._sub(r.perp()._mult(a)),addLineVertex(y,e,s,o,1,-a,t),this.e3=p.vertexLength++,this.e1>=0&&this.e2>=0&&(h.emplaceBack(this.e1,this.e2,this.e3),p.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,p))},t}(Bucket);AirlineBucket.programInterface=airlineInterface,module.exports=AirlineBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223}],203:[function(require,module,exports){
"use strict";function addCircleVertex(e,r,t,a,c){e.emplaceBack(2*r+(a+1)/2,2*t+(c+1)/2)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),circleInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},CircleBucket=function(e){function r(r){e.call(this,r,circleInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=loadGeometry(e);t<a.length;t+=1)for(var c=a[t],p=0,i=c;p<i.length;p+=1){var l=i[p],y=l.x,o=l.y;if(!(y<0||y>=EXTENT||o<0||o>=EXTENT)){var n=r.prepareSegment(4),u=n.vertexLength;addCircleVertex(r.layoutVertexArray,y,o,-1,-1),addCircleVertex(r.layoutVertexArray,y,o,1,-1),addCircleVertex(r.layoutVertexArray,y,o,1,1),addCircleVertex(r.layoutVertexArray,y,o,-1,1),r.elementArray.emplaceBack(u,u+1,u+2),r.elementArray.emplaceBack(u,u+3,u+2),n.vertexLength+=4,n.primitiveLength+=2}}r.populatePaintArrays(e.properties)},r}(Bucket);CircleBucket.programInterface=circleInterface,module.exports=CircleBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223}],204:[function(require,module,exports){
"use strict";function addVertex(e,r,t,a,o,n,y,c,p,l,i){e.emplaceBack(r,t,a,o,n,y,c,p,Math.round(i))}function isBoundaryEdge(e,r){return e.x<0||e.x>EXTENT||e.y<0||e.y>EXTENT}function dealDifference(e,r,t,a,o,n){if(e){for(var y=[],c=0;c<n.length;c+=3){var p=n.slice(c,c+3),l=(p[0]-e.oriLng)/e.dLng,i=(p[1]-e.oriLat)/e.dLat,u=[parseInt(r*l+a),parseInt(t*i+o),p[2]-50];y.push(u)}return y}}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),earcut=require("earcut"),classifyRings=require("../../util/classify_rings"),EARCUT_MAX_RINGS=500,count=0,colladaInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:3,type:"Int16"},{name:"a_texture",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:createElementArrayType(3),paintAttributes:[{property:"collada-base",type:"Uint16"},{property:"collada-height",type:"Uint16"},{property:"collada-color",type:"Uint8"}]},FACTOR=Math.pow(2,13),ColladaBucket=function(e){function r(r){e.call(this,r,colladaInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){var r=this.arrays,t=e.properties;if(e.loadGeometry(),e.geometry&&!(e.geometry[0].length>=3)){var a=r.prepareSegment(65535),o=e.geometry[0][1].x-e.geometry[0][0].x,n=e.geometry[0][1].y-e.geometry[0][0].y;if(!isBoundaryEdge(e.geometry[0][0],e.geometry[0][1])){for(var y=e.geometry[0][0].x,c=e.geometry[0][0].y,p=dealDifference(t.difference,o,n,y,c,t.vertices),l=0;l<p.length;l++){var i=p[l],u=t.uvs.slice(2*l,2*l+2),s=t.normals.slice(3*l,3*l+3);addVertex(r.layoutVertexArray,i[0],i[1],i[2],1e3*u[0],1e3*u[1],100*s[0],100*s[1],100*s[2],1,0)}a.materials=t.materials,r.populatePaintArrays(e.properties)}}},r}(Bucket);ColladaBucket.programInterface=colladaInterface,module.exports=ColladaBucket;
},{"../../util/classify_rings":375,"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"earcut":107}],205:[function(require,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,d){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(d*LINE_DISTANCE_SCALE&63)<<2,d*LINE_DISTANCE_SCALE>>6,seq,total,offset)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),seq=0,total=0,offset=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,dynamicLineInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}]),paintAttributes:[{property:"dynamicLine-color",type:"Uint8"},{property:"dynamicLine-blur",multiplier:10,type:"Uint8"},{property:"dynamicLine-opacity",multiplier:10,type:"Uint8"},{property:"dynamicLine-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"dynamicLine-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()},DynamicLineBucket=function(e){function t(t){e.call(this,t,dynamicLineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=r["dynamicLine-join"],a=r["dynamicLine-cap"],n=r["dynamicLine-miter-limit"],d=r["dynamicLine-round-limit"];seq=e.properties.link_seq,total=e.properties.total_link_count,offset=e.properties.offset_link_count;for(var s=0,o=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);s<o.length;s+=1){var u=o[s];t.addLine(u,e.properties,i,a,n,d)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var d=this,s=e.length;s>2&&e[s-1].equals(e[s-2]);)s--;if(!(e.length<2)){"bevel"===r&&(a=1.05);var o=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),u=e[0],p=e[s-1],c=u.equals(p),l=this.arrays,y=l.prepareSegment(10*s);if(2!==s||!c){this.distance=0;var _,m,h,E,x,f,L,C=i,v=c?"butt":i,A=!0;this.e1=this.e2=this.e3=-1,c&&(_=e[s-2],x=u.sub(_)._unit()._perp());for(var S=0;S<s;S++)if(seq++,!(h=c&&S===s-1?e[1]:e[S+1])||!e[S].equals(h)){x&&(E=x),_&&(m=_),_=e[S],x=h?h.sub(_)._unit()._perp():E,E=E||x;var V=E.add(x)._unit(),T=V.x*x.x+V.y*x.y,I=1/T,N=T<COS_HALF_SHARP_CORNER&&m&&h;if(N&&S>0){var b=_.dist(m);if(b>2*o){var R=_.sub(_.sub(m)._mult(o/b)._round());d.distance+=R.dist(m),d.addCurrentVertex(R,d.distance,E.mult(1),0,0,!1,y),m=R}}var g=m&&h,q=g?r:h?C:v;if(g&&"round"===q&&(I<n?q="miter":I<=2&&(q="fakeround")),"miter"===q&&I>a&&(q="bevel"),"bevel"===q&&(I>2&&(q="flipbevel"),I<a&&(q="miter")),m&&(d.distance+=_.dist(m)),"miter"===q)V._mult(I),d.addCurrentVertex(_,d.distance,V,0,0,!1,y);else if("flipbevel"===q){if(I>100)V=x.clone();else{var k=E.x*x.y-E.y*x.x>0?-1:1,B=I*E.add(x).mag()/E.sub(x).mag();V._perp()._mult(B*k)}d.addCurrentVertex(_,d.distance,V,0,0,!1,y),d.addCurrentVertex(_,d.distance,V.mult(-1),0,0,!1,y)}else if("bevel"===q||"fakeround"===q){var D=E.x*x.y-E.y*x.x>0,F=-Math.sqrt(I*I-1);if(D?(L=0,f=F):(f=0,L=F),A||d.addCurrentVertex(_,d.distance,E,f,L,!1,y),"fakeround"===q){for(var U=Math.floor(8*(.5-(T-.5))),P=void 0,M=0;M<U;M++)P=x.mult((M+1)/(U+1))._add(E)._unit(),d.addPieSliceVertex(_,d.distance,P,D,y);d.addPieSliceVertex(_,d.distance,V,D,y);for(var O=U-1;O>=0;O--)P=E.mult((O+1)/(U+1))._add(x)._unit(),d.addPieSliceVertex(_,d.distance,P,D,y)}h&&d.addCurrentVertex(_,d.distance,x,-f,-L,!1,y)}else"butt"===q?(A||d.addCurrentVertex(_,d.distance,E,0,0,!1,y),h&&d.addCurrentVertex(_,d.distance,x,0,0,!1,y)):"square"===q?(A||(d.addCurrentVertex(_,d.distance,E,1,1,!1,y),d.e1=d.e2=-1),h&&d.addCurrentVertex(_,d.distance,x,-1,-1,!1,y)):"round"===q&&(A||(d.addCurrentVertex(_,d.distance,E,0,0,!1,y),d.addCurrentVertex(_,d.distance,E,1,1,!0,y),d.e1=d.e2=-1),h&&(d.addCurrentVertex(_,d.distance,x,-1,-1,!0,y),d.addCurrentVertex(_,d.distance,x,0,0,!1,y)));if(N&&S<s-1){var X=_.dist(h);if(X>2*o){var H=_.add(h.sub(_)._mult(o/X)._round());d.distance+=H.dist(_),d.addCurrentVertex(H,d.distance,x.mult(1),0,0,!1,y),_=H}}A=!1}l.populatePaintArrays(t)}}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,d){var s,o=n?1:0,u=this.arrays,p=u.layoutVertexArray,c=u.elementArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),addLineVertex(p,e,s,o,0,i,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),a&&s._sub(r.perp()._mult(a)),addLineVertex(p,e,s,o,1,-a,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,d))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var d=this.arrays,s=d.layoutVertexArray,o=d.elementArray;addLineVertex(s,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);module.exports=DynamicLineBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223}],206:[function(require,module,exports){
"use strict";function addVertex(e,r,t,a,n,o,y,p){e.emplaceBack(r,t,2*Math.floor(a*FACTOR)+y,n*FACTOR*2,o*FACTOR*2,Math.round(p))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),earcut=require("earcut"),classifyRings=require("../../util/classify_rings"),EARCUT_MAX_RINGS=500,extrusionInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:createElementArrayType(3),paintAttributes:[{property:"extrusion-base",type:"Uint16"},{property:"extrusion-height",type:"Uint16"},{property:"extrusion-color",type:"Uint8"}]},FACTOR=Math.pow(2,13),ExtrusionBucket=function(e){function r(r){e.call(this,r,extrusionInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);t<a.length;t+=1){for(var n=a[t],o=0,y=0,p=n;y<p.length;y+=1){o+=p[y].length}for(var u=r.prepareSegment(5*o),i=[],c=[],x=[],s=0,l=n;s<l.length;s+=1){var d=l[s];if(0!==d.length){d!==n[0]&&c.push(i.length/2);for(var m=0,h=0;h<d.length;h++){var g=d[h];if(addVertex(r.layoutVertexArray,g.x,g.y,0,0,1,1,0),x.push(u.vertexLength++),h>=1){var A=d[h-1];if(!isBoundaryEdge(g,A)){var f=g.sub(A)._perp()._unit();addVertex(r.layoutVertexArray,g.x,g.y,f.x,f.y,0,0,m),addVertex(r.layoutVertexArray,g.x,g.y,f.x,f.y,0,1,m),m+=A.dist(g),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,0,m),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,1,m);var _=u.vertexLength;r.elementArray.emplaceBack(_,_+1,_+2),r.elementArray.emplaceBack(_+1,_+2,_+3),u.vertexLength+=4,u.primitiveLength+=2}}i.push(g.x),i.push(g.y)}}}for(var T=earcut(i,c),v=0;v<T.length;v+=3)r.elementArray.emplaceBack(x[T[v]],x[T[v+1]],x[T[v+2]]);u.primitiveLength+=T.length/3}r.populatePaintArrays(e.properties)},r}(Bucket);ExtrusionBucket.programInterface=extrusionInterface,module.exports=ExtrusionBucket;
},{"../../util/classify_rings":375,"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"earcut":107}],207:[function(require,module,exports){
"use strict";var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),earcut=require("earcut"),classifyRings=require("../../util/classify_rings"),EARCUT_MAX_RINGS=500,fillInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(3),elementArrayType2:createElementArrayType(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},FillBucket=function(e){function r(r){e.call(this,r,fillInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);t<a.length;t+=1){for(var l=a[t],p=0,n=0,y=l;n<y.length;n+=1){p+=y[n].length}for(var i=r.prepareSegment(p),o=i.vertexLength,c=[],u=[],g=0,h=l;g<h.length;g+=1){var m=h[g];if(0!==m.length){m!==l[0]&&u.push(c.length/2);var s=r.prepareSegment2(m.length),f=s.vertexLength;r.layoutVertexArray.emplaceBack(m[0].x,m[0].y),r.elementArray2.emplaceBack(f+m.length-1,f),c.push(m[0].x),c.push(m[0].y);for(var A=1;A<m.length;A++)r.layoutVertexArray.emplaceBack(m[A].x,m[A].y),r.elementArray2.emplaceBack(f+A-1,f+A),c.push(m[A].x),c.push(m[A].y);s.vertexLength+=m.length,s.primitiveLength+=m.length}}for(var v=earcut(c,u),x=0;x<v.length;x+=3)r.elementArray.emplaceBack(o+v[x],o+v[x+1],o+v[x+2]);i.vertexLength+=p,i.primitiveLength+=v.length/3}r.populatePaintArrays(e.properties)},r}(Bucket);FillBucket.programInterface=fillInterface,module.exports=FillBucket;
},{"../../util/classify_rings":375,"../bucket":201,"../element_array_type":216,"../load_geometry":219,"../vertex_array_type":223,"earcut":107}],208:[function(require,module,exports){
"use strict";function addVertex(e,r,t,a,o,y,n,p){e.emplaceBack(r,t,2*Math.floor(a*FACTOR)+n,o*FACTOR*2,y*FACTOR*2,Math.round(p))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),earcut=require("earcut"),classifyRings=require("../../util/classify_rings"),EARCUT_MAX_RINGS=500,histogramInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:createElementArrayType(3),paintAttributes:[{property:"histogram-base",type:"Uint16"},{property:"histogram-height",type:"Uint16"},{property:"histogram-color",type:"Uint8"}]},FACTOR=Math.pow(2,13),HistogramBucket=function(e){function r(r){e.call(this,r,histogramInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);t<a.length;t+=1){for(var o=a[t],y=0,n=0,p=o;n<p.length;n+=1){y+=p[n].length}for(var i=r.prepareSegment(5*y),u=[],c=[],s=[],l=0,m=o;l<m.length;l+=1){var x=m[l];if(0!==x.length){x!==o[0]&&c.push(u.length/2);for(var g=0,h=0;h<x.length;h++){var d=x[h];if(addVertex(r.layoutVertexArray,d.x,d.y,0,0,1,1,0),s.push(i.vertexLength++),h>=1){var A=x[h-1];if(!isBoundaryEdge(d,A)){var f=d.sub(A)._perp()._unit();addVertex(r.layoutVertexArray,d.x,d.y,f.x,f.y,0,0,g),addVertex(r.layoutVertexArray,d.x,d.y,f.x,f.y,0,1,g),g+=A.dist(d),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,0,g),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,1,g);var _=i.vertexLength;r.elementArray.emplaceBack(_,_+1,_+2),r.elementArray.emplaceBack(_+1,_+2,_+3),i.vertexLength+=4,i.primitiveLength+=2}}u.push(d.x),u.push(d.y)}}}for(var T=earcut(u,c),v=0;v<T.length;v+=3)r.elementArray.emplaceBack(s[T[v]],s[T[v+1]],s[T[v+2]]);i.primitiveLength+=T.length/3}r.populatePaintArrays(e.properties)},r}(Bucket);HistogramBucket.programInterface=histogramInterface,module.exports=HistogramBucket;
},{"../../util/classify_rings":375,"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"earcut":107}],209:[function(require,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,d){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(d*LINE_DISTANCE_SCALE&63)<<2,d*LINE_DISTANCE_SCALE>>6)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),VectorTileFeature=require("vector-tile").VectorTileFeature,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,lineInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()},LineBucket=function(e){function t(t){e.call(this,t,lineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){for(var t=this,r=this.layers[0].layout,i=r["line-join"],a=r["line-cap"],n=r["line-miter-limit"],d=r["line-round-limit"],s=0,u=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);s<u.length;s+=1){var l=u[s];t.addLine(l,e,i,a,n,d)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var d=this,s=t.properties,u="Polygon"===VectorTileFeature.types[t.type],l=e.length;l>=2&&e[l-1].equals(e[l-2]);)l--;if(!(l<(u?3:2))){"bevel"===r&&(a=1.05);var o=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),p=e[0],c=this.arrays,_=c.prepareSegment(10*l);this.distance=0;var y,h,m,E,x,C,v,A=i,f=u?"butt":i,L=!0;this.e1=this.e2=this.e3=-1,u&&(y=e[l-2],x=p.sub(y)._unit()._perp());for(var V=0;V<l;V++)if(!(m=u&&V===l-1?e[1]:e[V+1])||!e[V].equals(m)){x&&(E=x),y&&(h=y),y=e[V],x=m?m.sub(y)._unit()._perp():E,E=E||x;var S=E.add(x);0===S.x&&0===S.y||S._unit();var T=S.x*x.x+S.y*x.y,I=0!==T?1/T:1/0,N=T<COS_HALF_SHARP_CORNER&&h&&m;if(N&&V>0){var b=y.dist(h);if(b>2*o){var R=y.sub(y.sub(h)._mult(o/b)._round());d.distance+=R.dist(h),d.addCurrentVertex(R,d.distance,E.mult(1),0,0,!1,_),h=R}}var g=h&&m,F=g?r:m?A:f;if(g&&"round"===F&&(I<n?F="miter":I<=2&&(F="fakeround")),"miter"===F&&I>a&&(F="bevel"),"bevel"===F&&(I>2&&(F="flipbevel"),I<a&&(F="miter")),h&&(d.distance+=y.dist(h)),"miter"===F)S._mult(I),d.addCurrentVertex(y,d.distance,S,0,0,!1,_);else if("flipbevel"===F){if(I>100)S=x.clone().mult(-1);else{var B=E.x*x.y-E.y*x.x>0?-1:1,k=I*E.add(x).mag()/E.sub(x).mag();S._perp()._mult(k*B)}d.addCurrentVertex(y,d.distance,S,0,0,!1,_),d.addCurrentVertex(y,d.distance,S.mult(-1),0,0,!1,_)}else if("bevel"===F||"fakeround"===F){var D=E.x*x.y-E.y*x.x>0,P=-Math.sqrt(I*I-1);if(D?(v=0,C=P):(C=0,v=P),L||d.addCurrentVertex(y,d.distance,E,C,v,!1,_),"fakeround"===F){for(var U=Math.floor(8*(.5-(T-.5))),q=void 0,M=0;M<U;M++)q=x.mult((M+1)/(U+1))._add(E)._unit(),d.addPieSliceVertex(y,d.distance,q,D,_);d.addPieSliceVertex(y,d.distance,S,D,_);for(var O=U-1;O>=0;O--)q=E.mult((O+1)/(U+1))._add(x)._unit(),d.addPieSliceVertex(y,d.distance,q,D,_)}m&&d.addCurrentVertex(y,d.distance,x,-C,-v,!1,_)}else"butt"===F?(L||d.addCurrentVertex(y,d.distance,E,0,0,!1,_),m&&d.addCurrentVertex(y,d.distance,x,0,0,!1,_)):"square"===F?(L||(d.addCurrentVertex(y,d.distance,E,1,1,!1,_),d.e1=d.e2=-1),m&&d.addCurrentVertex(y,d.distance,x,-1,-1,!1,_)):"round"===F&&(L||(d.addCurrentVertex(y,d.distance,E,0,0,!1,_),d.addCurrentVertex(y,d.distance,E,1,1,!0,_),d.e1=d.e2=-1),m&&(d.addCurrentVertex(y,d.distance,x,-1,-1,!0,_),d.addCurrentVertex(y,d.distance,x,0,0,!1,_)));if(N&&V<l-1){var X=y.dist(m);if(X>2*o){var H=y.add(m.sub(y)._mult(o/X)._round());d.distance+=H.dist(y),d.addCurrentVertex(H,d.distance,x.mult(1),0,0,!1,_),y=H}}L=!1}c.populatePaintArrays(s)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,d){var s,u=n?1:0,l=this.arrays,o=l.layoutVertexArray,p=l.elementArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),addLineVertex(o,e,s,u,0,i,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),a&&s._sub(r.perp()._mult(a)),addLineVertex(o,e,s,u,1,-a,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,d))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var d=this.arrays,s=d.layoutVertexArray,u=d.elementArray;addLineVertex(s,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);LineBucket.programInterface=lineInterface,module.exports=LineBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"vector-tile":190}],210:[function(require,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,s,n){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===s?0:s<0?-1:1)|(n*LINE_DISTANCE_SCALE&63)<<2,n*LINE_DISTANCE_SCALE>>6,255&curOpacity,parseInt(curNum),parseInt(curStatus))}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),VectorTileFeature=require("vector-tile").VectorTileFeature,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,spriteInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}]),paintAttributes:[{property:"sprite-color",type:"Uint8"},{property:"sprite-blur",multiplier:10,type:"Uint8"},{property:"sprite-opacity",multiplier:10,type:"Uint8"},{property:"sprite-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"sprite-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()},curOpacity=0,curNum=0,curStatus=1,SpriteBucket=function(e){function t(t){e.call(this,t,spriteInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=r["sprite-join"],a=r["sprite-cap"],s=r["sprite-miter-limit"],n=r["sprite-round-limit"];curNum=e.properties.link_seq?e.properties.link_seq:curNum,curNum%=10,curStatus=e.properties.status||1;for(var u=0,d=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);u<d.length;u+=1){var p=d[u];t.addLine(p,e,i,a,s,n)}},t.prototype.addLine=function(e,t,r,i,a,s){for(var n=this,u=t.properties,d="Polygon"===VectorTileFeature.types[t.type],p=e.length;p>=2&&e[p-1].equals(e[p-2]);)p--;if(!(p<(d?3:2))){"bevel"===r&&(a=1.05);var c=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),o=e[0],l=this.arrays,_=l.prepareSegment(10*p);this.distance=0;var y,h,m,x,E,C,v,S=i,A=d?"butt":i,f=!0;this.e1=this.e2=this.e3=-1,d&&(y=e[p-2],E=o.sub(y)._unit()._perp());for(var V=0;V<p;V++)if(curOpacity=Math.round(255/p*V),!(m=d&&V===p-1?e[1]:e[V+1])||!e[V].equals(m)){E&&(x=E),y&&(h=y),y=e[V],E=m?m.sub(y)._unit()._perp():x,x=x||E;var I=x.add(E);0===I.x&&0===I.y||I._unit();var L=I.x*E.x+I.y*E.y,T=0!==L?1/L:1/0,N=L<COS_HALF_SHARP_CORNER&&h&&m;if(N&&V>0){var b=y.dist(h);if(b>2*c){var R=y.sub(y.sub(h)._mult(c/b)._round());n.distance+=R.dist(h),n.addCurrentVertex(R,n.distance,x.mult(1),0,0,!1,_),h=R}}var g=h&&m,F=g?r:m?S:A;if(g&&"round"===F&&(T<s?F="miter":T<=2&&(F="fakeround")),"miter"===F&&T>a&&(F="bevel"),"bevel"===F&&(T>2&&(F="flipbevel"),T<a&&(F="miter")),h&&(n.distance+=y.dist(h)),"miter"===F)I._mult(T),n.addCurrentVertex(y,n.distance,I,0,0,!1,_);else if("flipbevel"===F){if(T>100)I=E.clone().mult(-1);else{var k=x.x*E.y-x.y*E.x>0?-1:1,B=T*x.add(E).mag()/x.sub(E).mag();I._perp()._mult(B*k)}n.addCurrentVertex(y,n.distance,I,0,0,!1,_),n.addCurrentVertex(y,n.distance,I.mult(-1),0,0,!1,_)}else if("bevel"===F||"fakeround"===F){var q=x.x*E.y-x.y*E.x>0,D=-Math.sqrt(T*T-1);if(q?(v=0,C=D):(C=0,v=D),f||n.addCurrentVertex(y,n.distance,x,C,v,!1,_),"fakeround"===F){for(var O=Math.floor(8*(.5-(L-.5))),U=void 0,P=0;P<O;P++)U=E.mult((P+1)/(O+1))._add(x)._unit(),n.addPieSliceVertex(y,n.distance,U,q,_);n.addPieSliceVertex(y,n.distance,I,q,_);for(var M=O-1;M>=0;M--)U=x.mult((M+1)/(O+1))._add(E)._unit(),n.addPieSliceVertex(y,n.distance,U,q,_)}m&&n.addCurrentVertex(y,n.distance,E,-C,-v,!1,_)}else"butt"===F?(f||n.addCurrentVertex(y,n.distance,x,0,0,!1,_),m&&n.addCurrentVertex(y,n.distance,E,0,0,!1,_)):"square"===F?(f||(n.addCurrentVertex(y,n.distance,x,1,1,!1,_),n.e1=n.e2=-1),m&&n.addCurrentVertex(y,n.distance,E,-1,-1,!1,_)):"round"===F&&(f||(n.addCurrentVertex(y,n.distance,x,0,0,!1,_),n.addCurrentVertex(y,n.distance,x,1,1,!0,_),n.e1=n.e2=-1),m&&(n.addCurrentVertex(y,n.distance,E,-1,-1,!0,_),n.addCurrentVertex(y,n.distance,E,0,0,!1,_)));if(N&&V<p-1){var X=y.dist(m);if(X>2*c){var H=y.add(m.sub(y)._mult(c/X)._round());n.distance+=H.dist(y),n.addCurrentVertex(H,n.distance,E.mult(1),0,0,!1,_),y=H}}f=!1}l.populatePaintArrays(u)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,s,n){var u,d=s?1:0,p=this.arrays,c=p.layoutVertexArray,o=p.elementArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),addLineVertex(c,e,u,d,0,i,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),a&&u._sub(r.perp()._mult(a)),addLineVertex(c,e,u,d,1,-a,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,s,n))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var s=i?1:0;r=r.mult(i?-1:1);var n=this.arrays,u=n.layoutVertexArray,d=n.elementArray;addLineVertex(u,e,r,0,s,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);SpriteBucket.programInterface=spriteInterface,module.exports=SpriteBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"vector-tile":190}],211:[function(require,module,exports){
"use strict";function addVertex(e,t,o,r,a,i,n,l,s,c,y){e.emplaceBack(t,o,Math.round(64*r),Math.round(64*a),i/4,n/4,10*(c||0),y,10*(l||0),10*Math.min(s||25,25))}function addCollisionBoxVertex(e,t,o,r,a){return e.emplaceBack(t.x,t.y,Math.round(o.x),Math.round(o.y),10*r,10*a)}var Point=require("point-geometry"),ArrayGroup=require("../array_group"),BufferGroup=require("../buffer_group"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),EXTENT=require("../extent"),Anchor=require("../../symbol/anchor"),getAnchors=require("../../symbol/get_anchors"),resolveTokens=require("../../util/token"),Quads=require("../../symbol/quads"),Shaping=require("../../symbol/shaping"),resolveText=require("../../symbol/resolve_text"),mergeLines=require("../../symbol/mergelines"),clipLine=require("../../symbol/clip_line"),util=require("../../util/util"),scriptDetection=require("../../util/script_detection"),loadGeometry=require("../load_geometry"),CollisionFeature=require("../../symbol/collision_feature"),findPoleOfInaccessibility=require("../../util/find_pole_of_inaccessibility"),classifyRings=require("../../util/classify_rings"),VectorTileFeature=require("vector-tile").VectorTileFeature,rtlTextPlugin=require("../../source/rtl_text_plugin"),shapeText=Shaping.shapeText,shapeIcon=Shaping.shapeIcon,WritingMode=Shaping.WritingMode,getGlyphQuads=Quads.getGlyphQuads,getIconQuads=Quads.getIconQuads,elementArrayType=createElementArrayType(),layoutVertexArrayType=createVertexArrayType([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),symbolInterfaces={glyph:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType,paintAttributes:[{name:"a_fill_color",property:"text-color",type:"Uint8"},{name:"a_halo_color",property:"text-halo-color",type:"Uint8"},{name:"a_halo_width",property:"text-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"text-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"text-opacity",type:"Uint8",multiplier:255}]},icon:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType,paintAttributes:[{name:"a_fill_color",property:"icon-color",type:"Uint8"},{name:"a_halo_color",property:"icon-halo-color",type:"Uint8"},{name:"a_halo_width",property:"icon-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"icon-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"icon-opacity",type:"Uint8",multiplier:255}]},collisionBox:{layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:createElementArrayType(2)}},SymbolBucket=function(e){var t=this;if(this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.index=e.index,this.sdfIcons=e.sdfIcons,this.iconsNeedLinear=e.iconsNeedLinear,this.adjustedTextSize=e.adjustedTextSize,this.adjustedIconSize=e.adjustedIconSize,this.fontstack=e.fontstack,e.arrays){this.buffers={};for(var o in e.arrays)e.arrays[o]&&(t.buffers[o]=new BufferGroup(symbolInterfaces[o],e.layers,e.zoom,e.arrays[o]))}};SymbolBucket.prototype.populate=function(e,t){var o=this,r=this.layers[0],a=r.layout,i=a["text-font"],n=a["icon-image"],l=i&&(!r.isLayoutValueFeatureConstant("text-field")||a["text-field"]),s=n;if(this.features=[],l||s){for(var c=t.iconDependencies,y=t.glyphDependencies,p=y[i]=y[i]||{},x=0;x<e.length;x++){var h=e[x];if(r.filter(h)){var u=void 0;l&&(u=resolveText(r,{zoom:o.zoom},h.properties),rtlTextPlugin.applyArabicShaping&&(u=rtlTextPlugin.applyArabicShaping(u)));var d=void 0;if(s&&(d=resolveTokens(h.properties,n)),(u||d)&&(o.features.push({text:u,icon:d,index:x,sourceLayerIndex:h.sourceLayerIndex,geometry:loadGeometry(h),properties:h.properties,type:VectorTileFeature.types[h.type]}),d&&(c[d]=!0),u))for(var m=0;m<u.length;m++)p[u.charCodeAt(m)]=!0}}"line"===a["symbol-placement"]&&(this.features=mergeLines(this.features))}},SymbolBucket.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},SymbolBucket.prototype.getPaintPropertyStatistics=function(){for(var e=this,t={},o=0,r=e.layers;o<r.length;o+=1){var a=r[o];t[a.id]=util.extend({},e.arrays.icon.layerData[a.id].paintPropertyStatistics,e.arrays.glyph.layerData[a.id].paintPropertyStatistics)}return t},SymbolBucket.prototype.serialize=function(e){return{zoom:this.zoom,layerIds:this.layers.map(function(e){return e.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:util.mapObject(this.arrays,function(t){return t.isEmpty()?null:t.serialize(e)})}},SymbolBucket.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},SymbolBucket.prototype.createArrays=function(){var e=this;this.arrays=util.mapObject(symbolInterfaces,function(t){return new ArrayGroup(t,e.layers,e.zoom)})},SymbolBucket.prototype.prepare=function(e,t){var o=this;this.symbolInstances=[],this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var r=512*this.overscaling;this.tilePixelRatio=EXTENT/r,this.compareText={},this.iconsNeedLinear=!1;var a=this.layers[0].layout,i=.5,n=.5;switch(a["text-anchor"]){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}for(var l="right"===a["text-justify"]?1:"left"===a["text-justify"]?0:.5,s=24*a["text-line-height"],c="line"!==a["symbol-placement"]?24*a["text-max-width"]:0,y=24*a["text-letter-spacing"],p=[24*a["text-offset"][0],24*a["text-offset"][1]],x=this.fontstack=a["text-font"].join(","),h="map"===a["text-rotation-alignment"]&&"line"===a["symbol-placement"],u=0,d=o.features;u<d.length;u+=1){var m=d[u],f=void 0;if(m.text){var g=scriptDetection.allowsVerticalWritingMode(m.text);f={},f[WritingMode.horizontal]=shapeText(m.text,e[x],c,s,i,n,l,y,p,24,WritingMode.horizontal),f[WritingMode.vertical]=g&&h&&shapeText(m.text,e[x],c,s,i,n,l,y,p,24,WritingMode.vertical)}else f={};var b=void 0;if(m.icon){var v=t[m.icon],I=o.layers[0].getLayoutValue("icon-offset",{zoom:o.zoom},m.properties);b=shapeIcon(v,I),v&&(void 0===o.sdfIcons?o.sdfIcons=v.sdf:o.sdfIcons!==v.sdf&&util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==v.pixelRatio?o.iconsNeedLinear=!0:0===a["icon-rotate"]&&o.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(o.iconsNeedLinear=!0))}(f[WritingMode.horizontal]||b)&&o.addFeature(m,f,b)}},SymbolBucket.prototype.addFeature=function(e,t,o){var r=this,a=this.layers[0].layout,i=this.adjustedTextSize/24,n=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,l=this.tilePixelRatio*i,s=this.tilePixelRatio*n/24,c=this.tilePixelRatio*this.adjustedIconSize,y=this.tilePixelRatio*a["symbol-spacing"],p=a["symbol-avoid-edges"],x=a["text-padding"]*this.tilePixelRatio,h=a["icon-padding"]*this.tilePixelRatio,u=a["text-max-angle"]/180*Math.PI,d="map"===a["text-rotation-alignment"]&&"line"===a["symbol-placement"],m="map"===a["icon-rotation-alignment"]&&"line"===a["symbol-placement"],f=a["text-allow-overlap"]||a["icon-allow-overlap"]||a["text-ignore-placement"]||a["icon-ignore-placement"],g=a["symbol-placement"],b=y/2,v=function(a,i){var n=!(i.x<0||i.x>EXTENT||i.y<0||i.y>EXTENT);if(!p||n){var s=n||f;r.addSymbolInstance(i,a,t,o,r.layers[0],s,r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,l,x,d,c,h,m,{zoom:r.zoom},e.properties)}};if("line"===g)for(var I=0,S=clipLine(e.geometry,0,0,EXTENT,EXTENT);I<S.length;I+=1)for(var T=S[I],M=getAnchors(T,y,u,t[WritingMode.vertical]||t[WritingMode.horizontal],o,24,s,r.overscaling,EXTENT),B=0,A=M;B<A.length;B+=1){var z=A[B],_=t[WritingMode.horizontal];_&&r.anchorIsTooClose(_.text,b,z)||v(T,z)}else if("Polygon"===e.type)for(var E=0,k=classifyRings(e.geometry,0);E<k.length;E+=1){var P=k[E],w=findPoleOfInaccessibility(P,16);v(P[0],new Anchor(w.x,w.y,0))}else if("LineString"===e.type)for(var L=0,V=e.geometry;L<V.length;L+=1){var C=V[L];v(C,new Anchor(C[0].x,C[0].y,0))}else if("Point"===e.type)for(var N=0,q=e.geometry;N<q.length;N+=1)for(var j=q[N],F=0,W=j;F<W.length;F+=1){var Q=W[F];v([Q],new Anchor(Q.x,Q.y,0))}},SymbolBucket.prototype.anchorIsTooClose=function(e,t,o){var r=this.compareText;if(e in r){for(var a=r[e],i=a.length-1;i>=0;i--)if(o.dist(a[i])<t)return!0}else r[e]=[];return r[e].push(o),!1},SymbolBucket.prototype.place=function(e,t){var o=this;this.createArrays();var r=this.layers[0].layout,a=e.maxScale,i="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],n="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"];if(r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"]){var l=e.angle,s=Math.sin(l),c=Math.cos(l);this.symbolInstances.sort(function(e,t){return(s*e.anchor.x+c*e.anchor.y|0)-(s*t.anchor.x+c*t.anchor.y|0)||t.featureIndex-e.featureIndex})}for(var y=0,p=o.symbolInstances;y<p.length;y+=1){var x=p[y],h={boxStartIndex:x.textBoxStartIndex,boxEndIndex:x.textBoxEndIndex},u={boxStartIndex:x.iconBoxStartIndex,boxEndIndex:x.iconBoxEndIndex},d=!(x.textBoxStartIndex===x.textBoxEndIndex),m=!(x.iconBoxStartIndex===x.iconBoxEndIndex),f=r["text-optional"]||!d,g=r["icon-optional"]||!m,b=d?e.placeCollisionFeature(h,r["text-allow-overlap"],r["symbol-avoid-edges"]):e.minScale,v=m?e.placeCollisionFeature(u,r["icon-allow-overlap"],r["symbol-avoid-edges"]):e.minScale;f||g?!g&&b?b=Math.max(v,b):!f&&v&&(v=Math.max(v,b)):v=b=Math.max(v,b),d&&(e.insertCollisionFeature(h,b,r["text-ignore-placement"]),b<=a&&o.addSymbols(o.arrays.glyph,x.glyphQuads,b,r["text-keep-upright"],i,e.angle,x.featureProperties,x.writingModes)),m&&(e.insertCollisionFeature(u,v,r["icon-ignore-placement"]),v<=a&&o.addSymbols(o.arrays.icon,x.iconQuads,v,r["icon-keep-upright"],n,e.angle,x.featureProperties))}t&&this.addToDebugBuffers(e)},SymbolBucket.prototype.addSymbols=function(e,t,o,r,a,i,n,l){for(var s=e.elementArray,c=e.layoutVertexArray,y=this.zoom,p=Math.max(Math.log(o)/Math.LN2+y,0),x=0,h=t;x<h.length;x+=1){var u=h[x],d=(u.anchorAngle+i+Math.PI)%(2*Math.PI);if(l&WritingMode.vertical){if(a&&u.writingMode===WritingMode.vertical){if(r&&a&&d<=5*Math.PI/4||d>7*Math.PI/4)continue}else if(r&&a&&d<=3*Math.PI/4||d>5*Math.PI/4)continue}else if(r&&a&&(d<=Math.PI/2||d>3*Math.PI/2))continue;var m=u.tl,f=u.tr,g=u.bl,b=u.br,v=u.tex,I=u.anchorPoint,S=Math.max(y+Math.log(u.minScale)/Math.LN2,p),T=Math.min(y+Math.log(u.maxScale)/Math.LN2,25);if(!(T<=S)){S===p&&(S=0);var M=Math.round(u.glyphAngle/(2*Math.PI)*256),B=e.prepareSegment(4),A=B.vertexLength;addVertex(c,I.x,I.y,m.x,m.y,v.x,v.y,S,T,p,M),addVertex(c,I.x,I.y,f.x,f.y,v.x+v.w,v.y,S,T,p,M),addVertex(c,I.x,I.y,g.x,g.y,v.x,v.y+v.h,S,T,p,M),addVertex(c,I.x,I.y,b.x,b.y,v.x+v.w,v.y+v.h,S,T,p,M),s.emplaceBack(A,A+1,A+2),s.emplaceBack(A+1,A+2,A+3),B.vertexLength+=4,B.primitiveLength+=2}}e.populatePaintArrays(n)},SymbolBucket.prototype.addToDebugBuffers=function(e){for(var t=this,o=this.arrays.collisionBox,r=o.layoutVertexArray,a=o.elementArray,i=-e.angle,n=e.yStretch,l=0,s=t.symbolInstances;l<s.length;l+=1){var c=s[l];c.textCollisionFeature={boxStartIndex:c.textBoxStartIndex,boxEndIndex:c.textBoxEndIndex},c.iconCollisionFeature={boxStartIndex:c.iconBoxStartIndex,boxEndIndex:c.iconBoxEndIndex};for(var y=0;y<2;y++){var p=c[0===y?"textCollisionFeature":"iconCollisionFeature"];if(p)for(var x=p.boxStartIndex;x<p.boxEndIndex;x++){var h=t.collisionBoxArray.get(x),u=h.anchorPoint,d=new Point(h.x1,h.y1*n)._rotate(i),m=new Point(h.x2,h.y1*n)._rotate(i),f=new Point(h.x1,h.y2*n)._rotate(i),g=new Point(h.x2,h.y2*n)._rotate(i),b=Math.max(0,Math.min(25,t.zoom+Math.log(h.maxScale)/Math.LN2)),v=Math.max(0,Math.min(25,t.zoom+Math.log(h.placementScale)/Math.LN2)),I=o.prepareSegment(4),S=I.vertexLength;addCollisionBoxVertex(r,u,d,b,v),addCollisionBoxVertex(r,u,m,b,v),addCollisionBoxVertex(r,u,g,b,v),addCollisionBoxVertex(r,u,f,b,v),a.emplaceBack(S,S+1),a.emplaceBack(S+1,S+2),a.emplaceBack(S+2,S+3),a.emplaceBack(S+3,S),I.vertexLength+=4,I.primitiveLength+=4}}}},SymbolBucket.prototype.addSymbolInstance=function(e,t,o,r,a,i,n,l,s,c,y,p,x,h,u,d,m,f,g){var b,v,I=[],S=[];for(var T in o){var M=parseInt(T,10);o[M]&&(S=S.concat(i?getGlyphQuads(e,o[M],y,t,a,x):[]),b=new CollisionFeature(n,t,e,l,s,c,o[M],y,p,x,!1))}var B=b?b.boxStartIndex:this.collisionBoxArray.length,A=b?b.boxEndIndex:this.collisionBoxArray.length;r&&(I=i?getIconQuads(e,r,h,t,a,d,o[WritingMode.horizontal],m,f):[],v=new CollisionFeature(n,t,e,l,s,c,r,h,u,d,!0));var z=v?v.boxStartIndex:this.collisionBoxArray.length,_=v?v.boxEndIndex:this.collisionBoxArray.length;A>SymbolBucket.MAX_INSTANCES&&util.warnOnce("Too many symbols being rendered in a tile."),_>SymbolBucket.MAX_INSTANCES&&util.warnOnce("Too many glyphs being rendered in a tile.");var E=(o[WritingMode.vertical]?WritingMode.vertical:0)|(o[WritingMode.horizontal]?WritingMode.horizontal:0);this.symbolInstances.push({textBoxStartIndex:B,textBoxEndIndex:A,iconBoxStartIndex:z,iconBoxEndIndex:_,glyphQuads:S,iconQuads:I,anchor:e,featureIndex:l,featureProperties:f,seq:g,writingModes:E})},SymbolBucket.programInterfaces=symbolInterfaces,SymbolBucket.MAX_INSTANCES=65535,module.exports=SymbolBucket;
},{"../../source/rtl_text_plugin":262,"../../symbol/anchor":336,"../../symbol/clip_line":338,"../../symbol/collision_feature":340,"../../symbol/get_anchors":342,"../../symbol/mergelines":345,"../../symbol/quads":346,"../../symbol/resolve_text":347,"../../symbol/shaping":348,"../../util/classify_rings":375,"../../util/find_pole_of_inaccessibility":383,"../../util/script_detection":394,"../../util/token":398,"../../util/util":399,"../array_group":200,"../buffer_group":215,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"point-geometry":154,"vector-tile":190}],212:[function(require,module,exports){
"use strict";function addVertex(e,t,r,o,a,i,n,s,l,c,y,p){e.emplaceBack(t,r,Math.round(64*o),Math.round(64*a),i/4,n/4,10*(c||0),y,10*(s||0),10*Math.min(l||25,25),p)}function addCollisionBoxVertex(e,t,r,o,a){return e.emplaceBack(t.x,t.y,Math.round(r.x),Math.round(r.y),10*o,10*a)}var Point=require("point-geometry"),ArrayGroup=require("../array_group"),BufferGroup=require("../buffer_group"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),EXTENT=require("../extent"),Anchor=require("../../symbol/anchor"),getAnchors=require("../../symbol/get_anchors"),resolveTokens=require("../../util/token"),Quads=require("../../symbol/quads"),Shaping=require("../../symbol/shaping"),resolveText=require("../../symbol/resolve_text"),mergeLines=require("../../symbol/mergelines"),clipLine=require("../../symbol/clip_line"),util=require("../../util/util"),scriptDetection=require("../../util/script_detection"),loadGeometry=require("../load_geometry"),CollisionFeature=require("../../symbol/collision_feature"),findPoleOfInaccessibility=require("../../util/find_pole_of_inaccessibility"),classifyRings=require("../../util/classify_rings"),VectorTileFeature=require("vector-tile").VectorTileFeature,rtlTextPlugin=require("../../source/rtl_text_plugin"),shapeText=Shaping.shapeText,shapeIcon=Shaping.shapeIcon,WritingMode=Shaping.WritingMode,getGlyphQuads=Quads.getGlyphQuads,getIconQuads=Quads.getIconQuads,elementArrayType=createElementArrayType(),layoutVertexArrayType=createVertexArrayType([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}]),symtrackingInterfaces={glyph:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType,paintAttributes:[{name:"a_fill_color",property:"text-color",type:"Uint8"},{name:"a_halo_color",property:"text-halo-color",type:"Uint8"},{name:"a_halo_width",property:"text-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"text-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"text-opacity",type:"Uint8",multiplier:255}]},icon:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType,paintAttributes:[{name:"a_fill_color",property:"icon-color",type:"Uint8"},{name:"a_halo_color",property:"icon-halo-color",type:"Uint8"},{name:"a_halo_width",property:"icon-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"icon-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"icon-opacity",type:"Uint8",multiplier:255}]},collisionBox:{layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:createElementArrayType(2)}},SymtrackingBucket=function(e){var t=this;if(this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.index=e.index,this.sdfIcons=e.sdfIcons,this.iconsNeedLinear=e.iconsNeedLinear,this.adjustedTextSize=e.adjustedTextSize,this.adjustedIconSize=e.adjustedIconSize,this.fontstack=e.fontstack,this._seq=0,e.arrays){this.buffers={};for(var r in e.arrays)e.arrays[r]&&(t.buffers[r]=new BufferGroup(symtrackingInterfaces[r],e.layers,e.zoom,e.arrays[r]))}};SymtrackingBucket.prototype.populate=function(e,t){var r=this,o=this.layers[0],a=o.layout,i=a["text-font"],n=a["icon-image"],s=i&&(!o.isLayoutValueFeatureConstant("text-field")||a["text-field"]),l=n;if(this.features=[],s||l){for(var c=t.iconDependencies,y=t.glyphDependencies,p=y[i]=y[i]||{},x=0;x<e.length;x++){var h=e[x];if(o.filter(h)){var u=void 0;s&&(u=resolveText(o,{zoom:r.zoom},h.properties),rtlTextPlugin.applyArabicShaping&&(u=rtlTextPlugin.applyArabicShaping(u)));var d=void 0;if(l&&(d=resolveTokens(h.properties,n)),(u||d)&&(r.features.push({text:u,icon:d,index:x,sourceLayerIndex:h.sourceLayerIndex,geometry:loadGeometry(h),properties:h.properties,type:VectorTileFeature.types[h.type]}),d&&(c[d]=!0),u))for(var m=0;m<u.length;m++)p[u.charCodeAt(m)]=!0}}"line"===a["symbol-placement"]&&(this.features=mergeLines(this.features))}},SymtrackingBucket.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},SymtrackingBucket.prototype.getPaintPropertyStatistics=function(){for(var e=this,t={},r=0,o=e.layers;r<o.length;r+=1){var a=o[r];t[a.id]=util.extend({},e.arrays.icon.layerData[a.id].paintPropertyStatistics,e.arrays.glyph.layerData[a.id].paintPropertyStatistics)}return t},SymtrackingBucket.prototype.serialize=function(e){return{zoom:this.zoom,layerIds:this.layers.map(function(e){return e.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:util.mapObject(this.arrays,function(t){return t.isEmpty()?null:t.serialize(e)})}},SymtrackingBucket.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},SymtrackingBucket.prototype.createArrays=function(){var e=this;this.arrays=util.mapObject(symtrackingInterfaces,function(t){return new ArrayGroup(t,e.layers,e.zoom)})},SymtrackingBucket.prototype.prepare=function(e,t){var r=this;this.symbolInstances=[],this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var o=512*this.overscaling;this.tilePixelRatio=EXTENT/o,this.compareText={},this.iconsNeedLinear=!1;var a=this.layers[0].layout,i=.5,n=.5;switch(a["text-anchor"]){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}for(var s="right"===a["text-justify"]?1:"left"===a["text-justify"]?0:.5,l=24*a["text-line-height"],c="line"!==a["symbol-placement"]?24*a["text-max-width"]:0,y=24*a["text-letter-spacing"],p=[24*a["text-offset"][0],24*a["text-offset"][1]],x=this.fontstack=a["text-font"].join(","),h="map"===a["text-rotation-alignment"]&&"line"===a["symbol-placement"],u=0,d=r.features;u<d.length;u+=1){var m=d[u];r._seq=m.properties.link_seq;var g=void 0;if(m.text){var f=scriptDetection.allowsVerticalWritingMode(m.text);g={},g[WritingMode.horizontal]=shapeText(m.text,e[x],c,l,i,n,s,y,p,24,WritingMode.horizontal),g[WritingMode.vertical]=f&&h&&shapeText(m.text,e[x],c,l,i,n,s,y,p,24,WritingMode.vertical)}else g={};var v=void 0;if(m.icon){var I=t[m.icon],S=r.layers[0].getLayoutValue("icon-offset",{zoom:r.zoom},m.properties);v=shapeIcon(I,S),I&&(void 0===r.sdfIcons?r.sdfIcons=I.sdf:r.sdfIcons!==I.sdf&&util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==I.pixelRatio?r.iconsNeedLinear=!0:0===a["icon-rotate"]&&r.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(r.iconsNeedLinear=!0))}(g[WritingMode.horizontal]||v)&&r.addFeature(m,g,v,r._seq)}},SymtrackingBucket.prototype.addFeature=function(e,t,r,o){var a=this,i=this.layers[0].layout,n=this.adjustedTextSize/24,s=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,l=this.tilePixelRatio*n,c=this.tilePixelRatio*s/24,y=this.tilePixelRatio*this.adjustedIconSize,p=this.tilePixelRatio*i["symbol-spacing"],x=i["symbol-avoid-edges"],h=i["text-padding"]*this.tilePixelRatio,u=i["icon-padding"]*this.tilePixelRatio,d=i["text-max-angle"]/180*Math.PI,m="map"===i["text-rotation-alignment"]&&"line"===i["symbol-placement"],g="map"===i["icon-rotation-alignment"]&&"line"===i["symbol-placement"],f=i["text-allow-overlap"]||i["icon-allow-overlap"]||i["text-ignore-placement"]||i["icon-ignore-placement"],v=i["symbol-placement"],I=p/2,S=function(i,n){var s=!(n.x<0||n.x>EXTENT||n.y<0||n.y>EXTENT);if(!x||s){var c=s||f;a.addSymbolInstance(n,i,t,r,a.layers[0],c,a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,l,h,m,y,u,g,{zoom:a.zoom},e.properties,o)}};if("line"===v)for(var b=0,T=clipLine(e.geometry,0,0,EXTENT,EXTENT,!0);b<T.length;b+=1)for(var M=T[b],B=getAnchors(M,p,d,t[WritingMode.vertical]||t[WritingMode.horizontal],r,24,c,a.overscaling,EXTENT,!0),k=0,_=B;k<_.length;k+=1){var A=_[k],z=t[WritingMode.horizontal];z&&a.anchorIsTooClose(z.text,I,A)||S(M,A)}else if("Polygon"===e.type)for(var E=0,P=classifyRings(e.geometry,0);E<P.length;E+=1){var w=P[E],L=findPoleOfInaccessibility(w,16);S(w[0],new Anchor(L.x,L.y,0))}else if("LineString"===e.type)for(var V=0,q=e.geometry;V<q.length;V+=1){var C=q[V];S(C,new Anchor(C[0].x,C[0].y,0))}else if("Point"===e.type)for(var N=0,j=e.geometry;N<j.length;N+=1)for(var F=j[N],W=0,U=F;W<U.length;W+=1){var Q=U[W];S([Q],new Anchor(Q.x,Q.y,0))}},SymtrackingBucket.prototype.anchorIsTooClose=function(e,t,r){var o=this.compareText;if(e in o){for(var a=o[e],i=a.length-1;i>=0;i--)if(r.dist(a[i])<t)return!0}else o[e]=[];return o[e].push(r),!1},SymtrackingBucket.prototype.place=function(e,t){var r=this;this.createArrays();var o=this.layers[0].layout,a=e.maxScale,i="map"===o["text-rotation-alignment"]&&"line"===o["symbol-placement"],n="map"===o["icon-rotation-alignment"]&&"line"===o["symbol-placement"];if(o["text-allow-overlap"]||o["icon-allow-overlap"]||o["text-ignore-placement"]||o["icon-ignore-placement"]){var s=e.angle,l=Math.sin(s),c=Math.cos(s);this.symbolInstances.sort(function(e,t){return(l*e.anchor.x+c*e.anchor.y|0)-(l*t.anchor.x+c*t.anchor.y|0)||t.featureIndex-e.featureIndex})}for(var y=0,p=r.symbolInstances;y<p.length;y+=1){var x=p[y],h={boxStartIndex:x.textBoxStartIndex,boxEndIndex:x.textBoxEndIndex},u={boxStartIndex:x.iconBoxStartIndex,boxEndIndex:x.iconBoxEndIndex},d=!(x.textBoxStartIndex===x.textBoxEndIndex),m=!(x.iconBoxStartIndex===x.iconBoxEndIndex),g=o["text-optional"]||!d,f=o["icon-optional"]||!m,v=d?e.placeCollisionFeature(h,o["text-allow-overlap"],o["symbol-avoid-edges"]):e.minScale,I=m?e.placeCollisionFeature(u,o["icon-allow-overlap"],o["symbol-avoid-edges"]):e.minScale;g||f?!f&&v?v=Math.max(I,v):!g&&I&&(I=Math.max(I,v)):I=v=Math.max(I,v),d&&(e.insertCollisionFeature(h,v,o["text-ignore-placement"]),v<=a&&r.addSymbols(r.arrays.glyph,x.glyphQuads,v,o["text-keep-upright"],i,e.angle,x.featureProperties,x.seq,x.writingModes)),m&&(e.insertCollisionFeature(u,I,o["icon-ignore-placement"]),I<=a&&r.addSymbols(r.arrays.icon,x.iconQuads,I,o["icon-keep-upright"],n,e.angle,x.featureProperties,x.seq))}t&&this.addToDebugBuffers(e)},SymtrackingBucket.prototype.addSymbols=function(e,t,r,o,a,i,n,s,l){for(var c=e.elementArray,y=e.layoutVertexArray,p=this.zoom,x=Math.max(Math.log(r)/Math.LN2+p,0),h=0,u=t;h<u.length;h+=1){var d=u[h],m=(d.anchorAngle+i+Math.PI)%(2*Math.PI);if(l&WritingMode.vertical){if(a&&d.writingMode===WritingMode.vertical){if(o&&a&&m<=5*Math.PI/4||m>7*Math.PI/4)continue}else if(o&&a&&m<=3*Math.PI/4||m>5*Math.PI/4)continue}else if(o&&a&&(m<=Math.PI/2||m>3*Math.PI/2))continue;var g=d.tl,f=d.tr,v=d.bl,I=d.br,S=d.tex,b=d.anchorPoint,T=Math.max(p+Math.log(d.minScale)/Math.LN2,x),M=Math.min(p+Math.log(d.maxScale)/Math.LN2,25);if(!(M<=T)){T===x&&(T=0);var B=Math.round(d.glyphAngle/(2*Math.PI)*256),k=e.prepareSegment(4),_=k.vertexLength;addVertex(y,b.x,b.y,g.x,g.y,S.x,S.y,T,M,x,B,s),addVertex(y,b.x,b.y,f.x,f.y,S.x+S.w,S.y,T,M,x,B,s),addVertex(y,b.x,b.y,v.x,v.y,S.x,S.y+S.h,T,M,x,B,s),addVertex(y,b.x,b.y,I.x,I.y,S.x+S.w,S.y+S.h,T,M,x,B,s),c.emplaceBack(_,_+1,_+2),c.emplaceBack(_+1,_+2,_+3),k.vertexLength+=4,k.primitiveLength+=2}}e.populatePaintArrays(n)},SymtrackingBucket.prototype.addToDebugBuffers=function(e){for(var t=this,r=this.arrays.collisionBox,o=r.layoutVertexArray,a=r.elementArray,i=-e.angle,n=e.yStretch,s=0,l=t.symbolInstances;s<l.length;s+=1){var c=l[s];c.textCollisionFeature={boxStartIndex:c.textBoxStartIndex,boxEndIndex:c.textBoxEndIndex},c.iconCollisionFeature={boxStartIndex:c.iconBoxStartIndex,boxEndIndex:c.iconBoxEndIndex};for(var y=0;y<2;y++){var p=c[0===y?"textCollisionFeature":"iconCollisionFeature"];if(p)for(var x=p.boxStartIndex;x<p.boxEndIndex;x++){var h=t.collisionBoxArray.get(x),u=h.anchorPoint,d=new Point(h.x1,h.y1*n)._rotate(i),m=new Point(h.x2,h.y1*n)._rotate(i),g=new Point(h.x1,h.y2*n)._rotate(i),f=new Point(h.x2,h.y2*n)._rotate(i),v=Math.max(0,Math.min(25,t.zoom+Math.log(h.maxScale)/Math.LN2)),I=Math.max(0,Math.min(25,t.zoom+Math.log(h.placementScale)/Math.LN2)),S=r.prepareSegment(4),b=S.vertexLength;addCollisionBoxVertex(o,u,d,v,I),addCollisionBoxVertex(o,u,m,v,I),addCollisionBoxVertex(o,u,f,v,I),addCollisionBoxVertex(o,u,g,v,I),a.emplaceBack(b,b+1),a.emplaceBack(b+1,b+2),a.emplaceBack(b+2,b+3),a.emplaceBack(b+3,b),S.vertexLength+=4,S.primitiveLength+=4}}}},SymtrackingBucket.prototype.addSymbolInstance=function(e,t,r,o,a,i,n,s,l,c,y,p,x,h,u,d,m,g,f){var v,I,S=[],b=[];for(var T in r){var M=parseInt(T,10);r[M]&&(b=b.concat(i?getGlyphQuads(e,r[M],y,t,a,x):[]),v=new CollisionFeature(n,t,e,s,l,c,r[M],y,p,x,!1))}var B=v?v.boxStartIndex:this.collisionBoxArray.length,k=v?v.boxEndIndex:this.collisionBoxArray.length;o&&(S=i?getIconQuads(e,o,h,t,a,d,r[WritingMode.horizontal],m,g):[],I=new CollisionFeature(n,t,e,s,l,c,o,h,u,d,!0));var _=I?I.boxStartIndex:this.collisionBoxArray.length,A=I?I.boxEndIndex:this.collisionBoxArray.length;k>SymtrackingBucket.MAX_INSTANCES&&util.warnOnce("Too many symbols being rendered in a tile."),A>SymtrackingBucket.MAX_INSTANCES&&util.warnOnce("Too many glyphs being rendered in a tile.");var z=(r[WritingMode.vertical]?WritingMode.vertical:0)|(r[WritingMode.horizontal]?WritingMode.horizontal:0);this.symbolInstances.push({textBoxStartIndex:B,textBoxEndIndex:k,iconBoxStartIndex:_,iconBoxEndIndex:A,glyphQuads:b,iconQuads:S,anchor:e,featureIndex:s,featureProperties:g,seq:f,writingModes:z})},SymtrackingBucket.programInterfaces=symtrackingInterfaces,SymtrackingBucket.MAX_INSTANCES=65535,module.exports=SymtrackingBucket;
},{"../../source/rtl_text_plugin":262,"../../symbol/anchor":336,"../../symbol/clip_line":338,"../../symbol/collision_feature":340,"../../symbol/get_anchors":342,"../../symbol/mergelines":345,"../../symbol/quads":346,"../../symbol/resolve_text":347,"../../symbol/shaping":348,"../../util/classify_rings":375,"../../util/find_pole_of_inaccessibility":383,"../../util/script_detection":394,"../../util/token":398,"../../util/util":399,"../array_group":200,"../buffer_group":215,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"point-geometry":154,"vector-tile":190}],213:[function(require,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,seq)}var Bucket=require("../bucket"),createVertexArrayType=require("../vertex_array_type"),createElementArrayType=require("../element_array_type"),loadGeometry=require("../load_geometry"),EXTENT=require("../extent"),VectorTileFeature=require("vector-tile").VectorTileFeature,seq=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,trackingInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}]),paintAttributes:[{property:"tracking-color",type:"Uint8"},{property:"tracking-blur",multiplier:10,type:"Uint8"},{property:"tracking-opacity",multiplier:10,type:"Uint8"},{property:"tracking-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"tracking-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()},TrackingBucket=function(e){function t(t){e.call(this,t,trackingInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=r["tracking-join"],a=r["tracking-cap"],n=r["tracking-miter-limit"],s=r["tracking-round-limit"];seq=e.properties.link_seq;for(var d=0,u=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);d<u.length;d+=1){var c=u[d];t.addLine(c,e,i,a,n,s)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,d=t.properties,u="Polygon"===VectorTileFeature.types[t.type],c=e.length;c>=2&&e[c-1].equals(e[c-2]);)c--;if(!(c<(u?3:2))){"bevel"===r&&(a=1.05);var o=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),p=e[0],l=this.arrays,_=l.prepareSegment(10*c);this.distance=0;var y,h,m,E,x,C,v,A=i,f=u?"butt":i,T=!0;this.e1=this.e2=this.e3=-1,u&&(y=e[c-2],x=p.sub(y)._unit()._perp());for(var V=0;V<c;V++)if(seq++,!(m=u&&V===c-1?e[1]:e[V+1])||!e[V].equals(m)){x&&(E=x),y&&(h=y),y=e[V],x=m?m.sub(y)._unit()._perp():E,E=E||x;var g=E.add(x);0===g.x&&0===g.y||g._unit();var S=g.x*x.x+g.y*x.y,L=0!==S?1/S:1/0,k=S<COS_HALF_SHARP_CORNER&&h&&m;if(k&&V>0){var I=y.dist(h);if(I>2*o){var N=y.sub(y.sub(h)._mult(o/I)._round());s.distance+=N.dist(h),s.addCurrentVertex(N,s.distance,E.mult(1),0,0,!1,_),h=N}}var b=h&&m,R=b?r:m?A:f;if(b&&"round"===R&&(L<n?R="miter":L<=2&&(R="fakeround")),"miter"===R&&L>a&&(R="bevel"),"bevel"===R&&(L>2&&(R="flipbevel"),L<a&&(R="miter")),h&&(s.distance+=y.dist(h)),"miter"===R)g._mult(L),s.addCurrentVertex(y,s.distance,g,0,0,!1,_);else if("flipbevel"===R){if(L>100)g=x.clone().mult(-1);else{var q=E.x*x.y-E.y*x.x>0?-1:1,F=L*E.add(x).mag()/E.sub(x).mag();g._perp()._mult(F*q)}s.addCurrentVertex(y,s.distance,g,0,0,!1,_),s.addCurrentVertex(y,s.distance,g.mult(-1),0,0,!1,_)}else if("bevel"===R||"fakeround"===R){var B=E.x*x.y-E.y*x.x>0,D=-Math.sqrt(L*L-1);if(B?(v=0,C=D):(C=0,v=D),T||s.addCurrentVertex(y,s.distance,E,C,v,!1,_),"fakeround"===R){for(var U=Math.floor(8*(.5-(S-.5))),P=void 0,M=0;M<U;M++)P=x.mult((M+1)/(U+1))._add(E)._unit(),s.addPieSliceVertex(y,s.distance,P,B,_);s.addPieSliceVertex(y,s.distance,g,B,_);for(var O=U-1;O>=0;O--)P=E.mult((O+1)/(U+1))._add(x)._unit(),s.addPieSliceVertex(y,s.distance,P,B,_)}m&&s.addCurrentVertex(y,s.distance,x,-C,-v,!1,_)}else"butt"===R?(T||s.addCurrentVertex(y,s.distance,E,0,0,!1,_),m&&s.addCurrentVertex(y,s.distance,x,0,0,!1,_)):"square"===R?(T||(s.addCurrentVertex(y,s.distance,E,1,1,!1,_),s.e1=s.e2=-1),m&&s.addCurrentVertex(y,s.distance,x,-1,-1,!1,_)):"round"===R&&(T||(s.addCurrentVertex(y,s.distance,E,0,0,!1,_),s.addCurrentVertex(y,s.distance,E,1,1,!0,_),s.e1=s.e2=-1),m&&(s.addCurrentVertex(y,s.distance,x,-1,-1,!0,_),s.addCurrentVertex(y,s.distance,x,0,0,!1,_)));if(k&&V<c-1){var X=y.dist(m);if(X>2*o){var H=y.add(m.sub(y)._mult(o/X)._round());s.distance+=H.dist(y),s.addCurrentVertex(H,s.distance,x.mult(1),0,0,!1,_),y=H}}T=!1}l.populatePaintArrays(d)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var d,u=n?1:0,c=this.arrays,o=c.layoutVertexArray,p=c.elementArray;d=r.clone(),i&&d._sub(r.perp()._mult(i)),addLineVertex(o,e,d,u,0,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,d=r.mult(-1),a&&d._sub(r.perp()._mult(a)),addLineVertex(o,e,d,u,1,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var s=this.arrays,d=s.layoutVertexArray,u=s.elementArray;addLineVertex(d,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);TrackingBucket.programInterface=trackingInterface,module.exports=TrackingBucket;
},{"../bucket":201,"../element_array_type":216,"../extent":217,"../load_geometry":219,"../vertex_array_type":223,"vector-tile":190}],214:[function(require,module,exports){
"use strict";var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},Buffer=function(e,t,r){this.arrayBuffer=e.arrayBuffer,this.length=e.length,this.attributes=t.members,this.itemSize=t.bytesPerElement,this.type=r,this.arrayType=t};Buffer.fromStructArray=function(e,t){return new Buffer(e.serialize(),e.constructor.serialize(),t)},Buffer.prototype.bind=function(e){var t=e[this.type];this.buffer?e.bindBuffer(t,this.buffer):(this.gl=e,this.buffer=e.createBuffer(),e.bindBuffer(t,this.buffer),e.bufferData(t,this.arrayBuffer,e.STATIC_DRAW),this.arrayBuffer=null)},Buffer.prototype.setVertexAttribPointers=function(e,t,r){for(var f=this,i=0;i<this.attributes.length;i++){var u=f.attributes[i],s=t[u.name];void 0!==s&&e.vertexAttribPointer(s,u.components,e[AttributeType[u.type]],!1,f.arrayType.bytesPerElement,u.offset+(f.arrayType.bytesPerElement*r||0))}},Buffer.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},Buffer.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},module.exports=Buffer;
},{}],215:[function(require,module,exports){
"use strict";var util=require("../util/util"),Buffer=require("./buffer"),ProgramConfiguration=require("./program_configuration"),VertexArrayObject=require("../render/vertex_array_object"),BufferGroup=function(e,r,t,a){var f=this;this.layoutVertexBuffer=new Buffer(a.layoutVertexArray,e.layoutVertexArrayType.serialize(),Buffer.BufferType.VERTEX),a.elementArray&&(this.elementBuffer=new Buffer(a.elementArray,e.elementArrayType.serialize(),Buffer.BufferType.ELEMENT)),a.elementArray2&&(this.elementBuffer2=new Buffer(a.elementArray2,e.elementArrayType2.serialize(),Buffer.BufferType.ELEMENT)),this.layerData={};for(var n=0,u=r;n<u.length;n+=1){var i=u[n],s=a.paintVertexArrays&&a.paintVertexArrays[i.id],o=ProgramConfiguration.createDynamic(e.paintAttributes||[],i,t),y=s?new Buffer(s.array,s.type,Buffer.BufferType.VERTEX):null;f.layerData[i.id]={programConfiguration:o,paintVertexBuffer:y}}this.segments=a.segments,this.segments2=a.segments2;for(var l=0,m=[f.segments,f.segments2];l<m.length;l+=1)for(var B=m[l],p=0,g=B||[];p<g.length;p+=1){var h=g[p];h.vaos=util.mapObject(f.layerData,function(){return new VertexArrayObject})}};BufferGroup.prototype.destroy=function(){var e=this;this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy();for(var r in e.layerData){var t=e.layerData[r].paintVertexBuffer;t&&t.destroy()}for(var a=0,f=[e.segments,e.segments2];a<f.length;a+=1)for(var n=f[a],u=0,i=n||[];u<i.length;u+=1){var s=i[u];for(var o in s.vaos)s.vaos[o].destroy()}},module.exports=BufferGroup;
},{"../render/vertex_array_object":252,"../util/util":399,"./buffer":214,"./program_configuration":221}],216:[function(require,module,exports){
"use strict";function createElementArrayType(e){return createStructArrayType({members:[{type:"Uint16",name:"vertices",components:e||3}]})}var createStructArrayType=require("../util/struct_array");module.exports=createElementArrayType;
},{"../util/struct_array":396}],217:[function(require,module,exports){
"use strict";module.exports=8192;
},{}],218:[function(require,module,exports){
"use strict";function translateDistance(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function topDownFeatureComparator(e,t){return t-e}function getLineWidth(e,t){return t>0?t+2*e:e}function translate(e,t,r,i,a){if(!t[0]&&!t[1])return e;t=Point.convert(t),"viewport"===r&&t._rotate(-i);for(var n=[],s=0;s<e.length;s++){for(var o=e[s],l=[],u=0;u<o.length;u++)l.push(o[u].sub(t._mult(a)));n.push(l)}return n}function offsetLine(e,t){for(var r=[],i=new Point(0,0),a=0;a<e.length;a++){for(var n=e[a],s=[],o=0;o<n.length;o++){var l=n[o-1],u=n[o],y=n[o+1],c=0===o?i:u.sub(l)._unit()._perp(),f=o===n.length-1?i:y.sub(u)._unit()._perp(),h=c._add(f)._unit(),d=h.x*f.x+h.y*f.y;h._mult(1/d),s.push(h._mult(t)._add(u))}r.push(s)}return r}var Point=require("point-geometry"),loadGeometry=require("./load_geometry"),EXTENT=require("./extent"),featureFilter=require("../style-spec/feature_filter"),createStructArrayType=require("../util/struct_array"),Grid=require("grid-index"),DictionaryCoder=require("../util/dictionary_coder"),vt=require("vector-tile"),Protobuf=require("pbf"),GeoJSONFeature=require("../util/vectortile_to_geojson"),arraysIntersect=require("../util/util").arraysIntersect,intersection=require("../util/intersection_tests"),multiPolygonIntersectsBufferedMultiPoint=intersection.multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon=intersection.multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine=intersection.multiPolygonIntersectsBufferedMultiLine,FeatureIndexArray=createStructArrayType({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),FeatureIndex=function(e,t,r){if(e.grid){var i=e,a=t;e=i.coord,t=i.overscaling,this.grid=new Grid(i.grid),this.featureIndexArray=new FeatureIndexArray(i.featureIndexArray),this.rawTileData=a,this.bucketLayerIDs=i.bucketLayerIDs,this.paintPropertyStatistics=i.paintPropertyStatistics}else this.grid=new Grid(EXTENT,16,0),this.featureIndexArray=new FeatureIndexArray;this.coord=e,this.overscaling=t,this.x=e.x,this.y=e.y,this.z=e.z-Math.log(t)/Math.LN2,this.setCollisionTile(r)};FeatureIndex.prototype.insert=function(e,t){var r=this,i=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(e.index,e.sourceLayerIndex,t);for(var a=loadGeometry(e),n=0;n<a.length;n++){for(var s=a[n],o=[1/0,1/0,-(1/0),-(1/0)],l=0;l<s.length;l++){var u=s[l];o[0]=Math.min(o[0],u.x),o[1]=Math.min(o[1],u.y),o[2]=Math.max(o[2],u.x),o[3]=Math.max(o[3],u.y)}r.grid.insert(i,o[0],o[1],o[2],o[3])}},FeatureIndex.prototype.setCollisionTile=function(e){this.collisionTile=e},FeatureIndex.prototype.serialize=function(e){var t=this.grid.toArrayBuffer();return e&&e.push(t),{coord:this.coord,overscaling:this.overscaling,grid:t,featureIndexArray:this.featureIndexArray.serialize(e),bucketLayerIDs:this.bucketLayerIDs,paintPropertyStatistics:this.paintPropertyStatistics}},FeatureIndex.prototype.query=function(e,t){var r=this;this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers,this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var i={},a=e.params||{},n=EXTENT/e.tileSize/e.scale,s=featureFilter(a.filter),o=0;for(var l in t)if(r.hasLayer(l)){var u=t[l],y=0;if("line"===u.type||"airline"===u.type||"sprite"===u.type||"tracking"===u.type||"dynamicLine"===u.type){var c=u.type,f=getLineWidth(r.getPaintValue(c+"-width",u),r.getPaintValue(c+"-gap-width",u)),h=r.getPaintValue(c+"-offset",u),d=r.getPaintValue(c+"-translate",u);y=f/2+Math.abs(h)+translateDistance(d)}else if("fill"===u.type)y=translateDistance(r.getPaintValue("fill-translate",u));else if("extrusion"===u.type||"histogram"===u.type||"collada"===u.type){var p=u.type;y=translateDistance(r.getPaintValue(p+"-translate",u))}else"circle"===u.type&&(y=r.getPaintValue("circle-radius",u)+translateDistance(r.getPaintValue("circle-translate",u)));o=Math.max(o,y*n)}for(var g=e.queryGeometry.map(function(e){return e.map(function(e){return new Point(e.x,e.y)})}),v=1/0,x=1/0,m=-(1/0),P=-(1/0),I=0;I<g.length;I++)for(var L=g[I],M=0;M<L.length;M++){var b=L[M];v=Math.min(v,b.x),x=Math.min(x,b.y),m=Math.max(m,b.x),P=Math.max(P,b.y)}var V=this.grid.query(v-o,x-o,m+o,P+o);V.sort(topDownFeatureComparator),this.filterMatching(i,V,this.featureIndexArray,g,s,a.layers,t,e.bearing,n);var w=this.collisionTile.queryRenderedSymbols(g,e.scale);return w.sort(),this.filterMatching(i,w,this.collisionTile.collisionBoxArray,g,s,a.layers,t,e.bearing,n),i},FeatureIndex.prototype.filterMatching=function(e,t,r,i,a,n,s,o,l){for(var u,y=this,c=0;c<t.length;c++){var f=t[c];if(f!==u){u=f;var h=r.get(f),d=y.bucketLayerIDs[h.bucketIndex];if(!n||arraysIntersect(n,d)){var p=y.sourceLayerCoder.decode(h.sourceLayerIndex),g=y.vtLayers[p],v=g.feature(h.featureIndex);if(a(v))for(var x=null,m=0;m<d.length;m++){var P=d[m];if(!(n&&n.indexOf(P)<0)){var I=s[P];if(I){var L=void 0;if("symbol"!==I.type&&"symtracking"!=I.type)if(x||(x=loadGeometry(v)),"line"===I.type||"airline"===I.type||"sprite"===I.type||"tracking"===I.type||"dynamicLine"===I.type){var M=I.type;L=translate(i,y.getPaintValue(M+"-translate",I,v),y.getPaintValue(M+"-translate-anchor",I,v),o,l);var b=l/2*getLineWidth(y.getPaintValue(M+"-width",I,v),y.getPaintValue(M+"-gap-width",I,v)),V=y.getPaintValue(M+"-offset",I,v);if(V&&(x=offsetLine(x,V*l)),!multiPolygonIntersectsBufferedMultiLine(L,x,b))continue}else if("fill"===I.type||"extrusion"===I.type||"histogram"===I.type||"collada"===I.type){var w=I.type;if(L=translate(i,y.getPaintValue(w+"-translate",I,v),y.getPaintValue(w+"-translate-anchor",I,v),o,l),!multiPolygonIntersectsMultiPolygon(L,x))continue}else if("circle"===I.type){L=translate(i,y.getPaintValue("circle-translate",I,v),y.getPaintValue("circle-translate-anchor",I,v),o,l);var F=y.getPaintValue("circle-radius",I,v)*l;if(!multiPolygonIntersectsBufferedMultiPoint(L,x,F))continue}var _=new GeoJSONFeature(v,y.z,y.x,y.y);_.layer=I.serialize();var D=e[P];void 0===D&&(D=e[P]=[]),D.push(_)}}}}}}},FeatureIndex.prototype.hasLayer=function(e){var t=this;for(var r in t.bucketLayerIDs)for(var i=0,a=t.bucketLayerIDs[r];i<a.length;i+=1){var n=a[i];if(e===n)return!0}return!1},FeatureIndex.prototype.getPaintValue=function(e,t,r){if(t.isPaintValueFeatureConstant(e)||r){var i=r?r.properties:{};return t.getPaintValue(e,{zoom:this.z},i)}return this.paintPropertyStatistics[t.id][e].max},module.exports=FeatureIndex;
},{"../style-spec/feature_filter":275,"../util/dictionary_coder":377,"../util/intersection_tests":387,"../util/struct_array":396,"../util/util":399,"../util/vectortile_to_geojson":400,"./extent":217,"./load_geometry":219,"grid-index":136,"pbf":153,"point-geometry":154,"vector-tile":190}],219:[function(require,module,exports){
"use strict";function createBounds(e){return{min:-1*Math.pow(2,e-1),max:Math.pow(2,e-1)-1}}var util=require("../util/util"),EXTENT=require("./extent"),boundsLookup={15:createBounds(15),16:createBounds(16)};module.exports=function(e,t){for(var r=boundsLookup[t||16],o=EXTENT/e.extent,u=e.loadGeometry(),n=0;n<u.length;n++)for(var a=u[n],i=0;i<a.length;i++){var d=a[i];d.x=Math.round(d.x*o),d.y=Math.round(d.y*o),(d.x<r.min||d.x>r.max||d.y<r.min||d.y>r.max)&&util.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u};
},{"../util/util":399,"./extent":217}],220:[function(require,module,exports){
"use strict";var createStructArrayType=require("../util/struct_array"),PosArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2}]});module.exports=PosArray;
},{"../util/struct_array":396}],221:[function(require,module,exports){
"use strict";function getPaintAttributeValue(t,r,e,i){if(!t.zoomStops)return r.getPaintValue(t.property,e,i);var a=t.zoomStops.map(function(a){return r.getPaintValue(t.property,util.extend({},e,{zoom:a}),i)});return 1===a.length?a[0]:a}function normalizePaintAttribute(t,r){var e=t.name;e||(e=t.property.replace(r.type+"-","").replace(/-/g,"_"));var i="color"===r._paintSpecifications[t.property].type;return util.extend({name:"a_"+e,components:i?4:1,multiplier:i?255:1,dimensions:i?4:1},t)}var createVertexArrayType=require("./vertex_array_type"),util=require("../util/util"),ProgramConfiguration=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};ProgramConfiguration.createDynamic=function(t,r,e){for(var i=new ProgramConfiguration,a=0,n=t;a<n.length;a+=1){var o=n[a],p=normalizePaintAttribute(o,r),u=p.name.slice(2);r.isPaintValueFeatureConstant(p.property)?i.addZoomAttribute(u,p):r.isPaintValueZoomConstant(p.property)?i.addPropertyAttribute(u,p):i.addZoomAndPropertyAttribute(u,p,r,e)}return i.PaintVertexArray=createVertexArrayType(i.attributes),i},ProgramConfiguration.createStatic=function(t){for(var r=new ProgramConfiguration,e=0,i=t;e<i.length;e+=1){var a=i[e];r.addUniform(a,"u_"+a)}return r},ProgramConfiguration.prototype.addUniform=function(t,r){var e=this.getPragmas(t);e.define.push("uniform {precision} {type} "+r+";"),e.initialize.push("{precision} {type} "+t+" = "+r+";"),this.cacheKey+="/u_"+t},ProgramConfiguration.prototype.addZoomAttribute=function(t,r){this.uniforms.push(r),this.addUniform(t,r.name)},ProgramConfiguration.prototype.addPropertyAttribute=function(t,r){var e=this.getPragmas(t);this.attributes.push(r),e.define.push("varying {precision} {type} "+t+";"),e.vertex.define.push("attribute {precision} {type} "+r.name+";"),e.vertex.initialize.push(t+" = "+r.name+" / "+r.multiplier+".0;"),this.cacheKey+="/a_"+t},ProgramConfiguration.prototype.addZoomAndPropertyAttribute=function(t,r,e,i){var a=this,n=this.getPragmas(t);n.define.push("varying {precision} {type} "+t+";");for(var o=0,p=e.getPaintValueStopZoomLevels(r.property);o<p.length&&p[o]<i;)o++;var u=Math.max(0,Math.min(p.length-4,o-2)),s="u_"+t+"_t";n.vertex.define.push("uniform lowp float "+s+";"),this.interpolationUniforms.push({name:s,property:r.property,stopOffset:u});for(var m=[],f=0;f<4;f++)m.push(p[Math.min(u+f,p.length-1)]);var g=[];if(1===r.components)this.attributes.push(util.extend({},r,{components:4,zoomStops:m})),n.vertex.define.push("attribute {precision} vec4 "+r.name+";"),g.push(r.name);else for(var h=0;h<4;h++){var l=r.name+h;g.push(l),a.attributes.push(util.extend({},r,{name:l,zoomStops:[m[h]]})),n.vertex.define.push("attribute {precision} {type} "+l+";")}n.vertex.initialize.push(t+" = evaluate_zoom_function_"+r.components+"(            "+g.join(", ")+", "+s+") / "+r.multiplier+".0;"),this.cacheKey+="/z_"+t},ProgramConfiguration.prototype.getPragmas=function(t){return this.pragmas[t]||(this.pragmas[t]={define:[],initialize:[]},this.pragmas[t].fragment={define:[],initialize:[]},this.pragmas[t].vertex={define:[],initialize:[]}),this.pragmas[t]},ProgramConfiguration.prototype.applyPragmas=function(t,r){var e=this;return t.replace(/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(t,i,a,n,o){return e.pragmas[o][i].concat(e.pragmas[o][r][i]).join("\n").replace(/{type}/g,n).replace(/{precision}/g,a)})},ProgramConfiguration.prototype.createPaintPropertyStatistics=function(){for(var t=this,r={},e=0,i=t.attributes;e<i.length;e+=1){var a=i[e];1===a.dimensions&&(r[a.property]={max:-(1/0)})}return r},ProgramConfiguration.prototype.populatePaintArray=function(t,r,e,i,a,n){var o=this,p=r.length;r.resize(i);for(var u=0,s=o.attributes;u<s.length;u+=1)for(var m=s[u],f=getPaintAttributeValue(m,t,a,n),g=p;g<i;g++){var h=r.get(g);if(4===m.components)for(var l=0;l<4;l++)h[m.name+l]=f[l]*m.multiplier;else h[m.name]=f*m.multiplier;if(1===m.dimensions){var c=e[m.property];c.max=Math.max(c.max,1===m.components?f:Math.max.apply(Math,f))}}},ProgramConfiguration.prototype.setUniforms=function(t,r,e,i){for(var a=this,n=0,o=a.uniforms;n<o.length;n+=1){var p=o[n],u=e.getPaintValue(p.property,i);4===p.components?t.uniform4fv(r[p.name],u):t.uniform1f(r[p.name],u)}for(var s=0,m=a.interpolationUniforms;s<m.length;s+=1){var f=m[s],g=e.getPaintInterpolationT(f.property,i);t.uniform1f(r[f.name],Math.max(0,Math.min(4,g-f.stopOffset)))}},module.exports=ProgramConfiguration;
},{"../util/util":399,"./vertex_array_type":223}],222:[function(require,module,exports){
"use strict";var createStructArrayType=require("../util/struct_array"),RasterBoundsArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});module.exports=RasterBoundsArray;
},{"../util/struct_array":396}],223:[function(require,module,exports){
"use strict";function createVertexArrayType(r){return createStructArrayType({members:r,alignment:4})}var createStructArrayType=require("../util/struct_array");module.exports=createVertexArrayType;
},{"../util/struct_array":396}],224:[function(require,module,exports){
"use strict";function getRoutesData(t){for(var i=t.segmt,e=[],n=0;n<i.length;n++)e.push({type:"Feature",geometry:i[n].clist.geometry});return e}function get2Char(t){var i=t+"";return 1===i.length&&(i="0"+i),i}var LngLat=require("../geo/lng_lat"),ajax=require("../util/ajax"),config=require("../util/config"),RenderRoute=require("./lib/driving_render_route"),COSTMODEL={NONE:0,FASTEST_ROAD_CONDITION:1,SHORTEST_ROAD_CONDITION:2,MOST_ECONOMICAL_ROAD_CONDITION:4,GREEN:8,FASTEST:16,SHORTEST:32,MOST_ECONOMICAL:64},CRITERIA={NONE:0,AVOID_CHARGE_FEE:1,AVOID_HIGH_WAY:2,AVOID_FERRY:4,AVOID_CARPOOL:8,AVOID_ROADPERMINT:16,AVOID_VIADUCT:32,AVOID_TUNNEL:64},option={numAlt:1,costModel:16,criteria:0,lineColor:"blue"},DrivingRoute=function(t){this.CRITERIA=CRITERIA,this.COSTMODEL=COSTMODEL,this.options=t||{},this.options.numAlt&&(this.options.numAlt<=0?this.options.numAlt=1:this.options.numAlt>=3&&(this.options.numAlt=3)),this.renderRoute=new RenderRoute(t)};DrivingRoute.prototype.addTo=function(t){return this.map=t,this.startPoint=[],this.endPoint=[],this.geojsonData=null,this.endMarker=null,this.renderRoute.addMap(t),this},DrivingRoute.prototype.search=function(t,i){var e=this;this.setUpRoutPoints(t,i);var n=config.DRIVING_ROUTE_URL+e.makeQueryString();ajax.getJSON(n,function(t,i){t?console.log(t):e.renderData(i.data.rows)})},DrivingRoute.prototype.getGeoJsonData=function(){return this.geojsonData},DrivingRoute.prototype.renderData=function(t){if(t){for(var i=[],e=0;e<t.length;e++)i.push(getRoutesData(t[e]));this.geojsonData=this.renderRoute.renderAndGetGeoJsonData(i,this.startPoint,this.endPoint)}},DrivingRoute.prototype.makeQueryString=function(){return"?token="+config.ACCESS_TOKEN+"&sPoint="+this.startPoint[0]+","+this.startPoint[1]+"&ePoint="+this.endPoint[0]+","+this.endPoint[1]+this._getQueryStr("numAlt")+this._getQueryStr("costModel")+this._getQueryStr("criteria")},DrivingRoute.prototype._getQueryStr=function(t){return this.options[t]?"&"+t+"="+this.options[t]:""},DrivingRoute.prototype.setUpRoutPoints=function(t,i){this.startPoint=[],this.endPoint=[],t instanceof LngLat&&i instanceof LngLat?(this.startPoint=t.toArray(),this.endPoint=i.toArray()):t instanceof Array&&i instanceof Array&&(this.startPoint.push(t[0],t[1]),this.endPoint.push(i[0],i[1]))},DrivingRoute.prototype.clear=function(){this.renderRoute.clear()},DrivingRoute.prototype.destroy=function(){this.geojsonData=null,this.startPoint=[],this.endPoint=[],this.renderRoute.destroy(),this.map=null},DrivingRoute.CRITERIA=CRITERIA,DrivingRoute.COSTMODEL=COSTMODEL,module.exports=DrivingRoute;
},{"../geo/lng_lat":227,"../util/ajax":370,"../util/config":376,"./lib/driving_render_route":225}],225:[function(require,module,exports){
var sourceId="_route_path_json_source_",layerId="_route_path_json_line_layer_",dashLayerId="_route_path_json_line_dash_layer_",lineColor=["#5c8ffd","#666666","#666666"],Marker=require("../../ui/marker"),RenderRoute=function(e){this.options=e,this.startMarker=null};RenderRoute.prototype.addMap=function(e){this.map=e},RenderRoute.prototype.renderAndGetGeoJsonData=function(e,r,t){for(var a,o=this,n=0;n<e.length;n++){for(var i=e[n],d={type:"geojson",data:{type:"FeatureCollection",features:[]}},s=0;s<i.length;s++)d.data.features.push(i[s]);d.data.features.push({type:"Feature",properties:{line_type:"dasharray"},geometry:{type:"LineString",coordinates:[r,i[0].geometry.coordinates[0]]}}),d.data.features.push({type:"Feature",properties:{line_type:"dasharray"},geometry:{type:"LineString",coordinates:[t,i[i.length-1].geometry.coordinates[i[i.length-1].geometry.coordinates.length-1]]}}),o.addMarker(r,t),o.addLayer(d,n),0===n&&(a=d)}return a.data},RenderRoute.prototype.addMarker=function(e,r){this.clearMarker();var t=document.createElement("div");t.id="minemap-routing-marker-start-img",this.startMarker=new Marker(t,{offset:[-18,-18]}).setLngLat(e).addTo(this.map);var t=document.createElement("div");t.id="minemap-routing-marker-end-img",this.endMarker=new Marker(t,{offset:[-18,-18]}).setLngLat(r).addTo(this.map)},RenderRoute.prototype.clearMarker=function(){this.startMarker&&this.startMarker.remove(),this.endMarker&&this.endMarker.remove()},RenderRoute.prototype.addLayer=function(e,r){this.map.getSource(sourceId+r)?this.map.getSource(sourceId+r).setData(e.data):(this.map.addSource(sourceId+r,e),this.map.addLayer({id:layerId+r,type:"line",source:sourceId+r,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":this.options.lineColor||lineColor[r],"line-width":5,"line-opacity":.8},filter:["all",["==","$type","LineString"],["!=","line_type","dasharray"]]}),this.map.addLayer({id:dashLayerId+r,type:"line",source:sourceId+r,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ff00","line-width":5,"line-opacity":.8,"line-dasharray":[2,2]},filter:["==","line_type","dasharray"]}))},RenderRoute.prototype.clear=function(){var e=this;this.clearMarker();for(var r=0;r<3;r++)e.map.getSource(sourceId+r)&&(e.map.removeSource(sourceId+r),e.map.removeLayer(layerId+r),e.map.removeLayer(dashLayerId+r))},RenderRoute.prototype.destroy=function(){this.clear(),this.map=null,this.geojsonData=null},module.exports=RenderRoute;
},{"../../ui/marker":367}],226:[function(require,module,exports){
"use strict";var Coordinate=function(o,t,n){this.column=o,this.row=t,this.zoom=n};Coordinate.prototype.clone=function(){return new Coordinate(this.column,this.row,this.zoom)},Coordinate.prototype.zoomTo=function(o){return this.clone()._zoomTo(o)},Coordinate.prototype.sub=function(o){return this.clone()._sub(o)},Coordinate.prototype._zoomTo=function(o){var t=Math.pow(2,o-this.zoom);return this.column*=t,this.row*=t,this.zoom=o,this},Coordinate.prototype._sub=function(o){return o=o.zoomTo(this.zoom),this.column-=o.column,this.row-=o.row,this},module.exports=Coordinate;
},{}],227:[function(require,module,exports){
"use strict";var wrap=require("../util/util").wrap,LngLat=function(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: ("+t+", "+n+")");if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};LngLat.prototype.wrap=function(){return new LngLat(wrap(this.lng,-180,180),this.lat)},LngLat.prototype.wrapToBestWorld=function(t){var n=new LngLat(this.lng,this.lat);return Math.abs(this.lng-t.lng)>180&&(t.lng<0?n.lng-=360:n.lng+=360),n},LngLat.prototype.toArray=function(){return[this.lng,this.lat]},LngLat.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},LngLat.convert=function(t){if(t instanceof LngLat)return t;if(t&&t.hasOwnProperty("lng")&&t.hasOwnProperty("lat"))return new LngLat(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new LngLat(t[0],t[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},module.exports=LngLat;
},{"../util/util":399}],228:[function(require,module,exports){
"use strict";var LngLat=require("./lng_lat"),LngLatBounds=function(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};LngLatBounds.prototype.setNorthEast=function(t){return this._ne=LngLat.convert(t),this},LngLatBounds.prototype.setSouthWest=function(t){return this._sw=LngLat.convert(t),this},LngLatBounds.prototype.extend=function(t){var n,e,s=this._sw,o=this._ne;if(t instanceof LngLat)n=t,e=t;else{if(!(t instanceof LngLatBounds))return Array.isArray(t)?t.every(Array.isArray)?this.extend(LngLatBounds.convert(t)):this.extend(LngLat.convert(t)):this;if(n=t._sw,e=t._ne,!n||!e)return this}return s||o?(s.lng=Math.min(n.lng,s.lng),s.lat=Math.min(n.lat,s.lat),o.lng=Math.max(e.lng,o.lng),o.lat=Math.max(e.lat,o.lat)):(this._sw=new LngLat(n.lng,n.lat),this._ne=new LngLat(e.lng,e.lat)),this},LngLatBounds.prototype.getCenter=function(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},LngLatBounds.prototype.getSouthWest=function(){return this._sw},LngLatBounds.prototype.getNorthEast=function(){return this._ne},LngLatBounds.prototype.getNorthWest=function(){return new LngLat(this.getWest(),this.getNorth())},LngLatBounds.prototype.getSouthEast=function(){return new LngLat(this.getEast(),this.getSouth())},LngLatBounds.prototype.getWest=function(){return this._sw.lng},LngLatBounds.prototype.getSouth=function(){return this._sw.lat},LngLatBounds.prototype.getEast=function(){return this._ne.lng},LngLatBounds.prototype.getNorth=function(){return this._ne.lat},LngLatBounds.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},LngLatBounds.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},LngLatBounds.convert=function(t){return!t||t instanceof LngLatBounds?t:new LngLatBounds(t)},module.exports=LngLatBounds;
},{"./lng_lat":227}],229:[function(require,module,exports){
"use strict";var LngLat=require("./lng_lat"),Point=require("point-geometry"),Coordinate=require("./coordinate"),util=require("../util/util"),interp=require("../util/interpolate"),TileCoord=require("../source/tile_coord"),EXTENT=require("../data/extent"),glmatrix=require("@minemap/gl-matrix"),vec4=glmatrix.vec4,mat4=glmatrix.mat4,mat2=glmatrix.mat2,Transform=function(t,i,o){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},prototypeAccessors={minZoom:{},maxZoom:{},renderWorldCopies:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};prototypeAccessors.minZoom.get=function(){return this._minZoom},prototypeAccessors.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},prototypeAccessors.maxZoom.get=function(){return this._maxZoom},prototypeAccessors.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},prototypeAccessors.renderWorldCopies.get=function(){return this._renderWorldCopies},prototypeAccessors.worldSize.get=function(){return this.tileSize*this.scale},prototypeAccessors.centerPoint.get=function(){return this.size._div(2)},prototypeAccessors.size.get=function(){return new Point(this.width,this.height)},prototypeAccessors.bearing.get=function(){return-this.angle/Math.PI*180},prototypeAccessors.bearing.set=function(t){var i=-util.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},prototypeAccessors.pitch.get=function(){return this._pitch/Math.PI*180},prototypeAccessors.pitch.set=function(t){var i=util.clamp(t,0,60)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},prototypeAccessors.fov.get=function(){return this._fov/Math.PI*180},prototypeAccessors.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},prototypeAccessors.zoom.get=function(){return this._zoom},prototypeAccessors.zoom.set=function(t){var i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom,this._constrain(),this._calcMatrices())},prototypeAccessors.center.get=function(){return this._center},prototypeAccessors.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Transform.prototype.coveringZoomLevel=function(t){var i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return 1===t.odevity&&i%2==0?i+=1:2===t.odevity&&i%2==1&&(i+=1),i},Transform.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),o=i;if(i<t.minzoom)return[];i>t.maxzoom&&(i=t.maxzoom);var e=this.pointCoordinate(this.centerPoint,i),r=new Point(e.column-.5,e.row-.5),n=[this.pointCoordinate(new Point(0,0),i),this.pointCoordinate(new Point(this.width,0),i),this.pointCoordinate(new Point(this.width,this.height),i),this.pointCoordinate(new Point(0,this.height),i)];return TileCoord.cover(i,n,t.reparseOverscaled?o:i,this._renderWorldCopies).sort(function(t,i){return r.dist(t)-r.dist(i)})},Transform.prototype.resize=function(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()},prototypeAccessors.unmodified.get=function(){return this._unmodified},Transform.prototype.zoomScale=function(t){return Math.pow(2,t)},Transform.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Transform.prototype.project=function(t){return new Point(this.lngX(t.lng),this.latY(t.lat))},Transform.prototype.unproject=function(t){return new LngLat(this.xLng(t.x),this.yLat(t.y))},prototypeAccessors.x.get=function(){return this.lngX(this.center.lng)},prototypeAccessors.y.get=function(){return this.latY(this.center.lat)},prototypeAccessors.point.get=function(){return new Point(this.x,this.y)},Transform.prototype.lngX=function(t){return(180+t)*this.worldSize/360},Transform.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},Transform.prototype.xLng=function(t){return 360*t/this.worldSize-180},Transform.prototype.yLat=function(t){var i=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90},Transform.prototype.setLocationAtPoint=function(t,i){var o=this.pointCoordinate(i)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(o)),this._renderWorldCopies&&(this.center=this.center.wrap())},Transform.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Transform.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Transform.prototype.locationCoordinate=function(t){return new Coordinate(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},Transform.prototype.coordinateLocation=function(t){var i=t.zoomTo(this.zoom);return new LngLat(this.xLng(i.column*this.tileSize),this.yLat(i.row*this.tileSize))},Transform.prototype.pointCoordinate=function(t,i){void 0===i&&(i=this.tileZoom);var o=[t.x,t.y,0,1],e=[t.x,t.y,1,1];vec4.transformMat4(o,o,this.pixelMatrixInverse),vec4.transformMat4(e,e,this.pixelMatrixInverse);var r=o[3],n=e[3],s=o[0]/r,a=e[0]/n,h=o[1]/r,c=e[1]/n,m=o[2]/r,p=e[2]/n,l=m===p?0:(0-m)/(p-m);return new Coordinate(interp(s,a,l)/this.tileSize,interp(h,c,l)/this.tileSize,this.zoom)._zoomTo(i)},Transform.prototype.coordinatePoint=function(t){var i=t.zoomTo(this.zoom),o=[i.column*this.tileSize,i.row*this.tileSize,0,1];return vec4.transformMat4(o,o,this.pixelMatrix),new Point(o[0]/o[3],o[1]/o[3])},Transform.prototype.calculatePosMatrix=function(t,i){var o=t.toCoordinate(i),e=this.worldSize/this.zoomScale(o.zoom),r=mat4.identity(new Float64Array(16));return mat4.translate(r,r,[o.column*e,o.row*e,0]),mat4.scale(r,r,[e/EXTENT,e/EXTENT,1]),mat4.multiply(r,this.projMatrix,r),new Float32Array(r)},Transform.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,i,o,e,r,n,s,a,h=this.size,c=this._unmodified;this.latRange&&(t=this.latY(this.latRange[1]),i=this.latY(this.latRange[0]),r=i-t<h.y?h.y/(i-t):0),this.lngRange&&(o=this.lngX(this.lngRange[0]),e=this.lngX(this.lngRange[1]),n=e-o<h.x?h.x/(e-o):0);var m=Math.max(n||0,r||0);if(m)return this.center=this.unproject(new Point(n?(e+o)/2:this.x,r?(i+t)/2:this.y)),this.zoom+=this.scaleZoom(m),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var p=this.y,l=h.y/2;p-l<t&&(a=t+l),p+l>i&&(a=i-l)}if(this.lngRange){var u=this.x,f=h.x/2;u-f<o&&(s=o+f),u+f>e&&(s=e-f)}void 0===s&&void 0===a||(this.center=this.unproject(new Point(void 0!==s?s:this.x,void 0!==a?a:this.y))),this._unmodified=c,this._constraining=!1}},Transform.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,i=Math.PI/2+this._pitch,o=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),e=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,r=1.01*e,n=new Float64Array(16);mat4.perspective(n,this._fov,this.width/this.height,1,r),mat4.scale(n,n,[1,-1,1]),mat4.translate(n,n,[0,0,-this.cameraToCenterDistance]),mat4.rotateX(n,n,this._pitch),mat4.rotateZ(n,n,this.angle),mat4.translate(n,n,[-this.x,-this.y,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(mat4.scale(n,n,[1,1,s,1]),this.projMatrix=n,n=mat4.create(),mat4.scale(n,n,[this.width/2,-this.height/2,1]),mat4.translate(n,n,[1,-1,0]),this.pixelMatrix=mat4.multiply(new Float64Array(16),n,this.projMatrix),!(n=mat4.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=n}},Object.defineProperties(Transform.prototype,prototypeAccessors),module.exports=Transform;
},{"../data/extent":217,"../source/tile_coord":266,"../util/interpolate":386,"../util/util":399,"./coordinate":226,"./lng_lat":227,"@minemap/gl-matrix":2,"point-geometry":154}],230:[function(require,module,exports){
"use strict";var browser=require("./util/browser"),minemap=module.exports={};minemap.version=require("../package.json").version,minemap.workerCount=Math.max(Math.floor(browser.hardwareConcurrency/2),1),minemap.Map=require("./ui/map"),minemap.Navigation=require("./ui/control/navigation_control"),minemap.Geolocate=require("./ui/control/geolocate_control"),minemap.Attribution=require("./ui/control/attribution_control"),minemap.Scale=require("./ui/control/scale_control"),minemap.Fullscreen=require("./ui/control/fullscreen_control"),minemap.Popup=require("./ui/popup"),minemap.Marker=require("./ui/marker"),minemap.Style=require("./style/style"),minemap.LngLat=require("./geo/lng_lat"),minemap.LngLatBounds=require("./geo/lng_lat_bounds"),minemap.Point=require("point-geometry"),minemap.Evented=require("./util/evented"),minemap.supported=require("./util/browser").supported,minemap.util={},minemap.util.getJSON=require("./util/ajax").getJSON,minemap.util.getArrayBuffer=require("./util/ajax").getArrayBuffer,minemap.PathTrack=require("./util/path_track"),minemap.DrivingRoute=require("./extends/driving_route"),minemap.turf=require("@turf/turf");var config=require("./util/config");minemap.config=config,minemap.service=require("./util/service");var rtlTextPlugin=require("./source/rtl_text_plugin");minemap.setRTLTextPlugin=rtlTextPlugin.setRTLTextPlugin,Object.defineProperty(minemap,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(e){config.ACCESS_TOKEN=e}}),Object.defineProperty(minemap,"solution",{get:function(){return config.SOLU},set:function(e){config.SOLU=e}}),Object.defineProperty(minemap,"dataVersion",{get:function(){return config.DATA_VERSION},set:function(e){config.DATA_VERSION=e}}),Object.defineProperty(minemap,"TRW",{get:function(){return config.TRW},set:function(e){config.TRW=e}}),Object.defineProperty(minemap,"spriteUrl",{get:function(){return config.spriteUrl},set:function(e){config.spriteUrl=e}}),Object.defineProperty(minemap,"fontsUrl",{get:function(){return config.fontsUrl},set:function(e){config.fontsUrl=e}}),Object.defineProperty(minemap,"serviceUrl",{get:function(){return config.serviceUrl},set:function(e){config.serviceUrl=e}}),Object.defineProperty(minemap,"domainUrl",{get:function(){return config.DOMAIN},set:function(e){config.DOMAIN=e,config.API_URL=config.DOMAIN+config.API_BASE,config.DYN_URL=config.DOMAIN+config.DYN_BASE,config.MERGE_URL=config.DOMAIN+config.MERGE_BASE,config.OTHER_URL=config.DOMAIN+config.OTHER_BASE,config.SRC_URL=config.DOMAIN+config.SRC_BASE,config.DRIVING_ROUTE_URL=config.DOMAIN+config.DRIVING_ROUTE_BASE}});
},{"../package.json":199,"./extends/driving_route":224,"./geo/lng_lat":227,"./geo/lng_lat_bounds":228,"./source/rtl_text_plugin":262,"./style/style":318,"./ui/control/attribution_control":352,"./ui/control/fullscreen_control":353,"./ui/control/geolocate_control":354,"./ui/control/navigation_control":356,"./ui/control/scale_control":357,"./ui/map":366,"./ui/marker":367,"./ui/popup":368,"./util/ajax":370,"./util/browser":372,"./util/config":376,"./util/evented":381,"./util/path_track":391,"./util/service":395,"@turf/turf":91,"point-geometry":154}],231:[function(require,module,exports){
"use strict";function drawLineTile(e,t,r,i,a,s,n,u,f,h){var o=t.gl;(u||f)&&o.uniform2f(e.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1]),u&&o.uniform1f(e.u_width,a.paint["airline-width"]),t.enableTileClippingMask(s);var T=t.translatePosMatrix(s.posMatrix,r,a.paint["airline-translate"],a.paint["airline-translate-anchor"]);o.uniformMatrix4fv(e.u_matrix,!1,T),o.uniform1f(e.u_ratio,1/pixelsToTileUnits(r,1,t.transform.zoom)),o.uniform1f(e.u_start,h-segmentGroup),o.uniform1f(e.u_segments,segmentGroup),o.uniform1f(e.u_discard,discardLine);for(var E=0,d=i.segments;E<d.length;E+=1){var m=d[E];m.vaos[a.id].bind(o,e,i.layoutVertexBuffer,i.elementBuffer,n.paintVertexBuffer,m.vertexOffset),o.drawElements(o.TRIANGLES,3*m.primitiveLength,o.UNSIGNED_SHORT,3*m.primitiveOffset*2)}}function ExtrusionTexture(e,t,r){this.gl=e,this.width=t.width,this.height=t.height,this.painter=t,this.layer=r,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}var browser=require("../util/browser"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),glMatrix=require("@minemap/gl-matrix"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),PosArray=require("../data/pos_array"),pattern=require("./pattern"),mat4=glMatrix.mat4,config=require("../util/config"),segmentGroup=20,discardLine=0;module.exports=function(e,t,r,i){var a=this;if(!e.isOpaquePass){var s=e.gl;s.disable(s.STENCIL_TEST),s.enable(s.DEPTH_TEST),e.depthMask(!0);var n=new ExtrusionTexture(s,e,r);if(n.bindFramebuffer(),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),!(r.paint["airline-width"]<=0)){segmentGroup=r.paint["airline-seg-group"]||20,discardLine="none"===r.paint["airline-type"]?0:1,"real-time"===r.paint["airline-type"]&&(this.count||(this.start=(new Date).getTime(),this.count=1),this.end=(new Date).getTime(),this.end-this.start>=1e3/r.paint["airline-speed"]&&(this.count+=1,this.start=this.end));for(var u,f=!0,h=0,o=i;h<o.length;h+=1){var T=o[h],E=t.getTile(T),d=E.getBucket(r);if(d){var m=d.buffers.layerData[r.id],R=e.currentProgram,p=e.useProgram("airline",m.programConfiguration),l=f||p!==R,b=u!==E.coord.z;l&&m.programConfiguration.setUniforms(e.gl,p,r,{zoom:e.transform.zoom}),drawLineTile(p,e,E,d.buffers,r,T,m,l,b,a.count),u=E.coord.z,f=!1}}n.unbindFramebuffer(),n.renderToMap()}}},ExtrusionTexture.prototype.bindFramebuffer=function(){var e=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),e.activeTexture(e.TEXTURE1),this.texture?e.bindTexture(e.TEXTURE_2D,this.texture):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);else{this.fbo=e.createFramebuffer();var t=e.createRenderbuffer(),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,this.width,this.height),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}},ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},ExtrusionTexture.prototype.renderToMap=function(){var e=this.gl,t=this.painter,r=t.useProgram("extrusionTexture");e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1f(r.u_opacity,1),e.uniform1i(r.u_texture,1),e.uniformMatrix4fv(r.u_matrix,!1,mat4.ortho(mat4.create(),0,t.width,t.height,0,0,1)),e.disable(e.DEPTH_TEST),e.uniform1i(r.u_xdim,t.width),e.uniform1i(r.u_ydim,t.height);var i=new PosArray;i.emplaceBack(0,0),i.emplaceBack(t.width,0),i.emplaceBack(0,t.height),i.emplaceBack(t.width,t.height);var a=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(e,r,a),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.DEPTH_TEST)};
},{"../data/buffer":214,"../data/pos_array":220,"../source/pixels_to_tile_units":259,"../util/browser":372,"../util/config":376,"./pattern":250,"./vertex_array_object":252,"@minemap/gl-matrix":2}],232:[function(require,module,exports){
"use strict";function drawBackground(r,t,e){var a=r.gl,i=r.transform,n=i.tileSize,o=e.paint["background-color"],l=e.paint["background-pattern"],u=e.paint["background-opacity"],f=!l&&1===o[3]&&1===u;if(r.isOpaquePass===f){a.disable(a.STENCIL_TEST),r.setDepthSublayer(0);var s;l?(s=r.useProgram("fillPattern",r.basicFillProgramConfiguration),pattern.prepare(l,r,s),r.tileExtentPatternVAO.bind(a,s,r.tileExtentBuffer)):(s=r.useProgram("fill",r.basicFillProgramConfiguration),a.uniform4fv(s.u_color,o),r.tileExtentVAO.bind(a,s,r.tileExtentBuffer)),a.uniform1f(s.u_opacity,u);for(var c=i.coveringTiles({tileSize:n}),g=0,p=c;g<p.length;g+=1){var d=p[g];l&&pattern.setTile({coord:d,tileSize:n},r,s),a.uniformMatrix4fv(s.u_matrix,!1,r.transform.calculatePosMatrix(d)),a.drawArrays(a.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}}}var pattern=require("./pattern");module.exports=drawBackground;
},{"./pattern":250}],233:[function(require,module,exports){
"use strict";function drawCircles(e,r,t,a){if(!e.isOpaquePass){var i=e.gl;e.setDepthSublayer(0),e.depthMask(!1),i.disable(i.STENCIL_TEST);for(var s=0;s<a.length;s++){var o=a[s],n=r.getTile(o),f=n.getBucket(t);if(f){var l=f.buffers,m=l.layerData[t.id],u=m.programConfiguration,c=e.useProgram("circle",u);u.setUniforms(i,c,t,{zoom:e.transform.zoom}),"map"===t.paint["circle-pitch-scale"]?(i.uniform1i(c.u_scale_with_map,!0),i.uniform2f(c.u_extrude_scale,e.transform.pixelsToGLUnits[0]*e.transform.cameraToCenterDistance,e.transform.pixelsToGLUnits[1]*e.transform.cameraToCenterDistance)):(i.uniform1i(c.u_scale_with_map,!1),i.uniform2fv(c.u_extrude_scale,e.transform.pixelsToGLUnits)),i.uniform1f(c.u_devicepixelratio,browser.devicePixelRatio),i.uniformMatrix4fv(c.u_matrix,!1,e.translatePosMatrix(o.posMatrix,n,t.paint["circle-translate"],t.paint["circle-translate-anchor"]));for(var p=0,v=l.segments;p<v.length;p+=1){var x=v[p];x.vaos[t.id].bind(i,c,l.layoutVertexBuffer,l.elementBuffer,m.paintVertexBuffer,x.vertexOffset),i.drawElements(i.TRIANGLES,3*x.primitiveLength,i.UNSIGNED_SHORT,3*x.primitiveOffset*2)}}}}}var browser=require("../util/browser");module.exports=drawCircles;
},{"../util/browser":372}],234:[function(require,module,exports){
"use strict";function draw(e,t,r,i){if(0!==r.paint["collada-opacity"]){var a=e.gl;a.disable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),e.depthMask(!0);var u=new ExtrusionTexture(a,e,r);u.bindFramebuffer(),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(var s=0;s<i.length;s++)drawExtrusion(e,t,r,i[s]);u.unbindFramebuffer(),u.renderToMap()}}function ExtrusionTexture(e,t,r){this.gl=e,this.width=t.width,this.height=t.height,this.painter=t,this.layer=r,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function drawExtrusion(e,t,r,i){if(!e.isOpaquePass){var a=t.getTile(i),u=a.getBucket(r);if(u){var s=u.buffers,h=e.gl,f=r.paint["collada-pattern"],n=s.layerData[r.id],o=n.programConfiguration,E=e.useProgram(f?"colladaPattern":"collada",o);o.setUniforms(h,E,r,{zoom:e.transform.zoom}),f&&(pattern.prepare(f,e,E),pattern.setTile(a,e,E),h.uniform1f(E.u_height_factor,-Math.pow(2,i.z)/a.tileSize/8)),e.gl.uniformMatrix4fv(E.u_matrix,!1,e.translatePosMatrix(i.posMatrix,a,r.paint["collada-translate"],r.paint["collada-translate-anchor"])),setLight(E,e);for(var T=0,l=s.segments;T<l.length;T+=1)for(var R=l[T],m=0;m<R.materials.length;m++){var d=e.gl;e.texture_cache.getTextureById(R.materials[m].image,!0,R.materials[m].image)?(d.activeTexture(d.TEXTURE5),d.bindTexture(d.TEXTURE_2D,e.texture_cache.getTextureById(R.materials[m].image,!0,R.materials[m].image)),d.uniform1i(E.u_big_texture,5)):d.uniform1i(E.u_big_texture,0),R.vaos[r.id].bind(d,E,s.layoutVertexBuffer,s.elementBuffer,n.paintVertexBuffer,R.vertexOffset),d.drawArrays(d.TRIANGLES,R.materials[m].groupStart,R.materials[m].groupCount)}}}}function setLight(e,t){var r=t.gl,i=t.style.light,a=i.calculated.position,u=[a.x,a.y,a.z],s=mat3.create();"viewport"===i.calculated.anchor&&mat3.fromRotation(s,-t.transform.angle),vec3.transformMat3(u,u,s),r.uniform3fv(e.u_lightpos,u),r.uniform1f(e.u_lightintensity,i.calculated.intensity),r.uniform3fv(e.u_lightcolor,i.calculated.color.slice(0,3))}var glMatrix=require("@minemap/gl-matrix"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),PosArray=require("../data/pos_array"),pattern=require("./pattern"),textures_cache=require("../util/testures_cache"),mat3=glMatrix.mat3,mat4=glMatrix.mat4,vec3=glMatrix.vec3;module.exports=draw,ExtrusionTexture.prototype.bindFramebuffer=function(){var e=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),e.activeTexture(e.TEXTURE1),this.texture?e.bindTexture(e.TEXTURE_2D,this.texture):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);else{this.fbo=e.createFramebuffer();var t=e.createRenderbuffer(),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,this.width,this.height),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}},ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},ExtrusionTexture.prototype.renderToMap=function(){var e=this.gl,t=this.painter,r=t.useProgram("extrusionTexture");e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1f(r.u_opacity,this.layer.paint["collada-opacity"]),e.uniform1i(r.u_texture,1),e.uniformMatrix4fv(r.u_matrix,!1,mat4.ortho(mat4.create(),0,t.width,t.height,0,0,1)),e.disable(e.DEPTH_TEST),e.uniform1i(r.u_xdim,t.width),e.uniform1i(r.u_ydim,t.height);var i=new PosArray;i.emplaceBack(0,0),i.emplaceBack(t.width,0),i.emplaceBack(0,t.height),i.emplaceBack(t.width,t.height);var a=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(e,r,a),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.DEPTH_TEST)};
},{"../data/buffer":214,"../data/pos_array":220,"../util/testures_cache":397,"./pattern":250,"./vertex_array_object":252,"@minemap/gl-matrix":2}],235:[function(require,module,exports){
"use strict";function drawCollisionDebug(e,o,r,i){var t=e.gl;t.enable(t.STENCIL_TEST);for(var f=e.useProgram("collisionBox"),l=0;l<i.length;l++){var n=i[l],a=o.getTile(n),s=a.getBucket(r);if(s){var u=s.buffers.collisionBox;if(u){t.uniformMatrix4fv(f.u_matrix,!1,n.posMatrix),e.enableTileClippingMask(n),e.lineWidth(1),t.uniform1f(f.u_scale,Math.pow(2,e.transform.zoom-a.coord.z)),t.uniform1f(f.u_zoom,10*e.transform.zoom),t.uniform1f(f.u_maxzoom,10*(a.coord.z+1));for(var m=0,g=u.segments;m<g.length;m+=1){var v=g[m];v.vaos[r.id].bind(t,f,u.layoutVertexBuffer,u.elementBuffer,null,v.vertexOffset),t.drawElements(t.LINES,2*v.primitiveLength,t.UNSIGNED_SHORT,2*v.primitiveOffset*2)}}}}}module.exports=drawCollisionDebug;
},{}],236:[function(require,module,exports){
"use strict";function drawDebug(r,e,a){for(var t=0;t<a.length;t++)drawDebugTile(r,e,a[t])}function drawDebugTile(r,e,a){var t=r.gl;t.disable(t.STENCIL_TEST),r.lineWidth(1*browser.devicePixelRatio);var i=a.posMatrix,u=r.useProgram("debug");t.uniformMatrix4fv(u.u_matrix,!1,i),t.uniform4f(u.u_color,1,0,0,1),r.debugVAO.bind(t,u,r.debugBuffer),t.drawArrays(t.LINE_STRIP,0,r.debugBuffer.length);for(var o=createTextVerticies(a.toString(),50,200,5),f=new PosArray,n=0;n<o.length;n+=2)f.emplaceBack(o[n],o[n+1]);var l=Buffer.fromStructArray(f,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(t,u,l),t.uniform4f(u.u_color,1,1,1,1);for(var m=e.getTile(a).tileSize,s=EXTENT/(Math.pow(2,r.transform.zoom-a.z)*m),g=[[-1,-1],[-1,1],[1,-1],[1,1]],d=0;d<g.length;d++){var x=g[d];t.uniformMatrix4fv(u.u_matrix,!1,mat4.translate([],i,[s*x[0],s*x[1],0])),t.drawArrays(t.LINES,0,l.length)}t.uniform4f(u.u_color,0,0,0,1),t.uniformMatrix4fv(u.u_matrix,!1,i),t.drawArrays(t.LINES,0,l.length)}function createTextVerticies(r,e,a,t){t=t||1;var i,u,o,f,n,l,m,s,g=[];for(i=0,u=r.length;i<u;i++)if(n=simplexFont[r[i]]){for(s=null,o=0,f=n[1].length;o<f;o+=2)n[1][o]===-1&&n[1][o+1]===-1?s=null:(l=e+n[1][o]*t,m=a-n[1][o+1]*t,s&&g.push(s.x,s.y,l,m),s={x:l,y:m});e+=n[0]*t}return g}var browser=require("../util/browser"),mat4=require("@minemap/gl-matrix").mat4,EXTENT=require("../data/extent"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),PosArray=require("../data/pos_array");module.exports=drawDebug;var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};
},{"../data/buffer":214,"../data/extent":217,"../data/pos_array":220,"../util/browser":372,"./vertex_array_object":252,"@minemap/gl-matrix":2}],237:[function(require,module,exports){
"use strict";function drawTrackingTile(i,t,e,r,n,a,o,s,f,u){var m,l,_,p,g=t.gl,d=n.paint["dynamicLine-dasharray"],c=n.paint["dynamicLine-pattern"];if(s||f){var h=1/pixelsToTileUnits(e,1,t.transform.tileZoom);if(d){m=t.lineAtlas.getDash(d.from,"round"===n.layout["dynamicLine-cap"]),l=t.lineAtlas.getDash(d.to,"round"===n.layout["dynamicLine-cap"]);var T=m.width*d.fromScale,v=l.width*d.toScale;g.uniform2f(i.u_patternscale_a,h/T,-m.height/2),g.uniform2f(i.u_patternscale_b,h/v,-l.height/2),g.uniform1f(i.u_sdfgamma,t.lineAtlas.width/(256*Math.min(T,v)*browser.devicePixelRatio)/2)}else if(c){if(_=t.spriteAtlas.getPosition(c.from,!0),p=t.spriteAtlas.getPosition(c.to,!0),!_||!p)return;g.uniform2f(i.u_pattern_size_a,_.size[0]*c.fromScale/h,p.size[1]),g.uniform2f(i.u_pattern_size_b,p.size[0]*c.toScale/h,p.size[1])}g.uniform2f(i.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1])}s&&(d?(g.uniform1i(i.u_image,0),g.activeTexture(g.TEXTURE0),t.lineAtlas.bind(g),g.uniform1f(i.u_tex_y_a,m.y),g.uniform1f(i.u_tex_y_b,l.y),g.uniform1f(i.u_mix,d.t)):c&&(g.uniform1i(i.u_image,0),g.activeTexture(g.TEXTURE0),t.spriteAtlas.bind(g,!0),g.uniform2fv(i.u_pattern_tl_a,_.tl),g.uniform2fv(i.u_pattern_br_a,_.br),g.uniform2fv(i.u_pattern_tl_b,p.tl),g.uniform2fv(i.u_pattern_br_b,p.br),g.uniform1f(i.u_fade,c.t)),g.uniform1f(i.u_width,n.paint["dynamicLine-width"])),t.enableTileClippingMask(a);var x=t.translatePosMatrix(a.posMatrix,e,n.paint["dynamicLine-translate"],n.paint["dynamicLine-translate-anchor"]);g.uniformMatrix4fv(i.u_matrix,!1,x),g.uniform1f(i.u_ratio,1/pixelsToTileUnits(e,1,t.transform.zoom)),g.uniform1f(i.u_count,u),g.uniform1f(i.u_segments,segmentGroup);for(var y=0,b=r.segments;y<b.length;y+=1){var L=b[y];L.vaos[n.id].bind(g,i,r.layoutVertexBuffer,r.elementBuffer,o.paintVertexBuffer,L.vertexOffset),g.drawElements(g.TRIANGLES,3*L.primitiveLength,g.UNSIGNED_SHORT,3*L.primitiveOffset*2)}}var browser=require("../util/browser"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),config=require("../util/config"),segmentGroup=20;module.exports=function(i,t,e,r){if(!i.isOpaquePass){i.setDepthSublayer(0),i.depthMask(!1);var n=i.gl;if(n.enable(n.STENCIL_TEST),!(e.paint["dynamicLine-width"]<=0)){segmentGroup=e.paint["dynamicLine-seg-group"]||20,e.histEnd=(new Date).getTime(),e.first||(e.first=!0,e.histStart=0,e.histCount=0),e.histEnd-e.histStart>=1e3/e.paint["dynamicLine-speed"]&&(e.histCount++,config.TRW&&config.TRW.setProgress(this.histCount),e.histStart=e.histEnd);for(var a,o=!0,s=0,f=r;s<f.length;s+=1){var u=f[s],m=t.getTile(u),l=m.getBucket(e);if(l){var _=l.buffers.layerData[e.id],p=i.currentProgram,g=i.useProgram("dynamicLine",_.programConfiguration),d=o||g!==p,c=a!==m.coord.z;d&&_.programConfiguration.setUniforms(i.gl,g,e,{zoom:i.transform.zoom}),drawTrackingTile(g,i,m,l.buffers,e,u,_,d,c,e.histCount),a=m.coord.z,o=!1}}}}};
},{"../source/pixels_to_tile_units":259,"../util/browser":372,"../util/config":376}],238:[function(require,module,exports){
"use strict";function draw(t,e,r,i){if(0!==r.paint["extrusion-opacity"]){var a=t.gl;a.disable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),t.depthMask(!0);var s=new ExtrusionTexture(a,t,r);s.bindFramebuffer(),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(var u=0;u<i.length;u++)drawExtrusion(t,e,r,i[u]);s.unbindFramebuffer(),s.renderToMap()}}function ExtrusionTexture(t,e,r){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=r,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function drawExtrusion(t,e,r,i){if(!t.isOpaquePass){var a=e.getTile(i),s=a.getBucket(r);if(s){var u=s.buffers,h=t.gl,n=r.paint["extrusion-pattern"],f=u.layerData[r.id],o=f.programConfiguration,E=t.useProgram(n?"extrusionPattern":"extrusion",o);o.setUniforms(h,E,r,{zoom:t.transform.zoom}),n&&(pattern.prepare(n,t,E),pattern.setTile(a,t,E),h.uniform1f(E.u_height_factor,-Math.pow(2,i.z)/a.tileSize/8)),t.gl.uniformMatrix4fv(E.u_matrix,!1,t.translatePosMatrix(i.posMatrix,a,r.paint["extrusion-translate"],r.paint["extrusion-translate-anchor"])),setLight(E,t);for(var T=0,R=u.segments;T<R.length;T+=1){var x=R[T];x.vaos[r.id].bind(h,E,u.layoutVertexBuffer,u.elementBuffer,f.paintVertexBuffer,x.vertexOffset),h.drawElements(h.TRIANGLES,3*x.primitiveLength,h.UNSIGNED_SHORT,3*x.primitiveOffset*2)}}}}function setLight(t,e){var r=e.gl,i=e.style.light,a=i.calculated.position,s=[a.x,a.y,a.z],u=mat3.create();"viewport"===i.calculated.anchor&&mat3.fromRotation(u,-e.transform.angle),vec3.transformMat3(s,s,u),r.uniform3fv(t.u_lightpos,s),r.uniform1f(t.u_lightintensity,i.calculated.intensity),r.uniform3fv(t.u_lightcolor,i.calculated.color.slice(0,3))}var glMatrix=require("@minemap/gl-matrix"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),PosArray=require("../data/pos_array"),pattern=require("./pattern"),mat3=glMatrix.mat3,mat4=glMatrix.mat4,vec3=glMatrix.vec3;module.exports=draw,ExtrusionTexture.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},ExtrusionTexture.prototype.renderToMap=function(){var t=this.gl,e=this.painter,r=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(r.u_opacity,this.layer.paint["extrusion-opacity"]),t.uniform1i(r.u_texture,1),t.uniformMatrix4fv(r.u_matrix,!1,mat4.ortho(mat4.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(r.u_xdim,e.width),t.uniform1i(r.u_ydim,e.height);var i=new PosArray;i.emplaceBack(0,0),i.emplaceBack(e.width,0),i.emplaceBack(0,e.height),i.emplaceBack(e.width,e.height);var a=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(t,r,a),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)};
},{"../data/buffer":214,"../data/pos_array":220,"./pattern":250,"./vertex_array_object":252,"@minemap/gl-matrix":2}],239:[function(require,module,exports){
"use strict";function drawFill(r,t,e,a){var i=r.gl;i.enable(i.STENCIL_TEST);var l=!e.paint["fill-pattern"]&&e.isPaintValueFeatureConstant("fill-color")&&e.isPaintValueFeatureConstant("fill-opacity")&&1===e.paint["fill-color"][3]&&1===e.paint["fill-opacity"];drawWater="water"===e.paint["fill-water"],r.isOpaquePass===l&&(r.setDepthSublayer(1),drawFillTiles(r,t,e,a,drawFillTile)),!r.isOpaquePass&&e.paint["fill-antialias"]&&(r.lineWidth(2),r.depthMask(!1),r.setDepthSublayer(e.getPaintProperty("fill-outline-color")?2:0),drawFillTiles(r,t,e,a,drawStrokeTile))}function drawFillTiles(r,t,e,a,i){for(var l=!0,n=0,o=a;n<o.length;n+=1){var f=o[n],s=t.getTile(f),u=s.getBucket(e);u&&(r.enableTileClippingMask(f),i(r,t,e,s,f,u.buffers,l),l=!1)}}function drawFillTile(r,t,e,a,i,l,n){for(var o=r.gl,f=l.layerData[e.id],s=setFillProgram("fill",e.paint["fill-pattern"],r,f,e,a,i,n),u=0,p=l.segments;u<p.length;u+=1){var g=p[u];g.vaos[e.id].bind(o,s,l.layoutVertexBuffer,l.elementBuffer,f.paintVertexBuffer,g.vertexOffset),o.drawElements(o.TRIANGLES,3*g.primitiveLength,o.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}function drawStrokeTile(r,t,e,a,i,l,n){var o=r.gl,f=l.layerData[e.id],s=e.paint["fill-pattern"]&&!e.getPaintProperty("fill-outline-color"),u=setFillProgram("fillOutline",s,r,f,e,a,i,n);o.uniform2f(u.u_world,o.drawingBufferWidth,o.drawingBufferHeight);for(var p=0,g=l.segments2;p<g.length;p+=1){var m=g[p];m.vaos[e.id].bind(o,u,l.layoutVertexBuffer,l.elementBuffer2,f.paintVertexBuffer,m.vertexOffset),o.drawElements(o.LINES,2*m.primitiveLength,o.UNSIGNED_SHORT,2*m.primitiveOffset*2)}}function setFillProgram(r,t,e,a,i,l,n,o){var f,s=e.currentProgram;return drawWater?(f=e.useProgram("fillWater",a.programConfiguration),(o||f!==s)&&a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom}),e.gl.uniform1f(f.u_time,performance.now()/1e3)):t?(f=e.useProgram(r+"Pattern",a.programConfiguration),(o||f!==s)&&(a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom}),pattern.prepare(i.paint["fill-pattern"],e,f)),pattern.setTile(l,e,f)):(f=e.useProgram(r,a.programConfiguration),(o||f!==s)&&a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom})),e.gl.uniformMatrix4fv(f.u_matrix,!1,e.translatePosMatrix(n.posMatrix,l,i.paint["fill-translate"],i.paint["fill-translate-anchor"])),f}var pattern=require("./pattern"),drawWater=!1;module.exports=drawFill;
},{"./pattern":250}],240:[function(require,module,exports){
"use strict";function draw(t,e,r,i){if(0!==r.paint["histogram-opacity"]){var a=t.gl;a.disable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),t.depthMask(!0);var o=new ExtrusionTexture(a,t,r);o.bindFramebuffer(),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(var h=0;h<i.length;h++)drawExtrusion(t,e,r,i[h]);o.unbindFramebuffer(),o.renderToMap()}}function ExtrusionTexture(t,e,r){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=r,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function drawExtrusion(t,e,r,i){if(!t.isOpaquePass){var a=e.getTile(i),o=a.getBucket(r);if(o){var h=o.buffers,s=t.gl,u=r.paint["histogram-pattern"],f=r.layout["histogram-color-render"],n=h.layerData[r.id],E=n.programConfiguration,T=t.useProgram(u?"histogramPattern":f?"histogramColor":"histogram",E);if(E.setUniforms(s,T,r,{zoom:t.transform.zoom}),u&&(pattern.prepare(u,t,T),pattern.setTile(a,t,T),s.uniform1f(T.u_height_factor,-Math.pow(2,i.z)/a.tileSize/8)),f){for(var m=r.paint["histogram-colors"],l=r.paint["histogram-max-height"],R=[],p=0;p<m.length;p++){var _=colorParser.parseCSSColor(m[p]);_[0]/=255,_[1]/=255,_[2]/=255,R.push(_)}s.uniform1f(T.u_max_height,3*l),s.uniform4fv(T.u_color_a,R[0]),s.uniform4fv(T.u_color_b,R[1]),s.uniform4fv(T.u_color_c,R[2]),s.uniform4fv(T.u_color_d,R[3]),s.uniform4fv(T.u_color_e,R[4])}t.gl.uniformMatrix4fv(T.u_matrix,!1,t.translatePosMatrix(i.posMatrix,a,r.paint["histogram-translate"],r.paint["histogram-translate-anchor"])),s.uniform1f(T.u_is_max_length,r.layout["histogram-max-height-render"]),setLight(T,t);for(var x=0,g=h.segments;x<g.length;x+=1){var d=g[x];d.vaos[r.id].bind(s,T,h.layoutVertexBuffer,h.elementBuffer,n.paintVertexBuffer,d.vertexOffset),s.drawElements(s.TRIANGLES,3*d.primitiveLength,s.UNSIGNED_SHORT,3*d.primitiveOffset*2)}}}}function setLight(t,e){var r=e.gl,i=e.style.light,a=i.calculated.position,o=[a.x,a.y,a.z],h=mat3.create();"viewport"===i.calculated.anchor&&mat3.fromRotation(h,-e.transform.angle),vec3.transformMat3(o,o,h),r.uniform3fv(t.u_lightpos,o),r.uniform1f(t.u_lightintensity,i.calculated.intensity),r.uniform3fv(t.u_lightcolor,i.calculated.color.slice(0,3))}var glMatrix=require("@minemap/gl-matrix"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),PosArray=require("../data/pos_array"),pattern=require("./pattern"),mat3=glMatrix.mat3,mat4=glMatrix.mat4,vec3=glMatrix.vec3,colorParser=require("csscolorparser");module.exports=draw,ExtrusionTexture.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},ExtrusionTexture.prototype.renderToMap=function(){var t=this.gl,e=this.painter,r=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(r.u_opacity,this.layer.paint["histogram-opacity"]),t.uniform1i(r.u_texture,1),t.uniformMatrix4fv(r.u_matrix,!1,mat4.ortho(mat4.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(r.u_xdim,e.width),t.uniform1i(r.u_ydim,e.height);var i=new PosArray;i.emplaceBack(0,0),i.emplaceBack(e.width,0),i.emplaceBack(0,e.height),i.emplaceBack(e.width,e.height);var a=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(t,r,a),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)};
},{"../data/buffer":214,"../data/pos_array":220,"./pattern":250,"./vertex_array_object":252,"@minemap/gl-matrix":2,"csscolorparser":101}],241:[function(require,module,exports){
"use strict";function drawLineTile(e,i,t,r,a,n,o,f,s){var l,u,m,_,p=i.gl,g=a.paint["line-dasharray"],d=a.paint["line-pattern"];if(f||s){var v=1/pixelsToTileUnits(t,1,i.transform.tileZoom);if(g){l=i.lineAtlas.getDash(g.from,"round"===a.layout["line-cap"]),u=i.lineAtlas.getDash(g.to,"round"===a.layout["line-cap"]);var T=l.width*g.fromScale,h=u.width*g.toScale;p.uniform2f(e.u_patternscale_a,v/T,-l.height/2),p.uniform2f(e.u_patternscale_b,v/h,-u.height/2),p.uniform1f(e.u_sdfgamma,i.lineAtlas.width/(256*Math.min(T,h)*browser.devicePixelRatio)/2)}else if(d){if(m=i.spriteAtlas.getPosition(d.from,!0),_=i.spriteAtlas.getPosition(d.to,!0),!m||!_)return;p.uniform2f(e.u_pattern_size_a,m.size[0]*d.fromScale/v,_.size[1]),p.uniform2f(e.u_pattern_size_b,_.size[0]*d.toScale/v,_.size[1])}p.uniform2f(e.u_gl_units_to_pixels,1/i.transform.pixelsToGLUnits[0],1/i.transform.pixelsToGLUnits[1])}f&&(g?(p.uniform1i(e.u_image,0),p.activeTexture(p.TEXTURE0),i.lineAtlas.bind(p),p.uniform1f(e.u_tex_y_a,l.y),p.uniform1f(e.u_tex_y_b,u.y),p.uniform1f(e.u_mix,g.t)):d&&(p.uniform1i(e.u_image,0),p.activeTexture(p.TEXTURE0),i.spriteAtlas.bind(p,!0),p.uniform2fv(e.u_pattern_tl_a,m.tl),p.uniform2fv(e.u_pattern_br_a,m.br),p.uniform2fv(e.u_pattern_tl_b,_.tl),p.uniform2fv(e.u_pattern_br_b,_.br),p.uniform1f(e.u_fade,d.t)),p.uniform1f(e.u_width,a.paint["line-width"])),i.enableTileClippingMask(n);var x=i.translatePosMatrix(n.posMatrix,t,a.paint["line-translate"],a.paint["line-translate-anchor"]);p.uniformMatrix4fv(e.u_matrix,!1,x),p.uniform1f(e.u_ratio,1/pixelsToTileUnits(t,1,i.transform.zoom));for(var b=0,c=r.segments;b<c.length;b+=1){var w=c[b];w.vaos[a.id].bind(p,e,r.layoutVertexBuffer,r.elementBuffer,o.paintVertexBuffer,w.vertexOffset),p.drawElements(p.TRIANGLES,3*w.primitiveLength,p.UNSIGNED_SHORT,3*w.primitiveOffset*2)}}var browser=require("../util/browser"),pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=function(e,i,t,r){if(!e.isOpaquePass){e.setDepthSublayer(0),e.depthMask(!1);var a=e.gl;if(a.enable(a.STENCIL_TEST),!(t.paint["line-width"]<=0))for(var n,o=t.paint["line-dasharray"]?"lineSDF":t.paint["line-pattern"]?"linePattern":"line",f=!0,s=0,l=r;s<l.length;s+=1){var u=l[s],m=i.getTile(u),_=m.getBucket(t);if(_){var p=_.buffers.layerData[t.id],g=e.currentProgram,d=e.useProgram(o,p.programConfiguration),v=f||d!==g,T=n!==m.coord.z;v&&p.programConfiguration.setUniforms(e.gl,d,t,{zoom:e.transform.zoom}),drawLineTile(d,e,m,_.buffers,t,u,p,v,T),n=m.coord.z,f=!1}}}};
},{"../source/pixels_to_tile_units":259,"../util/browser":372}],242:[function(require,module,exports){
"use strict";function drawRaster(r,t,e,a){if(!r.isOpaquePass){var i=r.gl;i.enable(i.DEPTH_TEST),r.depthMask(!0),i.depthFunc(i.LESS);for(var o=a.length&&a[0].z,n=0;n<a.length;n++){var u=a[n];r.setDepthSublayer(u.z-o),drawRasterTile(r,t,e,u)}i.depthFunc(i.LEQUAL)}}function drawRasterTile(r,t,e,a){var i=r.gl;i.disable(i.STENCIL_TEST);var o=t.getTile(a),n=r.transform.calculatePosMatrix(a,t.getSource().maxzoom);o.registerFadeDuration(r.style.animationLoop,e.paint["raster-fade-duration"]);var u=r.useProgram("raster");i.uniformMatrix4fv(u.u_matrix,!1,n),i.uniform1f(u.u_brightness_low,e.paint["raster-brightness-min"]),i.uniform1f(u.u_brightness_high,e.paint["raster-brightness-max"]),i.uniform1f(u.u_saturation_factor,saturationFactor(e.paint["raster-saturation"])),i.uniform1f(u.u_contrast_factor,contrastFactor(e.paint["raster-contrast"])),i.uniform3fv(u.u_spin_weights,spinWeights(e.paint["raster-hue-rotate"]));var s,c,f=o.sourceCache&&o.sourceCache.findLoadedParent(a,0,{}),d=getFadeValues(o,f,e,r.transform);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.texture),i.activeTexture(i.TEXTURE1),f?(i.bindTexture(i.TEXTURE_2D,f.texture),s=Math.pow(2,f.coord.z-o.coord.z),c=[o.coord.x*s%1,o.coord.y*s%1]):i.bindTexture(i.TEXTURE_2D,o.texture),i.uniform2fv(u.u_tl_parent,c||[0,0]),i.uniform1f(u.u_scale_parent,s||1),i.uniform1f(u.u_buffer_scale,1),i.uniform1f(u.u_fade_t,d.mix),i.uniform1f(u.u_opacity,d.opacity*e.paint["raster-opacity"]),i.uniform1i(u.u_image0,0),i.uniform1i(u.u_image1,1);var m=o.boundsBuffer||r.rasterBoundsBuffer;(o.boundsVAO||r.rasterBoundsVAO).bind(i,u,m),i.drawArrays(i.TRIANGLE_STRIP,0,m.length)}function spinWeights(r){r*=Math.PI/180;var t=Math.sin(r),e=Math.cos(r);return[(2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3]}function contrastFactor(r){return r>0?1/(1-r):1+r}function saturationFactor(r){return r>0?1-1/(1.001-r):-r}function getFadeValues(r,t,e,a){var i=e.paint["raster-fade-duration"];if(r.sourceCache&&i>0){var o=Date.now(),n=(o-r.timeAdded)/i,u=t?(o-t.timeAdded)/i:-1,s=r.sourceCache.getSource(),c=a.coveringZoomLevel({tileSize:s.tileSize,roundZoom:s.roundZoom}),f=!t||Math.abs(t.coord.z-c)>Math.abs(r.coord.z-c),d=f&&r.refreshedUponExpiration?1:util.clamp(f?n:1-u,0,1);return r.refreshedUponExpiration&&n>=1&&(r.refreshedUponExpiration=!1),t?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var util=require("../util/util");module.exports=drawRaster;
},{"../util/util":399}],243:[function(require,module,exports){
"use strict";function drawSpriteTile(e,t,r,i,a,s,n,o,u){var l,p,f,d,m=t.gl,_=a.paint["sprite-dasharray"],c=a.paint["sprite-pattern"];if(o||u){var g=1/pixelsToTileUnits(r,1,t.transform.tileZoom);if(_){l=t.lineAtlas.getDash(_.from,"round"===a.layout["sprite-cap"]),p=t.lineAtlas.getDash(_.to,"round"===a.layout["sprite-cap"]);var b=l.width*_.fromScale,x=p.width*_.toScale;m.uniform2f(e.u_patternscale_a,g/b,-l.height/2),m.uniform2f(e.u_patternscale_b,g/x,-p.height/2),m.uniform1f(e.u_sdfgamma,t.lineAtlas.width/(256*Math.min(b,x)*browser.devicePixelRatio)/2)}else if(c){if(f=t.spriteAtlas.getPosition(c.from,!0),d=t.spriteAtlas.getPosition(c.to,!0),!f||!d)return;m.uniform2f(e.u_pattern_size_a,f.size[0]*c.fromScale/g,d.size[1]),m.uniform2f(e.u_pattern_size_b,d.size[0]*c.toScale/g,d.size[1])}m.uniform2f(e.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1])}o&&(_?(m.uniform1i(e.u_image,0),m.activeTexture(m.TEXTURE0),t.lineAtlas.bind(m),m.uniform1f(e.u_tex_y_a,l.y),m.uniform1f(e.u_tex_y_b,p.y),m.uniform1f(e.u_mix,_.t)):c&&(m.uniform1i(e.u_image,0),m.activeTexture(m.TEXTURE0),t.spriteAtlas.bind(m,!0),m.uniform2fv(e.u_pattern_tl_a,f.tl),m.uniform2fv(e.u_pattern_br_a,f.br),m.uniform2fv(e.u_pattern_tl_b,d.tl),m.uniform2fv(e.u_pattern_br_b,d.br),m.uniform1f(e.u_fade,c.t)),m.uniform1f(e.u_width,a.paint["sprite-width"])),t.enableTileClippingMask(s),m.uniform4f(e.u_speed_mat,curEleObj.getCalculatedSpeed(1),curEleObj.getCalculatedSpeed(2),curEleObj.getCalculatedSpeed(3),curEleObj.getCalculatedSpeed(4));var v=t.translatePosMatrix(s.posMatrix,r,a.paint["sprite-translate"],a.paint["sprite-translate-anchor"]);m.uniformMatrix4fv(e.u_matrix,!1,v),m.uniform1f(e.u_ratio,1/pixelsToTileUnits(r,1,t.transform.zoom));for(var E=0,h=i.segments;E<h.length;E+=1){var T=h[E];T.vaos[a.id].bind(m,e,i.layoutVertexBuffer,i.elementBuffer,n.paintVertexBuffer,T.vertexOffset),m.drawElements(m.TRIANGLES,3*T.primitiveLength,m.UNSIGNED_SHORT,3*T.primitiveOffset*2)}}var browser=require("../util/browser"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),curEleObj={speed1:0,speed2:0,speed3:0,speed4:0,speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(e){return parseInt(this["speed"+e]/e/this["speedExt"+e])}};module.exports=function(e,t,r,i){if(!e.isOpaquePass){e.setDepthSublayer(0),e.depthMask(!1);var a=e.gl;if(a.enable(a.STENCIL_TEST),!(r.paint["sprite-width"]<=0)){var s=parseInt(r.paint["sprite-speed-factor"]);curEleObj["speed"+s]++,curEleObj.speed1%=20,curEleObj.speed2%=80,curEleObj.speed3%=150,curEleObj.speed4%=240;for(var n,o=r.paint["sprite-dasharray"]?"lineSDF":r.paint["sprite-pattern"]?"linePattern":"sprite",u=!0,l=0,p=i;l<p.length;l+=1){var f=p[l],d=t.getTile(f),m=d.getBucket(r);if(m){var _=m.buffers.layerData[r.id],c=e.currentProgram,g=e.useProgram(o,_.programConfiguration),b=u||g!==c,x=n!==d.coord.z;b&&_.programConfiguration.setUniforms(e.gl,g,r,{zoom:e.transform.zoom}),drawSpriteTile(g,e,d,m.buffers,r,f,_,b,x),n=d.coord.z,u=!1}}}}};
},{"../source/pixels_to_tile_units":259,"../util/browser":372}],244:[function(require,module,exports){
"use strict";function drawSymbols(e,t,a,i){if(!e.isOpaquePass){var o=!(a.layout["text-allow-overlap"]||a.layout["icon-allow-overlap"]||a.layout["text-ignore-placement"]||a.layout["icon-ignore-placement"]),r=e.gl;o?r.disable(r.STENCIL_TEST):r.enable(r.STENCIL_TEST),e.setDepthSublayer(0),e.depthMask(!1),drawLayerSymbols(e,t,a,i,!1,a.paint["icon-translate"],a.paint["icon-translate-anchor"],a.layout["icon-rotation-alignment"],a.layout["icon-rotation-alignment"],a.layout["icon-size"]),drawLayerSymbols(e,t,a,i,!0,a.paint["text-translate"],a.paint["text-translate-anchor"],a.layout["text-rotation-alignment"],a.layout["text-pitch-alignment"],a.layout["text-size"]),t.map.showCollisionBoxes&&drawCollisionDebug(e,t,a,i)}}function drawLayerSymbols(e,t,a,i,o,r,n,l,s,u){if(o||!e.style.sprite||e.style.sprite.loaded()){var f=e.gl,m="map"===l,p="map"===s,c=p;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST);for(var d,_,h=0,g=i;h<g.length;h+=1){var y=g[h],T=t.getTile(y),b=T.getBucket(a);if(b){var x=o?b.buffers.glyph:b.buffers.icon;if(x&&x.segments.length){var S=x.layerData[a.id],w=S.programConfiguration,v=o||b.sdfIcons;d&&b.fontstack===_||(d=e.useProgram(v?"symbolSDF":"symbolIcon",w),w.setUniforms(f,d,a,{zoom:e.transform.zoom}),setSymbolDrawState(d,e,o,v,m,p,b.fontstack,u,b.iconsNeedLinear,o?b.adjustedTextSize:b.adjustedIconSize)),e.enableTileClippingMask(y),f.uniformMatrix4fv(d.u_matrix,!1,e.translatePosMatrix(y.posMatrix,T,r,n)),drawTileSymbols(d,e,a,T,x,o,v,p,u),_=b.fontstack}}}c||f.enable(f.DEPTH_TEST)}}function setSymbolDrawState(e,t,a,i,o,r,n,l,s,u){var f=t.gl,m=t.transform;if(f.uniform1i(e.u_rotate_with_map,o),f.uniform1i(e.u_pitch_with_map,r),f.activeTexture(f.TEXTURE0),f.uniform1i(e.u_texture,0),a){var p=n&&t.glyphSource.getGlyphAtlas(n);if(!p)return;p.updateTexture(f),f.uniform2f(e.u_texsize,p.width/4,p.height/4)}else{var c=t.options.rotating||t.options.zooming,d=1!==l||browser.devicePixelRatio!==t.spriteAtlas.pixelRatio||s,_=r||m.pitch;t.spriteAtlas.bind(f,i||c||d||_),f.uniform2f(e.u_texsize,t.spriteAtlas.width/4,t.spriteAtlas.height/4)}f.activeTexture(f.TEXTURE1),t.frameHistory.bind(f),f.uniform1i(e.u_fadetexture,1);var h=Math.log(l/u)/Math.LN2||0;f.uniform1f(e.u_zoom,10*(m.zoom-h)),f.uniform1f(e.u_pitch,m.pitch/360*2*Math.PI),f.uniform1f(e.u_bearing,m.bearing/360*2*Math.PI),f.uniform1f(e.u_aspect_ratio,m.width/m.height)}function drawTileSymbols(e,t,a,i,o,r,n,l,s){var u=t.gl,f=t.transform,m=s/(r?24:1);if(l){var p=pixelsToTileUnits(i,m,f.zoom);u.uniform2f(e.u_extrude_scale,p,p)}else{var c=f.cameraToCenterDistance*m;u.uniform2f(e.u_extrude_scale,f.pixelsToGLUnits[0]*c,f.pixelsToGLUnits[1]*c)}if(n){var d=(r?"text":"icon")+"-halo-width",_=!a.isPaintValueFeatureConstant(d)||a.paint[d],h=m*(l?Math.cos(f._pitch):1)*f.cameraToCenterDistance;u.uniform1f(e.u_font_scale,m),u.uniform1f(e.u_gamma_scale,h),_&&(u.uniform1f(e.u_is_halo,1),drawSymbolElements(o,a,u,e)),u.uniform1f(e.u_is_halo,0)}drawSymbolElements(o,a,u,e)}function drawSymbolElements(e,t,a,i){for(var o=e.layerData[t.id],r=o&&o.paintVertexBuffer,n=0,l=e.segments;n<l.length;n+=1){var s=l[n];s.vaos[t.id].bind(a,i,e.layoutVertexBuffer,e.elementBuffer,r,s.vertexOffset),a.drawElements(a.TRIANGLES,3*s.primitiveLength,a.UNSIGNED_SHORT,3*s.primitiveOffset*2)}}var browser=require("../util/browser"),drawCollisionDebug=require("./draw_collision_debug"),pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=drawSymbols;
},{"../source/pixels_to_tile_units":259,"../util/browser":372,"./draw_collision_debug":235}],245:[function(require,module,exports){
"use strict";function drawSymtracking(t,e,i,a){if(!t.isOpaquePass){this.start||(this.start=(new Date).getTime(),this.count=0),this.end=(new Date).getTime();var o=i.layout["symtracking-fps"],r=i.layout["symtracking-time-segment"];if(offset=i.paint["symtracking-delay"],this.end-this.start>=1e3/o){this.count+=1;var n=config.TRW&&config.TRW.hasOwnProperty("replaceOffset")?config.TRW.replaceOffset:o*(r+offset);this.count%=n;var s=config.TRW&&config.TRW.hasOwnProperty("requestOffset")?config.TRW.requestOffset:r*o;this.count===s&&config.TRW&&config.TRW.request(),0===this.count&&(config.TRW&&config.TRW.replace(),this.count=offset),config.TRW&&(config.TRW.currentSeq=this.count),_count=this.count,this.start=this.end}var l=!(i.layout["text-allow-overlap"]||i.layout["icon-allow-overlap"]||i.layout["text-ignore-placement"]||i.layout["icon-ignore-placement"]),f=t.gl;l?f.disable(f.STENCIL_TEST):f.enable(f.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),drawLayerSymbols(t,e,i,a,!1,i.paint["icon-translate"],i.paint["icon-translate-anchor"],i.layout["icon-rotation-alignment"],i.layout["icon-rotation-alignment"],i.layout["icon-size"]),drawLayerSymbols(t,e,i,a,!0,i.paint["text-translate"],i.paint["text-translate-anchor"],i.layout["text-rotation-alignment"],i.layout["text-pitch-alignment"],i.layout["text-size"]),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,i,a)}}function symtrackingDynDeal(t,e){t.uniform1f(e.u_seq,_count)}function drawLayerSymbols(t,e,i,a,o,r,n,s,l,f){if(o||!t.style.sprite||t.style.sprite.loaded()){var u=t.gl,c="map"===s,m="map"===l,g=m;g?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);for(var p,h,T=0,y=a;T<y.length;T+=1){var d=y[T],_=e.getTile(d);if(_){var x=_.getBucket(i);if(x){var v=o?x.buffers.glyph:x.buffers.icon;if(v&&v.segments.length){var w=v.layerData[i.id],b=w.programConfiguration,S=o||x.sdfIcons;p&&x.fontstack===h||(p=t.useProgram(S?"symtrackingSDF":"symtrackingIcon",b),b.setUniforms(u,p,i,{zoom:t.transform.zoom}),setSymbolDrawState(p,t,o,S,c,m,x.fontstack,f,x.iconsNeedLinear,o?x.adjustedTextSize:x.adjustedIconSize)),t.enableTileClippingMask(d),u.uniformMatrix4fv(p.u_matrix,!1,t.translatePosMatrix(d.posMatrix,_,r,n)),drawTileSymbols(p,t,i,_,v,o,S,m,f),h=x.fontstack}}}}g||u.enable(u.DEPTH_TEST)}}function setSymbolDrawState(t,e,i,a,o,r,n,s,l,f){var u=e.gl,c=e.transform;if(u.uniform1i(t.u_rotate_with_map,o),u.uniform1i(t.u_pitch_with_map,r),u.activeTexture(u.TEXTURE0),u.uniform1i(t.u_texture,0),i){var m=n&&e.glyphSource.getGlyphAtlas(n);if(!m)return;m.updateTexture(u),u.uniform2f(t.u_texsize,m.width/4,m.height/4)}else{var g=e.options.rotating||e.options.zooming,p=1!==s||browser.devicePixelRatio!==e.spriteAtlas.pixelRatio||l,h=r||c.pitch;e.spriteAtlas.bind(u,a||g||p||h),u.uniform2f(t.u_texsize,e.spriteAtlas.width/4,e.spriteAtlas.height/4),symtrackingDynDeal(u,t)}u.activeTexture(u.TEXTURE1),e.frameHistory.bind(u),u.uniform1i(t.u_fadetexture,1);var T=Math.log(s/f)/Math.LN2||0;u.uniform1f(t.u_zoom,10*(c.zoom-T)),u.uniform1f(t.u_pitch,c.pitch/360*2*Math.PI),u.uniform1f(t.u_bearing,c.bearing/360*2*Math.PI),u.uniform1f(t.u_aspect_ratio,c.width/c.height)}function drawTileSymbols(t,e,i,a,o,r,n,s,l){var f=e.gl,u=e.transform,c=l/(r?24:1);if(s){var m=pixelsToTileUnits(a,c,u.zoom);f.uniform2f(t.u_extrude_scale,m,m)}else{var g=u.cameraToCenterDistance*c;f.uniform2f(t.u_extrude_scale,u.pixelsToGLUnits[0]*g,u.pixelsToGLUnits[1]*g)}if(n){var p=(r?"text":"icon")+"-halo-width",h=!i.isPaintValueFeatureConstant(p)||i.paint[p],T=c*(s?Math.cos(u._pitch):1)*u.cameraToCenterDistance;f.uniform1f(t.u_font_scale,c),f.uniform1f(t.u_gamma_scale,T),h&&(f.uniform1f(t.u_is_halo,1),drawSymbolElements(o,i,f,t)),f.uniform1f(t.u_is_halo,0)}drawSymbolElements(o,i,f,t)}function drawSymbolElements(t,e,i,a){for(var o=t.layerData[e.id],r=o&&o.paintVertexBuffer,n=0,s=t.segments;n<s.length;n+=1){var l=s[n];l.vaos[e.id].bind(i,a,t.layoutVertexBuffer,t.elementBuffer,r,l.vertexOffset),i.drawElements(i.TRIANGLES,3*l.primitiveLength,i.UNSIGNED_SHORT,3*l.primitiveOffset*2)}}var browser=require("../util/browser"),drawCollisionDebug=require("./draw_collision_debug"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),config=require("../util/config");module.exports=drawSymtracking;var _count=0,offset=10;
},{"../source/pixels_to_tile_units":259,"../util/browser":372,"../util/config":376,"./draw_collision_debug":235}],246:[function(require,module,exports){
"use strict";function drawTrackingTile(t,e,i,r,n,a,s,o,u,f,g,p){var l,c,m,h,_=e.gl,v=n.paint["tracking-dasharray"],d=n.paint["tracking-pattern"];if(o||u){var k=1/pixelsToTileUnits(i,1,e.transform.tileZoom);if(v){l=e.lineAtlas.getDash(v.from,"round"===n.layout["tracking-cap"]),c=e.lineAtlas.getDash(v.to,"round"===n.layout["tracking-cap"]);var T=l.width*v.fromScale,y=c.width*v.toScale;_.uniform2f(t.u_patternscale_a,k/T,-l.height/2),_.uniform2f(t.u_patternscale_b,k/y,-c.height/2),_.uniform1f(t.u_sdfgamma,e.lineAtlas.width/(256*Math.min(T,y)*browser.devicePixelRatio)/2)}else if(d){if(m=e.spriteAtlas.getPosition(d.from,!0),h=e.spriteAtlas.getPosition(d.to,!0),!m||!h)return;_.uniform2f(t.u_pattern_size_a,m.size[0]*d.fromScale/k,h.size[1]),_.uniform2f(t.u_pattern_size_b,h.size[0]*d.toScale/k,h.size[1])}_.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}o&&(v?(_.uniform1i(t.u_image,0),_.activeTexture(_.TEXTURE0),e.lineAtlas.bind(_),_.uniform1f(t.u_tex_y_a,l.y),_.uniform1f(t.u_tex_y_b,c.y),_.uniform1f(t.u_mix,v.t)):d&&(_.uniform1i(t.u_image,0),_.activeTexture(_.TEXTURE0),e.spriteAtlas.bind(_,!0),_.uniform2fv(t.u_pattern_tl_a,m.tl),_.uniform2fv(t.u_pattern_br_a,m.br),_.uniform2fv(t.u_pattern_tl_b,h.tl),_.uniform2fv(t.u_pattern_br_b,h.br),_.uniform1f(t.u_fade,d.t)),_.uniform1f(t.u_width,n.paint["tracking-width"])),e.enableTileClippingMask(a);var C=e.translatePosMatrix(a.posMatrix,i,n.paint["tracking-translate"],n.paint["tracking-translate-anchor"]);_.uniformMatrix4fv(t.u_matrix,!1,C),_.uniform1f(t.u_ratio,1/pixelsToTileUnits(i,1,e.transform.zoom)),_.uniform1f(t.u_start,f-segmentGroup),_.uniform1f(t.u_end,f),_.uniform1f(t.u_segments,segmentGroup),_.uniform1f(t.u_reverse,g),_.uniform1f(t.u_reserve,p);for(var b=0,x=r.segments;b<x.length;b+=1){var R=x[b];R.vaos[n.id].bind(_,t,r.layoutVertexBuffer,r.elementBuffer,s.paintVertexBuffer,R.vertexOffset),_.drawElements(_.TRIANGLES,3*R.primitiveLength,_.UNSIGNED_SHORT,3*R.primitiveOffset*2)}}var browser=require("../util/browser"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),config=require("../util/config"),offset=20,segmentGroup=20;module.exports=function(t,e,i,r){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var n=t.gl;if(n.enable(n.STENCIL_TEST),!(i.paint["tracking-width"]<=0)){if(segmentGroup=i.paint["tracking-seg-group"],offset=i.paint["tracking-delay"],"history"===i.paint["tracking-type"])i.histEnd=(new Date).getTime(),i.first||(i.first=!0,i.histStart=0,i.histCount=0,i.isReverse=!1,i.isReserve=!1),i.histEnd-i.histStart>=1e3/i.paint["tracking-speed"]&&("loop"===i.layout["tracking-display-mode"]?(i.histCount++,i.histCount%=i.paint["tracking-seg-count"],i.histCount=0===i.histCount?1:i.histCount):"reverse"===i.layout["tracking-display-mode"]?(i.histCount>=i.paint["tracking-seg-count"]+i.paint["tracking-seg-group"]?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1):"loop-reserve"===i.layout["tracking-display-mode"]?(i.isReserve=!0,i.histCount++,i.histCount%=i.paint["tracking-seg-count"],i.histCount=0===i.histCount?1:i.histCount):"reverse-reserve"===i.layout["tracking-display-mode"]&&(i.isReserve=!0,i.histCount>=i.paint["tracking-seg-count"]+i.paint["tracking-seg-group"]?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1),config.TRW&&config.TRW.setProgress(i.histCount),i.histStart=i.histEnd);else if(i.count||(i.start=(new Date).getTime(),i.count=1),i.end=(new Date).getTime(),i.end-i.start>=1e3/i.paint["tracking-speed"]){var a=config.TRW||i.paint["tracking-trw"];i.count+=1;var s=a&&a.hasOwnProperty("replaceOffset")?a.replaceOffset:120+offset;i.count%=s;var o=a&&a.hasOwnProperty("requestOffset")?a.requestOffset:90+offset;i.count===o&&a&&a.request(),0===i.count&&(a&&a.replace(),i.count=offset),a&&(a.currentSeq=i.count),i.start=i.end}for(var u,f=i.paint["tracking-dasharray"]?"lineSDF":i.paint["tracking-pattern"]?"linePattern":"tracking",g=!0,p=0,l=r;p<l.length;p+=1){var c=l[p],m=e.getTile(c);if(m){if(Object.getPrototypeOf(m).hasOwnProperty("getBucket")){var h=m.getBucket(i);if(h){var _=h.buffers.layerData[i.id],v=t.currentProgram,d=t.useProgram(f,_.programConfiguration),k=g||d!==v,T=u!==m.coord.z;k&&_.programConfiguration.setUniforms(t.gl,d,i,{zoom:t.transform.zoom}),drawTrackingTile(d,t,m,h.buffers,i,c,_,k,T,"history"===i.paint["tracking-type"]?i.histCount:i.count,i.isReverse,i.isReserve),u=m.coord.z,g=!1}}}}}}};
},{"../source/pixels_to_tile_units":259,"../util/browser":372,"../util/config":376}],247:[function(require,module,exports){
"use strict";var FrameHistory=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};FrameHistory.prototype.record=function(e,t,i){var r=this;this.firstFrame&&(e=0,this.firstFrame=!1),t=Math.floor(10*t);var a;if(t<this.previousZoom)for(a=t+1;a<=this.previousZoom;a++)r.changeTimes[a]=e,r.changeOpacities[a]=r.opacities[a];else for(a=t;a>this.previousZoom;a--)r.changeTimes[a]=e,r.changeOpacities[a]=r.opacities[a];for(a=0;a<256;a++){var s=e-r.changeTimes[a],o=255*(i?s/i:1);r.opacities[a]=a<=t?r.changeOpacities[a]+o:r.changeOpacities[a]-o}this.changed=!0,this.previousZoom=t},FrameHistory.prototype.bind=function(e){this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.changed&&(e.texSubImage2D(e.TEXTURE_2D,0,0,0,256,1,e.ALPHA,e.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,256,1,0,e.ALPHA,e.UNSIGNED_BYTE,this.array))},module.exports=FrameHistory;
},{}],248:[function(require,module,exports){
"use strict";var util=require("../util/util"),LineAtlas=function(t,i){this.width=t,this.height=i,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};LineAtlas.prototype.setSprite=function(t){this.sprite=t},LineAtlas.prototype.getDash=function(t,i){var e=t.join(",")+i;return this.positions[e]||(this.positions[e]=this.addDash(t,i)),this.positions[e]},LineAtlas.prototype.addDash=function(t,i){var e=this,h=i?7:0,s=2*h+1;if(this.nextRow+s>this.height)return util.warnOnce("LineAtlas out of space"),null;for(var a=0,r=0;r<t.length;r++)a+=t[r];for(var n=this.width/a,o=n/2,E=t.length%2==1,T=-h;T<=h;T++)for(var R=e.nextRow+h+T,u=e.width*R,d=E?-t[t.length-1]:0,l=t[0],x=1,A=0;A<this.width;A++){for(;l<A/n;)d=l,l+=t[x],E&&x===t.length-1&&(l+=t[0]),x++;var _=Math.abs(A-d*n),p=Math.abs(A-l*n),g=Math.min(_,p),w=x%2==1,D=void 0;if(i){var U=h?T/h*(o+1):0;if(w){var f=o-Math.abs(U);D=Math.sqrt(g*g+f*f)}else D=o-Math.sqrt(g*g+U*U)}else D=(w?1:-1)*g;e.data[3+4*(u+A)]=Math.max(0,Math.min(255,D+128))}var X={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:a};return this.nextRow+=s,this.dirty=!0,X},LineAtlas.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},module.exports=LineAtlas;
},{"../util/util":399}],249:[function(require,module,exports){
"use strict";var browser=require("../util/browser"),mat4=require("@minemap/gl-matrix").mat4,FrameHistory=require("./frame_history"),SourceCache=require("../source/source_cache"),EXTENT=require("../data/extent"),pixelsToTileUnits=require("../source/pixels_to_tile_units"),util=require("../util/util"),Buffer=require("../data/buffer"),VertexArrayObject=require("./vertex_array_object"),RasterBoundsArray=require("../data/raster_bounds_array"),PosArray=require("../data/pos_array"),ProgramConfiguration=require("../data/program_configuration"),shaders=require("./shaders"),textures_cache=require("../util/testures_cache"),draw={symbol:require("./draw_symbol"),symtracking:require("./draw_symtracking"),circle:require("./draw_circle"),line:require("./draw_line"),airline:require("./draw_airline"),sprite:require("./draw_sprite"),tracking:require("./draw_tracking"),dynamicLine:require("./draw_dynamic_line"),fill:require("./draw_fill"),extrusion:require("./draw_extrusion"),collada:require("./draw_collada"),histogram:require("./draw_histogram"),raster:require("./draw_raster"),background:require("./draw_background"),debug:require("./draw_debug")},Painter=function(e,r){this.gl=e,this.texture_cache=new textures_cache(e),this.transform=r,this.reusableTextures={tiles:{},viewport:null},this.preFbos={},this.frameHistory=new FrameHistory,this.setup(),this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=ProgramConfiguration.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new ProgramConfiguration};Painter.prototype.resize=function(e,r){var t=this.gl;this.width=e*browser.devicePixelRatio,this.height=r*browser.devicePixelRatio,t.viewport(0,0,this.width,this.height)},Painter.prototype.setup=function(){var e=this.gl;e.verbose=!0,e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.STENCIL_TEST),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),this._depthMask=!1,e.depthMask(!1);var r=new PosArray;r.emplaceBack(0,0),r.emplaceBack(EXTENT,0),r.emplaceBack(0,EXTENT),r.emplaceBack(EXTENT,EXTENT),this.tileExtentBuffer=Buffer.fromStructArray(r,Buffer.BufferType.VERTEX),this.tileExtentVAO=new VertexArrayObject,this.tileExtentPatternVAO=new VertexArrayObject;var t=new PosArray;t.emplaceBack(0,0),t.emplaceBack(EXTENT,0),t.emplaceBack(EXTENT,EXTENT),t.emplaceBack(0,EXTENT),t.emplaceBack(0,0),this.debugBuffer=Buffer.fromStructArray(t,Buffer.BufferType.VERTEX),this.debugVAO=new VertexArrayObject;var i=new RasterBoundsArray;i.emplaceBack(0,0,0,0),i.emplaceBack(EXTENT,0,32767,0),i.emplaceBack(0,EXTENT,0,32767),i.emplaceBack(EXTENT,EXTENT,32767,32767),this.rasterBoundsBuffer=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX),this.rasterBoundsVAO=new VertexArrayObject,this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))},Painter.prototype.clearColor=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},Painter.prototype.clearStencil=function(){var e=this.gl;e.clearStencil(0),e.stencilMask(255),e.clear(e.STENCIL_BUFFER_BIT)},Painter.prototype.clearDepth=function(){var e=this.gl;e.clearDepth(1),this.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT)},Painter.prototype._renderTileClippingMasks=function(e){var r=this,t=this.gl;t.colorMask(!1,!1,!1,!1),this.depthMask(!1),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.stencilMask(248),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE);var i=1;this._tileClippingMaskIDs={};for(var a=0,s=e;a<s.length;a+=1){var o=s[a],n=r._tileClippingMaskIDs[o.id]=i++<<3;t.stencilFunc(t.ALWAYS,n,248);var l=r.useProgram("fill",r.basicFillProgramConfiguration);t.uniformMatrix4fv(l.u_matrix,!1,o.posMatrix),r.tileExtentVAO.bind(t,l,r.tileExtentBuffer),t.drawArrays(t.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}t.stencilMask(0),t.colorMask(!0,!0,!0,!0),this.depthMask(!0),t.enable(t.DEPTH_TEST)},Painter.prototype.enableTileClippingMask=function(e){var r=this.gl;r.stencilFunc(r.EQUAL,this._tileClippingMaskIDs[e.id],248)},Painter.prototype.prepareBuffers=function(){},Painter.prototype.bindDefaultFramebuffer=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},Painter.prototype.render=function(e,r){if(this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.spriteAtlas=e.spriteAtlas,this.spriteAtlas.setSprite(e.sprite),this.glyphSource=e.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,e.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(r.showOverdrawInspector),this.depthRange=(e._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var t=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];t&&draw.debug(this,t,t.getVisibleCoordinates())}},Painter.prototype.renderPass=function(){var e,r,t=this,i=this.style._order;this.currentLayer=this.isOpaquePass?i.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var a=0;a<i.length;a++){var s=t.style._layers[i[t.currentLayer]];s.source!==(e&&e.id)&&(e=t.style.sourceCaches[s.source],r=[],e&&(e.prepare&&e.prepare(),t.clearStencil(),r=e.getVisibleCoordinates(),e.getSource().isTileClipped&&t._renderTileClippingMasks(r)),t.isOpaquePass||r.reverse()),t.renderLayer(t,e,s,r),t.currentLayer+=t.isOpaquePass?-1:1}},Painter.prototype.depthMask=function(e){e!==this._depthMask&&(this._depthMask=e,this.gl.depthMask(e))},Painter.prototype.renderLayer=function(e,r,t,i){t.isHidden(this.transform.zoom)||("background"===t.type||i.length)&&(this.id=t.id,draw[t.type](e,r,t,i))},Painter.prototype.setDepthSublayer=function(e){var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,t=r-1+this.depthRange;this.gl.depthRange(t,r)},Painter.prototype.translatePosMatrix=function(e,r,t,i){if(!t[0]&&!t[1])return e;if("viewport"===i){var a=Math.sin(-this.transform.angle),s=Math.cos(-this.transform.angle);t=[t[0]*s-t[1]*a,t[0]*a+t[1]*s]}var o=[pixelsToTileUnits(r,t[0],this.transform.zoom),pixelsToTileUnits(r,t[1],this.transform.zoom),0],n=new Float32Array(16);return mat4.translate(n,e,o),n},Painter.prototype.saveTileTexture=function(e){var r=this.reusableTextures.tiles[e.size];r?r.push(e):this.reusableTextures.tiles[e.size]=[e]},Painter.prototype.saveViewportTexture=function(e){this.reusableTextures.viewport=e},Painter.prototype.getTileTexture=function(e){var r=this.reusableTextures.tiles[e];return r&&r.length>0?r.pop():null},Painter.prototype.getViewportTexture=function(e,r){var t=this.reusableTextures.viewport;if(t)return t.width===e&&t.height===r?t:(this.gl.deleteTexture(t),void(this.reusableTextures.viewport=null))},Painter.prototype.lineWidth=function(e){this.gl.lineWidth(util.clamp(e,this.lineWidthRange[0],this.lineWidthRange[1]))},Painter.prototype.showOverdrawInspector=function(e){if(e||this._showOverdrawInspector){this._showOverdrawInspector=e;var r=this.gl;if(e){r.blendFunc(r.CONSTANT_COLOR,r.ONE);r.blendColor(1/8,1/8,1/8,0),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}else r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)}},Painter.prototype.createProgram=function(e,r){var t=this.gl,i=t.createProgram(),a=shaders[e],s="#define MINEMAP_JS\n#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(s+="#define OVERDRAW_INSPECTOR;\n");var o=r.applyPragmas(s+shaders.prelude.fragmentSource+a.fragmentSource,"fragment"),n=r.applyPragmas(s+shaders.prelude.vertexSource+a.vertexSource,"vertex"),l=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(l,o),t.compileShader(l),t.attachShader(i,l);var u=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,n),t.compileShader(u),t.attachShader(i,u),t.linkProgram(i);for(var h=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES),c={program:i,numAttributes:h},p=0;p<h;p++){var d=t.getActiveAttrib(i,p);c[d.name]=t.getAttribLocation(i,d.name)}for(var g=t.getProgramParameter(i,t.ACTIVE_UNIFORMS),f=0;f<g;f++){var T=t.getActiveUniform(i,f);c[T.name]=t.getUniformLocation(i,T.name)}return c},Painter.prototype._createProgramCached=function(e,r){this.cache=this.cache||{};var t=""+e+(r.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[t]||(this.cache[t]=this.createProgram(e,r)),this.cache[t]},Painter.prototype.useProgram=function(e,r){var t=this.gl,i=this._createProgramCached(e,r||this.emptyProgramConfiguration);return this.currentProgram!==i&&(t.useProgram(i.program),this.currentProgram=i),i},module.exports=Painter;
},{"../data/buffer":214,"../data/extent":217,"../data/pos_array":220,"../data/program_configuration":221,"../data/raster_bounds_array":222,"../source/pixels_to_tile_units":259,"../source/source_cache":264,"../util/browser":372,"../util/testures_cache":397,"../util/util":399,"./draw_airline":231,"./draw_background":232,"./draw_circle":233,"./draw_collada":234,"./draw_debug":236,"./draw_dynamic_line":237,"./draw_extrusion":238,"./draw_fill":239,"./draw_histogram":240,"./draw_line":241,"./draw_raster":242,"./draw_sprite":243,"./draw_symbol":244,"./draw_symtracking":245,"./draw_tracking":246,"./frame_history":247,"./shaders":251,"./vertex_array_object":252,"@minemap/gl-matrix":2}],250:[function(require,module,exports){
"use strict";var pixelsToTileUnits=require("../source/pixels_to_tile_units");exports.prepare=function(r,t,i){var o=t.gl,e=t.spriteAtlas.getPosition(r.from,!0),_=t.spriteAtlas.getPosition(r.to,!0);e&&_&&(o.uniform1i(i.u_image,0),o.uniform2fv(i.u_pattern_tl_a,e.tl),o.uniform2fv(i.u_pattern_br_a,e.br),o.uniform2fv(i.u_pattern_tl_b,_.tl),o.uniform2fv(i.u_pattern_br_b,_.br),o.uniform1f(i.u_mix,r.t),o.uniform2fv(i.u_pattern_size_a,e.size),o.uniform2fv(i.u_pattern_size_b,_.size),o.uniform1f(i.u_scale_a,r.fromScale),o.uniform1f(i.u_scale_b,r.toScale),o.activeTexture(o.TEXTURE0),t.spriteAtlas.bind(o,!0))},exports.setTile=function(r,t,i){var o=t.gl;o.uniform1f(i.u_tile_units_to_pixels,1/pixelsToTileUnits(r,1,t.transform.tileZoom));var e=Math.pow(2,r.coord.z),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/e,u=_*(r.coord.x+r.coord.w*e),n=_*r.coord.y;o.uniform2f(i.u_pixel_coord_upper,u>>16,n>>16),o.uniform2f(i.u_pixel_coord_lower,65535&u,65535&n)};
},{"../source/pixels_to_tile_units":259}],251:[function(require,module,exports){
"use strict";var path=require("path");module.exports={prelude:{fragmentSource:"#ifdef GL_ES\r\nprecision mediump float;\r\n#else\r\n\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#endif\r\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n\n// To minimize the number of attributes needed in the minemap-gl-native shaders,\n// we encode a 4-component color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    float r = floor(encodedColor[0]/256.0)/255.0;\n    float g = (encodedColor[0] - r*256.0*255.0)/255.0;\n    float b = floor(encodedColor[1]/256.0)/255.0;\n    float a = (encodedColor[1] - b*256.0*255.0)/255.0;\n    return vec4(r, g, b, a);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize mediump float radius\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize highp vec4 stroke_color\n    #pragma minemap: initialize mediump float stroke_width\n    #pragma minemap: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize mediump float radius\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize highp vec4 stroke_color\n    #pragma minemap: initialize mediump float stroke_width\n    #pragma minemap: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\r\nuniform float u_maxzoom;\r\n\r\nvarying float v_max_zoom;\r\nvarying float v_placement_zoom;\r\n\r\nvoid main() {\r\n\r\n    float alpha = 0.5;\r\n\r\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\r\n\r\n    if (v_placement_zoom > u_zoom) {\r\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\r\n    }\r\n\r\n    if (u_zoom >= v_max_zoom) {\r\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\r\n    }\r\n\r\n    if (v_placement_zoom >= u_maxzoom) {\r\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\r\n    }\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_data;\r\n\r\nuniform mat4 u_matrix;\r\nuniform float u_scale;\r\n\r\nvarying float v_max_zoom;\r\nvarying float v_placement_zoom;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\r\n\r\n    v_max_zoom = a_data.x;\r\n    v_placement_zoom = a_data.y;\r\n}\r\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color;\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\r\n}\r\n"},fill:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 outline_color\n    #pragma minemap: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 outline_color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillWater:{fragmentSource:"#define TAU 6.28318530718\n#define MAX_ITER 5\n#define INTENSITY 0.004\n#define SCALE 1000.0\n\nuniform lowp float u_time;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / SCALE;\n    vec2 p = mod(uv * TAU, TAU) - 250.0;\n    vec2 i = vec2(p);\n    float c = 1.0;\n\n    for (int n = 0; n < MAX_ITER; n++) {\n        float t = 0.5 * u_time * (1.0 - (3.5 / float(n + 1)));\n        i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n        c += 1.0 / length(vec2(p.x / (sin(i.x + t) / INTENSITY), p.y / (cos(i.y + t) / INTENSITY)));\n    }\n    c = 1.17 - pow(c / float(MAX_ITER), 1.4);\n\n    gl_FragColor = vec4(clamp(vec3(pow(abs(c), 8.0)) + vec3(0.0, 0.35, 0.5), 0.0, 1.0), 1.0);\n\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma minemap: define lowp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},extrusion:{fragmentSource:"varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define highp vec4 color\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},extrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},collada:{fragmentSource:"varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nuniform sampler2D u_big_texture;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    vec4 _color = texture2D(u_big_texture, v_pos/1000.0);\n    //gl_FragColor = vec4(_color.rgb * v_color.rgb * 1.1 ,1.0);\n    gl_FragColor = _color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform vec3 u_ambientcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec3 a_pos;\nattribute vec2 a_texture;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define highp vec4 color\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    v_pos = a_texture;\n\n    gl_Position = u_matrix * vec4(a_pos, 1.0);\n\n//    float colorvalue =  1.0;\n//\n//        v_color = vec4(1.0, 1.0, 1.0, 1.0);\n//\n//        // Add slight ambient lighting so no extrusions are totally black\n//        vec4 ambientlight = vec4(0.13, 0.13, 0.13, 1.0);\n//        vec4 diffuselight = vec4(1.0, 1.0, 1.0, 1.0);\n//\n//        vec3 vLightDir = normalize(vec3(10000.0,10000.0,100000.0) - a_pos);\n//\n//        float diff = max(0.0,dot(normalize(a_normal),vLightDir));\n//\n//        v_color = diff * diffuselight;\n//\n//        v_color+=ambientlight;\n//\n//\n//        vec3 vReflection = normalize(reflect(-vLightDir,normalize(a_normal)));\n//        float spec = max(0.0,dot(normalize(a_normal),vReflection));\n//\n//        if(diff!=0.0){\n//\n//                float fSpec = pow(spec,128.0);\n//                v_color.rgb+=vec3(fSpec,fSpec,fSpec);\n//        }\n\n\n\n\n}\n"},colladaPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},histogram:{fragmentSource:"varying vec4 v_color;\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n#pragma minemap: define lowp vec4 color\r\nvarying float v_opacity;\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize lowp vec4 color\r\n\r\n    gl_FragColor = v_color * v_opacity;\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform float u_is_max_length;  // \n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define lowp vec4 color\n\nvarying float v_opacity;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? ( u_is_max_length == 1.0 ? height * 100.0 : height * 3.0 ) : base * 300.0, 1);\n    if(t > 0.0){\n        v_opacity = 1.2;\n    }else{\n        v_opacity = 0.1;\n    }\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},histogramColor:{fragmentSource:"\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define lowp vec4 color\n\nuniform vec4 u_color_a;\nuniform vec4 u_color_b;\nuniform vec4 u_color_c;\nuniform vec4 u_color_d;\nuniform vec4 u_color_e;\nuniform float u_max_height;\n\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize lowp vec4 color\n\n    if (v_height < 0.25 * u_max_height) {\n            vec4 tmp = u_color_b - u_color_a;\n            vec4 real = tmp * ((v_height) / 0.25 / u_max_height) + u_color_a;\n            gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n        } else if (v_height < 0.5 * u_max_height) {\n            vec4 tmp = u_color_c - u_color_b;\n            vec4 real = tmp * ((v_height - 0.25 * u_max_height) / 0.25 / u_max_height) + u_color_b;\n            gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n        } else if (v_height < 0.75 * u_max_height) {\n            vec4 tmp = u_color_d - u_color_c;\n            vec4 real = tmp * ((v_height - 0.5 * u_max_height) / 0.25 / u_max_height) + u_color_c;\n            gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n        } else if (v_height < 0.8 * u_max_height){\n            vec4 tmp = u_color_e - u_color_d;\n            vec4 real = tmp * ((v_height - 0.75 * u_max_height) / 0.25 / u_max_height) + u_color_d;\n            gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n        } else{\n            gl_FragColor = vec4(u_color_e.rgb * v_directional, 1.0);\n        }\n\n    //gl_FragColor = v_color * v_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define lowp vec4 color\n\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height * 3.0 : base * 3.0, 1);\n    if(t > 0.0){\n        v_opacity = 1.2;\n        v_height = height*3.0;\n    }else{\n        v_opacity = 0.1;\n        v_height = 0.0;\n    }\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_directional = directional;\n\n}\n"},histogramPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\r\nuniform float u_opacity;\r\n\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(0.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform int u_xdim;\r\nuniform int u_ydim;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n\r\n    v_pos.x = a_pos.x / float(u_xdim);\r\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\r\n}\r\n"},sprite:{fragmentSource:"#pragma minemap: define lowp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float v_discard;\nvarying float v_opacity;\n\nvoid main() {\n    #pragma minemap: initialize lowp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    if(v_discard<0.0){\n        discard;\n    }\n\n    float opacity_m = v_opacity;\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity) * opacity_m;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\nattribute vec3 a_extra_m;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\nuniform vec4 u_speed_mat;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying float v_opacity;\nvarying float v_discard;\n\n#pragma minemap: define lowp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize lowp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n//\n        vec3 f_extra_m = vec3(a_extra_m[0] * 3.0 / 255.0,a_extra_m[1], a_extra_m[2]);\n        float status = f_extra_m[2];\n        float link_seq = f_extra_m[1];\n        v_opacity = f_extra_m[0];\n\n        float speed1 = u_speed_mat[0];\n        float speed2 = u_speed_mat[1];\n        float speed3 = u_speed_mat[2];\n        float speed4 = u_speed_mat[3];\n\n        if(status ==1.0){\n            if(link_seq!=speed1){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 2.0){\n            if(link_seq!=speed2){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 3.0){\n            if(link_seq!=speed3){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 4.0){\n            if(link_seq!=speed4){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }\n\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},tracking:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n//hack me\nuniform float u_start;\nuniform float u_end;\nuniform float u_segments;\nuniform float u_reverse;\nuniform float u_reserve;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    mediump float drive_opacity = 1.0;\n    if(u_reserve == 1.0){\n        if(v_seq>u_end){\n            discard;\n        }\n    }else{\n        if(v_seq<u_start || v_seq>u_end){\n            discard;\n        }\n\n        drive_opacity = (v_seq - u_start) / u_segments;\n        if(u_reverse == 1.0){\n            drive_opacity = 1.0 - drive_opacity;\n        }\n    }\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n        // Calculate the antialiasing fade factor. This is either when fading in\n        // the line in case of an offset line (v_width2.t) or when fading out\n        // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n    vec4 tmpColor = vec4(color.xyz,0.25);\n    gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\nattribute float a_seq;  //hack me\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n    v_seq = a_seq;\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},line:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},airline:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float _is_discard;\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    if(_is_discard<0.0) discard;\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute float a_height;\nattribute vec4 a_data;\nattribute vec2 a_seq;  //hack me\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n//hack me\nuniform float u_start;\nuniform float u_segments;\nuniform float u_discard;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying float _is_discard;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n     float count = mod(u_start,a_seq[1]);\n\n     _is_discard = 100.0;\n     //hack me\n     if(u_discard == 1.0){\n         if((count+u_segments)<=a_seq[1] && (a_seq[0]<(count) || a_seq[0]>(count+u_segments))){\n             _is_discard = -100.0;\n         }else if((count+u_segments)>a_seq[1] && (a_seq[0]> (count+u_segments-a_seq[1]) && a_seq[0]<count)){\n             _is_discard = -100.0;\n         }\n     }\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos.xy, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos.xy * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_height * 10.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},airlinePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},airlineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image0;\r\nuniform sampler2D u_image1;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\n\r\nuniform float u_brightness_low;\r\nuniform float u_brightness_high;\r\n\r\nuniform float u_saturation_factor;\r\nuniform float u_contrast_factor;\r\nuniform vec3 u_spin_weights;\r\n\r\nvoid main() {\r\n\r\n    // read and cross-fade colors from the main and parent tiles\r\n    vec4 color0 = texture2D(u_image0, v_pos0);\r\n    vec4 color1 = texture2D(u_image1, v_pos1);\r\n    vec4 color = mix(color0, color1, u_fade_t);\r\n    color.a *= u_opacity;\r\n    vec3 rgb = color.rgb;\r\n\r\n    // spin\r\n    rgb = vec3(\r\n        dot(rgb, u_spin_weights.xyz),\r\n        dot(rgb, u_spin_weights.zxy),\r\n        dot(rgb, u_spin_weights.yzx));\r\n\r\n    // saturation\r\n    float average = (color.r + color.g + color.b) / 3.0;\r\n    rgb += (average - rgb) * u_saturation_factor;\r\n\r\n    // contrast\r\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\r\n\r\n    // brightness\r\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\r\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\r\n\r\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_tl_parent;\r\nuniform float u_scale_parent;\r\nuniform float u_buffer_scale;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\n\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\r\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\r\n}\r\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma minemap: define lowp float opacity\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_font_scale;\nuniform highp float u_gamma_scale;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / u_gamma_scale;\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / u_gamma_scale;\n        buff = (6.0 - halo_width / u_font_scale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    highp float gamma_scaled = gamma * v_gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symtrackingIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n    if(v_seq<0.0){\n            discard;\n    }\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\nattribute float a_seq;\n\n#pragma minemap: define lowp float opacity\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\nuniform float u_seq;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    if(a_seq!=u_seq){\n        v_seq = -100.0;\n    }else{\n        v_seq = 100.0;\n    }\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symtrackingSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_font_scale;\nuniform highp float u_gamma_scale;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    if(v_seq<0.0){\n        discard;\n    }\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / u_gamma_scale;\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / u_gamma_scale;\n        buff = (6.0 - halo_width / u_font_scale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    highp float gamma_scaled = gamma * v_gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\nattribute float a_seq;\n\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\nuniform float u_seq;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    if(a_seq!=u_seq){\n        v_seq = -100.0;\n    }else{\n        v_seq = 100.0;\n    }\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},gaosiBlurV:{
fragmentSource:"\nvarying vec2 vs_texcoord;\n\nuniform sampler2D u_texture;\n\nfloat tex_height = 1.0;\n\n\nfloat gauss_num[21];\n\nvoid main() {\n    gauss_num[0] = 0.021280559506451097;\n    gauss_num[1] = 0.08447372273836855;\n    gauss_num[2] = 0.08321607369191836;\n    gauss_num[3] = 0.08116146287664508;\n    gauss_num[4] = 0.07836994999012749;\n    gauss_num[5] = 0.07492147710977388;\n    gauss_num[6] = 0.07091206797059359;\n    gauss_num[7] = 0.06644939456137887;\n    gauss_num[8] = 0.06164799608487204;\n    gauss_num[9] = 0.05662444495021771;\n    gauss_num[10] = 0.051492740957503745;\n    gauss_num[11] = 0.04636018069357435;\n    gauss_num[12] = 0.04132389869226795;\n    gauss_num[13] = 0.036468215664951495;\n    gauss_num[14] = 0.03186286319074543;\n    gauss_num[15] = 0.027562089670590918;\n    gauss_num[16] = 0.023604594378100918;\n    gauss_num[17] = 0.02001418918206945;\n    gauss_num[18] = 0.016801053601614217;\n    gauss_num[19] = 0.013963429359150317;\n    gauss_num[20] =  0.011489595129084661;\n\n    vec4 color = texture2D(u_texture, vs_texcoord) * gauss_num[0];\n    float step = 1.0 / 650.0;\n\n    for (int i = 0; i <21; i++) {\n        if (vs_texcoord.y - float(i) * step >= 0.0) {\n            color += texture2D(u_texture, vec2(vs_texcoord.x, vs_texcoord.y - float(i) * step)) * gauss_num[i];\n        }\n\n        if (vs_texcoord.y + float(i) * step <= 1.0) {\n            color += texture2D(u_texture, vec2(vs_texcoord.x, vs_texcoord.y + float(i) * step)) * gauss_num[i];\n        }\n    }\n\n    gl_FragColor = color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 vs_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    vs_texcoord.x = a_pos.x / float(u_xdim);\n    vs_texcoord.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},gaosiBlurH:{fragmentSource:"\nvarying vec2 vs_texcoord;\n\nuniform sampler2D u_texture;\n//uniform float tex_width;\n\nfloat tex_width = 1.0;\n\nfloat gauss_num[21];\n\nvoid main() {\n\ngauss_num[0] = 0.021280559506451097;\n    gauss_num[1] = 0.08447372273836855;\n    gauss_num[2] = 0.08321607369191836;\n    gauss_num[3] = 0.08116146287664508;\n    gauss_num[4] = 0.07836994999012749;\n    gauss_num[5] = 0.07492147710977388;\n    gauss_num[6] = 0.07091206797059359;\n    gauss_num[7] = 0.06644939456137887;\n    gauss_num[8] = 0.06164799608487204;\n    gauss_num[9] = 0.05662444495021771;\n    gauss_num[10] = 0.051492740957503745;\n    gauss_num[11] = 0.04636018069357435;\n    gauss_num[12] = 0.04132389869226795;\n    gauss_num[13] = 0.036468215664951495;\n    gauss_num[14] = 0.03186286319074543;\n    gauss_num[15] = 0.027562089670590918;\n    gauss_num[16] = 0.023604594378100918;\n    gauss_num[17] = 0.02001418918206945;\n    gauss_num[18] = 0.016801053601614217;\n    gauss_num[19] = 0.013963429359150317;\n    gauss_num[20] =  0.011489595129084661;\n    vec4 color = texture2D(u_texture, vs_texcoord) * gauss_num[0];\n    float step = 1.0 / 1366.0;\n\n    for (int i = 1; i < 21; i++) {\n        if (vs_texcoord.x - float(i) * step >= 0.0) {\n            color += texture2D(u_texture, vec2(vs_texcoord.x - float(i) * step, vs_texcoord.y)) * gauss_num[i];\n        }\n\n        if (vs_texcoord.x + float(i) * step <= 1.0) {\n            color += texture2D(u_texture, vec2(vs_texcoord.x + float(i) * step, vs_texcoord.y)) * gauss_num[i];\n        }\n    }\n\n    gl_FragColor = color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 vs_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    vs_texcoord.x = a_pos.x / float(u_xdim);\n    vs_texcoord.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},gaosiBlend:{fragmentSource:"\nvarying vec2 vs_texcoord;\n\nuniform sampler2D blur_tex;\nuniform sampler2D scene_tex;\n\nvoid main() {\n    vec4 blur_color = texture2D(blur_tex, vs_texcoord);\n    vec4 scene_color = texture2D(scene_tex, vs_texcoord);\n    gl_FragColor = blur_color * 0.5 + scene_color * 0.5;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 vs_texcoord;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    vs_texcoord.x = a_pos.x / float(u_xdim);\n    vs_texcoord.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},dynamicLine:{fragmentSource:"#pragma minemap: define lowp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform float u_count;\r\nuniform float u_segments;\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float v_seq;\r\nvarying vec2 v_info;\r\nvoid main() {\r\n    #pragma minemap: initialize lowp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    float total_count = v_info[0];\r\n    float offset_count = v_info[1];\r\n    // v_seq2,\r\n    float actualSeq = v_seq - 2.0;\r\n    float actualCount = u_count + offset_count;\r\n    float quotient = floor(actualCount / (total_count + u_segments));\r\n    float mod1 = mod(quotient, 2.0);\r\n    float count = mod(actualCount, total_count + u_segments);\r\n    if(mod1 != 0.0){\r\n        count = total_count + u_segments - count;\r\n    }\r\n\r\n    float start = count - u_segments;\r\n    float end = count;\r\n\r\n    if(actualSeq<start || actualSeq>end){\r\n         discard;\r\n     }\r\n\r\n     mediump float drive_opacity = (actualSeq - start) / u_segments;\r\n     if(mod1 != 0.0){\r\n         drive_opacity = 1.0 - drive_opacity;\r\n     }\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n    vec4 tmpColor = vec4(color.xyz,0.25);\r\n   gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_data;\r\nattribute float a_seq;\r\nattribute vec2 a_info;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform mediump float u_width;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float v_seq;\r\nvarying vec2 v_info;\r\n\r\n#pragma minemap: define lowp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n\r\n    v_seq = a_seq;\r\n    v_info = a_info;\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    // We store the texture normals in the most insignificant bit\r\n    // transform y so that 0 => -1 and 1 => 1\r\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = mod(a_pos, 2.0);\r\n    normal.y = sign(normal.y - 0.5);\r\n    v_normal = normal;\r\n\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float width = u_width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    // Remove the texture normal bit to get the position\r\n    vec2 pos = floor(a_pos * 0.5);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"}};
},{"path":151}],252:[function(require,module,exports){
"use strict";var VertexArrayObject=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};VertexArrayObject.prototype.bind=function(e,t,r,i,n,o){void 0===e.extVertexArrayObject&&(e.extVertexArrayObject=e.getExtension("OES_vertex_array_object"));var s=!this.vao||this.boundProgram!==t||this.boundVertexBuffer!==r||this.boundVertexBuffer2!==n||this.boundElementBuffer!==i||this.boundVertexOffset!==o;!e.extVertexArrayObject||s?(this.freshBind(e,t,r,i,n,o),this.gl=e):e.extVertexArrayObject.bindVertexArrayOES(this.vao)},VertexArrayObject.prototype.freshBind=function(e,t,r,i,n,o){var s,u=t.numAttributes;if(e.extVertexArrayObject)this.vao&&this.destroy(),this.vao=e.extVertexArrayObject.createVertexArrayOES(),e.extVertexArrayObject.bindVertexArrayOES(this.vao),s=0,this.boundProgram=t,this.boundVertexBuffer=r,this.boundVertexBuffer2=n,this.boundElementBuffer=i,this.boundVertexOffset=o;else{s=e.currentNumAttributes||0;for(var b=u;b<s;b++)e.disableVertexAttribArray(b)}for(var a=s;a<u;a++)e.enableVertexAttribArray(a);r.bind(e),r.setVertexAttribPointers(e,t,o),n&&(n.bind(e),n.setVertexAttribPointers(e,t,o)),i&&i.bind(e),e.currentNumAttributes=u},VertexArrayObject.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},module.exports=VertexArrayObject;
},{}],253:[function(require,module,exports){
"use strict";var ImageSource=require("./image_source"),window=require("../util/window"),CanvasSource=function(t){function i(i,a,s,n){t.call(this,i,a,s,n),this.options=a,this.animate=!a.hasOwnProperty("animate")||a.animate}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){if(this.canvas=this.canvas||window.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions())return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&this.animate&&this.play())},i.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||this.tile&&this._prepareImage(this.map.painter.gl,this.canvas,t)},i.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},i.prototype._hasInvalidDimensions=function(){for(var t=this,i=0,a=[t.canvas.width,t.canvas.height];i<a.length;i+=1){var s=a[i];if(isNaN(s)||s<=0)return!0}return!1},i}(ImageSource);module.exports=CanvasSource;
},{"../util/window":374,"./image_source":257}],254:[function(require,module,exports){
"use strict";function resolveURL(t){var e=window.document.createElement("a");return e.href=t,e.href}var Evented=require("../util/evented"),util=require("../util/util"),window=require("../util/window"),EXTENT=require("../data/extent"),GeoJSONSource=function(t){function e(e,o,i,r){t.call(this),o=o||{},this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=i,this.setEventedParent(r),this._data=o.data,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type);var a=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*a,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*a,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(o.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:EXTENT,radius:(o.clusterRadius||50)*a,log:!1}},o.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){if(e)return void t.fire("error",{error:e});t.fire("data",{dataType:"source",sourceDataType:"metadata"})})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){if(t)return e.fire("error",{error:t});e.fire("data",{dataType:"source",sourceDataType:"content"})}),this},e.prototype._updateWorkerData=function(t){var e=this,o=util.extend({},this.workerOptions),i=this._data;"string"==typeof i?o.url=resolveURL(i):o.data=JSON.stringify(i),this.workerID=this.dispatcher.send(this.type+".loadData",o,function(o){e._loaded=!0,t(o)})},e.prototype.loadTile=function(t,e){var o=this,i=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:i,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send("loadTile",r,function(i,r){if(t.unloadVectorData(),!t.aborted)return i?e(i):(t.loadVectorData(r,o.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(o)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return{type:this.type,data:this._data}},e}(Evented);module.exports=GeoJSONSource;
},{"../data/extent":217,"../util/evented":381,"../util/util":399,"../util/window":374}],255:[function(require,module,exports){
"use strict";var ajax=require("../util/ajax"),rewind=require("geojson-rewind"),GeoJSONWrapper=require("./geojson_wrapper"),vtpbf=require("vt-pbf"),supercluster=require("supercluster"),geojsonvt=require("geojson-vt"),VectorTileWorkerSource=require("./vector_tile_worker_source"),GeoJSONWorkerSource=function(e){function r(r,t,o){e.call(this,r,t),o&&(this.loadGeoJSON=o),this._geoJSONIndexes={}}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadVectorData=function(e,r){var t=e.source,o=e.coord;if(!this._geoJSONIndexes[t])return r(null,null);var n=this._geoJSONIndexes[t].getTile(Math.min(o.z,e.maxZoom),o.x,o.y);if(!n)return r(null,null);var u=new GeoJSONWrapper(n.features);u.name="_geojsonTileLayer";var a=vtpbf({layers:{_geojsonTileLayer:u}});0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),u.rawData=a.buffer,r(null,u)},r.prototype.loadData=function(e,r){var t=function(t,o){var n=this;return t?r(t):"object"!=typeof o?r(new Error("Input data is not a valid GeoJSON object.")):(rewind(o,!0),void this._indexData(o,e,function(t,o){if(t)return r(t);n._geoJSONIndexes[e.source]=o,r(null)}))}.bind(this);this.loadGeoJSON(e,t)},r.prototype.loadGeoJSON=function(e,r){if(e.url)ajax.getJSON(e.url,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(e){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(e){this._geoJSONIndexes[e.source]&&delete this._geoJSONIndexes[e.source]},r.prototype._indexData=function(e,r,t){try{r.cluster?t(null,supercluster(r.superclusterOptions).load(e.features)):t(null,geojsonvt(e,r.geojsonVtOptions))}catch(e){return t(e)}},r}(VectorTileWorkerSource);module.exports=GeoJSONWorkerSource;
},{"../util/ajax":370,"./geojson_wrapper":256,"./vector_tile_worker_source":268,"geojson-rewind":125,"geojson-vt":130,"supercluster":180,"vt-pbf":194}],256:[function(require,module,exports){
"use strict";var Point=require("point-geometry"),VectorTileFeature=require("vector-tile").VectorTileFeature,EXTENT=require("../data/extent"),FeatureWrapper=function(e){var t=this;if(this.type=e.type,1===e.type){this.rawGeometry=[];for(var r=0;r<e.geometry.length;r++)t.rawGeometry.push([e.geometry[r]])}else this.rawGeometry=e.geometry;this.properties=e.tags,"id"in e&&(this.id=e.id),this.extent=EXTENT};FeatureWrapper.prototype.loadGeometry=function(){var e=this,t=this.rawGeometry;this.geometry=[];for(var r=0;r<t.length;r++){for(var o=t[r],a=[],i=0;i<o.length;i++)a.push(new Point(o[i][0],o[i][1]));e.geometry.push(a)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-(1/0),o=1/0,a=-(1/0),i=0;i<e.length;i++)for(var p=e[i],h=0;h<p.length;h++){var n=p[h];t=Math.min(t,n.x),r=Math.max(r,n.x),o=Math.min(o,n.y),a=Math.max(a,n.y)}return[t,o,r,a]},FeatureWrapper.prototype.toGeoJSON=function(){VectorTileFeature.prototype.toGeoJSON.call(this)};var GeoJSONWrapper=function(e){this.features=e,this.length=e.length,this.extent=EXTENT};GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e])},module.exports=GeoJSONWrapper;
},{"../data/extent":217,"point-geometry":154,"vector-tile":190}],257:[function(require,module,exports){
"use strict";var util=require("../util/util"),window=require("../util/window"),TileCoord=require("./tile_coord"),LngLat=require("../geo/lng_lat"),Point=require("point-geometry"),Evented=require("../util/evented"),ajax=require("../util/ajax"),EXTENT=require("../data/extent"),RasterBoundsArray=require("../data/raster_bounds_array"),Buffer=require("../data/buffer"),VertexArrayObject=require("../render/vertex_array_object"),ImageSource=function(t){function e(e,o,r,i){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(i),this.options=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,ajax.getImage(this.options.url,function(e,o){if(e)return t.fire("error",{error:e});t.image=o,t._finishLoading()})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},e.prototype.onAdd=function(t){this.load(),this.map=t,this.image&&this.setCoordinates(this.coordinates)},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,o=t.map(function(t){return e.transform.locationCoordinate(LngLat.convert(t)).zoomTo(0)}),r=this.centerCoord=util.getCoordinatesCenter(o);return r.column=Math.round(r.column),r.row=Math.round(r.row),this.minzoom=this.maxzoom=r.zoom,this.coord=new TileCoord(r.zoom,r.column,r.row),this._tileCoords=o.map(function(t){var e=t.zoomTo(r.zoom);return new Point(Math.round((e.column-r.column)*EXTENT),Math.round((e.row-r.row)*EXTENT))}),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},e.prototype._setTile=function(t){this.tile=t;var e=new RasterBoundsArray;e.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),e.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,32767,0),e.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,32767),e.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,32767,32767),this.tile.buckets={},this.tile.boundsBuffer=Buffer.fromStructArray(e,Buffer.BufferType.VERTEX),this.tile.boundsVAO=new VertexArrayObject},e.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,o){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)):o?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof window.HTMLVideoElement||e instanceof window.ImageData||e instanceof window.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e))},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},e}(Evented);module.exports=ImageSource;
},{"../data/buffer":214,"../data/extent":217,"../data/raster_bounds_array":222,"../geo/lng_lat":227,"../render/vertex_array_object":252,"../util/ajax":370,"../util/evented":381,"../util/util":399,"../util/window":374,"./tile_coord":266,"point-geometry":154}],258:[function(require,module,exports){
"use strict";var util=require("../util/util"),ajax=require("../util/ajax"),browser=require("../util/browser"),normalizeURL=require("../util/minemap").normalizeSourceURL;module.exports=function(r,e){var i=function(r,i){if(r)return e(r);var t=util.pick(i,["tiles","minzoom","maxzoom","attribution","minemap_logo"]);i.vector_layers&&(t.vectorLayers=i.vector_layers,t.vectorLayerIds=t.vectorLayers.map(function(r){return r.id})),e(null,t)};r.url?ajax.getJSON(normalizeURL(r.url),i):browser.frame(i.bind(null,null,r))};
},{"../util/ajax":370,"../util/browser":372,"../util/minemap":390,"../util/util":399}],259:[function(require,module,exports){
"use strict";var EXTENT=require("../data/extent");module.exports=function(e,t,r){return t*(EXTENT/(e.tileSize*Math.pow(2,r-e.coord.z)))};
},{"../data/extent":217}],260:[function(require,module,exports){
"use strict";function sortTilesIn(e,r){var o=e.coord,t=r.coord;return o.z-t.z||o.y-t.y||o.w-t.w||o.x-t.x}function mergeRenderedFeatureLayers(e){for(var r=e[0]||{},o=1;o<e.length;o++){var t=e[o];for(var n in t){var a=t[n],i=r[n];if(void 0===i)i=r[n]=a;else for(var u=0;u<a.length;u++)i.push(a[u])}}return r}var TileCoord=require("./tile_coord");exports.rendered=function(e,r,o,t,n,a){var i=e.tilesIn(o);i.sort(sortTilesIn);for(var u=[],s=0;s<i.length;s++){var d=i[s];d.tile.featureIndex&&u.push(d.tile.featureIndex.query({queryGeometry:d.queryGeometry,scale:d.scale,tileSize:d.tile.tileSize,bearing:a,params:t},r))}return mergeRenderedFeatureLayers(u)},exports.source=function(e,r){for(var o=e.getRenderableIds().map(function(r){return e.getTileByID(r)}),t=[],n={},a=0;a<o.length;a++){var i=o[a],u=new TileCoord(Math.min(i.sourceMaxZoom,i.coord.z),i.coord.x,i.coord.y,0).id;n[u]||(n[u]=!0,i.querySourceFeatures(t,r))}return t};
},{"./tile_coord":266}],261:[function(require,module,exports){
"use strict";var util=require("../util/util"),ajax=require("../util/ajax"),Evented=require("../util/evented"),loadTileJSON=require("./load_tilejson"),normalizeURL=require("../util/minemap").normalizeTileURL,RasterTileSource=function(e){function t(t,i,r,a){e.call(this),this.id=t,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=i,util.extend(this,util.pick(i,["url","scheme","tileSize"]))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire("dataloading",{dataType:"source"}),loadTileJSON(this.options,function(t,i){if(t)return e.fire("error",t);util.extend(e,i),e.fire("data",{dataType:"source",sourceDataType:"metadata"}),e.fire("data",{dataType:"source",sourceDataType:"content"})})},t.prototype.onAdd=function(e){this.load(),this.map=e},t.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},t.prototype.loadTile=function(e,t){function i(i,r){if(delete e.request,e.aborted)return this.state="unloaded",t(null);if(i)return this.state="errored",t(i);this.map._refreshExpiredTiles||e.setExpiryData(r),delete r.cacheControl,delete r.expires;var a=this.map.painter.gl;e.texture=this.map.painter.getTileTexture(r.width),e.texture?(a.bindTexture(a.TEXTURE_2D,e.texture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,r)):(e.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,e.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.map.painter.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,this.map.painter.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this.map.painter.extTextureFilterAnisotropicMax),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),e.texture.size=r.width),a.generateMipmap(a.TEXTURE_2D),e.state="loaded",t(null)}var r=normalizeURL(e.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);e.request=ajax.getImage(r,i.bind(this))},t.prototype.abortTile=function(e){e.request&&(e.request.abort(),delete e.request)},t.prototype.unloadTile=function(e){e.texture&&this.map.painter.saveTileTexture(e.texture)},t}(Evented);module.exports=RasterTileSource;
},{"../util/ajax":370,"../util/evented":381,"../util/minemap":390,"../util/util":399,"./load_tilejson":258}],262:[function(require,module,exports){
"use strict";var ajax=require("../util/ajax"),Evented=require("../util/evented"),window=require("../util/window"),pluginRequested=!1,pluginBlobURL=null;module.exports.evented=new Evented,module.exports.registerForPluginAvailability=function(e){return pluginBlobURL?e(pluginBlobURL,module.exports.errorCallback):module.exports.evented.once("pluginAvailable",e),e},module.exports.setRTLTextPlugin=function(e,l){if(pluginRequested)throw new Error("setRTLTextPlugin cannot be called multiple times.");pluginRequested=!0,module.exports.errorCallback=l,ajax.getArrayBuffer(e,function(e,t){e?l(e):(pluginBlobURL=window.URL.createObjectURL(new window.Blob([t.data]),{type:"text/javascript"}),module.exports.evented.fire("pluginAvailable",{pluginBlobURL:pluginBlobURL,errorCallback:l}))})};
},{"../util/ajax":370,"../util/evented":381,"../util/window":374}],263:[function(require,module,exports){
"use strict";var util=require("../util/util"),sourceTypes={vector:require("../source/vector_tile_source"),raster:require("../source/raster_tile_source"),geojson:require("../source/geojson_source"),video:require("../source/video_source"),image:require("../source/image_source"),canvas:require("../source/canvas_source")};exports.create=function(e,r,o,u){if(r=new sourceTypes[r.type](e,r,o,u),r.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+r.id);return util.bindAll(["load","abort","unload","serialize","prepare"],r),r},exports.getType=function(e){return sourceTypes[e]},exports.setType=function(e,r){sourceTypes[e]=r};
},{"../source/canvas_source":253,"../source/geojson_source":254,"../source/image_source":257,"../source/raster_tile_source":261,"../source/vector_tile_source":267,"../source/video_source":269,"../util/util":399}],264:[function(require,module,exports){
"use strict";function coordinateToTilePoint(e,t,o){var i=o.zoomTo(Math.min(e.z,t));return{x:(i.column-(e.x+e.w*Math.pow(2,e.z)))*EXTENT,y:(i.row-e.y)*EXTENT}}function compareKeyZoom(e,t){return e%32-t%32}function isRasterType(e){return"raster"===e||"image"===e||"video"===e}var Source=require("./source"),Tile=require("./tile"),Evented=require("../util/evented"),TileCoord=require("./tile_coord"),Cache=require("../util/lru_cache"),Coordinate=require("../geo/coordinate"),util=require("../util/util"),EXTENT=require("../data/extent"),config=require("../util/config"),ajax=require("../util/ajax"),browser=require("../util/browser"),SourceCache=function(e){function t(t,o,i){e.call(this),this.id=t,this.dispatcher=i,this.on("data",function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("error",function(){this._sourceErrored=!0}),this._source=Source.create(t,o,i,this),this._tiles={},this._cache=new Cache(0,this.unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._rticTiles={},this._isIdRenderable=this._isIdRenderable.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onAdd=function(e){this.map=e,this._source&&this._source.onAdd&&this._source.onAdd(e)},t.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},t.prototype.loaded=function(){var e=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in e._tiles){var o=e._tiles[t];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0},t.prototype.getSource=function(){return this._source},t.prototype.loadTile=function(e,t){return this._source.loadTile(e,t)},t.prototype.unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e)},t.prototype.abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e)},t.prototype.serialize=function(){return this._source.serialize()},t.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},t.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(compareKeyZoom)},t.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},t.prototype._isIdRenderable=function(e){return this._tiles[e].hasData()&&!this._coveredTiles[e]},t.prototype.reload=function(){var e=this;this._cache.reset();for(var t in e._tiles)e.reloadTile(t,"reloading")},t.prototype.reloadTile=function(e,t){var o=this._tiles[e];o&&("loading"!==o.state&&(o.state=t),this.loadTile(o,this._tileLoaded.bind(this,o,e,t)))},t.prototype._tileLoaded=function(e,t,o,i){if(i)return e.state="errored",void(404!==i.status&&this._source.fire("error",{tile:e,error:i}));if("Rticline"==this._source.id&&"vector"==this._source.type&&"loading"==o){var r=this._source.maxzoom,s=this._source.scheme,a=e.coord.toAccess(r,s);if(a){var n=config.DYN_URL+"Rticvalue/"+a+"?token="+config.ACCESS_TOKEN+"&solu="+config.SOLU;this._loadRticValue(n)}}e.sourceCache=this,e.timeAdded=(new Date).getTime(),"expired"===o&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.fire("data",{dataType:"source",tile:e,coord:e.coord}),this.map&&(this.map.painter.tileExtentVAO.vao=null)},t.prototype._loadRticValue=function(e){var t=this;ajax.getJSON(e,function(e,o){if(e)return void t.fire("error",{error:e});t._resetRticTiles(o),t._repaintRticLayerColor()})},t.prototype._resetRticTiles=function(e){var t=this;if(e){var o=this._source.maxzoom,i=this._source.scheme,r=[];for(var s in t._tiles){var a=t._tiles[s],n=a.coord.toAccess(o,i);r.push(n),n==e.tile&&(t._rticTiles[n]=e)}Object.keys(this._rticTiles).map(function(e){r.indexOf(e)<0&&delete t._rticTiles[e]})}},t.prototype._getCombineRticData=function(){var e=this,t=["status_0","status_2","status_3"],o={};t.map(function(e){o[e]=[]});for(var i in e._rticTiles)!function(i){var r=e._rticTiles[i];t.map(function(e){r[e]&&r[e].map(function(t){o[e].indexOf(t)<0&&o[e].push(t)})})}(i);return o},t.prototype._getRticColorStyle=function(e){var t={};t.property="rtic_key",t.type="categorical",t.default="#66cc00",t.stops=[];var o={status_0:"#999999",status_2:"#ff9900",status_3:"#cc0000"};return["status_0","status_2","status_3"].map(function(i){var r=o[i];e[i].map(function(e){t.stops.push([e,r])})}),t},t.prototype._repaintRticLayerColor=function(){var e=this;if(this.map){for(var t=this.map.style._layers,o=[],i=0,r=Object.entries(t);i<r.length;i+=1){var s=r[i],a=s[0],n=s[1];n&&"Rticline"==n.source&&"line"==n.type&&o.push(a)}var c=function(t,o){e.map.setPaintProperty(t,"line-color",o)};if(o.length>0){var u=this._getRticColorStyle(this._getCombineRticData());o.map(function(t){browser.frame(c.bind(e,t,u))})}}},t.prototype.getTile=function(e){return this.getTileByID(e.id)},t.prototype.getTileByID=function(e){return this._tiles[e]},t.prototype.getZoom=function(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)},t.prototype.findLoadedChildren=function(e,t,o){var i=this,r=!1;for(var s in i._tiles){var a=i._tiles[s];if(!(o[s]||!a.hasData()||a.coord.z<=e.z||a.coord.z>t)){var n=Math.pow(2,Math.min(a.coord.z,i._source.maxzoom)-Math.min(e.z,i._source.maxzoom));if(Math.floor(a.coord.x/n)===e.x&&Math.floor(a.coord.y/n)===e.y)for(o[s]=!0,r=!0;a&&a.coord.z-1>e.z;){var c=a.coord.parent(i._source.maxzoom).id;a=i._tiles[c],a&&a.hasData()&&(delete o[s],o[c]=!0)}}}return r},t.prototype.findLoadedParent=function(e,t,o){for(var i=this,r=e.z-1;r>=t;r--){e=e.parent(i._source.maxzoom);var s=i._tiles[e.id];if(s&&s.hasData())return o[e.id]=!0,s;if(i._cache.has(e.id))return o[e.id]=!0,i._cache.getWithoutRemoving(e.id)}},t.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/e.tileSize)+1,o=Math.ceil(e.height/e.tileSize)+1,i=t*o;this._cache.setMaxSize(Math.floor(5*i))},t.prototype.update=function(e){var o=this;if(this.transform=e,this._sourceLoaded){var i,r,s,a;this.updateCacheSize(e);var n=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),c=this._source._options?this._source._options.odevity:0;"Merge_1"==this._source.id&&(c=1),c=0,1===c&&n%2==0?n+=1:2===c&&n%2==1&&(n+=1);var u=Math.max(n-t.maxOverzooming,this._source.minzoom),d=Math.max(n+t.maxUnderzooming,this._source.minzoom),h={};this._coveredTiles={};var l;for(l=this.used?this._source.coord?[this._source.coord]:e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,odevity:c,reparseOverscaled:this._source.reparseOverscaled}):[],i=0;i<l.length;i++)r=l[i],s=o.addTile(r),h[r.id]=!0,s.hasData()||o.findLoadedChildren(r,d,h)||(a=o.findLoadedParent(r,u,h))&&o.addTile(a.coord);var _={};if(isRasterType(this._source.type))for(var p=Object.keys(h),m=0;m<p.length;m++){var f=p[m];r=TileCoord.fromID(f),s=o._tiles[f],s&&((void 0===s.fadeEndTime||s.fadeEndTime>=Date.now())&&(o.findLoadedChildren(r,d,h)&&(h[f]=!0),(a=o.findLoadedParent(r,u,_))&&o.addTile(a.coord)))}var v;for(v in _)h[v]||(o._coveredTiles[v]=!0);for(v in _)h[v]=!0;var T=util.keysDifference(this._tiles,h);for(i=0;i<T.length;i++)o.removeTile(+T[i])}},t.prototype.addTile=function(e){var t=this._tiles[e.id];if(t)return t;var o=e.wrapped();(t=this._tiles[o.id])||(t=this._cache.get(o.id))&&(t.redoPlacement(this._source),this._cacheTimers[o.id]&&(clearTimeout(this._cacheTimers[o.id]),this._cacheTimers[o.id]=void 0,this._setTileReloadTimer(o.id,t)));var i=Boolean(t);if(!i){var r=e.z,s=r>this._source.maxzoom?Math.pow(2,r-this._source.maxzoom):1;t=new Tile(o,this._source.tileSize*s,this._source.maxzoom),this.loadTile(t,this._tileLoaded.bind(this,t,e.id,t.state))}return t.uses++,this._tiles[e.id]=t,i||this._source.fire("dataloading",{tile:t,coord:t.coord,dataType:"source"}),t},t.prototype._setTileReloadTimer=function(e,t){var o=this,i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout(function(){o.reloadTile(e,"expired"),o._timers[e]=void 0},i))},t.prototype._setCacheInvalidationTimer=function(e,t){var o=this,i=t.getExpiryTimeout();i&&(this._cacheTimers[e]=setTimeout(function(){o._cache.remove(e),o._cacheTimers[e]=void 0},i))},t.prototype.removeTile=function(e){var t=this._tiles[e];if(t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),this._timers[e]=void 0),!(t.uses>0)))if(t.hasData()){var o=t.coord.wrapped().id;this._cache.add(o,t),this._setCacheInvalidationTimer(o,t)}else t.aborted=!0,this.abortTile(t),this.unloadTile(t)},t.prototype.clearTiles=function(){var e=this;for(var t in e._tiles)e.removeTile(t);this._cache.reset()},t.prototype.tilesIn=function(e){for(var t=this,o={},i=this.getIds(),r=1/0,s=1/0,a=-(1/0),n=-(1/0),c=e[0].zoom,u=0;u<e.length;u++){var d=e[u];r=Math.min(r,d.column),s=Math.min(s,d.row),a=Math.max(a,d.column),n=Math.max(n,d.row)}for(var h=0;h<i.length;h++){var l=t._tiles[i[h]],_=TileCoord.fromID(i[h]),p=[coordinateToTilePoint(_,l.sourceMaxZoom,new Coordinate(r,s,c)),coordinateToTilePoint(_,l.sourceMaxZoom,new Coordinate(a,n,c))];if(p[0].x<EXTENT&&p[0].y<EXTENT&&p[1].x>=0&&p[1].y>=0){for(var m=[],f=0;f<e.length;f++)m.push(coordinateToTilePoint(_,l.sourceMaxZoom,e[f]));var v=o[l.coord.id];void 0===v&&(v=o[l.coord.id]={tile:l,coord:_,queryGeometry:[],scale:Math.pow(2,t.transform.zoom-l.coord.z)}),v.queryGeometry.push(m)}}var T=[];for(var y in o)T.push(o[y]);return T},t.prototype.redoPlacement=function(){for(var e=this,t=this.getIds(),o=0;o<t.length;o++){e.getTileByID(t[o]).redoPlacement(e._source)}},t.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(TileCoord.fromID),o=0,i=t;o<i.length;o+=1){var r=i[o];r.posMatrix=e.transform.calculatePosMatrix(r,e._source.maxzoom)}return t},t}(Evented);SourceCache.maxOverzooming=10,SourceCache.maxUnderzooming=3,module.exports=SourceCache;
},{"../data/extent":217,"../geo/coordinate":226,"../util/ajax":370,"../util/browser":372,"../util/config":376,"../util/evented":381,"../util/lru_cache":389,"../util/util":399,"./source":263,"./tile":265,"./tile_coord":266}],265:[function(require,module,exports){
"use strict";var util=require("../util/util"),Bucket=require("../data/bucket"),FeatureIndex=require("../data/feature_index"),vt=require("vector-tile"),Protobuf=require("pbf"),GeoJSONFeature=require("../util/vectortile_to_geojson"),featureFilter=require("../style-spec/feature_filter"),CollisionTile=require("../symbol/collision_tile"),CollisionBoxArray=require("../symbol/collision_box"),CLOCK_SKEW_RETRY_TIMEOUT=3e4,Tile=function(e,t,i){this.coord=e,this.uid=util.uniqueId(),this.uses=0,this.tileSize=t,this.sourceMaxZoom=i,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading"};Tile.prototype.registerFadeDuration=function(e,t){var i=t+this.timeAdded;i<Date.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i,e.set(this.fadeEndTime-Date.now()))},Tile.prototype.loadVectorData=function(e,t){this.hasData()&&this.unloadVectorData(),this.state="loaded",e&&(e.rawTileData&&(this.rawTileData=e.rawTileData),this.collisionBoxArray=new CollisionBoxArray(e.collisionBoxArray),this.collisionTile=new CollisionTile(e.collisionTile,this.collisionBoxArray),this.featureIndex=new FeatureIndex(e.featureIndex,this.rawTileData,this.collisionTile),this.buckets=Bucket.deserialize(e.buckets,t.style))},Tile.prototype.reloadSymbolData=function(e,t){var i=this;if("unloaded"!==this.state){this.collisionTile=new CollisionTile(e.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile);for(var o in i.buckets){var r=i.buckets[o];"symbol"===r.layers[0].type&&(r.destroy(),delete i.buckets[o])}util.extend(this.buckets,Bucket.deserialize(e.buckets,t))}},Tile.prototype.unloadVectorData=function(){var e=this;for(var t in e.buckets)e.buckets[t].destroy();this.buckets={},this.collisionBoxArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},Tile.prototype.redoPlacement=function(e){var t=this;if("vector"===e.type||"geojson"===e.type)return"loaded"!==this.state?void(this.redoWhenDone=!0):void(this.collisionTile&&(this.state="reloading",e.dispatcher.send("redoPlacement",{type:e.type,uid:this.uid,source:e.id,angle:e.map.transform.angle,pitch:e.map.transform.pitch,showCollisionBoxes:e.map.showCollisionBoxes},function(i,o){"reloading"===t.state&&(t.reloadSymbolData(o,e.map.style),e.map&&(e.map.painter.tileExtentVAO.vao=null),t.state="loaded",t.redoWhenDone&&(t.state="reloading",t.redoWhenDone=!1,t.redoPlacement(e)))},this.workerID)))},Tile.prototype.getBucket=function(e){return this.buckets[e.id]},Tile.prototype.querySourceFeatures=function(e,t){var i=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers);var o=this.vtLayers._geojsonTileLayer||this.vtLayers[t.sourceLayer];if(o)for(var r=featureFilter(t&&t.filter),s={z:this.coord.z,x:this.coord.x,y:this.coord.y},a=0;a<o.length;a++){var l=o.feature(a);if(r(l)){var n=new GeoJSONFeature(l,i.coord.z,i.coord.x,i.coord.y);n.tile=s,e.push(n)}}}},Tile.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Tile.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var i=util.parseCacheControl(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var o=Date.now(),r=!1;if(this.expirationTime>o)r=!1;else if(t)if(this.expirationTime<t)r=!0;else{var s=this.expirationTime-t;s?this.expirationTime=o+Math.max(s,CLOCK_SKEW_RETRY_TIMEOUT):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Tile.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},module.exports=Tile;
},{"../data/bucket":201,"../data/feature_index":218,"../style-spec/feature_filter":275,"../symbol/collision_box":339,"../symbol/collision_tile":341,"../util/util":399,"../util/vectortile_to_geojson":400,"pbf":153,"vector-tile":190}],266:[function(require,module,exports){
"use strict";function edge(t,i){if(t.row>i.row){var o=t;t=i,i=o}return{x0:t.column,y0:t.row,x1:i.column,y1:i.row,dx:i.column-t.column,dy:i.row-t.row}}function scanSpans(t,i,o,r,e){var h=Math.max(o,Math.floor(i.y0)),s=Math.min(r,Math.ceil(i.y1));if(t.x0===i.x0&&t.y0===i.y0?t.x0+i.dy/t.dy*t.dx<i.x1:t.x1-i.dy/t.dy*t.dx<i.x0){var n=t;t=i,i=n}for(var a=t.dx/t.dy,d=i.dx/i.dy,y=t.dx>0,l=i.dx<0,x=h;x<s;x++){var u=a*Math.max(0,Math.min(t.dy,x+y-t.y0))+t.x0,c=d*Math.max(0,Math.min(i.dy,x+l-i.y0))+i.x0;e(Math.floor(c),Math.ceil(u),x)}}function scanTriangle(t,i,o,r,e,h){var s,n=edge(t,i),a=edge(i,o),d=edge(o,t);n.dy>a.dy&&(s=n,n=a,a=s),n.dy>d.dy&&(s=n,n=d,d=s),a.dy>d.dy&&(s=a,a=d,d=s),n.dy&&scanSpans(d,n,r,e,h),a.dy&&scanSpans(d,a,r,e,h)}function getQuadkey(t,i,o){for(var r,e="",h=t;h>0;h--)r=1<<h-1,e+=(i&r?1:0)+(o&r?2:0);return e}var WhooTS=require("@minemap/whoots-js"),Coordinate=require("../geo/coordinate"),TileCoord=function(t,i,o,r){isNaN(r)&&(r=0),this.z=+t,this.x=+i,this.y=+o,this.w=+r,(r*=2)<0&&(r=r*-1-1);var e=1<<this.z;this.id=32*(e*e*r+e*this.y+this.x)+this.z,this.posMatrix=null};TileCoord.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},TileCoord.prototype.toCoordinate=function(t){var i=Math.min(this.z,void 0===t?this.z:t),o=Math.pow(2,i),r=this.y,e=this.x+o*this.w;return new Coordinate(e,r,i)},TileCoord.prototype.url=function(t,i,o){var r=WhooTS.getTileBBox(this.x,this.y,this.z),e=getQuadkey(this.z,this.x,this.y),h=Math.min(this.z,i||this.z),s="tms"===o?Math.pow(2,this.z)-this.y-1:this.y;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",h).replace("{x}",this.x).replace("{y}",s).replace("{m}",Math.floor(this.x/16)).replace("{n}",Math.floor(s/16)).replace("{quadkey}",e).replace("{bbox-epsg-3857}",r)},TileCoord.prototype.toAccess=function(t,i){var o=(WhooTS.getTileBBox(this.x,this.y,this.z),getQuadkey(this.z,this.x,this.y),Math.min(this.z,t||this.z)),r="tms"===i?Math.pow(2,this.z)-this.y-1:this.y;return o+"_"+this.x+"_"+r},TileCoord.prototype.parent=function(t){return 0===this.z?null:this.z>t?new TileCoord(this.z-1,this.x,this.y,this.w):new TileCoord(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},TileCoord.prototype.wrapped=function(){return new TileCoord(this.z,this.x,this.y,0)},TileCoord.prototype.children=function(t){if(this.z>=t)return[new TileCoord(this.z+1,this.x,this.y,this.w)];var i=this.z+1,o=2*this.x,r=2*this.y;return[new TileCoord(i,o,r,this.w),new TileCoord(i,o+1,r,this.w),new TileCoord(i,o,r+1,this.w),new TileCoord(i,o+1,r+1,this.w)]},TileCoord.cover=function(t,i,o,r){function e(t,i,e){var n,a,d,y;if(e>=0&&e<=h)for(n=t;n<i;n++)a=Math.floor(n/h),d=(n%h+h)%h,0!==a&&r!==!0||(y=new TileCoord(o,d,e,a),s[y.id]=y)}void 0===r&&(r=!0);var h=1<<t,s={};return scanTriangle(i[0],i[1],i[2],0,h,e),scanTriangle(i[2],i[3],i[0],0,h,e),Object.keys(s).map(function(t){return s[t]})},TileCoord.fromID=function(t){var i=t%32,o=1<<i,r=(t-i)/32,e=r%o,h=(r-e)/o%o,s=Math.floor(r/(o*o));return s%2!=0&&(s=s*-1-1),s/=2,new TileCoord(i,e,h,s)},module.exports=TileCoord;
},{"../geo/coordinate":226,"@minemap/whoots-js":5}],267:[function(require,module,exports){
"use strict";var Evented=require("../util/evented"),util=require("../util/util"),loadTileJSON=require("./load_tilejson"),normalizeURL=require("../util/minemap").normalizeTileURL,VectorTileSource=function(e){function t(t,i,o,r){if(e.call(this),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,util.extend(this,util.pick(i,["url","scheme","tileSize"])),this._options=util.extend({type:"vector"},i),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire("dataloading",{dataType:"source"}),loadTileJSON(this._options,function(t,i){if(t)return void e.fire("error",t);util.extend(e,i),e.fire("data",{dataType:"source",sourceDataType:"metadata"}),e.fire("data",{dataType:"source",sourceDataType:"content"})})},t.prototype.onAdd=function(e){this.load(),this.map=e},t.prototype.serialize=function(){return util.extend({},this._options)},t.prototype.loadTile=function(e,t){function i(i,o){if(!e.aborted){if(i)return t(i);this.map._refreshExpiredTiles||e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(this)),t(null),e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)}}var o=e.coord.z>this.maxzoom?Math.pow(2,e.coord.z-this.maxzoom):1,r={url:normalizeURL(e.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:e.uid,coord:e.coord,zoom:e.coord.z,tileSize:this.tileSize*o,type:this.type,source:this.id,overscaling:o,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};e.workerID&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=t:this.dispatcher.send("reloadTile",r,i.bind(this),e.workerID):e.workerID=this.dispatcher.send("loadTile",r,i.bind(this))},t.prototype.abortTile=function(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID)},t.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID)},t}(Evented);module.exports=VectorTileSource;
},{"../util/evented":381,"../util/minemap":390,"../util/util":399,"./load_tilejson":258}],268:[function(require,module,exports){
"use strict";var ajax=require("../util/ajax"),vt=require("vector-tile"),Protobuf=require("pbf"),WorkerTile=require("./worker_tile"),util=require("../util/util"),VectorTileWorkerSource=function(e,r,t){this.actor=e,this.layerIndex=r,t&&(this.loadVectorData=t),this.loading={},this.loaded={}};VectorTileWorkerSource.prototype.loadTile=function(e,r){function t(e,t){return delete this.loading[o][i],e?r(e):t?(a.vectorTile=t,a.parse(t,this.layerIndex,this.actor,function(e,o,i){if(e)return r(e);var a={};t.expires&&(a.expires=t.expires),t.cacheControl&&(a.cacheControl=t.cacheControl),r(null,util.extend({rawTileData:t.rawData},o,a),i)}),this.loaded[o]=this.loaded[o]||{},void(this.loaded[o][i]=a)):r(null,null)}var o=e.source,i=e.uid;this.loading[o]||(this.loading[o]={});var a=this.loading[o][i]=new WorkerTile(e);a.abort=this.loadVectorData(e,t.bind(this))},VectorTileWorkerSource.prototype.reloadTile=function(e,r){function t(e,t){if(this.reloadCallback){var o=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,a.layerIndex,a.actor,o)}r(e,t)}var o=this.loaded[e.source],i=e.uid,a=this;if(o&&o[i]){var l=o[i];"parsing"===l.status?l.reloadCallback=r:"done"===l.status&&l.parse(l.vectorTile,this.layerIndex,this.actor,t.bind(l))}},VectorTileWorkerSource.prototype.abortTile=function(e){var r=this.loading[e.source],t=e.uid;r&&r[t]&&r[t].abort&&(r[t].abort(),delete r[t])},VectorTileWorkerSource.prototype.removeTile=function(e){var r=this.loaded[e.source],t=e.uid;r&&r[t]&&delete r[t]},VectorTileWorkerSource.prototype.loadVectorData=function(e,r){function t(e,t){if(e)return r(e);var o=new vt.VectorTile(new Protobuf(t.data));o.rawData=t.data,o.cacheControl=t.cacheControl,o.expires=t.expires,r(e,o)}var o=ajax.getArrayBuffer(e.url,t.bind(this));return function(){o.abort()}},VectorTileWorkerSource.prototype.redoPlacement=function(e,r){var t=this.loaded[e.source],o=this.loading[e.source],i=e.uid;if(t&&t[i]){var a=t[i],l=a.redoPlacement(e.angle,e.pitch,e.showCollisionBoxes);l.result&&r(null,l.result,l.transferables)}else o&&o[i]&&(o[i].angle=e.angle)},module.exports=VectorTileWorkerSource;
},{"../util/ajax":370,"../util/util":399,"./worker_tile":271,"pbf":153,"vector-tile":190}],269:[function(require,module,exports){
"use strict";var ajax=require("../util/ajax"),ImageSource=require("./image_source"),VideoSource=function(t){function e(e,o,i,r){t.call(this,e,o,i,r),this.roundZoom=!0,this.type="video",this.options=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,ajax.getVideo(e.urls,function(e,o){if(e)return t.fire("error",{error:e});t.video=o,t.video.loop=!0;var i;t.video.addEventListener("playing",function(){i=t.map.style.animationLoop.set(1/0),t.map._rerender()}),t.video.addEventListener("pause",function(){t.map.style.animationLoop.cancel(i)}),t.map&&t.video.play(),t._finishLoading()})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.load(),this.map=t,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e}(ImageSource);module.exports=VideoSource;
},{"../util/ajax":370,"./image_source":257}],270:[function(require,module,exports){
"use strict";var Actor=require("../util/actor"),StyleLayerIndex=require("../style/style_layer_index"),VectorTileWorkerSource=require("./vector_tile_worker_source"),GeoJSONWorkerSource=require("./geojson_worker_source"),globalRTLTextPlugin=require("./rtl_text_plugin"),Worker=function(e){var r=this;this.self=e,this.actor=new Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource},this.workerSources={},this.self.registerWorkerSource=function(e,o){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');r.workerSourceTypes[e]=o},this.self.registerRTLTextPlugin=function(e){if(globalRTLTextPlugin.applyArabicShaping||globalRTLTextPlugin.processBidirectionalText)throw new Error("RTL text plugin already registered.");globalRTLTextPlugin.applyArabicShaping=e.applyArabicShaping,globalRTLTextPlugin.processBidirectionalText=e.processBidirectionalText}};Worker.prototype.setLayers=function(e,r){this.getLayerIndex(e).replace(r)},Worker.prototype.updateLayers=function(e,r){this.getLayerIndex(e).update(r.layers,r.removedIds,r.symbolOrder)},Worker.prototype.loadTile=function(e,r,o){this.getWorkerSource(e,r.type).loadTile(r,o)},Worker.prototype.reloadTile=function(e,r,o){this.getWorkerSource(e,r.type).reloadTile(r,o)},Worker.prototype.abortTile=function(e,r){this.getWorkerSource(e,r.type).abortTile(r)},Worker.prototype.removeTile=function(e,r){this.getWorkerSource(e,r.type).removeTile(r)},Worker.prototype.removeSource=function(e,r){var o=this.getWorkerSource(e,r.type);void 0!==o.removeSource&&o.removeSource(r)},Worker.prototype.redoPlacement=function(e,r,o){this.getWorkerSource(e,r.type).redoPlacement(r,o)},Worker.prototype.loadWorkerSource=function(e,r,o){try{this.self.importScripts(r.url),o()}catch(e){o(e)}},Worker.prototype.loadRTLTextPlugin=function(e,r,o){try{globalRTLTextPlugin.applyArabicShaping||globalRTLTextPlugin.processBidirectionalText||this.self.importScripts(r)}catch(e){o(e)}},Worker.prototype.getLayerIndex=function(e){var r=this.layerIndexes[e];return r||(r=this.layerIndexes[e]=new StyleLayerIndex),r},Worker.prototype.getWorkerSource=function(e,r){var o=this;if(this.workerSources[e]||(this.workerSources[e]={}),!this.workerSources[e][r]){var t={send:function(r,t,i,n){o.actor.send(r,t,i,n,e)}};this.workerSources[e][r]=new this.workerSourceTypes[r](t,this.getLayerIndex(e))}return this.workerSources[e][r]},module.exports=function(e){return new Worker(e)};
},{"../style/style_layer_index":333,"../util/actor":369,"./geojson_worker_source":255,"./rtl_text_plugin":262,"./vector_tile_worker_source":268}],271:[function(require,module,exports){
"use strict";function recalculateLayers(e,i){for(var r=0,o=e.layers;r<o.length;r+=1){o[r].recalculate(i)}}function serializeBuckets(e,i){return e.filter(function(e){return!e.isEmpty()}).map(function(e){return e.serialize(i)})}var FeatureIndex=require("../data/feature_index"),CollisionTile=require("../symbol/collision_tile"),CollisionBoxArray=require("../symbol/collision_box"),DictionaryCoder=require("../util/dictionary_coder"),util=require("../util/util"),WorkerTile=function(e){this.coord=e.coord,this.uid=e.uid,this.zoom=e.zoom,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=e.overscaling,this.angle=e.angle,this.pitch=e.pitch,this.showCollisionBoxes=e.showCollisionBoxes};WorkerTile.prototype.parse=function(e,i,r,o){var t=this;e.layers||(e={layers:{_geojsonTileLayer:e}}),this.status="parsing",this.data=e,this.collisionBoxArray=new CollisionBoxArray;var s=new DictionaryCoder(Object.keys(e.layers).sort()),l=new FeatureIndex(this.coord,this.overscaling);l.bucketLayerIDs={};var n={},a=0,c={featureIndex:l,iconDependencies:{},glyphDependencies:{}},u=i.familiesBySource[this.source];for(var h in u){var y=e.layers[h];if(y){1===y.version&&util.warnOnce('Vector tile source "'+t.source+'" layer "'+h+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var d=s.encode(h),p=[],m=0;m<y.length;m++){var f=y.feature(m);f.index=m,f.sourceLayerIndex=d,p.push(f)}for(var v=0,g=u[h];v<g.length;v+=1){var x=g[v],B=x[0];if(!(B.minzoom&&t.zoom<B.minzoom)&&!(B.maxzoom&&t.zoom>=B.maxzoom||B.layout&&"none"===B.layout.visibility)){for(var b=0,k=x;b<k.length;b+=1){k[b].recalculate(t.zoom)}(n[B.id]=B.createBucket({index:a,layers:x,zoom:t.zoom,overscaling:t.overscaling,collisionBoxArray:t.collisionBoxArray})).populate(p,c),l.bucketLayerIDs[a]=x.map(function(e){return e.id}),a++}}}}var z=function(e){t.status="done",l.paintPropertyStatistics={};for(var i in n)util.extend(l.paintPropertyStatistics,n[i].getPaintPropertyStatistics());var r=[];o(null,{buckets:serializeBuckets(util.values(n),r),featureIndex:l.serialize(r),collisionTile:e.serialize(r),collisionBoxArray:t.collisionBoxArray.serialize()},r)};this.symbolBuckets=[];for(var C=i.symbolOrder.length-1;C>=0;C--){var T=n[i.symbolOrder[C]];T&&t.symbolBuckets.push(T)}if(0===this.symbolBuckets.length)return z(new CollisionTile(this.angle,this.pitch,this.collisionBoxArray));var w=0,A=Object.keys(c.iconDependencies),D=util.mapObject(c.glyphDependencies,function(e){return Object.keys(e).map(Number)}),I=function(e){if(e)return o(e);if(2===++w){for(var i=new CollisionTile(t.angle,t.pitch,t.collisionBoxArray),r=0,s=t.symbolBuckets;r<s.length;r+=1){var l=s[r];recalculateLayers(l,t.zoom),l.prepare(D,A),l.place(i,t.showCollisionBoxes)}z(i)}};Object.keys(D).length?r.send("getGlyphs",{uid:this.uid,stacks:D},function(e,i){D=i,I(e)}):I(),A.length?r.send("getIcons",{icons:A},function(e,i){A=i,I(e)}):I()},WorkerTile.prototype.redoPlacement=function(e,i,r){var o=this;if(this.angle=e,this.pitch=i,"done"!==this.status)return{};for(var t=new CollisionTile(this.angle,this.pitch,this.collisionBoxArray),s=0,l=o.symbolBuckets;s<l.length;s+=1){var n=l[s];recalculateLayers(n,o.zoom),n.place(t,r)}var a=[];return{result:{buckets:serializeBuckets(this.symbolBuckets,a),collisionTile:t.serialize(a)},transferables:a}},module.exports=WorkerTile;
},{"../data/feature_index":218,"../symbol/collision_box":339,"../symbol/collision_tile":341,"../util/dictionary_coder":377,"../util/util":399}],272:[function(require,module,exports){
"use strict";function deref(r,e){var f={};for(var t in r)"ref"!==t&&(f[t]=r[t]);return refProperties.forEach(function(r){r in e&&(f[r]=e[r])}),f}function derefLayers(r){r=r.slice();for(var e=Object.create(null),f=0;f<r.length;f++)e[r[f].id]=r[f];for(var t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=deref(r[t],e[r[t].ref]));return r}var refProperties=require("./util/ref_properties");module.exports=derefLayers;
},{"./util/ref_properties":294}],273:[function(require,module,exports){
"use strict";function diffSources(e,r,o,a){e=e||{},r=r||{};var s;for(s in e)e.hasOwnProperty(s)&&(r.hasOwnProperty(s)||(o.push({command:operations.removeSource,args:[s]}),a[s]=!0));for(s in r)r.hasOwnProperty(s)&&(e.hasOwnProperty(s)?isEqual(e[s],r[s])||(o.push({command:operations.removeSource,args:[s]}),o.push({command:operations.addSource,args:[s,r[s]]}),a[s]=!0):o.push({command:operations.addSource,args:[s,r[s]]}))}function diffLayerPropertyChanges(e,r,o,a,s,t){e=e||{},r=r||{};var n;for(n in e)e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:t,args:[a,n,r[n],s]}));for(n in r)r.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:t,args:[a,n,r[n],s]}))}function pluckId(e){return e.id}function indexById(e,r){return e[r.id]=r,e}function diffLayers(e,r,o){e=e||[],r=r||[];var a,s,t,n,i,p,m,u=e.map(pluckId),l=r.map(pluckId),y=e.reduce(indexById,{}),c=r.reduce(indexById,{}),d=u.slice(),h=Object.create(null);for(a=0,s=0;a<u.length;a++)t=u[a],c.hasOwnProperty(t)?s++:(o.push({command:operations.removeLayer,args:[t]}),d.splice(d.indexOf(t,s),1));for(a=0,s=0;a<l.length;a++)t=l[l.length-1-a],d[d.length-1-a]!==t&&(y.hasOwnProperty(t)?(o.push({command:operations.removeLayer,args:[t]}),d.splice(d.lastIndexOf(t,d.length-s),1)):s++,p=d[d.length-a],o.push({command:operations.addLayer,args:[c[t],p]}),d.splice(d.length-a,0,t),h[t]=!0);for(a=0;a<l.length;a++)if(t=l[a],n=y[t],i=c[t],!h[t]&&!isEqual(n,i))if(isEqual(n.source,i.source)&&isEqual(n["source-layer"],i["source-layer"])&&isEqual(n.type,i.type)){diffLayerPropertyChanges(n.layout,i.layout,o,t,null,operations.setLayoutProperty),diffLayerPropertyChanges(n.paint,i.paint,o,t,null,operations.setPaintProperty),isEqual(n.filter,i.filter)||o.push({command:operations.setFilter,args:[t,i.filter]}),isEqual(n.minzoom,i.minzoom)&&isEqual(n.maxzoom,i.maxzoom)||o.push({command:operations.setLayerZoomRange,args:[t,i.minzoom,i.maxzoom]});for(m in n)n.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?diffLayerPropertyChanges(n[m],i[m],o,t,m.slice(6),operations.setPaintProperty):isEqual(n[m],i[m])||o.push({command:operations.setLayerProperty,args:[t,m,i[m]]}));for(m in i)i.hasOwnProperty(m)&&!n.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?diffLayerPropertyChanges(n[m],i[m],o,t,m.slice(6),operations.setPaintProperty):isEqual(n[m],i[m])||o.push({command:operations.setLayerProperty,args:[t,m,i[m]]}))}else o.push({command:operations.removeLayer,args:[t]}),p=d[d.lastIndexOf(t)+1],o.push({command:operations.addLayer,args:[i,p]})}function diffStyles(e,r){if(!e)return[{command:operations.setStyle,args:[r]}];var o=[];try{if(!isEqual(e.version,r.version))return[{command:operations.setStyle,args:[r]}];isEqual(e.center,r.center)||o.push({command:operations.setCenter,args:[r.center]}),isEqual(e.zoom,r.zoom)||o.push({command:operations.setZoom,args:[r.zoom]}),isEqual(e.bearing,r.bearing)||o.push({command:operations.setBearing,args:[r.bearing]}),isEqual(e.pitch,r.pitch)||o.push({command:operations.setPitch,args:[r.pitch]}),isEqual(e.sprite,r.sprite)||o.push({command:operations.setSprite,args:[r.sprite]}),isEqual(e.glyphs,r.glyphs)||o.push({command:operations.setGlyphs,args:[r.glyphs]}),isEqual(e.transition,r.transition)||o.push({command:operations.setTransition,args:[r.transition]}),isEqual(e.light,r.light)||o.push({command:operations.setLight,args:[r.light]});var a={},s=[];diffSources(e.sources,r.sources,s,a);var t=[];e.layers&&e.layers.forEach(function(e){a[e.source]?o.push({command:operations.removeLayer,args:[e.id]}):t.push(e)}),o=o.concat(s),diffLayers(t,r.layers,o)}catch(e){console.warn("Unable to compute style diff:",e),o=[{command:operations.setStyle,args:[r]}]}return o}var isEqual=require("lodash.isequal"),operations={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};module.exports=diffStyles,module.exports.operations=operations;
},{"lodash.isequal":286}],274:[function(require,module,exports){
"use strict";function ValidationError(r,i){this.message=(r?r+": ":"")+format.apply(format,Array.prototype.slice.call(arguments,2)),null!==i&&void 0!==i&&i.__line__&&(this.line=i.__line__)}var format=require("util").format;module.exports=ValidationError;
},{"util":189}],275:[function(require,module,exports){
"use strict";function createFilter(e){return new Function("f","var p = (f && f.properties || {}); return "+compile(e))}function compile(e){if(!e)return"true";var i=e[0];return e.length<=1?"any"===i?"false":"true":"("+("=="===i?compileComparisonOp(e[1],e[2],"===",!1):"!="===i?compileComparisonOp(e[1],e[2],"!==",!1):"<"===i||">"===i||"<="===i||">="===i?compileComparisonOp(e[1],e[2],i,!0):"any"===i?compileLogicalOp(e.slice(1),"||"):"all"===i?compileLogicalOp(e.slice(1),"&&"):"none"===i?compileNegation(compileLogicalOp(e.slice(1),"||")):"in"===i?compileInOp(e[1],e.slice(2)):"!in"===i?compileNegation(compileInOp(e[1],e.slice(2))):"has"===i?compileHasOp(e[1]):"!has"===i?compileNegation(compileHasOp(e[1])):"arrin"===i?compileArrInOp(e[1],e.slice(2)):"!arrin"===i?compileNegation(compileArrInOp(e[1],e.slice(2))):"true")+")"}function compilePropertyReference(e){return"$type"===e?"f.type":"$id"===e?"f.id":"p["+JSON.stringify(e)+"]"}function compileComparisonOp(e,i,n,r){var o=compilePropertyReference(e),t="$type"===e?types.indexOf(i):JSON.stringify(i);return(r?"typeof "+o+"=== typeof "+t+"&&":"")+o+n+t}function compileLogicalOp(e,i){return e.map(compile).join(i)}function compileInOp(e,i){"$type"===e&&(i=i.map(function(e){return types.indexOf(e)}));var n=JSON.stringify(i.sort(compare)),r=compilePropertyReference(e);return i.length<=200?n+".indexOf("+r+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+r+", "+n+",0,"+(i.length-1)+")"}function compileArrInOp(e,i){"$type"===e&&(i=i.map(function(e){return types.indexOf(e)}));var n=JSON.stringify(i.sort(compare));return'function(v, a,i, j) {while (i <= j) { if (!v)return false;var m = v.split(","); if (m.indexOf(a[i]) > -1) return true; i = i + 1;}return false; }('+compilePropertyReference(e)+", "+n+",0,"+(i.length-1)+")"}function compileHasOp(e){return"$id"===e?'"id" in f':JSON.stringify(e)+" in p"}function compileNegation(e){return"!("+e+")"}function compare(e,i){return e<i?-1:e>i?1:0}module.exports=createFilter;var types=["Unknown","Point","LineString","Polygon"];
},{}],276:[function(require,module,exports){
"use strict";function xyz2lab(r){return r>t3?Math.pow(r,1/3):r/t2+t0}function lab2xyz(r){return r>t1?r*r*r:t2*(r-t0)}function xyz2rgb(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function rgb2xyz(r){return r/=255,r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function rgbToLab(r){var t=rgb2xyz(r[0]),a=rgb2xyz(r[1]),n=rgb2xyz(r[2]),b=xyz2lab((.4124564*t+.3575761*a+.1804375*n)/Xn),o=xyz2lab((.2126729*t+.7151522*a+.072175*n)/Yn);return[116*o-16,500*(b-o),200*(o-xyz2lab((.0193339*t+.119192*a+.9503041*n)/Zn)),r[3]]}function labToRgb(r){var t=(r[0]+16)/116,a=isNaN(r[1])?t:t+r[1]/500,n=isNaN(r[2])?t:t-r[2]/200;return t=Yn*lab2xyz(t),a=Xn*lab2xyz(a),n=Zn*lab2xyz(n),[xyz2rgb(3.2404542*a-1.5371385*t-.4985314*n),xyz2rgb(-.969266*a+1.8760108*t+.041556*n),xyz2rgb(.0556434*a-.2040259*t+1.0572252*n),r[3]]}function rgbToHcl(r){var t=rgbToLab(r),a=t[0],n=t[1],b=t[2],o=Math.atan2(b,n)*rad2deg;return[o<0?o+360:o,Math.sqrt(n*n+b*b),a,r[3]]}function hclToRgb(r){var t=r[0]*deg2rad,a=r[1];return labToRgb([r[2],Math.cos(t)*a,Math.sin(t)*a,r[3]])}var Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad=Math.PI/180,rad2deg=180/Math.PI;module.exports={lab:{forward:rgbToLab,reverse:labToRgb},hcl:{forward:rgbToHcl,reverse:hclToRgb}};
},{}],277:[function(require,module,exports){
"use strict";function identityFunction(t){return t}function createFunction(t,e){var o,n="color"===e.type;if(isFunctionDefinition(t)){var r=t.stops&&"object"==typeof t.stops[0][0],a=r||void 0!==t.property,i=r||!a,s=t.type||("interpolated"===e.function?"exponential":"interval");n&&(t=extend({},t),t.stops&&(t.stops=t.stops.map(function(t){return[t[0],parseColor(t[1])]})),t.default?t.default=parseColor(t.default):t.default=parseColor(e.default));var u,p,l;if("exponential"===s)u=evaluateExponentialFunction;else if("interval"===s)u=evaluateIntervalFunction;else if("categorical"===s){u=evaluateCategoricalFunction,p=Object.create(null);for(var c=0,f=t.stops;c<f.length;c+=1){var v=f[c];p[v[0]]=v[1]}l=typeof t.stops[0][0]}else{if("identity"!==s)throw new Error('Unknown function type "'+s+'"');u=evaluateIdentityFunction}var d;if(t.colorSpace&&"rgb"!==t.colorSpace){if(!colorSpaces[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);var y=colorSpaces[t.colorSpace];t=JSON.parse(JSON.stringify(t));for(var F=0;F<t.stops.length;F++)t.stops[F]=[t.stops[F][0],y.forward(t.stops[F][1])];d=y.reverse}else d=identityFunction;if(r){for(var h={},m=[],g=0;g<t.stops.length;g++){var b=t.stops[g];void 0===h[b[0].zoom]&&(h[b[0].zoom]={zoom:b[0].zoom,type:t.type,property:t.property,stops:[]}),h[b[0].zoom].stops.push([b[0].value,b[1]])}for(var C in h)m.push([h[C].zoom,createFunction(h[C],e)]);o=function(o,n){return d(evaluateExponentialFunction({stops:m,base:t.base},e,o)(o,n))},o.isFeatureConstant=!1,o.isZoomConstant=!1}else i?(o=function(o){return d(u(t,e,o,p,l))},o.isFeatureConstant=!0,o.isZoomConstant=!1):(o=function(o,n){var r=n[t.property];return void 0===r?coalesce(t.default,e.default):d(u(t,e,r,p,l))},o.isFeatureConstant=!1,o.isZoomConstant=!0)}else n&&t&&(t=parseColor(t)),o=function(){return t},o.isFeatureConstant=!0,o.isZoomConstant=!0;return o}function coalesce(t,e,o){return void 0!==t?t:void 0!==e?e:void 0!==o?o:void 0}function evaluateCategoricalFunction(t,e,o,n,r){return coalesce(typeof o===r?n[o]:void 0,t.default,e.default)}function evaluateIntervalFunction(t,e,o){if("number"!==getType(o))return coalesce(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(o<=t.stops[0][0])return t.stops[0][1];if(o>=t.stops[n-1][0])return t.stops[n-1][1];var r=binarySearchForIndex(t.stops,o);return t.stops[r][1]}function evaluateExponentialFunction(t,e,o){var n=void 0!==t.base?t.base:1;if("number"!==getType(o))return coalesce(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(o<=t.stops[0][0])return t.stops[0][1];if(o>=t.stops[r-1][0])return t.stops[r-1][1];var a=binarySearchForIndex(t.stops,o);return interpolate(o,n,t.stops[a][0],t.stops[a+1][0],t.stops[a][1],t.stops[a+1][1])}function evaluateIdentityFunction(t,e,o){return"color"===e.type?o=parseColor(o):getType(o)!==e.type&&(o=void 0),coalesce(o,t.default,e.default)}function binarySearchForIndex(t,e){for(var o,n,r=t.length,a=0,i=r-1,s=0;a<=i;){if(s=Math.floor((a+i)/2),o=t[s][0],n=t[s+1][0],e>=o&&e<n)return s;o<e?a=s+1:o>e&&(i=s-1)}return Math.max(s-1,0)}function interpolate(t,e,o,n,r,a){return"function"==typeof r?function(){var i=r.apply(void 0,arguments),s=a.apply(void 0,arguments);if(void 0!==i&&void 0!==s)return interpolate(t,e,o,n,i,s)}:r.length?interpolateArray(t,e,o,n,r,a):interpolateNumber(t,e,o,n,r,a)}function interpolateNumber(t,e,o,n,r,a){var i,s=n-o,u=t-o;return i=1===e?u/s:(Math.pow(e,u)-1)/(Math.pow(e,s)-1),r*(1-i)+a*i}function interpolateArray(t,e,o,n,r,a){for(var i=[],s=0;s<r.length;s++)i[s]=interpolateNumber(t,e,o,n,r[s],a[s]);return i}function isFunctionDefinition(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}var colorSpaces=require("./color_spaces"),parseColor=require("../util/parse_color"),extend=require("../util/extend"),getType=require("../util/get_type");module.exports=createFunction,module.exports.isFunctionDefinition=isFunctionDefinition;
},{"../util/extend":291,"../util/get_type":292,"../util/parse_color":293,"./color_spaces":276}],278:[function(require,module,exports){
"use strict";function key(r){return stringify(refProperties.map(function(e){return r[e]}))}function groupByLayout(r){for(var e={},t=0;t<r.length;t++){var i=key(r[t]),u=e[i];u||(u=e[i]=[]),u.push(r[t])}var n=[];for(var o in e)n.push(e[o]);return n}var refProperties=require("./util/ref_properties"),stringify=require("fast-stable-stringify");module.exports=groupByLayout;
},{"./util/ref_properties":294,"fast-stable-stringify":280}],279:[function(require,module,exports){
arguments[4][101][0].apply(exports,arguments)
},{"dup":101}],280:[function(require,module,exports){
function sss(r){var e,t,s,n,u,a;switch(typeof r){case"object":if(null===r)return null;if(isArray(r)){for(s="[",t=r.length-1,e=0;e<t;e++)s+=sss(r[e])+",";return t>-1&&(s+=sss(r[e])),s+"]"}for(n=objKeys(r).sort(),t=n.length,s="{",u=n[e=0],a=t>0&&void 0!==r[u];e<t;)a?(s+='"'+u.replace(strReg,strReplace)+'":'+sss(r[u]),u=n[++e],(a=e<t&&void 0!==r[u])&&(s+=",")):(u=n[++e],a=e<t&&void 0!==r[u]);return s+"}";case"undefined":return null;case"string":return'"'+r.replace(strReg,strReplace)+'"';default:return r}}var toString={}.toString,isArray=Array.isArray||function(r){return"[object Array]"===toString.call(r)},objKeys=Object.keys||function(r){var e=[];for(var t in r)r.hasOwnProperty(t)&&e.push(t);return e},strReg=/[\u0000-\u001f"\\]/g,strReplace=function(r){var e=r.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};module.exports=function(r){if(void 0!==r)return""+sss(r)},module.exports.stringSearch=strReg,module.exports.stringReplace=strReplace;
},{}],281:[function(require,module,exports){
function isObjectLike(r){return!!r&&"object"==typeof r}function arraySome(r,e){for(var a=-1,t=r.length;++a<t;)if(e(r[a],a,r))return!0;return!1}function baseIsEqual(r,e,a,t,o,n){return r===e||(null==r||null==e||!isObject(r)&&!isObjectLike(e)?r!==r&&e!==e:baseIsEqualDeep(r,e,baseIsEqual,a,t,o,n))}function baseIsEqualDeep(r,e,a,t,o,n,u){var c=isArray(r),s=isArray(e),i=arrayTag,g=arrayTag;c||(i=objToString.call(r),i==argsTag?i=objectTag:i!=objectTag&&(c=isTypedArray(r))),s||(g=objToString.call(e),g==argsTag?g=objectTag:g!=objectTag&&(s=isTypedArray(e)));var b=i==objectTag,l=g==objectTag,f=i==g;if(f&&!c&&!b)return equalByTag(r,e,i);if(!o){var y=b&&hasOwnProperty.call(r,"__wrapped__"),T=l&&hasOwnProperty.call(e,"__wrapped__");if(y||T)return a(y?r.value():r,T?e.value():e,t,o,n,u)}if(!f)return!1;n||(n=[]),u||(u=[]);for(var j=n.length;j--;)if(n[j]==r)return u[j]==e;n.push(r),u.push(e);var p=(c?equalArrays:equalObjects)(r,e,a,t,o,n,u);return n.pop(),u.pop(),p}function equalArrays(r,e,a,t,o,n,u){var c=-1,s=r.length,i=e.length;if(s!=i&&!(o&&i>s))return!1;for(;++c<s;){var g=r[c],b=e[c],l=t?t(o?b:g,o?g:b,c):void 0;if(void 0!==l){if(l)continue;return!1}if(o){if(!arraySome(e,function(r){return g===r||a(g,r,t,o,n,u)}))return!1}else if(g!==b&&!a(g,b,t,o,n,u))return!1}return!0}function equalByTag(r,e,a){switch(a){case boolTag:case dateTag:return+r==+e;case errorTag:return r.name==e.name&&r.message==e.message;case numberTag:return r!=+r?e!=+e:r==+e;case regexpTag:case stringTag:return r==e+""}return!1}function equalObjects(r,e,a,t,o,n,u){var c=keys(r),s=c.length;if(s!=keys(e).length&&!o)return!1;for(var i=s;i--;){var g=c[i];if(!(o?g in e:hasOwnProperty.call(e,g)))return!1}for(var b=o;++i<s;){g=c[i];var l=r[g],f=e[g],y=t?t(o?f:l,o?l:f,g):void 0;if(!(void 0===y?a(l,f,t,o,n,u):y))return!1;b||(b="constructor"==g)}if(!b){var T=r.constructor,j=e.constructor;if(T!=j&&"constructor"in r&&"constructor"in e&&!("function"==typeof T&&T instanceof T&&"function"==typeof j&&j instanceof j))return!1}return!0}function isObject(r){var e=typeof r;return!!r&&("object"==e||"function"==e)}var isArray=require("lodash.isarray"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys"),argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=baseIsEqual;
},{"lodash.isarray":285,"lodash.istypedarray":287,"lodash.keys":288}],282:[function(require,module,exports){
function bindCallback(n,t,r){if("function"!=typeof n)return identity;if(void 0===t)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,c){return n.call(t,r,e,u,c)};case 5:return function(r,e,u,c,i){return n.call(t,r,e,u,c,i)}}return function(){return n.apply(t,arguments)}}function identity(n){return n}module.exports=bindCallback;
},{}],283:[function(require,module,exports){
function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,o){var e=null==t?void 0:t[o];return isNative(e)?e:void 0}function isFunction(t){return isObject(t)&&objToString.call(t)==funcTag}function isObject(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function isNative(t){return null!=t&&(isFunction(t)?reIsNative.test(fnToString.call(t)):isObjectLike(t)&&reIsHostCtor.test(t))}var funcTag="[object Function]",reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=getNative;
},{}],284:[function(require,module,exports){
function isArguments(t){return isArrayLikeObject(t)&&hasOwnProperty.call(t,"callee")&&(!propertyIsEnumerable.call(t,"callee")||objectToString.call(t)==argsTag)}function isArrayLike(t){return null!=t&&isLength(t.length)&&!isFunction(t)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,propertyIsEnumerable=objectProto.propertyIsEnumerable;module.exports=isArguments;
},{}],285:[function(require,module,exports){
function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,r){var e=null==t?void 0:t[r];return isNative(e)?e:void 0}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER}function isFunction(t){return isObject(t)&&objToString.call(t)==funcTag}function isObject(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function isNative(t){return null!=t&&(isFunction(t)?reIsNative.test(fnToString.call(t)):isObjectLike(t)&&reIsHostCtor.test(t))}var arrayTag="[object Array]",funcTag="[object Function]",reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nativeIsArray=getNative(Array,"isArray"),MAX_SAFE_INTEGER=9007199254740991,isArray=nativeIsArray||function(t){return isObjectLike(t)&&isLength(t.length)&&objToString.call(t)==arrayTag};module.exports=isArray;
},{}],286:[function(require,module,exports){
function isEqual(a,l,i,e){i="function"==typeof i?bindCallback(i,e,3):void 0;var s=i?i(a,l):void 0;return void 0===s?baseIsEqual(a,l,i):!!s}var baseIsEqual=require("lodash._baseisequal"),bindCallback=require("lodash._bindcallback");module.exports=isEqual;
},{"lodash._baseisequal":281,"lodash._bindcallback":282}],287:[function(require,module,exports){
function isLength(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=MAX_SAFE_INTEGER}function isObjectLike(a){return!!a&&"object"==typeof a}function isTypedArray(a){return isObjectLike(a)&&isLength(a.length)&&!!typedArrayTags[objectToString.call(a)]}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var objectProto=Object.prototype,objectToString=objectProto.toString;module.exports=isTypedArray;
},{}],288:[function(require,module,exports){
function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function isArrayLike(e){return null!=e&&isLength(getLength(e))}function isIndex(e,t){return e="number"==typeof e||reIsUint.test(e)?+e:-1,t=null==t?MAX_SAFE_INTEGER:t,e>-1&&e%1==0&&e<t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function shimKeys(e){for(var t=keysIn(e),r=t.length,n=r&&e.length,s=!!n&&isLength(n)&&(isArray(e)||isArguments(e)),o=-1,i=[];++o<r;){var u=t[o];(s&&isIndex(u,n)||hasOwnProperty.call(e,u))&&i.push(u)}return i}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function keysIn(e){if(null==e)return[];isObject(e)||(e=Object(e));var t=e.length;t=t&&isLength(t)&&(isArray(e)||isArguments(e))&&t||0;for(var r=e.constructor,n=-1,s="function"==typeof r&&r.prototype===e,o=Array(t),i=t>0;++n<t;)o[n]=n+"";for(var u in e)i&&isIndex(u,t)||"constructor"==u&&(s||!hasOwnProperty.call(e,u))||o.push(u);return o}var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray"),reIsUint=/^\d+$/,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeKeys=getNative(Object,"keys"),MAX_SAFE_INTEGER=9007199254740991,getLength=baseProperty("length"),keys=nativeKeys?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&isArrayLike(e)?shimKeys(e):isObject(e)?nativeKeys(e):[]}:shimKeys;module.exports=keys;
},{"lodash._getnative":283,"lodash.isarguments":284,"lodash.isarray":285}],289:[function(require,module,exports){
"use strict";module.exports=require("./v8.json");
},{"./v8.json":290}],290:[function(require,module,exports){
module.exports={"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8],"doc":"Style specification version number. Must be 8.","example":8},"name":{"type":"string","doc":"A human-readable name for the style.","example":"Bright"},"metadata":{"type":"*","doc":"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},"center":{"type":"array","value":"number","doc":"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).","example":[-73.9749,40.7736]},"zoom":{"type":"number","doc":"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).","example":12.5},"bearing":{"type":"number","default":0,"period":360,"units":"degrees","doc":"Default bearing, in degrees clockwise from true north.  The style bearing will be used only if the map has not been positioned by other means (e.g. map options or user interaction).","example":29},"pitch":{"type":"number","default":0,"units":"degrees","doc":"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).","example":50},"light":{"type":"light","doc":"The global light source.","example":{"anchor":"viewport","color":"white","intensity":0.4}},"sources":{"required":true,"type":"sources","doc":"Data source specifications.","example":{"minemap-streets":{"type":"vector","url":"minemap://minemap.minemap-streets-v6"}}},"sprite":{"type":"string","doc":"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, or `icon-image` properties.","example":"minemap://sprites/minemap/bright-v8"},"glyphs":{"type":"string","doc":"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property.","example":"minemap://fonts/minemap/{fontstack}/{range}.pbf"},"transition":{"type":"transition","doc":"A global transition definition to use as a default across properties.","example":{"duration":300,"delay":0}},"layers":{"required":true,"type":"array","value":"layer","doc":"Layers will be drawn in the order of this array.","example":[{"id":"water","source":"minemap-streets","source-layer":"water","type":"fill","paint":{"fill-color":"#00ffff"}}]}},"sources":{"*":{"type":"source","doc":"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},"source":["source_tile","source_geojson","source_video","source_image"],"source_tile":{"type":{"required":true,"type":"enum","values":{"vector":{"doc":"A vector tile source."},"raster":{"doc":"A raster tile source."}},"doc":"The data type of the tile source."},"url":{"type":"string","doc":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `minemap://<mapid>`."},"tiles":{"type":"array","value":"string","doc":"An array of one or more tile source URLs, as in the TileJSON spec."},"minzoom":{"type":"number","default":0,"doc":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},"maxzoom":{"type":"number","default":22,"doc":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},"tileSize":{"type":"number","default":512,"units":"pixels","doc":"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},"*":{"type":"*","doc":"Other keys to configure the data source."}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{"doc":"A GeoJSON data source."}},"doc":"The data type of the GeoJSON source."},"data":{"type":"*","doc":"A URL to a GeoJSON file, or inline GeoJSON."},"maxzoom":{"type":"number","default":18,"doc":"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0,"doc":"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},"tolerance":{"type":"number","default":0.375,"doc":"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},"cluster":{"type":"boolean","default":false,"doc":"If the data is a collection of point features, setting this to true clusters the points by radius into groups."},"clusterRadius":{"type":"number","default":50,"minimum":0,"doc":"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},"clusterMaxZoom":{"type":"number","doc":"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{"doc":"A video data source."}},"doc":"The data type of the video source."},"urls":{"required":true,"type":"array","value":"string","doc":"URLs to video content in order of preferred format."},"coordinates":{"required":true,"doc":"Corners of video specified in longitude, latitude pairs.","type":"array","length":4,"value":{"type":"array","length":2,"value":"number","doc":"A single longitude, latitude pair."}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{"doc":"An image data source."}},"doc":"The data type of the image source."},"url":{"required":true,"type":"string","doc":"URL that points to an image."},"coordinates":{"required":true,"doc":"Corners of image specified in longitude, latitude pairs.","type":"array","length":4,"value":{"type":"array","length":2,"value":"number","doc":"A single longitude, latitude pair."}}},"layer":{"id":{"type":"string","doc":"Unique layer name.","required":true},"type":{"type":"enum","values":{"fill":{"doc":"A filled polygon with an optional stroked border."},"line":{"doc":"A stroked line."},"symbol":{"doc":"An icon or a text label."},"symtracking":{"doc":"An icon or a text label."},"circle":{"doc":"A filled circle."},"raster":{"doc":"Raster map textures such as satellite imagery."},"background":{"doc":"The background color or pattern of the map."},"sprite":{"doc":"sprite"},"extrusion":{"doc":"extrusion"},"collada":{"doc":"collada"},"histogram":{"doc":"histogram"},"tracking":{"doc":"tracking"},"airline":{"doc":"airline"},"dynamicLine":{"doc":"tracking"}},"doc":"Rendering type of this layer."},"metadata":{"type":"*","doc":"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},"ref":{"type":"string","doc":"References another layer to copy `type`, `source`, `source-layer`, `minzoom`, `maxzoom`, `filter`, and `layout` properties from. This allows the layers to share processing and be more efficient."},"source":{"type":"string","doc":"Name of a source description to be used for this layer."},"source-layer":{"type":"string","doc":"Layer to use from a vector tile source. Required if the source supports multiple layers."},"minzoom":{"type":"number","minimum":0,"maximum":22,"doc":"The minimum zoom level on which the layer gets parsed and appears on."},"maxzoom":{"type":"number","minimum":0,"maximum":22,"doc":"The maximum zoom level on which the layer gets parsed and appears on."},"filter":{"type":"filter","doc":"A expression specifying conditions on source features. Only features that match the filter are displayed."},"layout":{"type":"layout","doc":"Layout properties for the layer."},"paint":{"type":"paint","doc":"Default paint properties for this layer."},"paint.*":{"type":"paint","doc":"Class-specific paint properties for this layer. The class name is the part after the first dot."}},"layout":["layout_fill","layout_airline","layout_line","layout_circle","layout_symbol","layout_symtracking","layout_raster","layout_background","layout_extrusion","layout_collada","layout_histogram","layout_sprite","layout_tracking","layout_dynamicLine"],"layout_dynamicLine":{"dynamicLine-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["butt","round","square"],"default":"butt","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["bevel","round","miter"],"default":"miter","doc":"The display of sprite when joining.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"tracking-join":"miter"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"tracking-join":"round"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_extrusion":{"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_collada":{"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_histogram":{"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."},"histogram-color-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"histogram-max-height-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"layout_sprite":{"sprite-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["butt","round","square"],"default":"butt","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["bevel","round","miter"],"default":"miter","doc":"The display of sprite when joining.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"sprite-join":"miter"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"sprite-join":"round"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_tracking":{"tracking-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["butt","round","square"],"default":"butt","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["bevel","round","miter"],"default":"miter","doc":"The display of sprite when joining.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"tracking-join":"miter"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"tracking-join":"round"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_airline":{"airline-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["butt","round","square"],"default":"butt","doc":"The display of sprite endings.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["bevel","round","miter"],"default":"miter","doc":"The display of sprite when joining.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"tracking-join":"miter"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"property-function":true,"doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"tracking-join":"round"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_background":{"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_fill":{"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_circle":{"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_line":{"line-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{"doc":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},"round":{"doc":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},"square":{"doc":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},"default":"butt","doc":"The display of line endings.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"bevel":{"doc":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},"round":{"doc":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},"miter":{"doc":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},"default":"miter","doc":"The display of lines when joining.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"line-join":"miter"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"line-join":"round"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_symbol":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{"doc":"The label is placed at the point where the geometry is located."},"line":{"doc":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."}},"default":"point","doc":"Label placement relative to its geometry.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","doc":"Distance between two symbol anchors.","requires":[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the icon will be visible even if it collides with other previously drawn symbols.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, other symbols can be visible even if they collide with the icon.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.","requires":["icon-image","text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line`, aligns icon x-axes with the line."},"viewport":{"doc":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},"auto":{"doc":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},"default":"auto","doc":"In combination with `symbol-placement`, determines the rotation behavior of icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"doc":"Scale factor for icon. 1 is original size, 3 triples the size.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{"doc":"The icon is displayed at its intrinsic aspect ratio."},"width":{"doc":"The icon is scaled in the x-dimension to fit the width of the text."},"height":{"doc":"The icon is scaled in the y-dimension to fit the height of the text."},"both":{"doc":"The icon is scaled in both x- and y-dimensions."}},"default":"none","doc":"Scales the icon to fit around the associated text.","requires":["icon-image","text-field"],"sdk-support":{"basic functionality":{"js":"0.21.0"}}},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{"js":"0.21.0"}}},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"doc":"A string with {tokens} replaced, referencing the data property to pull from.","tokens":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","doc":"Rotates the icon clockwise.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.21.0"}}},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","doc":"Size of the additional area around the icon bounding box used for detecting symbol collisions.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the icon may be flipped to prevent it from being rendered upside-down.","requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"doc":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The text is aligned to the plane of the map."},"viewport":{"doc":"The text is aligned to the plane of the viewport."},"auto":{"doc":"Automatically matches the value of `text-rotation-alignment`."}},"default":"auto","doc":"Orientation of text when map is pitched.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.21.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line`, aligns text x-axes with the line."},"viewport":{"doc":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},"auto":{"doc":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},"default":"auto","doc":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"default":"","tokens":true,"doc":"Value to use for a text label. Feature properties are specified using tokens like {field_name}.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"doc":"Font stack to use for displaying text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Font size.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"doc":"The maximum line width for text wrapping.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"doc":"Text leading value for multi-line text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"doc":"Text tracking amount.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"left":{"doc":"The text is aligned to the left."},"center":{"doc":"The text is centered."},"right":{"doc":"The text is aligned to the right."}},"default":"center","doc":"Text justification options.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"center":{"doc":"The center of the text is placed closest to the anchor."},"left":{"doc":"The left side of the text is placed closest to the anchor."},"right":{"doc":"The right side of the text is placed closest to the anchor."},"top":{"doc":"The top of the text is placed closest to the anchor."},"bottom":{"doc":"The bottom of the text is placed closest to the anchor."},"top-left":{"doc":"The top left corner of the text is placed closest to the anchor."},"top-right":{"doc":"The top right corner of the text is placed closest to the anchor."},"bottom-left":{"doc":"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{"doc":"The bottom right corner of the text is placed closest to the anchor."}},"default":"center","doc":"Part of the text placed closest to the anchor.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"doc":"Maximum angle change between adjacent characters.","requires":["text-field",{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"doc":"Rotates the text clockwise.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Size of the additional area around the text bounding box used for detecting symbol collisions.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"doc":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.","requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{"doc":"The text is not altered."},"uppercase":{"doc":"Forces all letters to be displayed in uppercase."},"lowercase":{"doc":"Forces all letters to be displayed in lowercase."}},"default":"none","doc":"Specifies how to capitalize text, similar to the CSS `text-transform` property.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-offset":{"type":"array","doc":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.","value":"number","units":"ems","function":"interpolated","zoom-function":true,"length":2,"default":[0,0],"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the text will be visible even if it collides with other previously drawn symbols.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, other symbols can be visible even if they collide with the text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.","requires":["text-field","icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_symtracking":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{"doc":"The label is placed at the point where the geometry is located."},"line":{"doc":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."}},"default":"point","doc":"Label placement relative to its geometry.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","doc":"Distance between two symbol anchors.","requires":[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the icon will be visible even if it collides with other previously drawn symbols.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, other symbols can be visible even if they collide with the icon.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.","requires":["icon-image","text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line`, aligns icon x-axes with the line."},"viewport":{"doc":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},"auto":{"doc":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},"default":"auto","doc":"In combination with `symbol-placement`, determines the rotation behavior of icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"doc":"Scale factor for icon. 1 is original size, 3 triples the size.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{"doc":"The icon is displayed at its intrinsic aspect ratio."},"width":{"doc":"The icon is scaled in the x-dimension to fit the width of the text."},"height":{"doc":"The icon is scaled in the y-dimension to fit the height of the text."},"both":{"doc":"The icon is scaled in both x- and y-dimensions."}},"default":"none","doc":"Scales the icon to fit around the associated text.","requires":["icon-image","text-field"],"sdk-support":{"basic functionality":{"js":"0.21.0"}}},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{"js":"0.21.0"}}},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"doc":"A string with {tokens} replaced, referencing the data property to pull from.","tokens":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","doc":"Rotates the icon clockwise.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.21.0"}}},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","doc":"Size of the additional area around the icon bounding box used for detecting symbol collisions.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the icon may be flipped to prevent it from being rendered upside-down.","requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"doc":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The text is aligned to the plane of the map."},"viewport":{"doc":"The text is aligned to the plane of the viewport."},"auto":{"doc":"Automatically matches the value of `text-rotation-alignment`."}},"default":"auto","doc":"Orientation of text when map is pitched.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.21.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line`, aligns text x-axes with the line."},"viewport":{"doc":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},"auto":{"doc":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},"default":"auto","doc":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"`auto` value":{"js":"0.25.0"}}},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"default":"","tokens":true,"doc":"Value to use for a text label. Feature properties are specified using tokens like {field_name}.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"doc":"Font stack to use for displaying text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Font size.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"doc":"The maximum line width for text wrapping.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"doc":"Text leading value for multi-line text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"doc":"Text tracking amount.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"left":{"doc":"The text is aligned to the left."},"center":{"doc":"The text is centered."},"right":{"doc":"The text is aligned to the right."}},"default":"center","doc":"Text justification options.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"center":{"doc":"The center of the text is placed closest to the anchor."},"left":{"doc":"The left side of the text is placed closest to the anchor."},"right":{"doc":"The right side of the text is placed closest to the anchor."},"top":{"doc":"The top of the text is placed closest to the anchor."},"bottom":{"doc":"The bottom of the text is placed closest to the anchor."},"top-left":{"doc":"The top left corner of the text is placed closest to the anchor."},"top-right":{"doc":"The top right corner of the text is placed closest to the anchor."},"bottom-left":{"doc":"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{"doc":"The bottom right corner of the text is placed closest to the anchor."}},"default":"center","doc":"Part of the text placed closest to the anchor.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"doc":"Maximum angle change between adjacent characters.","requires":["text-field",{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"doc":"Rotates the text clockwise.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"doc":"Size of the additional area around the text bounding box used for detecting symbol collisions.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"doc":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.","requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{"doc":"The text is not altered."},"uppercase":{"doc":"Forces all letters to be displayed in uppercase."},"lowercase":{"doc":"Forces all letters to be displayed in lowercase."}},"default":"none","doc":"Specifies how to capitalize text, similar to the CSS `text-transform` property.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-offset":{"type":"array","doc":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.","value":"number","units":"ems","function":"interpolated","zoom-function":true,"length":2,"default":[0,0],"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, the text will be visible even if it collides with other previously drawn symbols.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, other symbols can be visible even if they collide with the text.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"doc":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.","requires":["text-field","icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symtracking-time-segment":{"type":"number","default":20,"minimum":1,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symtracking-fps":{"type":"number","default":1,"minimum":1,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{"doc":"The layer is shown."},"none":{"doc":"The layer is not shown."}},"default":"visible","doc":"Whether this layer is displayed.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"filter":{"type":"array","value":"*","doc":"A filter selects specific features from a layer."},"filter_operator":{"type":"enum","values":{"==":{"doc":"`[\"==\", key, value]` equality: `feature[key] = value`"},"!=":{"doc":"`[\"!=\", key, value]` inequality: `feature[key]  value`"},">":{"doc":"`[\">\", key, value]` greater than: `feature[key] > value`"},">=":{"doc":"`[\">=\", key, value]` greater than or equal: `feature[key]  value`"},"<":{"doc":"`[\"<\", key, value]` less than: `feature[key] < value`"},"<=":{"doc":"`[\"<=\", key, value]` less than or equal: `feature[key]  value`"},"in":{"doc":"`[\"in\", key, v0, ..., vn]` set inclusion: `feature[key]  {v0, ..., vn}`"},"!in":{"doc":"`[\"!in\", key, v0, ..., vn]` set exclusion: `feature[key]  {v0, ..., vn}`"},"arrin":{"doc":"`[\"arrin\", key, v0, ..., vn]` set group inclusion: `feature[key]  {v0, ..., vn}`"},"!arrin":{"doc":"`[\"!arrin\", key, v0, ..., vn]` set group exclusion: `feature[key]  {v0, ..., vn}`"},"all":{"doc":"`[\"all\", f0, ..., fn]` logical `AND`: `f0  ...  fn`"},"any":{"doc":"`[\"any\", f0, ..., fn]` logical `OR`: `f0  ...  fn`"},"none":{"doc":"`[\"none\", f0, ..., fn]` logical `NOR`: `f0  ...  fn`"},"has":{"doc":"`[\"has\", key]` `feature[key]` exists"},"!has":{"doc":"`[\"!has\", key]` `feature[key]` does not exist"}},"doc":"The filter operator."},"geometry_type":{"type":"enum","values":{"Point":{"doc":"Filter to point geometries."},"LineString":{"doc":"Filter to line geometries."},"Polygon":{"doc":"Filter to polygon geometries."}},"doc":"The geometry type for the filter to select."},"function":{"stops":{"type":"array","doc":"An array of stops.","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0,"doc":"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},"property":{"type":"string","doc":"The name of a global property or feature property to use as the function input.","default":"$zoom"},"type":{"type":"enum","values":{"identity":{"doc":"Return the input value as the output value."},"exponential":{"doc":"Generate an output by interpolating between stops just less than and just greater than the function input."},"interval":{"doc":"Return the output value of the stop just less than the function input."},"categorical":{"doc":"Return the output value of the stop equal to the function input."}},"doc":"The interpolation strategy to use in function evaluation.","default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{"doc":"Use the RGB color space to interpolate color values"},"lab":{"doc":"Use the LAB color space to interpolate color values."},"hcl":{"doc":"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},"doc":"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.","default":"rgb"}},"function_stop":{"type":"array","minimum":0,"maximum":22,"value":["number","color"],"length":2,"doc":"Zoom level and value pair."},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{"doc":"The position of the light source is aligned to the rotation of the map."},"viewport":{"doc":"The position of the light source is aligned to the rotation of the viewport."}},"transition":false,"doc":"Whether extruded geometries are lit relative to the map or viewport.","example":"map","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"function":"interpolated","zoom-function":true,"property-function":false,"doc":"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0 (0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0, directly above, to 180, directly below).","example":[1.5,90,80],"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"color":{"type":"color","default":"#ffffff","function":"interpolated","zoom-function":true,"property-function":false,"transition":true,"doc":"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true,"doc":"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{"js":"0.27.0"}}}},"paint":["paint_fill","paint_line","paint_circle","paint_symbol","paint_symtracking","paint_raster","paint_background","paint_extrusion","paint_collada","paint_histogram","paint_sprite","paint_tracking","paint_dynamicLine"],"paint_dynamicLine":{"dynamicLine-opacity":{"type":"number","doc":"The opacity at which the sprite will be drawn.","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-color":{"type":"color","doc":"The color with which the sprite will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"tracking-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-seg-count":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"dynamicLine-seg-group":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"dynamicLine-speed":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"dynamicLine-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["tracking-translate"],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a sprite casing outside of a sprite's actual path. Value indicates the width of the inner gap.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-offset":{"type":"number","default":0,"doc":"The sprite's offset. For linear features, a positive value offsets the sprite to the right, relative to the direction of the sprite, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.12.1","ios":"3.1.0","android":"3.0.0"}}},"dynamicLine-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Blur applied to the sprite, in pixels.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"property-function":true,"doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"tracking widths","requires":[{"!":"tracking-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"dynamicLine-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image sprite. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_extrusion":{"extrusion-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"doc":"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"extrusion-color":{"type":"color","default":"#000000","doc":"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"extrusion-pattern"}],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"extrusion-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The fill extrusion is translated relative to the map."},"viewport":{"doc":"The fill extrusion is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["extrusion-translate"],"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"extrusion-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"extrusion-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude this layer.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"extrusion-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.","transition":true,"requires":["fill-extrusion-height"],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}}},"paint_collada":{"collada-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"doc":"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"collada-color":{"type":"color","default":"#000000","doc":"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"collada-pattern"}],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"collada-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"collada-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The fill extrusion is translated relative to the map."},"viewport":{"doc":"The fill extrusion is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["extrusion-translate"],"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"collada-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"collada-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude this layer.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"collada-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.","transition":true,"requires":["collada-height"],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}}},"paint_histogram":{"histogram-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"doc":"The opacity of the entire fill histogram layer. This is rendered on a per-layer, not per-feature, basis.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"histogram-color":{"type":"color","default":"#000000","doc":"The base color of the extruded fill. The histogram's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-histogram-pattern"}],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"histogram-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"histogram-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The fill histogram is translated relative to the map."},"viewport":{"doc":"The fill histogram is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["fill-histogram-translate"],"sdk-support":{"basic functionality":{"js":"0.27.0"}}},"histogram-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.27.0"}}},"histogram-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude this layer.","transition":true,"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"histogram-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","doc":"The height with which to extrude the base of this layer. Must be less than or equal to `fill-histogram-height`.","transition":true,"requires":["fill-histogram-height"],"sdk-support":{"basic functionality":{"js":"0.27.0"},"data-driven styling":{"js":"0.27.0"}}},"histogram-colors":{"type":"array","value":"string","length":5,"default":["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],"function":"interpolated","zoom-function":true,"transition":true},"histogram-max-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":200,"minimum":0,"units":"meters","transition":true}},"paint_sprite":{"sprite-opacity":{"type":"number","doc":"The opacity at which the sprite will be drawn.","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-color":{"type":"color","doc":"The color with which the sprite will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"sprite-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["sprite-translate"],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a sprite casing outside of a sprite's actual path. Value indicates the width of the inner gap.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-offset":{"type":"number","default":0,"doc":"The sprite's offset. For linear features, a positive value offsets the sprite to the right, relative to the direction of the sprite, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.12.1","ios":"3.1.0","android":"3.0.0"}}},"sprite-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Blur applied to the sprite, in pixels.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"property-function":true,"doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"sprite widths","requires":[{"!":"sprite-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"sprite-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image sprite. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_tracking":{"tracking-opacity":{"type":"number","doc":"The opacity at which the sprite will be drawn.","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-delay":{"type":"number","zoom-function":true,"property-function":true,"default":20,"minimum":0,"maximum":120,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-color":{"type":"color","doc":"The color with which the sprite will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"tracking-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["real-time","history"],"doc":"tracking ","default":"real-time"},"tracking-seg-count":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"tracking-seg-group":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"tracking-speed":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"tracking-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["tracking-translate"],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a sprite casing outside of a sprite's actual path. Value indicates the width of the inner gap.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-offset":{"type":"number","default":0,"doc":"The sprite's offset. For linear features, a positive value offsets the sprite to the right, relative to the direction of the sprite, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.12.1","ios":"3.1.0","android":"3.0.0"}}},"tracking-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Blur applied to the sprite, in pixels.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"property-function":true,"doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"tracking widths","requires":[{"!":"tracking-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"tracking-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image sprite. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_airline":{"airline-opacity":{"type":"number","doc":"The opacity at which the sprite will be drawn.","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-color":{"type":"color","doc":"The color with which the sprite will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"airline-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["real-time","history","none"],"doc":"airline ","default":"history"},"airline-seg-count":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"airline-seg-group":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"airline-speed":{"type":"number","doc":"history ","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"airline-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["airline-translate"],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a sprite casing outside of a sprite's actual path. Value indicates the width of the inner gap.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-offset":{"type":"number","default":0,"doc":"The sprite's offset. For linear features, a positive value offsets the sprite to the right, relative to the direction of the sprite, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic":{"js":"0.12.1","ios":"3.1.0","android":"3.0.0"}}},"airline-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Blur applied to the sprite, in pixels.","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"property-function":true,"doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"airline widths","requires":[{"!":"airline-pattern"}],"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"airline-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image sprite. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_fill":{"fill-antialias":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"doc":"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"fill-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"doc":"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.","transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.21.0"}}},"fill-color":{"type":"color","default":"#000000","doc":"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.19.0"}}},"fill-outline-color":{"type":"color","doc":"The outline color of the fill. Matches the value of `fill-color` if unspecified.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.19.0"}}},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"fill-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The fill is translated relative to the map."},"viewport":{"doc":"The fill is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["fill-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"fill-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"fill-water":{"type":"enum","values":{"water":{"doc":""},"none":{"doc":""}},"default":"none","doc":"Whether this layer drawn with water effect.","sdk-support":{"basic functionality":{"js":"0.1.2","ios":"2.0.0","android":"2.0.1"}}}},"paint_line":{"line-opacity":{"type":"number","doc":"The opacity at which the line will be drawn.","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-color":{"type":"color","doc":"The color with which the line will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.23.0"}}},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The line is translated relative to the map."},"viewport":{"doc":"The line is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["line-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Stroke thickness.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-offset":{"type":"number","default":0,"doc":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","sdk-support":{"basic functionality":{"js":"0.12.1","ios":"3.1.0","android":"3.0.0"}}},"line-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"line-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"Circle radius.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.18.0"}}},"circle-color":{"type":"color","default":"#000000","doc":"The fill color of the circle.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.18.0"}}},"circle-blur":{"type":"number","default":0,"doc":"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.20.0"}}},"circle-opacity":{"type":"number","doc":"The opacity at which the circle will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"},"data-driven styling":{"js":"0.20.0"}}},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"circle-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The circle is translated relative to the map."},"viewport":{"doc":"The circle is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["circle-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"circle-pitch-scale":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"Circles are scaled according to their apparent distance to the camera."},"viewport":{"doc":"Circles are not scaled."}},"default":"map","doc":"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{"js":"0.21.0"}}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","doc":"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{"js":"master"},"data-driven styling":{"js":"master"}}},"circle-stroke-color":{"type":"color","default":"#000000","doc":"The stroke color of the circle.","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"master"},"data-driven styling":{"js":"master"}}},"circle-stroke-opacity":{"type":"number","doc":"The opacity of the circle's stroke.","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"master"},"data-driven styling":{"js":"master"}}}},"paint_symbol":{"icon-opacity":{"doc":"The opacity at which the icon will be drawn.","type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-color":{"type":"color","default":"#000000","function":"interpolated","property-function":true,"zoom-function":true,"transition":true,"doc":"The color of the icon. This can only be used with sdf icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"transition":true,"doc":"The color of the icon's halo. Icon halos can only be used with SDF icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance of halo to the icon outline.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Fade out the halo towards the outside.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"Icons are translated relative to the map."},"viewport":{"doc":"Icons are translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["icon-image","icon-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-opacity":{"type":"number","doc":"The opacity at which the text will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-color":{"type":"color","doc":"The color with which the text will be drawn.","default":"#000000","function":"interpolated","property-function":true,"zoom-function":true,"transition":true,"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"transition":true,"doc":"The color of the text's halo, which helps it stand out from backgrounds.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The halo's fadeout distance towards the outside.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The text is translated relative to the map."},"viewport":{"doc":"The text is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["text-field","text-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_symtracking":{"icon-opacity":{"doc":"The opacity at which the icon will be drawn.","type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"symtracking-delay":{"type":"number","zoom-function":true,"property-function":true,"default":10,"minimum":0,"maximum":120,"transition":true,"sdk-support":{"basic":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"transition":true,"doc":"The color of the icon. This can only be used with sdf icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"transition":true,"doc":"The color of the icon's halo. Icon halos can only be used with SDF icons.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance of halo to the icon outline.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Fade out the halo towards the outside.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.","requires":["icon-image"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"Icons are translated relative to the map."},"viewport":{"doc":"Icons are translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["icon-image","icon-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-opacity":{"type":"number","doc":"The opacity at which the text will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-color":{"type":"color","doc":"The color with which the text will be drawn.","default":"#000000","function":"interpolated","zoom-function":true,"transition":true,"requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"transition":true,"doc":"The color of the text's halo, which helps it stand out from backgrounds.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"The halo's fadeout distance towards the outside.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","doc":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.","requires":["text-field"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{"doc":"The text is translated relative to the map."},"viewport":{"doc":"The text is translated relative to the viewport."}},"doc":"Controls the translation reference point.","default":"map","requires":["text-field","text-translate"],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_raster":{"raster-opacity":{"type":"number","doc":"The opacity at which the image will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"transition":true,"units":"degrees","doc":"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-brightness-min":{"type":"number","function":"interpolated","zoom-function":true,"doc":"Increase or reduce the brightness of the image. The value is the minimum brightness.","default":0,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-brightness-max":{"type":"number","function":"interpolated","zoom-function":true,"doc":"Increase or reduce the brightness of the image. The value is the maximum brightness.","default":1,"minimum":0,"maximum":1,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-saturation":{"type":"number","doc":"Increase or reduce the saturation of the image.","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-contrast":{"type":"number","doc":"Increase or reduce the contrast of the image.","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"milliseconds","doc":"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"paint_background":{"background-color":{"type":"color","default":"#000000","doc":"The color with which the background will be drawn.","function":"interpolated","zoom-function":true,"transition":true,"requires":[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"background-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true,"doc":"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"doc":"The opacity at which the background will be drawn.","function":"interpolated","zoom-function":true,"transition":true,"sdk-support":{"basic functionality":{"js":"0.10.0","ios":"2.0.0","android":"2.0.1"}}}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds","doc":"Time allotted for transitions to complete."},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds","doc":"Length of time before a transition begins."}}}
},{}],291:[function(require,module,exports){
"use strict";module.exports=function(r){for(var t=arguments,e=1;e<arguments.length;e++){var n=t[e];for(var o in n)r[o]=n[o]}return r};
},{}],292:[function(require,module,exports){
"use strict";module.exports=function(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n};
},{}],293:[function(require,module,exports){
"use strict";var parseColorString=require("csscolorparser").parseCSSColor;module.exports=function(r){if("string"==typeof r){var e=parseColorString(r);if(!e)return;return[e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]]}return Array.isArray(r)?r:void 0};
},{"csscolorparser":279}],294:[function(require,module,exports){
"use strict";module.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"];
},{}],295:[function(require,module,exports){
"use strict";module.exports=function(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n};
},{}],296:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type"),extend=require("../util/extend");module.exports=function(e){var r=require("./validate_function"),t=require("./validate_object"),i={"*":function(){return[]},array:require("./validate_array"),boolean:require("./validate_boolean"),number:require("./validate_number"),color:require("./validate_color"),constants:require("./validate_constants"),enum:require("./validate_enum"),filter:require("./validate_filter"),function:require("./validate_function"),layer:require("./validate_layer"),object:require("./validate_object"),source:require("./validate_source"),light:require("./validate_light"),string:require("./validate_string")},a=e.value,n=e.valueSpec,u=e.key,o=e.styleSpec,l=e.style;if("string"===getType(a)&&"@"===a[0]){if(o.$version>7)return[new ValidationError(u,a,"constants have been deprecated as of v8")];if(!(a in l.constants))return[new ValidationError(u,a,'constant "%s" not found',a)];e=extend({},e,{value:l.constants[a]})}return n.function&&"object"===getType(a)?r(e):n.type&&i[n.type]?i[n.type](e):t(extend({},e,{valueSpec:n.type?o[n.type]:n}))};
},{"../error/validation_error":274,"../util/extend":291,"../util/get_type":292,"./validate_array":297,"./validate_boolean":298,"./validate_color":299,"./validate_constants":300,"./validate_enum":301,"./validate_filter":302,"./validate_function":303,"./validate_layer":305,"./validate_light":307,"./validate_number":308,"./validate_object":309,"./validate_source":312,"./validate_string":313}],297:[function(require,module,exports){
"use strict";var getType=require("../util/get_type"),validate=require("./validate"),ValidationError=require("../error/validation_error");module.exports=function(e){var r=e.value,t=e.valueSpec,a=e.style,n=e.styleSpec,l=e.key,i=e.arrayElementValidator||validate;if("array"!==getType(r))return[new ValidationError(l,r,"array expected, %s found",getType(r))];if(t.length&&r.length!==t.length)return[new ValidationError(l,r,"array length %d expected, length %d found",t.length,r.length)];if(t["min-length"]&&r.length<t["min-length"])return[new ValidationError(l,r,"array length at least %d expected, length %d found",t["min-length"],r.length)];var o={type:t.value};n.$version<7&&(o.function=t.function),"object"===getType(t.value)&&(o=t.value);for(var u=[],d=0;d<r.length;d++)u=u.concat(i({array:r,arrayIndex:d,value:r[d],valueSpec:o,style:a,styleSpec:n,key:l+"["+d+"]"}));return u};
},{"../error/validation_error":274,"../util/get_type":292,"./validate":296}],298:[function(require,module,exports){
"use strict";var getType=require("../util/get_type"),ValidationError=require("../error/validation_error");module.exports=function(e){var r=e.value,o=e.key,t=getType(r);return"boolean"!==t?[new ValidationError(o,r,"boolean expected, %s found",t)]:[]};
},{"../error/validation_error":274,"../util/get_type":292}],299:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type"),parseCSSColor=require("csscolorparser").parseCSSColor;module.exports=function(r){var e=r.key,o=r.value,t=getType(o);return"string"!==t?[new ValidationError(e,o,"color expected, %s found",t)]:null===parseCSSColor(o)?[new ValidationError(e,o,'color expected, "%s" found',o)]:[]};
},{"../error/validation_error":274,"../util/get_type":292,"csscolorparser":279}],300:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type");module.exports=function(r){var e=r.key,t=r.value;if(r.styleSpec.$version>7)return t?[new ValidationError(e,t,"constants have been deprecated as of v8")]:[];var a=getType(t);if("object"!==a)return[new ValidationError(e,t,"object expected, %s found",a)];var o=[];for(var n in t)"@"!==n[0]&&o.push(new ValidationError(e+"."+n,t[n],'constants must start with "@"'));return o};
},{"../error/validation_error":274,"../util/get_type":292}],301:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),unbundle=require("../util/unbundle_jsonlint");module.exports=function(e){var r=e.key,n=e.value,u=e.valueSpec,o=[];return Array.isArray(u.values)?u.values.indexOf(unbundle(n))===-1&&o.push(new ValidationError(r,n,"expected one of [%s], %s found",u.values.join(", "),n)):Object.keys(u.values).indexOf(unbundle(n))===-1&&o.push(new ValidationError(r,n,"expected one of [%s], %s found",Object.keys(u.values).join(", "),n)),o};
},{"../error/validation_error":274,"../util/unbundle_jsonlint":295}],302:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),validateEnum=require("./validate_enum"),getType=require("../util/get_type"),unbundle=require("../util/unbundle_jsonlint");module.exports=function e(r){var t,a=r.value,n=r.key,l=r.styleSpec,s=[];if("array"!==getType(a))return[new ValidationError(n,a,"array expected, %s found",getType(a))];if(a.length<1)return[new ValidationError(n,a,"filter array must have at least 1 element")];switch(s=s.concat(validateEnum({key:n+"[0]",value:a[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),unbundle(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&"$type"===unbundle(a[1])&&s.push(new ValidationError(n,a,'"$type" cannot be use with operator "%s"',a[0]));case"==":case"!=":3!==a.length&&s.push(new ValidationError(n,a,'filter array for operator "%s" must have 3 elements',a[0]));case"in":case"!in":case"arrin":case"!arrin":a.length>=2&&"string"!==(t=getType(a[1]))&&s.push(new ValidationError(n+"[1]",a[1],"string expected, %s found",t));for(var o=2;o<a.length;o++)t=getType(a[o]),"$type"===unbundle(a[1])?s=s.concat(validateEnum({key:n+"["+o+"]",value:a[o],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==t&&"number"!==t&&"boolean"!==t&&s.push(new ValidationError(n+"["+o+"]",a[o],"string, number, or boolean expected, %s found",t));break;case"any":case"all":case"none":for(var i=1;i<a.length;i++)s=s.concat(e({key:n+"["+i+"]",value:a[i],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":t=getType(a[1]),2!==a.length?s.push(new ValidationError(n,a,'filter array for "%s" operator must have 2 elements',a[0])):"string"!==t&&s.push(new ValidationError(n+"[1]",a[1],"string expected, %s found",t))}return s};
},{"../error/validation_error":274,"../util/get_type":292,"../util/unbundle_jsonlint":295,"./validate_enum":301}],303:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type"),validate=require("./validate"),validateObject=require("./validate_object"),validateArray=require("./validate_array"),validateNumber=require("./validate_number"),unbundle=require("../util/unbundle_jsonlint");module.exports=function(e){function t(e){if("identity"===p)return[new ValidationError(e.key,e.value,'identity function may not have a "stops" property')];var t=[],a=e.value;return t=t.concat(validateArray({key:e.key,value:a,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:r})),"array"===getType(a)&&0===a.length&&t.push(new ValidationError(e.key,a,"array must have at least one stop")),t}function r(e){var t=[],r=e.value,o=e.key;if("array"!==getType(r))return[new ValidationError(o,r,"array expected, %s found",getType(r))];if(2!==r.length)return[new ValidationError(o,r,"array length %d expected, length %d found",2,r.length)];if(c){if("object"!==getType(r[0]))return[new ValidationError(o,r,"object expected, %s found",getType(r[0]))];if(void 0===r[0].zoom)return[new ValidationError(o,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new ValidationError(o,r,"object stop key must have value")];if(l&&l>unbundle(r[0].zoom))return[new ValidationError(o,r[0].zoom,"stop zoom values must appear in ascending order")];unbundle(r[0].zoom)!==l&&(l=unbundle(r[0].zoom),i=void 0,s={}),t=t.concat(validateObject({key:o+"[0]",value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:validateNumber,value:a}}))}else t=t.concat(a({key:o+"[0]",value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec}));return t.concat(validate({key:o+"[1]",value:r[1],valueSpec:u,style:e.style,styleSpec:e.styleSpec}))}function a(e){var t=getType(e.value),r=unbundle(e.value);if(n){if(t!==n)return[new ValidationError(e.key,e.value,"%s stop domain type must match previous stop domain type %s",t,n)]}else n=t;if("number"!==t&&"string"!==t&&"boolean"!==t)return[new ValidationError(e.key,e.value,"stop domain value must be a number, string, or boolean")];if("number"!==t&&"categorical"!==p){var a="number expected, %s found";return u["property-function"]&&void 0===p&&(a+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ValidationError(e.key,e.value,a,t)]}return"categorical"!==p||"number"!==t||isFinite(r)&&Math.floor(r)===r?"number"===t&&void 0!==i&&r<i?[new ValidationError(e.key,e.value,"stop domain values must appear in ascending order")]:(i=r,"categorical"===p&&r in s?[new ValidationError(e.key,e.value,"stop domain values must be unique")]:(s[r]=!0,[])):[new ValidationError(e.key,e.value,"integer expected, found %s",r)]}function o(e){return validate({key:e.key,value:e.value,valueSpec:u,style:e.style,styleSpec:e.styleSpec})}var n,i,l,u=e.valueSpec,p=unbundle(e.value.type),s={},y="categorical"!==p&&void 0===e.value.property,d=!y,c="array"===getType(e.value.stops)&&"array"===getType(e.value.stops[0])&&"object"===getType(e.value.stops[0][0]),v=validateObject({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:t,default:o}});return"identity"===p&&y&&v.push(new ValidationError(e.key,e.value,'missing required property "property"')),"identity"===p||e.value.stops||v.push(new ValidationError(e.key,e.value,'missing required property "stops"')),"exponential"===p&&"piecewise-constant"===e.valueSpec.function&&v.push(new ValidationError(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(d&&!e.valueSpec["property-function"]?v.push(new ValidationError(e.key,e.value,"property functions not supported")):y&&!e.valueSpec["zoom-function"]&&v.push(new ValidationError(e.key,e.value,"zoom functions not supported"))),"categorical"!==p&&!c||void 0!==e.value.property||v.push(new ValidationError(e.key,e.value,'"property" property is required')),v};
},{"../error/validation_error":274,"../util/get_type":292,"../util/unbundle_jsonlint":295,"./validate":296,"./validate_array":297,"./validate_number":308,"./validate_object":309}],304:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),validateString=require("./validate_string");module.exports=function(r){var e=r.value,t=r.key,a=validateString(r);return a.length?a:(e.indexOf("{fontstack}")===-1&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{range}" token')),a)};
},{"../error/validation_error":274,"./validate_string":313}],305:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),unbundle=require("../util/unbundle_jsonlint"),validateObject=require("./validate_object"),validateFilter=require("./validate_filter"),validatePaintProperty=require("./validate_paint_property"),validateLayoutProperty=require("./validate_layout_property"),extend=require("../util/extend");module.exports=function(e){var r=[],t=e.value,a=e.key,i=e.style,l=e.styleSpec;t.type||t.ref||r.push(new ValidationError(a,t,'either "type" or "ref" is required'));var u=unbundle(t.type),n=unbundle(t.ref);if(t.id)for(var o=unbundle(t.id),s=0;s<e.arrayIndex;s++){var d=i.layers[s];unbundle(d.id)===o&&r.push(new ValidationError(a,t.id,'duplicate layer id "%s", previously used at line %d',t.id,d.id.__line__))}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(function(e){e in t&&r.push(new ValidationError(a,t[e],'"%s" is prohibited for ref layers',e))});var y;i.layers.forEach(function(e){unbundle(e.id)===n&&(y=e)}),y?y.ref?r.push(new ValidationError(a,t.ref,"ref cannot reference another ref layer")):u=unbundle(y.type):r.push(new ValidationError(a,t.ref,'ref layer "%s" not found',n))}else if("background"!==u)if(t.source){var c=i.sources&&i.sources[t.source],p=c&&unbundle(c.type);c?"vector"===p&&"raster"===u?r.push(new ValidationError(a,t.source,'layer "%s" requires a raster source',t.id)):"raster"===p&&"raster"!==u?r.push(new ValidationError(a,t.source,'layer "%s" requires a vector source',t.id)):"vector"!==p||t["source-layer"]||r.push(new ValidationError(a,t,'layer "%s" must specify a "source-layer"',t.id)):r.push(new ValidationError(a,t.source,'source "%s" not found',t.source))}else r.push(new ValidationError(a,t,'missing required property "source"'));return r=r.concat(validateObject({key:a,value:t,valueSpec:l.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},filter:validateFilter,layout:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validateLayoutProperty(extend({layerType:u},e))}}})},paint:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validatePaintProperty(extend({layerType:u},e))}}})}}}))};
},{"../error/validation_error":274,"../util/extend":291,"../util/unbundle_jsonlint":295,"./validate_filter":302,"./validate_layout_property":306,"./validate_object":309,"./validate_paint_property":310}],306:[function(require,module,exports){
"use strict";var validateProperty=require("./validate_property");module.exports=function(r){return validateProperty(r,"layout")};
},{"./validate_property":311}],307:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type"),validate=require("./validate");module.exports=function(e){var t=e.value,r=e.styleSpec,a=r.light,i=e.style,n=[],o=getType(t);if(void 0===t)return n;if("object"!==o)return n=n.concat([new ValidationError("light",t,"object expected, %s found",o)]);for(var l in t){var c=l.match(/^(.*)-transition$/);n=c&&a[c[1]]&&a[c[1]].transition?n.concat(validate({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r})):a[l]?n.concat(validate({key:l,value:t[l],valueSpec:a[l],style:i,styleSpec:r})):n.concat([new ValidationError(l,t[l],'unknown property "%s"',l)])}return n};
},{"../error/validation_error":274,"../util/get_type":292,"./validate":296}],308:[function(require,module,exports){
"use strict";var getType=require("../util/get_type"),ValidationError=require("../error/validation_error");module.exports=function(e){var r=e.key,i=e.value,m=e.valueSpec,a=getType(i);return"number"!==a?[new ValidationError(r,i,"number expected, %s found",a)]:"minimum"in m&&i<m.minimum?[new ValidationError(r,i,"%s is less than the minimum value %s",i,m.minimum)]:"maximum"in m&&i>m.maximum?[new ValidationError(r,i,"%s is greater than the maximum value %s",i,m.maximum)]:[]};
},{"../error/validation_error":274,"../util/get_type":292}],309:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),getType=require("../util/get_type"),validateSpec=require("./validate");module.exports=function(e){var r=e.key,t=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},o=e.style,l=e.styleSpec,n=[],u=getType(t);if("object"!==u)return[new ValidationError(r,t,"object expected, %s found",u)];for(var d in t){var p=d.split(".")[0],s=i[p]||i["*"],c=void 0;if(a[p])c=a[p];else if(i[p])c=validateSpec;else if(a["*"])c=a["*"];else{if(!i["*"]){n.push(new ValidationError(r,t[d],'unknown property "%s"',d));continue}c=validateSpec}n=n.concat(c({key:(r?r+".":r)+d,value:t[d],valueSpec:s,style:o,styleSpec:l,object:t,objectKey:d}))}for(var v in i)i[v].required&&void 0===i[v].default&&void 0===t[v]&&n.push(new ValidationError(r,t,'missing required property "%s"',v));return n};
},{"../error/validation_error":274,"../util/get_type":292,"./validate":296}],310:[function(require,module,exports){
"use strict";var validateProperty=require("./validate_property");module.exports=function(r){return validateProperty(r,"paint")};
},{"./validate_property":311}],311:[function(require,module,exports){
"use strict";var validate=require("./validate"),ValidationError=require("../error/validation_error"),getType=require("../util/get_type");module.exports=function(e,t){var r=e.key,i=e.style,a=e.styleSpec,n=e.value,o=e.objectKey,l=a[t+"_"+e.layerType];if(!l)return[];var y=o.match(/^(.*)-transition$/);if("paint"===t&&y&&l[y[1]]&&l[y[1]].transition)return validate({key:r,value:n,valueSpec:a.transition,style:i,styleSpec:a});var p=e.valueSpec||l[o];if(!p)return[new ValidationError(r,n,'unknown property "%s"',o)];var s;if("string"===getType(n)&&p["property-function"]&&!p.tokens&&(s=/^{([^}]+)}$/.exec(n)))return[new ValidationError(r,n,'"%s" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": %s` }`.',o,JSON.stringify(s[1]))];var u=[];return"symbol"===e.layerType&&"text-field"===o&&i&&!i.glyphs&&u.push(new ValidationError(r,n,'use of "text-field" requires a style "glyphs" property')),u.concat(validate({key:e.key,value:n,valueSpec:p,style:i,styleSpec:a}))};
},{"../error/validation_error":274,"../util/get_type":292,"./validate":296}],312:[function(require,module,exports){
"use strict";var ValidationError=require("../error/validation_error"),unbundle=require("../util/unbundle_jsonlint"),validateObject=require("./validate_object"),validateEnum=require("./validate_enum");module.exports=function(e){var a=e.value,t=e.key,r=e.styleSpec,l=e.style;if(!a.type)return[new ValidationError(t,a,'"type" is required')];var u=unbundle(a.type),i=[];switch(u){case"vector":case"raster":if(i=i.concat(validateObject({key:t,value:a,valueSpec:r.source_tile,style:e.style,styleSpec:r})),"url"in a)for(var s in a)["type","url","tileSize"].indexOf(s)<0&&i.push(new ValidationError(t+"."+s,a[s],'a source with a "url" property may not include a "%s" property',s));return i;case"geojson":return validateObject({key:t,value:a,valueSpec:r.source_geojson,style:l,styleSpec:r});case"video":return validateObject({key:t,value:a,valueSpec:r.source_video,style:l,styleSpec:r});case"image":return validateObject({key:t,value:a,valueSpec:r.source_image,style:l,styleSpec:r});case"canvas":return validateObject({key:t,value:a,valueSpec:r.source_canvas,style:l,styleSpec:r});default:return validateEnum({key:t+".type",value:a.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:l,styleSpec:r})}};
},{"../error/validation_error":274,"../util/unbundle_jsonlint":295,"./validate_enum":301,"./validate_object":309}],313:[function(require,module,exports){
"use strict";var getType=require("../util/get_type"),ValidationError=require("../error/validation_error");module.exports=function(r){var e=r.value,t=r.key,i=getType(e);return"string"!==i?[new ValidationError(t,e,"string expected, %s found",i)]:[]};
},{"../error/validation_error":274,"../util/get_type":292}],314:[function(require,module,exports){
"use strict";function validateStyleMin(e,a){a=a||latestStyleSpec;var t=[];return t=t.concat(validate({key:"",value:e,valueSpec:a.$root,styleSpec:a,style:e,objectElementValidators:{glyphs:validateGlyphsURL,"*":function(){return[]}}})),a.$version>7&&e.constants&&(t=t.concat(validateConstants({key:"constants",value:e.constants,style:e,styleSpec:a}))),sortErrors(t)}function sortErrors(e){return[].concat(e).sort(function(e,a){return e.line-a.line})}function wrapCleanErrors(e){return function(){return sortErrors(e.apply(this,arguments))}}var validateConstants=require("./validate/validate_constants"),validate=require("./validate/validate"),latestStyleSpec=require("./reference/latest"),validateGlyphsURL=require("./validate/validate_glyphs_url");validateStyleMin.source=wrapCleanErrors(require("./validate/validate_source")),validateStyleMin.light=wrapCleanErrors(require("./validate/validate_light")),validateStyleMin.layer=wrapCleanErrors(require("./validate/validate_layer")),validateStyleMin.filter=wrapCleanErrors(require("./validate/validate_filter")),validateStyleMin.paintProperty=wrapCleanErrors(require("./validate/validate_paint_property")),validateStyleMin.layoutProperty=wrapCleanErrors(require("./validate/validate_layout_property")),module.exports=validateStyleMin;
},{"./reference/latest":289,"./validate/validate":296,"./validate/validate_constants":300,"./validate/validate_filter":302,"./validate/validate_glyphs_url":304,"./validate/validate_layer":305,"./validate/validate_layout_property":306,"./validate/validate_light":307,"./validate/validate_paint_property":310,"./validate/validate_source":312}],315:[function(require,module,exports){
"use strict";var AnimationLoop=function(){this.n=0,this.times=[]};AnimationLoop.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},AnimationLoop.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},AnimationLoop.prototype.cancel=function(t){this.times=this.times.filter(function(i){return i.id!==t})},module.exports=AnimationLoop;
},{}],316:[function(require,module,exports){
"use strict";var Evented=require("../util/evented"),ajax=require("../util/ajax"),browser=require("../util/browser"),normalizeURL=require("../util/minemap").normalizeSpriteURL,SpritePosition=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},ImageSprite=function(t){function i(i,e){var a=this;t.call(this),this.base=i,this.retina=browser.devicePixelRatio>1,this.setEventedParent(e);var r=this.retina?"@2x":"";ajax.getJSON(normalizeURL(i,r,".json"),function(t,i){if(t)return void a.fire("error",{error:t});a.data=i,a.imgData&&a.fire("data",{dataType:"style"})}),ajax.getImage(normalizeURL(i,r,".png"),function(t,i){if(t)return void a.fire("error",{error:t});a.imgData=browser.getImageData(i);for(var e=0;e<a.imgData.length;e+=4){var r=a.imgData[e+3]/255;a.imgData[e+0]*=r,a.imgData[e+1]*=r,a.imgData[e+2]*=r}a.width=i.width,a.data&&a.fire("data",{dataType:"style"})})}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.toJSON=function(){return this.base},i.prototype.loaded=function(){return!(!this.data||!this.imgData)},i.prototype.resize=function(){var t=this;if(browser.devicePixelRatio>1!==this.retina){var e=new i(this.base);e.on("data",function(){t.data=e.data,t.imgData=e.imgData,t.width=e.width,t.retina=e.retina})}},i.prototype.getSpritePosition=function(t){if(!this.loaded())return new SpritePosition;var i=this.data&&this.data[t];return i&&this.imgData?i:new SpritePosition},i}(Evented);module.exports=ImageSprite;
},{"../util/ajax":370,"../util/browser":372,"../util/evented":381,"../util/minemap":390}],317:[function(require,module,exports){
"use strict";var styleSpec=require("../style-spec/reference/latest"),util=require("../util/util"),Evented=require("../util/evented"),validateStyle=require("./validate_style"),StyleDeclaration=require("./style_declaration"),StyleTransition=require("./style_transition"),TRANSITION_SUFFIX="-transition",Light=function(t){function i(i){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=styleSpec.light,this.set(i)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.set=function(t){var i=this;if(!this._validate(validateStyle.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=util.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var e=0,o=i.properties;e<o.length;e+=1){var n=o[e];i._declarations[n]=new StyleDeclaration(i._specifications[n],t[n])}return this}},i.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},i.prototype.getLightProperty=function(t){return util.endsWith(t,TRANSITION_SUFFIX)?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},i.prototype.getLightValue=function(t,i){if("position"===t){var e=this._transitions[t].calculate(i),o=util.sphericalToCartesian(e);return{x:o[0],y:o[1],z:o[2]}}return this._transitions[t].calculate(i)},i.prototype.setLight=function(t){var i=this;if(!this._validate(validateStyle.light,t))for(var e in t){var o=t[e];util.endsWith(e,TRANSITION_SUFFIX)?i._transitionOptions[e]=o:null===o||void 0===o?delete i._declarations[e]:i._declarations[e]=new StyleDeclaration(i._specifications[e],o)}},i.prototype.recalculate=function(t){var i=this;for(var e in i._declarations)i.calculated[e]=i.getLightValue(e,{zoom:t})},i.prototype._applyLightDeclaration=function(t,i,e,o,n){var r=e.transition?this._transitions[t]:void 0,a=this._specifications[t];if(null!==i&&void 0!==i||(i=new StyleDeclaration(a,a.default)),!r||r.declaration.json!==i.json){var s=util.extend({duration:300,delay:0},o,this.getLightProperty(t+TRANSITION_SUFFIX)),l=this._transitions[t]=new StyleTransition(a,i,r,s);l.instant()||(l.loopID=n.set(l.endTime-Date.now())),r&&n.cancel(r.loopID)}},i.prototype.updateLightTransitions=function(t,i,e){var o,n=this;for(o in n._declarations)n._applyLightDeclaration(o,n._declarations[o],t,i,e)},i.prototype._validate=function(t,i){return validateStyle.emitErrors(this,t.call(validateStyle,util.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:styleSpec})))},i}(Evented);module.exports=Light;
},{"../style-spec/reference/latest":289,"../util/evented":381,"../util/util":399,"./style_declaration":319,"./style_transition":334,"./validate_style":335}],318:[function(require,module,exports){
"use strict";var Evented=require("../util/evented"),StyleLayer=require("./style_layer"),ImageSprite=require("./image_sprite"),Light=require("./light"),GlyphSource=require("../symbol/glyph_source"),SpriteAtlas=require("../symbol/sprite_atlas"),LineAtlas=require("../render/line_atlas"),util=require("../util/util"),ajax=require("../util/ajax"),minemap=require("../util/minemap"),browser=require("../util/browser"),Dispatcher=require("../util/dispatcher"),AnimationLoop=require("./animation_loop"),validateStyle=require("./validate_style"),Source=require("../source/source"),QueryFeatures=require("../source/query_features"),SourceCache=require("../source/source_cache"),styleSpec=require("../style-spec/reference/latest"),MinemapGLFunction=require("../style-spec/function"),getWorkerPool=require("../util/global_worker_pool"),deref=require("../style-spec/deref"),diff=require("../style-spec/diff"),rtlTextPlugin=require("../source/rtl_text_plugin"),supportedDiffOperations=util.pick(diff.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),ignoredDiffOperations=util.pick(diff.operations,["setCenter","setZoom","setBearing","setPitch"]),Style=function(e){function t(t,r,i){var s=this;e.call(this),this.map=r,this.animationLoop=r&&r.animationLoop||new AnimationLoop,this.dispatcher=new Dispatcher(getWorkerPool(),this),this.spriteAtlas=new SpriteAtlas(1024,1024),this.spriteAtlas.setEventedParent(this),this.lineAtlas=new LineAtlas(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,util.bindAll(["_redoPlacement"],this),this._resetUpdates(),i=util.extend({validate:"string"!=typeof t||!minemap.isMinemapURL(t)},i),this.setEventedParent(r),this.fire("dataloading",{dataType:"style"});var o=this;this._rtlTextPluginCallback=rtlTextPlugin.registerForPluginAvailability(function(e){o.dispatcher.broadcast("loadRTLTextPlugin",e.pluginBlobURL,e.errorCallback);for(var t in o.sourceCaches)o.sourceCaches[t].reload()});var a=function(e,t){if(e)return void s.fire("error",{error:e});if(!i.validate||!validateStyle.emitErrors(s,validateStyle(t))){s._loaded=!0,s.stylesheet=t,s.updateClasses();for(var r in t.sources)s.addSource(r,t.sources[r],i);t.sprite&&(s.sprite=new ImageSprite(t.sprite,s)),s.glyphSource=new GlyphSource(t.glyphs),s._resolve(),s.fire("data",{dataType:"style"}),s.fire("style.load")}};"string"==typeof t?ajax.getJSON(minemap.normalizeStyleURL(t),a):browser.frame(a.bind(this,null,t)),this.on("data",function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=s.sourceCaches[e.sourceId].getSource();if(t&&t.vectorLayerIds)for(var r in s._layers){var i=s._layers[r];i.source===t.id&&s._validateLayer(i)}}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._validateLayer=function(e){var t=this.sourceCaches[e.source];if(e.sourceLayer&&t){var r=t.getSource();("geojson"===r.type||r.vectorLayerIds&&r.vectorLayerIds.indexOf(e.sourceLayer)===-1)&&this.fire("error",{error:new Error('Source layer "'+e.sourceLayer+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')})}},t.prototype.loaded=function(){var e=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in e.sourceCaches)if(!e.sourceCaches[t].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},t.prototype._resolve=function(){var e=this,t=deref(this.stylesheet.layers);this._order=t.map(function(e){return e.id}),this._layers={};for(var r=0,i=t;r<i.length;r+=1){var s=i[r];s=StyleLayer.create(s),s.setEventedParent(e,{layer:{id:s.id}}),e._layers[s.id]=s}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Light(this.stylesheet.light)},t.prototype._serializeLayers=function(e){var t=this;return e.map(function(e){return t._layers[e].serialize()})},t.prototype._applyClasses=function(e,t){var r=this;if(this._loaded){e=e||[],t=t||{transition:!0};var i=this.stylesheet.transition||{},s=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var o in s){var a=r._layers[o],n=r._updatedPaintProps[o];if(r._updatedAllPaintProps||n.all)a.updatePaintTransitions(e,t,i,r.animationLoop,r.zoomHistory);else for(var l in n)r._layers[o].updatePaintTransition(l,e,t,i,r.animationLoop,r.zoomHistory)}this.light.updateLightTransitions(t,i,this.animationLoop)}},t.prototype._recalculate=function(e){var t=this;if(this._loaded){for(var r in t.sourceCaches)t.sourceCaches[r].used=!1;this._updateZoomHistory(e);for(var i=0,s=t._order;i<s.length;i+=1){var o=s[i],a=t._layers[o];a.recalculate(e),!a.isHidden(e)&&a.source&&(t.sourceCaches[a.source].used=!0)}this.light.recalculate(e);Math.floor(this.z)!==Math.floor(e)&&this.animationLoop.set(300),this.z=e}},t.prototype._updateZoomHistory=function(e){var t=this.zoomHistory;void 0===t.lastIntegerZoom&&(t.lastIntegerZoom=Math.floor(e),t.lastIntegerZoomTime=0,t.lastZoom=e),Math.floor(t.lastZoom)<Math.floor(e)?(t.lastIntegerZoom=Math.floor(e),t.lastIntegerZoomTime=Date.now()):Math.floor(t.lastZoom)>Math.floor(e)&&(t.lastIntegerZoom=Math.floor(e+1),t.lastIntegerZoomTime=Date.now()),t.lastZoom=e},t.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},t.prototype.update=function(e,t){var r=this;if(this._changed){var i=Object.keys(this._updatedLayers),s=Object.keys(this._removedLayers);(i.length||s.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(i,s);for(var o in r._updatedSources){var a=r._updatedSources[o];"reload"===a?r._reloadSource(o):"clear"===a&&r._clearSource(o)}this._applyClasses(e,t),this._resetUpdates(),this.fire("data",{dataType:"style"})}},t.prototype._updateWorkerLayers=function(e,t){var r=this,i=this._updatedSymbolOrder?this._order.filter(function(e){return"symbol"===r._layers[e].type||"symtracking"===r._layers[e].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t,symbolOrder:i})},t.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},t.prototype.setState=function(e){var t=this;if(this._checkLoaded(),validateStyle.emitErrors(this,validateStyle(e)))return!1;e=util.extend({},e),e.layers=deref(e.layers);var r=diff(this.serialize(),e).filter(function(e){return!(e.command in ignoredDiffOperations)});if(0===r.length)return!1;var i=r.filter(function(e){return!(e.command in supportedDiffOperations)});if(i.length>0)throw new Error("Unimplemented: "+i.map(function(e){return e.command}).join(", ")+".");return r.forEach(function(e){"setTransition"!==e.command&&t[e.command].apply(t,e.args)}),this.stylesheet=e,!0},t.prototype.addSource=function(e,t,r){var i=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!t.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(t)+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(t.type)>=0&&this._validate(validateStyle.source,"sources."+e,t,null,r))){var s=this.sourceCaches[e]=new SourceCache(e,t,this.dispatcher);s.style=this,s.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:s.serialize(),sourceId:e}}),s.onAdd(this.map),this._changed=!0}},t.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");var t=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],t.setEventedParent(null),t.clearTiles(),t.onRemove&&t.onRemove(this.map),this._changed=!0},t.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},t.prototype.addLayer=function(e,t,r){this._checkLoaded();var i=e.id;if("object"==typeof e.source&&(this.addSource(i,e.source),e=util.extend(e,{source:i})),!this._validate(validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r)){var s=StyleLayer.create(e);this._validateLayer(s),s.setEventedParent(this,{layer:{id:i}});var o=t?this._order.indexOf(t):this._order.length;if(this._order.splice(o,0,i),this._layers[i]=s,this._removedLayers[i]&&s.source){var a=this._removedLayers[i];delete this._removedLayers[i],this._updatedSources[s.source]=a.type!==s.type?"clear":"reload"}this._updateLayer(s),"symbol"!==s.type&&"symtracking"!==s.type||(this._updatedSymbolOrder=!0),this.updateClasses(i)}},t.prototype.moveLayer=function(e,t){this._checkLoaded(),this._changed=!0;var r=this._layers[e];if(!r)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")});var i=this._order.indexOf(e);this._order.splice(i,1);var s=t?this._order.indexOf(t):this._order.length;this._order.splice(s,0,e),"symbol"!==r.type&&"symtracking"!==r.type||(this._updatedSymbolOrder=!0,r.source&&!this._updatedSources[r.source]&&(this._updatedSources[r.source]="reload"))},t.prototype.removeLayer=function(e){this._checkLoaded();var t=this._layers[e];if(!t)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")});t.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),"symbol"!==t.type&&"symtracking"!==t.type||(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[e]=t,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e]},t.prototype.getLayer=function(e){return this._layers[e]},t.prototype.setLayerZoomRange=function(e,t,r){this._checkLoaded();var i=this.getLayer(e);if(!i)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")});i.minzoom===t&&i.maxzoom===r||(null!=t&&(i.minzoom=t),null!=r&&(i.maxzoom=r),this._updateLayer(i))},t.prototype.setFilter=function(e,t){this._checkLoaded();var r=this.getLayer(e);if(!r)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")});null!==t&&void 0!==t&&this._validate(validateStyle.filter,"layers."+r.id+".filter",t)||util.deepEqual(r.filter,t)||(r.filter=util.clone(t),this._updateLayer(r))},t.prototype.getFilter=function(e){return util.clone(this.getLayer(e).filter)},t.prototype.setLayoutProperty=function(e,t,r){this._checkLoaded();var i=this.getLayer(e);if(!i)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")});util.deepEqual(i.getLayoutProperty(t),r)||(i.setLayoutProperty(t,r),this._updateLayer(i))},t.prototype.getLayoutProperty=function(e,t){return this.getLayer(e).getLayoutProperty(t)},t.prototype.setPaintProperty=function(e,t,r,i){this._checkLoaded();var s=this.getLayer(e);if(!s)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")});if(!util.deepEqual(s.getPaintProperty(t,i),r)){var o=s.isPaintValueFeatureConstant(t);s.setPaintProperty(t,r,i);!(r&&MinemapGLFunction.isFunctionDefinition(r)&&"$zoom"!==r.property&&void 0!==r.property)&&o||this._updateLayer(s),this.updateClasses(e,t)}},t.prototype.getPaintProperty=function(e,t,r){return this.getLayer(e).getPaintProperty(t,r)},t.prototype.getTransition=function(){return util.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},t.prototype.updateClasses=function(e,t){if(this._changed=!0,e){var r=this._updatedPaintProps;r[e]||(r[e]={}),r[e][t||"all"]=!0}else this._updatedAllPaintProps=!0},t.prototype.serialize=function(){var e=this;return util.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:util.mapObject(this.sourceCaches,function(e){return e.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(e){return void 0!==e})},t.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&(this._updatedSources[e.source]="reload"),this._changed=!0},t.prototype._flattenRenderedFeatures=function(e){for(var t=this,r=[],i=this._order.length-1;i>=0;i--)for(var s=t._order[i],o=0,a=e;o<a.length;o+=1){var n=a[o],l=n[s];if(l)for(var u=0,d=l;u<d.length;u+=1){var h=d[u];r.push(h)}}return r},t.prototype.queryRenderedFeatures=function(e,t,r,i){var s=this;t&&t.filter&&this._validate(validateStyle.filter,"queryRenderedFeatures.filter",t.filter);var o={};if(t&&t.layers){if(!Array.isArray(t.layers))return void this.fire("error",{error:"parameters.layers must be an Array."});for(var a=0,n=t.layers;a<n.length;a+=1){var l=n[a],u=s._layers[l];if(!u)return void s.fire("error",{error:"The layer '"+l+"' does not exist in the map's style and cannot be queried for features."});o[u.source]=!0}}var d=[];for(var h in s.sourceCaches)if(!t.layers||o[h]){var c=QueryFeatures.rendered(s.sourceCaches[h],s._layers,e,t,r,i);d.push(c)}return this._flattenRenderedFeatures(d)},t.prototype.querySourceFeatures=function(e,t){t&&t.filter&&this._validate(validateStyle.filter,"querySourceFeatures.filter",t.filter);var r=this.sourceCaches[e];return r?QueryFeatures.source(r,t):[]},t.prototype.addSourceType=function(e,t,r){return Source.getType(e)?r(new Error('A source type called "'+e+'" already exists.')):(Source.setType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))},t.prototype.getLight=function(){return this.light.getLight()},t.prototype.setLight=function(e,t){this._checkLoaded();var r=this.light.getLight(),i=!1;for(var s in e)if(!util.deepEqual(e[s],r[s])){i=!0;break}if(i){var o=this.stylesheet.transition||{};this.light.setLight(e),this.light.updateLightTransitions(t||{transition:!0},o,this.animationLoop)}},t.prototype._validate=function(e,t,r,i,s){return(!s||s.validate!==!1)&&validateStyle.emitErrors(this,e.call(validateStyle,util.extend({key:t,style:this.serialize(),value:r,styleSpec:styleSpec},i)))},t.prototype._remove=function(){var e=this;rtlTextPlugin.evented.off("pluginAvailable",this._rtlTextPluginCallback);for(var t in e.sourceCaches)e.sourceCaches[t].clearTiles();this.dispatcher.remove()},t.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},t.prototype._reloadSource=function(e){this.sourceCaches[e].reload()},t.prototype._updateSources=function(e){var t=this;for(var r in t.sourceCaches)t.sourceCaches[r].update(e)},t.prototype._redoPlacement=function(){var e=this;for(var t in e.sourceCaches)e.sourceCaches[t].redoPlacement()},t.prototype.getIcons=function(e,t,r){var i=this,s=function(){i.spriteAtlas.setSprite(i.sprite),i.spriteAtlas.addIcons(t.icons,r)};!this.sprite||this.sprite.loaded()?s():this.sprite.on("data",s)},t.prototype.getGlyphs=function(e,t,r){function i(e,t,i){e&&console.error(e),n[i]=t,0===--a&&r(null,n)}var s=this,o=t.stacks,a=Object.keys(o).length,n={};for(var l in o)s.glyphSource.getSimpleGlyphs(l,o[l],t.uid,i)},t}(Evented);module.exports=Style;
},{"../render/line_atlas":248,"../source/query_features":260,"../source/rtl_text_plugin":262,"../source/source":263,"../source/source_cache":264,"../style-spec/deref":272,"../style-spec/diff":273,"../style-spec/function":277,"../style-spec/reference/latest":289,"../symbol/glyph_source":344,"../symbol/sprite_atlas":349,"../util/ajax":370,"../util/browser":372,"../util/dispatcher":378,"../util/evented":381,"../util/global_worker_pool":384,"../util/minemap":390,"../util/util":399,"./animation_loop":315,"./image_sprite":316,"./light":317,"./style_layer":320,"./validate_style":335}],319:[function(require,module,exports){
"use strict";var createFunction=require("../style-spec/function"),util=require("../util/util"),StyleDeclaration=function(t,i){var n=this;if(this.value=util.clone(i),this.isFunction=createFunction.isFunctionDefinition(i),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.function=createFunction(this.value,t),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var o=[],e=0,s=n.value.stops;e<s.length;e+=1){var u=s[e],a=u[0].zoom;n.stopZoomLevels.indexOf(a)<0&&(n.stopZoomLevels.push(a),o.push([a,o.length]))}this.functionInterpolationT=createFunction({type:"exponential",stops:o,base:i.base},{type:"number"})}};StyleDeclaration.prototype.calculate=function(t,i){try{var n=this.function(t&&t.zoom,i||{});return void 0!==this.minimum&&n<this.minimum?this.minimum:n}catch(t){}},StyleDeclaration.prototype.calculateInterpolationT=function(t,i){return this.functionInterpolationT(t&&t.zoom,i||{})},module.exports=StyleDeclaration;
},{"../style-spec/function":277,"../util/util":399}],320:[function(require,module,exports){
"use strict";function getDeclarationValue(t){return t.value}var util=require("../util/util"),StyleTransition=require("./style_transition"),StyleDeclaration=require("./style_declaration"),styleSpec=require("../style-spec/reference/latest"),validateStyle=require("./validate_style"),parseColor=require("./../style-spec/util/parse_color"),Evented=require("../util/evented"),TRANSITION_SUFFIX="-transition",StyleLayer=function(t){function i(i){var e=this;t.call(this),this.id=i.id,this.metadata=i.metadata,this.type=i.type,this.source=i.source,this.sourceLayer=i["source-layer"],this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this.filter=i.filter,this.paint={},this.layout={},this._paintSpecifications=styleSpec["paint_"+this.type],this._layoutSpecifications=styleSpec["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var a,n,r={validate:!1};for(var o in i){var l=o.match(/^paint(?:\.(.*))?$/);if(l){var s=l[1]||"";for(a in i[o])e.setPaintProperty(a,i[o][a],s,r)}}for(n in i.layout)e.setLayoutProperty(n,i.layout[n],r);for(a in e._paintSpecifications)e.paint[a]=e.getPaintValue(a);for(n in e._layoutSpecifications)e._updateLayoutValue(n)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setLayoutProperty=function(t,i,e){if(null==i)delete this._layoutDeclarations[t];else{var a="layers."+this.id+".layout."+t;if(this._validate(validateStyle.layoutProperty,a,t,i,e))return;this._layoutDeclarations[t]=new StyleDeclaration(this._layoutSpecifications[t],i)}this._updateLayoutValue(t)},i.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},i.prototype.getLayoutValue=function(t,i,e){var a=this._layoutSpecifications[t],n=this._layoutDeclarations[t];return n?n.calculate(i,e):a.default},i.prototype.setPaintProperty=function(t,i,e,a){var n="layers."+this.id+(e?'["paint.'+e+'"].':".paint.")+t;if(util.endsWith(t,TRANSITION_SUFFIX))if(this._paintTransitionOptions[e||""]||(this._paintTransitionOptions[e||""]={}),null===i||void 0===i)delete this._paintTransitionOptions[e||""][t];else{if(this._validate(validateStyle.paintProperty,n,t,i,a))return;this._paintTransitionOptions[e||""][t]=i}else if(this._paintDeclarations[e||""]||(this._paintDeclarations[e||""]={}),null===i||void 0===i)delete this._paintDeclarations[e||""][t];else{if(this._validate(validateStyle.paintProperty,n,t,i,a))return;this._paintDeclarations[e||""][t]=new StyleDeclaration(this._paintSpecifications[t],i)}},i.prototype.getPaintProperty=function(t,i){return i=i||"",util.endsWith(t,TRANSITION_SUFFIX)?this._paintTransitionOptions[i]&&this._paintTransitionOptions[i][t]:this._paintDeclarations[i]&&this._paintDeclarations[i][t]&&this._paintDeclarations[i][t].value},i.prototype.getPaintValue=function(t,i,e){var a=this._paintSpecifications[t],n=this._paintTransitions[t];return n?n.calculate(i,e):"color"===a.type&&a.default?parseColor(a.default):a.default},i.prototype.getPaintValueStopZoomLevels=function(t){var i=this._paintTransitions[t];return i?i.declaration.stopZoomLevels:[]},i.prototype.getPaintInterpolationT=function(t,i){return this._paintTransitions[t].declaration.calculateInterpolationT(i)},i.prototype.isPaintValueFeatureConstant=function(t){var i=this._paintTransitions[t];return!i||i.declaration.isFeatureConstant},i.prototype.isLayoutValueFeatureConstant=function(t){var i=this._layoutDeclarations[t];return!i||i.isFeatureConstant},i.prototype.isPaintValueZoomConstant=function(t){var i=this._paintTransitions[t];return!i||i.declaration.isZoomConstant},i.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility)},i.prototype.updatePaintTransitions=function(t,i,e,a,n){for(var r=this,o=util.extend({},this._paintDeclarations[""]),l=0;l<t.length;l++)util.extend(o,r._paintDeclarations[t[l]]);var s;for(s in o)r._applyPaintDeclaration(s,o[s],i,e,a,n);for(s in r._paintTransitions)s in o||r._applyPaintDeclaration(s,null,i,e,a,n)},i.prototype.updatePaintTransition=function(t,i,e,a,n,r){for(var o=this,l=this._paintDeclarations[""][t],s=0;s<i.length;s++){var y=o._paintDeclarations[i[s]];y&&y[t]&&(l=y[t])}this._applyPaintDeclaration(t,l,e,a,n,r)},i.prototype.recalculate=function(t){var i=this;for(var e in i._paintTransitions)i.paint[e]=i.getPaintValue(e,{zoom:t});for(var a in i._layoutFunctions)i.layout[a]=i.getLayoutValue(a,{zoom:t})},i.prototype.serialize=function(){var t=this,i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:util.mapObject(this._layoutDeclarations,getDeclarationValue)};for(var e in t._paintDeclarations){i[""===e?"paint":"paint."+e]=util.mapObject(t._paintDeclarations[e],getDeclarationValue)}return util.filterObject(i,function(t,i){return void 0!==t&&!("layout"===i&&!Object.keys(t).length)})},i.prototype._applyPaintDeclaration=function(t,i,e,a,n,r){var o=e.transition?this._paintTransitions[t]:void 0,l=this._paintSpecifications[t];if(null!==i&&void 0!==i||(i=new StyleDeclaration(l,l.default)),!o||o.declaration.json!==i.json){var s=util.extend({duration:300,delay:0},a,this.getPaintProperty(t+TRANSITION_SUFFIX)),y=this._paintTransitions[t]=new StyleTransition(l,i,o,s,r);y.instant()||(y.loopID=n.set(y.endTime-Date.now())),o&&n.cancel(o.loopID)}},i.prototype._updateLayoutValue=function(t){var i=this._layoutDeclarations[t];i&&i.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},i.prototype._validate=function(t,i,e,a,n){return(!n||n.validate!==!1)&&validateStyle.emitErrors(this,t.call(validateStyle,{key:i,layerType:this.type,objectKey:e,value:a,styleSpec:styleSpec,style:{glyphs:!0,sprite:!0}}))},i}(Evented);module.exports=StyleLayer;var subclasses={circle:require("./style_layer/circle_style_layer"),fill:require("./style_layer/fill_style_layer"),extrusion:require("./style_layer/extrusion_style_layer"),collada:require("./style_layer/collada_style_layer"),histogram:require("./style_layer/histogram_style_layer"),line:require("./style_layer/line_style_layer"),airline:require("./style_layer/airline_style_layer"),sprite:require("./style_layer/sprite_style_layer"),tracking:require("./style_layer/tracking_style_layer"),dynamicLine:require("./style_layer/dynamic_line_style_layer"),symbol:require("./style_layer/symbol_style_layer"),symtracking:require("./style_layer/symtracking_style_layer")};StyleLayer.create=function(t){return new(subclasses[t.type]||StyleLayer)(t)};
},{"../style-spec/reference/latest":289,"../util/evented":381,"../util/util":399,"./../style-spec/util/parse_color":293,"./style_declaration":319,"./style_layer/airline_style_layer":321,"./style_layer/circle_style_layer":322,"./style_layer/collada_style_layer":323,"./style_layer/dynamic_line_style_layer":324,"./style_layer/extrusion_style_layer":325,"./style_layer/fill_style_layer":326,"./style_layer/histogram_style_layer":327,"./style_layer/line_style_layer":328,"./style_layer/sprite_style_layer":329,"./style_layer/symbol_style_layer":330,"./style_layer/symtracking_style_layer":331,"./style_layer/tracking_style_layer":332,"./style_transition":334,"./validate_style":335}],321:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),AirlineBucket=require("../../data/bucket/airline_bucket"),util=require("../../util/util"),AirlineStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getPaintValue=function(t,r,i){var o=e.prototype.getPaintValue.call(this,t,r,i);if(o&&"airline-dasharray"===t){var a=this.getPaintValue("airline-width",util.extend({},r,{zoom:Math.floor(r.zoom)}),i);o.fromScale*=a,o.toScale*=a}return o},t.prototype.createBucket=function(e){return new AirlineBucket(e)},t}(StyleLayer);module.exports=AirlineStyleLayer;
},{"../../data/bucket/airline_bucket":202,"../../util/util":399,"../style_layer":320}],322:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),CircleBucket=require("../../data/bucket/circle_bucket"),CircleStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new CircleBucket(e)},t}(StyleLayer);module.exports=CircleStyleLayer;
},{"../../data/bucket/circle_bucket":203,"../style_layer":320}],323:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),ColladaBucket=require("../../data/bucket/collada_bucket"),ColladaStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var a=t.prototype.getPaintValue.call(this,e,r,o);return"collada-color"===e&&a&&(a[3]=1),a},e.prototype.createBucket=function(t){return new ColladaBucket(t)},e}(StyleLayer);module.exports=ColladaStyleLayer;
},{"../../data/bucket/collada_bucket":204,"../style_layer":320}],324:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),DynamicLineBucket=require("../../data/bucket/dynamic_Line_bucket"),util=require("../../util/util"),DynamicLineStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,a){var i=t.prototype.getPaintValue.call(this,e,r,a);if(i&&"tracking-dasharray"===e){var o=this.getPaintValue("tracking-width",util.extend({},r,{zoom:Math.floor(r.zoom)}),a);i.fromScale*=o,i.toScale*=o}return i},e.prototype.createBucket=function(t){return new DynamicLineBucket(t)},e}(StyleLayer);module.exports=DynamicLineStyleLayer;
},{"../../data/bucket/dynamic_Line_bucket":205,"../../util/util":399,"../style_layer":320}],325:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),ExtrusionBucket=require("../../data/bucket/extrusion_bucket"),ExtrusionStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var u=t.prototype.getPaintValue.call(this,e,r,o);return"extrusion-color"===e&&u&&(u[3]=1),u},e.prototype.createBucket=function(t){return new ExtrusionBucket(t)},e}(StyleLayer);module.exports=ExtrusionStyleLayer;
},{"../../data/bucket/extrusion_bucket":206,"../style_layer":320}],326:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),FillBucket=require("../../data/bucket/fill_bucket"),FillStyleLayer=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getPaintValue=function(o,l,e){var i=this;if("fill-outline-color"===o){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",l,e);for(var r=this._paintTransitions["fill-outline-color"];r;){if(!(r&&r.declaration&&r.declaration.value))return t.prototype.getPaintValue.call(i,"fill-color",l,e);r=r.oldTransition}}return t.prototype.getPaintValue.call(this,o,l,e)},o.prototype.getPaintValueStopZoomLevels=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,o)},o.prototype.getPaintInterpolationT=function(o,l){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",l):t.prototype.getPaintInterpolationT.call(this,o,l)},o.prototype.isPaintValueFeatureConstant=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,o)},o.prototype.isPaintValueZoomConstant=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,o)},o.prototype.createBucket=function(t){return new FillBucket(t)},o}(StyleLayer);module.exports=FillStyleLayer;
},{"../../data/bucket/fill_bucket":207,"../style_layer":320}],327:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),HistogramBucket=require("../../data/bucket/histogram_bucket"),HistogramStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var a=t.prototype.getPaintValue.call(this,e,r,o);return"histogram-color"===e&&a&&(a[3]=1),a},e.prototype.createBucket=function(t){return new HistogramBucket(t)},e}(StyleLayer);module.exports=HistogramStyleLayer;
},{"../../data/bucket/histogram_bucket":208,"../style_layer":320}],328:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),LineBucket=require("../../data/bucket/line_bucket"),util=require("../../util/util"),LineStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getPaintValue=function(t,r,o){var i=e.prototype.getPaintValue.call(this,t,r,o);if(i&&"line-dasharray"===t){var a=this.getPaintValue("line-width",util.extend({},r,{zoom:Math.floor(r.zoom)}),o);i.fromScale*=a,i.toScale*=a}return i},t.prototype.createBucket=function(e){return new LineBucket(e)},t}(StyleLayer);module.exports=LineStyleLayer;
},{"../../data/bucket/line_bucket":209,"../../util/util":399,"../style_layer":320}],329:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),SpriteBucket=require("../../data/bucket/sprite_bucket"),util=require("../../util/util"),SpriteStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var i=t.prototype.getPaintValue.call(this,e,r,o);if(i&&"sprite-dasharray"===e){var a=this.getPaintValue("sprite-width",util.extend({},r,{zoom:Math.floor(r.zoom)}),o);i.fromScale*=a,i.toScale*=a}return i},e.prototype.createBucket=function(t){return new SpriteBucket(t)},e}(StyleLayer);module.exports=SpriteStyleLayer;
},{"../../data/bucket/sprite_bucket":210,"../../util/util":399,"../style_layer":320}],330:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),SymbolBucket=require("../../data/bucket/symbol_bucket"),SymbolStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,o,r){var a=t.prototype.getLayoutValue.call(this,e,o,r);if("auto"!==a)return a;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",o,r)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",o,r);default:return a}},e.prototype.createBucket=function(t){return new SymbolBucket(t)},e}(StyleLayer);module.exports=SymbolStyleLayer;
},{"../../data/bucket/symbol_bucket":211,"../style_layer":320}],331:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),SymtrackingBucket=require("../../data/bucket/symtracking_bucket"),SymtrackingStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,r,a){var o=t.prototype.getLayoutValue.call(this,e,r,a);if("auto"!==o)return o;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",r,a)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",r,a);default:return o}},e.prototype.createBucket=function(t){return new SymtrackingBucket(t)},e}(StyleLayer);module.exports=SymtrackingStyleLayer;
},{"../../data/bucket/symtracking_bucket":212,"../style_layer":320}],332:[function(require,module,exports){
"use strict";var StyleLayer=require("../style_layer"),TrackingBucket=require("../../data/bucket/tracking_bucket"),util=require("../../util/util"),TrackingStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,a){var o=t.prototype.getPaintValue.call(this,e,r,a);if(o&&"sprite-dasharray"===e){var i=this.getPaintValue("sprite-width",util.extend({},r,{zoom:Math.floor(r.zoom)}),a);o.fromScale*=i,o.toScale*=i}return o},e.prototype.createBucket=function(t){return new TrackingBucket(t)},e}(StyleLayer);module.exports=TrackingStyleLayer;
},{"../../data/bucket/tracking_bucket":213,"../../util/util":399,"../style_layer":320}],333:[function(require,module,exports){
"use strict";var StyleLayer=require("./style_layer"),util=require("../util/util"),featureFilter=require("../style-spec/feature_filter"),groupByLayout=require("../style-spec/group_by_layout"),StyleLayerIndex=function(e){e&&this.replace(e)};StyleLayerIndex.prototype.replace=function(e){var r=this;this.symbolOrder=[];for(var t=0,i=e;t<i.length;t+=1){var a=i[t];"symbol"!==a.type&&"symtracking"!==a.type||r.symbolOrder.push(a.id)}this._layerConfigs={},this._layers={},this.update(e,[])},StyleLayerIndex.prototype.update=function(e,r,t){for(var i=this,a=0,l=e;a<l.length;a+=1){var y=l[a];i._layerConfigs[y.id]=y;var s=i._layers[y.id]=StyleLayer.create(y);s.updatePaintTransitions({},{transition:!1}),s.filter=featureFilter(s.filter)}for(var o=0,u=r;o<u.length;o+=1){var n=u[o];delete i._layerConfigs[n],delete i._layers[n]}t&&(this.symbolOrder=t),this.familiesBySource={};for(var f=groupByLayout(util.values(this._layerConfigs)),p=0,d=f;p<d.length;p+=1){var c=d[p],h=c.map(function(e){return i._layers[e.id]}),v=h[0];if(!v.layout||"none"!==v.layout.visibility){var g=v.source||"",_=i.familiesBySource[g];_||(_=i.familiesBySource[g]={});var m=v.sourceLayer||"_geojsonTileLayer",L=_[m];L||(L=_[m]=[]),L.push(h)}}},module.exports=StyleLayerIndex;
},{"../style-spec/feature_filter":275,"../style-spec/group_by_layout":278,"../util/util":399,"./style_layer":320}],334:[function(require,module,exports){
"use strict";function interpZoomTransitioned(t,i,o){if(void 0!==t&&void 0!==i)return{from:t.to,fromScale:t.toScale,to:i.to,toScale:i.toScale,t:o}}var util=require("../util/util"),interpolate=require("../util/interpolate"),fakeZoomHistory={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},StyleTransition=function(t,i,o,e,a){this.declaration=i,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=o,this.duration=e.duration||0,this.delay=e.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?interpZoomTransitioned:interpolate[t.type],this.zoomHistory=a||fakeZoomHistory,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),o&&o.endTime<=this.startTime&&delete o.oldTransition};StyleTransition.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},StyleTransition.prototype.calculate=function(t,i,o){try{var e=this._calculateTargetValue(t,i);if(this.instant())return e;if(this.__lastVal=e,(o=o||Date.now())>=this.endTime)return e;var a=this.oldTransition.calculate(t,i,this.startTime),n=util.easeCubicInOut((o-this.startTime-this.delay)/this.duration);return this.interp(a,e,n)}catch(t){return this.__lastVal}},StyleTransition.prototype._calculateTargetValue=function(t,i){if(!this.zoomTransitioned)return this.declaration.calculate(t,i);var o=t.zoom,e=this.zoomHistory.lastIntegerZoom,a=o>e?2:.5,n=this.declaration.calculate({zoom:o>e?o-1:o+1},i),r=this.declaration.calculate({zoom:o},i),s=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),l=Math.abs(o-e),h=interpolate(s,1,l);return void 0!==n&&void 0!==r?{from:n,fromScale:a,to:r,toScale:1,t:h}:void 0},module.exports=StyleTransition;
},{"../util/interpolate":386,"../util/util":399}],335:[function(require,module,exports){
"use strict";module.exports=require("../style-spec/validate_style.min"),module.exports.emitErrors=function(r,e){if(e&&e.length){for(var t=0;t<e.length;t++)r.fire("error",{error:new Error(e[t].message)});return!0}return!1};
},{"../style-spec/validate_style.min":314}],336:[function(require,module,exports){
"use strict";var Point=require("point-geometry"),Anchor=function(t){function o(o,e,n,r){t.call(this,o,e),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(Point);module.exports=Anchor;
},{"point-geometry":154}],337:[function(require,module,exports){
"use strict";function checkMaxAngle(e,t,a,r,n){if(void 0===t.segment)return!0;for(var i=t,s=t.segment+1,f=0;f>-a/2;){if(--s<0)return!1;f-=e[s].dist(i),i=e[s]}f+=e[s].dist(e[s+1]),s++;for(var l=[],o=0;f<a/2;){var u=e[s-1],c=e[s],g=e[s+1];if(!g)return!1;var h=u.angleTo(c)-c.angleTo(g);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:f,angleDelta:h}),o+=h;f-l[0].distance>r;)o-=l.shift().angleDelta;if(o>n)return!1;s++,f+=c.dist(g)}return!0}module.exports=checkMaxAngle;
},{}],338:[function(require,module,exports){
"use strict";function clipLine(n,x,y,o,e,i){for(var t=[],r=0;r<n.length;r++)for(var u=n[r],d=void 0,P=0;P<u.length-1;P++){var w=u[P],_=u[P+1];if(i)w.x<x?w=new Point(x,w.y+(_.y-w.y)*((x-w.x)/(_.x-w.x)))._round():_.x<x&&(_=new Point(x,w.y+(_.y-w.y)*((x-w.x)/(_.x-w.x)))._round()),w.y<y?w=new Point(w.x+(_.x-w.x)*((y-w.y)/(_.y-w.y)),y)._round():_.y<y&&(_=new Point(w.x+(_.x-w.x)*((y-w.y)/(_.y-w.y)),y)._round()),w.x>=o?w=new Point(o,w.y+(_.y-w.y)*((o-w.x)/(_.x-w.x)))._round():_.x>=o&&(_=new Point(o,w.y+(_.y-w.y)*((o-w.x)/(_.x-w.x)))._round()),w.y>=e?w=new Point(w.x+(_.x-w.x)*((e-w.y)/(_.y-w.y)),e)._round():_.y>=e&&(_=new Point(w.x+(_.x-w.x)*((e-w.y)/(_.y-w.y)),e)._round());else{if(w.x<x&&_.x<x)continue;if(w.x<x?w=new Point(x,w.y+(_.y-w.y)*((x-w.x)/(_.x-w.x)))._round():_.x<x&&(_=new Point(x,w.y+(_.y-w.y)*((x-w.x)/(_.x-w.x)))._round()),w.y<y&&_.y<y)continue;if(w.y<y?w=new Point(w.x+(_.x-w.x)*((y-w.y)/(_.y-w.y)),y)._round():_.y<y&&(_=new Point(w.x+(_.x-w.x)*((y-w.y)/(_.y-w.y)),y)._round()),w.x>=o&&_.x>=o)continue;if(w.x>=o?w=new Point(o,w.y+(_.y-w.y)*((o-w.x)/(_.x-w.x)))._round():_.x>=o&&(_=new Point(o,w.y+(_.y-w.y)*((o-w.x)/(_.x-w.x)))._round()),w.y>=e&&_.y>=e)continue;w.y>=e?w=new Point(w.x+(_.x-w.x)*((e-w.y)/(_.y-w.y)),e)._round():_.y>=e&&(_=new Point(w.x+(_.x-w.x)*((e-w.y)/(_.y-w.y)),e)._round())}d&&w.equals(d[d.length-1])||(d=[w],t.push(d)),d.push(_)}return t}var Point=require("point-geometry");module.exports=clipLine;
},{"point-geometry":154}],339:[function(require,module,exports){
"use strict";var createStructArrayType=require("../util/struct_array"),Point=require("point-geometry"),CollisionBoxArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(CollisionBoxArray.prototype.StructType.prototype,"anchorPoint",{get:function(){return new Point(this.anchorPointX,this.anchorPointY)}}),module.exports=CollisionBoxArray;
},{"../util/struct_array":396,"point-geometry":154}],340:[function(require,module,exports){
"use strict";var CollisionFeature=function(t,e,i,o,s,a,n,r,l,d,u){var h=n.top*r-l,x=n.bottom*r+l,f=n.left*r-l,m=n.right*r+l;if(this.boxStartIndex=t.length,d){var _=x-h,b=m-f;if(_>0)if(_=Math.max(10*r,_),u){var v=e[i.segment+1].sub(e[i.segment])._unit()._mult(b),c=[i.sub(v),i.add(v)];this._addLineCollisionBoxes(t,c,i,0,b,_,o,s,a)}else this._addLineCollisionBoxes(t,e,i,i.segment,b,_,o,s,a)}else t.emplaceBack(i.x,i.y,f,h,m,x,1/0,o,s,a,0,0,0,0,0);this.boxEndIndex=t.length};CollisionFeature.prototype._addLineCollisionBoxes=function(t,e,i,o,s,a,n,r,l){var d=a/2,u=Math.floor(s/d),h=-a/2,x=this.boxes,f=i,m=o+1,_=h;do{if(--m<0)return x;_-=e[m].dist(f),f=e[m]}while(_>-s/2);for(var b=e[m].dist(e[m+1]),v=0;v<u;v++){for(var c=-s/2+v*d;_+b<c;){if(_+=b,++m+1>=e.length)return x;b=e[m].dist(e[m+1])}var g=c-_,p=e[m],C=e[m+1],B=C.sub(p)._unit()._mult(g)._add(p)._round(),M=Math.max(Math.abs(c-h)-d/2,0),y=s/2/M;t.emplaceBack(B.x,B.y,-a/2,-a/2,a/2,a/2,y,n,r,l,0,0,0,0,0)}return x},module.exports=CollisionFeature;
},{}],341:[function(require,module,exports){
"use strict";var Point=require("point-geometry"),EXTENT=require("../data/extent"),Grid=require("grid-index"),intersectionTests=require("../util/intersection_tests"),CollisionTile=function(t,e,i){if("object"==typeof t){var r=t;i=e,t=r.angle,e=r.pitch,this.grid=new Grid(r.grid),this.ignoredGrid=new Grid(r.ignoredGrid)}else this.grid=new Grid(EXTENT,12,6),this.ignoredGrid=new Grid(EXTENT,12,0);this.minScale=.5,this.maxScale=2,this.angle=t,this.pitch=e;var a=Math.sin(t),o=Math.cos(t);if(this.rotationMatrix=[o,-a,a,o],this.reverseRotationMatrix=[o,a,-a,o],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=i,0===i.length){i.emplaceBack();i.emplaceBack(0,0,0,-32767,0,32767,32767,0,0,0,0,0,0,0,0,0),i.emplaceBack(EXTENT,0,0,-32767,0,32767,32767,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,0,-32767,0,32767,0,32767,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,EXTENT,-32767,0,32767,0,32767,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=i.get(0),this.edges=[i.get(1),i.get(2),i.get(3),i.get(4)]};CollisionTile.prototype.serialize=function(t){var e=this.grid.toArrayBuffer(),i=this.ignoredGrid.toArrayBuffer();return t&&(t.push(e),t.push(i)),{angle:this.angle,pitch:this.pitch,grid:e,ignoredGrid:i}},CollisionTile.prototype.placeCollisionFeature=function(t,e,i){for(var r=this,a=this.collisionBoxArray,o=this.minScale,n=this.rotationMatrix,l=this.yStretch,h=t.boxStartIndex;h<t.boxEndIndex;h++){var s=a.get(h),x=s.anchorPoint._matMult(n),c=x.x,g=x.y,y=c+s.x1,d=g+s.y1*l,m=c+s.x2,u=g+s.y2*l;if(s.bbox0=y,s.bbox1=d,s.bbox2=m,s.bbox3=u,!e)for(var p=r.grid.query(y,d,m,u),M=0;M<p.length;M++){var f=a.get(p[M]),v=f.anchorPoint._matMult(n);if((o=r.getPlacementScale(o,x,s,v,f))>=r.maxScale)return o}if(i){var S=void 0;if(r.angle){var P=r.reverseRotationMatrix,b=new Point(s.x1,s.y1).matMult(P),T=new Point(s.x2,s.y1).matMult(P),w=new Point(s.x1,s.y2).matMult(P),N=new Point(s.x2,s.y2).matMult(P);S=r.tempCollisionBox,S.anchorPointX=s.anchorPoint.x,S.anchorPointY=s.anchorPoint.y,S.x1=Math.min(b.x,T.x,w.x,N.x),S.y1=Math.min(b.y,T.x,w.x,N.x),S.x2=Math.max(b.x,T.x,w.x,N.x),S.y2=Math.max(b.y,T.x,w.x,N.x),S.maxScale=s.maxScale}else S=s;for(var B=0;B<this.edges.length;B++){var G=r.edges[B];if((o=r.getPlacementScale(o,s.anchorPoint,S,G.anchorPoint,G))>=r.maxScale)return o}}}return o},CollisionTile.prototype.queryRenderedSymbols=function(t,e){var i={},r=[];if(0===t.length||0===this.grid.length&&0===this.ignoredGrid.length)return r;for(var a=this.collisionBoxArray,o=this.rotationMatrix,n=this.yStretch,l=[],h=1/0,s=1/0,x=-(1/0),c=-(1/0),g=0;g<t.length;g++)for(var y=t[g],d=0;d<y.length;d++){var m=y[d].matMult(o);h=Math.min(h,m.x),s=Math.min(s,m.y),x=Math.max(x,m.x),c=Math.max(c,m.y),l.push(m)}for(var u=this.grid.query(h,s,x,c),p=this.ignoredGrid.query(h,s,x,c),M=0;M<p.length;M++)u.push(p[M]);for(var f=Math.pow(2,Math.ceil(Math.log(e)/Math.LN2*10)/10),v=0;v<u.length;v++){var S=a.get(u[v]),P=S.sourceLayerIndex,b=S.featureIndex;if(void 0===i[P]&&(i[P]={}),!i[P][b]&&!(f<S.placementScale||f>S.maxScale)){var T=S.anchorPoint.matMult(o),w=T.x+S.x1/e,N=T.y+S.y1/e*n,B=T.x+S.x2/e,G=T.y+S.y2/e*n,E=[new Point(w,N),new Point(B,N),new Point(B,G),new Point(w,G)];intersectionTests.polygonIntersectsPolygon(l,E)&&(i[P][b]=!0,r.push(u[v]))}}return r},CollisionTile.prototype.getPlacementScale=function(t,e,i,r,a){var o=e.x-r.x,n=e.y-r.y,l=(a.x1-i.x2)/o,h=(a.x2-i.x1)/o,s=(a.y1-i.y2)*this.yStretch/n,x=(a.y2-i.y1)*this.yStretch/n;(isNaN(l)||isNaN(h))&&(l=h=1),(isNaN(s)||isNaN(x))&&(s=x=1);var c=Math.min(Math.max(l,h),Math.max(s,x)),g=a.maxScale,y=i.maxScale;return c>g&&(c=g),c>y&&(c=y),c>t&&c>=a.placementScale&&(t=c),t},CollisionTile.prototype.insertCollisionFeature=function(t,e,i){for(var r=this,a=i?this.ignoredGrid:this.grid,o=this.collisionBoxArray,n=t.boxStartIndex;n<t.boxEndIndex;n++){var l=o.get(n);l.placementScale=e,e<r.maxScale&&a.insert(n,l.bbox0,l.bbox1,l.bbox2,l.bbox3)}},module.exports=CollisionTile;
},{"../data/extent":217,"../util/intersection_tests":387,"grid-index":136,"point-geometry":154}],342:[function(require,module,exports){
"use strict";function getAnchors(e,r,n,t,a,o,l,h,c,i){var u=t?.6*o*l:0,s=Math.max(t?t.right-t.left:0,a?a.right-a.left:0),g=0===e[0].x||e[0].x===c||0===e[0].y||e[0].y===c;r-s*l<r/4&&(r=s*l+r/4);var p=2*o;return resample(e,g?r/2*h%r:(s/2+p)*l*h%r,r,u,n,s*l,g,!1,c,i)}function resample(e,r,n,t,a,o,l,h,c,i){for(var u=o/2,s=0,g=0;g<e.length-1;g++)s+=e[g].dist(e[g+1]);for(var p=0,x=r-n,f=[],v=0;v<e.length-1;v++){for(var A=e[v],m=e[v+1],d=A.dist(m),y=m.angleTo(A);x+n<p+d;){x+=n;var k=(x-p)/d,M=interpolate(A.x,m.x,k),_=interpolate(A.y,m.y,k);if(!i&&M>=0&&M<c&&_>=0&&_<c&&x-u>=0&&x+u<=s){var q=new Anchor(M,_,y,v)._round();t&&!checkMaxAngle(e,q,o,t,a)||f.push(q)}if(i&&M>=0&&M<c&&_>=0&&_<c){var w=new Anchor(M,_,y,v)._round();t&&!checkMaxAngle(e,w,o,t,a)||f.push(w)}}p+=d}return h||f.length||l||(f=resample(e,p/2,n,t,a,o,l,!0,c,i)),f}var interpolate=require("../util/interpolate"),Anchor=require("../symbol/anchor"),checkMaxAngle=require("./check_max_angle");module.exports=getAnchors;
},{"../symbol/anchor":336,"../util/interpolate":386,"./check_max_angle":337}],343:[function(require,module,exports){
"use strict";var ShelfPack=require("@minemap/shelf-pack"),util=require("../util/util"),SIZE_GROWTH_RATE=4,DEFAULT_SIZE=128,MAX_SIZE=2048,GlyphAtlas=function(){this.width=DEFAULT_SIZE,this.height=DEFAULT_SIZE,this.atlas=new ShelfPack(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};GlyphAtlas.prototype.getGlyphs=function(){var t,i,e,h=this,r={};for(var s in h.ids)t=s.split("#"),i=t[0],e=t[1],r[i]||(r[i]=[]),r[i].push(e);return r},GlyphAtlas.prototype.getRects=function(){var t,i,e,h=this,r={};for(var s in h.ids)t=s.split("#"),i=t[0],e=t[1],r[i]||(r[i]={}),r[i][e]=h.index[s];return r},GlyphAtlas.prototype.addGlyph=function(t,i,e,h){var r=this;if(!e)return null;var s=i+"#"+e.id;if(this.index[s])return this.ids[s].indexOf(t)<0&&this.ids[s].push(t),this.index[s];if(!e.bitmap)return null;var a=e.width+2*h,n=e.height+2*h,E=a+2,l=n+2;E+=4-E%4,l+=4-l%4;var T=this.atlas.packOne(E,l);if(T||(this.resize(),T=this.atlas.packOne(E,l)),!T)return util.warnOnce("glyph bitmap overflow"),null;this.index[s]=T,this.ids[s]=[t];for(var u=this.data,d=e.bitmap,p=0;p<n;p++)for(var A=r.width*(T.y+p+1)+T.x+1,_=a*p,o=0;o<a;o++)u[A+o]=d[_+o];return this.dirty=!0,T},GlyphAtlas.prototype.resize=function(){var t=this,i=this.width,e=this.height;if(!(i>=MAX_SIZE||e>=MAX_SIZE)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=SIZE_GROWTH_RATE,this.height*=SIZE_GROWTH_RATE,this.atlas.resize(this.width,this.height);for(var h=new ArrayBuffer(this.width*this.height),r=0;r<e;r++){var s=new Uint8Array(t.data.buffer,e*r,i);new Uint8Array(h,e*r*SIZE_GROWTH_RATE,i).set(s)}this.data=new Uint8Array(h)}},GlyphAtlas.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},GlyphAtlas.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},module.exports=GlyphAtlas;
},{"../util/util":399,"@minemap/shelf-pack":3}],344:[function(require,module,exports){
"use strict";function glyphUrl(t,e,a,i){return i=i||"abc",a.replace("{s}",i[t.length%i.length]).replace("{fontstack}",t).replace("{range}",e)}var normalizeURL=require("../util/minemap").normalizeGlyphsURL,ajax=require("../util/ajax"),verticalizePunctuation=require("../util/verticalize_punctuation"),Glyphs=require("../util/glyphs"),GlyphAtlas=require("../symbol/glyph_atlas"),Protobuf=require("pbf"),SimpleGlyph=function(t,e,a){this.advance=t.advance,this.left=t.left-a-1,this.top=t.top+a+1,this.rect=e},GlyphSource=function(t){this.url=t&&normalizeURL(t),this.atlases={},this.stacks={},this.loading={}};GlyphSource.prototype.getSimpleGlyphs=function(t,e,a,i){var l=this;void 0===this.stacks[t]&&(this.stacks[t]={}),void 0===this.atlases[t]&&(this.atlases[t]=new GlyphAtlas);for(var r={},s=this.stacks[t],o=this.atlases[t],n={},h=0,p=function(e){var i=Math.floor(e/256);if(s[i]){var l=s[i].glyphs[e],p=o.addGlyph(a,t,l,3);l&&(r[e]=new SimpleGlyph(l,p,3))}else void 0===n[i]&&(n[i]=[],h++),n[i].push(e)},u=0;u<e.length;u++){var c=e[u],y=String.fromCharCode(c);p(c),verticalizePunctuation.lookup[y]&&p(verticalizePunctuation.lookup[y].charCodeAt(0))}h||i(void 0,r,t);var f=function(e,s,p){if(!e)for(var u=l.stacks[t][s]=p.stacks[0],c=0;c<n[s].length;c++){var y=n[s][c],f=u.glyphs[y],v=o.addGlyph(a,t,f,3);f&&(r[y]=new SimpleGlyph(f,v,3))}--h||i(void 0,r,t)};for(var v in n)l.loadRange(t,v,f)},GlyphSource.prototype.loadRange=function(t,e,a){if(256*e>65535)return a("glyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var i=this.loading[t];if(i[e])i[e].push(a);else{i[e]=[a];var l=256*e+"-"+(256*e+255),r=glyphUrl(t,l,this.url);ajax.getArrayBuffer(r,function(t,a){for(var l=!t&&new Glyphs(new Protobuf(a.data)),r=0;r<i[e].length;r++)i[e][r](t,e,l);delete i[e]})}},GlyphSource.prototype.getGlyphAtlas=function(t){return this.atlases[t]},module.exports=GlyphSource;
},{"../symbol/glyph_atlas":343,"../util/ajax":370,"../util/glyphs":385,"../util/minemap":390,"../util/verticalize_punctuation":401,"pbf":153}],345:[function(require,module,exports){
"use strict";module.exports=function(e){function t(t){g.push(e[t]),l++}function r(e,t,r){var n=u[e];return delete u[e],u[t]=n,g[n].geometry[0].pop(),g[n].geometry[0]=g[n].geometry[0].concat(r[0]),n}function n(e,t,r){var n=i[t];return delete i[t],i[e]=n,g[n].geometry[0].shift(),g[n].geometry[0]=r[0].concat(g[n].geometry[0]),n}function o(e,t,r){var n=r?t[0][t[0].length-1]:t[0][0];return e+":"+n.x+":"+n.y}for(var i={},u={},g=[],l=0,m=0;m<e.length;m++){var y=e[m],c=y.geometry,f=y.text;if(f){var a=o(f,c),s=o(f,c,!0);if(a in u&&s in i&&u[a]!==i[s]){var v=n(a,s,c),d=r(a,s,g[v].geometry);delete i[a],delete u[s],u[o(f,g[d].geometry,!0)]=d,g[v].geometry=null}else a in u?r(a,s,c):s in i?n(a,s,c):(t(m),i[a]=l-1,u[s]=l-1)}else t(m)}return g.filter(function(e){return e.geometry})};
},{}],346:[function(require,module,exports){
"use strict";function SymbolQuad(t,e,a,n,i,o,l,h,r,s,g,u){this.anchorPoint=t,this.tl=e,this.tr=a,this.bl=n,this.br=i,this.tex=o,this.anchorAngle=l,this.glyphAngle=h,this.minScale=r,this.maxScale=s,this.seq=g,this.writingMode=u}function getIconQuads(t,e,a,n,i,o,l,h,r){var s,g,u,c,m=e.image.rect,f=i.layout,d=e.left-1,x=d+m.w/e.image.pixelRatio,P=e.top-1,y=P+m.h/e.image.pixelRatio;if("none"!==f["icon-text-fit"]&&l){var M=x-d,p=y-P,v=f["text-size"]/24,w=l.left*v,S=l.right*v,b=l.top*v,I=l.bottom*v,_=S-w,Q=I-b,G=f["icon-text-fit-padding"][0],q=f["icon-text-fit-padding"][1],k=f["icon-text-fit-padding"][2],A=f["icon-text-fit-padding"][3],R="width"===f["icon-text-fit"]?.5*(Q-p):0,z="height"===f["icon-text-fit"]?.5*(_-M):0,L="width"===f["icon-text-fit"]||"both"===f["icon-text-fit"]?_:M,V="height"===f["icon-text-fit"]||"both"===f["icon-text-fit"]?Q:p;s=new Point(w+z-A,b+R-G),g=new Point(w+z+q+L,b+R-G),u=new Point(w+z+q+L,b+R+k+V),c=new Point(w+z-A,b+R+k+V)}else s=new Point(d,P),g=new Point(x,P),u=new Point(x,y),c=new Point(d,y);var j=i.getLayoutValue("icon-rotate",h,r)*Math.PI/180;if(o){var B=n[t.segment];if(t.y===B.y&&t.x===B.x&&t.segment+1<n.length){var C=n[t.segment+1];j+=Math.atan2(t.y-C.y,t.x-C.x)+Math.PI}else j+=Math.atan2(t.y-B.y,t.x-B.x)}if(j){var D=Math.sin(j),E=Math.cos(j),F=[E,-D,D,E];s=s.matMult(F),g=g.matMult(F),c=c.matMult(F),u=u.matMult(F)}return[new SymbolQuad(new Point(t.x,t.y),s,g,c,u,e.image.rect,0,0,minScale,1/0,1)]}function getGlyphQuads(t,e,a,n,i,o){for(var l=i.layout["text-rotate"]*Math.PI/180,h=i.layout["text-keep-upright"],r=e.positionedGlyphs,s=[],g=0;g<r.length;g++){var u=r[g],c=u.glyph;if(c){var m=c.rect;if(m){var f=(u.x+c.advance/2)*a,d=void 0,x=minScale;o?(d=[],x=getSegmentGlyphs(d,t,f,n,t.segment,!0),h&&(x=Math.min(x,getSegmentGlyphs(d,t,f,n,t.segment,!1)))):d=[{anchorPoint:new Point(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:minScale}];var P=u.x+c.left,y=u.y-c.top,M=P+m.w,p=y+m.h,v=new Point(u.x,c.advance/2),w=new Point(P,y),S=new Point(M,y),b=new Point(P,p),I=new Point(M,p);0!==u.angle&&(w._sub(v)._rotate(u.angle)._add(v),S._sub(v)._rotate(u.angle)._add(v),b._sub(v)._rotate(u.angle)._add(v),I._sub(v)._rotate(u.angle)._add(v));for(var _=0;_<d.length;_++){var Q=d[_],G=w,q=S,k=b,A=I;if(l){var R=Math.sin(l),z=Math.cos(l),L=[z,-R,R,z];G=G.matMult(L),q=q.matMult(L),k=k.matMult(L),A=A.matMult(L)}var V=Math.max(Q.minScale,x),j=(t.angle+Q.offset+2*Math.PI)%(2*Math.PI),B=(Q.angle+Q.offset+2*Math.PI)%(2*Math.PI);s.push(new SymbolQuad(Q.anchorPoint,G,q,k,A,m,j,B,V,Q.maxScale,1,e.writingMode))}}}}return s}function getSegmentGlyphs(t,e,a,n,i,o){var l=!o;a<0&&(o=!o),o&&i++;var h=new Point(e.x,e.y),r=n[i],s=1/0;a=Math.abs(a);for(var g=minScale;;){var u=h.dist(r),c=a/u,m=Math.atan2(r.y-h.y,r.x-h.x);if(o||(m+=Math.PI),t.push({anchorPoint:h,offset:l?Math.PI:0,minScale:c,maxScale:s,angle:(m+2*Math.PI)%(2*Math.PI)}),c<=g)break;for(h=r;h.equals(r);)if(i+=o?1:-1,!(r=n[i]))return c;var f=r.sub(h)._unit();h=h.sub(f._mult(u)),s=c}return g}var Point=require("point-geometry");module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};var minScale=.5;
},{"point-geometry":154}],347:[function(require,module,exports){
"use strict";var resolveTokens=require("../util/token");module.exports=function(e,t,o){var r=e.getLayoutValue("text-field",t,o);if(e.isLayoutValueFeatureConstant("text-field")&&(r=resolveTokens(o,r)),r){r=r.toString();var a=e.getLayoutValue("text-transform",t,o);return"uppercase"===a?r=r.toLocaleUpperCase():"lowercase"===a&&(r=r.toLocaleLowerCase()),r}};
},{"../util/token":398}],348:[function(require,module,exports){
"use strict";function PositionedGlyph(e,t,i,n,r){this.codePoint=e,this.x=t,this.y=i,this.glyph=n||null,this.angle=r}function Shaping(e,t,i,n,r,a,o){this.positionedGlyphs=e,this.text=t,this.top=i,this.bottom=n,this.left=r,this.right=a,this.writingMode=o}function breakLines(e,t){for(var i=[],n=0,r=0,a=t;r<a.length;r+=1){var o=a[r];i.push(e.substring(n,o)),n=o}return n<e.length&&i.push(e.substring(n,e.length)),i}function shapeText(e,t,i,n,r,a,o,s,h,l,c){var u=e.trim();c===WritingMode.vertical&&(u=verticalizePunctuation(u));var d,g=[],p=new Shaping(g,u,h[1],h[1],h[0],h[0],c);return d=rtlTextPlugin.processBidirectionalText?rtlTextPlugin.processBidirectionalText(u,determineLineBreaks(u,s,i,t)):breakLines(u,determineLineBreaks(u,s,i,t)),shapeLines(p,t,d,n,r,a,o,h,c,s,l),!!g.length&&p}function determineAverageLineWidth(e,t,i,n){var r=0;for(var a in e){var o=n[e.charCodeAt(a)];o&&(r+=o.advance+t)}return r/Math.max(1,Math.ceil(r/i))}function calculateBadness(e,t,i,n){var r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function calculatePenalty(e,t){var i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function evaluateBreak(e,t,i,n,r,a){for(var o=null,s=calculateBadness(t,i,r,a),h=0,l=n;h<l.length;h+=1){var c=l[h],u=t-c.x,d=calculateBadness(u,i,r,a)+c.badness;d<=s&&(o=c,s=d)}return{index:e,x:t,priorBreak:o,badness:s}}function leastBadBreaks(e){return e?leastBadBreaks(e.priorBreak).concat(e.index):[]}function determineLineBreaks(e,t,i,n){if(!i)return[];if(!e)return[];for(var r=[],a=determineAverageLineWidth(e,t,i,n),o=0,s=0;s<e.length;s++){var h=e.charCodeAt(s),l=n[h];l&&!whitespace[h]&&(o+=l.advance+t),s<e.length-1&&(breakable[h]||scriptDetection.charAllowsIdeographicBreaking(h))&&r.push(evaluateBreak(s+1,o,a,r,calculatePenalty(h,e.charCodeAt(s+1)),!1))}return leastBadBreaks(evaluateBreak(e.length,o,a,r,0,!0))}function shapeLines(e,t,i,n,r,a,o,s,h,l,c){var u=0,d=-17,g=0,p=e.positionedGlyphs;for(var v in i){var f=i[v].trim();if(f.length){for(var x=p.length,B=0;B<f.length;B++){var k=f.charCodeAt(B),P=t[k];P&&(scriptDetection.charHasUprightVerticalOrientation(k)&&h!==WritingMode.horizontal?(p.push(new PositionedGlyph(k,u,0,P,-Math.PI/2)),u+=c+l):(p.push(new PositionedGlyph(k,u,d,P,0)),u+=P.advance+l))}if(p.length!==x){var b=u-l;g=Math.max(b,g),justifyLine(p,t,x,p.length-1,o)}u=0,d+=n}else d+=n}align(p,o,r,a,g,n,i.length,s);var m=i.length*n;e.top+=-a*m,e.bottom=e.top+m,e.left+=-r*g,e.right=e.left+g}function justifyLine(e,t,i,n,r){if(r)for(var a=t[e[n].codePoint].advance,o=(e[n].x+a)*r,s=i;s<=n;s++)e[s].x-=o}function align(e,t,i,n,r,a,o,s){for(var h=(t-i)*r+s[0],l=(-n*o+.5)*a+s[1],c=0;c<e.length;c++)e[c].x+=h,e[c].y+=l}function shapeIcon(e,t){if(!e||!e.rect)return null;var i=t[0],n=t[1],r=i-e.width/2,a=r+e.width,o=n-e.height/2;return new PositionedIcon(e,o,o+e.height,r,a)}function PositionedIcon(e,t,i,n,r){this.image=e,this.top=t,this.bottom=i,this.left=n,this.right=r}var scriptDetection=require("../util/script_detection"),verticalizePunctuation=require("../util/verticalize_punctuation"),rtlTextPlugin=require("../source/rtl_text_plugin"),WritingMode={horizontal:1,vertical:2};module.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:WritingMode};var whitespace={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},breakable={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};
},{"../source/rtl_text_plugin":262,"../util/script_detection":394,"../util/verticalize_punctuation":401}],349:[function(require,module,exports){
"use strict";function copyBitmap(t,i,e,r,a,h,s,o,n,l,p){var f,u,d=r*i+e,g=o*h+s;if(p)for(g-=h,u=-1;u<=l;u++,g+=h)for(d=((u+l)%l+r)*i+e,f=-1;f<=n;f++)a[g+f]=t[d+(f+n)%n];else for(u=0;u<l;u++,d+=i,g+=h)for(f=0;f<n;f++)a[g+f]=t[d+f]}var ShelfPack=require("@minemap/shelf-pack"),browser=require("../util/browser"),util=require("../util/util"),window=require("../util/window"),Evented=require("../util/evented"),SpriteAtlas=function(t){function i(i,e){t.call(this),this.width=i,this.height=e,this.shelfPack=new ShelfPack(i,e),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.allocateImage=function(t,i){t/=this.pixelRatio,i/=this.pixelRatio;var e=t+2+(4-(t+2)%4),r=i+2+(4-(i+2)%4),a=this.shelfPack.packOne(e,r);return a?a:(util.warnOnce("SpriteAtlas out of space."),null)},i.prototype.addImage=function(t,i,e){var r,a,h;if(i instanceof window.HTMLImageElement?(r=i.width,a=i.height,i=browser.getImageData(i),h=this.pixelRatio):(r=e.width,a=e.height,h=e.pixelRatio||this.pixelRatio),ArrayBuffer.isView(i)&&(i=new Uint32Array(i.buffer)),!(i instanceof Uint32Array))return this.fire("error",{error:new Error("Image provided in an invalid format. Supported formats are HTMLImageElement, ImageData, and ArrayBufferView.")});if(this.images[t])return this.fire("error",{error:new Error("An image with this name already exists.")});var s=this.allocateImage(r,a);if(!s)return this.fire("error",{error:new Error("There is not enough space to add this image.")});var o={rect:s,width:r/h,height:a/h,sdf:!1,pixelRatio:1};this.images[t]=o,this.copy(i,r,s,{pixelRatio:h,x:0,y:0,width:r,height:a},!1),this.fire("data",{dataType:"style"})},i.prototype.removeImage=function(t){var i=this.images[t];if(delete this.images[t],!i)return this.fire("error",{error:new Error("No image with this name exists.")});this.shelfPack.unref(i.rect),this.fire("data",{dataType:"style"})},i.prototype.getImage=function(t,i){if(this.images[t])return this.images[t];if(!this.sprite)return null;var e=this.sprite.getSpritePosition(t);if(!e.width||!e.height)return null;var r=this.allocateImage(e.width,e.height);if(!r)return null;var a={rect:r,width:e.width/e.pixelRatio,height:e.height/e.pixelRatio,sdf:e.sdf,pixelRatio:e.pixelRatio/this.pixelRatio};if(this.images[t]=a,!this.sprite.imgData)return null;var h=new Uint32Array(this.sprite.imgData.buffer);return this.copy(h,this.sprite.width,r,e,i),a},i.prototype.getPosition=function(t,i){var e=this.getImage(t,i),r=e&&e.rect;if(!r)return null;var a=e.width*e.pixelRatio,h=e.height*e.pixelRatio;return{size:[e.width,e.height],tl:[(r.x+1)/this.width,(r.y+1)/this.height],br:[(r.x+1+a)/this.width,(r.y+1+h)/this.height]}},i.prototype.allocate=function(){var t=this;if(!this.data){var i=Math.floor(this.width*this.pixelRatio),e=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(i*e);for(var r=0;r<this.data.length;r++)t.data[r]=0}},i.prototype.copy=function(t,i,e,r,a){this.allocate();var h=this.data;copyBitmap(t,i,r.x,r.y,h,this.width*this.pixelRatio,(e.x+1)*this.pixelRatio,(e.y+1)*this.pixelRatio,r.width,r.height,a),this.dirty=!0},i.prototype.setSprite=function(t){t&&(this.pixelRatio=browser.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=t},i.prototype.addIcons=function(t,i){for(var e=this,r=0;r<t.length;r++)e.getImage(t[r]);i(null,this.images)},i.prototype.bind=function(t,i){var e=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e=!0);var r=i?t.LINEAR:t.NEAREST;r!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),this.filter=r),this.dirty&&(this.allocate(),e?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},i}(Evented);module.exports=SpriteAtlas;
},{"../util/browser":372,"../util/evented":381,"../util/util":399,"../util/window":374,"@minemap/shelf-pack":3}],350:[function(require,module,exports){
"use strict";var DOM=require("../util/dom"),Point=require("point-geometry"),handlers={scrollZoom:require("./handler/scroll_zoom"),boxZoom:require("./handler/box_zoom"),dragRotate:require("./handler/drag_rotate"),dragPan:require("./handler/drag_pan"),keyboard:require("./handler/keyboard"),doubleClickZoom:require("./handler/dblclick_zoom"),touchZoomRotate:require("./handler/touch_zoom_rotate")};module.exports=function(e,t){function n(e){h("mouseout",e)}function o(t){e.stop(),L=DOM.mousePos(g,t),h("mousedown",t),E=!0}function r(t){var n=e.dragRotate&&e.dragRotate.isActive();p&&!n&&h("contextmenu",p),p=null,E=!1,h("mouseup",t)}function u(t){if(!(e.dragPan&&e.dragPan.isActive()||e.dragRotate&&e.dragRotate.isActive())){for(var n=t.toElement||t.target;n&&n!==g;)n=n.parentNode;n===g&&h("mousemove",t)}}function a(t){e.stop(),f("touchstart",t),!t.touches||t.touches.length>1||(b?(clearTimeout(b),b=null,h("dblclick",t)):b=setTimeout(l,300))}function i(e){f("touchmove",e)}function c(e){f("touchend",e)}function d(e){f("touchcancel",e)}function l(){b=null}function s(e){DOM.mousePos(g,e).equals(L)&&h("click",e)}function v(e){h("dblclick",e),e.preventDefault()}function m(t){var n=e.dragRotate&&e.dragRotate.isActive();E||n?E&&(p=t):h("contextmenu",t),t.preventDefault()}function h(t,n){var o=DOM.mousePos(g,n);return e.fire(t,{lngLat:e.unproject(o),point:o,originalEvent:n})}function f(t,n){var o=DOM.touchPos(g,n),r=o.reduce(function(e,t,n,o){return e.add(t.div(o.length))},new Point(0,0));return e.fire(t,{lngLat:e.unproject(r),point:r,lngLats:o.map(function(t){return e.unproject(t)},this),points:o,originalEvent:n})}var g=e.getCanvasContainer(),p=null,E=!1,L=null,b=null;for(var q in handlers)e[q]=new handlers[q](e,t),t.interactive&&t[q]&&e[q].enable(t[q]);g.addEventListener("mouseout",n,!1),g.addEventListener("mousedown",o,!1),g.addEventListener("mouseup",r,!1),g.addEventListener("mousemove",u,!1),g.addEventListener("touchstart",a,!1),g.addEventListener("touchend",c,!1),g.addEventListener("touchmove",i,!1),g.addEventListener("touchcancel",d,!1),g.addEventListener("click",s,!1),g.addEventListener("dblclick",v,!1),g.addEventListener("contextmenu",m,!1)};
},{"../util/dom":379,"./handler/box_zoom":358,"./handler/dblclick_zoom":359,"./handler/drag_pan":360,"./handler/drag_rotate":361,"./handler/keyboard":362,"./handler/scroll_zoom":363,"./handler/touch_zoom_rotate":364,"point-geometry":154}],351:[function(require,module,exports){
"use strict";var util=require("../util/util"),interpolate=require("../util/interpolate"),browser=require("../util/browser"),LngLat=require("../geo/lng_lat"),LngLatBounds=require("../geo/lng_lat_bounds"),Point=require("point-geometry"),Evented=require("../util/evented"),Camera=function(t){function i(i,e){t.call(this),this.moving=!1,this.transform=i,this._bearingSnap=e.bearingSnap}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getCenter=function(){return this.transform.center},i.prototype.setCenter=function(t,i){return this.jumpTo({center:t},i),this},i.prototype._lngLat2Mercator=function(t){var i=[],e=20037508.34*t[0]/180,o=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return o=20037508.34*o/180,i.push(e),i.push(o),i},i.prototype._mercator2LngLat=function(t){var i=[],e=t[0]/20037508.34*180,o=t[1]/20037508.34*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i.push(e),i.push(o),i},i.prototype.panBy=function(t,i,e){if(i&&i.units){var o,n=this.transform.center.toArray(),r=this._lngLat2Mercator(n);o="kilometers"===i.units?[r[0]+1e3*t[0],r[1]+1e3*t[1]]:[r[0]+t[0],r[1]+t[1]];var a=this._mercator2LngLat(o);this.panTo(LngLat.convert(a),i,e)}else this.panTo(this.transform.center,util.extend({offset:Point.convert(t).mult(-1)},i),e);return this},i.prototype.panTo=function(t,i,e){return this.easeTo(util.extend({center:t},i),e)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,i){return this.jumpTo({zoom:t},i),this},i.prototype.zoomTo=function(t,i,e){return this.easeTo(util.extend({zoom:t},i),e)},i.prototype.zoomIn=function(t,i){return this.zoomTo(this.getZoom()+1,t,i),this},i.prototype.zoomOut=function(t,i){return this.zoomTo(this.getZoom()-1,t,i),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,i){return this.jumpTo({bearing:t},i),this},i.prototype.rotateTo=function(t,i,e){return this.easeTo(util.extend({bearing:t},i),e)},i.prototype.resetNorth=function(t,i){return this.rotateTo(0,util.extend({duration:1e3},t),i),this},i.prototype.snapToNorth=function(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,i){return this.jumpTo({pitch:t},i),this},i.prototype.fitBounds=function(t,i,e){if(i=util.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i),"number"==typeof i.padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}if(!util.deepEqual(Object.keys(i.padding).sort(function(t,i){return t<i?-1:t>i?1:0}),["bottom","left","right","top"]))return void util.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");t=LngLatBounds.convert(t);var n=[i.padding.left-i.padding.right,i.padding.top-i.padding.bottom],r=Math.min(i.padding.right,i.padding.left),a=Math.min(i.padding.top,i.padding.bottom);i.offset=[i.offset[0]+n[0],i.offset[1]+n[1]];var s=Point.convert(i.offset),h=this.transform,p=h.project(t.getNorthWest()),u=h.project(t.getSouthEast()),c=u.sub(p),g=(h.width-2*r-2*Math.abs(s.x))/c.x,m=(h.height-2*a-2*Math.abs(s.y))/c.y;return m<0||g<0?void util.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."):(i.center=h.unproject(p.add(u).div(2)),i.zoom=Math.min(h.scaleZoom(h.scale*Math.min(g,m)),i.maxZoom),i.bearing=0,i.linear?this.easeTo(i,e):this.flyTo(i,e))},i.prototype.jumpTo=function(t,i){this.stop();var e=this.transform,o=!1,n=!1,r=!1;return"zoom"in t&&e.zoom!==+t.zoom&&(o=!0,e.zoom=+t.zoom),"center"in t&&(e.center=LngLat.convert(t.center)),"bearing"in t&&e.bearing!==+t.bearing&&(n=!0,e.bearing=+t.bearing),"pitch"in t&&e.pitch!==+t.pitch&&(r=!0,e.pitch=+t.pitch),this.fire("movestart",i).fire("move",i),o&&this.fire("zoomstart",i).fire("zoom",i).fire("zoomend",i),n&&this.fire("rotate",i),r&&this.fire("pitch",i),this.fire("moveend",i)},i.prototype.easeTo=function(t,i){var e=this;this.stop(),t=util.extend({offset:[0,0],duration:500,easing:util.ease},t);var o,n,r=this.transform,a=Point.convert(t.offset),s=this.getZoom(),h=this.getBearing(),p=this.getPitch(),u="zoom"in t?+t.zoom:s,c="bearing"in t?this._normalizeBearing(t.bearing,h):h,g="pitch"in t?+t.pitch:p;"center"in t?(o=LngLat.convert(t.center),n=r.centerPoint.add(a)):"around"in t?(o=LngLat.convert(t.around),n=r.locationPoint(o)):(n=r.centerPoint.add(a),o=r.pointLocation(n));var m=r.locationPoint(o);return t.animate===!1&&(t.duration=0),this.zooming=u!==s,this.rotating=h!==c,this.pitching=g!==p,t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration)),t.noMoveStart||(this.moving=!0,this.fire("movestart",i)),this.zooming&&this.fire("zoomstart",i),clearTimeout(this._onEaseEnd),this._ease(function(t){this.zooming&&(r.zoom=interpolate(s,u,t)),this.rotating&&(r.bearing=interpolate(h,c,t)),this.pitching&&(r.pitch=interpolate(p,g,t)),r.setLocationAtPoint(o,m.add(n.sub(m)._mult(t))),this.fire("move",i),this.zooming&&this.fire("zoom",i),this.rotating&&this.fire("rotate",i),this.pitching&&this.fire("pitch",i)},function(){t.delayEndEvents?e._onEaseEnd=setTimeout(e._easeToEnd.bind(e,i),t.delayEndEvents):e._easeToEnd(i)},t),this},i.prototype._easeToEnd=function(t){var i=this.zooming;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,i&&this.fire("zoomend",t),this.fire("moveend",t)},i.prototype.flyTo=function(t,i){function e(t){var i=(z*z-y*y+(t?-1:1)*E*E*M*M)/(2*(t?z:y)*E*M);return Math.log(Math.sqrt(i*i+1)-i)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return o(t)/n(t)}this.stop(),t=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},t);var a=this.transform,s=Point.convert(t.offset),h=this.getZoom(),p=this.getBearing(),u=this.getPitch(),c="center"in t?LngLat.convert(t.center):this.getCenter(),g="zoom"in t?+t.zoom:h,m="bearing"in t?this._normalizeBearing(t.bearing,p):p,f="pitch"in t?+t.pitch:u;a.renderWorldCopies&&Math.abs(a.center.lng)+Math.abs(c.lng)>180&&(a.center.lng>0&&c.lng<0?c.lng+=360:a.center.lng<0&&c.lng>0&&(c.lng-=360));var d=a.zoomScale(g-h),l=a.point,v="center"in t?a.project(c).sub(s.div(d)):l,b=t.curve,y=Math.max(a.width,a.height),z=y/d,M=v.sub(l).mag();if("minZoom"in t){var _=util.clamp(Math.min(t.minZoom,h,g),a.minZoom,a.maxZoom),T=y/a.zoomScale(_-h);b=Math.sqrt(T/M*2)}var E=b*b,L=e(0),x=function(t){return n(L)/n(L+b*t)},P=function(t){return y*((n(L)*r(L+b*t)-o(L))/E)/M},Z=(e(1)-L)/b;if(Math.abs(M)<1e-6){if(Math.abs(y-z)<1e-6)return this.easeTo(t,i);var w=z<y?-1:1;Z=Math.abs(Math.log(z/y))/b,P=function(){return 0},x=function(t){return Math.exp(w*b*t)}}if("duration"in t)t.duration=+t.duration;else{var j="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*Z/j}return this.moving=!0,this.zooming=!0,p!==m&&(this.rotating=!0),u!==f&&(this.pitching=!0),this.fire("movestart",i),this.fire("zoomstart",i),this._ease(function(t){var e=t*Z,o=P(e),n=1/x(e);a.zoom=h+a.scaleZoom(n),a.center=a.unproject(l.add(v.sub(l).mult(o)).mult(n)),a.renderWorldCopies&&(a.center=a.center.wrap()),this.rotating&&(a.bearing=interpolate(p,m,t)),this.pitching&&(a.pitch=interpolate(u,f,t)),this.fire("move",i),this.fire("zoom",i),this.rotating&&this.fire("rotate",i),this.pitching&&this.fire("pitch",i)},function(){this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",i),this.fire("moveend",i)},t),this},i.prototype.isEasing=function(){return!!this._abortFn},i.prototype.isMoving=function(){return this.moving},i.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},i.prototype._ease=function(t,i,e){this._finishFn=i,this._abortFn=browser.timed(function(i){t.call(this,e.easing(i)),1===i&&this._finishEase()},e.animate===!1?0:e.duration,this)},i.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},i.prototype._normalizeBearing=function(t,i){t=util.wrap(t,-180,180);var e=Math.abs(t-i);return Math.abs(t-360-i)<e&&(t-=360),Math.abs(t+360-i)<e&&(t+=360),t},i.prototype._smoothOutEasing=function(t){var i=util.ease;if(this._prevEase){var e=this._prevEase,o=(Date.now()-e.start)/e.duration,n=e.easing(o+.01)-e.easing(o),r=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-r*r);i=util.bezier(r,a,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:i},i},i}(Evented);module.exports=Camera;
},{"../geo/lng_lat":227,"../geo/lng_lat_bounds":228,"../util/browser":372,"../util/evented":381,"../util/interpolate":386,"../util/util":399,"point-geometry":154}],352:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),AttributionControl=function(t){this.options=t,util.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};AttributionControl.prototype.getDefaultPosition=function(){return"bottom-right"},AttributionControl.prototype.onAdd=function(t){var i=this.options&&this.options.compact;return this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-attrib"),i&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},AttributionControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},AttributionControl.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".minemap-improve-map")),this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.minedata.cn/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}},AttributionControl.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},AttributionControl.prototype._updateAttributions=function(){if(this._map.style){var t=[],i=this._map.style.sourceCaches;for(var o in i){var n=i[o].getSource();n.attribution&&t.indexOf(n.attribution)<0&&t.push(n.attribution)}t.sort(function(t,i){return t.length-i.length}),t=t.filter(function(i,o){for(var n=o+1;n<t.length;n++)if(t[n].indexOf(i)>=0)return!1;return!0}),this._container.innerHTML=t.join(" | "),this._editLink=null}},AttributionControl.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("compact")},module.exports=AttributionControl;
},{"../../util/dom":379,"../../util/util":399}],353:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),window=require("../../util/window"),FullscreenControl=function(){this._fullscreen=!1,util.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in window.document&&(this._fullscreenchange="MSFullscreenChange")};FullscreenControl.prototype.onAdd=function(e){var n=this._container=DOM.create("div","minemap-ctrl minemap-ctrl-group"),t=this._fullscreenButton=DOM.create("button","minemap-ctrl-icon minemap-ctrl-fullscreen",this._container);return t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),this._mapContainer=e.getContainer(),window.document.addEventListener(this._fullscreenchange,this._changeIcon),n},FullscreenControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},FullscreenControl.prototype._isFullscreen=function(){return this._fullscreen},FullscreenControl.prototype._changeIcon=function(e){if(e.target===this._mapContainer){this._fullscreen=!this._fullscreen;this._fullscreenButton.classList.toggle("minemap-ctrl-shrink"),this._fullscreenButton.classList.toggle("minemap-ctrl-fullscreen")}},FullscreenControl.prototype._onClickFullscreen=function(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},module.exports=FullscreenControl;
},{"../../util/dom":379,"../../util/util":399,"../../util/window":374}],354:[function(require,module,exports){
"use strict";function checkGeolocationSupport(t){void 0!==supportsGeolocation?t(supportsGeolocation):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(function(o){supportsGeolocation="denied"!==o.state,t(supportsGeolocation)}):(supportsGeolocation=!!window.navigator.geolocation,t(supportsGeolocation))}var Evented=require("../../util/evented"),DOM=require("../../util/dom"),window=require("../../util/window"),util=require("../../util/util"),defaultGeoPositionOptions={enableHighAccuracy:!1,timeout:6e3},className="minemap-ctrl",supportsGeolocation,GeolocateControl=function(t){function o(o){t.call(this),this.options=o||{},util.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div",className+" "+className+"-group"),checkGeolocationSupport(this._setupUI),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},o.prototype._onSuccess=function(t){this._map.jumpTo({center:[t.coords.longitude,t.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",t),this._finish()},o.prototype._onError=function(t){this.fire("error",t),this._finish()},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(t){t!==!1&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=DOM.create("button",className+"-icon "+className+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},o.prototype._onClickGeolocate=function(){var t=util.extend(defaultGeoPositionOptions,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)):(window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,t),this._timeoutId=setTimeout(this._finish,1e4))},o}(Evented);module.exports=GeolocateControl;
},{"../../util/dom":379,"../../util/evented":381,"../../util/util":399,"../../util/window":374}],355:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),LogoControl=function(){util.bindAll(["_updateLogo"],this)};LogoControl.prototype.onAdd=function(o){return this._map=o,this._container=DOM.create("div","minemap-ctrl"),this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},LogoControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateLogo)},LogoControl.prototype.getDefaultPosition=function(){return"bottom-left"},LogoControl.prototype._updateLogo=function(o){if(o&&"metadata"===o.sourceDataType)if(!this._container.childNodes.length&&this._logoRequired()){var t=DOM.create("a","minemap-ctrl-logo");t.target="_blank",t.href="https://www.minedata.cn/",t.setAttribute("aria-label","Minemap logo"),this._container.appendChild(t),this._map.off("data",this._updateLogo)}else this._container.childNodes.length&&!this._logoRequired()&&this.onRemove()},LogoControl.prototype._logoRequired=function(){if(this._map.style){var o=this._map.style.sourceCaches;for(var t in o){if(o[t].getSource().minemap_logo)return!0}return!1}},module.exports=LogoControl;
},{"../../util/dom":379,"../../util/util":399}],356:[function(require,module,exports){
"use strict";function copyMouseEvent(t){return new window.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var DOM=require("../../util/dom"),window=require("../../util/window"),util=require("../../util/util"),className="minemap-ctrl",NavigationControl=function(){util.bindAll(["_rotateCompassArrow"],this)};NavigationControl.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},NavigationControl.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div",className+" "+className+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(className+"-icon "+className+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(className+"-icon "+className+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(className+"-icon "+className+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=DOM.create("span",className+"-compass-arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},NavigationControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},NavigationControl.prototype._onContextMenu=function(t){t.preventDefault()},NavigationControl.prototype._onCompassDown=function(t){0===t.button&&(DOM.disableDrag(),window.document.addEventListener("mousemove",this._onCompassMove),window.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._onCompassUp=function(t){0===t.button&&(window.document.removeEventListener("mousemove",this._onCompassMove),window.document.removeEventListener("mouseup",this._onCompassUp),DOM.enableDrag(),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._createButton=function(t,o,e){var n=DOM.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",o),n.addEventListener("click",function(){e()}),n},module.exports=NavigationControl;
},{"../../util/dom":379,"../../util/util":399,"../../util/window":374}],357:[function(require,module,exports){
"use strict";function updateScale(t,e,o){var n=o&&o.maxWidth||100,i=t._container.clientHeight/2,a=getDistance(t.unproject([0,i]),t.unproject([n,i]));if(o&&"imperial"===o.unit){var r=3.2808*a;if(r>5280){setScale(e,n,r/5280,"mi")}else setScale(e,n,r,"ft")}else setScale(e,n,a,"m")}function setScale(t,e,o,n){var i=getRoundNum(o),a=i/o;"m"===n&&i>=1e3&&(i/=1e3,n="km"),t.style.width=e*a+"px",t.innerHTML=i+n}function getDistance(t,e){var o=Math.PI/180,n=t.lat*o,i=e.lat*o,a=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-t.lng)*o);return 6371e3*Math.acos(Math.min(a,1))}function getRoundNum(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),o=t/e;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,e*o}var DOM=require("../../util/dom"),util=require("../../util/util"),ScaleControl=function(t){this.options=t,util.bindAll(["_onMove"],this)};ScaleControl.prototype.getDefaultPosition=function(){return"bottom-left"},ScaleControl.prototype._onMove=function(){updateScale(this._map,this._container,this.options)},ScaleControl.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ScaleControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},module.exports=ScaleControl;
},{"../../util/dom":379,"../../util/util":399}],358:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),LngLatBounds=require("../../geo/lng_lat_bounds"),util=require("../../util/util"),window=require("../../util/window"),BoxZoomHandler=function(o){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),util.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};BoxZoomHandler.prototype.isEnabled=function(){return!!this._enabled},BoxZoomHandler.prototype.isActive=function(){return!!this._active},BoxZoomHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},BoxZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},BoxZoomHandler.prototype._onMouseDown=function(o){o.shiftKey&&0===o.button&&(window.document.addEventListener("mousemove",this._onMouseMove,!1),window.document.addEventListener("keydown",this._onKeyDown,!1),window.document.addEventListener("mouseup",this._onMouseUp,!1),DOM.disableDrag(),this._startPos=DOM.mousePos(this._el,o),this._active=!0)},BoxZoomHandler.prototype._onMouseMove=function(o){var e=this._startPos,t=DOM.mousePos(this._el,o);this._box||(this._box=DOM.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",o));var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),s=Math.min(e.y,t.y),r=Math.max(e.y,t.y);DOM.setTransform(this._box,"translate("+n+"px,"+s+"px)"),this._box.style.width=i-n+"px",this._box.style.height=r-s+"px"},BoxZoomHandler.prototype._onMouseUp=function(o){if(0===o.button){var e=this._startPos,t=DOM.mousePos(this._el,o),n=(new LngLatBounds).extend(this._map.unproject(e)).extend(this._map.unproject(t));this._finish(),e.x===t.x&&e.y===t.y?this._fireEvent("boxzoomcancel",o):this._map.fitBounds(n,{linear:!0}).fire("boxzoomend",{originalEvent:o,boxZoomBounds:n})}},BoxZoomHandler.prototype._onKeyDown=function(o){27===o.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",o))},BoxZoomHandler.prototype._finish=function(){this._active=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!1),window.document.removeEventListener("keydown",this._onKeyDown,!1),window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("minemap-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),DOM.enableDrag()},BoxZoomHandler.prototype._fireEvent=function(o,e){return this._map.fire(o,{originalEvent:e})},module.exports=BoxZoomHandler;
},{"../../geo/lng_lat_bounds":228,"../../util/dom":379,"../../util/util":399,"../../util/window":374}],359:[function(require,module,exports){
"use strict";var DoubleClickZoomHandler=function(o){this._map=o,this._onDblClick=this._onDblClick.bind(this)};DoubleClickZoomHandler.prototype.isEnabled=function(){return!!this._enabled},DoubleClickZoomHandler.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},DoubleClickZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},DoubleClickZoomHandler.prototype._onDblClick=function(o){this._map.zoomTo(this._map.getZoom()+(o.originalEvent.shiftKey?-1:1),{around:o.lngLat},o)},module.exports=DoubleClickZoomHandler;
},{}],360:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),window=require("../../util/window"),inertiaLinearity=.3,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=1400,inertiaDeceleration=2500,DragPanHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),util.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};DragPanHandler.prototype.isEnabled=function(){return!!this._enabled},DragPanHandler.prototype.isActive=function(){return!!this._active},DragPanHandler.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("minemap-touch-drag-pan"),this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},DragPanHandler.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-drag-pan"),this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},DragPanHandler.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(window.document.addEventListener("touchmove",this._onMove),window.document.addEventListener("touchend",this._onTouchEnd)):(window.document.addEventListener("mousemove",this._onMove),window.document.addEventListener("mouseup",this._onMouseUp)),window.addEventListener("blur",this._onMouseUp),this._active=!1,this._startPos=this._pos=DOM.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},DragPanHandler.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=DOM.mousePos(this._el,t),n=this._map;n.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),n.transform.setLocationAtPoint(n.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},DragPanHandler.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var n=function(){e._map.moving=!1,e._fireEvent("moveend",t)},i=this._inertia;if(i.length<2)return void n();var o=i[i.length-1],r=i[0],a=o[1].sub(r[1]),s=(o[0]-r[0])/1e3;if(0===s||o[1].equals(r[1]))return void n();var u=a.mult(inertiaLinearity/s),d=u.mag();d>inertiaMaxSpeed&&(d=inertiaMaxSpeed,u._unit()._mult(d));var h=d/(inertiaDeceleration*inertiaLinearity),v=u.mult(-h/2);this._map.panBy(v,{duration:1e3*h,easing:inertiaEasing,noMoveStart:!0},{originalEvent:t})}},DragPanHandler.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),window.document.removeEventListener("mousemove",this._onMove),window.document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("blur",this._onMouseUp))},DragPanHandler.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),window.document.removeEventListener("touchmove",this._onMove),window.document.removeEventListener("touchend",this._onTouchEnd))},DragPanHandler.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},DragPanHandler.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragRotate&&e.dragRotate.isActive())return!0;if(t.touches)return t.touches.length>1;if(t.ctrlKey)return!0;return"mousemove"===t.type?t.buttons&!1:t.button&&0!==t.button},DragPanHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},module.exports=DragPanHandler;
},{"../../util/dom":379,"../../util/util":399,"../../util/window":374}],361:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),window=require("../../util/window"),inertiaLinearity=.25,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=180,inertiaDeceleration=720,DragRotateHandler=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=e.pitchWithRotate!==!1,util.bindAll(["_onDown","_onMove","_onUp"],this)};DragRotateHandler.prototype.isEnabled=function(){return!!this._enabled},DragRotateHandler.prototype.isActive=function(){return!!this._active},DragRotateHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},DragRotateHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},DragRotateHandler.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(window.document.addEventListener("mousemove",this._onMove),window.document.addEventListener("mouseup",this._onUp),window.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=DOM.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},DragRotateHandler.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t));var e=this._map;e.stop();var i=this._pos,n=DOM.mousePos(this._el,t),r=.8*(i.x-n.x),a=(i.y-n.y)*-.5,o=e.getBearing()-r,s=e.getPitch()-a,h=this._inertia,v=h[h.length-1];this._drainInertiaBuffer(),h.push([Date.now(),e._normalizeBearing(o,v[1])]),e.transform.bearing=o,this._pitchWithRotate&&(e.transform.pitch=s),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=n}},DragRotateHandler.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(window.document.removeEventListener("mousemove",this._onMove),window.document.removeEventListener("mouseup",this._onUp),window.removeEventListener("blur",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,a=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t))};if(r.length<2)return void a();var o=r[0],s=r[r.length-1],h=r[r.length-2],v=i._normalizeBearing(n,h[1]),_=s[1]-o[1],u=_<0?-1:1,d=(s[0]-o[0])/1e3;if(0===_||0===d)return void a();var p=Math.abs(_*(inertiaLinearity/d));p>inertiaMaxSpeed&&(p=inertiaMaxSpeed);var l=p/(inertiaDeceleration*inertiaLinearity);v+=u*p*(l/2),Math.abs(i._normalizeBearing(v,0))<this._bearingSnap&&(v=i._normalizeBearing(0,v)),i.rotateTo(v,{duration:1e3*l,easing:inertiaEasing,noMoveStart:!0},{originalEvent:t})}},DragRotateHandler.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},DragRotateHandler.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var i=t.ctrlKey?1:2,n=t.ctrlKey?0:2,r=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(r=0),"mousemove"===t.type?t.buttons&0===i:!this.isActive()&&r!==n},DragRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},module.exports=DragRotateHandler;
},{"../../util/dom":379,"../../util/util":399,"../../util/window":374}],362:[function(require,module,exports){
"use strict";function easeOut(e){return e*(2-e)}var panStep=100,bearingStep=15,pitchStep=10,KeyboardHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};KeyboardHandler.prototype.isEnabled=function(){return!!this._enabled},KeyboardHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},KeyboardHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},KeyboardHandler.prototype._onKeyDown=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=0,n=0,a=0,i=0,r=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?a=1:(e.preventDefault(),r=-1);break;case 40:e.shiftKey?a=-1:(r=1,e.preventDefault())}var s=this._map,o=s.getZoom(),d={duration:300,delayEndEvents:500,easing:easeOut,zoom:t?Math.round(o)+t*(e.shiftKey?2:1):o,bearing:s.getBearing()+n*bearingStep,pitch:s.getPitch()+a*pitchStep,offset:[-i*panStep,-r*panStep],center:s.getCenter()};s.easeTo(d,{originalEvent:e})}},module.exports=KeyboardHandler;
},{}],363:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),browser=require("../../util/browser"),window=require("../../util/window"),ua=window.navigator.userAgent.toLowerCase(),firefox=ua.indexOf("firefox")!==-1,safari=ua.indexOf("safari")!==-1&&ua.indexOf("chrom")===-1,ScrollZoomHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),util.bindAll(["_onWheel","_onTimeout"],this)};ScrollZoomHandler.prototype.isEnabled=function(){return!!this._enabled},ScrollZoomHandler.prototype.enable=function(e){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=e&&"center"===e.around)},ScrollZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},ScrollZoomHandler.prototype._onWheel=function(e){var t;"wheel"===e.type?(t=e.deltaY,firefox&&e.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL&&(t/=browser.devicePixelRatio),e.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(t*=40)):"mousewheel"===e.type&&(t=-e.wheelDeltaY,safari&&(t/=3));var o=browser.now(),i=o-(this._time||0);this._pos=DOM.mousePos(this._el,e),this._time=o,0!==t&&t%4.000244140625==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(i*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&this._zoom(-t,e),e.preventDefault()},ScrollZoomHandler.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},ScrollZoomHandler.prototype._zoom=function(e,t){if(0!==e){var o=this._map,i=2/(1+Math.exp(-Math.abs(e/100)));e<0&&0!==i&&(i=1/i);var l=o.ease?o.ease.to:o.transform.scale,s=o.transform.scaleZoom(l*i);o.zoomTo(s,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?o.getCenter():o.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:t})}},module.exports=ScrollZoomHandler;
},{"../../util/browser":372,"../../util/dom":379,"../../util/util":399,"../../util/window":374}],364:[function(require,module,exports){
"use strict";var DOM=require("../../util/dom"),util=require("../../util/util"),window=require("../../util/window"),inertiaLinearity=.15,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaDeceleration=12,inertiaMaxSpeed=2.5,significantScaleThreshold=.15,significantRotateThreshold=4,TouchZoomRotateHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),util.bindAll(["_onStart","_onMove","_onEnd"],this)};TouchZoomRotateHandler.prototype.isEnabled=function(){return!!this._enabled},TouchZoomRotateHandler.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("minemap-touch-zoom-rotate"),this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},TouchZoomRotateHandler.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-zoom-rotate"),this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},TouchZoomRotateHandler.prototype.disableRotation=function(){this._rotationDisabled=!0},TouchZoomRotateHandler.prototype.enableRotation=function(){this._rotationDisabled=!1},TouchZoomRotateHandler.prototype._onStart=function(t){if(2===t.touches.length){var e=DOM.mousePos(this._el,t.touches[0]),o=DOM.mousePos(this._el,t.touches[1]);this._startVec=e.sub(o),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],window.document.addEventListener("touchmove",this._onMove,!1),window.document.addEventListener("touchend",this._onEnd,!1)}},TouchZoomRotateHandler.prototype._onMove=function(t){if(2===t.touches.length){var e=DOM.mousePos(this._el,t.touches[0]),o=DOM.mousePos(this._el,t.touches[1]),i=e.add(o).div(2),n=e.sub(o),a=n.mag()/this._startVec.mag(),r=this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI,s=this._map;if(this._gestureIntent){var h={duration:0,around:s.unproject(i)};"rotate"===this._gestureIntent&&(h.bearing=this._startBearing+r),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(h.zoom=s.transform.scaleZoom(this._startScale*a)),s.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),a,i]),s.easeTo(h,{originalEvent:t})}else{var u=Math.abs(1-a)>significantScaleThreshold;Math.abs(r)>significantRotateThreshold?this._gestureIntent="rotate":u&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=n,this._startScale=s.transform.scale,this._startBearing=s.transform.bearing)}t.preventDefault()}},TouchZoomRotateHandler.prototype._onEnd=function(t){window.document.removeEventListener("touchmove",this._onMove),window.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,o=this._map;if(e.length<2)return void o.snapToNorth({},{originalEvent:t});var i=e[e.length-1],n=e[0],a=o.transform.scaleZoom(this._startScale*i[1]),r=o.transform.scaleZoom(this._startScale*n[1]),s=a-r,h=(i[0]-n[0])/1e3,u=i[2];if(0===h||a===r)return void o.snapToNorth({},{originalEvent:t});var l=s*inertiaLinearity/h;Math.abs(l)>inertiaMaxSpeed&&(l=l>0?inertiaMaxSpeed:-inertiaMaxSpeed);var d=1e3*Math.abs(l/(inertiaDeceleration*inertiaLinearity)),c=a+l*d/2e3;c<0&&(c=0),o.easeTo({zoom:c,duration:d,easing:inertiaEasing,around:this._aroundCenter?o.getCenter():o.unproject(u)},{originalEvent:t})},TouchZoomRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>2&&e-t[0][0]>160;)t.shift()},module.exports=TouchZoomRotateHandler;
},{"../../util/dom":379,"../../util/util":399,"../../util/window":374}],365:[function(require,module,exports){
"use strict";var util=require("../util/util"),window=require("../util/window"),Hash=function(){util.bindAll(["_onHashChange","_updateHash"],this)};Hash.prototype.addTo=function(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Hash.prototype.remove=function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},Hash.prototype._onHashChange=function(){var t=window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},Hash.prototype._updateHash=function(){var t=this._map.getCenter(),e=this._map.getZoom(),a=this._map.getBearing(),h=this._map.getPitch(),i=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),n="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(i)+"/"+t.lng.toFixed(i);(a||h)&&(n+="/"+Math.round(10*a)/10),h&&(n+="/"+Math.round(h)),window.history.replaceState("","",n)},module.exports=Hash;
},{"../util/util":399,"../util/window":374}],366:[function(require,module,exports){
"use strict";function removeNode(t){t.parentNode&&t.parentNode.removeChild(t)}function contains(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1}function getElementOffset(t){for(var e=t.offsetTop,i=t.offsetLeft,r=t.offsetWidth,o=t.offsetHeight;t=t.offsetParent;)e+=t.offsetTop,i+=t.offsetLeft;return{top:e,left:i,width:r,height:o}}var util=require("../util/util"),browser=require("../util/browser"),window=require("../util/window"),DOM=require("../util/dom"),ajax=require("../util/ajax"),Style=require("../style/style"),AnimationLoop=require("../style/animation_loop"),Painter=require("../render/painter"),Transform=require("../geo/transform"),Hash=require("./hash"),bindHandlers=require("./bind_handlers"),Camera=require("./camera"),LngLat=require("../geo/lng_lat"),LngLatBounds=require("../geo/lng_lat_bounds"),Point=require("point-geometry"),AttributionControl=require("./control/attribution_control"),LogoControl=require("./control/logo_control"),isSupported=require("minemap-supported"),config=require("../util/config"),defaultMinZoom=0,defaultMaxZoom=22,defaultOptions={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:defaultMinZoom,maxZoom:defaultMaxZoom,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,overviewMap:!1},Marker=require("./marker"),FileSaver=require("../util/file_saver"),Drag=require("../util/drag"),Map=function(t){function e(e){var i=this;if(e=util.extend({},defaultOptions,e),null!=e.minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var r=new Transform(e.minZoom,e.maxZoom,e.renderWorldCopies);if(t.call(this,r,e),this._interactive=e.interactive,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this.__sourceList=[],this.__layersList=[],this.__markerList=[],this.__eventTree=[],"string"==typeof e.container){if(this._container=window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else this._container=e.container;this.animationLoop=new AnimationLoop,e.maxBounds&&this.setMaxBounds(e.maxBounds),util.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){i.animationLoop.set(300),i._rerender()}),void 0!==window&&(window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1)),bindHandlers(this,e),this._hash=e.hash&&(new Hash).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this._classes=[],this.resize(),e.classes&&this.setClasses(e.classes),e.style&&this.setStyle(e.style),e.attributionControl&&this.addControl(new AttributionControl),this.addControl(new LogoControl,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=e,e.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={overviewMap:{},showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.__onMove=function(t){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4)},e.prototype.addOverviewMap=function(){var t=this;this._overviewMapElement=window.document.createElement("div"),this._overviewMapElement.id="id"+Math.random(),this._overviewMapElement.style.position="relative",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px";var i=this.getContainer(),r=getElementOffset(i);this._overviewMapElement.style.left=r.width-162+"px",this._overviewMapElement.style.top=r.height-162+"px",i.appendChild(this._overviewMapElement),this.overviewMapInstance=new e({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,maxZoom:17,minZoom:3}),this.on("moveend",this.__onMove),setTimeout(function(){var e=window.document.createElement("div");t.overviewMapInstance.getCanvas().style.cursor="";var i=t.getBounds(),r=t.overviewMapInstance.project(i.getSouthWest()),o=t.overviewMapInstance.project(i.getNorthEast());e.style.top=Math.round(o.y)+"px",e.style.left=Math.round(r.x)+"px",e.style.width=Math.round(160-2*r.x)+"px",e.style.height=Math.round(160-2*o.y)+"px",e.style.border="2px solid red",e.style.position="absolute",t._overviewMapElement.appendChild(e),Drag.init({handler:t._overviewMapElement,root:e,restrictX:2*Math.round(r.x),restrictY:2*Math.round(o.y),cb:function(i,s){if(i-Math.round(r.x)!=0||s-Math.round(o.y)!=0){var n=t.overviewMapInstance.unproject([i-Math.round(r.x)+80,s-Math.round(o.y)+80]);t.flyTo({center:n,bearing:t.overviewMapInstance.getBearing()}),e.style.top=Math.round(o.y)+"px",e.style.left=Math.round(r.x)+"px"}}})},1e3)},i.overviewMap.set=function(t){this._overviewMap=t,this.overviewMapInstance?this._overviewMapElement.style.display=t?"block":"none":t&&this.addOverviewMap()},i.overviewMap.get=function(){return this._overviewMap},e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),r=this._controlPositions[e];return e.indexOf("bottom")!==-1?r.insertBefore(i,r.firstChild):r.appendChild(i),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.addClass=function(t,e){return util.warnOnce("Style classes ."),this._classes.indexOf(t)>=0||""===t?this:(this._classes.push(t),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.removeClass=function(t,e){util.warnOnce("Style classes .");var i=this._classes.indexOf(t);return i<0||""===t?this:(this._classes.splice(i,1),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.setClasses=function(t,e){util.warnOnce("Style classes .");for(var i={},r=0;r<t.length;r++)""!==t[r]&&(i[t[r]]=!0);return this._classes=Object.keys(i),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0)},e.prototype.hasClass=function(t){return util.warnOnce("Style classes ."),this._classes.indexOf(t)>=0},e.prototype.getClasses=function(){return util.warnOnce("Style classes ."),this._classes},e.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],i=t[1];return this._resizeCanvas(e,i),this.transform.resize(e,i),this.painter.resize(e,i),this.fire("movestart").fire("move").fire("resize").fire("moveend")},e.prototype.getBounds=function(){var t=new LngLatBounds(this.transform.pointLocation(new Point(0,this.transform.height)),this.transform.pointLocation(new Point(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new Point(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new Point(0,this.transform.size.y)))),t},e.prototype.setMaxBounds=function(t){if(t){var e=LngLatBounds.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},e.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?defaultMinZoom:t)>=defaultMinZoom&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between "+defaultMinZoom+" and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?defaultMaxZoom:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(LngLat.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(Point.convert(t))},e.prototype.queryRenderedFeatures=function(){var t,e={};return 2===arguments.length?(t=arguments[0],e=arguments[1]):1===arguments.length&&function(t){return t instanceof Point||Array.isArray(t)}(arguments[0])?t=arguments[0]:1===arguments.length&&(e=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform.zoom,this.transform.angle)},e.prototype._makeQueryGeometry=function(t){var e=this;void 0===t&&(t=[Point.convert([0,0]),Point.convert([this.transform.width,this.transform.height])]);var i;if(t instanceof Point||"number"==typeof t[0])i=[Point.convert(t)];else{var r=[Point.convert(t[0]),Point.convert(t[1])];i=[r[0],new Point(r[1].x,r[0].y),r[1],new Point(r[0].x,r[1].y),r[0]]}return i=i.map(function(t){return e.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){if((!e||e.diff!==!1)&&this.style&&t&&!(t instanceof Style)&&"string"!=typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){util.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(this.style=t instanceof Style?t:new Style(t,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.addSource=function(t,e){return t&&this.__sourceList.push(t),this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},e.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.removeAll=function(t){var e=this;t?"layer"===t.type?(this.__layersList.map(function(t){e.removeLayer(t)}),this.__layersList=[],this.__sourceList.map(function(t){e.removeSource(t)}),this.__sourceList=[],this.removeLayerEvent(null,null,this)):"marker"===t.type&&this.removeMarkers():(this.__layersList.map(function(t){e.removeLayer(t)}),this.__layersList=[],this.__sourceList.map(function(t){e.removeSource(t)}),this.__sourceList=[],this.removeMarkers(),this.removeLayerEvent(null,null,this))},e.prototype.addLayerEvent=function(t,e,i){var r=this,o={id:t,eventType:e,fun:function(e){var o=r.queryRenderedFeatures(e.point,{layers:[t]});if(o&&o.length>0)return i(o)}};r.__eventTree.push(o),this.on(e,o.fun)},e.prototype.removeLayerEvent=function(t,e,i){var r=this;if(i){for(var o=0;o<this.__eventTree.length;o++){var s=r.__eventTree[o];r.off(s.eventType,s.fun)}this.__eventTree=[]}else for(var n=0;n<this.__eventTree.length;n++){var a=r.__eventTree[n];if(a.id===t)return r.off(e,a.fun),void r.__eventTree.splice(n,1)}},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addImage=function(t,e,i){this.style.spriteAtlas.addImage(t,e,i)},e.prototype.removeImage=function(t){this.style.spriteAtlas.removeImage(t)},e.prototype.loadImage=function(t,e){ajax.getImage(t,e)},e.prototype.addLayer=function(t,e){return t.id&&this.__layersList.push(t.id),this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.removeLayers=function(t){var e=this;if(t)for(var i=0;i<t.length;i++){var r=t[i];if(e.getLayer(r)){e.removeLayer(r);for(var o=0;o<this.__layersList.length;o++){var s=e.__layersList[o];s===r&&e.__layersList.splice(o,1)}}}else{for(var n=0;n<this.__layersList.length;n++){var a=e.__layersList[n];e.getLayer(a)&&e.removeLayer(a)}this.__layersList=[]}},e.prototype.getAllMarkers=function(){return this.__markerList},e.prototype.addMarker=function(t){!contains(this.__markerList,t)&&t instanceof Marker&&(this.__markerList.push(t),t.addTo(this))},e.prototype.addMarkers=function(t){for(var e=this,i=0;i<t.length;i++)e.addMarker(t[i])},e.prototype.removeMarker=function(t){t instanceof Marker&&t.remove()},e.prototype.removeMarkers=function(t){var e=this;if(t)for(var i=0;i<t.length;i++){e.removeMarker(t[i]);for(var r=0;r<this.__markerList.length;r++)t[i]===e.__markerList[r]&&e.__markerList.splice(r,1)}else{for(var o=0;o<this.__markerList.length;o++)e.removeMarker(e.__markerList[o]);this.__markerList=[]}},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,i,r){return this.style.setPaintProperty(t,e,i,r),this._update(!0),this},e.prototype.getPaintProperty=function(t,e,i){return this.style.getPaintProperty(t,e,i)},e.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getMapScreenShot=function(t,e){if("file"!==t){var i=new Image;return i.src=this._canvas.toDataURL(),i}this._canvas.toBlob(function(t){FileSaver.saveAs(t,e||"mapsave.png")})},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("minemap-map");var e=this._canvasContainer=DOM.create("div","minemap-canvas-container",t);this._interactive&&e.classList.add("minemap-interactive"),this._canvas=DOM.create("canvas","minemap-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var r=this._controlContainer=DOM.create("div","minemap-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){o[t]=DOM.create("div","minemap-ctrl-"+t,r)})},e.prototype._resizeCanvas=function(t,e){var i=window.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=util.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},isSupported.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);if(!e)return void this.fire("error",{error:new Error("Failed to initialize WebGL")});this.painter=new Painter(e,this.transform)},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&browser.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:t})},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},e.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),browser.cancelFrame(this._frameId),this.setStyle(null),void 0!==window&&(window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),removeNode(this._canvasContainer),removeNode(this._controlContainer),this._container.classList.remove("minemap-map"),this.fire("remove"),this.overviewMapInstance&&(this.off("moveend",this.__onMove),this.overviewMapInstance.remove())},e.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=browser.frame(this._render))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this.style._redoPlacement())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(t){this._repaint=t,this._update()},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},e.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(e.prototype,i),e}(Camera);module.exports=Map;
},{"../geo/lng_lat":227,"../geo/lng_lat_bounds":228,"../geo/transform":229,"../render/painter":249,"../style/animation_loop":315,"../style/style":318,"../util/ajax":370,"../util/browser":372,"../util/config":376,"../util/dom":379,"../util/drag":380,"../util/file_saver":382,"../util/util":399,"../util/window":374,"./bind_handlers":350,"./camera":351,"./control/attribution_control":352,"./control/logo_control":355,"./hash":365,"./marker":367,"minemap-supported":149,"point-geometry":154}],367:[function(require,module,exports){
"use strict";var DOM=require("../util/dom"),LngLat=require("../geo/lng_lat"),Point=require("point-geometry"),Marker=function(t,e){this._offset=Point.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=DOM.create("div")),t.classList.add("minemap-marker"),this._element=t,this._popup=null};Marker.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),t.addMarker(this),this},Marker.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),DOM.remove(this._element),this._popup&&this._popup.remove(),this},Marker.prototype.getLngLat=function(){return this._lngLat},Marker.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Marker.prototype.getElement=function(){return this._element},Marker.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},Marker.prototype._onMapClick=function(t){var e=t.originalEvent.target,p=this._element;this._popup&&(e===p||p.contains(e))&&this.togglePopup()},Marker.prototype.getPopup=function(){return this._popup},Marker.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},Marker.prototype._update=function(t){if(this._map){var e=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),DOM.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},module.exports=Marker;
},{"../geo/lng_lat":227,"../util/dom":379,"point-geometry":154}],368:[function(require,module,exports){
"use strict";function normalizeOffset(t){if(t){if("number"==typeof t){var o=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new Point(0,t),"top-left":new Point(o,o),"top-right":new Point(-o,o),bottom:new Point(0,-t),"bottom-left":new Point(o,-o),"bottom-right":new Point(-o,-o),left:new Point(t,0),right:new Point(-t,0)}}if(isPointLike(t)){var e=Point.convert(t);return{top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{top:Point.convert(t.top||[0,0]),"top-left":Point.convert(t["top-left"]||[0,0]),"top-right":Point.convert(t["top-right"]||[0,0]),bottom:Point.convert(t.bottom||[0,0]),"bottom-left":Point.convert(t["bottom-left"]||[0,0]),"bottom-right":Point.convert(t["bottom-right"]||[0,0]),left:Point.convert(t.left||[0,0]),right:Point.convert(t.right||[0,0])}}return normalizeOffset(new Point(0,0))}function isPointLike(t){return t instanceof Point||Array.isArray(t)}var util=require("../util/util"),Evented=require("../util/evented"),DOM=require("../util/dom"),LngLat=require("../geo/lng_lat"),Point=require("point-geometry"),window=require("../util/window"),defaultOptions={closeButton:!0,closeOnClick:!0},Popup=function(t){function o(o){t.call(this),this.options=util.extend(Object.create(defaultOptions),o),util.bindAll(["_update","_onClickClose"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._update(),this},o.prototype.setText=function(t){return this.setDOMContent(window.document.createTextNode(t))},o.prototype.setHTML=function(t){var o,e=window.document.createDocumentFragment(),n=window.document.createElement("body");for(n.innerHTML=t;;){if(!(o=n.firstChild))break;e.appendChild(o)}return this.setDOMContent(e)},o.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},o.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=DOM.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=DOM.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},o.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=DOM.create("div","minemap-popup",this._map.getContainer()),this._tip=DOM.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,o=normalizeOffset(this.options.offset),e=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat).round();if(!t){var n=this._container.offsetWidth,i=this._container.offsetHeight;t=e.y+o.bottom.y<i?["top"]:e.y>this._map.transform.height-i?["bottom"]:[],e.x<n/2?t.push("left"):e.x>this._map.transform.width-n/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var r=e.add(o[t]),s={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},p=this._container.classList;for(var a in s)p.remove("minemap-popup-anchor-"+a);p.add("minemap-popup-anchor-"+t),DOM.setTransform(this._container,s[t]+" translate("+r.x+"px,"+r.y+"px)")}},o.prototype._onClickClose=function(){this.remove()},o}(Evented);module.exports=Popup;
},{"../geo/lng_lat":227,"../util/dom":379,"../util/evented":381,"../util/util":399,"../util/window":374,"point-geometry":154}],369:[function(require,module,exports){
"use strict";var Actor=function(t,e,a){this.target=t,this.parent=e,this.mapId=a,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};Actor.prototype.send=function(t,e,a,r,s){var i=a?this.mapId+":"+this.callbackID++:null;a&&(this.callbacks[i]=a),this.target.postMessage({targetMapId:s,sourceMapId:this.mapId,type:t,id:String(i),data:e},r)},Actor.prototype.receive=function(t){var e,a=this,r=t.data,s=r.id;if(!r.targetMapId||this.mapId===r.targetMapId){var i=function(t,e,r){a.target.postMessage({sourceMapId:a.mapId,type:"<response>",id:String(s),error:t?String(t):null,data:e},r)};if("<response>"===r.type)e=this.callbacks[r.id],delete this.callbacks[r.id],e&&e(r.error||null,r.data);else if(void 0!==r.id&&this.parent[r.type])this.parent[r.type](r.sourceMapId,r.data,i);else if(void 0!==r.id&&this.parent.getWorkerSource){var p=r.type.split("."),o=this.parent.getWorkerSource(r.sourceMapId,p[0]);o[p[1]](r.data,i)}else this.parent[r.type](r.data)}},Actor.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},module.exports=Actor;
},{}],370:[function(require,module,exports){
"use strict";function sameOrigin(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var window=require("./window"),AJAXError=function(e){function t(t,r){e.call(this,t),this.status=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error);exports.postJSON=function(e,t,r){var n=function(e){var t="";for(var r in e)t+=r+"="+e[r]+"&";return t}(t),o=new window.XMLHttpRequest;return o.open("POST",e),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onerror=function(e){r(e)},o.onload=function(){if(o.status>=200&&o.status<300&&o.response){var e=JSON.parse(o.response);try{e=JSON.parse(o.response)}catch(e){return r(e)}r(null,e)}},o.send(n),o},exports.getJSON=function(e,t){var r=new window.XMLHttpRequest;return r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.onerror=function(e){t(e)},r.onload=function(){if(r.status>=200&&r.status<300&&r.response){var e;try{e=JSON.parse(r.response)}catch(e){return t(e)}t(null,e)}else t(new AJAXError(r.statusText,r.status))},r.send(),r},exports.getArrayBuffer=function(e,t){var r=new window.XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onerror=function(e){t(e)},r.onload=function(){if(0===r.response.byteLength&&200===r.status)return t(new Error("http status 200 returned without content."));r.status>=200&&r.status<300&&r.response?t(null,{data:r.response,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")}):t(new AJAXError(r.statusText,r.status))},r.send(),r};var transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";exports.getImage=function(e,t){return exports.getArrayBuffer(e,function(e,r){if(e)return t(e);var n=new window.Image,o=window.URL||window.webkitURL;n.onload=function(){t(null,n),o.revokeObjectURL(n.src)};var s=new window.Blob([new Uint8Array(r.data)],{type:"image/png"});n.cacheControl=r.cacheControl,n.expires=r.expires,n.src=r.data.byteLength?o.createObjectURL(s):transparentPngUrl})},exports.getVideo=function(e,t){var r=window.document.createElement("video");r.onloadstart=function(){t(null,r)};for(var n=0;n<e.length;n++){var o=window.document.createElement("source");sameOrigin(e[n])||(r.crossOrigin="Anonymous"),o.src=e[n],r.appendChild(o)}return r};
},{"./window":374}],371:[function(require,module,exports){
"use strict";module.exports=function(t){for(var r=0,o=Object.getOwnPropertyNames(t.constructor.prototype);r<o.length;r+=1){var e=o[r],n=t[e];"constructor"!==e&&"function"==typeof n&&(t[e]=n.bind(t))}return t};
},{}],372:[function(require,module,exports){
"use strict";var window=require("./window");module.exports.now=function(){return window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date)}();var frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;exports.frame=function(e){return frame(e)};var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;exports.cancelFrame=function(e){cancel(e)},exports.timed=function(e,n,t){function o(i){r||(i=module.exports.now(),i>=a+n?e.call(t,1):(e.call(t,(i-a)/n),exports.frame(o)))}if(!n)return e.call(t,1),null;var r=!1,a=module.exports.now();return exports.frame(o),function(){r=!0}},exports.getImageData=function(e){var n=window.document.createElement("canvas"),t=n.getContext("2d");return n.width=e.width,n.height=e.height,t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height).data},exports.supported=require("minemap-supported"),exports.hardwareConcurrency=window.navigator.hardwareConcurrency||4,Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}}),exports.supportsWebp=!1;var webpImgTest=window.document.createElement("img");webpImgTest.onload=function(){exports.supportsWebp=!0},webpImgTest.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";
},{"./window":374,"minemap-supported":149}],373:[function(require,module,exports){
"use strict";var WebWorkify=require("webworkify"),window=require("../window"),workerURL=window.URL.createObjectURL(new WebWorkify(require("../../source/worker"),{bare:!0}));module.exports=function(){return new window.Worker(workerURL)};
},{"../../source/worker":270,"../window":374,"webworkify":197}],374:[function(require,module,exports){
"use strict";module.exports=self;
},{}],375:[function(require,module,exports){
"use strict";function compareAreas(e,r){return r.area-e.area}var quickselect=require("quickselect"),calculateSignedArea=require("./util").calculateSignedArea;module.exports=function(e,r){var a=e.length;if(a<=1)return[e];for(var t,u,c=[],i=0;i<a;i++){var l=calculateSignedArea(e[i]);0!==l&&(e[i].area=Math.abs(l),void 0===u&&(u=l<0),u===l<0?(t&&c.push(t),t=[e[i]]):t.push(e[i]))}if(t&&c.push(t),r>1)for(var n=0;n<c.length;n++)c[n].length<=r||(quickselect(c[n],r,1,c[n].length-1,compareAreas),c[n]=c[n].slice(0,r));return c};
},{"./util":399,"quickselect":162}],376:[function(require,module,exports){
"use strict";var config={DOMAIN:"//minedata.cn",API_BASE:"/data/",API_URL:"//minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//minedata.cn/otherdata/",SRC_BASE:"/minemapapi/v1.3/",SRC_URL:"//minedata.cn/minemapapi/v1.3/",DRIVING_ROUTE_BASE:"/service/route/driving",DRIVING_ROUTE_URL:"//minedata.cn/service/route/driving",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};module.exports=config;
},{}],377:[function(require,module,exports){
"use strict";var DictionaryCoder=function(r){var t=this;this._stringToNumber={},this._numberToString=[];for(var o=0;o<r.length;o++){var i=r[o];t._stringToNumber[i]=o,t._numberToString[o]=i}};DictionaryCoder.prototype.encode=function(r){return this._stringToNumber[r]},DictionaryCoder.prototype.decode=function(r){return this._numberToString[r]},module.exports=DictionaryCoder;
},{}],378:[function(require,module,exports){
"use strict";var util=require("./util"),Actor=require("./actor"),Dispatcher=function(t,r){var o=this;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=util.uniqueId();for(var i=this.workerPool.acquire(this.id),e=0;e<i.length;e++){var s=i[e],c=new Actor(s,r,o.id);c.name="Worker "+e,o.actors.push(c)}};Dispatcher.prototype.broadcast=function(t,r,o){o=o||function(){},util.asyncAll(this.actors,function(o,i){o.send(t,r,i)},o)},Dispatcher.prototype.send=function(t,r,o,i,e){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,r,o,e),i},Dispatcher.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},module.exports=Dispatcher;
},{"./actor":369,"./util":399}],379:[function(require,module,exports){
"use strict";function testProp(e){for(var t=0;t<e.length;t++)if(e[t]in docStyle)return e[t];return e[0]}function suppressClick(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",suppressClick,!0)}var Point=require("point-geometry"),window=require("./window");exports.create=function(e,t,o){var n=window.document.createElement(e);return t&&(n.className=t),o&&o.appendChild(n),n};var docStyle=window.document.documentElement.style,selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),userSelect;exports.disableDrag=function(){selectProp&&(userSelect=docStyle[selectProp],docStyle[selectProp]="none")},exports.enableDrag=function(){selectProp&&(docStyle[selectProp]=userSelect)};var transformProp=testProp(["transform","WebkitTransform"]);exports.setTransform=function(e,t){e.style[transformProp]=t},exports.suppressClick=function(){window.addEventListener("click",suppressClick,!0),window.setTimeout(function(){window.removeEventListener("click",suppressClick,!0)},0)},exports.mousePos=function(e,t){var o=e.getBoundingClientRect();return t=t.touches?t.touches[0]:t,new Point(t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop)},exports.touchPos=function(e,t){for(var o=e.getBoundingClientRect(),n=[],r="touchend"===t.type?t.changedTouches:t.touches,s=0;s<r.length;s++)n.push(new Point(r[s].clientX-o.left-e.clientLeft,r[s].clientY-o.top-e.clientTop));return n},exports.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};
},{"./window":374,"point-geometry":154}],380:[function(require,module,exports){
"use strict";var window=require("../util/window"),cb=null,restrictX=0,restrictY=0,Drag={obj:null,init:function(t){cb=t.cb,restrictX=t.restrictX,restrictY=t.restrictY,t.handler.onmousedown=this.start,t.handler.root=t.root||t.handler;var o=t.handler.root;o.onDragStart=t.dragStart||new Function,o.onDrag=t.onDrag||new Function,o.onDragEnd=t.onDragEnd||new Function},start:function(t){var o=Drag.obj=this;o.style.cursor="move",t=t||Drag.fixEvent(window.event);var r=t.pageX,e=t.pageY;o.lastMouseX=r,o.lastMouseY=e;var n=o.root.offsetLeft,a=o.root.offsetTop;o.root.style.left=n+"px",o.root.style.top=a+"px",window.document.onmouseup=Drag.end,window.document.onmousemove=Drag.drag,o.root.onDragStart(n,a)},drag:function(t){t=t||Drag.fixEvent(window.event);var o=t.pageX,r=t.pageY,e=Drag.obj.root,n=e.style.left?parseInt(e.style.left):0,a=e.style.top?parseInt(e.style.top):0;n<=-1&&(n=-1),a<=-1&&(a=-1),n>=restrictX&&(n=restrictX),a>=restrictY&&(a=restrictY);var s=o-Drag.obj.lastMouseX+n,l=r-Drag.obj.lastMouseY+a;e.style.left=s+"px",e.style.top=l+"px",Drag.obj.root.onDrag(s,l),Drag.obj.lastMouseX=o,Drag.obj.lastMouseY=r},end:function(t){var o=Drag.obj.root.style.left?parseInt(Drag.obj.root.style.left):0,r=Drag.obj.root.style.top?parseInt(Drag.obj.root.style.top):0;Drag.obj.root.onDragEnd(o,r),window.setTimeout(function(){cb(o,r)},100),window.document.onmousemove=null,window.document.onmouseup=null,Drag.obj=null},fixEvent:function(t){return t.pageX=t.clientX+window.document.documentElement.scrollLeft,t.pageY=t.clientY+window.document.documentElement.scrollTop,t}};module.exports=Drag;
},{"../util/window":374}],381:[function(require,module,exports){
"use strict";function _addEventListener(e,t,n){n[e]=n[e]||[],n[e].push(t)}function _removeEventListener(e,t,n){if(n&&n[e]){var i=n[e].indexOf(t);i!==-1&&n[e].splice(i,1)}}var util=require("./util"),Evented=function(){};Evented.prototype.on=function(e,t){return this._listeners=this._listeners||{},_addEventListener(e,t,this._listeners),this},Evented.prototype.off=function(e,t){return _removeEventListener(e,t,this._listeners),_removeEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},_addEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.fire=function(e,t){var n=this;if(this.listens(e)){t=util.extend({},t,{type:e,target:this});for(var i=this._listeners&&this._listeners[e]?this._listeners[e].slice():[],s=0;s<i.length;s++)i[s].call(n,t);for(var r=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[],o=0;o<r.length;o++)r[o].call(n,t),_removeEventListener(e,r[o],n._oneTimeListeners);this._eventedParent&&this._eventedParent.fire(e,util.extend({},t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}return this},Evented.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Evented.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this},module.exports=Evented;
},{"./util":399}],382:[function(require,module,exports){
var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},u=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){f(e)}}},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,f,l){l||(t=c(t));var v,p=this,w=t.type,m="application/octet-stream"===w,y=function(){u(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,r)return v=n().createObjectURL(t),void setTimeout(function(){o.href=v,o.download=f,a(o),y(),s(v),p.readyState=p.DONE});!function(){if((d||m&&i)&&e.FileReader){var o=new FileReader;return o.onloadend=function(){var t=d?o.result:o.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,y()},o.readAsDataURL(t),void(p.readyState=p.INIT)}if(v||(v=n().createObjectURL(t)),m)e.location.href=v;else{e.open(v,"_blank")||(e.location.href=v)}p.readyState=p.DONE,y(),s(v)}()},v=l.prototype,p=function(e,t,n){return new l(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(v.abort=function(){},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,p)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});
},{}],383:[function(require,module,exports){
"use strict";function compareMax(e,t){return t.max-e.max}function Cell(e,t,n,r){this.p=new Point(e,t),this.h=n,this.d=pointToPolygonDist(this.p,r),this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(e,t){for(var n=!1,r=1/0,o=0;o<t.length;o++)for(var i=t[o],l=0,u=i.length,s=u-1;l<u;s=l++){var a=i[l],h=i[s];a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(n=!n),r=Math.min(r,distToSegmentSquared(e,a,h))}return(n?1:-1)*Math.sqrt(r)}function getCentroidCell(e){for(var t=0,n=0,r=0,o=e[0],i=0,l=o.length,u=l-1;i<l;u=i++){var s=o[i],a=o[u],h=s.x*a.y-a.x*s.y;n+=(s.x+a.x)*h,r+=(s.y+a.y)*h,t+=3*h}return new Cell(n/t,r/t,0,e)}var Queue=require("tinyqueue"),Point=require("point-geometry"),distToSegmentSquared=require("./intersection_tests").distToSegmentSquared;module.exports=function(e,t,n){t=t||1;for(var r,o,i,l,u=e[0],s=0;s<u.length;s++){var a=u[s];(!s||a.x<r)&&(r=a.x),(!s||a.y<o)&&(o=a.y),(!s||a.x>i)&&(i=a.x),(!s||a.y>l)&&(l=a.y)}var h=i-r,p=l-o,y=Math.min(h,p),x=y/2,d=new Queue(null,compareMax);if(0===y)return[r,o];for(var g=r;g<i;g+=y)for(var f=o;f<l;f+=y)d.push(new Cell(g+x,f+x,x,e));for(var m=getCentroidCell(e),c=d.length;d.length;){var v=d.pop();(v.d>m.d||!m.d)&&(m=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,c)),v.max-m.d<=t||(x=v.h/2,d.push(new Cell(v.p.x-x,v.p.y-x,x,e)),d.push(new Cell(v.p.x+x,v.p.y-x,x,e)),d.push(new Cell(v.p.x-x,v.p.y+x,x,e)),d.push(new Cell(v.p.x+x,v.p.y+x,x,e)),c+=4)}return n&&(console.log("num probes: "+c),console.log("best distance: "+m.d)),m.p};
},{"./intersection_tests":387,"point-geometry":154,"tinyqueue":181}],384:[function(require,module,exports){
"use strict";var WorkerPool=require("./worker_pool"),globalWorkerPool;module.exports=function(){return globalWorkerPool||(globalWorkerPool=new WorkerPool),globalWorkerPool};
},{"./worker_pool":402}],385:[function(require,module,exports){
"use strict";function Glyphs(a,e){this.stacks=a.readFields(readFontstacks,[],e)}function readFontstacks(a,e,r){if(1===a){var t=r.readMessage(readFontstack,{glyphs:{}});e.push(t)}}function readFontstack(a,e,r){if(1===a)e.name=r.readString();else if(2===a)e.range=r.readString();else if(3===a){var t=r.readMessage(readGlyph,{});e.glyphs[t.id]=t}}function readGlyph(a,e,r){1===a?e.id=r.readVarint():2===a?e.bitmap=r.readBytes():3===a?e.width=r.readVarint():4===a?e.height=r.readVarint():5===a?e.left=r.readSVarint():6===a?e.top=r.readSVarint():7===a&&(e.advance=r.readVarint())}module.exports=Glyphs;
},{}],386:[function(require,module,exports){
"use strict";function interpolate(t,e,n){return t*(1-n)+e*n}module.exports=interpolate,interpolate.number=interpolate,interpolate.vec2=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n)]},interpolate.color=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n),interpolate(t[2],e[2],n),interpolate(t[3],e[3],n)]},interpolate.array=function(t,e,n){return t.map(function(t,r){return interpolate(t,e[r],n)})};
},{}],387:[function(require,module,exports){
"use strict";function polygonIntersectsPolygon(n,t){for(var e=0;e<n.length;e++)if(polygonContainsPoint(t,n[e]))return!0;for(var r=0;r<t.length;r++)if(polygonContainsPoint(n,t[r]))return!0;return!!lineIntersectsLine(n,t)}function multiPolygonIntersectsBufferedMultiPoint(n,t,e){for(var r=0;r<n.length;r++)for(var o=n[r],i=0;i<t.length;i++)for(var l=t[i],u=0;u<l.length;u++){var s=l[u];if(polygonContainsPoint(o,s))return!0;if(pointIntersectsBufferedLine(s,o,e))return!0}return!1}function multiPolygonIntersectsMultiPolygon(n,t){if(1===n.length&&1===n[0].length)return multiPolygonContainsPoint(t,n[0][0]);for(var e=0;e<t.length;e++)for(var r=t[e],o=0;o<r.length;o++)if(multiPolygonContainsPoint(n,r[o]))return!0;for(var i=0;i<n.length;i++){for(var l=n[i],u=0;u<l.length;u++)if(multiPolygonContainsPoint(t,l[u]))return!0;for(var s=0;s<t.length;s++)if(lineIntersectsLine(l,t[s]))return!0}return!1}function multiPolygonIntersectsBufferedMultiLine(n,t,e){for(var r=0;r<t.length;r++)for(var o=t[r],i=0;i<n.length;i++){var l=n[i];if(l.length>=3)for(var u=0;u<o.length;u++)if(polygonContainsPoint(l,o[u]))return!0;if(lineIntersectsBufferedLine(l,o,e))return!0}return!1}function lineIntersectsBufferedLine(n,t,e){if(n.length>1){if(lineIntersectsLine(n,t))return!0;for(var r=0;r<t.length;r++)if(pointIntersectsBufferedLine(t[r],n,e))return!0}for(var o=0;o<n.length;o++)if(pointIntersectsBufferedLine(n[o],t,e))return!0;return!1}function lineIntersectsLine(n,t){if(0===n.length||0===t.length)return!1;for(var e=0;e<n.length-1;e++)for(var r=n[e],o=n[e+1],i=0;i<t.length-1;i++){var l=t[i],u=t[i+1];if(lineSegmentIntersectsLineSegment(r,o,l,u))return!0}return!1}function lineSegmentIntersectsLineSegment(n,t,e,r){return isCounterClockwise(n,e,r)!==isCounterClockwise(t,e,r)&&isCounterClockwise(n,t,e)!==isCounterClockwise(n,t,r)}function pointIntersectsBufferedLine(n,t,e){var r=e*e;if(1===t.length)return n.distSqr(t[0])<r;for(var o=1;o<t.length;o++){if(distToSegmentSquared(n,t[o-1],t[o])<r)return!0}return!1}function distToSegmentSquared(n,t,e){var r=t.distSqr(e);if(0===r)return n.distSqr(t);var o=((n.x-t.x)*(e.x-t.x)+(n.y-t.y)*(e.y-t.y))/r;return o<0?n.distSqr(t):o>1?n.distSqr(e):n.distSqr(e.sub(t)._mult(o)._add(t))}function multiPolygonContainsPoint(n,t){for(var e,r,o,i=!1,l=0;l<n.length;l++){e=n[l];for(var u=0,s=e.length-1;u<e.length;s=u++)r=e[u],o=e[s],r.y>t.y!=o.y>t.y&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}function polygonContainsPoint(n,t){for(var e=!1,r=0,o=n.length-1;r<n.length;o=r++){var i=n[r],l=n[o];i.y>t.y!=l.y>t.y&&t.x<(l.x-i.x)*(t.y-i.y)/(l.y-i.y)+i.x&&(e=!e)}return e}var isCounterClockwise=require("./util").isCounterClockwise;module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared};
},{"./util":399}],388:[function(require,module,exports){
"use strict";var unicodeBlockLookup={"Latin-1 Supplement":function(n){return n>=128&&n<=255},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};module.exports=unicodeBlockLookup;
},{}],389:[function(require,module,exports){
"use strict";var LRUCache=function(t,e){this.max=t,this.onRemove=e,this.reset()};LRUCache.prototype.reset=function(){var t=this;for(var e in t.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},LRUCache.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var r=this.get(this.order[0]);r&&this.onRemove(r)}return this},LRUCache.prototype.has=function(t){return t in this.data},LRUCache.prototype.keys=function(){return this.order},LRUCache.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},LRUCache.prototype.getWithoutRemoving=function(t){return this.has(t)?this.data[t]:null},LRUCache.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},LRUCache.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var r=e.get(e.order[0]);r&&e.onRemove(r)}return this},module.exports=LRUCache;
},{}],390:[function(require,module,exports){
"use strict";function makeAPIURL(r,t,a,o){switch(r.protocol){case"minemap":var e=parseUrl(config.SRC_URL);r.protocol=e.protocol,r.authority=e.authority;break;case"minemapdata":var i=parseUrl(config.API_URL);r.path=i.path+r.authority+r.path,r.protocol=i.protocol,r.authority=i.authority;break;case"minemapdatad":var n=parseUrl(config.DYN_URL);r.path=n.path+r.authority+r.path,r.protocol=n.protocol,r.authority=n.authority;break;case"minemapdatam":var p=parseUrl(config.MERGE_URL);r.path=p.path+r.authority+r.path,r.protocol=p.protocol,r.authority=p.authority;break;case"minemapdatao":var s=parseUrl(config.OTHER_URL);r.path=s.path+r.authority+r.path,r.protocol=s.protocol,r.authority=s.authority}if(!config.REQUIRE_ACCESS_TOKEN)return formatUrl(r);if(t=t||config.ACCESS_TOKEN,a=a||config.SOLU,o=o||config.DATA_VERSION,!t)throw new Error("accessToken. "+help);return r.params.push("token="+t),r.params.push("solu="+a),o&&r.params.push("version="+o),formatUrl(r)}function isMinemapURL(r){return 0===r.indexOf("minemap:")||0===r.indexOf("minemapdata:")||0===r.indexOf("minemapdatad:")||0===r.indexOf("minemapdatam:")||0===r.indexOf("minemapdatao:")}function getVersion(){return"v"+version.substr(version.indexOf(".")+1)}function replaceTempAccessToken(r){for(var t=0;t<r.length;t++)0===r[t].indexOf("access_token=tk.")&&(r[t]="access_token="+(config.ACCESS_TOKEN||""))}function parseUrl(r){var t=r.match(urlRe);if(!t){var a=r.match(/^\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/);if(!a)throw new Error("Unable to parse URL object");return{protocol:"",authority:a[1],path:a[2]||"/",params:a[3]?a[3].split("&"):[]}}return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function formatUrl(r){var t=r.params.length?"?"+r.params.join("&"):"";return r.protocol&&r.params.protocol?r.protocol+"://"+r.authority+r.path+t:window.document.location.protocol+"//"+r.authority+r.path+t}var config=require("./config"),browser=require("./browser"),version=require("../../package.json").version,help="minedata.cn";exports.isMinemapURL=isMinemapURL,exports.normalizeStyleURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/styles/v1"+a.path,makeAPIURL(a,t)},exports.normalizeGlyphsURL=function(r,t){if(!isMinemapURL(r)&&!config.fontsUrl)return r;var a=parseUrl(r);return config.fontsUrl&&config.fontsUrl+"/{fontstack}"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"||config.SRC_URL+"fonts/{fontstack}/"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"},exports.normalizeSourceURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),makeAPIURL(a,t)},exports.normalizeSpriteURL=function(r,t,a,o){if(!isMinemapURL(r)&&!config.spriteUrl){return r+""+t+a}var e=parseUrl(r);return e.path="/minemapapi/"+getVersion()+e.path+"/sprite"+t+a,config.spriteUrl&&config.spriteUrl+""+t+a||config.DOMAIN+e.path};var imageExtensionRe=/(\.(png|jpg)\d*)(?=$)/;exports.normalizeTileURL=function(r,t,a){if(!r||!isMinemapURL(r))return r.startsWith("//")?""+window.document.location.protocol+r:r;var o=parseUrl(r),e=browser.devicePixelRatio>=2||512===a?"@2x":"",i=browser.supportsWebp?".webp":"$1";return o.path=o.path.replace(imageExtensionRe,""+e+i),replaceTempAccessToken(o.params),makeAPIURL(o)};var urlRe=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/;
},{"../../package.json":199,"./browser":372,"./config":376}],391:[function(require,module,exports){
"use strict";var util=require("../util/util"),lineString=require("@turf/turf").lineString,featureCollection=require("@turf/turf").featureCollection,point=require("@turf/turf").point,lineDistance=require("@turf/turf").lineDistance,lineChunk=require("@turf/turf").lineChunk,pointOnLine=require("@turf/turf").pointOnLine,matchTrack=require("./service").matchTrack,autoBind=require("./auto_bind"),window=require("../util/window"),layer_manager=require("./path_track/layer_manager"),defaultOptions=require("./path_track/option"),PathTrack=function(t){this.options=util.extend({},defaultOptions,t),this.options.map&&(autoBind(this),this._regEvent(),this.__catchIndex=-1,this.__mapLock=!1,this.__snapped=!1,this._prepareLayer())},prototypeAccessors={solidLine:{},animation:{}};PathTrack.prototype._regEvent=function(){if(this.options.type!==PathTrack.type.REALTIME){var t=this.options.map;t.dragPan.disable(),t.on("mousemove",this._mouseTrack),t.on("mousedown",this._mouseDown),
        t.on("mouseup",this._mouseUp),t.on("click",this._clickDown)}},PathTrack.prototype._unregEvent=function(){var t=this.options.map;t.off("mousemove",this._mouseTrack),t.off("mousedown",this._mouseDown),t.off("click",this._clickDown),t.off("mouseup",this._mouseUp)},PathTrack.prototype._prepareIds=function(){this._lineId="_lineId"+100*Math.random(),this._sourceId="_sourceId"+100*Math.random(),this._walkSource="_walkSource"+100*Math.random(),this._walkId="_walkId"+100*Math.random(),this._driveSource="_driveSource"+100*Math.random(),this._driveId="_driveId"+100*Math.random(),this._circleSource="_circleSource"+100*Math.random(),this._circleId="_circleId"+100*Math.random(),this._dragLineSource="_dragLineSource"+100*Math.random(),this._dragLineId="_dragLineId"+100*Math.random()},PathTrack.prototype._updateWalkData=function(){var t=this,i=[];if(this.options.mode===PathTrack.mode.WALK_PATH)for(var e=0;e<this.options.data.length-1;e++){var o=t.options.data;i.push(lineString([o[e],o[e+1]],{seq:e}))}this._walkData=featureCollection(i)},PathTrack.prototype._prepareLayer=function(){var t=this;this._prepareIds();var i=this.options.map;this._updateWalkData(),layer_manager.addSource(i,this._dragLineSource,lineString([[116.38,38.8],[115.99,40]])),layer_manager.addDragLineLayer(i,this._dragLineId,this._dragLineSource),layer_manager.addSource(i,this._sourceId,this._walkData),layer_manager.addPathLine(i,this._lineId,this._sourceId,this.options.lineWidth,"_"+this.options.lineColor+"1",this.options.solidLineColor,this.options.solidLine),layer_manager.addSource(i,this._circleSource,featureCollection([])),layer_manager.addAnchor(i,this._circleId,this._circleSource),this.options.mode===PathTrack.mode.WALK_PATH?(layer_manager.addSource(i,this._walkSource,featureCollection([])),layer_manager.addWalkLayer(i,this._walkId,this._walkSource,this.options.personIcon),this._showPath()):this.options.mode===PathTrack.mode.DRIVE_PATH&&(matchTrack(lineString(this.options.data),function(e,o){var a=util.extend({},o);t._driveData=a.data.rows[0],i.getSource(t._sourceId).setData(t._driveData),t._driveDataInOneLine=t._combineFeatureCollection(t._driveData),t._showPath(),
            t.options?t.options.callback(t,i):null},this.options.strategy,this.options.criteria),layer_manager.addSource(i,this._driveSource,featureCollection([])),layer_manager.addDriveLayer(i,this._driveId,this._driveSource,this.options.carIcon))},PathTrack.prototype._showPath=function(){this.options.lineVisible?this.showLine():this.hideLine(),this._genSplitLine(),this.options.animation?this._animate():this._cancelAnimate()},PathTrack.prototype.getData=function(){return this.options.data},PathTrack.prototype.getGeojson=function(){return this.options.type===PathTrack.type.REALTIME?this.options.map.querySourceFeatures(this._sourceId,{})[0]:this.options.mode===PathTrack.mode.WALK_PATH?this._walkData:this._driveData},prototypeAccessors.solidLine.set=function(t){this.options.solidLine=t;var i=this.options.map;t?layer_manager.addPathLine(i,this._lineId,this._sourceId,this.options.lineWidth,null,this.options.solidLineColor,!0,this._circleId):layer_manager.addPathLine(i,this._lineId,this._sourceId,this.options.lineWidth,"_"+this.options.lineColor+"1",this.options.solidLineColor,!1,this._circleId)},prototypeAccessors.solidLine.get=function(){return this.options.solidLine},prototypeAccessors.animation.set=function(t){this.options.animation=t,t?this._animate():this._cancelAnimate()},prototypeAccessors.animation.get=function(){return this.options.animation},PathTrack.prototype._animate=function(){this.__pattern=255,this.__count=0,this._startTime||this._endTime||(this._startTime=Date.now(),this._endTime=Date.now(),this._position=0),this._loop()},PathTrack.prototype._loop=function(){var t=this.options.map;this.options.type===PathTrack.type.HISTORY&&(this._endTime=Date.now(),this._endTime-this._startTime>=100&&(this._position++,
        this._lineChunkResult.features.length > this._position ? (t.getSource(this.options.mode===PathTrack.mode.WALK_PATH?this._walkSource:this._driveSource).setData(this._lineChunkResult.features[this._position])):this.hideActor(),this._startTime=this._endTime)),this.__count++,this.__count%this.options.lineSpeed!=0||this.options.solidLine||(this.__pattern--,this.__pattern<=0&&(this.__pattern=255),t.setPaintProperty(this._lineId,"line-pattern","_"+this.options.lineColor+(this.__pattern%4+1))),this.__count>=65535&&(this.__count=0),this._cancelAnimate(),this.animationFrame=window.requestAnimationFrame(this._loop)},PathTrack.prototype._cancelAnimate=function(){window.cancelAnimationFrame(this.animationFrame)},PathTrack.prototype.hideLine=function(){this._unregEvent(),this.options.lineVisible=!1;var t=this.options.map;t.dragPan.enable(),t.setLayoutProperty(this._lineId,"visibility","none")},PathTrack.prototype.showLine=function(){this._unregEvent(),this._regEvent();var t=this.options.map;this.options.lineVisible=!0,t.setLayoutProperty(this._lineId,"visibility","visible")},PathTrack.prototype.hideActor=function(){var t=this.options.map;this.options.actorVisible=!1,t.setLayoutProperty(this.options.mode===PathTrack.mode.WALK_PATH?this._walkId:this._driveId,"visibility","none")},PathTrack.prototype.showActor=function(){var t=this.options.map;this.options.actorVisible=!0,t.setLayoutProperty(this.options.mode===PathTrack.mode.WALK_PATH?this._walkId:this._driveId,"visibility","visible")},PathTrack.prototype.hideCircle=function(){this.options.map.setLayoutProperty(this._circleId,"visibility","none")},PathTrack.prototype.showCircle=function(){this.options.map.setLayoutProperty(this._circleId,"visibility","visible")},PathTrack.prototype._showDragLine=function(){this.options.map.setLayoutProperty(this._dragLineId,"visibility","visible")},PathTrack.prototype._hideDragLine=function(){this.options.map.setLayoutProperty(this._dragLineId,"visibility","none")},PathTrack.prototype.updatePosition=function(t){var i=this.options.map;this.options.type===PathTrack.type.REALTIME&&(this.options.mode===PathTrack.mode.WALK_PATH&&this.options.actorVisible?i.getSource(this._walkSource).setData(Array.isArray(t[0])?lineString(t):point(t)):this.options.mode===PathTrack.mode.DRIVE_PATH&&this.options.actorVisible&&i.getSource(this._driveSource).setData(Array.isArray(t[0])?lineString(t):point(t)))},PathTrack.prototype.updatePath=function(t){if(t&&this.options.type!==PathTrack.type.HISTORY){var i=this.options.map;this.options.lineVisible&&(this.options.data=t,i.getSource(this._sourceId).setData(lineString(t))),this.updatePosition(t[t.length-1])}},PathTrack.prototype.insertOnePointToThePath=function(t){if(t&&this.options.type!==PathTrack.type.HISTORY){var i=this.options.map;this.options.data.push(t),this.options.lineVisible&&i.getSource(this._sourceId).setData(lineString(this.options.data)),this.updatePosition(t)}},PathTrack.prototype._genSplitLine=function(){var t=10*this.options.duration,i=lineDistance(this.options.mode===PathTrack.mode.WALK_PATH?this._walkData:this._driveData,"kilometers");this.distances = i;this._lineChunkResult=lineChunk(this.options.mode===PathTrack.mode.WALK_PATH?this._walkData:this._driveData,i/t,"kilometers");var e=this.options.map,o=this.options.mode===PathTrack.mode.WALK_PATH?this._walkSource:this._driveSource;this.options.actorVisible?this.showActor():this.hideActor(),this.options.type===PathTrack.type.REALTIME?e.getSource(o).setData(this._lineChunkResult.features[this._lineChunkResult.features.length-1]):e.getSource(o).setData(this._lineChunkResult.features[0])},PathTrack.prototype.remove=function(){this._unregEvent();var t=this.options.map;this.animation=!1,layer_manager.removeAll(this,t),delete this.options},PathTrack.prototype._combineFeatureCollection=function(t){var i=[];return t.features.map(function(t){var e=t.geometry.coordinates;return i=i.concat(e),e}),lineString(i)},PathTrack.prototype._mouseTrack=function(t){var i=this.options.map;if(this.__mapLock)try{var e=this.options.data.slice(this.__catchIndex,this.__catchIndex+2);e.splice(1,0,t.lngLat.toArray()),i.getSource(this._dragLineSource).setData(lineString(e)),this._showDragLine()}catch(t){}else{var o=this.options.mode===PathTrack.mode.WALK_PATH?lineString(this.options.data):this._driveDataInOneLine,a=o?pointOnLine(o,point(t.lngLat.toArray()),"kilometers"):{properties:{dist:1e4}};i.dragPan.enable(),a.properties.dist<1e-4*Math.pow(2,22-this.options.map.getZoom())?(this.options.mousemove(t,this)):(this.options.mouseout(t,this))}},PathTrack.prototype._clickDown=function(t){var i=this,e=this.options.map;e.queryRenderedFeatures(t.point).map(function(t){t.layer.id===i._lineId&&(
        i.options.click(t,i))})},
        PathTrack.prototype._mouseDown=function(t){var i=this,e=this.options.map;e.queryRenderedFeatures(t.point).map(function(t){t.layer.id===i._lineId&&(
            i.options.mousedown(t,i))}),this.__snapped&&(e.getCanvas().style.cursor="move",this.__mapLock=!0,e.dragPan.disable())},PathTrack.prototype._mouseUp=function(t){var i=this,e=this.options.map;e.dragPan.enable(),this.__mapLock=!1,this.__snapped=!1,e.getCanvas().style.cursor="",this.options.mode===PathTrack.mode.DRIVE_PATH&&this.__catchIndex!==-1?(this.options.data.splice(this.__catchIndex+1,0,t.lngLat.toArray()),matchTrack(lineString(this.options.data),function(t,o){e.getSource(i._sourceId).setData(o.data.rows[0]),i._driveData=o.data.rows[0],i._driveDataInOneLine=i._combineFeatureCollection(i._driveData),i._showPath()},this.options.strategy,this.options.criteria)):this.options.mode===PathTrack.mode.WALK_PATH&&this.__catchIndex!==-1&&(this.options.data.splice(this.__catchIndex+1,0,t.lngLat.toArray()),this._updateWalkData(),e.getSource(this._sourceId).setData(this._walkData),this._showPath()),this._hideDragLine(),this.__catchIndex=-1},Object.defineProperties(PathTrack.prototype,prototypeAccessors),PathTrack.mode={WALK_PATH:1,DRIVE_PATH:2},PathTrack.type={HISTORY:1,REALTIME:2},PathTrack.strategy={SHORTEST_PATH:1,SHORTEST_TIME:2},PathTrack.criteria={NONE:0,AVOID_FEE:1,AVOID_HIGH_WAY:2},module.exports=PathTrack;
},{"../util/util":399,"../util/window":374,"./auto_bind":371,"./path_track/layer_manager":392,"./path_track/option":393,"./service":395,"@turf/turf":91}],392:[function(require,module,exports){
exports.addSource=function(e,r,o){e.getSource(r)&&e.removeSource(r),e.addSource(r,{type:"geojson",data:o})},exports.addDragLineLayer=function(e,r,o){var i={id:r,source:o,type:"line",layout:{visibility:"none"},paint:{"line-color":"#999999","line-width":3,"line-dasharray":[4,4]}};e.getLayer(r)&&e.removeLayer(r),e.addLayer(i)},exports.addPathLine=function(e,r,o,i,a,c,t,n){var d={id:r,type:"line",source:o,layout:{"line-join":"round","line-cap":"round",visibility:e.getLayer(r)?e.getLayoutProperty(r,"visibility"):"none"},paint:{"line-width":i,"line-color":c}};t||(d.paint["line-pattern"]=a),e.getLayer(r)&&e.removeLayer(r),n?e.addLayer(d,n):e.addLayer(d)},exports.addAnchor=function(e,r,o){var i={type:"circle",id:r,source:o,paint:{"circle-color":"#409203","circle-radius":6}};e.getLayer(r)&&e.removeLayer(r),e.addLayer(i)},exports.addWalkLayer=function(e,r,o,i){var a={id:r,type:"symbol",source:o,layout:{visibility:"none","icon-size":1,"icon-image":i}};e.getLayer(r)&&e.removeLayer(r),e.addLayer(a)},exports.addDriveLayer=function(e,r,o,i){var a={id:r,type:"symbol",source:o,layout:{visibility:"none","icon-size":1,"icon-image":i},paint:{"icon-color":"yellow"}};e.getLayer(r)&&e.removeLayer(r),e.addLayer(a)},exports.removeAll=function(e,r){r.getSource(e._sourceId)&&(r.removeSource(e._sourceId),r.removeLayer(e._lineId)),r.getSource(e._walkSource)&&(r.removeSource(e._walkSource),r.removeLayer(e._walkId)),r.getSource(e._driveSource)&&(r.removeSource(e._driveSource),r.removeLayer(e._driveId)),r.getSource(e._circleSource)&&(r.removeSource(e._circleSource),r.removeLayer(e._circleId)),r.getSource(e._dragLineSource)&&(r.removeSource(e._dragLineSource),r.removeLayer(e._dragLineId))};
},{}],393:[function(require,module,exports){
module.exports={map:null,data:[],mode:1,type:1,strategy:1,criteria:0,animation:!1,duration:60,lineSpeed:4,loop:1,solidLine:!1,solidLineColor:"blue",lineWidth:5,lineIcon:["_blue1","_blue2","_blue3","_blue4"],lineColor:"blue",personIcon:"event-app-1102-18",carIcon:"car-15",actorVisible:!0,lineVisible:!0};
},{}],394:[function(require,module,exports){
"use strict";var isChar=require("./is_char_in_unicode_block");module.exports.allowsIdeographicBreaking=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(!exports.charAllowsIdeographicBreaking(s.charCodeAt(0)))return!1}return!0},module.exports.allowsVerticalWritingMode=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(exports.charHasUprightVerticalOrientation(s.charCodeAt(0)))return!0}return!1},module.exports.charAllowsIdeographicBreaking=function(a){return!(a<11904)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!!isChar.Katakana(a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yi Radicals"](a)||!!isChar["Yi Syllables"](a))))))))))))))))))))},exports.charHasUprightVerticalOrientation=function(a){return 746===a||747===a||!(a<4352)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!(!isChar["CJK Compatibility Forms"](a)||a>=65097&&a<=65103)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!(!isChar["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Hangul Compatibility Jamo"](a)||(!!isChar["Hangul Jamo Extended-A"](a)||(!!isChar["Hangul Jamo Extended-B"](a)||(!!isChar["Hangul Jamo"](a)||(!!isChar["Hangul Syllables"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar.Kanbun(a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!(!isChar.Katakana(a)||12540===a)||(!(!isChar["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||(!(!isChar["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(!!isChar["Unified Canadian Aboriginal Syllabics"](a)||(!!isChar["Unified Canadian Aboriginal Syllabics Extended"](a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yijing Hexagram Symbols"](a)||(!!isChar["Yi Syllables"](a)||!!isChar["Yi Radicals"](a))))))))))))))))))))))))))))))},exports.charHasNeutralVerticalOrientation=function(a){return!(!isChar["Latin-1 Supplement"](a)||167!==a&&169!==a&&174!==a&&177!==a&&188!==a&&189!==a&&190!==a&&215!==a&&247!==a)||(!(!isChar["General Punctuation"](a)||8214!==a&&8224!==a&&8225!==a&&8240!==a&&8241!==a&&8251!==a&&8252!==a&&8258!==a&&8263!==a&&8264!==a&&8265!==a&&8273!==a)||(!!isChar["Letterlike Symbols"](a)||(!!isChar["Number Forms"](a)||(!(!isChar["Miscellaneous Technical"](a)||!(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||9003===a||a>=9085&&a<=9114||a>=9150&&a<=9165||9167===a||a>=9169&&a<=9179||a>=9186&&a<=9215))||(!(!isChar["Control Pictures"](a)||9251===a)||(!!isChar["Optical Character Recognition"](a)||(!!isChar["Enclosed Alphanumerics"](a)||(!!isChar["Geometric Shapes"](a)||(!(!isChar["Miscellaneous Symbols"](a)||a>=9754&&a<=9759)||(!(!isChar["Miscellaneous Symbols and Arrows"](a)||!(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243))||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar.Katakana(a)||(!!isChar["Private Use Area"](a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["Small Form Variants"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(8734===a||8756===a||8757===a||a>=9984&&a<=10087||a>=10102&&a<=10131||65532===a||65533===a)))))))))))))))))},exports.charHasRotatedVerticalOrientation=function(a){return!(exports.charHasUprightVerticalOrientation(a)||exports.charHasNeutralVerticalOrientation(a))};
},{"./is_char_in_unicode_block":388}],395:[function(require,module,exports){
"use strict";var ajax=require("./ajax"),config=require("./config"),TOKEN_VALUE="25cc55a69ea7422182d00d6b7c0ffa93",lineString=require("@turf/turf").lineString,featureCollection=require("@turf/turf").featureCollection,point=require("@turf/turf").point,polygon=require("@turf/turf").polygon,buffer=require("@turf/turf").buffer,envelope=require("@turf/turf").envelope,within=require("@turf/turf").within,joinParamToUrl=function(e){var r="";return e&&Object.keys(e).map(function(o){var t=e[o];"string"!=typeof t&&(t=JSON.stringify(t)),r+=o+"="+t+"&"}),r.endsWith("&")&&(r=r.substr(0,r.length-1)),r};exports.querySearchResultByType=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,pageNumber:t||1,pageCount:a||10,source:1},s=config.DOMAIN+"/service/search/keyword?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.queryAllSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"all",o,t,a)},exports.queryPoiSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"poi",o,t,a)},exports.queryPoiSearchResultByDataType=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,adCode:e,searchType:"poi",key:r,pageNumber:o||1,pageCount:t||10,source:1,dataType:a},s=config.DOMAIN+"/service/search/keyword?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.queryRoadSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"road",o,t,a)},exports.querySearchSurroundResult=function(e,r,o,t,a,n,i,s,u,c){var l={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,location:t,inRadius:1,spatialFuntion:a||"geofilt",radius:n||500,seq:i||0,source:1,pageNumber:s||1,pageCount:u||10},f=config.DOMAIN+"/service/search/surround?"+joinParamToUrl(l);return ajax.getJSON(f,c)},exports.querySearchBboxResult=function(e,r,o,t,a,n,i,s){var u={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,bounds:t,seq:a||0,source:1,pageNumber:n||1,pageCount:i||10},c=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(u);return ajax.getJSON(c,s)},exports.querySearchAroundResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,location:e,type:r||"poi",radius:o||1e3,count:t||5},i=config.DOMAIN+"/service/search/around?"+joinParamToUrl(n);return ajax.getJSON(i,a)},exports.queryRouteDrivingResult=function(e,r,o,t,a,n,i,s,u){var c={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||null,shpFlag:t||0,costModel:a||16,numAlt:n||1,criteria:i||0,traffic:s||0,source:1},l=config.DOMAIN+"/service/route/driving?"+joinParamToUrl(c);return ajax.getJSON(l,u)},exports.queryRouteBusResult=function(e,r,o,t,a,n,i){var s={token:TOKEN_VALUE,adCode:e,sPoint:r,ePoint:o,strategy:t||0,shpInfoFlag:a||0,showWalkInfo:n||0,source:1},u=config.DOMAIN+"/service/route/busTransfer?"+joinParamToUrl(s);return ajax.getJSON(u,i)},exports.queryAdminResultByPoint=function(e,r,o){var t={token:TOKEN_VALUE,location:e,geometry:r||0},a=config.DOMAIN+"/service/search/adminByPoint?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryGeoCodingResult=function(e,r,o){var t={token:TOKEN_VALUE,adCode:e,address:r,source:1},a=config.DOMAIN+"/service/coder/geocoding?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryReverseGeoCodingResult=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,location:e,type:r||1,radius:o||300,roadRadius:t||300,kind:a||0,source:1},s=config.DOMAIN+"/service/coder/reverseGeocoding?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.querySmartTipsResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,adCode:e,input:r,searchType:o||"all",pageCount:t||10},i=config.DOMAIN+"/service/tips/smartTips?"+joinParamToUrl(n);return ajax.getJSON(i,a)},exports.searchNameByKey=function(e,r){if(e){var o=config.serviceUrl+"/service/searchnamebykey/"+e;return ajax.getJSON(o,r)}},exports.searchRoadByName=function(e,r){if(e){var o=config.serviceUrl+"/service/searchroadbyname/"+e;return ajax.getJSON(o,r)}},exports.searchTrafficJam=function(e,r,o){if(e&&r){var t=config.serviceUrl+"/service/searchtrafficjam/";return ajax.postJSON(t,{polygon:JSON.stringify(e),dis:r},o)}},exports.searchCrossNameByKey=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossnamebykey/"+e;return ajax.getJSON(o,r)}},exports.searchCrossByName=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossbyname/"+e;return ajax.getJSON(o,r)}},exports.searchCrossById=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossbyid/"+e;return ajax.getJSON(o,r)}},exports.searchRoundCrossByName=function(e,r){if(e){var o=config.serviceUrl+"/service/searchroundcrossbyname/"+e;return ajax.getJSON(o,r)}},exports.searchRoundCrossById=function(e,r){if(e){var o=config.serviceUrl+"/service/searchroundcrossbyid/"+e;return ajax.getJSON(o,r)}},exports.searchCrossByCoord=function(e,r,o,t){if(e&&r&&o){var a=config.serviceUrl+"/service/searchcrossbycoord/"+e+"/"+r+"/"+o;return ajax.getJSON(a,t)}},exports.updateRticStatus=function(e,r,o,t){if(e&&r&&o){var a=config.serviceUrl+"/service/updatetricstatus/"+e+"/"+r+"/"+o;return ajax.getJSON(a,t)}},exports.matchTrack=function(e,r,o,t){if(e){var a=config.serviceUrl+"/service/matchtrack/";return ajax.postJSON(a,{line:JSON.stringify(e),costmodel:o,criteria:t},r)}},exports.queryFeaturesWithinBuffer=function(e,r,o,t,a,n,i,s){if(e&&r){var u=null;if(e instanceof Array)switch(r){case"point":u=buffer(point(e),o/1e3,"kilometers");break;case"line":u=buffer(lineString(e),o/1e3,"kilometers");break;case"polygon":u=buffer(polygon(e),o/1e3,"kilometers")}else u=buffer(e,o/1e3,"kilometers");var c=envelope(u),l=c.geometry.coordinates[0],f=l[0][0]+","+l[0][1]+","+l[2][0]+","+l[2][1],p={token:TOKEN_VALUE,adCode:t,searchType:"all",key:a,bounds:f,seq:0,source:1,pageNumber:n||1,pageCount:i||10},g=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(p);return ajax.getJSON(g,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,i=null;i="FeatureCollection"!==u.type?{type:"FeatureCollection",features:[u]}:u;within(featureCollection([point(n)]),i).features.length>0&&o.push(a)}r.data.rows=o,r.buffer=u,s(e,r)})}},exports.queryFeaturesWithinBufferByType=function(e,r,o,t,a,n,i,s,u){if(e&&r){var c=null;if(e instanceof Array)switch(r){case"point":c=buffer(point(e),o/1e3,"kilometers");break;case"line":c=buffer(lineString(e),o/1e3,"kilometers");break;case"polygon":c=buffer(polygon(e),o/1e3,"kilometers")}else c=buffer(e,o/1e3,"kilometers");var l=envelope(c),f=l.geometry.coordinates[0],p=f[0][0]+","+f[0][1]+","+f[2][0]+","+f[2][1],g={token:TOKEN_VALUE,adCode:t,searchType:n,key:a,bounds:p,seq:0,source:1,pageNumber:i||1,pageCount:s||10},y=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(g);return ajax.getJSON(y,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,i=null;i="FeatureCollection"!==c.type?{type:"FeatureCollection",features:[c]}:c;within(featureCollection([point(n)]),i).features.length>0&&o.push(a)}r.data.rows=o,r.buffer=c,u(e,r)})}},exports.queryFeaturesWithinGeometry=function(e,r,o,t,a,n){var i=null;i=e instanceof Array?polygon(e):e;var s=envelope(i),u=s.geometry.coordinates[0],c=u[0][0]+","+u[0][1]+","+u[2][0]+","+u[2][1],l={token:TOKEN_VALUE,adCode:r,searchType:"all",key:o,bounds:c,seq:0,source:1,pageNumber:t||1,pageCount:a||10},f=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(l);return ajax.getJSON(f,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],s=a.geom.coordinates,u=null;u="FeatureCollection"!==i.type?{type:"FeatureCollection",features:[i]}:i;within(featureCollection([point(s)]),u).features.length>0&&o.push(a)}r.data.rows=o,n(e,r)})},exports.queryFeaturesWithinGeometryByType=function(e,r,o,t,a,n,i){var s=null;s=e instanceof Array?polygon(e):e;var u=envelope(s),c=u.geometry.coordinates[0],l=c[0][0]+","+c[0][1]+","+c[2][0]+","+c[2][1],f={token:TOKEN_VALUE,adCode:r,key:o,bounds:l,searchType:t,seq:0,source:1,pageNumber:a||1,pageCount:n||10},p=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(f);return ajax.getJSON(p,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,u=null;u="FeatureCollection"!==s.type?{type:"FeatureCollection",features:[s]}:s;within(featureCollection([point(n)]),u).features.length>0&&o.push(a)}r.data.rows=o,i(e,r)})};
},{"./ajax":370,"./config":376,"@turf/turf":91}],396:[function(require,module,exports){
"use strict";function createStructArrayType(t){var e=JSON.stringify(t);if(structArrayTypeCache[e])return structArrayTypeCache[e];var r=void 0===t.alignment?1:t.alignment,i=0,n=0,a=["Uint8"],o=t.members.map(function(t){a.indexOf(t.type)<0&&a.push(t.type);var e=sizeOf(t.type),o=i=align(i,Math.max(r,e)),s=t.components||1;return n=Math.max(n,e),i+=e*s,{name:t.name,type:t.type,components:s,offset:o}}),s=align(i,Math.max(n,r)),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Struct);p.prototype.alignment=r,p.prototype.size=s;for(var y=0,c=o;y<c.length;y+=1)for(var h=c[y],u=0;u<h.components;u++){var f=h.name+(1===h.components?"":u);Object.defineProperty(p.prototype,f,{get:createGetter(h,u),set:createSetter(h,u)})}var m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(StructArray);return m.prototype.members=o,m.prototype.StructType=p,m.prototype.bytesPerElement=s,m.prototype.emplaceBack=createEmplaceBack(o,s),m.prototype._usedTypes=a,structArrayTypeCache[e]=m,m}function align(t,e){return Math.ceil(t/e)*e}function sizeOf(t){return viewTypes[t].BYTES_PER_ELEMENT}function getArrayViewName(t){return t.toLowerCase()}function createEmplaceBack(t,e){for(var r=[],i=[],n="var i = this.length;\nthis.resize(this.length + 1);\n",a=0,o=t;a<o.length;a+=1){var s=o[a],p=sizeOf(s.type);r.indexOf(p)<0&&(r.push(p),n+="var o"+p.toFixed(0)+" = i * "+(e/p).toFixed(0)+";\n");for(var y=0;y<s.components;y++){var c="v"+i.length,h="o"+p.toFixed(0)+" + "+(s.offset/p+y).toFixed(0);n+="this."+getArrayViewName(s.type)+"["+h+"] = "+c+";\n",i.push(c)}}return n+="return i;",new Function(i.toString(),n)}function createMemberComponentString(t,e){var r="this._pos"+sizeOf(t.type).toFixed(0),i=(t.offset/sizeOf(t.type)+e).toFixed(0),n=r+" + "+i;return"this._structArray."+getArrayViewName(t.type)+"["+n+"]"}function createGetter(t,e){return new Function("return "+createMemberComponentString(t,e)+";")}function createSetter(t,e){return new Function("x",createMemberComponentString(t,e)+" = x;")}module.exports=createStructArrayType;var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},Struct=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},DEFAULT_CAPACITY=128,RESIZE_MULTIPLIER=5,StructArray=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};StructArray.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},StructArray.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},StructArray.prototype.get=function(t){return new this.StructType(this,t)},StructArray.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},StructArray.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(this.capacity*RESIZE_MULTIPLIER),DEFAULT_CAPACITY),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},StructArray.prototype._refreshViews=function(){for(var t=this,e=0,r=t._usedTypes;e<r.length;e+=1){var i=r[e];t[getArrayViewName(i)]=new viewTypes[i](t.arrayBuffer)}},StructArray.prototype.toArray=function(t,e){for(var r=this,i=[],n=t;n<e;n++){var a=r.get(n);i.push(a)}return i};var structArrayTypeCache={};
},{}],397:[function(require,module,exports){
var TextureCache=function(e){this.cache=[],this.gl=e};TextureCache.prototype._isRepeat=function(e){return!1},TextureCache.prototype._hasTexture=function(e){return!1},TextureCache.prototype.getTextureById=function(e,t,r){for(var T=this,a=0;a<this.cache.length;a++){var i=T.cache[a];if(i.id===e)return i.texture}return t&&this._addOne(e,r),null},TextureCache.prototype._addOne=function(e,t){var r=new Image,T=this,a=this.gl;r.onload=function(){var t=a.createTexture();a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),a.bindTexture(a.TEXTURE_2D,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,r),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,0),T.cache.push({id:e,texture:t,img:r})},r.src=t},TextureCache.prototype.setTextureById=function(e,t){this.gl;this.getTextureById(e)||this._addOne(e,t)},TextureCache.prototype.makeTextureAtlas=function(){},TextureCache.prototype.setTexture=function(e,t){this._isRepeat(t)},TextureCache.prototype.removeTextureById=function(e){this._hasTexture(e)&&this.cache.splice(0,0,1)},TextureCache.prototype.clear=function(){delete this.cache},module.exports=TextureCache;
},{}],398:[function(require,module,exports){
"use strict";function resolveTokens(e,n){return n.replace(/{([^{}]+)}/g,function(n,r){return r in e?e[r]:""})}module.exports=resolveTokens;
},{}],399:[function(require,module,exports){
"use strict";var UnitBezier=require("@minemap/unitbezier"),Coordinate=require("../geo/coordinate"),Point=require("point-geometry");exports.easeCubicInOut=function(r){if(r<=0)return 0;if(r>=1)return 1;var e=r*r,t=e*r;return 4*(r<.5?t:3*(r-e)+t-.75)},exports.bezier=function(r,e,t,n){var o=new UnitBezier(r,e,t,n);return function(r){return o.solve(r)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.clamp=function(r,e,t){return Math.min(t,Math.max(e,r))},exports.wrap=function(r,e,t){var n=t-e,o=((r-e)%n+n)%n+e;return o===e?t:o},exports.asyncAll=function(r,e,t){if(!r.length)return t(null,[]);var n=r.length,o=new Array(r.length),a=null;r.forEach(function(r,i){e(r,function(r,e){r&&(a=r),o[i]=e,0==--n&&t(a,o)})})},exports.values=function(r){var e=[];for(var t in r)e.push(r[t]);return e},exports.keysDifference=function(r,e){var t=[];for(var n in r)n in e||t.push(n);return t},exports.extend=function(r,e,t,n){for(var o=arguments,a=1;a<arguments.length;a++){var i=o[a];for(var u in i)r[u]=i[u]}return r},exports.pick=function(r,e){for(var t={},n=0;n<e.length;n++){var o=e[n];o in r&&(t[o]=r[o])}return t};var id=1;exports.uniqueId=function(){return id++},exports.bindAll=function(r,e){r.forEach(function(r){e[r]&&(e[r]=e[r].bind(e))})},exports.getCoordinatesCenter=function(r){for(var e=1/0,t=1/0,n=-(1/0),o=-(1/0),a=0;a<r.length;a++)e=Math.min(e,r[a].column),t=Math.min(t,r[a].row),n=Math.max(n,r[a].column),o=Math.max(o,r[a].row);var i=n-e,u=o-t,s=Math.max(i,u);return new Coordinate((e+n)/2,(t+o)/2,0).zoomTo(Math.floor(-Math.log(s)/Math.LN2))},exports.endsWith=function(r,e){return r.indexOf(e,r.length-e.length)!==-1},exports.mapObject=function(r,e,t){var n=this,o={};for(var a in r)o[a]=e.call(t||n,r[a],a,r);return o},exports.filterObject=function(r,e,t){var n=this,o={};for(var a in r)e.call(t||n,r[a],a,r)&&(o[a]=r[a]);return o},exports.deepEqual=function(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!exports.deepEqual(r[t],e[t]))return!1;return!0}if("object"==typeof r&&null!==r&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(r).length!==Object.keys(e).length)return!1;for(var n in r)if(!exports.deepEqual(r[n],e[n]))return!1;return!0}return r===e},exports.clone=function(r){return Array.isArray(r)?r.map(exports.clone):"object"==typeof r&&r?exports.mapObject(r,exports.clone):r},exports.arraysIntersect=function(r,e){for(var t=0;t<r.length;t++)if(e.indexOf(r[t])>=0)return!0;return!1};var warnOnceHistory={};exports.warnOnce=function(r){warnOnceHistory[r]||(warnOnceHistory[r]=!0)},exports.isCounterClockwise=function(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)},exports.calculateSignedArea=function(r){for(var e=0,t=0,n=r.length,o=n-1,a=void 0,i=void 0;t<n;o=t++)a=r[t],i=r[o],e+=(i.x-a.x)*(a.y+i.y);return e},exports.isClosedPolygon=function(r){if(r.length<4)return!1;var e=r[0],t=r[r.length-1];return!(Math.abs(e.x-t.x)>0||Math.abs(e.y-t.y)>0)&&Math.abs(exports.calculateSignedArea(r))>.01},exports.sphericalToCartesian=function(r){var e=r[0],t=r[1],n=r[2];return t+=90,t*=Math.PI/180,n*=Math.PI/180,[e*Math.cos(t)*Math.sin(n),e*Math.sin(t)*Math.sin(n),e*Math.cos(n)]},exports.parseCacheControl=function(r){var e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(r,t,n,o){var a=n||o;return e[t]=!a||a.toLowerCase(),""}),e["max-age"]){var t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e};
},{"../geo/coordinate":226,"@minemap/unitbezier":4,"point-geometry":154}],400:[function(require,module,exports){
"use strict";var Feature=function(e,t,r,o){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=o,this.properties=e.properties,null!=e.id&&(this.id=e.id)},prototypeAccessors={geometry:{}};prototypeAccessors.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},prototypeAccessors.geometry.set=function(e){this._geometry=e},Feature.prototype.toJSON=function(){var e=this,t={geometry:this.geometry};for(var r in e)"_geometry"!==r&&"_vectorTileFeature"!==r&&(t[r]=e[r]);return t},Object.defineProperties(Feature.prototype,prototypeAccessors),module.exports=Feature;
},{}],401:[function(require,module,exports){
"use strict";var scriptDetection=require("./script_detection");module.exports=function(t){for(var o="",e=0;e<t.length;e++){var r=t.charCodeAt(e+1)||null,l=t.charCodeAt(e-1)||null;(!r||!scriptDetection.charHasRotatedVerticalOrientation(r)||module.exports.lookup[t[e+1]])&&(!l||!scriptDetection.charHasRotatedVerticalOrientation(l)||module.exports.lookup[t[e-1]])&&module.exports.lookup[t[e]]?o+=module.exports.lookup[t[e]]:o+=t[e]}return o},module.exports.lookup={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};
},{"./script_detection":394}],402:[function(require,module,exports){
"use strict";var WebWorker=require("./web_worker"),WorkerPool=function(){this.active={}};WorkerPool.prototype.acquire=function(r){var e=this;if(!this.workers){var o=require("../").workerCount;for(this.workers=[];this.workers.length<o;)e.workers.push(new WebWorker)}return this.active[r]=!0,this.workers.slice()},WorkerPool.prototype.release=function(r){delete this.active[r],0===Object.keys(this.active).length&&(this.workers.forEach(function(r){r.terminate()}),this.workers=null)},module.exports=WorkerPool;
},{"../":230,"./web_worker":373}]},{},[230])(230)
});


//# sourceMappingURL=minemap.js.map