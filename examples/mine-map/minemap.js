(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.minemap = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
function clamp_css_byte(e){return e=Math.round(e),e<0?0:e>255?255:e}function clamp_css_float(e){return e<0?0:e>1?1:e}function parse_css_int(e){return clamp_css_byte("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function parse_css_float(e){return clamp_css_float("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function css_hue_to_rgb(e,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?e+(r-e)*l*6:2*l<1?r:3*l<2?e+(r-e)*(2/3-l)*6:e}function parseCSSColor(e){var r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0]){if(4===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null}if(7===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null}return null}var a=r.indexOf("("),t=r.indexOf(")");if(-1!==a&&t+1===r.length){var n=r.substr(0,a),s=r.substr(a+1,t-(a+1)).split(","),o=1;switch(n){case"rgba":if(4!==s.length)return null;o=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),o];case"hsla":if(4!==s.length)return null;o=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var i=(parseFloat(s[0])%360+360)%360/360,u=parse_css_float(s[1]),g=parse_css_float(s[2]),d=g<=.5?g*(u+1):g+u-g*u,c=2*g-d;return[clamp_css_byte(255*css_hue_to_rgb(c,d,i+1/3)),clamp_css_byte(255*css_hue_to_rgb(c,d,i)),clamp_css_byte(255*css_hue_to_rgb(c,d,i-1/3)),o];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}
},{}],2:[function(_dereq_,module,exports){
"use strict";function earcut(e,n,t){t=t||2;var r=n&&n.length,i=r?n[0]*t:e.length,x=linkedList(e,0,i,t,!0),a=[];if(!x)return a;var o,l,u,s,v,f,y;if(r&&(x=eliminateHoles(e,n,x,t)),e.length>80*t){o=u=e[0],l=s=e[1];for(var d=t;d<i;d+=t)v=e[d],f=e[d+1],v<o&&(o=v),f<l&&(l=f),v>u&&(u=v),f>s&&(s=f);y=Math.max(u-o,s-l),y=0!==y?1/y:0}return earcutLinked(x,a,t,o,l,y),a}function linkedList(e,n,t,r,i){var x,a;if(i===signedArea(e,n,t,r)>0)for(x=n;x<t;x+=r)a=insertNode(x,e[x],e[x+1],a);else for(x=t-r;x>=n;x-=r)a=insertNode(x,e[x],e[x+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function earcutLinked(e,n,t,r,i,x,a){if(e){!a&&x&&indexCurve(e,r,i,x);for(var o,l,u=e;e.prev!==e.next;)if(o=e.prev,l=e.next,x?isEarHashed(e,r,i,x):isEar(e))n.push(o.i/t),n.push(e.i/t),n.push(l.i/t),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?(e=cureLocalIntersections(e,n,t),earcutLinked(e,n,t,r,i,x,2)):2===a&&splitEarcut(e,n,t,r,i,x):earcutLinked(filterPoints(e),n,t,r,i,x,1);break}}}function isEar(e){var n=e.prev,t=e,r=e.next;if(area(n,t,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(n.x,n.y,t.x,t.y,r.x,r.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,n,t,r){var i=e.prev,x=e,a=e.next;if(area(i,x,a)>=0)return!1;for(var o=i.x<x.x?i.x<a.x?i.x:a.x:x.x<a.x?x.x:a.x,l=i.y<x.y?i.y<a.y?i.y:a.y:x.y<a.y?x.y:a.y,u=i.x>x.x?i.x>a.x?i.x:a.x:x.x>a.x?x.x:a.x,s=i.y>x.y?i.y>a.y?i.y:a.y:x.y>a.y?x.y:a.y,v=zOrder(o,l,n,t,r),f=zOrder(u,s,n,t,r),y=e.nextZ;y&&y.z<=f;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(y=e.prevZ;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}return!0}function cureLocalIntersections(e,n,t){var r=e;do{var i=r.prev,x=r.next.next;!equals(i,x)&&intersects(i,r,r.next,x)&&locallyInside(i,x)&&locallyInside(x,i)&&(n.push(i.i/t),n.push(r.i/t),n.push(x.i/t),removeNode(r),removeNode(r.next),r=e=x),r=r.next}while(r!==e);return r}function splitEarcut(e,n,t,r,i,x){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var l=splitPolygon(a,o);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,n,t,r,i,x),void earcutLinked(l,n,t,r,i,x)}o=o.next}a=a.next}while(a!==e)}function eliminateHoles(e,n,t,r){var i,x,a,o,l,u=[];for(i=0,x=n.length;i<x;i++)a=n[i]*r,o=i<x-1?n[i+1]*r:e.length,l=linkedList(e,a,o,r,!1),l===l.next&&(l.steiner=!0),u.push(getLeftmost(l));for(u.sort(compareX),i=0;i<u.length;i++)eliminateHole(u[i],t),t=filterPoints(t,t.next);return t}function compareX(e,n){return e.x-n.x}function eliminateHole(e,n){if(n=findHoleBridge(e,n)){var t=splitPolygon(n,e);filterPoints(t,t.next)}}function findHoleBridge(e,n){var t,r=n,i=e.x,x=e.y,a=-1/0;do{if(x<=r.y&&x>=r.next.y&&r.next.y!==r.y){var o=r.x+(x-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a){if(a=o,o===i){if(x===r.y)return r;if(x===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!t)return null;if(i===a)return t.prev;var l,u=t,s=t.x,v=t.y,f=1/0;for(r=t.next;r!==u;)i>=r.x&&r.x>=s&&i!==r.x&&pointInTriangle(x<v?i:a,x,s,v,x<v?a:i,x,r.x,r.y)&&((l=Math.abs(x-r.y)/(i-r.x))<f||l===f&&r.x>t.x)&&locallyInside(r,e)&&(t=r,f=l),r=r.next;return t}function indexCurve(e,n,t,r){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,n,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var n,t,r,i,x,a,o,l,u=1;do{for(t=e,e=null,x=null,a=0;t;){for(a++,r=t,o=0,n=0;n<u&&(o++,r=r.nextZ);n++);for(l=u;o>0||l>0&&r;)0!==o&&(0===l||!r||t.z<=r.z)?(i=t,t=t.nextZ,o--):(i=r,r=r.nextZ,l--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;t=r}x.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,n,t,r,i){return e=32767*(e-t)*i,n=32767*(n-r)*i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),e|n<<1}function getLeftmost(e){var n=e,t=e;do{n.x<t.x&&(t=n),n=n.next}while(n!==e);return t}function pointInTriangle(e,n,t,r,i,x,a,o){return(i-a)*(n-o)-(e-a)*(x-o)>=0&&(e-a)*(r-o)-(t-a)*(n-o)>=0&&(t-a)*(x-o)-(i-a)*(r-o)>=0}function isValidDiagonal(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!intersectsPolygon(e,n)&&locallyInside(e,n)&&locallyInside(n,e)&&middleInside(e,n)}function area(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function equals(e,n){return e.x===n.x&&e.y===n.y}function intersects(e,n,t,r){return!!(equals(e,n)&&equals(t,r)||equals(e,r)&&equals(t,n))||area(e,n,t)>0!=area(e,n,r)>0&&area(t,r,e)>0!=area(t,r,n)>0}function intersectsPolygon(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&intersects(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function locallyInside(e,n){return area(e.prev,e,e.next)<0?area(e,n,e.next)>=0&&area(e,e.prev,n)>=0:area(e,n,e.prev)<0||area(e,e.next,n)<0}function middleInside(e,n){var t=e,r=!1,i=(e.x+n.x)/2,x=(e.y+n.y)/2;do{t.y>x!=t.next.y>x&&t.next.y!==t.y&&i<(t.next.x-t.x)*(x-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}function splitPolygon(e,n){var t=new Node(e.i,e.x,e.y),r=new Node(n.i,n.x,n.y),i=e.next,x=n.prev;return e.next=n,n.prev=e,t.next=i,i.prev=t,r.next=t,t.prev=r,x.next=r,r.prev=x,r}function insertNode(e,n,t,r){var i=new Node(e,n,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,n,t,r){for(var i=0,x=n,a=t-r;x<t;x+=r)i+=(e[a]-e[x])*(e[x+1]+e[a+1]),a=x;return i}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(e,n,t,r){var i=n&&n.length,x=i?n[0]*t:e.length,a=Math.abs(signedArea(e,0,x,t));if(i)for(var o=0,l=n.length;o<l;o++){var u=n[o]*t,s=o<l-1?n[o+1]*t:e.length;a-=Math.abs(signedArea(e,u,s,t))}var v=0;for(o=0;o<r.length;o+=3){var f=r[o]*t,y=r[o+1]*t,d=r[o+2]*t;v+=Math.abs((e[f]-e[d])*(e[y+1]-e[f+1])-(e[f]-e[y])*(e[d+1]-e[f+1]))}return 0===a&&0===v?0:Math.abs((v-a)/a)},earcut.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,i=0;i<e.length;i++){for(var x=0;x<e[i].length;x++)for(var a=0;a<n;a++)t.vertices.push(e[i][x][a]);i>0&&(r+=e[i-1].length,t.holes.push(r))}return t};
},{}],3:[function(_dereq_,module,exports){
function sss(r){var e,t,s,n,u,a;switch(typeof r){case"object":if(null===r)return null;if(isArray(r)){for(s="[",t=r.length-1,e=0;e<t;e++)s+=sss(r[e])+",";return t>-1&&(s+=sss(r[e])),s+"]"}for(n=objKeys(r).sort(),t=n.length,s="{",u=n[e=0],a=t>0&&void 0!==r[u];e<t;)a?(s+='"'+u.replace(strReg,strReplace)+'":'+sss(r[u]),u=n[++e],(a=e<t&&void 0!==r[u])&&(s+=",")):(u=n[++e],a=e<t&&void 0!==r[u]);return s+"}";case"undefined":return null;case"string":return'"'+r.replace(strReg,strReplace)+'"';default:return r}}var toString={}.toString,isArray=Array.isArray||function(r){return"[object Array]"===toString.call(r)},objKeys=Object.keys||function(r){var e=[];for(var t in r)r.hasOwnProperty(t)&&e.push(t);return e},strReg=/[\u0000-\u001f"\\]/g,strReplace=function(r){var e=r.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};module.exports=function(r){if(void 0!==r)return""+sss(r)},module.exports.stringSearch=strReg,module.exports.stringReplace=strReplace;
},{}],4:[function(_dereq_,module,exports){
"use strict";function GridIndex(t,r,e){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],r=i[1],e=i[2],this.d=r+2*e;for(var h=0;h<this.d*this.d;h++){var n=i[NUM_PARAMS+h],o=i[NUM_PARAMS+h+1];s.push(n===o?null:i.subarray(n,o))}var l=i[NUM_PARAMS+s.length],a=i[NUM_PARAMS+s.length+1];this.keys=i.subarray(l,a),this.bboxes=i.subarray(a),this.insert=this._insertReadonly}else{this.d=r+2*e;for(var d=0;d<this.d*this.d;d++)s.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=e,this.scale=r/t,this.uid=0;var f=e/r*t;this.min=-f,this.max=t+f}module.exports=GridIndex;var NUM_PARAMS=3;GridIndex.prototype.insert=function(t,r,e,s,i){this._forEachCell(r,e,s,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(i)},GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},GridIndex.prototype._insertCell=function(t,r,e,s,i,h){this.cells[i].push(h)},GridIndex.prototype.query=function(t,r,e,s){var i=this.min,h=this.max;if(t<=i&&r<=i&&h<=e&&h<=s)return Array.prototype.slice.call(this.keys);var n=[],o={};return this._forEachCell(t,r,e,s,this._queryCell,n,o),n},GridIndex.prototype._queryCell=function(t,r,e,s,i,h,n){var o=this.cells[i];if(null!==o)for(var l=this.keys,a=this.bboxes,d=0;d<o.length;d++){var f=o[d];if(void 0===n[f]){var u=4*f;t<=a[u+2]&&r<=a[u+3]&&e>=a[u+0]&&s>=a[u+1]?(n[f]=!0,h.push(l[f])):n[f]=!1}}},GridIndex.prototype._forEachCell=function(t,r,e,s,i,h,n){for(var o=this._convertToCellCoord(t),l=this._convertToCellCoord(r),a=this._convertToCellCoord(e),d=this._convertToCellCoord(s),f=o;f<=a;f++)for(var u=l;u<=d;u++){var y=this.d*u+f;if(i.call(this,t,r,e,s,y,h,n))return}},GridIndex.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,r=NUM_PARAMS+this.cells.length+1+1,e=0,s=0;s<this.cells.length;s++)e+=this.cells[s].length;var i=new Int32Array(r+e+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var h=r,n=0;n<t.length;n++){var o=t[n];i[NUM_PARAMS+n]=h,i.set(o,h),h+=o.length}return i[NUM_PARAMS+t.length]=h,i.set(this.keys,h),h+=this.keys.length,i[NUM_PARAMS+t.length+1]=h,i.set(this.bboxes,h),h+=this.bboxes.length,i.buffer};
},{}],5:[function(_dereq_,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],6:[function(_dereq_,module,exports){
"use strict";function kdbush(t,i,e,s,n){return new KDBush(t,i,e,s,n)}function KDBush(t,i,e,s,n){i=i||defaultGetX,e=e||defaultGetY,n=n||Array,this.nodeSize=s||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var r=0;r<t.length;r++)this.ids[r]=r,this.coords[2*r]=i(t[r]),this.coords[2*r+1]=e(t[r]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}var sort=_dereq_("./sort"),range=_dereq_("./range"),within=_dereq_("./within");module.exports=kdbush,KDBush.prototype={range:function(t,i,e,s){return range(this.ids,this.coords,t,i,e,s,this.nodeSize)},within:function(t,i,e){return within(this.ids,this.coords,t,i,e,this.nodeSize)}};
},{"./range":7,"./sort":8,"./within":9}],7:[function(_dereq_,module,exports){
"use strict";function range(p,r,s,u,h,e,o){for(var a,t,n=[0,p.length-1,0],f=[];n.length;){var l=n.pop(),v=n.pop(),g=n.pop();if(v-g<=o)for(var i=g;i<=v;i++)a=r[2*i],t=r[2*i+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[i]);else{var c=Math.floor((g+v)/2);a=r[2*c],t=r[2*c+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[c]);var d=(l+1)%2;(0===l?s<=a:u<=t)&&(n.push(g),n.push(c-1),n.push(d)),(0===l?h>=a:e>=t)&&(n.push(c+1),n.push(v),n.push(d))}}return f}module.exports=range;
},{}],8:[function(_dereq_,module,exports){
"use strict";function sortKD(t,a,o,s,r,e){if(!(r-s<=o)){var f=Math.floor((s+r)/2);select(t,a,f,s,r,e%2),sortKD(t,a,o,s,f-1,e+1),sortKD(t,a,o,f+1,r,e+1)}}function select(t,a,o,s,r,e){for(;r>s;){if(r-s>600){var f=r-s+1,p=o-s+1,w=Math.log(f),m=.5*Math.exp(2*w/3),n=.5*Math.sqrt(w*m*(f-m)/f)*(p-f/2<0?-1:1);select(t,a,o,Math.max(s,Math.floor(o-p*m/f+n)),Math.min(r,Math.floor(o+(f-p)*m/f+n)),e)}var c=a[2*o+e],h=s,i=r;for(swapItem(t,a,s,o),a[2*r+e]>c&&swapItem(t,a,s,r);h<i;){for(swapItem(t,a,h,i),h++,i--;a[2*h+e]<c;)h++;for(;a[2*i+e]>c;)i--}a[2*s+e]===c?swapItem(t,a,s,i):(i++,swapItem(t,a,i,r)),i<=o&&(s=i+1),o<=i&&(r=i-1)}}function swapItem(t,a,o,s){swap(t,o,s),swap(a,2*o,2*s),swap(a,2*o+1,2*s+1)}function swap(t,a,o){var s=t[a];t[a]=t[o],t[o]=s}module.exports=sortKD;
},{}],9:[function(_dereq_,module,exports){
"use strict";function within(s,p,r,t,u,h){for(var i=[0,s.length-1,0],o=[],n=u*u;i.length;){var e=i.pop(),a=i.pop(),f=i.pop();if(a-f<=h)for(var v=f;v<=a;v++)sqDist(p[2*v],p[2*v+1],r,t)<=n&&o.push(s[v]);else{var l=Math.floor((f+a)/2),c=p[2*l],q=p[2*l+1];sqDist(c,q,r,t)<=n&&o.push(s[l]);var D=(e+1)%2;(0===e?r-u<=c:t-u<=q)&&(i.push(f),i.push(l-1),i.push(D)),(0===e?r+u>=c:t+u>=q)&&(i.push(l+1),i.push(a),i.push(D))}}return o}function sqDist(s,p,r,t){var u=s-r,h=p-t;return u*u+h*h}module.exports=within;
},{}],10:[function(_dereq_,module,exports){
function isObjectLike(r){return!!r&&"object"==typeof r}function arraySome(r,e){for(var a=-1,t=r.length;++a<t;)if(e(r[a],a,r))return!0;return!1}function baseIsEqual(r,e,a,t,o,n){return r===e||(null==r||null==e||!isObject(r)&&!isObjectLike(e)?r!==r&&e!==e:baseIsEqualDeep(r,e,baseIsEqual,a,t,o,n))}function baseIsEqualDeep(r,e,a,t,o,n,u){var c=isArray(r),s=isArray(e),i=arrayTag,g=arrayTag;c||(i=objToString.call(r),i==argsTag?i=objectTag:i!=objectTag&&(c=isTypedArray(r))),s||(g=objToString.call(e),g==argsTag?g=objectTag:g!=objectTag&&(s=isTypedArray(e)));var b=i==objectTag,l=g==objectTag,f=i==g;if(f&&!c&&!b)return equalByTag(r,e,i);if(!o){var y=b&&hasOwnProperty.call(r,"__wrapped__"),T=l&&hasOwnProperty.call(e,"__wrapped__");if(y||T)return a(y?r.value():r,T?e.value():e,t,o,n,u)}if(!f)return!1;n||(n=[]),u||(u=[]);for(var j=n.length;j--;)if(n[j]==r)return u[j]==e;n.push(r),u.push(e);var p=(c?equalArrays:equalObjects)(r,e,a,t,o,n,u);return n.pop(),u.pop(),p}function equalArrays(r,e,a,t,o,n,u){var c=-1,s=r.length,i=e.length;if(s!=i&&!(o&&i>s))return!1;for(;++c<s;){var g=r[c],b=e[c],l=t?t(o?b:g,o?g:b,c):void 0;if(void 0!==l){if(l)continue;return!1}if(o){if(!arraySome(e,function(r){return g===r||a(g,r,t,o,n,u)}))return!1}else if(g!==b&&!a(g,b,t,o,n,u))return!1}return!0}function equalByTag(r,e,a){switch(a){case boolTag:case dateTag:return+r==+e;case errorTag:return r.name==e.name&&r.message==e.message;case numberTag:return r!=+r?e!=+e:r==+e;case regexpTag:case stringTag:return r==e+""}return!1}function equalObjects(r,e,a,t,o,n,u){var c=keys(r),s=c.length;if(s!=keys(e).length&&!o)return!1;for(var i=s;i--;){var g=c[i];if(!(o?g in e:hasOwnProperty.call(e,g)))return!1}for(var b=o;++i<s;){g=c[i];var l=r[g],f=e[g],y=t?t(o?f:l,o?l:f,g):void 0;if(!(void 0===y?a(l,f,t,o,n,u):y))return!1;b||(b="constructor"==g)}if(!b){var T=r.constructor,j=e.constructor;if(T!=j&&"constructor"in r&&"constructor"in e&&!("function"==typeof T&&T instanceof T&&"function"==typeof j&&j instanceof j))return!1}return!0}function isObject(r){var e=typeof r;return!!r&&("object"==e||"function"==e)}var isArray=_dereq_("lodash.isarray"),isTypedArray=_dereq_("lodash.istypedarray"),keys=_dereq_("lodash.keys"),argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=baseIsEqual;
},{"lodash.isarray":14,"lodash.istypedarray":16,"lodash.keys":17}],11:[function(_dereq_,module,exports){
function bindCallback(n,t,r){if("function"!=typeof n)return identity;if(void 0===t)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,c){return n.call(t,r,e,u,c)};case 5:return function(r,e,u,c,i){return n.call(t,r,e,u,c,i)}}return function(){return n.apply(t,arguments)}}function identity(n){return n}module.exports=bindCallback;
},{}],12:[function(_dereq_,module,exports){
function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,o){var e=null==t?void 0:t[o];return isNative(e)?e:void 0}function isFunction(t){return isObject(t)&&objToString.call(t)==funcTag}function isObject(t){var o=typeof t;return!!t&&("object"==o||"function"==o)}function isNative(t){return null!=t&&(isFunction(t)?reIsNative.test(fnToString.call(t)):isObjectLike(t)&&reIsHostCtor.test(t))}var funcTag="[object Function]",reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=getNative;
},{}],13:[function(_dereq_,module,exports){
function isArguments(t){return isArrayLikeObject(t)&&hasOwnProperty.call(t,"callee")&&(!propertyIsEnumerable.call(t,"callee")||objectToString.call(t)==argsTag)}function isArrayLike(t){return null!=t&&isLength(t.length)&&!isFunction(t)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,propertyIsEnumerable=objectProto.propertyIsEnumerable;module.exports=isArguments;
},{}],14:[function(_dereq_,module,exports){
function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,r){var e=null==t?void 0:t[r];return isNative(e)?e:void 0}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER}function isFunction(t){return isObject(t)&&objToString.call(t)==funcTag}function isObject(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function isNative(t){return null!=t&&(isFunction(t)?reIsNative.test(fnToString.call(t)):isObjectLike(t)&&reIsHostCtor.test(t))}var arrayTag="[object Array]",funcTag="[object Function]",reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nativeIsArray=getNative(Array,"isArray"),MAX_SAFE_INTEGER=9007199254740991,isArray=nativeIsArray||function(t){return isObjectLike(t)&&isLength(t.length)&&objToString.call(t)==arrayTag};module.exports=isArray;
},{}],15:[function(_dereq_,module,exports){
function isEqual(a,l,i,e){i="function"==typeof i?bindCallback(i,e,3):void 0;var s=i?i(a,l):void 0;return void 0===s?baseIsEqual(a,l,i):!!s}var baseIsEqual=_dereq_("lodash._baseisequal"),bindCallback=_dereq_("lodash._bindcallback");module.exports=isEqual;
},{"lodash._baseisequal":10,"lodash._bindcallback":11}],16:[function(_dereq_,module,exports){
function isLength(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=MAX_SAFE_INTEGER}function isObjectLike(a){return!!a&&"object"==typeof a}function isTypedArray(a){return isObjectLike(a)&&isLength(a.length)&&!!typedArrayTags[objectToString.call(a)]}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var objectProto=Object.prototype,objectToString=objectProto.toString;module.exports=isTypedArray;
},{}],17:[function(_dereq_,module,exports){
function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function isArrayLike(e){return null!=e&&isLength(getLength(e))}function isIndex(e,t){return e="number"==typeof e||reIsUint.test(e)?+e:-1,t=null==t?MAX_SAFE_INTEGER:t,e>-1&&e%1==0&&e<t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function shimKeys(e){for(var t=keysIn(e),r=t.length,n=r&&e.length,s=!!n&&isLength(n)&&(isArray(e)||isArguments(e)),o=-1,i=[];++o<r;){var u=t[o];(s&&isIndex(u,n)||hasOwnProperty.call(e,u))&&i.push(u)}return i}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function keysIn(e){if(null==e)return[];isObject(e)||(e=Object(e));var t=e.length;t=t&&isLength(t)&&(isArray(e)||isArguments(e))&&t||0;for(var r=e.constructor,n=-1,s="function"==typeof r&&r.prototype===e,o=Array(t),i=t>0;++n<t;)o[n]=n+"";for(var u in e)i&&isIndex(u,t)||"constructor"==u&&(s||!hasOwnProperty.call(e,u))||o.push(u);return o}var getNative=_dereq_("lodash._getnative"),isArguments=_dereq_("lodash.isarguments"),isArray=_dereq_("lodash.isarray"),reIsUint=/^\d+$/,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeKeys=getNative(Object,"keys"),MAX_SAFE_INTEGER=9007199254740991,getLength=baseProperty("length"),keys=nativeKeys?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&isArrayLike(e)?shimKeys(e):isObject(e)?nativeKeys(e):[]}:shimKeys;module.exports=keys;
},{"lodash._getnative":12,"lodash.isarguments":13,"lodash.isarray":14}],18:[function(_dereq_,module,exports){
"use strict";function Pbf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function readVarintRemainder(t,i,e){var r,s,n=e.buf;if(s=n[e.pos++],r=(112&s)>>4,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<3,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<10,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<17,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<24,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(1&s)<<31,s<128)return toNum(t,r,i);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(t){return t.type===Pbf.Bytes?t.readVarint()+t.pos:t.pos+1}function toNum(t,i,e){return e?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function writeBigVarint(t,i){var e,r;if(t>=0?(e=t%4294967296|0,r=t/4294967296|0):(e=~(-t%4294967296),r=~(-t/4294967296),4294967295^e?e=e+1|0:(e=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),writeBigVarintLow(e,r,i),writeBigVarintHigh(r,i)}function writeBigVarintLow(t,i,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}function writeBigVarintHigh(t,i){var e=(7&t)<<4;i.buf[i.pos++]|=e|((t>>>=3)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t)))))}function makeRoomForExtraLength(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.ceil(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var s=e.pos-1;s>=t;s--)e.buf[s+r]=e.buf[s]}function writePackedVarint(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function writePackedSVarint(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function writePackedFloat(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function writePackedDouble(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function writePackedBoolean(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function writePackedFixed32(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function writePackedSFixed32(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function writePackedFixed64(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function writePackedSFixed64(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}function readUInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function writeInt32(t,i,e){t[e]=i,t[e+1]=i>>>8,t[e+2]=i>>>16,t[e+3]=i>>>24}function readInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}function readUtf8(t,i,e){for(var r="",s=i;s<e;){var n=t[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>e)break;var h,u,f;1===a?n<128&&(o=n):2===a?128==(192&(h=t[s+1]))&&(o=(31&n)<<6|63&h)<=127&&(o=null):3===a?(h=t[s+1],u=t[s+2],128==(192&h)&&128==(192&u)&&((o=(15&n)<<12|(63&h)<<6|63&u)<=2047||o>=55296&&o<=57343)&&(o=null)):4===a&&(h=t[s+1],u=t[s+2],f=t[s+3],128==(192&h)&&128==(192&u)&&128==(192&f)&&((o=(15&n)<<18|(63&h)<<12|(63&u)<<6|63&f)<=65535||o>=1114112)&&(o=null)),null===o?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),r+=String.fromCharCode(o),s+=a}return r}function writeUtf8(t,i,e){for(var r,s,n=0;n<i.length;n++){if((r=i.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===i.length?(t[e++]=239,t[e++]=191,t[e++]=189):s=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[e++]=239,t[e++]=191,t[e++]=189,s=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}module.exports=Pbf;var ieee754=_dereq_("ieee754");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,t(s,i,this),this.pos===n&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=readUInt32(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=readInt32(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i,e,r=this.buf;return e=r[this.pos++],i=127&e,e<128?i:(e=r[this.pos++],i|=(127&e)<<7,e<128?i:(e=r[this.pos++],i|=(127&e)<<14,e<128?i:(e=r[this.pos++],i|=(127&e)<<21,e<128?i:(e=r[this.pos],i|=(15&e)<<28,readVarintRemainder(i,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=readUtf8(this.buf,this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(i===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Pbf.Fixed32)this.pos+=4;else{if(i!==Pbf.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Uint8Array(i);e.set(this.buf),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0)return void writeBigVarint(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=writeUtf8(this.buf,t,this.pos);var e=this.pos-i;e>=128&&makeRoomForExtraLength(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),ieee754.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ieee754.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);var r=this.pos-e;r>=128&&makeRoomForExtraLength(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,e){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(t,i){this.writeMessage(t,writePackedVarint,i)},writePackedSVarint:function(t,i){this.writeMessage(t,writePackedSVarint,i)},writePackedBoolean:function(t,i){this.writeMessage(t,writePackedBoolean,i)},writePackedFloat:function(t,i){this.writeMessage(t,writePackedFloat,i)},writePackedDouble:function(t,i){this.writeMessage(t,writePackedDouble,i)},writePackedFixed32:function(t,i){this.writeMessage(t,writePackedFixed32,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,writePackedSFixed32,i)},writePackedFixed64:function(t,i){this.writeMessage(t,writePackedFixed64,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,writePackedSFixed64,i)},writeBytesField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};
},{"ieee754":5}],19:[function(_dereq_,module,exports){
function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};
},{}],20:[function(_dereq_,module,exports){
"use strict";function partialSort(a,t,r,o,p){for(r=r||0,o=o||a.length-1,p=p||defaultCompare;o>r;){if(o-r>600){var f=o-r+1,e=t-r+1,l=Math.log(f),s=.5*Math.exp(2*l/3),i=.5*Math.sqrt(l*s*(f-s)/f)*(e-f/2<0?-1:1);partialSort(a,t,Math.max(r,Math.floor(t-e*s/f+i)),Math.min(o,Math.floor(t+(f-e)*s/f+i)),p)}var n=a[t],h=r,u=o;for(swap(a,r,t),p(a[o],n)>0&&swap(a,r,o);h<u;){for(swap(a,h,u),h++,u--;p(a[h],n)<0;)h++;for(;p(a[u],n)>0;)u--}0===p(a[r],n)?swap(a,r,u):(u++,swap(a,u,o)),u<=t&&(r=u+1),t<=u&&(o=u-1)}}function swap(a,t,r){var o=a[t];a[t]=a[r],a[r]=o}function defaultCompare(a,t){return a<t?-1:a>t?1:0}module.exports=partialSort;
},{}],21:[function(_dereq_,module,exports){
"use strict";function TinyQueue(t,e){if(!(this instanceof TinyQueue))return new TinyQueue(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||defaultCompare,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare(t,e){return t<e?-1:t>e?1:0}module.exports=TinyQueue,module.exports.default=TinyQueue,TinyQueue.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,h=e[t];t>0;){var n=t-1>>1,a=e[n];if(i(h,a)>=0)break;e[t]=a,t=n}e[t]=h},_down:function(t){for(var e=this.data,i=this.compare,h=this.length>>1,n=e[t];t<h;){var a=1+(t<<1),s=a+1,u=e[a];if(s<this.length&&i(e[s],u)<0&&(a=s,u=e[s]),i(u,n)>=0)break;e[t]=u,t=a}e[t]=n}};
},{}],22:[function(_dereq_,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],23:[function(_dereq_,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],24:[function(_dereq_,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c="",a=!1,l=["{","}"];if(isArray(r)&&(a=!0,l=["[","]"]),isFunction(r)){c=" [Function"+(r.name?": "+r.name:"")+"]"}if(isRegExp(r)&&(c=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(c=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(c=" "+formatError(r)),0===o.length&&(!a||0==r.length))return l[0]+c+l[1];if(t<0)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var p;return p=a?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,a)}),e.seen.pop(),reduceToSingleString(p,c,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if(c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0;return e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=_dereq_("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=_dereq_("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,_dereq_('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./support/isBuffer":23,"_process":19,"inherits":22}],25:[function(_dereq_,module,exports){
var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(r,e){function t(r){d[r]=!0;for(var e in sources[r][1]){var o=sources[r][1][e];d[o]||t(o)}}for(var o,n=Object.keys(cache),a=0,i=n.length;a<i;a++){var s=n[a],u=cache[s].exports;if(u===r||u&&u.default===r){o=s;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},a=0,i=n.length;a<i;a++){var s=n[a];f[s]=s}sources[o]=["function(require,module,exports){"+r+"(self); }",f]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),l={};l[o]=o,sources[c]=["function(require,module,exports){var f = require("+stringify(o)+");(f.default ? f.default : f)(self);}",l];var d={};t(c);var g="("+bundleFn+")({"+Object.keys(d).map(function(r){return stringify(r)+":["+sources[r][0]+","+stringify(sources[r][1])+"]"}).join(",")+"},{},["+stringify(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,w=new Blob([g],{type:"text/javascript"});if(e&&e.bare)return w;var h=v.createObjectURL(w),m=new Worker(h);return m.objectURL=h,m};
},{}],26:[function(_dereq_,module,exports){
module.exports.RADIUS=6378137,module.exports.FLATTENING=1/298.257223563,module.exports.POLAR_RADIUS=6356752.3142;
},{}],27:[function(_dereq_,module,exports){
module.exports={"version":"0.1.3"}
},{}],28:[function(_dereq_,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.turf={})}(this,function(t){"use strict";function e(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.bbox,i=n.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");r&&N(r),i&&C(i);var o={type:"Feature"};return i&&(o.id=i),r&&(o.bbox=r),o.properties=e||{},o.geometry=t,o}function n(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=n.bbox;if(!t)throw new Error("type is required");if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");i&&N(i);var s;switch(t){case"Point":s=r(e).geometry;break;case"LineString":s=a(e).geometry;break;case"Polygon":s=o(e).geometry;break;case"MultiPoint":s=l(e).geometry;break;case"MultiLineString":s=h(e).geometry;break;case"MultiPolygon":s=p(e).geometry;break;default:throw new Error(t+" is invalid")}return i&&(s.bbox=i),s}function r(t,n,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!b(t[0])||!b(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},n,r)}function i(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return r(t,e)}),n)}function o(t,n,r){if(!t)throw new Error("coordinates is required");for(var i=0;i<t.length;i++){var o=t[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++){if(0===i&&0===s&&!b(o[0][0])||!b(o[0][1]))throw new Error("coordinates must contain numbers");if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}}return e({type:"Polygon",coordinates:t},n,r)}function s(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return o(t,e)}),n)}function a(t,n,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!b(t[0][1])||!b(t[0][1]))throw new Error("coordinates must contain numbers");return e({type:"LineString",coordinates:t},n,r)}function u(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return a(t,e)}),n)}function c(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox,r=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");n&&N(n),r&&C(r);var i={type:"FeatureCollection"};return r&&(i.id=r),n&&(i.bbox=n),i.features=t,i}function h(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiLineString",coordinates:t},n,r)}function l(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiPoint",coordinates:t},n,r)}function p(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiPolygon",coordinates:t},n,r)}function f(t,n,r){if(!t)throw new Error("geometries is required");if(!Array.isArray(t))throw new Error("geometries must be an Array");return e({type:"GeometryCollection",geometries:t},n,r)}function g(t,e){if(void 0===t||null===t||isNaN(t))throw new Error("num is required");if(e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function d(t,e){if(void 0===t||null===t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=zc[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t*n}function y(t,e){if(void 0===t||null===t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=zc[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t/n}function _(t,e){return m(y(t,e))}function v(t){if(null===t||void 0===t)throw new Error("bearing is required");var e=t%360;return e<0&&(e+=360),e}function m(t){if(null===t||void 0===t)throw new Error("radians is required");return t%(2*Math.PI)*180/Math.PI}function x(t){if(null===t||void 0===t)throw new Error("degrees is required");return t%360*Math.PI/180}function E(t,e,n){if(null===t||void 0===t)throw new Error("length is required");if(!(t>=0))throw new Error("length must be a positive number");return d(y(t,e),n||"kilometers")}function w(t,e,n){if(null===t||void 0===t)throw new Error("area is required");if(!(t>=0))throw new Error("area must be a positive number");var r=Xc[e||"meters"];if(!r)throw new Error("invalid original units");var i=Xc[n||"kilometers"];if(!i)throw new Error("invalid final units");return t/r*i}function b(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function I(t){return!!t&&t.constructor===Object}function N(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!b(t))throw new Error("bbox must only contain numbers")})}function C(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function S(){throw new Error("method has been renamed to `radiansToDegrees`")}function M(){throw new Error("method has been renamed to `degreesToRadians`")}function L(){throw new Error("method has been renamed to `lengthToDegrees`")}function P(){throw new Error("method has been renamed to `lengthToRadians`")}function O(){throw new Error("method has been renamed to `radiansToLength`")}function R(){throw new Error("method has been renamed to `bearingToAzimuth`")}function T(){throw new Error("method has been renamed to `convertLength`")}function A(t,e,n){if(null!==t)for(var r,i,o,s,a,u,c,h,l=0,p=0,f=t.type,g="FeatureCollection"===f,d="Feature"===f,y=g?t.features.length:1,_=0;_<y;_++){c=g?t.features[_].geometry:d?t.geometry:t,h=!!c&&"GeometryCollection"===c.type,a=h?c.geometries.length:1;for(var v=0;v<a;v++){var m=0,x=0;if(null!==(s=h?c.geometries[v]:c)){u=s.coordinates;var E=s.type;switch(l=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":e(u,p,_,m,x),p++,m++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++)e(u[r],p,_,m,x),p++,"MultiPoint"===E&&m++;"LineString"===E&&m++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-l;i++)e(u[r][i],p,_,m,x),p++;"MultiLineString"===E&&m++,"Polygon"===E&&x++}"Polygon"===E&&m++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for("MultiPolygon"===E&&(x=0),i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-l;o++)e(u[r][i][o],p,_,m,x),p++;x++}m++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)A(s.geometries[r],e,n);break;default:throw new Error("Unknown Geometry Type")}}}}}function D(t,e,n,r){var i=n;return A(t,function(t,r,o,s,a){i=0===r&&void 0===n?t:e(i,t,r,o,s,a)},r),i}function F(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length;n++)e(t.features[n].properties,n);break;case"Feature":e(t.properties,0)}}function q(t,e,n){var r=n;return F(t,function(t,i){r=0===i&&void 0===n?t:e(r,t,i)}),r}function G(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)e(t.features[n],n)}function B(t,e,n){var r=n;return G(t,function(t,i){r=0===i&&void 0===n?t:e(r,t,i)}),r}function k(t){var e=[];return A(t,function(t){e.push(t)}),e}function z(t,e){var n,r,i,o,s,a,u,c,h,l,p=0,f="FeatureCollection"===t.type,g="Feature"===t.type,d=f?t.features.length:1;for(n=0;n<d;n++){for(a=f?t.features[n].geometry:g?t.geometry:t,c=f?t.features[n].properties:g?t.properties:{},h=f?t.features[n].bbox:g?t.bbox:void 0,l=f?t.features[n].id:g?t.id:void 0,u=!!a&&"GeometryCollection"===a.type,s=u?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(o,p,c,h,l);break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)e(o.geometries[r],p,c,h,l);break;default:throw new Error("Unknown Geometry Type")}else e(null,p,c,h,l);p++}}function j(t,e,n){var r=n;return z(t,function(t,i,o,s,a){r=0===i&&void 0===n?t:e(r,t,i,o,s,a)}),r}function X(t,n){z(t,function(t,r,i,o,s){var a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return void n(e(t,i,{bbox:o,id:s}),r,0)}var u;switch(a){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon"}t.coordinates.forEach(function(t,o){n(e({type:u,coordinates:t},i),r,o)})})}function U(t,e,n){var r=n;return X(t,function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)}),r}function Y(t,e){X(t,function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;"Point"!==o&&"MultiPoint"!==o&&D(t,function(o,s,u,c,h,l){var p=a([o,s],t.properties);return e(p,n,r,l,i),i++,s})}})}function V(t,e,n){var r=n,i=!1;return Y(t,function(t,o,s,a,u){r=!1===i&&void 0===n?t:e(r,t,o,s,a,u),i=!0}),r}function H(t,e){if(!t)throw new Error("geojson is required");X(t,function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":e(t,n,r,0,0);break;case"Polygon":for(var s=0;s<o.length;s++)e(a(o[s],t.properties),n,r,s)}}})}function W(t,e,n){var r=n;return H(t,function(t,i,o,s){r=0===i&&void 0===n?t:e(r,t,i,o,s)}),r}function J(t){var e=[1/0,1/0,-1/0,-1/0];return A(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function Z(t){if(!t)throw new Error("obj is required");var e=K(t);if(e.length>1&&b(e[0])&&b(e[1]))return e;throw new Error("Coordinate is not a valid Point")}function K(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return Q(e),e;throw new Error("No valid coordinates")}function Q(t){if(t.length>1&&b(t[0])&&b(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Q(t[0]);throw new Error("coordinates must only contain numbers")}function $(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}function tt(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function et(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0;r<t.features.length;r++){var i=t.features[r];if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!i.geometry||i.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+i.geometry.type)}}function nt(t){if(!t)throw new Error("geojson is required");if(void 0!==t.geometry)return t.geometry;if(t.coordinates||t.geometries)return t;throw new Error("geojson must be a valid Feature or Geometry Object")}function rt(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function it(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}function ot(t,e,n){n=n||{};for(var r=Object.keys(Hc),i=0;i<r.length;i++){var o=r[i],s=n[o];s=void 0!==s&&null!==s?s:Hc[o],Wc[o]=s}Wc.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var a=pt(at(t,e));return"function"==typeof Wc.successCallback&&Wc.successCallback(a),a}function st(t,e,n){return(t-e)/(n-e)}function at(t,e){for(var n=t.length-1,r=t[0].length-1,i={rows:n,cols:r,cells:[]},o=0;o<n;++o){i.cells[o]=[];for(var s=0;s<r;++s){var a=0,u=t[o+1][s],c=t[o+1][s+1],h=t[o][s+1],l=t[o][s];if(!(isNaN(u)||isNaN(c)||isNaN(h)||isNaN(l))){a|=u>=e?8:0,a|=c>=e?4:0,a|=h>=e?2:0,a|=l>=e?1:0;var p=!1;if(5===a||10===a){var f=(u+c+h+l)/4;5===a&&f<e?(a=10,p=!0):10===a&&f<e&&(a=5,p=!0)}if(0!==a&&15!==a){var g,d,y,_;g=d=y=_=.5,1===a?(y=1-st(e,u,l),d=1-st(e,h,l)):2===a?(d=st(e,l,h),_=1-st(e,c,h)):3===a?(y=1-st(e,u,l),_=1-st(e,c,h)):4===a?(g=st(e,u,c),_=st(e,h,c)):5===a?(g=st(e,u,c),_=st(e,h,c),d=1-st(e,h,l),y=1-st(e,u,l)):6===a?(d=st(e,l,h),g=st(e,u,c)):7===a?(y=1-st(e,u,l),g=st(e,u,c)):8===a?(y=st(e,l,u),g=1-st(e,c,u)):9===a?(d=1-st(e,h,l),g=1-st(e,c,u)):10===a?(g=1-st(e,c,u),_=1-st(e,c,h),d=st(e,l,h),y=st(e,l,u)):11===a?(g=1-st(e,c,u),_=1-st(e,c,h)):12===a?(y=st(e,l,u),_=st(e,h,c)):13===a?(d=1-st(e,h,l),_=st(e,h,c)):14===a?(y=st(e,l,u),d=st(e,l,h)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+a),i.cells[o][s]={cval:a,flipped:p,top:g,right:_,bottom:d,left:y}}}}}return i}function ut(t){return 5===t.cval||10===t.cval}function ct(t){return 0===t.cval||15===t.cval}function ht(t){ct(t)||5===t.cval||10===t.cval||(t.cval=15)}function lt(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function pt(t){var e=[],n=0;t.rows,t.cols;return t.cells.forEach(function(r,i){r.forEach(function(r,o){if(void 0!==r&&!ut(r)&&!ct(r)){var s=ft(t.cells,i,o),a=!1;if("mergeable"===s.info)for(var u=s.path[s.path.length-1][0],c=s.path[s.path.length-1][1],h=n-1;h>=0;h--)if(Math.abs(e[h][0][0]-u)<=1e-7&&Math.abs(e[h][0][1]-c)<=1e-7){for(var l=s.path.length-2;l>=0;--l)e[h].unshift(s.path[l]);a=!0;break}a||(e[n++]=s.path)}})}),e}function ft(t,e,n){var r,i,o,s=t.length,a=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],c=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],h=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],l=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],p=(t[e][n],t[e][n]),f=p.cval,o=h[f],g=lt(p,o);a.push([n+g[0],e+g[1]]),o=l[f],g=lt(p,o),a.push([n+g[0],e+g[1]]),ht(p);for(var d=n+u[f],y=e+c[f],_=f;d>=0&&y>=0&&y<s&&(d!=n||y!=e)&&void 0!==(p=t[y][d]);){if(0===(f=p.cval)||15===f)return{path:a,info:"mergeable"};o=l[f],r=u[f],i=c[f],5!==f&&10!==f||(5===f?p.flipped?-1===c[_]?(o="left",r=-1,i=0):(o="right",r=1,i=0):-1===u[_]&&(o="bottom",r=0,i=-1):10===f&&(p.flipped?-1===u[_]?(o="top",r=0,i=1):(o="bottom",r=0,i=-1):1===c[_]&&(o="left",r=-1,i=0))),g=lt(p,o),a.push([d+g[0],y+g[1]]),ht(p),d+=r,y+=i,_=f}return{path:a,info:"closed"}}function gt(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;et(t,"Point","input must contain Points");for(var o=dt(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],c=[],h=0;h<u.length;h++){var l=u[h];l.properties[n]?c.push(l.properties[n]):c.push(0),!0===i&&(l.properties.matrixPosition=[a,h])}s.push(c)}return s}function dt(t,e){var n={};return G(t,function(t){var e=K(t)[1];n[e]||(n[e]=[]),n[e].push(t)}),Object.keys(n).map(function(t){return n[t].sort(function(t,e){return K(t)[0]-K(e)[0]})}).sort(function(t,n){return e?K(t[0])[1]-K(n[0])[1]:K(n[0])[1]-K(t[0])[1]})}function yt(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(et(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!I(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var s=gt(t,{zProperty:r,flip:!0});return c(vt(_t(s,e,r,i,o),s,t))}function _t(t,e,n,r,i){for(var o=[],s=1;s<e.length;s++){var a=+e[s],u=Object.assign({},r,i[s]);u[n]=a;var c=h(ot(t,a),u);o.push(c)}return o}function vt(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,c=e.length-1,h=i/u,l=o/c,p=function(t){t[0]=t[0]*h+s,t[1]=t[1]*l+a};return t.forEach(function(t){A(t,p)}),t}function mt(t,e,n,r,i){for(n=n||0,r=r||t.length-1,i=i||Et;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);mt(t,e,Math.max(n,Math.floor(e-s*u/o+c)),Math.min(r,Math.floor(e+(o-s)*u/o+c)),i)}var h=t[e],l=n,p=r;for(xt(t,n,e),i(t[r],h)>0&&xt(t,n,r);l<p;){for(xt(t,l,p),l++,p--;i(t[l],h)<0;)l++;for(;i(t[p],h)>0;)p--}0===i(t[n],h)?xt(t,n,p):(p++,xt(t,p,r)),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function xt(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Et(t,e){return t<e?-1:t>e?1:0}function wt(t,e){if(!(this instanceof wt))return new wt(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function bt(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function It(t,e){Nt(t,0,t.children.length,e,t)}function Nt(t,e,n,r,i){i||(i=Dt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],Ct(i,t.leaf?r(o):o);return i}function Ct(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function St(t,e){return t.minX-e.minX}function Mt(t,e){return t.minY-e.minY}function Lt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Pt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ot(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function Rt(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function Tt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function At(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Dt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ft(t,e,n,r,i){for(var o,s=[e,n];s.length;)n=s.pop(),e=s.pop(),n-e<=r||(o=e+Math.ceil((n-e)/r/2)*r,Jc(t,o,e,n,i),s.push(e,o,o,n))}function qt(t,e){return e={exports:{}},t(e,e.exports),e.exports}function Gt(t,e,n){var r=t*e,i=Qc*t,o=i-t,s=i-o,a=t-s,u=Qc*e,c=u-e,h=u-c,l=e-h,p=r-s*h,f=p-a*h,g=f-s*l,d=a*l-g;return n?(n[0]=d,n[1]=r,n):[d,r]}function Bt(t,e){var n=t+e,r=n-t,i=n-r,o=e-r,s=t-i,a=s+o;return a?[a,n]:[n]}function kt(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return Bt(t[0],e[0]);var i,o,s=n+r,a=new Array(s),u=0,c=0,h=0,l=Math.abs,p=t[c],f=l(p),g=e[h],d=l(g);f<d?(o=p,(c+=1)<n&&(p=t[c],f=l(p))):(o=g,(h+=1)<r&&(g=e[h],d=l(g))),c<n&&f<d||h>=r?(i=p,(c+=1)<n&&(p=t[c],f=l(p))):(i=g,(h+=1)<r&&(g=e[h],d=l(g)));for(var y,_,v,m,x,E=i+o,w=E-i,b=o-w,I=b,N=E;c<n&&h<r;)f<d?(i=p,(c+=1)<n&&(p=t[c],f=l(p))):(i=g,(h+=1)<r&&(g=e[h],d=l(g))),o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y;for(;c<n;)i=p,o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y,(c+=1)<n&&(p=t[c]);for(;h<r;)i=g,o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y,(h+=1)<r&&(g=e[h]);return I&&(a[u++]=I),N&&(a[u++]=N),u||(a[u++]=0),a.length=u,a}function zt(t,e,n){var r=t+e,i=r-t,o=r-i,s=e-i,a=t-o;return n?(n[0]=a+s,n[1]=r,n):[a+s,r]}function jt(t,e){var n=t.length;if(1===n){var r=Kc(t[0],e);return r[0]?r:[r[1]]}var i=new Array(2*n),o=[.1,.1],s=[.1,.1],a=0;Kc(t[0],e,o),o[0]&&(i[a++]=o[0]);for(var u=1;u<n;++u){Kc(t[u],e,s);var c=o[1];th(c,s[0],o),o[0]&&(i[a++]=o[0]);var h=s[1],l=o[1],p=h+l,f=p-h,g=l-f;o[1]=p,g&&(i[a++]=g)}return o[1]&&(i[a++]=o[1]),0===a&&(i[a++]=0),i.length=a,i}function Xt(t,e){var n=t+e,r=n-t,i=n-r,o=e-r,s=t-i,a=s+o;return a?[a,n]:[n]}function Ut(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return Xt(t[0],-e[0]);var i,o,s=n+r,a=new Array(s),u=0,c=0,h=0,l=Math.abs,p=t[c],f=l(p),g=-e[h],d=l(g);f<d?(o=p,(c+=1)<n&&(p=t[c],f=l(p))):(o=g,(h+=1)<r&&(g=-e[h],d=l(g))),c<n&&f<d||h>=r?(i=p,(c+=1)<n&&(p=t[c],f=l(p))):(i=g,(h+=1)<r&&(g=-e[h],d=l(g)));for(var y,_,v,m,x,E=i+o,w=E-i,b=o-w,I=b,N=E;c<n&&h<r;)f<d?(i=p,(c+=1)<n&&(p=t[c],f=l(p))):(i=g,(h+=1)<r&&(g=-e[h],d=l(g))),o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y;for(;c<n;)i=p,o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y,(c+=1)<n&&(p=t[c]);for(;h<r;)i=g,o=I,E=i+o,w=E-i,b=o-w,b&&(a[u++]=b),y=N+E,_=y-N,v=y-_,m=E-_,x=N-v,I=x+m,N=y,(h+=1)<r&&(g=-e[h]);return I&&(a[u++]=I),N&&(a[u++]=N),u||(a[u++]=0),a.length=u,a}function Yt(t){var e=t.length;if(e<3){for(var n=new Array(e),r=0;r<e;++r)n[r]=r;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:n}for(var i=new Array(e),r=0;r<e;++r)i[r]=r;i.sort(function(e,n){var r=t[e][0]-t[n][0];return r||t[e][1]-t[n][1]});for(var o=[i[0],i[1]],s=[i[0],i[1]],r=2;r<e;++r){for(var a=i[r],u=t[a],c=o.length;c>1&&oh(t[o[c-2]],t[o[c-1]],u)<=0;)c-=1,o.pop();for(o.push(a),c=s.length;c>1&&oh(t[s[c-2]],t[s[c-1]],u)>=0;)c-=1,s.pop();s.push(a)}for(var n=new Array(s.length+o.length-2),h=0,r=0,l=o.length;r<l;++r)n[h++]=o[r];for(var p=s.length-2;p>0;--p)n[h++]=s[p];return n}function Vt(t,e){if(!(this instanceof Vt))return new Vt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||Ht,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function Ht(t,e){return t<e?-1:t>e?1:0}function Wt(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;for(var r,i=ne(t),o=Zc(16,["[0]","[1]","[0]","[1]"]).load(t),s=[],a=0;a<i.length;a++){var u=i[a];o.remove(u),r=re(u,r),s.push(r)}var c=Zc(16);for(a=0;a<s.length;a++)c.insert(ee(s[a]));for(var h=e*e,l=n*n;s.length;){var p=s.shift(),f=p.p,g=p.next.p,d=ie(f,g);if(!(d<l)){var y=d/h;u=Jt(o,p.prev.p,f,g,p.next.next.p,y,c),u&&Math.min(ie(u,f),ie(u,g))<=y&&(s.push(p),s.push(re(u,p)),o.remove(u),c.remove(p),c.insert(ee(p)),c.insert(ee(p.next)))}}p=r;var _=[];do{_.push(p.p),p=p.next}while(p!==r);return _.push(p.p),_}function Jt(t,e,n,r,i,o,s){for(var a=new sh(null,Zt),u=t.data;u;){for(var c=0;c<u.children.length;c++){var h=u.children[c],l=u.leaf?oe(h,n,r):Kt(n,r,h);l>o||a.push({node:h,dist:l})}for(;a.length&&!a.peek().node.children;){var p=a.pop(),f=p.node,g=oe(f,e,n),d=oe(f,r,i);if(p.dist<g&&p.dist<d&&$t(n,f,s)&&$t(r,f,s))return f}u=a.pop(),u&&(u=u.node)}return null}function Zt(t,e){return t.dist-e.dist}function Kt(t,e,n){if(Qt(t,n)||Qt(e,n))return 0;var r=se(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=se(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=se(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=se(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(r,i,o,s)}function Qt(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function $t(t,e,n){for(var r=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),o=Math.max(t[0],e[0]),s=Math.max(t[1],e[1]),a=n.search({minX:r,minY:i,maxX:o,maxY:s}),u=0;u<a.length;u++)if(te(a[u].p,a[u].next.p,t,e))return!1;return!0}function te(t,e,n,r){return t!==r&&e!==n&&ch(t,e,n)>0!=ch(t,e,r)>0&&ch(n,r,t)>0!=ch(n,r,e)>0}function ee(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function ne(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>r[0]&&(r=s),s[1]<n[1]&&(n=s),s[1]>i[1]&&(i=s)}var a=[e,n,r,i],u=a.slice();for(o=0;o<t.length;o++)uh(t[o],a)||u.push(t[o]);var c=ih(u),h=[];for(o=0;o<c.length;o++)h.push(u[c[o]]);return h}function re(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function ie(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function oe(t,e,n){var r=e[0],i=e[1],o=n[0]-r,s=n[1]-i;if(0!==o||0!==s){var a=((t[0]-r)*o+(t[1]-i)*s)/(o*o+s*s);a>1?(r=n[0],i=n[1]):a>0&&(r+=o*a,i+=s*a)}return o=t[0]-r,s=t[1]-i,o*o+s*s}function se(t,e,n,r,i,o,s,a){var u,c,h,l,p=n-t,f=r-e,g=s-i,d=a-o,y=t-i,_=e-o,v=p*p+f*f,m=p*g+f*d,x=g*g+d*d,E=p*y+f*_,w=g*y+d*_,b=v*x-m*m,I=b,N=b;0===b?(c=0,I=1,l=w,N=x):(c=m*w-x*E,l=v*w-m*E,c<0?(c=0,l=w,N=x):c>I&&(c=I,l=w+m,N=x)),l<0?(l=0,-E<0?c=0:-E>v?c=I:(c=-E,I=v)):l>N&&(l=N,-E+m<0?c=0:-E+m>v?c=I:(c=-E+m,I=v)),u=0===c?0:c/I,h=0===l?0:l/N;var C=(1-u)*t+u*n,S=(1-u)*e+u*r,M=(1-h)*i+h*s,L=(1-h)*o+h*a,P=M-C,O=L-S;return P*P+O*O}function ae(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.concavity||1/0,r=[];if(A(t,function(t){r.push([t[0],t[1]])}),!r.length)return null;var i=hh(r,n);return i.length>3?o([i]):null}function ue(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.ignoreBoundary;if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=Z(t),o=K(e),s=e.geometry?e.geometry.type:e.type,a=e.bbox;if(a&&!1===he(i,a))return!1;"Polygon"===s&&(o=[o]);for(var u=0,c=!1;u<o.length&&!c;u++)if(ce(i,o[u][0],r)){for(var h=!1,l=1;l<o[u].length&&!h;)ce(i,o[u][l],!r)&&(h=!0),l++;h||(c=!0)}return c}function ce(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var s=e[i][0],a=e[i][1],u=e[o][0],c=e[o][1];if(t[1]*(s-u)+a*(u-t[0])+c*(t[0]-s)==0&&(s-t[0])*(u-t[0])<=0&&(a-t[1])*(c-t[1])<=0)return!n;a>t[1]!=c>t[1]&&t[0]<(u-s)*(t[1]-a)/(c-a)+s&&(r=!r)}return r}function he(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function le(t,e){var n=[];return z(e,function(e){G(t,function(t){ue(t,e)&&n.push(t)})}),c(n)}function pe(t,e){if("FeatureCollection"!==t.type)throw new Error("points must be a FeatureCollection");var n=!1;return c(ye(t.features.map(function(t){var r={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return e?r.z=t.properties[e]:3===t.geometry.coordinates.length&&(n=!0,r.z=t.geometry.coordinates[2]),r})).map(function(t){var e=[t.a.x,t.a.y],r=[t.b.x,t.b.y],i=[t.c.x,t.c.y],s={};return n?(e.push(t.a.z),r.push(t.b.z),i.push(t.c.z)):s={a:t.a.z,b:t.b.z,c:t.c.z},o([[e,r,i,e]],s)}))}function fe(t,e,n){this.a=t,this.b=e,this.c=n;var r,i,o=e.x-t.x,s=e.y-t.y,a=n.x-t.x,u=n.y-t.y,c=o*(t.x+e.x)+s*(t.y+e.y),h=a*(t.x+n.x)+u*(t.y+n.y),l=2*(o*(n.y-e.y)-s*(n.x-e.x));this.x=(u*c-s*h)/l,this.y=(o*h-a*c)/l,r=this.x-t.x,i=this.y-t.y,this.r=r*r+i*i}function ge(t,e){return e.x-t.x}function de(t){var e,n,r,i,o,s=t.length;t:for(;s;)for(n=t[--s],e=t[--s],r=s;r;)if(o=t[--r],i=t[--r],e===i&&n===o||e===o&&n===i){t.splice(s,2),t.splice(r,2),s-=2;continue t}}function ye(t){if(t.length<3)return[];t.sort(ge);for(var e,n,r,i,o,s,a=t.length-1,u=t[a].x,c=t[0].x,h=t[a].y,l=h;a--;)t[a].y<h&&(h=t[a].y),t[a].y>l&&(l=t[a].y);var p,f=c-u,g=l-h,d=f>g?f:g,y=.5*(c+u),_=.5*(l+h),v=[new fe({x:y-20*d,y:_-d,__sentinel:!0},{x:y,y:_+20*d,__sentinel:!0},{x:y+20*d,y:_-d,__sentinel:!0})],m=[],x=[];for(a=t.length;a--;){for(x.length=0,p=v.length;p--;)f=t[a].x-v[p].x,f>0&&f*f>v[p].r?(m.push(v[p]),v.splice(p,1)):(g=t[a].y-v[p].y,f*f+g*g>v[p].r||(x.push(v[p].a,v[p].b,v[p].b,v[p].c,v[p].c,v[p].a),v.splice(p,1)));for(de(x),p=x.length;p;)n=x[--p],e=x[--p],r=t[a],i=n.x-e.x,o=n.y-e.y,s=2*(i*(r.y-n.y)-o*(r.x-n.x)),Math.abs(s)>1e-12&&v.push(new fe(e,n,r))}for(Array.prototype.push.apply(m,v),a=m.length;a--;)(m[a].a.__sentinel||m[a].b.__sentinel||m[a].c.__sentinel)&&m.splice(a,1);return m}function _e(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=Z(t),o=Z(e),s=x(o[1]-i[1]),a=x(o[0]-i[0]),u=x(i[1]),c=x(o[1]),h=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(u)*Math.cos(c);return d(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r)}function ve(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return me(t);case"FeatureCollection":return Ee(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return we(t);default:throw new Error("unknown GeoJSON type")}}function me(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=xe(t.properties),e.geometry=we(t.geometry),e}function xe(t){var e={};return t?(Object.keys(t).forEach(function(n){var r=t[n];"object"==typeof r?null===r?e[n]=null:r.length?e[n]=r.map(function(t){return t}):e[n]=xe(r):e[n]=r}),e):e}function Ee(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(t){return me(t)}),e}function we(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map(function(t){return we(t)}),e):(e.coordinates=be(t.coordinates),e)}function be(t){return"object"!=typeof t[0]?t.slice():t.map(function(t){return be(t)})}function Ie(t,e){function n(t,e){e.length&&e.pop();for(var n=c[t<0?~t:t],r=0,i=n.length;r<i;++r)e.push(u(n[r],r));t<0&&gh(e,i)}function r(t){return u(t)}function i(t){for(var e=[],r=0,i=t.length;r<i;++r)n(t[r],e);return e.length<2&&e.push(e[0]),e}function o(t){for(var e=i(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(o)}function a(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(a)};case"Point":e=r(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(r);break;case"LineString":e=i(t.arcs);break;case"MultiLineString":e=t.arcs.map(i);break;case"Polygon":e=s(t.arcs);break;case"MultiPolygon":e=t.arcs.map(s);break;default:return null}return{type:n,coordinates:e}}var u=fh(t.transform),c=t.arcs;return a(e)}function Ne(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}function Ce(t,e){function n(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(n);break;case"Polygon":r(t.arcs);break;case"MultiPolygon":t.arcs.forEach(r)}}function r(t){t.forEach(function(e){e.forEach(function(e){(o[e=e<0?~e:e]||(o[e]=[])).push(t)})}),s.push(t)}function i(e){return Ne(Ie(t,{type:"Polygon",arcs:[e]}).coordinates[0])}var o={},s=[],a=[];return e.forEach(n),s.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,a.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),s.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:a.map(function(e){var n,r=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].length<2&&r.push(t)})})}),r=dh(t,r),(n=r.length)>1)for(var s,a,u=1,c=i(r[0]);u<n;++u)(s=i(r[u]))>c&&(a=r[0],r[0]=r[u],r[u]=a,c=s);return r})}}function Se(t,e,n,r){Me(t,e,n),Me(t,e,e+r),Me(t,e+r,n)}function Me(t,e,n){for(var r,i=e+(n---e>>1);e<i;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function Le(t){return null==t?{type:null}:("FeatureCollection"===t.type?Pe:"Feature"===t.type?Oe:Re)(t)}function Pe(t){var e={type:"GeometryCollection",geometries:t.features.map(Oe)};return null!=t.bbox&&(e.bbox=t.bbox),e}function Oe(t){var e,n=Re(t.geometry);null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox);for(e in t.properties){n.properties=t.properties;break}return n}function Re(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(Re)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function Te(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function Ae(t,e){var n,r=t[0],i=t[1],o=e[0],s=e[1]
;return i<r&&(n=r,r=i,i=n),s<o&&(n=o,o=s,s=n),r===o&&i===s}function De(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==it(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=ve(t));var r=[],i=W(t,function(t,e){var n=qe(t,e);return n||(r.push(t),e)});return i&&r.push(i),r.length?1===r.length?r[0]:h(r.map(function(t){return t.coordinates})):null}function Fe(t){return t[0].toString()+","+t[1].toString()}function qe(t,e){var n,r=t.geometry.coordinates,i=e.geometry.coordinates,o=Fe(r[0]),s=Fe(r[r.length-1]),u=Fe(i[0]),c=Fe(i[i.length-1]);if(o===c)n=i.concat(r.slice(1));else if(u===s)n=r.concat(i.slice(1));else if(o===u)n=r.slice(1).reverse().concat(i);else{if(s!==c)return null;n=r.concat(i.reverse().slice(1))}return a(n)}function Ge(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==it(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=ve(t));var r=[];X(t,function(t){r.push(t.geometry)});var i=Rh({geoms:f(r).geometry});return yh(i,i.objects.geoms.geometries)}function Be(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==it(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=ve(t));var r=ke(t);if(!r)throw new Error("geojson must be homogenous");switch(r){case"LineString":return De(t,e);case"Polygon":return Ge(t,e);default:throw new Error(r+" is not supported")}}function ke(t){var e={};X(t,function(t){e[t.geometry.type]=!0});var n=Object.keys(e);return 1===n.length?n[0]:null}function ze(t,n){if(n=n||{},!I(n))throw new Error("options is invalid");if(!t)throw new Error("points is required");var r=n.maxEdge||1/0;if(!b(r))throw new Error("maxEdge is invalid");var i=je(t),o=pe(i);if(o.features=o.features.filter(function(t){var e=t.geometry.coordinates[0][0],i=t.geometry.coordinates[0][1],o=t.geometry.coordinates[0][2],s=_e(e,i,n),a=_e(i,o,n),u=_e(e,o,n);return s<=r&&a<=r&&u<=r}),o.features.length<1)return null;var s=Be(o,n);return 1===s.coordinates.length&&(s.coordinates=s.coordinates[0],s.type="Polygon"),e(s)}function je(t){var e=[],n={};return G(t,function(t){if(t.geometry){var r=t.geometry.coordinates.join("-");n.hasOwnProperty(r)||(e.push(t),n[r]=!0)}}),c(e)}function Xe(t,e,n,r){var i=Zc(6),o=e.features.map(function(t){return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:t.properties[n]}});return i.load(o),t.features.forEach(function(t){t.properties||(t.properties={});var e=J(t),n=i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),o=[];n.forEach(function(e){ue([e.minX,e.minY],t)&&o.push(e.property)}),t.properties[r]=o}),t}function Ue(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if(!t)throw new Error("geojson is required");return!1!==n&&void 0!==n||(t=ve(t)),A(t,function(t){var e=t[0],n=t[1];t[0]=n,t[1]=e}),t}function Ye(t,n){var r="object"==typeof n?n.mutate:n;if(!t)throw new Error("geojson is required");var i=it(t),o=[];switch(i){case"LineString":o=Ve(t);break;case"MultiLineString":case"Polygon":K(t).forEach(function(t){o.push(Ve(t))});break;case"MultiPolygon":K(t).forEach(function(t){var e=[];t.forEach(function(t){e.push(Ve(t))}),o.push(e)});break;case"Point":return t;case"MultiPoint":var s={};K(t).forEach(function(t){var e=t.join("-");s.hasOwnProperty(e)||(o.push(t),s[e]=!0)});break;default:throw new Error(i+" geometry not supported")}return t.coordinates?!0===r?(t.coordinates=o,t):{type:i,coordinates:o}:!0===r?(t.geometry.coordinates=o,t):e({type:i,coordinates:o},t.properties,t.bbox,t.id)}function Ve(t){var e=K(t);if(2===e.length&&!He(e[0],e[1]))return e;var n,r,i,o=[],s=e.length-1;o.push(e[0]);for(var a=1;a<s;a++)n=e[a-1],r=e[a],i=e[a+1],We(n,i,r)||o.push(r);return o.push(i),o}function He(t,e){return t[0]===e[0]&&t[1]===e[1]}function We(t,e,n){var r=n[0],i=n[1],o=t[0],s=t[1],a=e[0],u=e[1],c=r-o,h=i-s,l=a-o,p=u-s;return 0==c*p-h*l&&(Math.abs(l)>=Math.abs(p)?l>0?o<=r&&r<=a:a<=r&&r<=o:p>0?s<=i&&i<=u:u<=i&&i<=s)}function Je(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function Ze(t,e,n){var r=e.x,i=e.y,o=n.x-r,s=n.y-i;if(0!==o||0!==s){var a=((t.x-r)*o+(t.y-i)*s)/(o*o+s*s);a>1?(r=n.x,i=n.y):a>0&&(r+=o*a,i+=s*a)}return o=t.x-r,s=t.y-i,o*o+s*s}function Ke(t,e){for(var n,r=t[0],i=[r],o=1,s=t.length;o<s;o++)n=t[o],Je(n,r)>e&&(i.push(n),r=n);return r!==n&&i.push(n),i}function Qe(t,e,n,r,i){for(var o,s=r,a=e+1;a<n;a++){var u=Ze(t[a],t[e],t[n]);u>s&&(o=a,s=u)}s>r&&(o-e>1&&Qe(t,e,o,r,i),i.push(t[o]),n-o>1&&Qe(t,o,n,r,i))}function $e(t,e){var n=t.length-1,r=[t[0]];return Qe(t,0,n,e,r),r.push(t[n]),r}function tn(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return t=n?t:Ke(t,r),t=$e(t,r)}function en(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=void 0!==e.tolerance?e.tolerance:1,r=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(t=ve(t)),z(t,function(t){nn(t,n,r)}),t}function nn(t,e,n){var r=t.type;if("Point"===r||"MultiPoint"===r)return t;Ye(t,!0);var i=t.coordinates;switch(r){case"LineString":t.coordinates=rn(i,e,n);break;case"MultiLineString":t.coordinates=i.map(function(t){return rn(t,e,n)});break;case"Polygon":t.coordinates=on(i,e,n);break;case"MultiPolygon":t.coordinates=i.map(function(t){return on(t,e,n)})}return t}function rn(t,e,n){return tn(t.map(function(t){return{x:t[0],y:t[1],z:t[2]}}),e,n).map(function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]})}function on(t,e,n){return t.map(function(t){var r=t.map(function(t){return{x:t[0],y:t[1]}});if(r.length<4)throw new Error("invalid polygon");for(var i=tn(r,e,n).map(function(t){return[t.x,t.y]});!sn(i);)e-=.01*e,i=tn(r,e,n).map(function(t){return[t.x,t.y]});return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i})}function sn(t){return!(t.length<3)&&!(3===t.length&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}function an(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.resolution||1e4,r=e.sharpness||.85;if(!t)throw new Error("line is required");if(!b(n))throw new Error("resolution must be an number");if(!b(r))throw new Error("sharpness must be an number");for(var i=[],o=new Th({points:nt(t).coordinates.map(function(t){return{x:t[0],y:t[1]}}),duration:n,sharpness:r}),s=0;s<o.duration;s+=10){var u=o.pos(s);Math.floor(s/100)%2==0&&i.push([u.x,u.y])}return a(i,t.properties)}function un(t,e,n,r){return t=ve(t),e=ve(e),G(t,function(t){t.properties||(t.properties={}),G(e,function(e){void 0===t.properties[r]&&ue(t,e)&&(t.properties[r]=e.properties[n])})}),t}function cn(t,e){if(!t)throw new Error("featurecollection is required");if(null===e||void 0===e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return c(hn(t.features,e))}function hn(t,e){for(var n,r,i=t.slice(0),o=t.length,s=o-e;o-- >s;)r=Math.floor((o+1)*Math.random()),n=i[r],i[r]=i[o],i[o]=n;return i.slice(s)}function ln(t){N(t);var e=Number(t[0]),n=Number(t[1]),r=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[e,n];return o([[s,[r,n],[r,i],[e,i],s]])}function pn(t){return ln(J(t))}function fn(t){var e=t[0],n=t[1],r=t[2],i=t[3];if(_e(t.slice(0,2),[r,n])>=_e(t.slice(0,2),[e,i])){var o=(n+i)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}var s=(e+r)/2;return[s-(i-n)/2,n,s+(i-n)/2,i]}function gn(t,e,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.units,s=i.properties,a=Z(t),u=x(a[0]),c=x(a[1]),h=x(n),l=y(e,o),p=Math.asin(Math.sin(c)*Math.cos(l)+Math.cos(c)*Math.sin(l)*Math.cos(h));return r([m(u+Math.atan2(Math.sin(h)*Math.sin(l)*Math.cos(c),Math.cos(l)-Math.sin(c)*Math.sin(p))),m(p)],s)}function dn(t,e,n){n=n||{};var r=n.steps||64,i=n.properties;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be a number");r=r||64,i=i||t.properties||{};for(var s=[],a=0;a<r;a++)s.push(gn(t,e,-360*a/r,n).geometry.coordinates);return s.push(s[0]),o([s],i)}function yn(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");if(!0===n.final)return _n(t,e);var r=Z(t),i=Z(e),o=x(r[0]),s=x(i[0]),a=x(r[1]),u=x(i[1]),c=Math.sin(s-o)*Math.cos(u),h=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(s-o);return m(Math.atan2(c,h))}function _n(t,e){var n=yn(e,t);return n=(n+180)%360}function vn(t,e){return gn(t,_e(t,e)/2,yn(t,e))}function mn(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties;if(!t)throw new Error("geojson is required");var i=J(t);return r([(i[0]+i[2])/2,(i[1]+i[3])/2],n)}function xn(t,e){var n=0,i=0,o=0;return A(t,function(t){n+=t[0],i+=t[1],o++},!0),r([n/o,i/o],e)}function En(t,e){switch(it(t)){case"Point":return t;case"Polygon":var n=[];A(t,function(t){n.push(t)});var i,o,s,a,u,c,h,l,p=xn(t,e),f=p.geometry.coordinates,g=0,d=0,y=0,_=n.map(function(t){return[t[0]-f[0],t[1]-f[1]]});for(i=0;i<n.length-1;i++)o=_[i],a=o[0],c=o[1],s=_[i+1],u=s[0],h=s[1],l=a*h-u*c,y+=l,g+=(a+u)*l,d+=(c+h)*l;if(0===y)return p;var v=.5*y,m=1/(6*v);return r([f[0]+m*g,f[1]+m*d],e);default:var x=ae(t);return x?En(x,e):xn(t,e)}}function wn(t){function n(t,e,n){n?r[e].coordinates=r[e].coordinates.concat(t.geometry.coordinates):r[e].coordinates.push(t.geometry.coordinates),r[e].properties.push(t.properties)}var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},i=Object.keys(r).reduce(function(t,e){return t[e.replace("Multi","")]=e,t},{});return G(t,function(t){t.geometry&&(r[t.geometry.type]?n(t,t.geometry.type,!0):i[t.geometry.type]&&n(t,i[t.geometry.type],!1))}),c(Object.keys(r).filter(function(t){return r[t].coordinates.length}).sort().map(function(t){return e({type:t,coordinates:r[t].coordinates},{collectedProperties:r[t].properties})}))}function bn(t){var e=[];return"FeatureCollection"===t.type?G(t,function(t){A(t,function(n){e.push(r(n,t.properties))})}):A(t,function(n){e.push(r(n,t.properties))}),c(e)}function In(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=Nn(t,0,i,n,!0),s=[];if(!o)return s;var a,u,c,h,l,p,f;if(r&&(o=Rn(t,e,o,n)),t.length>80*n){a=c=t[0],u=h=t[1];for(var g=n;g<i;g+=n)l=t[g],p=t[g+1],l<a&&(a=l),p<u&&(u=p),l>c&&(c=l),p>h&&(h=p);f=Math.max(c-a,h-u),f=0!==f?1/f:0}return Sn(o,s,n,a,u,f),s}function Nn(t,e,n,r,i){var o,s;if(i===Qn(t,e,n,r)>0)for(o=e;o<n;o+=r)s=Jn(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=Jn(o,t[o],t[o+1],s);return s&&Xn(s,s.next)&&(Zn(s),s=s.next),s}function Cn(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Xn(r,r.next)&&0!==jn(r.prev,r,r.next))r=r.next;else{if(Zn(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Sn(t,e,n,r,i,o,s){if(t){!s&&o&&Fn(t,r,i,o);for(var a,u,c=t;t.prev!==t.next;)if(a=t.prev,u=t.next,o?Ln(t,r,i,o):Mn(t))e.push(a.i/n),e.push(t.i/n),e.push(u.i/n),Zn(t),t=u.next,c=u.next;else if((t=u)===c){s?1===s?(t=Pn(t,e,n),Sn(t,e,n,r,i,o,2)):2===s&&On(t,e,n,r,i,o):Sn(Cn(t),e,n,r,i,o,1);break}}}function Mn(t){var e=t.prev,n=t,r=t.next;if(jn(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(kn(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&jn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ln(t,e,n,r){var i=t.prev,o=t,s=t.next;if(jn(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,u=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,h=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,l=Gn(a,u,e,n,r),p=Gn(c,h,e,n,r),f=t.nextZ;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&kn(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&jn(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=l;){if(f!==t.prev&&f!==t.next&&kn(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&jn(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function Pn(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Xn(i,o)&&Un(i,r,r.next,o)&&Vn(i,o)&&Vn(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Zn(r),Zn(r.next),r=t=o),r=r.next}while(r!==t);return r}function On(t,e,n,r,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&zn(s,a)){var u=Wn(s,a);return s=Cn(s,s.next),u=Cn(u,u.next),Sn(s,e,n,r,i,o),void Sn(u,e,n,r,i,o)}a=a.next}s=s.next}while(s!==t)}function Rn(t,e,n,r){var i,o,s,a,u,c=[];for(i=0,o=e.length;i<o;i++)s=e[i]*r,a=i<o-1?e[i+1]*r:t.length,u=Nn(t,s,a,r,!1),u===u.next&&(u.steiner=!0),c.push(Bn(u));for(c.sort(Tn),i=0;i<c.length;i++)An(c[i],n),n=Cn(n,n.next);return n}function Tn(t,e){return t.x-e.x}function An(t,e){if(e=Dn(t,e)){var n=Wn(e,t);Cn(n,n.next)}}function Dn(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n.prev;var u,c=n,h=n.x,l=n.y,p=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=h&&i!==r.x&&kn(o<l?i:s,o,h,l,o<l?s:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<p||u===p&&r.x>n.x)&&Vn(r,t)&&(n=r,p=u),r=r.next;return n}function Fn(t,e,n,r){var i=t;do{null===i.z&&(i.z=Gn(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,qn(i)}function qn(t){var e,n,r,i,o,s,a,u,c=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(u=c;a>0||u>0&&r;)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1);return t}function Gn(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function Bn(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function kn(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function zn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Yn(t,e)&&Vn(t,e)&&Vn(e,t)&&Hn(t,e)}function jn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Xn(t,e){return t.x===e.x&&t.y===e.y}function Un(t,e,n,r){return!!(Xn(t,e)&&Xn(n,r)||Xn(t,r)&&Xn(n,e))||jn(t,e,n)>0!=jn(t,e,r)>0&&jn(n,r,t)>0!=jn(n,r,e)>0}function Yn(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Un(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Vn(t,e){return jn(t.prev,t,t.next)<0?jn(t,e,t.next)>=0&&jn(t,t.prev,e)>=0:jn(t,e,t.prev)<0||jn(t,t.next,e)<0}function Hn(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function Wn(t,e){var n=new Kn(t.i,t.x,t.y),r=new Kn(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Jn(t,e,n,r){var i=new Kn(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Zn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Kn(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qn(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function $n(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=tr(t.geometry.coordinates):t.geometry.coordinates.forEach(function(t){e.features=e.features.concat(tr(t))}),e}function tr(t){var e=er(t),n=Ah(e.vertices,e.holes,2),r=[],i=[];n.forEach(function(t,r){var o=n[r];i.push([e.vertices[2*o],e.vertices[2*o+1]])});for(var s=0;s<i.length;s+=3){var a=i.slice(s,s+3);a.push(i[s]),r.push(o([a]))}return r}function er(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}function nr(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var n,r=1/0;return G(e,function(e,i){var o=_e(t,e);o<r&&(n=ve(e),n.properties.featureIndex=i,n.properties.distanceToPoint=o,r=o)}),n}function rr(t,e,n,r,i){ir(t,e,n||0,r||t.length-1,i||sr)}function ir(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);ir(t,e,Math.max(n,Math.floor(e-s*u/o+c)),Math.min(r,Math.floor(e+(o-s)*u/o+c)),i)}var h=t[e],l=n,p=r;for(or(t,n,e),i(t[r],h)>0&&or(t,n,r);l<p;){for(or(t,l,p),l++,p--;i(t[l],h)<0;)l++;for(;i(t[p],h)>0;)p--}0===i(t[n],h)?or(t,n,p):(p++,or(t,p,r)),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function or(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function sr(t,e){return t<e?-1:t>e?1:0}function ar(t,e){if(!(this instanceof ar))return new ar(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function ur(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function cr(t,e){hr(t,0,t.children.length,e,t)}function hr(t,e,n,r,i){i||(i=xr(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],lr(i,t.leaf?r(o):o);return i}function lr(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function pr(t,e){return t.minX-e.minX}function fr(t,e){return t.minY-e.minY}function gr(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function dr(t){return t.maxX-t.minX+(t.maxY-t.minY)}function yr(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function _r(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function vr(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function mr(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function xr(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Er(t,e,n,r,i){for(var o,s=[e,n];s.length;)n=s.pop(),e=s.pop(),n-e<=r||(o=e+Math.ceil((n-e)/r/2)*r,rr(t,o,e,n,i),s.push(e,o,o,n))}function wr(t){var e=ar(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;t=br(e),t.bbox=e}else t.bbox=t.bbox?t.bbox:Ir(t);return ar.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){var n=br(t);n.bbox=t,e.push(n)}):G(t,function(t){t.bbox=t.bbox?t.bbox:Ir(t),e.push(t)}),ar.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;t=br(e),t.bbox=e}return ar.prototype.remove.call(this,t)},e.clear=function(){return ar.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:ar.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return ar.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:ar.prototype.all.call(this)}},e.toJSON=function(){return ar.prototype.toJSON.call(this)},e.fromJSON=function(t){return ar.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:Ir(t),{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function br(t){var e=[t[0],t[1]],n=[t[0],t[3]],r=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],r,n,e]]}}}function Ir(t){var e=[1/0,1/0,-1/0,-1/0];return A(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function Nr(t){if(!t)throw new Error("geojson is required");var e=[];return X(t,function(t){Cr(t,e)}),c(e)}function Cr(t,e){var n=[],r=t.geometry;switch(r.type){case"Polygon":n=K(r);break;case"LineString":n=[K(r)]}n.forEach(function(n){Sr(n,t.properties).forEach(function(t){t.id=e.length,e.push(t)})})}function Sr(t,e){var n=[];return t.reduce(function(t,r){var i=a([t,r],e);return i.bbox=Mr(t,r),n.push(i),r}),n}function Mr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return[n<i?n:i,r<o?r:o,n>i?n:i,r>o?r:o]}function Lr(t,n){var r={},i=[];if("LineString"===t.type&&(t=e(t)),"LineString"===n.type&&(n=e(n)),"Feature"===t.type&&"Feature"===n.type&&"LineString"===t.geometry.type&&"LineString"===n.geometry.type&&2===t.geometry.coordinates.length&&2===n.geometry.coordinates.length){var o=Pr(t,n);return o&&i.push(o),c(i)}var s=wr();return s.load(Nr(n)),G(Nr(t),function(t){G(s.search(t),function(e){var n=Pr(t,e);if(n){var o=K(n).join(",");r[o]||(r[o]=!0,i.push(n))}})}),c(i)}function Pr(t,e){var n=K(t),i=K(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],s=n[0][1],a=n[1][0],u=n[1][1],c=i[0][0],h=i[0][1],l=i[1][0],p=i[1][1],f=(p-h)*(a-o)-(l-c)*(u-s),g=(l-c)*(s-h)-(p-h)*(o-c),d=(a-o)*(s-h)-(u-s)*(o-c);if(0===f)return null;var y=g/f,_=d/f;if(y>=0&&y<=1&&_>=0&&_<=1){return r([o+y*(a-o),s+y*(u-s)])}return null}function Or(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=t.geometry?t.geometry.type:t.type;if("LineString"!==i&&"MultiLineString"!==i)throw new Error("lines must be LineString or MultiLineString");var o=r([1/0,1/0],{dist:1/0}),s=0;return X(t,function(t){for(var i=K(t),u=0;u<i.length-1;u++){var c=r(i[u]);c.properties.dist=_e(e,c,n);var h=r(i[u+1]);h.properties.dist=_e(e,h,n);var l=_e(c,h,n),p=Math.max(c.properties.dist,h.properties.dist),f=yn(c,h),g=gn(e,p,f+90,n),d=gn(e,p,f-90,n),y=Lr(a([g.geometry.coordinates,d.geometry.coordinates]),a([c.geometry.coordinates,h.geometry.coordinates])),_=null;y.features.length>0&&(_=y.features[0],_.properties.dist=_e(e,_,n),_.properties.location=s+_e(c,_,n)),c.properties.dist<o.properties.dist&&(o=c,o.properties.index=u,o.properties.location=s),h.properties.dist<o.properties.dist&&(o=h,o.properties.index=u+1,o.properties.location=s+l),_&&_.properties.dist<o.properties.dist&&(o=_,o.properties.index=u),s+=l}}),o}function Rr(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.final;if(!t)throw new Error("start point is required");if(!e)throw new Error("end point is required");var i;return i=r?Tr(Z(e),Z(t)):Tr(Z(t),Z(e)),i>180?-(360-i):i}function Tr(t,e){var n=x(t[1]),r=x(e[1]),i=x(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(m(Math.atan2(i,o))+360)%360}function Ar(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("from point is required");if(!e)throw new Error("to point is required");var i=Z(t),o=Z(e);return o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0,E(Dr(i,o),"meters",r)}function Dr(t,e,n){n=void 0===n?kc:Number(n);var r=n,i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,s=o-i,a=Math.abs(e[0]-t[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),c=Math.abs(u)>1e-11?s/u:Math.cos(i);return Math.sqrt(s*s+c*c*a*a)*r}function Fr(t,e){return Gr(t,"mercator",e)}function qr(t,e){return Gr(t,"wgs84",e)}function Gr(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&b(t[0])?t="mercator"===e?Br(t):kr(t):(!0!==r&&(t=ve(t)),A(t,function(t){var n="mercator"===e?Br(t):kr(t);t[0]=n[0],t[1]=n[1]})),t}function Br(t){var e=Math.PI/180,n=6378137,r=20037508.342789244,i=Math.abs(t[0])<=180?t[0]:t[0]-360*zr(t[0]),o=[n*i*e,n*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return o[0]>r&&(o[0]=r),o[0]<-r&&(o[0]=-r),o[1]>r&&(o[1]=r),o[1]<-r&&(o[1]=-r),o}function kr(t){var e=180/Math.PI,n=6378137;return[t[0]*e/n,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/n)))*e]}function zr(t){return t<0?-1:t>0?1:0}function jr(t,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");if(!t)throw new Error("pt is required");if(Array.isArray(t)?t=r(t):"Point"===t.type?t=e(t):tt(t,"Point","point"),!n)throw new Error("line is required");Array.isArray(n)?n=a(n):"LineString"===n.type?n=e(n):tt(n,"LineString","line");var o=1/0,s=t.geometry.coordinates;return Y(n,function(t){var e=t.geometry.coordinates[0],n=t.geometry.coordinates[1],r=Xr(s,e,n,i);o>r&&(o=r)}),o}function Xr(t,e,n,r){var i=r.mercator,o=!0!==i?_e(e,t,r):Vr(e,t,r),s=v(!0!==i?yn(e,t):Rr(e,t)),a=v(!0!==i?yn(e,n):Rr(e,n)),u=Math.abs(s-a);if(u>90)return o;var c=(a+180)%360,h=v(!0!==i?yn(n,t):Rr(n,t)),l=Math.abs(h-c);return l>180&&(l=Math.abs(l-360)),l>90?!0!==i?_e(t,n,r):Vr(t,n,r):!0!==i?o*Math.sin(x(u)):Ur(e,n,t,r)}function Ur(t,e,n,i){var o=0;(Math.abs(t[0])>=180||Math.abs(e[0])>=180||Math.abs(n[0])>=180)&&(o=t[0]>0||e[0]>0||n[0]>0?-180:180);var s=r(n),a=Fr([t[0]+o,t[1]]),u=Fr([e[0]+o,e[1]]),c=Fr([n[0]+o,n[1]]),h=qr(Yr(a,u,c));return 0!==o&&(h[0]-=o),Ar(s,h,i)}function Yr(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1],a=n[0],u=n[1],c=o-r,h=s-i,l=c*c+h*h,p=((a-r)*c+(u-i)*h)/l;return[r+p*c,i+p*h]}function Vr(t,e,n){var r=n.units,i=0;Math.abs(t[0])>=180&&(i=t[0]>0?-180:180),Math.abs(e[0])>=180&&(i=e[0]>0?-180:180);var o=Fr([t[0]+i,t[1]]),s=Fr([e[0]+i,e[1]]),a=function(t){return t*t},u=a(o[0]-s[0])+a(o[1]-s[1]);return E(Math.sqrt(u),"meters",r)}function Hr(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=n.properties||{};if(!t)throw new Error("points is required");if(t=Wr(t),!t.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==it(e))throw new Error("line must be a LineString");var o=1/0,s=null;return G(t,function(t){var n=jr(t,e,{units:r});n<o&&(o=n,s=t)}),s&&(s.properties=Object.assign({dist:o},s.properties,i)),s}function Wr(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return z(t,function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})}),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter(function(t){return"Point"===t.geometry.type}),t;default:throw new Error("points must be a Point Collection")}}function Jr(t,e){var n=Z(t),r=nt(e),i=r.coordinates,o=i[0];if(o.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var s=e.properties||{},a=s.a,u=s.b,c=s.c,h=n[0],l=n[1],p=o[0][0],f=o[0][1],g=void 0!==a?a:o[0][2],d=o[1][0],y=o[1][1],_=void 0!==u?u:o[1][2],v=o[2][0],m=o[2][1],x=void 0!==c?c:o[2][2];return(x*(h-p)*(l-y)+g*(h-d)*(l-m)+_*(h-v)*(l-f)-_*(h-p)*(l-m)-x*(h-d)*(l-f)-g*(h-v)*(l-y))/((h-p)*(l-y)+(h-d)*(l-m)+(h-v)*(l-f)-(h-p)*(l-m)-(h-d)*(l-f)-(h-v)*(l-y))}function Zr(t){var e,n,i={type:"FeatureCollection",features:[]};if(n="Feature"===t.type?t.geometry:t,"LineString"===n.type)e=[n.coordinates];else if("MultiLineString"===n.type)e=n.coordinates;else if("MultiPolygon"===n.type)e=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=n.coordinates}return e.forEach(function(t){e.forEach(function(e){for(var n=0;n<t.length-1;n++)for(var o=n;o<e.length-1;o++){if(t===e){if(1===Math.abs(n-o))continue;if(0===n&&o===t.length-2&&t[n][0]===t[t.length-1][0]&&t[n][1]===t[t.length-1][1])continue}var s=Kr(t[n][0],t[n][1],t[n+1][0],t[n+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);s&&i.features.push(r([s[0],s[1]]))}})}),i}function Kr(t,e,n,r,i,o,s,a){var u,c,h,l,p,f={x:null,y:null,onLine1:!1,onLine2:!1};return 0===(u=(a-o)*(n-t)-(s-i)*(r-e))?null!==f.x&&null!==f.y&&f:(c=e-o,h=t-i,l=(s-i)*c-(a-o)*h,p=(n-t)*c-(r-e)*h,c=l/u,h=p/u,f.x=t+c*(n-t),f.y=e+c*(r-e),c>=0&&c<=1&&(f.onLine1=!0),h>=0&&h<=1&&(f.onLine2=!0),!(!f.onLine1||!f.onLine2)&&[f.x,f.y])}function Qr(t){for(var e=$r(t),n=mn(e),i=!1,o=0;!i&&o<e.features.length;){var s,a,u,h,l,p,f,g=e.features[o].geometry,d=!1;if("Point"===g.type)n.geometry.coordinates[0]===g.coordinates[0]&&n.geometry.coordinates[1]===g.coordinates[1]&&(i=!0);else if("MultiPoint"===g.type){var y=!1;for(f=0;!y&&f<g.coordinates.length;)n.geometry.coordinates[0]===g.coordinates[f][0]&&n.geometry.coordinates[1]===g.coordinates[f][1]&&(i=!0,y=!0),f++}else if("LineString"===g.type)for(f=0;!d&&f<g.coordinates.length-1;)s=n.geometry.coordinates[0],a=n.geometry.coordinates[1],u=g.coordinates[f][0],h=g.coordinates[f][1],l=g.coordinates[f+1][0],p=g.coordinates[f+1][1],ti(s,a,u,h,l,p)&&(d=!0,i=!0),f++;else if("MultiLineString"===g.type)for(var _=0;_<g.coordinates.length;){d=!1,f=0;for(var v=g.coordinates[_];!d&&f<v.length-1;)s=n.geometry.coordinates[0],a=n.geometry.coordinates[1],u=v[f][0],h=v[f][1],l=v[f+1][0],p=v[f+1][1],ti(s,a,u,h,l,p)&&(d=!0,i=!0),f++;_++}else"Polygon"!==g.type&&"MultiPolygon"!==g.type||ue(n,g)&&(i=!0);o++}if(i)return n;var m=c([]);for(o=0;o<e.features.length;o++)m.features=m.features.concat(bn(e.features[o]).features);return r(nr(n,m).geometry.coordinates)}function $r(t){return"FeatureCollection"!==t.type?c("Feature"!==t.type?[e(t)]:[t]):t}function ti(t,e,n,r,i,o){return Math.sqrt((i-n)*(i-n)+(o-r)*(o-r))===Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}function ei(t){return j(t,function(t,e){return t+ni(e)},0)}function ni(t){var e,n=0;switch(t.type){case"Polygon":return ri(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=ri(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(e=0;e<t.geometries.length;e++)n+=ni(t.geometries[e]);return n}}function ri(t){var e=0;if(t&&t.length>0){e+=Math.abs(ii(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(ii(t[n]))}return e}function ii(t){var e,n,r,i,o,s,a,u=0,c=t.length;if(c>2){for(a=0;a<c;a++)a===c-2?(i=c-2,o=c-1,s=0):a===c-1?(i=c-1,o=0,s=1):(i=a,o=a+1,s=a+2),e=t[i],n=t[o],r=t[s],u+=(oi(r[0])-oi(e[0]))*Math.sin(oi(n[1]));u=u*qh*qh/2}return u}function oi(t){return t*Math.PI/180}function si(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i;if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}if(!b(e))throw new Error("distance must be a number");for(var o=0,s=0;s<i.length&&!(e>=o&&s===i.length-1);s++){if(o>=e){var a=e-o;if(a){var u=yn(i[s],i[s-1])-180;return gn(i[s],a,u,n)}return r(i[s])}o+=_e(i[s],i[s+1],n)}return r(i[i.length-1])}function ai(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");if(!t)throw new Error("geojson is required");return V(t,function(t,n){var r=n.geometry.coordinates;return t+_e(r[0],r[1],e)},0)}function ui(t,e,n){var r=K(n);if("LineString"!==it(n))throw new Error("line must be a LineString");var i,o=Or(n,t),s=Or(n,e);i=o.properties.index<=s.properties.index?[o,s]:[s,o];for(var u=[i[0].geometry.coordinates],c=i[0].properties.index+1;c<i[1].properties.index+1;c++)u.push(r[c]);return u.push(i[1].geometry.coordinates),a(u,n.properties)}function ci(t,e,n,r){if(r=r||{},!I(r))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var s,u,c,h=0,l=0;l<i.length&&!(e>=h&&l===i.length-1);l++){if(h>e&&0===o.length){if(!(s=e-h))return o.push(i[l]),a(o);u=yn(i[l],i[l-1])-180,c=gn(i[l],s,u,r),o.push(c.geometry.coordinates)}if(h>=n)return(s=n-h)?(u=yn(i[l],i[l-1])-180,c=gn(i[l],s,u,r),o.push(c.geometry.coordinates),a(o)):(o.push(i[l]),
a(o));if(h>=e&&o.push(i[l]),l===i.length-1)return a(o);h+=_e(i[l],i[l+1],r)}return a(i[i.length-1])}function hi(t,e,n){n=n||{};var r=n.ignoreEndVertices;if(!I(n))throw new Error("invalid options");if(!t)throw new Error("pt is required");if(!e)throw new Error("line is required");for(var i=Z(t),o=K(e),s=0;s<o.length-1;s++){var a=!1;if(r&&(0===s&&(a="start"),s===o.length-2&&(a="end"),0===s&&s+1===o.length-1&&(a="both")),li(o[s],o[s+1],i,a))return!0}return!1}function li(t,e,n,r){var i=n[0],o=n[1],s=t[0],a=t[1],u=e[0],c=e[1],h=n[0]-s,l=n[1]-a,p=u-s,f=c-a;return 0==h*f-l*p&&(r?"start"===r?Math.abs(p)>=Math.abs(f)?p>0?s<i&&i<=u:u<=i&&i<s:f>0?a<o&&o<=c:c<=o&&o<a:"end"===r?Math.abs(p)>=Math.abs(f)?p>0?s<=i&&i<u:u<i&&i<=s:f>0?a<=o&&o<c:c<o&&o<=a:"both"===r?Math.abs(p)>=Math.abs(f)?p>0?s<i&&i<u:u<i&&i<s:f>0?a<o&&o<c:c<o&&o<a:void 0:Math.abs(p)>=Math.abs(f)?p>0?s<=i&&i<=u:u<=i&&i<=s:f>0?a<=o&&o<=c:c<=o&&o<=a)}function pi(t,e){var n=it(t),r=it(e),i=nt(t),o=nt(e);switch(n){case"Point":switch(r){case"MultiPoint":return fi(i,o);case"LineString":return hi(i,o,{ignoreEndVertices:!0});case"Polygon":return ue(i,o,{ignoreBoundary:!0});default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"MultiPoint":return gi(i,o);case"LineString":return di(i,o);case"Polygon":return yi(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"LineString":return _i(i,o);case"Polygon":return vi(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Polygon":return mi(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function fi(t,e){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(Ei(e.coordinates[n],t.coordinates)){r=!0;break}return r}function gi(t,e){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)Ei(t.coordinates[n],e.coordinates[i])&&(r=!0);if(!r)return!1}return!0}function di(t,e){for(var n=!1,r=0;r<t.coordinates.length;r++){if(!hi(t.coordinates[r],e))return!1;n||(n=hi(t.coordinates[r],e,{ignoreEndVertices:!0}))}return n}function yi(t,e){for(var n=!0,r=0;r<t.coordinates.length;r++){var i=ue(t.coordinates[1],e);if(!i){n=!1;break}i=ue(t.coordinates[1],e,{ignoreBoundary:!0})}return n&&i}function _i(t,e){for(var n=0;n<t.coordinates.length;n++)if(!hi(t.coordinates[n],e))return!1;return!0}function vi(t,e){if(!xi(J(e),J(t)))return!1;for(var n=!1,r=0;r<t.coordinates.length-1;r++){if(!ue(t.coordinates[r],e))return!1;if(n||(n=ue(t.coordinates[r],e,{ignoreBoundary:!0})),!n){n=ue(wi(t.coordinates[r],t.coordinates[r+1]),e,{ignoreBoundary:!0})}}return n}function mi(t,e){var n=J(t);if(!xi(J(e),n))return!1;for(var r=0;r<t.coordinates[0].length;r++)if(!ue(t.coordinates[0][r],e))return!1;return!0}function xi(t,e){return!(t[0]>e[0])&&(!(t[2]<e[2])&&(!(t[1]>e[1])&&!(t[3]<e[3])))}function Ei(t,e){return t[0]===e[0]&&t[1]===e[1]}function wi(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function bi(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=n.mask,o=n.properties,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(it(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],u=t[1],h=t[2],l=t[3],p=e/_e([a,u],[h,u],n),f=p*(h-a),g=e/_e([a,u],[a,l],n),d=g*(l-u),y=h-a,_=l-u,v=Math.floor(y/f),m=Math.floor(_/d),x=(y-v*f)/2,E=(_-m*d)/2,w=a+x;w<=h;){for(var N=u+E;N<=l;){var C=r([w,N],o);i?pi(C,i)&&s.push(C):s.push(C),N+=d}w+=f}return c(s)}function Ii(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.precision,r=e.coordinates,i=e.mutate;if(n=void 0===n||null===n||isNaN(n)?6:n,r=void 0===r||null===r||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return A(t,function(t){Ni(t,o,r)}),t}function Ni(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e;return t}function Ci(t){if(!t)throw new Error("geojson is required");var e=[];return X(t,function(t){e.push(t)}),c(e)}function Si(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=n.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return X(t,function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),Mi(t,e,r,function(t){o.push(t)})}),c(o)}function Mi(t,e,n,r){var i=ai(t,{units:n});if(i<=e)return r(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++){r(ci(t,e*s,e*(s+1),{units:n}),s)}}function Li(t,e,n,r){if(Pi(t,n)||Pi(t,r)||Pi(e,n)||Pi(r,n))return null;var i=t[0],o=t[1],s=e[0],a=e[1],u=n[0],c=n[1],h=r[0],l=r[1],p=(i-s)*(c-l)-(o-a)*(u-h);return 0===p?null:[((i*a-o*s)*(u-h)-(i-s)*(u*l-c*h))/p,((i*a-o*s)*(c-l)-(o-a)*(u*l-c*h))/p]}function Pi(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!Pi(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function Oi(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])>=0==e}function Ri(t){for(var e=0,n=0;n<t.length-1;n++)t[n][0]<t[e][0]&&(e=n);if(Oi([t[(e-1).modulo(t.length-1)],t[e],t[(e+1).modulo(t.length-1)]],!0))var r=1;else var r=-1;return r}function Ti(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!Ti(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0}function Ai(t){for(var e={},n=1,r=0,i=t.length;r<i;++r){if(e.hasOwnProperty(t[r])){n=0;break}e[t[r]]=1}return n}function Di(t){var e=[];return X(t,function(t){"Polygon"===t.geometry.type&&G(Bh(t),function(n){e.push(o(n.geometry.coordinates,t.properties))})}),c(e)}function Fi(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.npoints,o=n.offset;return t=Z(t),e=Z(e),r=r||{},i=i||100,o=o||10,new Hh({x:t[0],y:t[1]},{x:e[0],y:e[1]},r).Arc(i,{offset:o}).json()}function qi(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=it(t),r=it(e);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=Ii(e,{precision:7});switch(r){case"Point":return Bi(t,i);case"MultiPoint":return Gi(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Gi(t,Lr(t,i))}}function Gi(t,e){var n=[],r=wr();return X(e,function(e){if(n.forEach(function(t,e){t.id=e}),n.length){var i=r.search(e);if(i.features.length){var o=ki(e,i);n=n.filter(function(t){return t.id!==o.id}),r.remove(o),G(Bi(o,e),function(t){n.push(t),r.insert(t)})}}else n=Bi(t,e).features,n.forEach(function(t){t.bbox||(t.bbox=fn(J(t)))}),r.load(c(n))}),c(n)}function Bi(t,e){var n=[],r=K(t)[0],i=K(t)[t.geometry.coordinates.length-1];if(zi(r,Z(e))||zi(i,Z(e)))return c([t]);var o=wr(),s=Nr(t);o.load(s);var u=o.search(e);if(!u.features.length)return c([t]);var h=ki(e,u),l=[r],p=B(s,function(t,r,i){var o=K(r)[1],s=Z(e);return i===h.id?(t.push(s),n.push(a(t)),zi(s,o)?[s]:[s,o]):(t.push(o),t)},l);return p.length>1&&n.push(a(p)),c(n)}function ki(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var n,r=1/0;return G(e,function(e){var i=Or(e,t),o=i.properties.dist;o<r&&(n=e,r=o)}),n}function zi(t,e){return t[0]===e[0]&&t[1]===e[1]}function ji(t,e,n,r,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.steps,s=i.units;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if(void 0===n||null===n)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if("object"!=typeof i)throw new Error("options must be an object");o=o||64;var u=Xi(n),c=Xi(r),h=t.properties;if(u===c)return a(dn(t,e,i).geometry.coordinates[0],h);for(var l=u,p=u<c?c:c+360,f=l,g=[],d=0;f<p;)g.push(gn(t,e,f,s).geometry.coordinates),d++,f=l+360*d/o;return f>p&&g.push(gn(t,e,p,s).geometry.coordinates),a(g,h)}function Xi(t){var e=t%360;return e<0&&(e+=360),e}function Ui(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,r=it(t),i=K(t);if(n=n||t.properties||{},!i.length)throw new Error("polygon must contain coordinates");switch(r){case"Polygon":return Yi(i,n);case"MultiPolygon":var o=[];return i.forEach(function(t){o.push(Yi(t,n))}),c(o);default:throw new Error("geom "+r+" not supported")}}function Yi(t,e){return t.length>1?h(t,e):a(t[0],e)}function Vi(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,r=e.autoComplete,i=e.orderCoords;if(!t)throw new Error("lines is required");switch(r=void 0===r||r,i=void 0===i||i,it(t)){case"FeatureCollection":case"GeometryCollection":var o=[];return(t.features?t.features:t.geometries).forEach(function(t){o.push(K(Hi(t,{},r,i)))}),p(o,n)}return Hi(t,n,r,i)}function Hi(t,e,n,r){e=e||t.properties||{};var i=K(t),s=it(t);if(!i.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return n&&(i=Wi(i)),o([i],e);case"MultiLineString":var u=[],c=0;return i.forEach(function(t){if(n&&(t=Wi(t)),r){var e=Ji(J(a(t)));e>c?(u.unshift(t),c=e):u.push(t)}else u.push(t)}),o(u,e);default:throw new Error("geometry type "+s+" is not supported")}}function Wi(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],s=i[1];return n===o&&r===s||t.push(e),t}function Ji(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}function Zi(t,e,n){var r,i,o,s,a,u=t.length,c=$i(t[0],e),h=[];for(n||(n=[]),r=1;r<u;r++){for(i=t[r-1],o=t[r],s=a=$i(o,e);;){if(!(c|s)){h.push(i),s!==a?(h.push(o),r<u-1&&(n.push(h),h=[])):r===u-1&&h.push(o);break}if(c&s)break;c?(i=Qi(i,o,c,e),c=$i(i,e)):(o=Qi(i,o,s,e),s=$i(o,e))}c=a}return h.length&&n.push(h),n}function Ki(t,e){var n,r,i,o,s,a,u;for(r=1;r<=8;r*=2){for(n=[],i=t[t.length-1],o=!($i(i,e)&r),s=0;s<t.length;s++)a=t[s],u=!($i(a,e)&r),u!==o&&n.push(Qi(i,a,r,e)),u&&n.push(a),i=a,o=u;if(t=n,!t.length)break}return n}function Qi(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function $i(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function to(t,e){var n=no(t),r=K(t),i=t.properties;switch(n){case"LineString":case"MultiLineString":var s=[];return"LineString"===n&&(r=[r]),r.forEach(function(t){Wh(t,e,s)}),1===s.length?a(s[0],i):h(s,i);case"Polygon":return o(eo(r,e),i);case"MultiPolygon":return p(r.map(function(t){return eo(t,e)}),i);default:throw new Error("geometry "+n+" not supported")}}function eo(t,e){for(var n=[],r=0;r<t.length;r++){var i=Wh.polygon(t[r],e);i.length>0&&(i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0]),i.length>=4&&n.push(i))}return n}function no(t){return t.geometry?t.geometry.type:t.type}function ro(t){return"[object Arguments]"===Object.prototype.toString.call(t)}function io(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?(n.strict,t===e):ao(t,e,n))}function oo(t){return null===t||void 0===t}function so(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function ao(t,e,n){var r,i;if(oo(t)||oo(e))return!1;if(t.prototype!==e.prototype)return!1;if(ro(t))return!!ro(e)&&(t=Jh.call(t),e=Jh.call(e),io(t,e,n));if(so(t)){if(!so(e))return!1;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}try{var o=Object.keys(t),s=Object.keys(e)}catch(t){return!1}if(o.length!==s.length)return!1;for(o.sort(),s.sort(),r=o.length-1;r>=0;r--)if(o[r]!==s[r])return!1;for(r=o.length-1;r>=0;r--)if(i=o[r],!io(t[i],e[i],n))return!1;return typeof t==typeof e}function uo(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.tolerance||0,i=[],o=wr();o.load(Nr(t));var s;return Y(e,function(t){var e=!1;G(o.search(t),function(n){if(!1===e){var i=K(t).sort(),o=K(n).sort();io(i,o)?(e=!0,s=s?co(s,t):t):(0===r?hi(i[0],n)&&hi(i[1],n):Or(n,i[0]).properties.dist<=r&&Or(n,i[1]).properties.dist<=r)?(e=!0,s=s?co(s,t):t):(0===r?hi(o[0],t)&&hi(o[1],t):Or(t,o[0]).properties.dist<=r&&Or(t,o[1]).properties.dist<=r)&&(s=s?co(s,n):n)}}),!1===e&&s&&(i.push(s),s=void 0)}),s&&i.push(s),c(i)}function co(t,e){var n=K(e),r=K(t),i=r[0],o=r[r.length-1],s=t.geometry.coordinates;return io(n[0],i)?s.unshift(n[1]):io(n[0],o)?s.push(n[1]):io(n[1],i)?s.unshift(n[0]):io(n[1],o)&&s.push(n[0]),t}function ho(t,e,n,r,i){if(i=i||{},!I(i))throw new Error("options is invalid");if(!t)throw new Error("center is required");if(void 0===n||null===n)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(lo(n)===lo(r))return dn(t,e,i);var s=K(t),a=ji(t,e,n,r,i),u=[[s]];return A(a,function(t){u[0].push(t)}),u[0].push(s),o(u)}function lo(t){var e=t%360;return e<0&&(e+=360),e}function po(t,e,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.units,s=i.properties;if(!t)throw new Error("origin is required");if(void 0===e||null===e)throw new Error("distance is required");if(void 0===n||null===n)throw new Error("bearing is required");if(!(e>=0))throw new Error("distance must be greater than 0");var a=E(e,o,"meters"),u=Z(t),c=fo(u,a,n);return c[0]+=c[0]-u[0]>180?-360:u[0]-c[0]>180?360:0,r(c,s)}function fo(t,e,n,r){r=void 0===r?kc:Number(r);var i=e/r,o=t[0]*Math.PI/180,s=x(t[1]),a=x(n),u=i*Math.cos(a),c=s+u;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),l=Math.abs(h)>1e-11?u/h:Math.cos(s);return[(180*(o+i*Math.sin(a)/l)/Math.PI+540)%360-180,180*c/Math.PI]}function go(t,e){var n,i,o,s=K(t),a=K(e);switch(it(e)){case"Polygon":n=a[0][0],i=a[0][0],o=mo(a[0][0],a[0][a[0].length-1],s);var u=yo(a[0],s,o,void 0,n,i);n=u[0],i=u[1];break;case"MultiPolygon":n=a[0][0][0],i=a[0][0][0],o=mo(a[0][0][0],a[0][0][a[0][0].length-1],s),a.forEach(function(t){var e=yo(t[0],s,o,void 0,n,i);n=e[0],i=e[1]})}return c([r(n),r(i)])}function yo(t,e,n,r,i,o){for(var s=0;s<t.length;s++){var a=t[s],u=t[s+1];s===t.length-1&&(u=t[0]),r=mo(a,u,e),n<=0&&r>0?vo(e,a,i)||(i=a):n>0&&r<=0&&(_o(e,a,o)||(o=a)),n=r}return[i,o]}function _o(t,e,n){return mo(t,e,n)>0}function vo(t,e,n){return mo(t,e,n)<0}function mo(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function xo(t){if(!t)throw new Error("line is required");var e=t.geometry?t.geometry.type:t.type;if(!Array.isArray(t)&&"LineString"!==e)throw new Error("geometry must be a LineString");for(var n,r,i=K(t),o=0,s=1;s<i.length;)n=r||i[0],r=i[s],o+=(r[0]-n[0])*(r[1]+n[1]),s++;return o>0}function Eo(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.reverse||!1,r=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof n)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(t=ve(t));var i=[];switch(t.type){case"GeometryCollection":return z(t,function(t){wo(t,n)}),t;case"FeatureCollection":return G(t,function(t){G(wo(t,n),function(t){i.push(t)})}),c(i)}return wo(t,n)}function wo(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return z(t,function(t){wo(t,e)}),t;case"LineString":return bo(K(t),e),t;case"Polygon":return Io(K(t),e),t;case"MultiLineString":return K(t).forEach(function(t){bo(t,e)}),t;case"MultiPolygon":return K(t).forEach(function(t){Io(t,e)}),t;case"Point":case"MultiPoint":return t}}function bo(t,e){xo(t)===e&&t.reverse()}function Io(t,e){xo(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)xo(t[n])===e&&t[n].reverse()}function No(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;et(t,"Point","input must contain Points");for(var o=Co(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],c=[],h=0;h<u.length;h++){var l=u[h];l.properties[n]?c.push(l.properties[n]):c.push(0),!0===i&&(l.properties.matrixPosition=[a,h])}s.push(c)}return s}function Co(t,e){var n={};return G(t,function(t){var e=K(t)[1];n[e]||(n[e]=[]),n[e].push(t)}),Object.keys(n).map(function(t){return n[t].sort(function(t,e){return K(t)[0]-K(e)[0]})}).sort(function(t,n){return e?K(t[0])[1]-K(n[0])[1]:K(n[0])[1]-K(t[0])[1]})}function So(t,e,n,r){r=r||{};for(var i=Object.keys(Zh),o=0;o<i.length;o++){var s=i[o],a=r[s];a=void 0!==a&&null!==a?a:Zh[s],Kh[s]=a}Kh.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+n)+"]");var u,c=Po(t,e,n);return Kh.polygons?(Kh.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),u=Fo(c)):(Kh.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),u=Oo(c)),"function"==typeof Kh.successCallback&&Kh.successCallback(u),u}function Mo(t,e,n){return(t-e)/(n-e)}function Lo(t){return t.constructor.toString().indexOf("Array")>-1}function Po(t,e,n){for(var r=t.length-1,i=t[0].length-1,o={rows:r,cols:i,cells:[]},s=e+Math.abs(n),a=0;a<r;++a){o.cells[a]=[];for(var u=0;u<i;++u){var c=0,h=t[a+1][u],l=t[a+1][u+1],p=t[a][u+1],f=t[a][u];if(!(isNaN(h)||isNaN(l)||isNaN(p)||isNaN(f))){c|=h<e?0:h>s?128:64,c|=l<e?0:l>s?32:16,c|=p<e?0:p>s?8:4,c|=f<e?0:f>s?2:1;var g=+c,d=0;if(17===c||18===c||33===c||34===c||38===c||68===c||72===c||98===c||102===c||132===c||136===c||137===c||152===c||153===c){var y=(h+l+p+f)/4;d=y>s?2:y<e?0:1,34===c?1===d?c=35:0===d&&(c=136):136===c?1===d?(c=35,d=4):0===d&&(c=34):17===c?1===d?(c=155,d=4):0===d&&(c=153):68===c?1===d?(c=103,d=4):0===d&&(c=102):153===c?1===d&&(c=155):102===c?1===d&&(c=103):152===c?d<2&&(c=156,d=1):137===c?d<2&&(c=139,d=1):98===c?d<2&&(c=99,d=1):38===c?d<2&&(c=39,d=1):18===c?d>0?(c=156,d=4):c=152:33===c?d>0?(c=139,d=4):c=137:72===c?d>0?(c=99,d=4):c=98:132===c&&(d>0?(c=39,d=4):c=38)}if(0!=c&&170!=c){var _,v,m,x,E,w,b,I;_=v=m=x=E=w=b=I=.5;var N=[];1===c?(m=1-Mo(e,p,f),I=1-Mo(e,h,f),N.push(dp[c])):169===c?(m=Mo(s,f,p),I=Mo(s,f,h),N.push(dp[c])):4===c?(w=1-Mo(e,l,p),x=Mo(e,f,p),N.push(fp[c])):166===c?(w=Mo(s,p,l),x=1-Mo(s,p,f),N.push(fp[c])):16===c?(E=Mo(e,p,l),v=Mo(e,h,l),N.push(pp[c])):154===c?(E=1-Mo(s,l,p),v=1-Mo(s,l,h),N.push(pp[c])):64===c?(b=Mo(e,f,h),_=1-Mo(e,l,h),N.push(_p[c])):106===c?(b=1-Mo(s,h,f),_=Mo(s,h,l),N.push(_p[c])):168===c?(x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),N.push(gp[c]),N.push(dp[c])):2===c?(x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),N.push(gp[c]),N.push(dp[c])):162===c?(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),N.push(gp[c]),N.push(dp[c])):8===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),N.push(pp[c]),N.push(fp[c])):138===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(pp[c]),N.push(fp[c])):32===c?(E=Mo(s,p,l),w=Mo(e,p,l),_=Mo(e,h,l),v=Mo(s,h,l),N.push(pp[c]),N.push(fp[c])):42===c?(I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l),N.push(yp[c]),N.push(_p[c])):128===c&&(I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(yp[c]),N.push(_p[c])),5===c?(w=1-Mo(e,l,p),I=1-Mo(e,h,f),N.push(fp[c])):165===c?(w=Mo(s,p,l),I=Mo(s,f,h),N.push(fp[c])):20===c?(x=Mo(e,f,p),v=Mo(e,h,l),N.push(gp[c])):150===c?(x=1-Mo(s,p,f),v=1-Mo(s,l,h),N.push(gp[c])):80===c?(E=Mo(e,p,l),b=Mo(e,f,h),N.push(pp[c])):90===c?(E=1-Mo(s,l,p),b=1-Mo(s,h,f),N.push(pp[c])):65===c?(m=1-Mo(e,p,f),_=1-Mo(e,l,h),N.push(dp[c])):105===c?(m=Mo(s,f,p),_=Mo(s,h,l),N.push(dp[c])):160===c?(E=Mo(s,p,l),w=Mo(e,p,l),I=Mo(e,f,h),b=Mo(s,f,h),N.push(pp[c]),N.push(fp[c])):10===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),I=1-Mo(s,h,f),b=1-Mo(e,h,f),N.push(pp[c]),N.push(fp[c])):130===c?(x=1-Mo(e,p,f),m=1-Mo(s,p,f),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(gp[c]),N.push(dp[c])):40===c?(x=Mo(s,f,p),m=Mo(e,f,p),_=Mo(e,h,l),v=Mo(s,h,l),N.push(gp[c]),N.push(dp[c])):101===c?(w=Mo(s,p,l),_=Mo(s,h,l),N.push(fp[c])):69===c?(w=1-Mo(e,l,p),_=1-Mo(e,l,h),N.push(fp[c])):149===c?(I=Mo(s,f,h),v=1-Mo(s,l,h),N.push(yp[c])):21===c?(I=1-Mo(e,h,f),v=Mo(e,h,l),N.push(yp[c])):86===c?(x=1-Mo(s,p,f),b=1-Mo(s,h,f),N.push(gp[c])):84===c?(x=Mo(e,f,p),b=Mo(e,f,h),N.push(gp[c])):89===c?(E=1-Mo(s,l,p),m=Mo(s,f,p),N.push(dp[c])):81===c?(E=Mo(e,p,l),m=1-Mo(e,p,f),N.push(dp[c])):96===c?(E=Mo(s,p,l),w=Mo(e,p,l),b=Mo(e,f,h),_=Mo(s,h,l),N.push(pp[c]),N.push(fp[c])):74===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),b=1-Mo(s,h,f),_=1-Mo(e,l,h),N.push(pp[c]),N.push(fp[c])):24===c?(E=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),v=Mo(e,h,l),N.push(pp[c]),N.push(dp[c])):146===c?(E=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),v=1-Mo(s,l,h),N.push(pp[c]),N.push(dp[c])):6===c?(w=1-Mo(e,l,p),x=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),N.push(fp[c]),N.push(gp[c])):164===c?(w=Mo(s,p,l),x=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),N.push(fp[c]),N.push(gp[c])):129===c?(m=1-Mo(e,p,f),I=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(dp[c]),N.push(yp[c])):41===c?(m=Mo(s,f,p),I=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l),N.push(dp[c]),N.push(yp[c])):66===c?(x=1-Mo(e,p,f),m=1-Mo(s,p,f),b=1-Mo(s,h,f),_=1-Mo(e,l,h),N.push(gp[c]),N.push(dp[c])):104===c?(x=Mo(s,f,p),m=Mo(e,f,p),b=Mo(e,f,h),_=Mo(s,h,l),N.push(dp[c]),N.push(vp[c])):144===c?(E=Mo(e,p,l),I=Mo(e,f,h),b=Mo(s,f,h),v=1-Mo(s,l,h),N.push(pp[c]),N.push(_p[c])):26===c?(E=1-Mo(s,l,p),I=1-Mo(s,h,f),b=1-Mo(e,h,f),v=Mo(e,h,l),N.push(pp[c]),N.push(_p[c])):36===c?(w=Mo(s,p,l),x=Mo(e,f,p),_=Mo(e,h,l),v=Mo(s,h,l),N.push(fp[c]),N.push(gp[c])):134===c?(w=1-Mo(e,l,p),x=1-Mo(s,p,f),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(fp[c]),N.push(gp[c])):9===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),m=Mo(s,f,p),I=1-Mo(e,h,f),N.push(pp[c]),N.push(fp[c])):161===c?(E=Mo(s,p,l),w=Mo(e,p,l),m=1-Mo(e,p,f),I=Mo(s,f,h),N.push(pp[c]),N.push(fp[c])):37===c?(w=Mo(s,p,l),I=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l),N.push(fp[c]),N.push(yp[c])):133===c?(w=1-Mo(e,l,p),I=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h),N.push(fp[c]),N.push(yp[c])):148===c?(x=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),v=1-Mo(s,l,h),N.push(gp[c]),N.push(_p[c])):22===c?(x=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),v=Mo(e,h,l),N.push(gp[c]),N.push(_p[c])):82===c?(E=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),b=1-Mo(s,h,f),N.push(pp[c]),N.push(dp[c])):88===c?(E=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),b=Mo(e,f,h),N.push(pp[c]),N.push(dp[c])):73===c?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),m=Mo(s,f,p),_=1-Mo(e,l,h),N.push(pp[c]),N.push(fp[c])):97===c?(E=Mo(s,p,l),w=Mo(e,p,l),m=1-Mo(e,p,f),_=Mo(s,h,l),N.push(pp[c]),N.push(fp[c])):145===c?(E=Mo(e,p,l),m=1-Mo(e,p,f),I=Mo(s,f,h),v=1-Mo(s,l,h),N.push(pp[c]),N.push(yp[c])):25===c?(E=1-Mo(s,l,p),m=Mo(s,f,p),I=1-Mo(e,h,f),v=Mo(e,h,l),N.push(pp[c]),N.push(yp[c])):70===c?(w=1-Mo(e,l,p),x=1-Mo(s,p,f),b=1-Mo(s,h,f),_=1-Mo(e,l,h),N.push(fp[c]),N.push(gp[c])):100===c?(w=Mo(s,p,l),x=Mo(e,f,p),b=Mo(e,f,h),_=Mo(s,h,l),N.push(fp[c]),N.push(gp[c])):34===c?(0===d?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)):(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)),N.push(pp[c]),N.push(fp[c]),N.push(yp[c]),N.push(_p[c])):35===c?(4===d?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)):(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)),N.push(pp[c]),N.push(fp[c]),N.push(dp[c]),N.push(_p[c])):136===c?(0===d?(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)):(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)),N.push(pp[c]),N.push(fp[c]),N.push(yp[c]),N.push(_p[c])):153===c?(0===d?(E=Mo(e,p,l),m=1-Mo(e,p,f),I=1-Mo(e,h,f),v=Mo(e,h,l)):(E=1-Mo(s,l,p),m=Mo(s,f,p),I=Mo(s,f,h),v=1-Mo(s,l,h)),N.push(pp[c]),N.push(dp[c])):102===c?(0===d?(w=1-Mo(e,l,p),x=Mo(e,f,p),b=Mo(e,f,h),_=1-Mo(e,l,h)):(w=Mo(s,p,l),x=1-Mo(s,p,f),b=1-Mo(s,h,f),_=Mo(s,h,l)),N.push(fp[c]),N.push(_p[c])):155===c?(4===d?(E=Mo(e,p,l),m=1-Mo(e,p,f),I=1-Mo(e,h,f),v=Mo(e,h,l)):(E=1-Mo(s,l,p),m=Mo(s,f,p),I=Mo(s,f,h),v=1-Mo(s,l,h)),N.push(pp[c]),N.push(yp[c])):103===c?(4===d?(w=1-Mo(e,l,p),x=Mo(e,f,p),b=Mo(e,f,h),_=1-Mo(e,l,h)):(w=Mo(s,p,l),x=1-Mo(s,p,f),b=1-Mo(s,h,f),_=Mo(s,h,l)),N.push(fp[c]),N.push(gp[c])):152===c?(0===d?(E=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),v=Mo(e,h,l)):(E=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),v=1-Mo(s,l,h)),N.push(pp[c]),N.push(gp[c]),N.push(dp[c])):156===c?(4===d?(E=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),v=Mo(e,h,l)):(E=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),v=1-Mo(s,l,h)),N.push(pp[c]),N.push(dp[c]),N.push(_p[c])):137===c?(0===d?(E=Mo(s,p,l),w=Mo(e,p,l),m=1-Mo(e,p,f),I=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)):(E=1-Mo(e,l,p),w=1-Mo(s,l,p),m=Mo(s,f,p),I=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)),N.push(pp[c]),N.push(fp[c]),N.push(dp[c])):139===c?(4===d?(E=Mo(s,p,l),w=Mo(e,p,l),m=1-Mo(e,p,f),I=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)):(E=1-Mo(e,l,p),w=1-Mo(s,l,p),m=Mo(s,f,p),I=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)),N.push(pp[c]),N.push(fp[c]),N.push(yp[c])):98===c?(0===d?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),b=Mo(e,f,h),_=1-Mo(e,l,h)):(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),b=1-Mo(s,h,f),_=Mo(s,h,l)),N.push(pp[c]),N.push(fp[c]),N.push(_p[c])):99===c?(4===d?(E=1-Mo(e,l,p),w=1-Mo(s,l,p),x=Mo(s,f,p),m=Mo(e,f,p),b=Mo(e,f,h),_=1-Mo(e,l,h)):(E=Mo(s,p,l),w=Mo(e,p,l),x=1-Mo(e,p,f),m=1-Mo(s,p,f),b=1-Mo(s,h,f),_=Mo(s,h,l)),N.push(pp[c]),N.push(fp[c]),N.push(dp[c])):38===c?(0===d?(w=1-Mo(e,l,p),x=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)):(w=Mo(s,p,l),x=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)),N.push(fp[c]),N.push(yp[c]),N.push(_p[c])):39===c?(4===d?(w=1-Mo(e,l,p),x=Mo(e,f,p),I=Mo(e,f,h),b=Mo(s,f,h),_=1-Mo(s,l,h),v=1-Mo(e,l,h)):(w=Mo(s,p,l),x=1-Mo(s,p,f),I=1-Mo(s,h,f),b=1-Mo(e,h,f),_=Mo(e,h,l),v=Mo(s,h,l)),N.push(fp[c]),N.push(gp[c]),N.push(_p[c])):85===c&&(E=1,w=0,x=1,m=0,I=0,b=1,_=0,v=1),(_<0||_>1||v<0||v>1||E<0||E>1||x<0||x>1||I<0||I>1||b<0||b>1)&&console.log("MarchingSquaresJS-isoBands: "+c+" "+g+" "+h+","+l+","+p+","+f+" "+d+" "+_+" "+v+" "+E+" "+w+" "+x+" "+m+" "+I+" "+b),o.cells[a][u]={cval:c,cval_real:g,flipped:d,topleft:_,topright:v,righttop:E,rightbottom:w,bottomright:x,bottomleft:m,leftbottom:I,lefttop:b,edges:N}}}}}return o}function Oo(t){for(var e=[],n=t.rows,r=t.cols,i=[],o=0;o<n;o++)for(var s=0;s<r;s++)if(void 0!==t.cells[o][s]&&t.cells[o][s].edges.length>0){var a=t.cells[o][s],u=Ao(a),c=null,h=s,l=o;null!==u&&i.push([u.p[0]+h,u.p[1]+l]);do{if(null===(c=Do(t.cells[l][h],u.x,u.y,u.o)))break;if(i.push([c.p[0]+h,c.p[1]+l]),h+=c.x,l+=c.y,u=c,l<0||l>=n||h<0||h>=r||void 0===t.cells[l][h]){h-=c.x,l-=c.y;var p=Ro(t,h,l,c.x,c.y,c.o);if(null===p)break;p.path.forEach(function(t){i.push(t)}),h=p.i,l=p.j,u=p}}while(void 0!==t.cells[l][h]&&t.cells[l][h].edges.length>0);e.push(i),i=[],t.cells[o][s].edges.length>0&&s--}return e}function Ro(t,e,n,r,i,o){for(var s=t.cells[n][e],a=s.cval_real,u=e+r,c=n+i,h=[],l=!1;!l;){if(void 0===t.cells[c]||void 0===t.cells[c][u])if(c-=i,u-=r,s=t.cells[c][u],a=s.cval_real,-1===i)if(0===o)if(a&el)h.push([u,c]),r=-1,i=0,o=0;else{if(!(a&tl)){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u+1,c]),r=1,i=0,o=0}else{if(!(a&el)){if(a&tl){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u+s.bottomleft,c]),r=0,i=1,o=0,l=!0;break}h.push([u,c]),r=-1,i=0,o=0}else if(1===i)if(0===o){if(!(a&$h)){if(a&Qh){h.push([u+s.topleft,c+1]),r=0,i=-1,o=0,l=!0;break}h.push([u+s.topright,c+1]),r=0,i=-1,o=1,l=!0;break}h.push([u+1,c+1]),r=1,i=0,o=1}else h.push([u+1,c+1]),r=1,i=0,o=1;else if(-1===r)if(0===o){if(!(a&Qh)){if(a&el){h.push([u,c+s.leftbottom]),r=1,i=0,o=0,l=!0;break}h.push([u,c+s.lefttop]),r=1,i=0,o=1,l=!0;break}h.push([u,c+1]),r=0,i=1,o=0}else{if(!(a&Qh)){console.log("MarchingSquaresJS-isoBands: wtf");break}h.push([u,c+1]),r=0,i=1,o=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(a&tl)){h.push([u+1,c+s.rightbottom]),r=-1,i=0,o=0,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}else{if(!(a&tl)){if(a&$h){h.push([u+1,c+s.righttop]),r=-1,i=0,o=1;break}h.push([u+1,c+s.rightbottom]),r=-1,i=0,o=0,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}}else if(s=t.cells[c][u],a=s.cval_real,-1===r)if(0===o)if(void 0!==t.cells[c-1]&&void 0!==t.cells[c-1][u])r=0,i=-1,o=1;else{if(!(a&el)){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u,c])}else{if(!(a&Qh)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+c);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c+1]&&void 0!==t.cells[c+1][u])r=0,i=1,o=0;else{if(!(a&$h)){h.push([u+s.topleft,c+1]),r=0,i=-1,o=0,l=!0;break}h.push([u+1,c+1]),r=1,i=0,o=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u+1])r=1,i=0,o=1;else{if(!(a&tl)){h.push([u+1,c+s.righttop]),r=-1,i=0,o=1,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u-1])r=-1,i=0,o=0;else{if(!(a&Qh)){h.push([u,c+s.leftbottom]),r=1,i=0,o=0,l=!0;break}h.push([u,c+1]),r=0,i=1,o=0}}if(u+=r,c+=i,u===e&&c===n)break}return{path:h,i:u,j:c,x:r,y:i,o:o}}function To(t,e){delete t.edges[e];for(var n=e+1;n<t.edges.length;n++)t.edges[n-1]=t.edges[n];t.edges.pop()}function Ao(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],n=t.cval_real;switch(e){case 0:return n&$h?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return n&tl?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return n&tl?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return n&el?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return n&$h?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return n&tl?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return n&tl?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return n&el?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return n&tl?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return n&el?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return n&el?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return n&Qh?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return n&tl?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return n&el?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return n&el?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return n&Qh?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return n&tl?{p:[t.bottomright,0],x:0,y:1,o:1}:{
p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return n&Qh?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return n&el?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return n&Qh?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return n&Qh?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return n&$h?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return n&Qh?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return n&$h?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function Do(t,e,n,r){var i,o,s,a,u,c=t.cval;switch(e){case-1:switch(r){case 0:i=fp[c],s=ll[c],a=pl[c],u=fl[c];break;default:i=pp[c],s=ul[c],a=cl[c],u=hl[c]}break;case 1:switch(r){case 0:i=yp[c],s=bl[c],a=Il[c],u=Nl[c];break;default:i=_p[c],s=xl[c],a=El[c],u=wl[c]}break;default:switch(n){case-1:switch(r){case 0:i=vp[c],s=nl[c],a=rl[c],u=il[c];break;default:i=mp[c],s=ol[c],a=sl[c],u=al[c]}break;case 1:switch(r){case 0:i=dp[c],s=gl[c],a=dl[c],u=yl[c];break;default:i=gp[c],s=_l[c],a=vl[c],u=ml[c]}}}if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;switch(To(t,o),c=t.cval_real,i){case 0:c&$h?(e=t.topleft,n=1):(e=1,n=t.righttop);break;case 1:c&tl?(e=1,n=t.rightbottom):(e=t.topleft,n=1);break;case 2:c&tl?(e=t.topleft,n=1):(e=t.bottomright,n=0);break;case 3:c&el?(e=t.bottomleft,n=0):(e=t.topleft,n=1);break;case 4:c&$h?(e=t.topright,n=1):(e=1,n=t.righttop);break;case 5:c&tl?(e=1,n=t.rightbottom):(e=t.topright,n=1);break;case 6:c&tl?(e=t.topright,n=1):(e=t.bottomright,n=0);break;case 7:c&el?(e=t.bottomleft,n=0):(e=t.topright,n=1);break;case 8:c&tl?(e=1,n=t.righttop):(e=t.bottomright,n=0);break;case 9:c&el?(e=t.bottomleft,n=0):(e=1,n=t.righttop);break;case 10:c&el?(e=1,n=t.righttop):(e=0,n=t.leftbottom);break;case 11:c&Qh?(e=0,n=t.lefttop):(e=1,n=t.righttop);break;case 12:c&tl?(e=1,n=t.rightbottom):(e=t.bottomright,n=0);break;case 13:c&el?(e=t.bottomleft,n=0):(e=1,n=t.rightbottom);break;case 14:c&el?(e=1,n=t.rightbottom):(e=0,n=t.leftbottom);break;case 15:c&Qh?(e=0,n=t.lefttop):(e=1,n=t.rightbottom);break;case 16:c&tl?(e=0,n=t.leftbottom):(e=t.bottomright,n=0);break;case 17:c&Qh?(e=0,n=t.lefttop):(e=t.bottomright,n=0);break;case 18:c&el?(e=t.bottomleft,n=0):(e=0,n=t.leftbottom);break;case 19:c&Qh?(e=0,n=t.lefttop):(e=t.bottomleft,n=0);break;case 20:c&Qh?(e=0,n=t.leftbottom):(e=t.topleft,n=1);break;case 21:c&$h?(e=t.topright,n=1):(e=0,n=t.leftbottom);break;case 22:c&Qh?(e=0,n=t.lefttop):(e=t.topleft,n=1);break;case 23:c&$h?(e=t.topright,n=1):(e=0,n=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==n&&void 0!==s&&void 0!==a&&void 0!==u||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+n+" "+s+" "+a+" "+u)),{p:[e,n],x:s,y:a,o:u}}function Fo(t){var e=[],n=0;return t.cells.forEach(function(t,r){t.forEach(function(t,i){if(void 0!==t){var o=xp[t.cval](t);"object"==typeof o&&Lo(o)?"object"==typeof o[0]&&Lo(o[0])?"object"==typeof o[0][0]&&Lo(o[0][0])?o.forEach(function(t){t.forEach(function(t){t[0]+=i,t[1]+=r}),e[n++]=t}):(o.forEach(function(t){t[0]+=i,t[1]+=r}),e[n++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),e}function qo(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(et(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!I(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var s=No(t,{zProperty:r,flip:!0}),a=Go(s,e,r);return a=Bo(a,s,t),c(a.map(function(t,e){if(o[e]&&!I(o[e]))throw new Error("Each mappedProperty is required to be an Object");var n=Object.assign({},i,o[e]);return n[r]=t[r],p(t.groupedRings,n)}))}function Go(t,e,n){for(var r=[],i=1;i<e.length;i++){var o=+e[i-1],s=+e[i],a=So(t,o,s-o),u=ko(a),c=zo(u),h={};h.groupedRings=c,h[n]=o+"-"+s,r.push(h)}return r}function Bo(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,c=e.length-1,h=i/u,l=o/c,p=function(t){t[0]=t[0]*h+s,t[1]=t[1]*l+a};return t.forEach(function(t){t.groupedRings.forEach(function(t){t.forEach(function(t){t.forEach(p)})})}),t}function ko(t){var e=[],n=[];t.forEach(function(t){var r=ei(o([t]));n.push(r),e.push({ring:t,area:r})}),n.sort(function(t,e){return e-t});var r=[];return n.forEach(function(t){for(var n=0;n<e.length;n++)if(e[n].area===t){r.push(e[n].ring),e.splice(n,1);break}}),r}function zo(t){for(var e=t.map(function(t){return{lrCoordinates:t,grouped:!1}}),n=[];!Xo(e);)for(var r=0;r<e.length;r++)if(!e[r].grouped){var i=[];i.push(e[r].lrCoordinates),e[r].grouped=!0;for(var s=o([e[r].lrCoordinates]),a=r+1;a<e.length;a++)if(!e[a].grouped){var u=o([e[a].lrCoordinates]);jo(u,s)&&(i.push(e[a].lrCoordinates),e[a].grouped=!0)}n.push(i)}return n}function jo(t,e){for(var n=bn(t),r=0;r<n.features.length;r++)if(!ue(n.features[r],e))return!1;return!0}function Xo(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}function Uo(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("angle is required");return 0===e?t:(r||(r=xn(t)),!1!==i&&void 0!==i||(t=ve(t)),A(t,function(t){var n=Rr(r,t),i=n+e,o=Ar(r,t),s=K(po(r,o,i));t[0]=s[0],t[1]=s[1]}),t)}function Yo(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw new Error("geojson required");if("number"!=typeof e||0===e)throw new Error("invalid factor");var o=Array.isArray(r)||"object"==typeof r;return!0!==i&&(t=ve(t)),"FeatureCollection"!==t.type||o?Vo(t,e,r):(G(t,function(n,i){t.features[i]=Vo(n,e,r)}),t)}function Vo(t,e,n){var r="Point"===it(t);return n=Ho(t,n),1===e||r?t:(A(t,function(t){var r=Ar(n,t),i=Rr(n,t),o=r*e,s=K(po(n,o,i));t[0]=s[0],t[1]=s[1],3===t.length&&(t[2]*=e)}),t)}function Ho(t,e){if(void 0!==e&&null!==e||(e="centroid"),Array.isArray(e)||"object"==typeof e)return Z(e);var n=t.bbox?t.bbox:J(t),i=n[0],o=n[1],s=n[2],a=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return r([i,o]);case"se":case"southeast":case"eastsouth":case"bottomright":return r([s,o]);case"nw":case"northwest":case"westnorth":case"topleft":return r([i,a]);case"ne":case"northeast":case"eastnorth":case"topright":return r([s,a]);case"center":return mn(t);case void 0:case null:case"centroid":return xn(t);default:throw new Error("invalid origin")}}function Wo(t,e,n,r){if(r=r||{},!I(r))throw new Error("options is invalid");var i=r.units,o=r.zTranslation,s=r.mutate;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(void 0===n||null===n||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n=-n),!1!==s&&void 0!==s||(t=ve(t)),A(t,function(t){var r=K(po(t,e,n,{units:i}));t[0]=r[0],t[1]=r[1],o&&3===t.length&&(t[2]+=o)}),t}function Jo(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function Zo(t,e){return t[0]*e[1]-e[0]*t[1]}function Ko(t,e){return[t[0]+e[0],t[1]+e[1]]}function Qo(t,e){return[t[0]-e[0],t[1]-e[1]]}function $o(t,e){return[t*e[0],t*e[1]]}function ts(t,e){var n=t[0],r=Jo(t),i=e[0],o=Jo(e),s=Zo(r,o);return Ko(n,$o(Zo(Qo(i,n),o)/s,r))}function es(t,e){return 0===Zo(Jo(t),Jo(e))}function ns(t,e){return!es(t,e)&&ts(t,e)}function rs(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("distance is required");var i=it(t),o=t.properties;switch(i){case"LineString":return is(t,e,r);case"MultiLineString":var s=[];return X(t,function(t){s.push(is(t,e,r).geometry.coordinates)}),h(s,o);default:throw new Error("geometry "+i+" is not supported")}}function is(t,e,n){var r=[],i=_(e,n),o=K(t),s=[];return o.forEach(function(t,e){if(e!==o.length-1){var n=os(t,o[e+1],i);if(r.push(n),e>0){var a=r[e-1],u=ns(n,a);!1!==u&&(a[1]=u,n[0]=u),s.push(a[0]),e===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}}),a(s,t.properties)}function os(t,e,n){var r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),i=t[0]+n*(e[1]-t[1])/r,o=e[0]+n*(e[1]-t[1])/r;return[[i,t[1]+n*(t[0]-e[0])/r],[o,e[1]+n*(t[0]-e[0])/r]]}function ss(t,e,n){var r=e[0]-t[0],i=e[1]-t[1],o=n[0]-e[0],s=n[1]-e[1];return Math.sign(r*s-o*i)}function as(t,e){var n=t.geometry.coordinates.map(function(t){return t[0]}),r=t.geometry.coordinates.map(function(t){return t[1]}),i=e.geometry.coordinates.map(function(t){return t[0]}),o=e.geometry.coordinates.map(function(t){return t[1]});return Math.max(null,n)===Math.max(null,i)&&Math.max(null,r)===Math.max(null,o)&&Math.min(null,n)===Math.min(null,i)&&Math.min(null,r)===Math.min(null,o)}function us(t,e){return e.geometry.coordinates[0].every(function(e){return ue(r(e),t)})}function cs(t,e){return t[0]===e[0]&&t[1]===e[1]}function hs(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}function ls(t){var e=Np.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var n=[],r=[];return e.getEdgeRings().filter(function(t){return t.isValid()}).forEach(function(t){t.isHole()?n.push(t):r.push(t)}),n.forEach(function(t){bp.findEdgeRingContaining(t,r)&&r.push(t)}),c(r.map(function(t){return t.toPolygon()}))}function ps(t,e){var n;return X(t,function(t){X(e,function(e){if(!1===n)return!1;n=fs(t.geometry,e.geometry)})}),n}function fs(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!ms(t.coordinates,e.coordinates);case"LineString":return!gs(e,t);case"Polygon":return!ue(t,e)}break;case"LineString":switch(e.type){case"Point":return!gs(t,e);case"LineString":return!ds(t,e);case"Polygon":return!ys(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ue(e,t);case"LineString":return!ys(t,e);case"Polygon":return!_s(e,t)}}}function gs(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(vs(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function ds(t,e){return Lr(t,e).features.length>0}function ys(t,e){return Lr(e,Ui(t)).features.length>0}function _s(t,e){for(var n=0;n<t.coordinates[0].length;n++)if(ue(t.coordinates[0][n],e))return!0;for(var r=0;r<e.coordinates[0].length;r++)if(ue(e.coordinates[0][r],t))return!0;return!1}function vs(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];return 0==r*s-i*o&&(Math.abs(o)>=Math.abs(s)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}function ms(t,e){return t[0]===e[0]&&t[1]===e[1]}function xs(t,e){var n=it(t),r=it(e),i=nt(t),o=nt(e),s=K(t),a=K(e);switch(n){case"Point":switch(r){case"Point":return Ls(s,a);default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"Point":return Es(i,o);case"MultiPoint":return ws(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"Point":return hi(o,i,{ignoreEndVertices:!0});case"LineString":return Ns(i,o);case"MultiPoint":return bs(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Point":return ue(o,i,{ignoreBoundary:!0});case"LineString":return Cs(i,o);case"Polygon":return Ss(i,o);case"MultiPoint":return Is(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function Es(t,e){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(Ls(t.coordinates[n],e.coordinates)){r=!0;break}return r}function ws(t,e){for(var n=0;n<e.coordinates.length;n++){for(var r=!1,i=0;i<t.coordinates.length;i++)if(Ls(e.coordinates[n],t.coordinates[i])){r=!0;break}if(!r)return!1}return!0}function bs(t,e){for(var n=!1,r=0;r<e.coordinates.length;r++)if(hi(e.coordinates[r],t,{ignoreEndVertices:!0})&&(n=!0),!hi(e.coordinates[r],t))return!1;return!!n}function Is(t,e){for(var n=0;n<e.coordinates.length;n++)if(!ue(e.coordinates[n],t,{ignoreBoundary:!0}))return!1;return!0}function Ns(t,e){for(var n=!1,r=0;r<e.coordinates.length;r++)if(hi({type:"Point",coordinates:e.coordinates[r]},t,{ignoreEndVertices:!0})&&(n=!0),!hi({type:"Point",coordinates:e.coordinates[r]},t,{ignoreEndVertices:!1}))return!1;return n}function Cs(t,e){var n=!1,r=0;if(!Ms(J(t),J(e)))return!1;for(r;r<e.coordinates.length-1;r++){if(ue({type:"Point",coordinates:Ps(e.coordinates[r],e.coordinates[r+1])},t,{ignoreBoundary:!0})){n=!0;break}}return n}function Ss(t,e){if(!Ms(J(t),J(e)))return!1;for(var n=0;n<e.coordinates[0].length;n++)if(!ue(e.coordinates[0][n],t))return!1;return!0}function Ms(t,e){return!(t[0]>e[0])&&(!(t[2]<e[2])&&(!(t[1]>e[1])&&!(t[3]<e[3])))}function Ls(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ps(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function Os(t,e){var n=it(t),r=it(e),i=nt(t),o=nt(e);switch(n){case"MultiPoint":switch(r){case"LineString":return Rs(i,o);case"Polygon":return Ds(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"MultiPoint":return Rs(o,i);case"LineString":return Ts(i,o);case"Polygon":return As(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"MultiPoint":return Ds(o,i);case"LineString":return As(o,i);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function Rs(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&!n&&!r;){for(var s=0;s<e.coordinates.length-1;s++){var a=!0;0!==s&&s!==e.coordinates.length-2||(a=!1),Fs(e.coordinates[s],e.coordinates[s+1],t.coordinates[o],a)?n=!0:r=!0}o++}return n&&r}function Ts(t,e){if(Lr(t,e).features.length>0)for(var n=0;n<t.coordinates.length-1;n++)for(var r=0;r<e.coordinates.length-1;r++){var i=!0;if(0!==r&&r!==e.coordinates.length-2||(i=!1),Fs(t.coordinates[n],t.coordinates[n+1],e.coordinates[r],i))return!0}return!1}function As(t,e){return Lr(t,Ui(e)).features.length>0}function Ds(t,e){for(var n=!1,i=!1,o=t.coordinates[0].length,s=0;s<o&&n&&i;)ue(r(t.coordinates[0][s]),e)?n=!0:i=!0,s++;return i&&i}function Fs(t,e,n,r){var i=n[0]-t[0],o=n[1]-t[1],s=e[0]-t[0],a=e[1]-t[1];return 0==i*a-o*s&&(r?Math.abs(s)>=Math.abs(a)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]:Math.abs(s)>=Math.abs(a)?s>0?t[0]<n[0]&&n[0]<e[0]:e[0]<n[0]&&n[0]<t[0]:a>0?t[1]<n[1]&&n[1]<e[1]:e[1]<n[1]&&n[1]<t[1])}function qs(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function Gs(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function Bs(t,e){return Mp(t,e,{strict:!0})}function ks(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");var n=it(t);if(n!==it(e))throw new Error("features must be of the same type");if("Point"===n)throw new Error("Point geometry not supported");if(new Pp({precision:6}).compare(t,e))return!1;var r=0;switch(n){case"MultiPoint":var i=k(t),o=k(e);i.forEach(function(t){o.forEach(function(e){t[0]===e[0]&&t[1]===e[1]&&r++})});break;case"LineString":case"MultiLineString":Y(t,function(t){Y(e,function(e){uo(t,e).features.length&&r++})});break;case"Polygon":case"MultiPolygon":Y(t,function(t){Y(e,function(e){Lr(t,e).features.length&&r++})})}return r>0}function zs(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");return it(t)===it(e)&&new Pp({precision:6}).compare(Ye(t),Ye(e))}function js(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.minPoints,i=n.units;if(et(t,"Point","Input must contain Points"),null===e||void 0===e)throw new Error("maxDistance is required");if(!(Math.sign(e)>0))throw new Error("Invalid maxDistance");if(!(void 0===r||null===r||Math.sign(r)>0))throw new Error("Invalid minPoints");t=ve(t,!0),r=r||3;var o=new Dp.DBSCAN,s=o.run(k(t),E(e,i),r,_e),a=-1;return s.forEach(function(e){a++,e.forEach(function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster=a,n.properties.dbscan="core"})}),o.noise.forEach(function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster?n.properties.dbscan="edge":n.properties.dbscan="noise"}),t}function Xs(t,e,n){n=n||[];for(var r=0;r<t;r++)n[r]=e;return n}function Us(t,e,n,r){var i=[],o=[],s=[],a=[],u=!1,c=r||Xp,h=t.length,l=t[0].length,p=l>0,f=[];if(n)i="kmrand"==n?zp(t,e):"kmpp"==n?jp(t,e):n;else for(var g={};i.length<e;){var d=Math.floor(Math.random()*h);g[d]||(g[d]=!0,i.push(t[d]))}do{Xs(e,0,f);for(var y=0;y<h;y++){for(var _=1/0,v=0,m=0;m<e;m++){var a=p?kp(t[y],i[m]):Math.abs(t[y]-i[m]);a<=_&&(_=a,v=m)}s[y]=v,f[v]++}for(var x=[],o=[],E=0;E<e;E++)x[E]=p?Xs(l,0,x[E]):0,o[E]=i[E];if(p){for(var w=0;w<e;w++)i[w]=[];for(var b=0;b<h;b++)for(var I=s[b],N=x[I],C=t[b],S=0;S<l;S++)N[S]+=C[S];u=!0;for(var M=0;M<e;M++){for(var L=i[M],P=x[M],O=o[M],R=f[M],T=0;T<l;T++)L[T]=P[T]/R||0;if(u)for(var A=0;A<l;A++)if(O[A]!=L[A]){u=!1;break}}}else{for(var D=0;D<h;D++){x[s[D]]+=t[D]}for(var F=0;F<e;F++)i[F]=x[F]/f[F]||0;u=!0;for(var q=0;q<e;q++)if(o[q]!=i[q]){u=!1;break}}u=u||--c<=0}while(!u);return{it:Xp-c,k:e,idxs:s,centroids:i}}function Ys(t,e){if("object"!=typeof(e=e||{}))throw new Error("options is invalid");var n=e.numberOfClusters,r=e.mutate;et(t,"Point","Input must contain Points");var i=t.features.length;n=n||Math.round(Math.sqrt(i/2)),n>i&&(n=i),!1!==r&&void 0!==r||(t=ve(t,!0));var o=k(t),s=o.slice(0,n),a=Up(o,n,s),u={};return a.centroids.forEach(function(t,e){u[e]=t}),G(t,function(t,e){var n=a.idxs[e];t.properties.cluster=n,t.properties.centroid=u[n]}),t}function Vs(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==Ws(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==Ws(e,"line2"))throw new Error("line2 must be a LineString");for(var n=Nr(Ye(t)).features,r=Nr(Ye(e)).features,i=0;i<n.length;i++){var o=n[i].geometry.coordinates;if(!r[i])break;if(!Hs(o,r[i].geometry.coordinates))return!1}return!0}function Hs(t,e){return v(Rr(t[0],t[1]))===v(Rr(e[0],e[1]))}function Ws(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function Js(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}function Zs(){return new $s(function(t){return t.f})}function Ks(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var o=new Qs(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function Qs(t,e,n){this.x=t,this.y=e,this.weight=n}function $s(t){this.content=[],this.scoreFunction=t}function ta(t,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.resolution,s=i.minDistance,u=i.obstacles||c([]);if(!t)throw new Error("start is required");if(!n)throw new Error("end is required");if(o&&!b(o)||o<=0)throw new Error("options.resolution must be a number, greater than 0");if(s)throw new Error("options.minDistance is not yet implemented");var h=Z(t),l=Z(n);switch(t=r(h),n=r(l),it(u)){case"FeatureCollection":if(0===u.features.length)return a([h,l]);break;case"Polygon":u=c([e(nt(u))]);break;default:throw new Error("invalid obstacles")}var p=u;p.features.push(t),p.features.push(n);var f=J(Yo(ln(J(p)),1.15));if(!o){o=_e([f[0],f[1]],[f[2],f[1]],i)/100}p.features.pop(),p.features.pop();for(var g=f[0],d=f[1],y=f[2],_=f[3],v=o/_e([g,d],[y,d],i),m=v*(y-g),x=o/_e([g,d],[g,_],i),E=x*(_-d),w=y-g,N=_-d,C=Math.floor(w/m),S=Math.floor(N/E),M=(w-C*m)/2,L=(N-S*E)/2,P=[],O=[],R=[],T=[],A=1/0,D=1/0,F=_-L,q=0;F>=d;){for(var G=[],B=[],k=g+M,z=0;k<=y;){var j=r([k,F]),X=ea(j,u);G.push(X?0:1),B.push(k+"|"+F);var U=_e(j,t);!X&&U<A&&(A=U,R={x:z,y:q});var Y=_e(j,n);!X&&Y<D&&(D=Y,T={x:z,y:q}),k+=m,z++}O.push(G),P.push(B),F-=E,q++}var V=new Ks(O,{diagonal:!0}),H=V.grid[R.y][R.x],W=V.grid[T.y][T.x],K=Yp.search(V,H,W),Q=[h];return K.forEach(function(t){var e=P[t.x][t.y].split("|");Q.push([+e[0],+e[1]])}),Q.push(l),Ye(a(Q))}function ea(t,e){for(var n=0;n<e.features.length;n++)if(ue(t,e.features[n]))return!0;return!1}function na(t){return t[0]}function ra(t){return t[1]}function ia(){this._=null}function oa(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function sa(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function aa(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ua(t){for(;t.L;)t=t.L;return t}function ca(t,e,n,r){var i=[null,null],o=Kp.push(i)-1;return i.left=t,i.right=e,n&&la(i,t,e,n),r&&la(i,e,t,r),Jp[t.index].halfedges.push(o),Jp[e.index].halfedges.push(o),i}function ha(t,e,n){var r=[e,n];return r.left=t,r}function la(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function pa(t,e,n,r,i){var o,s=t[0],a=t[1],u=s[0],c=s[1],h=a[0],l=a[1],p=0,f=1,g=h-u,d=l-c;if(o=e-u,g||!(o>0)){if(o/=g,g<0){if(o<p)return;o<f&&(f=o)}else if(g>0){if(o>f)return;o>p&&(p=o)}if(o=r-u,g||!(o<0)){if(o/=g,g<0){if(o>f)return;o>p&&(p=o)}else if(g>0){if(o<p)return;o<f&&(f=o)}if(o=n-c,d||!(o>0)){if(o/=d,d<0){if(o<p)return;o<f&&(f=o)}else if(d>0){if(o>f)return;o>p&&(p=o)}if(o=i-c,d||!(o<0)){if(o/=d,d<0){if(o>f)return;o>p&&(p=o)}else if(d>0){if(o<p)return;o<f&&(f=o)}return!(p>0||f<1)||(p>0&&(t[0]=[u+p*g,c+p*d]),f<1&&(t[1]=[u+f*g,c+f*d]),!0)}}}}}function fa(t,e,n,r,i){var o=t[1];if(o)return!0;var s,a,u=t[0],c=t.left,h=t.right,l=c[0],p=c[1],f=h[0],g=h[1],d=(l+f)/2,y=(p+g)/2;if(g===p){if(d<e||d>=r)return;if(l>f){if(u){if(u[1]>=i)return}else u=[d,n];o=[d,i]}else{if(u){if(u[1]<n)return}else u=[d,i];o=[d,n]}}else if(s=(l-f)/(g-p),a=y-s*d,s<-1||s>1)if(l>f){if(u){if(u[1]>=i)return}else u=[(n-a)/s,n];o=[(i-a)/s,i]}else{if(u){if(u[1]<n)return}else u=[(i-a)/s,i];o=[(n-a)/s,n]}else if(p<g){if(u){if(u[0]>=r)return}else u=[e,s*e+a];o=[r,s*r+a]}else{if(u){if(u[0]<e)return}else u=[r,s*r+a];o=[e,s*e+a]}return t[0]=u,t[1]=o,!0}function ga(t,e,n,r){for(var i,o=Kp.length;o--;)fa(i=Kp[o],t,e,n,r)&&pa(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>tf||Math.abs(i[0][1]-i[1][1])>tf)||delete Kp[o]}function da(t){return Jp[t.index]={site:t,halfedges:[]}}function ya(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function _a(t,e){return e[+(e.left!==t.site)]}function va(t,e){return e[+(e.left===t.site)]}function ma(){for(var t,e,n,r,i=0,o=Jp.length;i<o;++i)if((t=Jp[i])&&(r=(e=t.halfedges).length)){var s=new Array(r),a=new Array(r);for(n=0;n<r;++n)s[n]=n,a[n]=ya(t,Kp[e[n]]);for(s.sort(function(t,e){return a[e]-a[t]}),n=0;n<r;++n)a[n]=e[s[n]];for(n=0;n<r;++n)e[n]=a[n]}}function xa(t,e,n,r){var i,o,s,a,u,c,h,l,p,f,g,d,y=Jp.length,_=!0;for(i=0;i<y;++i)if(o=Jp[i]){for(s=o.site,u=o.halfedges,a=u.length;a--;)Kp[u[a]]||u.splice(a,1);for(a=0,c=u.length;a<c;)f=va(o,Kp[u[a]]),g=f[0],d=f[1],h=_a(o,Kp[u[++a%c]]),l=h[0],p=h[1],(Math.abs(g-l)>tf||Math.abs(d-p)>tf)&&(u.splice(a,0,Kp.push(ha(s,f,Math.abs(g-t)<tf&&r-d>tf?[t,Math.abs(l-t)<tf?p:r]:Math.abs(d-r)<tf&&n-g>tf?[Math.abs(p-r)<tf?l:n,r]:Math.abs(g-n)<tf&&d-e>tf?[n,Math.abs(l-n)<tf?p:e]:Math.abs(d-e)<tf&&g-t>tf?[Math.abs(p-e)<tf?l:t,e]:null))-1),++c);c&&(_=!1)}if(_){var v,m,x,E=1/0;for(i=0,_=null;i<y;++i)(o=Jp[i])&&(s=o.site,v=s[0]-t,m=s[1]-e,(x=v*v+m*m)<E&&(E=x,_=o));if(_){var w=[t,e],b=[t,r],I=[n,r],N=[n,e];_.halfedges.push(Kp.push(ha(s=_.site,w,b))-1,Kp.push(ha(s,b,I))-1,Kp.push(ha(s,I,N))-1,Kp.push(ha(s,N,w))-1)}}for(i=0;i<y;++i)(o=Jp[i])&&(o.halfedges.length||delete Jp[i])}function Ea(){oa(this),this.x=this.y=this.arc=this.site=this.cy=null}function wa(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var s=i[0],a=i[1],u=r[0]-s,c=r[1]-a,h=o[0]-s,l=o[1]-a,p=2*(u*l-c*h);if(!(p>=-ef)){var f=u*u+c*c,g=h*h+l*l,d=(l*f-c*g)/p,y=(u*g-h*f)/p,_=Qp.pop()||new Ea;_.arc=t,_.site=i,_.x=d+s,_.y=(_.cy=y+a)+Math.sqrt(d*d+y*y),t.circle=_;for(var v=null,m=Zp._;m;)if(_.y<m.y||_.y===m.y&&_.x<=m.x){if(!m.L){v=m.P;break}m=m.L}else{if(!m.R){v=m;break}m=m.R}Zp.insert(v,_),v||(Hp=_)}}}}function ba(t){var e=t.circle;e&&(e.P||(Hp=e.N),Zp.remove(e),Qp.push(e),oa(e),t.circle=null)}function Ia(){oa(this),this.edge=this.site=this.circle=null}function Na(t){var e=$p.pop()||new Ia;return e.site=t,e}function Ca(t){ba(t),Wp.remove(t),$p.push(t),oa(t)}function Sa(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,s=t.N,a=[t];Ca(t);for(var u=o;u.circle&&Math.abs(n-u.circle.x)<tf&&Math.abs(r-u.circle.cy)<tf;)o=u.P,a.unshift(u),Ca(u),u=o;a.unshift(u),ba(u);for(var c=s;c.circle&&Math.abs(n-c.circle.x)<tf&&Math.abs(r-c.circle.cy)<tf;)s=c.N,a.push(c),Ca(c),c=s;a.push(c),ba(c);var h,l=a.length;for(h=1;h<l;++h)c=a[h],u=a[h-1],la(c.edge,u.site,c.site,i);u=a[0],c=a[l-1],c.edge=ca(u.site,c.site,null,i),wa(u),wa(c)}function Ma(t){for(var e,n,r,i,o=t[0],s=t[1],a=Wp._;a;)if((r=La(a,s)-o)>tf)a=a.L;else{if(!((i=o-Pa(a,s))>tf)){r>-tf?(e=a.P,n=a):i>-tf?(e=a,n=a.N):e=n=a;break}if(!a.R){e=a;break}a=a.R}da(t);var u=Na(t);if(Wp.insert(e,u),e||n){if(e===n)return ba(e),n=Na(e.site),Wp.insert(u,n),u.edge=n.edge=ca(e.site,u.site),wa(e),void wa(n);if(!n)return void(u.edge=ca(e.site,u.site));ba(e),ba(n);var c=e.site,h=c[0],l=c[1],p=t[0]-h,f=t[1]-l,g=n.site,d=g[0]-h,y=g[1]-l,_=2*(p*y-f*d),v=p*p+f*f,m=d*d+y*y,x=[(y*v-f*m)/_+h,(p*m-d*v)/_+l];la(n.edge,c,g,x),u.edge=ca(c,t,null,x),n.edge=ca(t,g,null,x),wa(e),wa(n)}}function La(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var s=t.P;if(!s)return-1/0;n=s.site;var a=n[0],u=n[1],c=u-e;if(!c)return a;var h=a-r,l=1/o-1/c,p=h/c;return l?(-p+Math.sqrt(p*p-2*l*(h*h/(-2*c)-u+c/2+i-o/2)))/l+r:(r+a)/2}function Pa(t,e){var n=t.N;if(n)return La(n,e);var r=t.site;return r[1]===e?r[0]:1/0}function Oa(t,e,n){return(t[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-t[1])}function Ra(t,e){return e[1]-t[1]||e[0]-t[0]}function Ta(t,e){var n,r,i,o=t.sort(Ra).pop();for(Kp=[],Jp=new Array(t.length),Wp=new ia,Zp=new ia;;)if(i=Hp,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(Ma(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;Sa(i.arc)}if(ma(),e){var s=+e[0][0],a=+e[0][1],u=+e[1][0],c=+e[1][1];ga(s,a,u,c),xa(s,a,u,c)}this.edges=Kp,this.cells=Jp,Wp=Zp=Kp=Jp=null}function Aa(t){return t=t.slice(),t.push(t[0]),o([t])}function Da(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(n))throw new Error("bbox is invalid");return et(t,"Point","points"),c(nf().x(function(t){return t.geometry.coordinates[0]}).y(function(t){return t.geometry.coordinates[1]}).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(t.features).map(Aa))}function Fa(t,e,n,r){r=r||{};var i=r.steps||64,s=r.units||"kilometers",a=r.angle||0,u=r.pivot||t,c=r.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!I(r))throw new Error("options must be an object");if(!b(i))throw new Error("steps must be a number");if(!b(a))throw new Error("angle must be a number");var h=Z(t);if("degrees"===s)var l=x(a);else e=po(t,e,90,{units:s}),n=po(t,n,0,{units:s}),e=Z(e)[0]-h[0],n=Z(n)[1]-h[1];for(var p=[],f=0;f<i;f+=1){var g=-360*f/i,d=e*n/Math.sqrt(Math.pow(n,2)+Math.pow(e,2)*Math.pow(qa(g),2)),y=e*n/Math.sqrt(Math.pow(e,2)+Math.pow(n,2)/Math.pow(qa(g),2));if(g<-90&&g>=-270&&(d=-d),g<-180&&g>=-360&&(y=-y),"degrees"===s){var _=d*Math.cos(l)+y*Math.sin(l),v=y*Math.cos(l)-d*Math.sin(l);d=_,y=v}p.push([d+h[0],y+h[1]])}return p.push(p[0]),"degrees"===s?o([p],c):Uo(o([p],c),a,{pivot:u})}function qa(t){var e=t*Math.PI/180;return Math.tan(e)}function Ga(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,i=e.weight;if(!t)throw new Error("geojson is required");var o=0,s=0,a=0;return z(t,function(t,e,n){var r=n[i];if(r=void 0===r||null===r?1:r,!b(r))throw new Error("weight value must be a number for feature index "+e);(r=Number(r))>0&&A(t,function(t){o+=t[0]*r,s+=t[1]*r,a+=r})}),r([o/a,s/a],n)}function Ba(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.counter||10;if(!b(n))throw new Error("counter must be a number");var r=e.weight,i=Ga(t,{weight:e.weight}),o=c([]);return G(t,function(t){o.features.push(xn(t,{weight:t.properties[r]}))}),o.properties={tolerance:e.tolerance,medianCandidates:[]},ka(i.geometry.coordinates,[0,0],o,n)}function ka(t,e,n,i){var o=n.properties.tolerance||.001,s=0,a=0,u=0,c=0;if(G(n,function(e){var n=e.properties.weight,r=void 0===n||null===n?1:n;if(r=Number(r),!b(r))throw new Error("weight value must be a number");if(r>0){c+=1;var i=r*_e(e,t);0===i&&(i=1);var o=r/i;s+=e.geometry.coordinates[0]*o,a+=e.geometry.coordinates[1]*o,u+=o}}),c<1)throw new Error("no features to measure");var h=s/u,l=a/u;return 1===c||0===i||Math.abs(h-e[0])<o&&Math.abs(l-e[1])<o?r([h,l],{medianCandidates:n.properties.medianCandidates}):(n.properties.medianCandidates.push([h,l]),ka([h,l],t,n,i-1))}function za(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.steps||64,r=e.weight,i=e.properties||{};if(!b(n))throw new Error("steps must be a number");if(!I(i))throw new Error("properties must be a number");var o=k(t).length,s=Ga(t,{weight:r}),a=0,u=0,h=0;G(t,function(t){var e=t.properties[r]||1,n=ja(K(t),K(s));a+=Math.pow(n.x,2)*e,u+=Math.pow(n.y,2)*e,h+=n.x*n.y*e});var l=a-u,p=Math.sqrt(Math.pow(l,2)+4*Math.pow(h,2)),f=2*h,g=Math.atan((l+p)/f),d=180*g/Math.PI,y=0,_=0,v=0;G(t,function(t){var e=t.properties[r]||1,n=ja(K(t),K(s));y+=Math.pow(n.x*Math.cos(g)-n.y*Math.sin(g),2)*e,_+=Math.pow(n.x*Math.sin(g)+n.y*Math.cos(g),2)*e,v+=e});var m=Math.sqrt(2*y/v),x=Math.sqrt(2*_/v),E=Fa(s,m,x,{units:"degrees",angle:d,steps:n,properties:i}),w=le(t,c([E])),N={meanCenterCoordinates:K(s),semiMajorAxis:m,semiMinorAxis:x,numberOfFeatures:o,angle:d,percentageWithinEllipse:100*k(w).length/o};return E.properties.standardDeviationalEllipse=N,E}function ja(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function Xa(t){if(I(t)&&(t=t.bbox),t&&!Array.isArray(t))throw new Error("bbox is invalid");return t?Ka(t):[Ja(),Za()]}function Ua(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox;void 0!==t&&null!==t||(t=1);for(var i=[],o=0;o<t;o++)i.push(r(Xa(n)));return c(i)}function Ya(t,e){function n(t,e,n){n[e]=e>0?t+n[e-1]:t}function r(t){t=2*t*Math.PI/p[p.length-1];var e=Math.random();l.push([e*a*Math.sin(t),e*a*Math.cos(t)])}if(e=e||{},!I(e))throw new Error("options is invalid");var i=e.bbox,s=e.num_vertices,a=e.max_radial_length;void 0!==t&&null!==t||(t=1),b(s)||(s=10),b(a)||(a=10);for(var u=[],h=0;h<t;h++){var l=[],p=Array.apply(null,new Array(s+1)).map(Math.random);p.forEach(n),p.forEach(r),l[l.length-1]=l[0],l=l.map(Ha(Xa(i))),u.push(o([l]))}return c(u)}function Va(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox,r=e.num_vertices,i=e.max_length,o=e.max_rotation;void 0!==t&&null!==t||(t=1),(!b(r)||r<2)&&(r=10),b(i)||(i=1e-4),b(o)||(o=Math.PI/8);for(var s=[],u=0;u<t;u++){for(var h=Xa(n),l=[h],p=0;p<r-1;p++){
var f=0===p?2*Math.random()*Math.PI:Math.tan((l[p][1]-l[p-1][1])/(l[p][0]-l[p-1][0])),g=f+(Math.random()-.5)*o*2,d=Math.random()*i;l.push([l[p][0]+d*Math.cos(g),l[p][1]+d*Math.sin(g)])}s.push(a(l))}return c(s)}function Ha(t){return function(e){return[e[0]+t[0],e[1]+t[1]]}}function Wa(){return Math.random()-.5}function Ja(){return 360*Wa()}function Za(){return 180*Wa()}function Ka(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}function Qa(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(void 0===e||null===e)throw new Error("filter is required");var n=[];return G(t,function(t){nu(t.properties,e)&&n.push(t)}),c(n)}function $a(t,e,n){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(void 0===e||null===e)throw new Error("property is required");for(var r=eu(t,e),i=Object.keys(r),o=0;o<i.length;o++){for(var s=i[o],a=r[s],u=[],h=0;h<a.length;h++)u.push(t.features[a[h]]);n(c(u),s,o)}}function tu(t,e,n,r){var i=r;return $a(t,e,function(t,e,o){i=0===o&&void 0===r?t:n(i,t,e,o)}),i}function eu(t,e){var n={};return G(t,function(t,r){var i=t.properties||{};if(i.hasOwnProperty(e)){var o=i[e];n.hasOwnProperty(o)?n[o].push(r):n[o]=[r]}}),n}function nu(t,e){if(void 0===t)return!1;var n=typeof e;if("number"===n||"string"===n)return t.hasOwnProperty(e);if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(!nu(t,e[r]))return!1;return!0}return ru(t,e)}function ru(t,e){for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];if(t[i]!==e[i])return!1}return!0}function iu(t,e){if(!e)return{};if(!e.length)return{};for(var n={},r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(n[i]=t[i])}return n}function ou(){}function su(t){this.message=t||""}function au(t){this.message=t||""}function uu(){}function cu(t){return null===t?Ig:t.color}function hu(t){return null===t?null:t.parent}function lu(t,e){null!==t&&(t.color=e)}function pu(t){return null===t?null:t.left}function fu(t){return null===t?null:t.right}function gu(){this.root_=null,this.size_=0}function du(){}function yu(){this.array_=[],arguments[0]instanceof cg&&this.addAll(arguments[0])}function _u(){}function vu(){}function mu(){}function xu(){}function Eu(){}function wu(t){this.message=t||""}function bu(){this.array_=[]}function Iu(t,n){var r=nt(t),i=nt(n),o=t.properties||{};if(r=Nu(r),i=Nu(i),!r)return null;if(!i)return e(r,o);var s=new gd,a=s.read(r),u=s.read(i),c=yv.difference(a,u);return c.isEmpty()?null:e((new dd).write(c),o)}function Nu(t){switch(t.type){case"Polygon":return ei(t)>1?t:null;case"MultiPolygon":var e=[];if(X(t,function(t){ei(t)>1&&e.push(t.geometry.coordinates)}),e.length)return{type:"MultiPolygon",coordinates:e}}}function Cu(){this.reset()}function Su(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}function Mu(t){return t>1?0:t<-1?Lv:Math.acos(t)}function Lu(t){return t>1?Pv:t<-1?-Pv:Math.asin(t)}function Pu(){}function Ou(t,e){t&&Yv.hasOwnProperty(t.type)&&Yv[t.type](t,e)}function Ru(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Tu(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Ru(t[n],e,1);e.polygonEnd()}function Au(t){return[qv(t[1],t[0]),Lu(t[2])]}function Du(t){var e=t[0],n=t[1],r=Gv(n);return[r*Gv(e),r*zv(e),zv(n)]}function Fu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qu(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Gu(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Bu(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function ku(t){var e=jv(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function zu(t,e){return[t>Lv?t-Rv:t<-Lv?t+Rv:t,e]}function ju(t,e,n){return(t%=Rv)?e||n?Hv(Uu(t),Yu(e,n)):Uu(t):e||n?Yu(e,n):zu}function Xu(t){return function(e,n){return e+=t,[e>Lv?e-Rv:e<-Lv?e+Rv:e,n]}}function Uu(t){var e=Xu(t);return e.invert=Xu(-t),e}function Yu(t,e){function n(t,e){var n=Gv(e),a=Gv(t)*n,u=zv(t)*n,c=zv(e),h=c*r+a*i;return[qv(u*o-h*s,a*r-c*i),Lu(h*o+u*s)]}var r=Gv(t),i=zv(t),o=Gv(e),s=zv(e);return n.invert=function(t,e){var n=Gv(e),a=Gv(t)*n,u=zv(t)*n,c=zv(e),h=c*o-u*s;return[qv(u*o+c*s,a*r+h*i),Lu(h*r-a*i)]},n}function Vu(t,e,n,r,i,o){if(n){var s=Gv(e),a=zv(e),u=r*n;null==i?(i=e+r*Rv,o=e-u/2):(i=Hu(s,i),o=Hu(s,o),(r>0?i<o:i>o)&&(i+=r*Rv));for(var c,h=i;r>0?h>o:h<o;h-=u)c=Au([s,-a*Gv(h),-a*zv(h)]),t.point(c[0],c[1])}}function Hu(t,e){e=Du(e),e[0]-=t,ku(e);var n=Mu(-e[1]);return((-e[2]<0?-n:n)+Rv-Mv)%Rv}function Wu(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Ju(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Zu(t){return function(e,n){return $v(t(e),n)}}function Ku(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,a,c){var h=0,l=0;if(null==i||(h=s(i,a))!==(l=s(o,a))||u(i,o)<0^a>0)do{c.point(0===h||3===h?t:n,h>1?r:e)}while((h=(h+a+4)%4)!==l);else c.point(o[0],o[1])}function s(r,i){return Dv(r[0]-t)<Mv?i>0?0:3:Dv(r[0]-n)<Mv?i>0?2:1:Dv(r[1]-e)<Mv?i>0?1:0:i>0?3:2}function a(t,e){return u(t.x,e.x)}function u(t,e){var n=s(t,1),r=s(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function u(t,e){i(t,e)&&C.point(t,e)}function c(){for(var e=0,n=0,i=y.length;n<i;++n)for(var o,s,a=y[n],u=1,c=a.length,h=a[0],l=h[0],p=h[1];u<c;++u)o=l,s=p,h=a[u],l=h[0],p=h[1],s<=r?p>r&&(l-o)*(r-s)>(p-s)*(t-o)&&++e:p<=r&&(l-o)*(r-s)<(p-s)*(t-o)&&--e;return e}function h(){C=S,d=[],y=[],N=!0}function l(){var t=c(),e=N&&t,n=(d=tm(d)).length;(e||n)&&(s.polygonStart(),e&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),n&&Qv(d,a,t,o,s),s.polygonEnd()),C=s,d=y=_=null}function p(){M.point=g,y&&y.push(_=[]),I=!0,b=!1,E=w=NaN}function f(){d&&(g(v,m),x&&b&&S.rejoin(),d.push(S.result())),M.point=u,b&&C.lineEnd()}function g(o,s){var a=i(o,s);if(y&&_.push([o,s]),I)v=o,m=s,x=a,I=!1,a&&(C.lineStart(),C.point(o,s));else if(a&&b)C.point(o,s);else{var u=[E=Math.max(nm,Math.min(em,E)),w=Math.max(nm,Math.min(em,w))],c=[o=Math.max(nm,Math.min(em,o)),s=Math.max(nm,Math.min(em,s))];Zv(u,c,t,e,n,r)?(b||(C.lineStart(),C.point(u[0],u[1])),C.point(c[0],c[1]),a||C.lineEnd(),N=!1):a&&(C.lineStart(),C.point(o,s),N=!1)}E=o,w=s,b=a}var d,y,_,v,m,x,E,w,b,I,N,C=s,S=Jv(),M={point:u,lineStart:p,lineEnd:f,polygonStart:h,polygonEnd:l};return M}}function Qu(t,e){t<sm&&(sm=t),t>um&&(um=t),e<am&&(am=e),e>cm&&(cm=e)}function $u(t){return t.length>1}function tc(t,e){return((t=t.x)[0]<0?t[1]-Pv-Mv:Pv-t[1])-((e=e.x)[0]<0?e[1]-Pv-Mv:Pv-e[1])}function ec(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Lv:-Lv,u=Dv(o-n);Dv(u-Lv)<Mv?(t.point(n,r=(r+s)/2>0?Pv:-Pv),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),e=0):i!==a&&u>=Lv&&(Dv(n-i)<Mv&&(n-=i*Mv),Dv(o-a)<Mv&&(o-=a*Mv),r=nc(n,r,o,s),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),e=0),t.point(n=o,r=s),i=a},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}function nc(t,e,n,r){var i,o,s=zv(t-n);return Dv(s)>Mv?Fv((zv(e)*(o=Gv(r))*zv(n)-zv(r)*(i=Gv(e))*zv(t))/(i*o*s)):(e+r)/2}function rc(t,e,n,r){var i;if(null==t)i=n*Pv,r.point(-Lv,i),r.point(0,i),r.point(Lv,i),r.point(Lv,0),r.point(Lv,-i),r.point(0,-i),r.point(-Lv,-i),r.point(-Lv,0),r.point(-Lv,i);else if(Dv(t[0]-e[0])>Mv){var o=t[0]<e[0]?Lv:-Lv;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}function ic(t){return function(e){var n=new oc;for(var r in t)n[r]=t[r];return n.stream=e,n}}function oc(){}function sc(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),Vv(n,t.stream(hm));var s=hm.result(),a=Math.min(r/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),u=+e[0][0]+(r-a*(s[1][0]+s[0][0]))/2,c=+e[0][1]+(i-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([u,c])}function ac(t,e,n){return sc(t,[[0,0],e],n)}function uc(t){return ic({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function cc(t,e){function n(r,i,o,s,a,u,c,h,l,p,f,g,d,y){var _=c-r,v=h-i,m=_*_+v*v;if(m>4*e&&d--){var x=s+p,E=a+f,w=u+g,b=jv(x*x+E*E+w*w),I=Lu(w/=b),N=Dv(Dv(w)-1)<Mv||Dv(o-l)<Mv?(o+l)/2:qv(E,x),C=t(N,I),S=C[0],M=C[1],L=S-r,P=M-i,O=v*L-_*P;(O*O/m>e||Dv((_*L+v*P)/m-.5)>.3||s*p+a*f+u*g<dm)&&(n(r,i,o,s,a,u,S,M,N,x/=b,E/=b,w,d,y),y.point(S,M),n(S,M,N,x,E,w,c,h,l,p,f,g,d,y))}}return function(e){function r(n,r){n=t(n,r),e.point(n[0],n[1])}function i(){_=NaN,w.point=o,e.lineStart()}function o(r,i){var o=Du([r,i]),s=t(r,i);n(_,v,y,m,x,E,_=s[0],v=s[1],y=r,m=o[0],x=o[1],E=o[2],gm,e),e.point(_,v)}function s(){w.point=r,e.lineEnd()}function a(){i(),w.point=u,w.lineEnd=c}function u(t,e){o(h=t,e),l=_,p=v,f=m,g=x,d=E,w.point=o}function c(){n(_,v,y,m,x,E,l,p,h,f,g,d,gm,e),w.lineEnd=s,s()}var h,l,p,f,g,d,y,_,v,m,x,E,w={point:r,lineStart:i,lineEnd:s,polygonStart:function(){e.polygonStart(),w.lineStart=a},polygonEnd:function(){e.polygonEnd(),w.lineStart=i}};return w}}function hc(t){return lc(function(){return t})()}function lc(t){function e(t){return t=h(t[0]*Av,t[1]*Av),[t[0]*y+a,u-t[1]*y]}function n(t){return(t=h.invert((t[0]-a)/y,(u-t[1])/y))&&[t[0]*Tv,t[1]*Tv]}function r(t,e){return t=s(t,e),[t[0]*y+a,u-t[1]*y]}function i(){h=Hv(c=ju(E,w,b),s);var t=s(m,x);return a=_-t[0]*y,u=v+t[1]*y,o()}function o(){return g=d=null,e}var s,a,u,c,h,l,p,f,g,d,y=150,_=480,v=250,m=0,x=0,E=0,w=0,b=0,I=null,N=pm,C=null,S=om,M=.5,L=ym(r,M);return e.stream=function(t){return g&&d===t?g:g=_m(N(c,L(S(d=t))))},e.clipAngle=function(t){return arguments.length?(N=+t?fm(I=t*Av,6*Av):(I=null,pm),o()):I*Tv},e.clipExtent=function(t){return arguments.length?(S=null==t?(C=l=p=f=null,om):Ku(C=+t[0][0],l=+t[0][1],p=+t[1][0],f=+t[1][1]),o()):null==C?null:[[C,l],[p,f]]},e.scale=function(t){return arguments.length?(y=+t,i()):y},e.translate=function(t){return arguments.length?(_=+t[0],v=+t[1],i()):[_,v]},e.center=function(t){return arguments.length?(m=t[0]%360*Av,x=t[1]%360*Av,i()):[m*Tv,x*Tv]},e.rotate=function(t){return arguments.length?(E=t[0]%360*Av,w=t[1]%360*Av,b=t.length>2?t[2]%360*Av:0,i()):[E*Tv,w*Tv,b*Tv]},e.precision=function(t){return arguments.length?(L=ym(r,M=t*t),o()):jv(M)},e.fitExtent=function(t,n){return sc(e,t,n)},e.fitSize=function(t,n){return ac(e,t,n)},function(){return s=t.apply(this,arguments),e.invert=s.invert&&n,i()}}function pc(t,e){return[t,kv(Xv((Pv+e)/2))]}function fc(t){function e(){var e=Lv*a(),s=o(Wv(o.rotate()).invert([0,0]));return c(null==h?[[s[0]-e,s[1]-e],[s[0]+e,s[1]+e]]:t===pc?[[Math.max(s[0]-e,h),n],[Math.min(s[0]+e,r),i]]:[[h,Math.max(s[1]-e,n)],[r,Math.min(s[1]+e,i)]])}var n,r,i,o=hc(t),s=o.center,a=o.scale,u=o.translate,c=o.clipExtent,h=null;return o.scale=function(t){return arguments.length?(a(t),e()):a()},o.translate=function(t){return arguments.length?(u(t),e()):u()},o.center=function(t){return arguments.length?(s(t),e()):s()},o.clipExtent=function(t){return arguments.length?(null==t?h=n=r=i=null:(h=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),e()):null==h?null:[[h,n],[r,i]]},e()}function gc(t,e){return[kv(Xv((Pv+e)/2)),-t]}function dc(t,e,n){n=n||{};var r=n.units,i=n.steps||64;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");i=i||64,r=r||"kilometers";var o=[];switch(t.type){case"GeometryCollection":return z(t,function(t){var n=yc(t,e,r,i);n&&o.push(n)}),c(o);case"FeatureCollection":return G(t,function(t){var n=yc(t,e,r,i);n&&G(n,function(t){t&&o.push(t)})}),c(o)}return yc(t,e,r,i)}function yc(t,n,r,i){var o=t.properties||{},s="Feature"===t.type?t.geometry:t;if("GeometryCollection"===s.type){var a=[];return z(t,function(t){var e=yc(t,n,r,i);e&&a.push(e)}),c(a)}var u,h=J(t),l=h[1]>50&&h[3]>50;u=l?{type:s.type,coordinates:vc(s.coordinates,xc(s))}:Fr(s);var p=new gd,f=p.read(u),g=d(y(n,r),"meters"),_=o_.bufferOp(f,g);if(_=(new dd).write(_),!_c(_.coordinates)){var v;return v=l?{type:_.type,coordinates:mc(_.coordinates,xc(s))}:qr(_),v.geometry?v:e(v,o)}}function _c(t){return Array.isArray(t[0])?_c(t[0]):isNaN(t[0])}function vc(t,e){return"object"!=typeof t[0]?e(t):t.map(function(t){return vc(t,e)})}function mc(t,e){return"object"!=typeof t[0]?e.invert(t):t.map(function(t){return mc(t,e)})}function xc(t){var e=mn(t).geometry.coordinates.reverse(),n=e.map(function(t){return-t});return vm().center(e).rotate(n).scale(kc)}function Ec(){for(var t=new gd,e=t.read(JSON.stringify(arguments[0].geometry)),n=1;n<arguments.length;n++)e=Nv.union(e,t.read(JSON.stringify(arguments[n].geometry)));return e=(new dd).write(e),{type:"Feature",geometry:e,properties:arguments[0].properties}}function wc(t,n){var r=nt(t),i=nt(n);if(Ye(Ii(i,{precision:4})).coordinates[0].length<4)return null;if(Ye(Ii(r,{precision:4})).coordinates[0].length<4)return null;var o=new gd,s=o.read(Ii(r)),a=o.read(Ii(i)),u=yv.intersection(s,a);return u.isEmpty()?null:e((new dd).write(u))}function bc(t,e,n){var r,i;if(!Array.isArray(e))throw new Error("Get closest expects an array as second argument");return e.forEach(function(e,o){var s=n(e,t);s>=0&&(void 0===i||s<i)&&(i=s,r=o)}),r}function Ic(t,e){return bc(t,e,function(t,e){return t-e})}function Nc(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.propertyName;et(t,"Polygon","dissolve");var r=ve(t),i=r.features,o=[];i.forEach(function(t,e){t.properties.origIndexPosition=e});var s=wr();s.load(r);for(var a in i){var u=i[a],c=!1;if(s.search(u).features.forEach(function(t){u=i[a];var e=t.properties.origIndexPosition;if(o.length>0&&0!==e)if(e>o[o.length-1])e-=o.length;else{var r=Ic(e,o);0!==r&&(e-=r)}if(e!==+a){var h=i[e];h&&u&&(void 0!==n&&h.properties[n]!==u.properties[n]||ks(u,h)&&Cc(u,h)&&(i[a]=Ec(u,h),o.push(t.properties.origIndexPosition),o.sort(function(t,e){return t-e}),s.remove(t),i.splice(e,1),u.properties.origIndexPosition=a,s.remove(u,function(t,e){return t.properties.origIndexPosition===e.properties.origIndexPosition}),c=!0))}}),c){if(!u)continue;u.properties.origIndexPosition=a,s.insert(u),a--}}return i.forEach(function(t){delete t.properties.origIndexPosition,delete t.bbox}),r}function Cc(t,e){return Lr(a(k(t)),a(k(e))).features.length>0}function Sc(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties||{},i=n.triangles,o=n.mask;if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(it(o)))throw new Error("options.mask must be a (Multi)Polygon");var s=t[0],a=t[1],u=t[2],h=t[3],l=(a+h)/2,p=(s+u)/2,f=2*e/_e([s,l],[u,l],n),g=f*(u-s),d=2*e/_e([p,a],[p,h],n),y=d*(h-a),_=g/2,v=2*_,m=Math.sqrt(3)/2*y,x=u-s,E=h-a,w=.75*v,N=m,C=(x-v)/(v-_/2),S=Math.floor(C),M=(S*w-_/2-x)/2-_/2+w/2,L=Math.floor((E-m)/m),P=(E-L*m)/2,O=L*m-E>m/2;O&&(P-=m/4);for(var R=[],T=[],A=0;A<6;A++){var D=2*Math.PI/6*A;R.push(Math.cos(D)),T.push(Math.sin(D))}for(var F=[],q=0;q<=S;q++)for(var G=0;G<=L;G++){var B=q%2==1;if((0!==G||!B)&&(0!==G||!O)){var k=q*w+s-M,z=G*N+a+P;if(B&&(z-=m/2),!0===i)Lc([k,z],g/2,y/2,r,R,T).forEach(function(t){o?wc(o,t)&&F.push(t):F.push(t)});else{var j=Mc([k,z],g/2,y/2,r,R,T);o?wc(o,j)&&F.push(j):F.push(j)}}}return c(F)}function Mc(t,e,n,r,i,s){for(var a=[],u=0;u<6;u++){var c=t[0]+e*i[u],h=t[1]+n*s[u];a.push([c,h])}return a.push(a[0].slice()),o([a],r)}function Lc(t,e,n,r,i,s){for(var a=[],u=0;u<6;u++){var c=[];c.push(t),c.push([t[0]+e*i[u],t[1]+n*s[u]]),c.push([t[0]+e*i[(u+1)%6],t[1]+n*s[(u+1)%6]]),c.push(t),a.push(o([c],r))}return a}function Pc(t,e){var n=Tc(e),r=Rc(t),i=r[0],o=r[1];return i=Ac(i),o=Ac(o),Oc(n,i,o)}function Oc(t,e,n){var r=[];return r.push(t.geometry.coordinates[0]),X(e,function(t){r.push(t.geometry.coordinates[0])}),X(n,function(t){r.push(t.geometry.coordinates[0])}),o(r)}function Rc(t){var e=[],n=[];return X(t,function(t){var r=t.geometry.coordinates,i=r[0],s=r.slice(1);e.push(o([i])),s.forEach(function(t){n.push(o([t]))})}),[c(e),c(n)]}function Tc(t){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]];return o(t&&t.geometry.coordinates||e)}function Ac(t){if(t.features.length<=1)return t;var e=Fc(t),n=[],r={};return X(t,function(t,i){if(r[i])return!0;for(e.remove({index:i},Dc),r[i]=!0;;){var o=J(t),s=e.search({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]});if(s.length>0){var a=s.map(function(t){return r[t.index]=!0,e.remove({index:t.index},Dc),t.geojson});a.push(t),t=Ec.apply(this,a)}if(0===s.length)break}n.push(t)}),c(n)}function Dc(t,e){return t.index===e.index}function Fc(t){var e=Zc(),n=[];return X(t,function(t,e){var r=J(t);n.push({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],geojson:t,index:e})}),e.load(n),e}function qc(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties,i=n.mask,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(it(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],u=t[1],h=t[2],l=t[3],p=e/_e([a,u],[h,u],n),f=p*(h-a),g=e/_e([a,u],[a,l],n),d=g*(l-u),y=h-a,_=l-u,v=Math.floor(y/f),m=Math.floor(_/d),x=(y-v*f)/2,E=(_-m*d)/2,w=a+x,N=0;N<v;N++){for(var C=u+E,S=0;S<m;S++){var M=o([[[w,C],[w,C+d],[w+f,C+d],[w+f,C],[w,C]]],r);i?wc(i,M)&&s.push(M):s.push(M),C+=d}w+=f}return c(s)}function Gc(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties,i=n.mask,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(it(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e/_e([t[0],t[1]],[t[2],t[1]],n),u=a*(t[2]-t[0]),h=e/_e([t[0],t[1]],[t[0],t[3]],n),l=h*(t[3]-t[1]),p=0,f=t[0];f<=t[2];){for(var g=0,d=t[1];d<=t[3];){var y=null,_=null;p%2==0&&g%2==0?(y=o([[[f,d],[f,d+l],[f+u,d],[f,d]]],r),_=o([[[f,d+l],[f+u,d+l],[f+u,d],[f,d+l]]],r)):p%2==0&&g%2==1?(y=o([[[f,d],[f+u,d+l],[f+u,d],[f,d]]],r),_=o([[[f,d],[f,d+l],[f+u,d+l],[f,d]]],r)):g%2==0&&p%2==1?(y=o([[[f,d],[f,d+l],[f+u,d+l],[f,d]]],r),_=o([[[f,d],[f+u,d+l],[f+u,d],[f,d]]],r)):g%2==1&&p%2==1&&(y=o([[[f,d],[f,d+l],[f+u,d],[f,d]]],r),_=o([[[f,d+l],[f+u,d+l],[f+u,d],[f,d+l]]],r)),i?(wc(i,y)&&s.push(y),wc(i,_)&&s.push(_)):(s.push(y),s.push(_)),d+=l,g++}p++,f+=u}return c(s)}function Bc(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.gridType,i=n.property,o=n.weight;if(!t)throw new Error("points is required");if(et(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==o&&"number"!=typeof o)throw new Error("weight must be a number");i=i||"elevation",r=r||"square",o=o||1;var s,a=J(t);switch(r){case"point":case"points":s=bi(a,e,n);break;case"square":case"squares":s=qc(a,e,n);break;case"hex":case"hexes":s=Sc(a,e,n);break;case"triangle":case"triangles":s=Gc(a,e,n);break;default:throw new Error("invalid gridType")}var u=[];return G(s,function(e){var s=0,a=0;G(t,function(t){var u,c="point"===r?e:xn(e),h=_e(c,t,n);if(void 0!==i&&(u=t.properties[i]),void 0===u&&(u=t.geometry.coordinates[2]),void 0===u)throw new Error("zValue is missing");0===h&&(s=u);var l=1/Math.pow(h,o);a+=l,s+=l*u});var c=ve(e);c.properties[i]=s/a,u.push(c)}),c(u)}var kc=6371008.8,zc={meters:kc,metres:kc,millimeters:1e3*kc,millimetres:1e3*kc,centimeters:100*kc,centimetres:100*kc,kilometers:kc/1e3,kilometres:kc/1e3,miles:kc/1609.344,nauticalmiles:kc/1852,inches:39.37*kc,yards:kc/1.0936,feet:3.28084*kc,radians:1,degrees:kc/111325},jc={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/kc,degrees:1/111325},Xc={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:3.86e-7,yards:1.195990046,feet:10.763910417,inches:1550.003100006},Uc=Object.freeze({earthRadius:kc,factors:zc,unitsFactors:jc,areaFactors:Xc,feature:e,geometry:n,point:r,points:i,polygon:o,polygons:s,lineString:a,lineStrings:u,featureCollection:c,multiLineString:h,multiPoint:l,multiPolygon:p,geometryCollection:f,round:g,radiansToLength:d,lengthToRadians:y,lengthToDegrees:_,bearingToAzimuth:v,radiansToDegrees:m,degreesToRadians:x,convertLength:E,convertArea:w,isNumber:b,isObject:I,validateBBox:N,validateId:C,radians2degrees:S,degrees2radians:M,distanceToDegrees:L,distanceToRadians:P,radiansToDistance:O,bearingToAngle:R,convertDistance:T}),Yc=Object.freeze({coordEach:A,coordReduce:D,propEach:F,propReduce:q,featureEach:G,featureReduce:B,coordAll:k,geomEach:z,geomReduce:j,flattenEach:X,flattenReduce:U,segmentEach:Y,segmentReduce:V,lineEach:H,lineReduce:W}),Vc=Object.freeze({getCoord:Z,getCoords:K,containsNumber:Q,geojsonType:$,featureOf:tt,collectionOf:et,getGeom:nt,getGeomType:rt,getType:it}),Hc={successCallback:null,verbose:!1},Wc={},Jc=mt,Zc=wt;wt.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!At(t,e))return n;for(var i,o,s,a,u=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],a=e.leaf?r(s):s,At(t,a)&&(e.leaf?n.push(s):Tt(t,a)?this._all(s,n):u.push(s));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!At(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],s=e.leaf?n(o):o,At(t,s)){if(e.leaf||Tt(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Dt([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),u=[],c=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),s.leaf&&-1!==(i=bt(t,s.children,e)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!Tt(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:St,compareMinY:Mt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return i=Dt(t.slice(e,n+1)),It(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),i=Dt([]),i.leaf=!1,i.height=r;var a,u,c,h,l=Math.ceil(o/s),p=l*Math.ceil(Math.sqrt(s));for(Ft(t,e,n,p,this.compareMinX),a=e;a<=n;a+=p)for(c=Math.min(a+p-1,n),Ft(t,a,c,l,this.compareMinY),u=a;u<=c;u+=l)h=Math.min(u+l-1,c),i.children.push(this._build(t,u,h,r-1));return It(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,u,c,h,l;;){if(r.push(e),e.leaf||r.length-1===n)break;for(h=l=1/0,i=0,o=e.children.length;i<o;i++)s=e.children[i],u=Lt(s),c=Ot(t,s)-u,c<l?(l=c,h=u<h?u:h,a=s):c===l&&u<h&&(h=u,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),Ct(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=Dt(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,It(n,this.toBBox),It(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=Dt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,It(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,u,c,h;for(u=c=1/0,r=e;r<=n-e;r++)i=Nt(t,0,r,this.toBBox),o=Nt(t,r,n,this.toBBox),s=Rt(i,o),a=Lt(i)+Lt(o),s<u?(u=s,h=r,c=a<c?a:c):s===u&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:St,i=t.leaf?this.compareMinY:Mt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=Nt(t,0,e,s),u=Nt(t,n-e,n,s),c=Pt(a)+Pt(u);for(i=e;i<n-e;i++)o=t.children[i],Ct(a,t.leaf?s(o):o),c+=Pt(a);for(i=n-e-1;i>=e;i--)o=t.children[i],Ct(u,t.leaf?s(o):o),c+=Pt(u);return c},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)Ct(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():It(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var Kc=Gt,Qc=+(Math.pow(2,27)+1),$c=kt,th=zt,eh=jt,nh=Ut,rh=qt(function(t){function e(t,e){for(var n=new Array(t.length-1),r=1;r<t.length;++r)for(var i=n[r-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(i[s++]=t[r][o]);return n}function n(t){for(var e=new Array(t),n=0;n<t;++n){e[n]=new Array(t);for(var r=0;r<t;++r)e[n][r]=["m",r,"[",t-n-1,"]"].join("")}return e}function r(t){return 1&t?"-":""}function i(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",i(t.slice(0,e)),",",i(t.slice(e)),")"].join("")}function o(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var n=[],s=0;s<t.length;++s)n.push(["scale(",i(o(e(t,s))),",",r(s),t[0][s],")"].join(""));return n}function s(t){for(var r=[],s=[],a=n(t),u=[],c=0;c<t;++c)0==(1&c)?r.push.apply(r,o(e(a,c))):s.push.apply(s,o(e(a,c))),u.push("m"+c);var h=i(r),l=i(s),p="orientation"+t+"Exact",f=["function ",p,"(",u.join(),"){var p=",h,",n=",l,",d=sub(p,n);return d[d.length-1];};return ",p].join("");return new Function("sum","prod","scale","sub",f)($c,Kc,eh,nh)}function a(t){var e=l[t.length];return e||(e=l[t.length]=s(t.length)),e.apply(void 0,t)}var u=5,c=s(3),h=s(4),l=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){var r,i=(t[1]-n[1])*(e[0]-n[0]),o=(t[0]-n[0])*(e[1]-n[1]),s=i-o;if(i>0){if(o<=0)return s;r=i+o}else{if(!(i<0))return s;if(o>=0)return s;r=-(i+o)}var a=3.3306690738754716e-16*r;return s>=a||s<=-a?s:c(t,e,n)},function(t,e,n,r){var i=t[0]-r[0],o=e[0]-r[0],s=n[0]-r[0],a=t[1]-r[1],u=e[1]-r[1],c=n[1]-r[1],l=t[2]-r[2],p=e[2]-r[2],f=n[2]-r[2],g=o*c,d=s*u,y=s*a,_=i*c,v=i*u,m=o*a,x=l*(g-d)+p*(y-_)+f*(v-m),E=(Math.abs(g)+Math.abs(d))*Math.abs(l)+(Math.abs(y)+Math.abs(_))*Math.abs(p)+(Math.abs(v)+Math.abs(m))*Math.abs(f),w=7.771561172376103e-16*E;return x>w||-x>w?x:h(t,e,n,r)}];!function(){for(;l.length<=u;)l.push(s(l.length));for(var e=[],n=["slow"],r=0;r<=u;++r)e.push("a"+r),n.push("o"+r);for(var i=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],r=2;r<=u;++r)i.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(i.join(""));var o=Function.apply(void 0,n);t.exports=o.apply(void 0,[a].concat(l));for(var r=0;r<=u;++r)t.exports[r]=l[r]}()}),ih=Yt,oh=rh[3],sh=Vt,ah=Vt;Vt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}},sh.default=ah;var uh=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o][0],u=e[o][1],c=e[s][0],h=e[s][1];u>r!=h>r&&n<(c-a)*(r-u)/(h-u)+a&&(i=!i)}return i},ch=rh[3],hh=Wt,lh=Wt;hh.default=lh;var ph=function(t){return t},fh=function(t){if(null==t)return ph;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],s=t.translate[1];return function(t,a){a||(e=n=0);var u=2,c=t.length,h=new Array(c);for(h[0]=(e+=t[0])*r+o,h[1]=(n+=t[1])*i+s;u<c;)h[u]=t[u],++u;return h}},gh=function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n},dh=function(t,e){function n(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=r[r.length-1],e<0?[n,i]:[i,n]}function r(t,e){for(var n in t){var r=t[n];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){i[t<0?~t:t]=1}),a.push(r)}}var i={},o={},s={},a=[],u=-1;return e.forEach(function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++u],e[u]=n,e[r]=i)}),e.forEach(function(t){var e,r,i=n(t),a=i[0],u=i[1];if(e=s[a])if(delete s[e.end],e.push(t),e.end=u,r=o[u]){delete o[r.start];var c=r===e?e:e.concat(r);o[c.start=e.start]=s[c.end=r.end]=c}else o[e.start]=s[e.end]=e;else if(e=o[u])if(delete o[e.start],e.unshift(t),e.start=a,r=s[a]){delete s[r.end];var h=r===e?e:r.concat(e);o[h.start=r.start]=s[h.end=e.end]=h}else o[e.start]=s[e.end]=e;else e=[t],o[e.start=a]=s[e.end=u]=e}),r(s,o),r(o,s),e.forEach(function(t){i[t<0?~t:t]||a.push([t])}),a},yh=function(t){return Ie(t,Ce.apply(this,arguments))},_h=function(t){function e(t){null!=t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function n(t){var e=t[0],n=t[1];e<o&&(o=e),e>a&&(a=e),n<s&&(s=n),n>u&&(u=n)}function r(t){t.forEach(n)}function i(t){t.forEach(r)}var o=1/0,s=1/0,a=-1/0,u=-1/0,c={GeometryCollection:function(t){t.geometries.forEach(e)},Point:function(t){n(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(n)},LineString:function(t){r(t.arcs)},MultiLineString:function(t){t.arcs.forEach(r)},Polygon:function(t){t.arcs.forEach(r)},MultiPolygon:function(t){t.arcs.forEach(i)}};for(var h in t)e(t[h]);return a>=o&&u>=s?[o,s,a,u]:void 0},vh=function(t,e,n,r,i){function o(r){for(var o=e(r)&c,s=u[o],a=0;s!=i;){if(n(s,r))return!0;if(++a>=t)throw new Error("full hashset");s=u[o=o+1&c]}return u[o]=r,!0}function s(r){for(var o=e(r)&c,s=u[o],a=0;s!=i;){if(n(s,r))return!0;if(++a>=t)break;s=u[o=o+1&c]}return!1}function a(){for(var t=[],e=0,n=u.length;e<n;++e){var r=u[e];r!=i&&t.push(r)}return t}3===arguments.length&&(r=Array,i=null);for(var u=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),c=t-1,h=0;h<t;++h)u[h]=i;return{add:o,has:s,values:a}},mh=function(t,e,n,r,i,o){function s(r,o){for(var s=e(r)&p,a=h[s],u=0;a!=i;){if(n(a,r))return l[s]=o;if(++u>=t)throw new Error("full hashmap");a=h[s=s+1&p]}return h[s]=r,l[s]=o,o}function a(r,o){for(var s=e(r)&p,a=h[s],u=0;a!=i;){if(n(a,r))return l[s];if(++u>=t)throw new Error("full hashmap");a=h[s=s+1&p]}return h[s]=r,l[s]=o,o}
function u(r,o){for(var s=e(r)&p,a=h[s],u=0;a!=i;){if(n(a,r))return l[s];if(++u>=t)break;a=h[s=s+1&p]}return o}function c(){for(var t=[],e=0,n=h.length;e<n;++e){var r=h[e];r!=i&&t.push(r)}return t}3===arguments.length&&(r=o=Array,i=null);for(var h=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),l=new o(t),p=t-1,f=0;f<t;++f)h[f]=i;return{set:s,maybeSet:a,get:u,keys:c}},xh=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Eh=new ArrayBuffer(16),wh=new Float64Array(Eh),bh=new Uint32Array(Eh),Ih=function(t){wh[0]=t[0],wh[1]=t[1];var e=bh[0]^bh[1];return 2147483647&(e=e<<5^e>>7^bh[2]^bh[3])},Nh=function(t){function e(t,e,n,r){if(f[n]!==t){f[n]=t;var i=g[n];if(i>=0){var o=d[n];i===e&&o===r||i===r&&o===e||(++_,y[n]=1)}else g[n]=e,d[n]=r}}function n(t){return Ih(c[t])}function r(t,e){return xh(c[t],c[e])}var i,o,s,a,u,c=t.coordinates,h=t.lines,l=t.rings,p=function(){for(var t=mh(1.4*c.length,n,r,Int32Array,-1,Int32Array),e=new Int32Array(c.length),i=0,o=c.length;i<o;++i)e[i]=t.maybeSet(i,i);return e}(),f=new Int32Array(c.length),g=new Int32Array(c.length),d=new Int32Array(c.length),y=new Int8Array(c.length),_=0;for(i=0,o=c.length;i<o;++i)f[i]=g[i]=d[i]=-1;for(i=0,o=h.length;i<o;++i){var v=h[i],m=v[0],x=v[1];for(a=p[m],u=p[++m],++_,y[a]=1;++m<=x;)e(i,s=a,a=u,u=p[m]);++_,y[u]=1}for(i=0,o=c.length;i<o;++i)f[i]=-1;for(i=0,o=l.length;i<o;++i){var E=l[i],w=E[0]+1,b=E[1];for(s=p[b-1],a=p[w-1],u=p[w],e(i,s,a,u);++w<=b;)e(i,s=a,a=u,u=p[w])}f=g=d=null;var I,N=vh(1.4*_,Ih,xh);for(i=0,o=c.length;i<o;++i)y[I=p[i]]&&N.add(c[I]);return N},Ch=function(t){var e,n,r,i=Nh(t),o=t.coordinates,s=t.lines,a=t.rings;for(n=0,r=s.length;n<r;++n)for(var u=s[n],c=u[0],h=u[1];++c<h;)i.has(o[c])&&(e={0:c,1:u[1]},u[1]=c,u=u.next=e);for(n=0,r=a.length;n<r;++n)for(var l=a[n],p=l[0],f=p,g=l[1],d=i.has(o[p]);++f<g;)i.has(o[f])&&(d?(e={0:f,1:l[1]},l[1]=f,l=l.next=e):(Se(o,p,g,g-f),o[g]=o[p],d=!0,f=p));return t},Sh=function(t){function e(t){var e,i,o,s,a,u,c,h;if(o=d.get(e=l[t[0]]))for(c=0,h=o.length;c<h;++c)if(s=o[c],n(s,t))return t[0]=s[0],void(t[1]=s[1]);if(a=d.get(i=l[t[1]]))for(c=0,h=a.length;c<h;++c)if(u=a[c],r(u,t))return t[1]=u[0],void(t[0]=u[1]);o?o.push(t):d.set(e,[t]),a?a.push(t):d.set(i,[t]),y.push(t)}function n(t,e){var n=t[0],r=e[0],i=t[1];if(n-i!=r-e[1])return!1;for(;n<=i;++n,++r)if(!xh(l[n],l[r]))return!1;return!0}function r(t,e){var n=t[0],r=e[0],i=t[1],o=e[1];if(n-i!=r-o)return!1;for(;n<=i;++n,--o)if(!xh(l[n],l[o]))return!1;return!0}function i(t,e){var n=t[0],r=e[0],i=t[1],o=e[1],a=i-n;if(a!==o-r)return!1;for(var u=s(t),c=s(e),h=0;h<a;++h)if(!xh(l[n+(h+u)%a],l[r+(h+c)%a]))return!1;return!0}function o(t,e){var n=t[0],r=e[0],i=t[1],o=e[1],a=i-n;if(a!==o-r)return!1;for(var u=s(t),c=a-s(e),h=0;h<a;++h)if(!xh(l[n+(h+u)%a],l[o-(h+c)%a]))return!1;return!0}function s(t){for(var e=t[0],n=t[1],r=e,i=r,o=l[r];++r<n;){var s=l[r];(s[0]<o[0]||s[0]===o[0]&&s[1]<o[1])&&(i=r,o=s)}return i-e}var a,u,c,h,l=t.coordinates,p=t.lines,f=t.rings,g=p.length+f.length;for(delete t.lines,delete t.rings,c=0,h=p.length;c<h;++c)for(a=p[c];a=a.next;)++g;for(c=0,h=f.length;c<h;++c)for(u=f[c];u=u.next;)++g;var d=mh(2*g*1.4,Ih,xh),y=t.arcs=[];for(c=0,h=p.length;c<h;++c){a=p[c];do{e(a)}while(a=a.next)}for(c=0,h=f.length;c<h;++c)if(u=f[c],u.next)do{e(u)}while(u=u.next);else!function(t){var e,n,r,a,u;if(n=d.get(e=l[t[0]]))for(a=0,u=n.length;a<u;++a){if(r=n[a],i(r,t))return t[0]=r[0],void(t[1]=r[1]);if(o(r,t))return t[0]=r[1],void(t[1]=r[0])}if(n=d.get(e=l[t[0]+s(t)]))for(a=0,u=n.length;a<u;++a){if(r=n[a],i(r,t))return t[0]=r[0],void(t[1]=r[1]);if(o(r,t))return t[0]=r[1],void(t[1]=r[0])}n?n.push(t):d.set(e,[t]),y.push(t)}(u);return t},Mh=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,i,o=t[e],s=0,a=1,u=o.length,c=o[0],h=c[0],l=c[1];++s<u;)c=o[s],r=c[0],i=c[1],r===h&&i===l||(o[a++]=[r-h,i-l],h=r,l=i);1===a&&(o[a++]=[0,0]),o.length=a}return t},Lh=function(t){function e(t){t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function n(t){for(var e=0,n=t.length;e<n;++e)u[++o]=t[e];var r={0:o-n+1,1:o};return s.push(r),r}function r(t){for(var e=0,n=t.length;e<n;++e)u[++o]=t[e];var r={0:o-n+1,1:o};return a.push(r),r}function i(t){return t.map(r)}var o=-1,s=[],a=[],u=[],c={GeometryCollection:function(t){t.geometries.forEach(e)},LineString:function(t){t.arcs=n(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(n)},Polygon:function(t){t.arcs=t.arcs.map(r)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var h in t)e(t[h]);return{type:"Topology",coordinates:u,lines:s,rings:a,objects:t}},Ph=function(t){var e,n={};for(e in t)n[e]=Le(t[e]);return n},Oh=function(t,e,n){function r(t){return[Math.round((t[0]-c)*f),Math.round((t[1]-h)*g)]}function i(t,e){for(var n,r,i,o,s,a=-1,u=0,l=t.length,p=new Array(l);++a<l;)n=t[a],o=Math.round((n[0]-c)*f),s=Math.round((n[1]-h)*g),o===r&&s===i||(p[u++]=[r=o,i=s]);for(p.length=u;u<e;)u=p.push([p[0][0],p[0][1]]);return p}function o(t){return i(t,2)}function s(t){return i(t,4)}function a(t){return t.map(s)}function u(t){null!=t&&d.hasOwnProperty(t.type)&&d[t.type](t)}var c=e[0],h=e[1],l=e[2],p=e[3],f=l-c?(n-1)/(l-c):1,g=p-h?(n-1)/(p-h):1,d={GeometryCollection:function(t){t.geometries.forEach(u)},Point:function(t){t.coordinates=r(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(r)},LineString:function(t){t.arcs=o(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(o)},Polygon:function(t){t.arcs=a(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(a)}};for(var y in t)u(t[y]);return{scale:[1/f,1/g],translate:[c,h]}},Rh=function(t,e){function n(t){t&&h.hasOwnProperty(t.type)&&h[t.type](t)}function r(t){var e=[];do{var n=c.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function i(t){return t.map(r)}var o=_h(t=Ph(t)),s=e>0&&o&&Oh(t,o,e),a=Sh(Ch(Lh(t))),u=a.coordinates,c=mh(1.4*a.arcs.length,Te,Ae);t=a.objects,a.bbox=o,a.arcs=a.arcs.map(function(t,e){return c.set(t,e),u.slice(t[0],t[1]+1)}),delete a.coordinates,u=null;var h={GeometryCollection:function(t){t.geometries.forEach(n)},LineString:function(t){t.arcs=r(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(r)},Polygon:function(t){t.arcs=t.arcs.map(r)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var l in t)n(t[l]);return s&&(a.transform=s,a.arcs=Mh(a.arcs)),a},Th=function(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(var e=0;e<this.length-1;e++){var n=this.points[e],r=this.points[e+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var e=0;e<this.centers.length-1;e++){var n=this.centers[e],r=this.centers[e+1],i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};Th.prototype.cacheSteps=function(t){var e=[],n=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>t&&(e.push(r),n=i)}return e},Th.prototype.vector=function(t){var e=this.pos(t+10),n=this.pos(t-10);return{angle:180*Math.atan2(e.y-n.y,e.x-n.x)/3.14,speed:Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z))}},Th.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var n=e/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n),i=(this.length-1)*n-r;return function(t,e,n,r,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+e.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+e.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+e.z*o[3]}}(i,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])};var Ah=In,Dh=In;In.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,s=Math.abs(Qn(t,0,o,n));if(i)for(var a=0,u=e.length;a<u;a++){var c=e[a]*n,h=a<u-1?e[a+1]*n:t.length;s-=Math.abs(Qn(t,c,h,n))}var l=0;for(a=0;a<r.length;a+=3){var p=r[a]*n,f=r[a+1]*n,g=r[a+2]*n;l+=Math.abs((t[p]-t[g])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[g+1]-t[p+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},In.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},Ah.default=Dh,ar.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!mr(t,e))return n;for(var i,o,s,a,u=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],a=e.leaf?r(s):s,mr(t,a)&&(e.leaf?n.push(s):vr(t,a)?this._all(s,n):u.push(s));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!mr(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],s=e.leaf?n(o):o,mr(t,s)){if(e.leaf||vr(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=xr([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),u=[],c=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),s.leaf&&-1!==(i=ur(t,s.children,e)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!vr(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:pr,compareMinY:fr,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return i=xr(t.slice(e,n+1)),cr(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),i=xr([]),i.leaf=!1,i.height=r;var a,u,c,h,l=Math.ceil(o/s),p=l*Math.ceil(Math.sqrt(s));for(Er(t,e,n,p,this.compareMinX),a=e;a<=n;a+=p)for(c=Math.min(a+p-1,n),Er(t,a,c,l,this.compareMinY),u=a;u<=c;u+=l)h=Math.min(u+l-1,c),i.children.push(this._build(t,u,h,r-1));return cr(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,u,c,h,l;;){if(r.push(e),e.leaf||r.length-1===n)break;for(h=l=1/0,i=0,o=e.children.length;i<o;i++)s=e.children[i],u=gr(s),c=yr(t,s)-u,c<l?(l=c,h=u<h?u:h,a=s):c===l&&u<h&&(h=u,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),lr(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=xr(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,cr(n,this.toBBox),cr(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=xr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,cr(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,u,c,h;for(u=c=1/0,r=e;r<=n-e;r++)i=hr(t,0,r,this.toBBox),o=hr(t,r,n,this.toBBox),s=_r(i,o),a=gr(i)+gr(o),s<u?(u=s,h=r,c=a<c?a:c):s===u&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:pr,i=t.leaf?this.compareMinY:fr;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=hr(t,0,e,s),u=hr(t,n-e,n,s),c=dr(a)+dr(u);for(i=e;i<n-e;i++)o=t.children[i],lr(a,t.leaf?s(o):o),c+=dr(a);for(i=n-e-1;i>=e;i--)o=t.children[i],lr(u,t.leaf?s(o):o),c+=dr(u);return c},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)lr(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():cr(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var Fh=Object.freeze({toMercator:Fr,toWgs84:qr}),qh=6378137,Gh=function(t,e,n){function r(t,n,r,i){var u=o[t][n],c=o[t][n+1],h=o[r][i],l=o[r][i+1],p=Li(u,c,h,l);if(null!==p){var f,g;if(f=c[0]!==u[0]?(p[0]-u[0])/(c[0]-u[0]):(p[1]-u[1])/(c[1]-u[1]),g=l[0]!==h[0]?(p[0]-h[0])/(l[0]-h[0]):(p[1]-h[1])/(l[1]-h[1]),!(f>=1||f<=0||g>=1||g<=0)){var d=p,y=!a[d];y&&(a[d]=!0),e?s.push(e(p,t,n,u,c,f,r,i,h,l,g,y)):s.push(p)}}}function i(t,e){var n,r,i,s,a=o[t][e],u=o[t][e+1];return a[0]<u[0]?(n=a[0],r=u[0]):(n=u[0],r=a[0]),a[1]<u[1]?(i=a[1],s=u[1]):(i=u[1],s=a[1]),{minX:n,minY:i,maxX:r,maxY:s,ring:t,edge:e}}if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===n&&(n=1);var o=t.geometry.coordinates,s=[],a={};if(n){for(var u=[],c=0;c<o.length;c++)for(var h=0;h<o[c].length-1;h++)u.push(i(c,h));var l=Zc();l.load(u)}for(var p=0;p<o.length;p++)for(var f=0;f<o[p].length-1;f++)if(n){var g=l.search(i(p,f));g.forEach(function(t){var e=t.ring,n=t.edge;r(p,f,e,n)})}else for(var d=0;d<o.length;d++)for(var y=0;y<o[d].length-1;y++)r(p,f,d,y);return e||(s={type:"Feature",geometry:{type:"MultiPoint",coordinates:s}}),s},Bh=function(t){function e(){for(var t=[],e=0;e<g.features.length;e++)-1==g.features[e].properties.parent&&t.push(e);if(t.length>1)for(var e=0;e<t.length;e++){for(var n=-1,r=0;r<g.features.length;r++)t[e]!=r&&ue(g.features[t[e]].geometry.coordinates[0][0],g.features[r],{ignoreBoundary:!0})&&ei(g.features[r])<1/0&&(n=r);g.features[t[e]].properties.parent=n}}function n(){for(var t=0;t<g.features.length;t++)if(-1==g.features[t].properties.parent){var e=g.features[t].properties.winding;g.features[t].properties.netWinding=e,r(t,e)}}function r(t,e){for(var n=0;n<g.features.length;n++)if(g.features[n].properties.parent==t){var i=e+g.features[n].properties.winding;g.features[n].properties.netWinding=i,r(n,i)}}if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var i=t.geometry.coordinates.length,s=[],a=0;a<i;a++){var u=t.geometry.coordinates[a];Ti(u[0],u[u.length-1])||u.push(u[0]),s.push.apply(s,u.slice(0,u.length-1))}if(!Ai(s))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var h=s.length,l=Gh(t,function(t,e,n,r,i,o,s,a,u,c,h,l){return[t,e,n,r,i,o,s,a,u,c,h,l]}),p=l.length;if(0==p){for(var f=[],a=0;a<i;a++)f.push(o([t.geometry.coordinates[a]],{parent:-1,winding:Ri(t.geometry.coordinates[a])}));var g=c(f);return e(),n(),g}for(var d=[],y=[],a=0;a<i;a++){d.push([]);for(var _=0;_<t.geometry.coordinates[a].length-1;_++)d[a].push([new kh(t.geometry.coordinates[a][(_+1).modulo(t.geometry.coordinates[a].length-1)],1,[a,_],[a,(_+1).modulo(t.geometry.coordinates[a].length-1)],void 0)]),y.push(new zh(t.geometry.coordinates[a][_],[a,(_-1).modulo(t.geometry.coordinates[a].length-1)],[a,_],void 0,void 0,!1,!0))}for(var a=0;a<p;a++)d[l[a][1]][l[a][2]].push(new kh(l[a][0],l[a][5],[l[a][1],l[a][2]],[l[a][6],l[a][7]],void 0)),l[a][11]&&y.push(new zh(l[a][0],[l[a][1],l[a][2]],[l[a][6],l[a][7]],void 0,void 0,!0,!0));for(var v=y.length,a=0;a<d.length;a++)for(var _=0;_<d[a].length;_++)d[a][_].sort(function(t,e){return t.param<e.param?-1:1});for(var m=[],a=0;a<v;a++)m.push({minX:y[a].coord[0],minY:y[a].coord[1],maxX:y[a].coord[0],maxY:y[a].coord[1],index:a});var x=Zc();x.load(m);for(var a=0;a<d.length;a++)for(var _=0;_<d[a].length;_++)for(var E=0;E<d[a][_].length;E++){var w;w=E==d[a][_].length-1?d[a][(_+1).modulo(t.geometry.coordinates[a].length-1)][0].coord:d[a][_][E+1].coord;var b=x.search({minX:w[0],minY:w[1],maxX:w[0],maxY:w[1]})[0];d[a][_][E].nxtIsectAlongEdgeIn=b.index}for(var a=0;a<d.length;a++)for(var _=0;_<d[a].length;_++)for(var E=0;E<d[a][_].length;E++){var w=d[a][_][E].coord,b=x.search({minX:w[0],minY:w[1],maxX:w[0],maxY:w[1]})[0],I=b.index;I<h?y[I].nxtIsectAlongRingAndEdge2=d[a][_][E].nxtIsectAlongEdgeIn:Ti(y[I].ringAndEdge1,d[a][_][E].ringAndEdgeIn)?y[I].nxtIsectAlongRingAndEdge1=d[a][_][E].nxtIsectAlongEdgeIn:y[I].nxtIsectAlongRingAndEdge2=d[a][_][E].nxtIsectAlongEdgeIn}for(var N=[],a=0,_=0;_<i;_++){for(var C=a,E=0;E<t.geometry.coordinates[_].length-1;E++)y[a].coord[0]<y[C].coord[0]&&(C=a),a++;for(var S=y[C].nxtIsectAlongRingAndEdge2,E=0;E<y.length;E++)if(y[E].nxtIsectAlongRingAndEdge1==C||y[E].nxtIsectAlongRingAndEdge2==C){var M=E;break}var L=Oi([y[M].coord,y[C].coord,y[S].coord],!0)?1:-1;N.push({isect:C,parent:-1,winding:L})}N.sort(function(t,e){return y[t.isect].coord>y[e.isect].coord?-1:1});for(var f=[];N.length>0;){var P=N.pop(),O=P.isect,R=P.parent,T=P.winding,A=f.length,D=[y[O].coord],F=O;if(y[O].ringAndEdge1Walkable)var q=y[O].ringAndEdge1,G=y[O].nxtIsectAlongRingAndEdge1;else var q=y[O].ringAndEdge2,G=y[O].nxtIsectAlongRingAndEdge2;for(;!Ti(y[O].coord,y[G].coord);){D.push(y[G].coord);for(var B=void 0,a=0;a<N.length;a++)if(N[a].isect==G){B=a;break}if(void 0!=B&&N.splice(B,1),Ti(q,y[G].ringAndEdge1)){if(q=y[G].ringAndEdge2,y[G].ringAndEdge2Walkable=!1,y[G].ringAndEdge1Walkable){var k={isect:G};Oi([y[F].coord,y[G].coord,y[y[G].nxtIsectAlongRingAndEdge2].coord],1==T)?(k.parent=R,k.winding=-T):(k.parent=A,k.winding=T),N.push(k)}F=G,G=y[G].nxtIsectAlongRingAndEdge2}else{if(q=y[G].ringAndEdge1,y[G].ringAndEdge1Walkable=!1,y[G].ringAndEdge2Walkable){var k={isect:G};Oi([y[F].coord,y[G].coord,y[y[G].nxtIsectAlongRingAndEdge1].coord],1==T)?(k.parent=R,k.winding=-T):(k.parent=A,k.winding=T),N.push(k)}F=G,G=y[G].nxtIsectAlongRingAndEdge1}}D.push(y[G].coord),f.push(o([D],{index:A,parent:R,winding:T,netWinding:void 0}))}var g=c(f);return e(),n(),g},kh=function(t,e,n,r,i){this.coord=t,this.param=e,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},zh=function(t,e,n,r,i,o,s){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=s};Number.prototype.modulo=function(t){return(this%t+t)%t};var jh=Math.PI/180,Xh=180/Math.PI,Uh=function(t,e){this.lon=t,this.lat=e,this.x=jh*t,this.y=jh*e};Uh.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Uh.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new Uh(e,t)};var Yh=function(){this.coords=[],this.length=0};Yh.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Vh=function(t){this.properties=t||{},this.geometries=[]};Vh.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Vh.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var Hh=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Uh(t.x,t.y),this.end=new Uh(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};Hh.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),s=Xh*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[Xh*Math.atan2(i,r),s]},Hh.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var o=r*i,s=this.interpolate(o);n.push(s)}for(var a=!1,u=0,c=e&&e.offset?e.offset:10,h=180-c,l=-180+c,p=360-c,f=1;f<n.length;++f){var g=n[f-1][0],d=n[f][0],y=Math.abs(d-g);y>p&&(d>h&&g<l||g>h&&d<l)?a=!0:y>u&&(u=y)}var _=[];if(a&&u<c){var v=[];_.push(v);for(var m=0;m<n.length;++m){var x=parseFloat(n[m][0]);if(m>0&&Math.abs(x-n[m-1][0])>p){var E=parseFloat(n[m-1][0]),w=parseFloat(n[m-1][1]),b=parseFloat(n[m][0]),I=parseFloat(n[m][1]);if(E>-180&&E<l&&180===b&&m+1<n.length&&n[m-1][0]>-180&&n[m-1][0]<l){v.push([-180,n[m][1]]),m++,v.push([n[m][0],n[m][1]]);continue}if(E>h&&E<180&&-180===b&&m+1<n.length&&n[m-1][0]>h&&n[m-1][0]<180){v.push([180,n[m][1]]),m++,v.push([n[m][0],n[m][1]]);continue}if(E<l&&b>h){var N=E;E=b,b=N;var C=w;w=I,I=C}if(E>h&&b<l&&(b+=360),E<=180&&b>=180&&E<b){var S=(180-E)/(b-E),M=S*I+(1-S)*w;v.push([n[m-1][0]>h?180:-180,M]),v=[],v.push([n[m-1][0]>h?-180:180,M]),_.push(v)}else v=[],_.push(v);v.push([x,n[m][1]])}else v.push([n[m][0],n[m][1]])}}else{var L=[];_.push(L);for(var P=0;P<n.length;++P)L.push([n[P][0],n[P][1]])}for(var O=new Vh(this.properties),R=0;R<_.length;++R){var T=new Yh;O.geometries.push(T);for(var A=_[R],D=0;D<A.length;++D)T.move_to(A[D])}return O};var Wh=Zi;Zi.polyline=Zi,Zi.polygon=Ki;var Jh=Array.prototype.slice,Zh={successCallback:null,verbose:!1,polygons:!1},Kh={},Qh=64,$h=16,tl=4,el=1,nl=[],rl=[],il=[],ol=[],sl=[],al=[],ul=[],cl=[],hl=[],ll=[],pl=[],fl=[],gl=[],dl=[],yl=[],_l=[],vl=[],ml=[],xl=[],El=[],wl=[],bl=[],Il=[],Nl=[];ul[85]=ll[85]=-1,cl[85]=pl[85]=0,hl[85]=fl[85]=1,xl[85]=bl[85]=1,El[85]=Il[85]=0,wl[85]=Nl[85]=1,nl[85]=ol[85]=0,rl[85]=sl[85]=-1,il[85]=yl[85]=0,_l[85]=gl[85]=0,vl[85]=dl[85]=1,al[85]=ml[85]=1,bl[1]=bl[169]=0,Il[1]=Il[169]=-1,Nl[1]=Nl[169]=0,gl[1]=gl[169]=-1,dl[1]=dl[169]=0,yl[1]=yl[169]=0,ll[4]=ll[166]=0,pl[4]=pl[166]=-1,fl[4]=fl[166]=1,_l[4]=_l[166]=1,vl[4]=vl[166]=0,ml[4]=ml[166]=0,ul[16]=ul[154]=0,cl[16]=cl[154]=1,hl[16]=hl[154]=1,ol[16]=ol[154]=1,sl[16]=sl[154]=0,al[16]=al[154]=1,xl[64]=xl[106]=0,El[64]=El[106]=1,wl[64]=wl[106]=0,nl[64]=nl[106]=-1,rl[64]=rl[106]=0,il[64]=il[106]=1,xl[2]=xl[168]=0,El[2]=El[168]=-1,wl[2]=wl[168]=1,bl[2]=bl[168]=0,Il[2]=Il[168]=-1,Nl[2]=Nl[168]=0,gl[2]=gl[168]=-1,dl[2]=dl[168]=0,yl[2]=yl[168]=0,_l[2]=_l[168]=-1,vl[2]=vl[168]=0,ml[2]=ml[168]=1,ul[8]=ul[162]=0,cl[8]=cl[162]=-1,hl[8]=hl[162]=0,ll[8]=ll[162]=0,pl[8]=pl[162]=-1,fl[8]=fl[162]=1,gl[8]=gl[162]=1,dl[8]=dl[162]=0,yl[8]=yl[162]=1,_l[8]=_l[162]=1,vl[8]=vl[162]=0,ml[8]=ml[162]=0,ul[32]=ul[138]=0,cl[32]=cl[138]=1,hl[32]=hl[138]=1,ll[32]=ll[138]=0,pl[32]=pl[138]=1,fl[32]=fl[138]=0,nl[32]=nl[138]=1,rl[32]=rl[138]=0,il[32]=il[138]=0,ol[32]=ol[138]=1,sl[32]=sl[138]=0,al[32]=al[138]=1,bl[128]=bl[42]=0,Il[128]=Il[42]=1,Nl[128]=Nl[42]=1,xl[128]=xl[42]=0,El[128]=El[42]=1,wl[128]=wl[42]=0,nl[128]=nl[42]=-1,rl[128]=rl[42]=0,il[128]=il[42]=1,ol[128]=ol[42]=-1,sl[128]=sl[42]=0,al[128]=al[42]=0,ll[5]=ll[165]=-1,pl[5]=pl[165]=0,fl[5]=fl[165]=0,bl[5]=bl[165]=1,Il[5]=Il[165]=0,Nl[5]=Nl[165]=0,_l[20]=_l[150]=0,vl[20]=vl[150]=1,ml[20]=ml[150]=1,ol[20]=ol[150]=0,sl[20]=sl[150]=-1,al[20]=al[150]=1,ul[80]=ul[90]=-1,cl[80]=cl[90]=0,hl[80]=hl[90]=1,xl[80]=xl[90]=1,El[80]=El[90]=0,wl[80]=wl[90]=1,gl[65]=gl[105]=0,dl[65]=dl[105]=1,yl[65]=yl[105]=0,nl[65]=nl[105]=0,rl[65]=rl[105]=-1,il[65]=il[105]=0,ul[160]=ul[10]=-1,cl[160]=cl[10]=0,hl[160]=hl[10]=1,ll[160]=ll[10]=-1,pl[160]=pl[10]=0,fl[160]=fl[10]=0,bl[160]=bl[10]=1,Il[160]=Il[10]=0,Nl[160]=Nl[10]=0,xl[160]=xl[10]=1,El[160]=El[10]=0,wl[160]=wl[10]=1,_l[130]=_l[40]=0,vl[130]=vl[40]=1,ml[130]=ml[40]=1,gl[130]=gl[40]=0,dl[130]=dl[40]=1,yl[130]=yl[40]=0,nl[130]=nl[40]=0,rl[130]=rl[40]=-1,il[130]=il[40]=0,ol[130]=ol[40]=0,sl[130]=sl[40]=-1,al[130]=al[40]=1,ll[37]=ll[133]=0,pl[37]=pl[133]=1,fl[37]=fl[133]=1,bl[37]=bl[133]=0,Il[37]=Il[133]=1,Nl[37]=Nl[133]=0,nl[37]=nl[133]=-1,rl[37]=rl[133]=0,il[37]=il[133]=0,ol[37]=ol[133]=1,sl[37]=sl[133]=0,al[37]=al[133]=0,_l[148]=_l[22]=-1,vl[148]=vl[22]=0,ml[148]=ml[22]=0,bl[148]=bl[22]=0,Il[148]=Il[22]=-1,Nl[148]=Nl[22]=1,xl[148]=xl[22]=0,El[148]=El[22]=1,wl[148]=wl[22]=1,ol[148]=ol[22]=-1,sl[148]=sl[22]=0,al[148]=al[22]=1,ul[82]=ul[88]=0,cl[82]=cl[88]=-1,hl[82]=hl[88]=1,_l[82]=_l[88]=1,vl[82]=vl[88]=0,ml[82]=ml[88]=1,gl[82]=gl[88]=-1,dl[82]=dl[88]=0,yl[82]=yl[88]=1,xl[82]=xl[88]=0,El[82]=El[88]=-1,wl[82]=wl[88]=0,ul[73]=ul[97]=0,cl[73]=cl[97]=1,hl[73]=hl[97]=0,ll[73]=ll[97]=0,pl[73]=pl[97]=-1,fl[73]=fl[97]=0,gl[73]=gl[97]=1,dl[73]=dl[97]=0,yl[73]=yl[97]=0,nl[73]=nl[97]=1,rl[73]=rl[97]=0,il[73]=il[97]=1,ul[145]=ul[25]=0,cl[145]=cl[25]=-1,hl[145]=hl[25]=0,gl[145]=gl[25]=1,dl[145]=dl[25]=0,yl[145]=yl[25]=1,bl[145]=bl[25]=0,Il[145]=Il[25]=1,Nl[145]=Nl[25]=1,ol[145]=ol[25]=-1,sl[145]=sl[25]=0,al[145]=al[25]=0,ll[70]=ll[100]=0,pl[70]=pl[100]=1,fl[70]=fl[100]=0,_l[70]=_l[100]=-1,vl[70]=vl[100]=0,ml[70]=ml[100]=1,xl[70]=xl[100]=0,El[70]=El[100]=-1;wl[70]=wl[100]=1,nl[70]=nl[100]=1,rl[70]=rl[100]=0,il[70]=il[100]=0,ll[101]=ll[69]=0,pl[101]=pl[69]=1,fl[101]=fl[69]=0,nl[101]=nl[69]=1,rl[101]=rl[69]=0,il[101]=il[69]=0,bl[149]=bl[21]=0,Il[149]=Il[21]=1,Nl[149]=Nl[21]=1,ol[149]=ol[21]=-1,sl[149]=sl[21]=0,al[149]=al[21]=0,_l[86]=_l[84]=-1,vl[86]=vl[84]=0,ml[86]=ml[84]=1,xl[86]=xl[84]=0,El[86]=El[84]=-1,wl[86]=wl[84]=1,ul[89]=ul[81]=0,cl[89]=cl[81]=-1,hl[89]=hl[81]=0,gl[89]=gl[81]=1,dl[89]=dl[81]=0,yl[89]=yl[81]=1,ul[96]=ul[74]=0,cl[96]=cl[74]=1,hl[96]=hl[74]=0,ll[96]=ll[74]=-1,pl[96]=pl[74]=0,fl[96]=fl[74]=1,xl[96]=xl[74]=1,El[96]=El[74]=0,wl[96]=wl[74]=0,nl[96]=nl[74]=1,rl[96]=rl[74]=0,il[96]=il[74]=1,ul[24]=ul[146]=0,cl[24]=cl[146]=-1,hl[24]=hl[146]=1,_l[24]=_l[146]=1,vl[24]=vl[146]=0,ml[24]=ml[146]=1,gl[24]=gl[146]=0,dl[24]=dl[146]=1,yl[24]=yl[146]=1,ol[24]=ol[146]=0,sl[24]=sl[146]=-1,al[24]=al[146]=0,ll[6]=ll[164]=-1,pl[6]=pl[164]=0,fl[6]=fl[164]=1,_l[6]=_l[164]=-1,vl[6]=vl[164]=0,ml[6]=ml[164]=0,bl[6]=bl[164]=0,Il[6]=Il[164]=-1,Nl[6]=Nl[164]=1,xl[6]=xl[164]=1,El[6]=El[164]=0,wl[6]=wl[164]=0,gl[129]=gl[41]=0,dl[129]=dl[41]=1,yl[129]=yl[41]=1,bl[129]=bl[41]=0,Il[129]=Il[41]=1,Nl[129]=Nl[41]=0,nl[129]=nl[41]=-1,rl[129]=rl[41]=0,il[129]=il[41]=0,ol[129]=ol[41]=0,sl[129]=sl[41]=-1,al[129]=al[41]=0,_l[66]=_l[104]=0,vl[66]=vl[104]=1,ml[66]=ml[104]=0,gl[66]=gl[104]=-1,dl[66]=dl[104]=0,yl[66]=yl[104]=1,xl[66]=xl[104]=0,El[66]=El[104]=-1,wl[66]=wl[104]=0,nl[66]=nl[104]=0,rl[66]=rl[104]=-1,il[66]=il[104]=1,ul[144]=ul[26]=-1,cl[144]=cl[26]=0,hl[144]=hl[26]=0,bl[144]=bl[26]=1,Il[144]=Il[26]=0,Nl[144]=Nl[26]=1,xl[144]=xl[26]=0,El[144]=El[26]=1,wl[144]=wl[26]=1,ol[144]=ol[26]=-1,sl[144]=sl[26]=0,al[144]=al[26]=1,ll[36]=ll[134]=0,pl[36]=pl[134]=1,fl[36]=fl[134]=1,_l[36]=_l[134]=0,vl[36]=vl[134]=1,ml[36]=ml[134]=0,nl[36]=nl[134]=0,rl[36]=rl[134]=-1,il[36]=il[134]=1,ol[36]=ol[134]=1,sl[36]=sl[134]=0,al[36]=al[134]=0,ul[9]=ul[161]=-1,cl[9]=cl[161]=0,hl[9]=hl[161]=0,ll[9]=ll[161]=0,pl[9]=pl[161]=-1,fl[9]=fl[161]=0,gl[9]=gl[161]=1,dl[9]=dl[161]=0,yl[9]=yl[161]=0,bl[9]=bl[161]=1,Il[9]=Il[161]=0,Nl[9]=Nl[161]=1,ul[136]=0,cl[136]=1,hl[136]=1,ll[136]=0,pl[136]=1,fl[136]=0,_l[136]=-1,vl[136]=0,ml[136]=1,gl[136]=-1,dl[136]=0,yl[136]=0,bl[136]=0,Il[136]=-1,Nl[136]=0,xl[136]=0,El[136]=-1,wl[136]=1,nl[136]=1,rl[136]=0,il[136]=0,ol[136]=1,sl[136]=0,al[136]=1,ul[34]=0,cl[34]=-1,hl[34]=0,ll[34]=0,pl[34]=-1,fl[34]=1,_l[34]=1,vl[34]=0,ml[34]=0,gl[34]=1,dl[34]=0,yl[34]=1,bl[34]=0,Il[34]=1,Nl[34]=1,xl[34]=0,El[34]=1,wl[34]=0,nl[34]=-1,rl[34]=0,il[34]=1,ol[34]=-1,sl[34]=0,al[34]=0,ul[35]=0,cl[35]=1,hl[35]=1,ll[35]=0,pl[35]=-1,fl[35]=1,_l[35]=1,vl[35]=0,ml[35]=0,gl[35]=-1,dl[35]=0,yl[35]=0,bl[35]=0,Il[35]=-1,Nl[35]=0,xl[35]=0,El[35]=1,wl[35]=0,nl[35]=-1,rl[35]=0,il[35]=1,ol[35]=1,sl[35]=0,al[35]=1,ul[153]=0,cl[153]=1,hl[153]=1,gl[153]=-1;dl[153]=0,yl[153]=0,bl[153]=0,Il[153]=-1,Nl[153]=0,ol[153]=1,sl[153]=0,al[153]=1,ll[102]=0,pl[102]=-1,fl[102]=1,_l[102]=1,vl[102]=0,ml[102]=0,xl[102]=0,El[102]=1,wl[102]=0,nl[102]=-1,rl[102]=0,il[102]=1,ul[155]=0,cl[155]=-1,hl[155]=0,gl[155]=1,dl[155]=0,yl[155]=1,bl[155]=0,Il[155]=1,Nl[155]=1,ol[155]=-1,sl[155]=0,al[155]=0,ll[103]=0,pl[103]=1,fl[103]=0,_l[103]=-1,vl[103]=0,ml[103]=1,xl[103]=0,El[103]=-1,wl[103]=1,nl[103]=1,rl[103]=0,il[103]=0,ul[152]=0,cl[152]=1,hl[152]=1,_l[152]=-1,vl[152]=0,ml[152]=1,gl[152]=-1,dl[152]=0,yl[152]=0,bl[152]=0,Il[152]=-1,Nl[152]=0,xl[152]=0,El[152]=-1,wl[152]=1,ol[152]=1,sl[152]=0,al[152]=1,ul[156]=0,cl[156]=-1,hl[156]=1,_l[156]=1,vl[156]=0,ml[156]=1,gl[156]=-1,dl[156]=0,yl[156]=0,bl[156]=0,Il[156]=-1,Nl[156]=0,xl[156]=0,El[156]=1,wl[156]=1,ol[156]=-1,sl[156]=0,al[156]=1,ul[137]=0,cl[137]=1,hl[137]=1,ll[137]=0,pl[137]=1,fl[137]=0,gl[137]=-1,dl[137]=0,yl[137]=0,bl[137]=0,Il[137]=-1,Nl[137]=0,nl[137]=1,rl[137]=0,il[137]=0,ol[137]=1,sl[137]=0,al[137]=1,ul[139]=0,cl[139]=1,hl[139]=1,ll[139]=0,pl[139]=-1,fl[139]=0,gl[139]=1,dl[139]=0,yl[139]=0,bl[139]=0,Il[139]=1,Nl[139]=0,nl[139]=-1,rl[139]=0,il[139]=0,ol[139]=1,sl[139]=0,al[139]=1,ul[98]=0,cl[98]=-1,hl[98]=0,ll[98]=0,pl[98]=-1,fl[98]=1,_l[98]=1,vl[98]=0,ml[98]=0,gl[98]=1,dl[98]=0,yl[98]=1,xl[98]=0,El[98]=1,wl[98]=0,nl[98]=-1,rl[98]=0,il[98]=1,ul[99]=0,cl[99]=1,hl[99]=0,ll[99]=0,pl[99]=-1,fl[99]=1,_l[99]=1,vl[99]=0,ml[99]=0,gl[99]=-1,dl[99]=0,yl[99]=1,xl[99]=0,El[99]=-1,wl[99]=0,nl[99]=1,rl[99]=0,il[99]=1,ll[38]=0,pl[38]=-1,fl[38]=1,_l[38]=1,vl[38]=0,ml[38]=0,bl[38]=0,Il[38]=1,Nl[38]=1,xl[38]=0,El[38]=1,wl[38]=0,nl[38]=-1,rl[38]=0,il[38]=1,ol[38]=-1,sl[38]=0,al[38]=0,ll[39]=0,pl[39]=1,fl[39]=1,_l[39]=-1,vl[39]=0,ml[39]=0,bl[39]=0,Il[39]=-1,Nl[39]=1,xl[39]=0,El[39]=1,wl[39]=0,nl[39]=-1,rl[39]=0,il[39]=1,ol[39]=1,sl[39]=0,al[39]=0;var Cl=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Sl=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Ml=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Ll=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Pl=function(t){
return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},Ol=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Rl=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},Tl=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Al=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Dl=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Fl=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},ql=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Gl=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Bl=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},kl=function(){return[[0,0],[0,1],[1,1],[1,0]]},zl=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},jl=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Xl=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Ul=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Yl=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Vl=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Hl=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Wl=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Jl=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Zl=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Kl=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Ql=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},$l=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},tp=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ep=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},np=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},rp=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ip=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},op=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},sp=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ap=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},up=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},cp=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},hp=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},lp=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},pp=[],fp=[],gp=[],dp=[],yp=[],_p=[],vp=[],mp=[];dp[1]=yp[1]=18,dp[169]=yp[169]=18,gp[4]=fp[4]=12,gp[166]=fp[166]=12,pp[16]=mp[16]=4,pp[154]=mp[154]=4,_p[64]=vp[64]=22,_p[106]=vp[106]=22,gp[2]=_p[2]=17,dp[2]=yp[2]=18,gp[168]=_p[168]=17,dp[168]=yp[168]=18,pp[8]=dp[8]=9,fp[8]=gp[8]=12,pp[162]=dp[162]=9,fp[162]=gp[162]=12,pp[32]=mp[32]=4,fp[32]=vp[32]=1,pp[138]=mp[138]=4,fp[138]=vp[138]=1,yp[128]=mp[128]=21,_p[128]=vp[128]=22,yp[42]=mp[42]=21,_p[42]=vp[42]=22,fp[5]=yp[5]=14,fp[165]=yp[165]=14,gp[20]=mp[20]=6,gp[150]=mp[150]=6,pp[80]=_p[80]=11,pp[90]=_p[90]=11,dp[65]=vp[65]=3,dp[105]=vp[105]=3,pp[160]=_p[160]=11,fp[160]=yp[160]=14,pp[10]=_p[10]=11,fp[10]=yp[10]=14,gp[130]=mp[130]=6,dp[130]=vp[130]=3,gp[40]=mp[40]=6,dp[40]=vp[40]=3,fp[101]=vp[101]=1,fp[69]=vp[69]=1,yp[149]=mp[149]=21,yp[21]=mp[21]=21,gp[86]=_p[86]=17,gp[84]=_p[84]=17,pp[89]=dp[89]=9,pp[81]=dp[81]=9,pp[96]=vp[96]=0,fp[96]=_p[96]=15,pp[74]=vp[74]=0,fp[74]=_p[74]=15,pp[24]=gp[24]=8,dp[24]=mp[24]=7,pp[146]=gp[146]=8,dp[146]=mp[146]=7,fp[6]=_p[6]=15,gp[6]=yp[6]=16,fp[164]=_p[164]=15,gp[164]=yp[164]=16,dp[129]=mp[129]=7,yp[129]=vp[129]=20,dp[41]=mp[41]=7,yp[41]=vp[41]=20,gp[66]=vp[66]=2,dp[66]=_p[66]=19,gp[104]=vp[104]=2,dp[104]=_p[104]=19,pp[144]=yp[144]=10,_p[144]=mp[144]=23,pp[26]=yp[26]=10,_p[26]=mp[26]=23,fp[36]=mp[36]=5,gp[36]=vp[36]=2,fp[134]=mp[134]=5,gp[134]=vp[134]=2,pp[9]=yp[9]=10,fp[9]=dp[9]=13,pp[161]=yp[161]=10,fp[161]=dp[161]=13,fp[37]=mp[37]=5,yp[37]=vp[37]=20,fp[133]=mp[133]=5,yp[133]=vp[133]=20,gp[148]=yp[148]=16,_p[148]=mp[148]=23,gp[22]=yp[22]=16,_p[22]=mp[22]=23,pp[82]=gp[82]=8,dp[82]=_p[82]=19,pp[88]=gp[88]=8,dp[88]=_p[88]=19,pp[73]=vp[73]=0,fp[73]=dp[73]=13,pp[97]=vp[97]=0,fp[97]=dp[97]=13,pp[145]=dp[145]=9,yp[145]=mp[145]=21,pp[25]=dp[25]=9,yp[25]=mp[25]=21,fp[70]=vp[70]=1,gp[70]=_p[70]=17,fp[100]=vp[100]=1,gp[100]=_p[100]=17,pp[34]=dp[34]=9,fp[34]=gp[34]=12,yp[34]=mp[34]=21,_p[34]=vp[34]=22,pp[136]=mp[136]=4,fp[136]=vp[136]=1,gp[136]=_p[136]=17,dp[136]=yp[136]=18,pp[35]=mp[35]=4,fp[35]=gp[35]=12,dp[35]=yp[35]=18,_p[35]=vp[35]=22,pp[153]=mp[153]=4,dp[153]=yp[153]=18,fp[102]=gp[102]=12,_p[102]=vp[102]=22,pp[155]=dp[155]=9,yp[155]=mp[155]=23,fp[103]=vp[103]=1,gp[103]=_p[103]=17,pp[152]=mp[152]=4,gp[152]=_p[152]=17,dp[152]=yp[152]=18,pp[156]=gp[156]=8,dp[156]=yp[156]=18,_p[156]=mp[156]=23,pp[137]=mp[137]=4,fp[137]=vp[137]=1,dp[137]=yp[137]=18,pp[139]=mp[139]=4,fp[139]=dp[139]=13,yp[139]=vp[139]=20,pp[98]=dp[98]=9,fp[98]=gp[98]=12,_p[98]=vp[98]=22,pp[99]=vp[99]=0,fp[99]=gp[99]=12,dp[99]=_p[99]=19,fp[38]=gp[38]=12,yp[38]=mp[38]=21,_p[38]=vp[38]=22,fp[39]=mp[39]=5,gp[39]=yp[39]=16,_p[39]=vp[39]=22;var xp=[];xp[1]=xp[169]=Cl,xp[4]=xp[166]=Sl,xp[16]=xp[154]=Ml,xp[64]=xp[106]=Ll,xp[168]=xp[2]=Pl,xp[162]=xp[8]=Ol,xp[138]=xp[32]=Rl,xp[42]=xp[128]=Tl,xp[5]=xp[165]=Al,xp[20]=xp[150]=Dl,xp[80]=xp[90]=Fl,xp[65]=xp[105]=ql,xp[160]=xp[10]=Gl,xp[130]=xp[40]=Bl,xp[85]=kl,xp[101]=xp[69]=zl,xp[149]=xp[21]=jl,xp[86]=xp[84]=Xl,xp[89]=xp[81]=Ul,xp[96]=xp[74]=Yl,xp[24]=xp[146]=Vl,xp[6]=xp[164]=Hl,xp[129]=xp[41]=Wl,xp[66]=xp[104]=Jl,xp[144]=xp[26]=Zl,xp[36]=xp[134]=Kl,xp[9]=xp[161]=Ql,xp[37]=xp[133]=$l,xp[148]=xp[22]=tp,xp[82]=xp[88]=ep,xp[73]=xp[97]=np,xp[145]=xp[25]=rp,xp[70]=xp[100]=ip,xp[34]=function(t){return[Tl(t),Ol(t)]},xp[35]=op,xp[136]=function(t){return[Rl(t),Pl(t)]},xp[153]=function(t){return[Ml(t),Cl(t)]},xp[102]=function(t){return[Sl(t),Ll(t)]},xp[155]=sp,xp[103]=ap,xp[152]=function(t){return[Ml(t),Pl(t)]},xp[156]=up,xp[137]=function(t){return[Rl(t),Cl(t)]},xp[139]=cp,xp[98]=function(t){return[Ol(t),Ll(t)]},xp[99]=hp,xp[38]=function(t){return[Sl(t),Tl(t)]},xp[39]=lp;var Ep=function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1};Ep.buildId=function(t){return t.join(",")},Ep.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==t.from.id})},Ep.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==t.to.id})},Ep.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},Ep.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(e,n){var r=e.to,i=n.to;if(r.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(r.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(r.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return r.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=ss(t.coordinates,r.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},Ep.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},Ep.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},Ep.prototype.addInnerEdge=function(t){this.innerEdges.push(t)};var wp=function(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)};wp.prototype.getSymetric=function(){return this.symetric||(this.symetric=new wp(this.to,this.from),this.symetric.symetric=this),this.symetric},wp.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},wp.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},wp.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},wp.prototype.toLineString=function(){return a([this.from.coordinates,this.to.coordinates])},wp.prototype.compareTo=function(t){return ss(t.from.coordinates,t.to.coordinates,this.to.coordinates)};var bp=function(){this.edges=[],this.polygon=void 0,this.envelope=void 0},Ip={length:{configurable:!0}};bp.prototype.push=function(t){this[this.edges.length]=t,this.edges.push(t),this.polygon=this.envelope=void 0},bp.prototype.get=function(t){return this.edges[t]},Ip.length.get=function(){return this.edges.length},bp.prototype.forEach=function(t){this.edges.forEach(t)},bp.prototype.map=function(t){return this.edges.map(t)},bp.prototype.some=function(t){return this.edges.some(t)},bp.prototype.isValid=function(){return!0},bp.prototype.isHole=function(){var t=this,e=this.edges.reduce(function(e,n,r){return n.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e},0),n=(0===e?this.length:e)-1,r=(e+1)%this.length,i=ss(this.edges[n].from.coordinates,this.edges[e].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},bp.prototype.toMultiPoint=function(){return l(this.edges.map(function(t){return t.from.coordinates}))},bp.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(t){return t.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=o([t])},bp.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=pn(this.toPolygon())},bp.findEdgeRingContaining=function(t,e){var n,i,o=t.getEnvelope();return e.forEach(function(e){var s=e.getEnvelope();if(i&&(n=i.getEnvelope()),!as(s,o)&&us(s,o)){var a=t.map(function(t){return t.from.coordinates}).find(function(t){return!e.some(function(e){return cs(t,e.from.coordinates)})});a&&e.inside(r(a))&&(i&&!us(n,s)||(i=e))}}),i},bp.prototype.inside=function(t){return ue(t,this.toPolygon())},Object.defineProperties(bp.prototype,Ip);var Np=function(){this.edges=[],this.nodes={}};Np.fromGeoJson=function(t){hs(t);var e=new Np;return X(t,function(t){tt(t,"LineString","Graph::fromGeoJson"),D(t,function(t,n){if(t){var r=e.getNode(t),i=e.getNode(n);e.addEdge(r,i)}return n})}),e},Np.prototype.getNode=function(t){var e=Ep.buildId(t),n=this.nodes[e];return n||(n=this.nodes[e]=new Ep(t)),n},Np.prototype.addEdge=function(t,e){var n=new wp(t,e),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},Np.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(e){return t.nodes[e]}).forEach(function(e){return t._removeIfDangle(e)})},Np.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map(function(t){return t.to});this.removeNode(t),n.forEach(function(t){return e._removeIfDangle(t)})}},Np.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))})},Np.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach(function(t){return e._computeNextCWEdges(e.nodes[t])}):t.getOuterEdges().forEach(function(e,n){t.getOuterEdge((0===n?t.getOuterEdges().length:n)-1).symetric.next=e})},Np.prototype._computeNextCCWEdges=function(t,e){for(var n,r,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var s=i[o],a=s.symetric,u=void 0,c=void 0;s.label===e&&(u=s),a.label===e&&(c=a),u&&c&&(c&&(r=c),u&&(r&&(r.next=u,r=void 0),n||(n=u)))}r&&(r.next=n)},Np.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach(function(n){if(!(n.label>=0)){t.push(n);var r=n;do{r.label=e,r=r.next}while(!n.isEqual(r));e++}}),t},Np.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(t){t.label=void 0}),this._findLabeledEdgeRings().forEach(function(e){t._findIntersectionNodes(e).forEach(function(n){t._computeNextCCWEdges(n,e.label)})});var e=[];return this.edges.forEach(function(n){n.ring||e.push(t._findEdgeRing(n))}),e},Np.prototype._findIntersectionNodes=function(t){var e=[],n=t;do{!function(){var r=0;n.from.getOuterEdges().forEach(function(e){e.label===t.label&&++r}),r>1&&e.push(n.from),n=n.next}()}while(!t.isEqual(n));return e},Np.prototype._findEdgeRing=function(t){var e=t,n=new bp;do{n.push(e),e.ring=n,e=e.next}while(!t.isEqual(e));return n},Np.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach(function(t){return e.removeEdge(t)}),t.innerEdges.forEach(function(t){return e.removeEdge(t)}),delete this.nodes[t.id]},Np.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(e){return!e.isEqual(t)}),t.deleteEdge()};var Cp=qt(function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}e=t.exports="function"==typeof Object.keys?Object.keys:n,e.shim=n}),Sp=(Cp.shim,qt(function(t,e){function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function r(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();e=t.exports=i?n:r,e.supported=n,e.unsupported=r})),Mp=(Sp.supported,Sp.unsupported,qt(function(t){function e(t){return null===t||void 0===t}function n(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function r(t,r,s){var a,u;if(e(t)||e(r))return!1;if(t.prototype!==r.prototype)return!1;if(Sp(t))return!!Sp(r)&&(t=i.call(t),r=i.call(r),o(t,r,s));if(n(t)){if(!n(r))return!1;if(t.length!==r.length)return!1;for(a=0;a<t.length;a++)if(t[a]!==r[a])return!1;return!0}try{var c=Cp(t),h=Cp(r)}catch(t){return!1}if(c.length!=h.length)return!1;for(c.sort(),h.sort(),a=c.length-1;a>=0;a--)if(c[a]!=h[a])return!1;for(a=c.length-1;a>=0;a--)if(u=c[a],!o(t[u],r[u],s))return!1;return typeof t==typeof r}var i=Array.prototype.slice,o=t.exports=function(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?n.strict?t===e:t==e:r(t,e,n))}})),Lp=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:Bs};Lp.prototype.compare=function(t,e){if(t.type!==e.type||!Gs(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,r=qs(t),i=qs(e);return r.every(function(t){return this.some(function(e){return n.compare(t,e)})},i)}}return!1},Lp.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},Lp.prototype.compareLine=function(t,e,n,r){if(!Gs(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[n],o[n]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},Lp.prototype.fixStartIndex=function(t,e){for(var n,r=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){r=i;break}return r>=0&&(n=[].concat(t.slice(r,t.length),t.slice(1,r+1))),n},Lp.prototype.comparePath=function(t,e){var n=this;return t.every(function(t,e){return n.compareCoord(t,this[e])},e)},Lp.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),i=this;return n.every(function(t){return this.some(function(e){return i.compareLine(t,e,1,!0)})},r)}return!1},Lp.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},Lp.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},Lp.prototype.removePseudo=function(t){return t};var Pp=Lp,Op=qt(function(t){function e(t,e,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,n,r)}e.prototype.run=function(t,e,n,r){this._init(t,e,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(i,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],n=0;n<this._datasetLength;n++){this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n)}return e},e.prototype._mergeArrays=function(t,e){for(var n=e.length,r=0;r<n;r++){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)}),Rp=qt(function(t){function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(h),a=0,u=0;u<h;u++)s[u]=0;for(var c=0;c<n;c++){var h=this.dataset[c].length;if(o===this.assignments[c]){for(var u=0;u<h;u++)s[u]+=this.dataset[c][u];a++}}if(a>0){for(var u=0;u<h;u++)s[u]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,r=0;r<n;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)t=this.assignments[n],void 0===e[t]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var r,i=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(r=n(t,e[a]))<i&&(i=r,o=a);return o},e.prototype.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)},t.exports&&(t.exports=e)}),Tp=qt(function(t){function e(t,e,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,n)}e.prototype.insert=function(t,e){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?e>i&&(n=r):e<i&&(n=r)}this._insertAt(t,e,n)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;){if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this._queue.length;e<n;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,n){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}n&&(this._sorting=n)},e.prototype._insertAt=function(t,e,n){this._queue.length===n?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(n,0,t),this._priorities.splice(n,0,e))},t.exports&&(t.exports=e)}),Ap=qt(function(t){function e(t,e,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,n,r)}if(t.exports)var n=Tp;e.prototype.run=function(t,e,r,i){this._init(t,e,r,i);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var u=new n(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,u),this._expandCluster(a,u))}return this.clusters},e.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this._orderedList.length;e<n;e++){var r=this._orderedList[e],i=this._reachability[r];t.push([r,i])}return t},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._updateQueue=function(t,e,n){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach(function(e){if(void 0===r._processed[e]){var i=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,i);void 0===r._reachability[e]?(r._reachability[e]=o,n.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,n.remove(e),n.insert(e,o))}})},e.prototype._expandCluster=function(t,e){for(var n=e.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},e.prototype._distanceToCore=function(t){for(var e=this.epsilon,n=0;n<e;n++){if(this._regionQuery(t,n).length>=this.minPts)return n}},e.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[t],this.dataset[r])<e&&n.push(r);return n},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)}),Dp=qt(function(t){t.exports&&(t.exports={DBSCAN:Op,KMEANS:Rp,OPTICS:Ap,PriorityQueue:Tp})}),Fp=(Dp.DBSCAN,Dp.KMEANS,Dp.OPTICS,Dp.PriorityQueue,{eudist:function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++){var s=(t[o]||0)-(e[o]||0);i+=s*s}return n?Math.sqrt(i):i},mandist:function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++)i+=Math.abs((t[o]||0)-(e[o]||0));return n?Math.sqrt(i):i},dist:function(t,e,n){var r=Math.abs(t-e);return n?r:r*r}}),qp=Fp.eudist,Gp=Fp.dist,Bp={kmrand:function(t,e){for(var n={},r=[],i=e<<2,o=t.length,s=t[0].length>0;r.length<e&&i-- >0;){var a=t[Math.floor(Math.random()*o)],u=s?a.join("_"):""+a;n[u]||(n[u]=!0,r.push(a))}if(r.length<e)throw new Error("Error initializating clusters");return r},kmpp:function(t,e){var n=t[0].length?qp:Gp,r=[],i=t.length,o=t[0].length>0,s=t[Math.floor(Math.random()*i)];o&&s.join("_");for(r.push(s);r.length<e;){for(var a=[],u=r.length,c=0,h=[],l=0;l<i;l++){for(var p=1/0,f=0;f<u;f++){var g=n(t[l],r[f]);g<=p&&(p=g)}a[l]=p}for(var d=0;d<i;d++)c+=a[d];for(var y=0;y<i;y++)h[y]={i:y,v:t[y],pr:a[y]/c,cs:0};h.sort(function(t,e){return t.pr-e.pr}),h[0].cs=h[0].pr;for(var _=1;_<i;_++)h[_].cs=h[_-1].cs+h[_].pr;for(var v=Math.random(),m=0;m<i-1&&h[m++].cs<v;);r.push(h[m-1].v)}return r}},kp=Fp.eudist,zp=Bp.kmrand,jp=Bp.kmpp,Xp=1e4,Up=Us,Yp={search:function(t,e,n,r){t.cleanDirty(),r=r||{};var i=r.heuristic||Yp.heuristics.manhattan,o=r.closest||!1,s=Zs(),a=e;for(e.h=i(e,n),s.push(e);s.size()>0;){var u=s.pop();if(u===n)return Js(u);u.closed=!0;for(var c=t.neighbors(u),h=0,l=c.length;h<l;++h){var p=c[h];if(!p.closed&&!p.isWall()){var f=u.g+p.getCost(u),g=p.visited;(!g||f<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,n),p.g=f,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<a.h||p.h===a.h&&p.g<a.g)&&(a=p),g?s.rescoreElement(p):s.push(p))}}}return o?Js(a):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var n=Math.sqrt(2),r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};Ks.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)Yp.cleanNode(this.nodes[t])},Ks.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)Yp.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Ks.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Ks.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},Ks.prototype.toString=function(){for(var t,e,n,r,i=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],e=o[s],n=0,r=e.length;n<r;n++)t.push(e[n].weight);i.push(t.join(" "))}return i.join("\n")},Qs.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Qs.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Qs.prototype.isWall=function(){return 0===this.weight},$s.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i,o=t+1<<1,s=o-1,a=null;if(s<e){var u=this.content[s];i=this.scoreFunction(u),i<r&&(a=s)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===a?r:i)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}};var Vp=function(t){return function(){return t}};ia.prototype={constructor:ia,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ua(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(sa(this,n),t=n,n=t.U),n.C=!1,r.C=!0,aa(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(aa(this,n),t=n,n=t.U),n.C=!1,r.C=!0,sa(this,r))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,s=t.R;if(n=o?s?ua(s):o:s,i?i.L===t?i.L=n:i.R=n:this._=n,o&&s?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==s?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=s,s.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===i.L){if(e=i.R,e.C&&(e.C=!1,i.C=!0,sa(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,aa(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,sa(this,i),t=this._;break}}else if(e=i.L,e.C&&(e.C=!1,i.C=!0,aa(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,sa(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,aa(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var Hp,Wp,Jp,Zp,Kp,Qp=[],$p=[],tf=1e-6,ef=1e-12;Ta.prototype={constructor:Ta,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(n){return _a(e,t[n])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){if(o=(i=n.halfedges).length)for(var i,o,s,a=n.site,u=-1,c=e[i[o-1]],h=c.left===a?c.right:c.left;++u<o;)s=h,c=e[i[u]],h=c.left===a?c.right:c.left,s&&h&&r<s.index&&r<h.index&&Oa(a,s,h)<0&&t.push([a.data,s.data,h.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){for(var r,i,o=this,s=o._found||0,a=o.cells.length;!(i=o.cells[s]);)if(++s>=a)return null;var u=t-i.site[0],c=e-i.site[1],h=u*u+c*c;do{i=o.cells[r=s],s=null,i.halfedges.forEach(function(n){var r=o.edges[n],a=r.left;if(a!==i.site&&a||(a=r.right)){var u=t-a[0],c=e-a[1],l=u*u+c*c;l<h&&(h=l,s=a.index)}})}while(null!==s);return o._found=r,null==n||h<=n*n?i.site:null}};var nf=function(){function t(t){return new Ta(t.map(function(r,i){var o=[Math.round(e(r,i,t)/tf)*tf,Math.round(n(r,i,t)/tf)*tf];return o.index=i,o.data=r,o}),r)}var e=na,n=ra,r=null;return t.polygons=function(e){return t(e).polygons()},t.links=function(e){return t(e).links()},t.triangles=function(e){return t(e).triangles()},t.x=function(n){return arguments.length?(e="function"==typeof n?n:Vp(+n),t):e},t.y=function(e){return arguments.length?(n="function"==typeof e?e:Vp(+e),t):n},t.extent=function(e){return arguments.length?(r=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],t):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},t.size=function(e){return arguments.length?(r=null==e?null:[[0,0],[+e[0],+e[1]]],t):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},t},rf=Object.freeze({randomPosition:Xa,randomPoint:Ua,randomPolygon:Ya,randomLineString:Va}),of=Object.freeze({getCluster:Qa,clusterEach:$a,clusterReduce:tu,createBins:eu,applyFilter:nu,propertiesContainsFilter:ru,filterProperties:iu})
;"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(void 0===this||null===this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments?parseInt(Number(arguments[1]),10)||0:0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!==t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var sf=function(){};sf.prototype.interfaces_=function(){return[]},sf.prototype.getClass=function(){return sf},sf.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var af=function(){},uf=function(){},cf={MAX_VALUE:{configurable:!0}};uf.isNaN=function(t){return Number.isNaN(t)},uf.doubleToLongBits=function(t){return t},uf.longBitsToDouble=function(t){return t},uf.isInfinite=function(t){return!Number.isFinite(t)},cf.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(uf,cf);var hf=function(){},lf=function(){},pf=function(){},ff=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},gf={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};ff.prototype.setOrdinate=function(t,e){switch(t){case ff.X:this.x=e;break;case ff.Y:this.y=e;break;case ff.Z:this.z=e;break;default:throw new af("Invalid ordinate index: "+t)}},ff.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!sf.equalsWithTolerance(this.x,e.x,n)&&!!sf.equalsWithTolerance(this.y,e.y,n)}},ff.prototype.getOrdinate=function(t){switch(t){case ff.X:return this.x;case ff.Y:return this.y;case ff.Z:return this.z}throw new af("Invalid ordinate index: "+t)},ff.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||uf.isNaN(this.z))&&uf.isNaN(t.z)},ff.prototype.equals=function(t){return t instanceof ff&&this.equals2D(t)},ff.prototype.equalInZ=function(t,e){return sf.equalsWithTolerance(this.z,t.z,e)},ff.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},ff.prototype.clone=function(){},ff.prototype.copy=function(){return new ff(this)},ff.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},ff.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)},ff.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},ff.prototype.hashCode=function(){var t=17;return t=37*t+ff.hashCode(this.x),t=37*t+ff.hashCode(this.y)},ff.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},ff.prototype.interfaces_=function(){return[hf,lf,ou]},ff.prototype.getClass=function(){return ff},ff.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=uf.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},gf.DimensionalComparator.get=function(){return df},gf.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},gf.NULL_ORDINATE.get=function(){return uf.NaN},gf.X.get=function(){return 0},gf.Y.get=function(){return 1},gf.Z.get=function(){return 2},Object.defineProperties(ff,gf);var df=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new af("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};df.prototype.compare=function(t,e){var n=t,r=e,i=df.compare(n.x,r.x);if(0!==i)return i;var o=df.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:df.compare(n.z,r.z)},df.prototype.interfaces_=function(){return[pf]},df.prototype.getClass=function(){return df},df.compare=function(t,e){return t<e?-1:t>e?1:uf.isNaN(t)?uf.isNaN(e)?0:-1:uf.isNaN(e)?1:0};var yf=function(){};yf.prototype.create=function(){},yf.prototype.interfaces_=function(){return[]},yf.prototype.getClass=function(){return yf};var _f=function(){},vf={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};_f.prototype.interfaces_=function(){return[]},_f.prototype.getClass=function(){return _f},_f.toLocationSymbol=function(t){switch(t){case _f.EXTERIOR:return"e";case _f.BOUNDARY:return"b";case _f.INTERIOR:return"i";case _f.NONE:return"-"}throw new af("Unknown location value: "+t)},vf.INTERIOR.get=function(){return 0},vf.BOUNDARY.get=function(){return 1},vf.EXTERIOR.get=function(){return 2},vf.NONE.get=function(){return-1},Object.defineProperties(_f,vf);var mf=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},xf=function(){},Ef={LOG_10:{configurable:!0}};xf.prototype.interfaces_=function(){return[]},xf.prototype.getClass=function(){return xf},xf.log10=function(t){var e=Math.log(t);return uf.isInfinite(e)?e:uf.isNaN(e)?e:e/xf.LOG_10},xf.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i},xf.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},xf.wrap=function(t,e){return t<0?e- -t%e:t%e},xf.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=i;return o>u&&(u=o),s>u&&(u=s),a>u&&(u=a),u}},xf.average=function(t,e){return(t+e)/2},Ef.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(xf,Ef);var wf=function(t){this.str=t};wf.prototype.append=function(t){this.str+=t},wf.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},wf.prototype.toString=function(t){return this.str};var bf=function(t){this.value=t};bf.prototype.intValue=function(){return this.value},bf.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},bf.isNaN=function(t){return Number.isNaN(t)};var If=function(){};If.isWhitespace=function(t){return t<=32&&t>=0||127===t},If.toUpperCase=function(t){return t.toUpperCase()};var Nf=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var r=arguments[0];t.call(this,t.parse(r))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i,o)}},Cf={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Nf.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},Nf.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=Nf.magnitude(n._hi),i=Nf.TEN.pow(r);n=n.divide(i),n.gt(Nf.TEN)?(n=n.divide(Nf.TEN),r+=1):n.lt(Nf.ONE)&&(n=n.multiply(Nf.TEN),r-=1);for(var o=r+1,s=new wf,a=Nf.MAX_PRINT_DIGITS-1,u=0;u<=a;u++){t&&u===o&&s.append(".");var c=Math.trunc(n._hi);if(c<0)break;var h=!1,l=0;c>9?(h=!0,l="9"):l="0"+c,s.append(l),n=n.subtract(Nf.valueOf(c)).multiply(Nf.TEN),h&&n.selfAdd(Nf.TEN);var p=!0,f=Nf.magnitude(n._hi);if(f<0&&Math.abs(f)>=a-u&&(p=!1),!p)break}return e[0]=r,s.toString()},Nf.prototype.sqr=function(){return this.multiply(this)},Nf.prototype.doubleValue=function(){return this._hi+this._lo},Nf.prototype.subtract=function(){if(arguments[0]instanceof Nf){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},Nf.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},Nf.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Nf.prototype.selfSubtract=function(){if(arguments[0]instanceof Nf){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},Nf.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Nf.prototype.min=function(t){return this.le(t)?this:t},Nf.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Nf){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,c=null,h=null,l=null;return u=this._hi/n,c=Nf.SPLIT*u,i=c-u,l=Nf.SPLIT*n,i=c-i,o=u-i,s=l-n,h=u*n,s=l-s,a=n-s,l=i*s-h+i*a+o*s+o*a,c=(this._hi-h-l+this._lo-u*r)/n,l=u+c,this._hi=l,this._lo=u-l+c,this}},Nf.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Nf.prototype.divide=function(){if(arguments[0]instanceof Nf){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,s=null,a=null,u=null;o=this._hi/t._hi,s=Nf.SPLIT*o,e=s-o,u=Nf.SPLIT*t._hi,e=s-e,n=o-e,r=u-t._hi,a=o*t._hi,r=u-r,i=t._hi-r,u=e*r-a+e*i+n*r+n*i,s=(this._hi-a-u+this._lo-o*t._lo)/t._hi,u=o+s;return new Nf(u,o-u+s)}if("number"==typeof arguments[0]){var c=arguments[0];return uf.isNaN(c)?Nf.createNaN():Nf.copy(this).selfDivide(c,0)}},Nf.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},Nf.prototype.pow=function(t){if(0===t)return Nf.valueOf(1);var e=new Nf(this),n=Nf.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},Nf.prototype.ceil=function(){if(this.isNaN())return Nf.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new Nf(t,e)},Nf.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},Nf.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Nf.prototype.setValue=function(){if(arguments[0]instanceof Nf){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},Nf.prototype.max=function(t){return this.ge(t)?this:t},Nf.prototype.sqrt=function(){if(this.isZero())return Nf.valueOf(0);if(this.isNegative())return Nf.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=Nf.valueOf(e),r=this.subtract(n.sqr()),i=r._hi*(.5*t);return n.add(i)},Nf.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Nf){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,r=null,i=null,o=null,s=null,a=null;return i=this._hi+e,s=i-this._hi,o=i-s,o=e-s+(this._hi-o),a=o+this._lo,n=i+a,r=a+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var u=arguments[0],c=arguments[1],h=null,l=null,p=null,f=null,g=null,d=null,y=null,_=null;g=this._hi+u,p=this._lo+c,y=g-this._hi,_=p-this._lo,d=g-y,f=p-_,d=u-y+(this._hi-d),f=c-_+(this._lo-f),y=d+p,h=g+y,l=y+(g-h),y=f+l;var v=h+y,m=y+(h-v);return this._hi=v,this._lo=m,this}},Nf.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Nf){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,c=null;u=Nf.SPLIT*this._hi,i=u-this._hi,c=Nf.SPLIT*n,i=u-i,o=this._hi-i,s=c-n,u=this._hi*n,s=c-s,a=n-s,c=i*s-u+i*a+o*s+o*a+(this._hi*r+this._lo*n);var h=u+c;i=u-h;var l=c+i;return this._hi=h,this._lo=l,this}},Nf.prototype.selfSqr=function(){return this.selfMultiply(this)},Nf.prototype.floor=function(){if(this.isNaN())return Nf.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new Nf(t,e)},Nf.prototype.negate=function(){return this.isNaN()?this:new Nf(-this._hi,-this._lo)},Nf.prototype.clone=function(){},Nf.prototype.multiply=function(){if(arguments[0]instanceof Nf){var t=arguments[0];return t.isNaN()?Nf.createNaN():Nf.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return uf.isNaN(e)?Nf.createNaN():Nf.copy(this).selfMultiply(e,0)}},Nf.prototype.isNaN=function(){return uf.isNaN(this._hi)},Nf.prototype.intValue=function(){return Math.trunc(this._hi)},Nf.prototype.toString=function(){var t=Nf.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},Nf.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+Nf.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length,s=Nf.stringOfChar("0",o);i=n+s+".0"}return this.isNegative()?"-"+i:i},Nf.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,o=null,s=null,a=null;i=1/this._hi,o=Nf.SPLIT*i,t=o-i,a=Nf.SPLIT*this._hi,t=o-t,e=i-t,n=a-this._hi,s=i*this._hi,n=a-n,r=this._hi-n,a=t*n-s+t*r+e*n+e*r,o=(1-s-a-i*this._lo)/this._hi;var u=i+o;return new Nf(u,i-u+o)},Nf.prototype.toSciNotation=function(){if(this.isZero())return Nf.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=Nf.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},Nf.prototype.abs=function(){return this.isNaN()?Nf.NaN:this.isNegative()?this.negate():new Nf(this)},Nf.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Nf.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},Nf.prototype.add=function(){if(arguments[0]instanceof Nf){var t=arguments[0];return Nf.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return Nf.copy(this).selfAdd(e)}},Nf.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Nf){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},Nf.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},Nf.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Nf.prototype.trunc=function(){return this.isNaN()?Nf.NaN:this.isPositive()?this.floor():this.ceil()},Nf.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Nf.prototype.interfaces_=function(){return[ou,hf,lf]},Nf.prototype.getClass=function(){return Nf},Nf.sqr=function(t){return Nf.valueOf(t).selfMultiply(t)},Nf.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return Nf.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new Nf(e)}},Nf.sqrt=function(t){return Nf.valueOf(t).sqrt()},Nf.parse=function(t){for(var e=0,n=t.length;If.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(r=!0))}for(var o=new Nf,s=0,a=0,u=0;;){if(e>=n)break;var c=t.charAt(e);if(e++,If.isDigit(c)){var h=c-"0";o.selfMultiply(Nf.TEN),o.selfAdd(h),s++}else{if("."!==c){if("e"===c||"E"===c){var l=t.substring(e);try{u=bf.parseInt(l)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+l+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}a=s}}var p=o,f=s-a-u;if(0===f)p=o;else if(f>0){var g=Nf.TEN.pow(f);p=o.divide(g)}else if(f<0){var d=Nf.TEN.pow(-f);p=o.multiply(d)}return r?p.negate():p},Nf.createNaN=function(){return new Nf(uf.NaN,uf.NaN)},Nf.copy=function(t){return new Nf(t)},Nf.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=e&&(r+=1),r},Nf.stringOfChar=function(t,e){for(var n=new wf,r=0;r<e;r++)n.append(t);return n.toString()},Cf.PI.get=function(){return new Nf(3.141592653589793,1.2246467991473532e-16)},Cf.TWO_PI.get=function(){return new Nf(6.283185307179586,2.4492935982947064e-16)},Cf.PI_2.get=function(){return new Nf(1.5707963267948966,6.123233995736766e-17)},Cf.E.get=function(){return new Nf(2.718281828459045,1.4456468917292502e-16)},Cf.NaN.get=function(){return new Nf(uf.NaN,uf.NaN)},Cf.EPS.get=function(){return 1.23259516440783e-32},Cf.SPLIT.get=function(){return 134217729},Cf.MAX_PRINT_DIGITS.get=function(){return 32},Cf.TEN.get=function(){return Nf.valueOf(10)},Cf.ONE.get=function(){return Nf.valueOf(1)},Cf.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Cf.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Nf,Cf);var Sf=function(){},Mf={DP_SAFE_EPSILON:{configurable:!0}};Sf.prototype.interfaces_=function(){return[]},Sf.prototype.getClass=function(){return Sf},Sf.orientationIndex=function(t,e,n){var r=Sf.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=Nf.valueOf(e.x).selfAdd(-t.x),o=Nf.valueOf(e.y).selfAdd(-t.y),s=Nf.valueOf(n.x).selfAdd(-e.x),a=Nf.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},Sf.signOfDet2x2=function(t,e,n,r){return t.multiply(r).selfSubtract(e.multiply(n)).signum()},Sf.intersection=function(t,e,n,r){var i=Nf.valueOf(r.y).selfSubtract(n.y).selfMultiply(Nf.valueOf(e.x).selfSubtract(t.x)),o=Nf.valueOf(r.x).selfSubtract(n.x).selfMultiply(Nf.valueOf(e.y).selfSubtract(t.y)),s=i.subtract(o),a=Nf.valueOf(r.x).selfSubtract(n.x).selfMultiply(Nf.valueOf(t.y).selfSubtract(n.y)),u=Nf.valueOf(r.y).selfSubtract(n.y).selfMultiply(Nf.valueOf(t.x).selfSubtract(n.x)),c=a.subtract(u),h=c.selfDivide(s).doubleValue(),l=Nf.valueOf(t.x).selfAdd(Nf.valueOf(e.x).selfSubtract(t.x).selfMultiply(h)).doubleValue(),p=Nf.valueOf(e.x).selfSubtract(t.x).selfMultiply(Nf.valueOf(t.y).selfSubtract(n.y)),f=Nf.valueOf(e.y).selfSubtract(t.y).selfMultiply(Nf.valueOf(t.x).selfSubtract(n.x)),g=p.subtract(f),d=g.selfDivide(s).doubleValue(),y=Nf.valueOf(n.y).selfAdd(Nf.valueOf(r.y).selfSubtract(n.y).selfMultiply(d)).doubleValue();return new ff(l,y)},Sf.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),s=i-o;if(i>0){if(o<=0)return Sf.signum(s);r=i+o}else{if(!(i<0))return Sf.signum(s);if(o>=0)return Sf.signum(s);r=-i-o}var a=Sf.DP_SAFE_EPSILON*r;return s>=a||-s>=a?Sf.signum(s):2},Sf.signum=function(t){return t>0?1:t<0?-1:0},Mf.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Sf,Mf);var Lf=function(){},Pf={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Pf.X.get=function(){return 0},Pf.Y.get=function(){return 1},Pf.Z.get=function(){return 2},Pf.M.get=function(){return 3},Lf.prototype.setOrdinate=function(t,e,n){},Lf.prototype.size=function(){},Lf.prototype.getOrdinate=function(t,e){},Lf.prototype.getCoordinate=function(){},Lf.prototype.getCoordinateCopy=function(t){},Lf.prototype.getDimension=function(){},Lf.prototype.getX=function(t){},Lf.prototype.clone=function(){},Lf.prototype.expandEnvelope=function(t){},Lf.prototype.copy=function(){},Lf.prototype.getY=function(t){},Lf.prototype.toCoordinateArray=function(){},Lf.prototype.interfaces_=function(){return[lf]},Lf.prototype.getClass=function(){return Lf},Object.defineProperties(Lf,Pf);var Of=function(){},Rf=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Of),Tf=function(){};Tf.arraycopy=function(t,e,n,r,i){for(var o=0,s=e;s<e+i;s++)n[r+o]=t[s],o++},Tf.getProperty=function(t){return{"line.separator":"\n"}[t]};var Af=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof ff&&arguments[1]instanceof ff){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2];this.x=u,this.y=c,this.w=h}else if(4===arguments.length){var l=arguments[0],p=arguments[1],f=arguments[2],g=arguments[3],d=l.y-p.y,y=p.x-l.x,_=l.x*p.y-p.x*l.y,v=f.y-g.y,m=g.x-f.x,x=f.x*g.y-g.x*f.y;this.x=y*x-m*_,this.y=v*_-d*x,this.w=d*m-v*y}};Af.prototype.getY=function(){var t=this.y/this.w;if(uf.isNaN(t)||uf.isInfinite(t))throw new Rf;return t},Af.prototype.getX=function(){var t=this.x/this.w;if(uf.isNaN(t)||uf.isInfinite(t))throw new Rf;return t},Af.prototype.getCoordinate=function(){var t=new ff;return t.x=this.getX(),t.y=this.getY(),t},Af.prototype.interfaces_=function(){return[]},Af.prototype.getClass=function(){return Af},Af.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=n.y-r.y,u=r.x-n.x,c=n.x*r.y-r.x*n.y,h=o*c-u*s,l=a*s-i*c,p=i*u-a*o,f=h/p,g=l/p;if(uf.isNaN(f)||uf.isInfinite(f)||uf.isNaN(g)||uf.isInfinite(g))throw new Rf;return new ff(f,g)};var Df=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof ff){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],u=arguments[3];this.init(o,s,a,u)}},Ff={serialVersionUID:{configurable:!0}};Df.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Df.prototype.equals=function(t){if(!(t instanceof Df))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},Df.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Df;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Df(e,r,n,i)},Df.prototype.isNull=function(){return this._maxx<this._minx},Df.prototype.getMaxX=function(){return this._maxx},Df.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof ff){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Df){var e=arguments[0];return!this.isNull()&&!e.isNull()&&(e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&(n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy)}},Df.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Df){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof ff){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},Df.prototype.getMinY=function(){return this._miny},Df.prototype.getMinX=function(){return this._minx},Df.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof ff){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Df){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},Df.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Df.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Df.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},Df.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Df.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Df.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Df.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Df.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Df.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Df.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Df){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof ff){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},Df.prototype.centre=function(){return this.isNull()?null:new ff((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Df.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof ff){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Df){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},Df.prototype.getMaxY=function(){return this._maxy},Df.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},Df.prototype.hashCode=function(){var t=17;return t=37*t+ff.hashCode(this._minx),t=37*t+ff.hashCode(this._maxx),t=37*t+ff.hashCode(this._miny),t=37*t+ff.hashCode(this._maxy)},Df.prototype.interfaces_=function(){return[hf,ou]},Df.prototype.getClass=function(){return Df},Df.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),u=Math.max(o.x,s.x),c=Math.min(r.x,i.x),h=Math.max(r.x,i.x);return!(c>u)&&(!(h<a)&&(a=Math.min(o.y,s.y),u=Math.max(o.y,s.y),c=Math.min(r.y,i.y),h=Math.max(r.y,i.y),!(c>u)&&!(h<a)))}},Ff.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Df,Ff);var qf={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Gf=function(t){this.geometryFactory=t||new ud};Gf.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=qf.typeStr.exec(t);if(-1!==t.search("EMPTY")&&(i=qf.emptyTypeStr.exec(t),i[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],kf[n]&&(e=kf[n].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Gf.prototype.write=function(t){return this.extractGeometry(t)},Gf.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Bf[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+Bf[e].apply(this,[t])+")"};var Bf={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Bf.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+Bf.point.apply(e,[t._geometries[r]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(Bf.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(Bf.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+Bf.linestring.apply(e,[t._geometries[r]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+Bf.linestring.apply(this,[t._shell])+")");for(var r=0,i=t._holes.length;r<i;++r)n.push("("+Bf.linestring.apply(e,[t._holes[r]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+Bf.polygon.apply(e,[t._geometries[r]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push(e.extractGeometry(t._geometries[r]));return n.join(",")}},kf={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(qf.spaces);return this.geometryFactory.createPoint(new ff(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var n,r=t.trim().split(","),i=[],o=0,s=r.length;o<s;++o)n=r[o].replace(qf.trimParens,"$1"),i.push(kf.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(qf.spaces),r.push(new ff(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(qf.spaces),
r.push(new ff(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){var e=this;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var n,r=t.trim().split(qf.parenComma),i=[],o=0,s=r.length;o<s;++o)n=r[o].replace(qf.trimParens,"$1"),i.push(kf.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e=this;if(void 0===t)return this.geometryFactory.createPolygon();for(var n,r,i,o,s=t.trim().split(qf.parenComma),a=[],u=0,c=s.length;u<c;++u)n=s[u].replace(qf.trimParens,"$1"),r=kf.linestring.apply(e,[n]),i=e.geometryFactory.createLinearRing(r._points),0===u?o=i:a.push(i);return this.geometryFactory.createPolygon(o,a)},multipolygon:function(t){var e=this;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var n,r=t.trim().split(qf.doubleParenComma),i=[],o=0,s=r.length;o<s;++o)n=r[o].replace(qf.trimParens,"$1"),i.push(kf.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){var e=this;if(void 0===t)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),r=[],i=0,o=n.length;i<o;++i)r.push(e.read(n[i]));return this.geometryFactory.createGeometryCollection(r)}},zf=function(t){this.parser=new Gf(t)};zf.prototype.write=function(t){return this.parser.write(t)},zf.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var jf=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Xf=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jf),Uf=function(){};Uf.prototype.interfaces_=function(){return[]},Uf.prototype.getClass=function(){return Uf},Uf.shouldNeverReachHere=function(){if(0===arguments.length)Uf.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Xf("Should never reach here"+(null!==t?": "+t:""))}},Uf.isTrue=function(){var t,e;if(1===arguments.length)t=arguments[0],Uf.isTrue(t,null);else if(2===arguments.length&&(t=arguments[0],e=arguments[1],!t))throw null===e?new Xf:new Xf(e)},Uf.equals=function(){var t,e,n;if(2===arguments.length)t=arguments[0],e=arguments[1],Uf.equals(t,e,null);else if(3===arguments.length&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new Xf("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var Yf=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new ff,this._intPt[1]=new ff,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Vf={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Yf.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},Yf.prototype.getTopologySummary=function(){var t=new wf;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},Yf.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)},Yf.prototype.getIntersectionNum=function(){return this._result},Yf.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},Yf.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Yf.prototype.setPrecisionModel=function(t){this._precisionModel=t},Yf.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],n=0;n<this._result;n++)if(!t._intPt[n].equals2D(t._inputLines[e][0])&&!t._intPt[n].equals2D(t._inputLines[e][1]))return!0;return!1}},Yf.prototype.getIntersection=function(t){return this._intPt[t]},Yf.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Yf.prototype.hasIntersection=function(){return this._result!==Yf.NO_INTERSECTION},Yf.prototype.getEdgeDistance=function(t,e){return Yf.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},Yf.prototype.isCollinear=function(){return this._result===Yf.COLLINEAR_INTERSECTION},Yf.prototype.toString=function(){return zf.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+zf.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Yf.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},Yf.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1},Yf.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},Yf.prototype.interfaces_=function(){return[]},Yf.prototype.getClass=function(){return Yf},Yf.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=r>i?r:i;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);o=r>i?s:a,0!==o||t.equals(e)||(o=Math.max(s,a))}return Uf.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},Yf.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return Uf.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Vf.DONT_INTERSECT.get=function(){return 0},Vf.DO_INTERSECT.get=function(){return 1},Vf.COLLINEAR.get=function(){return 2},Vf.NO_INTERSECTION.get=function(){return 0},Vf.POINT_INTERSECTION.get=function(){return 1},Vf.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Yf,Vf);var Hf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Df(this._inputLines[0][0],this._inputLines[0][1]),n=new Df(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,Df.intersects(n,r,e)&&0===Zf.orientationIndex(n,r,e)&&0===Zf.orientationIndex(r,n,e))return this._isProper=!0,(e.equals(n)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,r,i){i.x=this.smallestInAbsValue(t.x,e.x,n.x,r.x),i.y=this.smallestInAbsValue(t.y,e.y,n.y,r.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=Af.intersection(t,n,r,i)}catch(s){if(!(s instanceof Rf))throw s;o=e.nearestEndpoint(t,n,r,i)}return o},e.prototype.intersection=function(t,n,r,i){var o=this.intersectionWithNormalization(t,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new ff(e.nearestEndpoint(t,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,r){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},e.prototype.checkDD=function(t,e,n,r,i){var o=Sf.intersection(t,e,n,r),s=this.isInSegmentEnvelopes(o);Tf.out.println("DD in env = "+s+"  --------------------- "+o),i.distance(o)>1e-4&&Tf.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,r){var i=new ff(t),o=new ff(e),s=new ff(n),a=new ff(r),u=new ff;this.normalizeToEnvCentre(i,o,s,a,u);var c=this.safeHCoordinateIntersection(i,o,s,a);return c.x+=u.x,c.y+=u.y,c},e.prototype.computeCollinearIntersection=function(e,n,r,i){var o=Df.intersects(e,n,r),s=Df.intersects(e,n,i),a=Df.intersects(r,i,e),u=Df.intersects(r,i,n);return o&&s?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):a&&u?(this._intPt[0]=e,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||s||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&u?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&u?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,r,i){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,c=n.x<r.x?n.x:r.x,h=n.y<r.y?n.y:r.y,l=n.x>r.x?n.x:r.x,p=n.y>r.y?n.y:r.y,f=o>c?o:c,g=a<l?a:l,d=s>h?s:h,y=u<p?u:p,_=(f+g)/2,v=(d+y)/2;i.x=_,i.y=v,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.computeIntersect=function(e,n,r,i){if(this._isProper=!1,!Df.intersects(e,n,r,i))return t.NO_INTERSECTION;var o=Zf.orientationIndex(e,n,r),s=Zf.orientationIndex(e,n,i);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=Zf.orientationIndex(r,i,e),u=Zf.orientationIndex(r,i,n);return a>0&&u>0||a<0&&u<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===u?this.computeCollinearIntersection(e,n,r,i):(0===o||0===s||0===a||0===u?(this._isProper=!1,e.equals2D(r)||e.equals2D(i)?this._intPt[0]=e:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new ff(r):0===s?this._intPt[0]=new ff(i):0===a?this._intPt[0]=new ff(e):0===u&&(this._intPt[0]=new ff(n))):(this._isProper=!0,this._intPt[0]=this.intersection(e,n,r,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,r){var i=t,o=Zf.distancePointLine(t,n,r),s=Zf.distancePointLine(e,n,r);return s<o&&(o=s,i=e),s=Zf.distancePointLine(n,t,e),s<o&&(o=s,i=n),s=Zf.distancePointLine(r,t,e),s<o&&(o=s,i=r),i},e}(Yf),Wf=function(){};Wf.prototype.interfaces_=function(){return[]},Wf.prototype.getClass=function(){return Wf},Wf.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,s=n.y-e.y;return Wf.signOfDet2x2(r,i,o,s)},Wf.signOfDet2x2=function(t,e,n,r){var i=null,o=null,s=null;if(i=1,0===t||0===r)return 0===e||0===n?0:e>0?n>0?-i:i:n>0?i:-i;if(0===e||0===n)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0){if(!(n>0))return i;if(!(t<=n))return i}else{if(n>0)return-i;if(!(t>=n))return-i;i=-i,t=-t,n=-n}for(;;){if(s=Math.floor(n/t),n-=s*t,(r-=s*e)<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if(s=Math.floor(t/n),t-=s*n,(e-=s*r)<0)return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var Jf=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Jf.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,u=Wf.signOfDet2x2(i,o,s,a);if(0===u)return this._isPointOnSegment=!0,null;a<o&&(u=-u),u>0&&this._crossingCount++}},Jf.prototype.isPointInPolygon=function(){return this.getLocation()!==_f.EXTERIOR},Jf.prototype.getLocation=function(){return this._isPointOnSegment?_f.BOUNDARY:this._crossingCount%2==1?_f.INTERIOR:_f.EXTERIOR},Jf.prototype.isOnSegment=function(){return this._isPointOnSegment},Jf.prototype.interfaces_=function(){return[]},Jf.prototype.getClass=function(){return Jf},Jf.locatePointInRing=function(){if(arguments[0]instanceof ff&&mf(arguments[1],Lf)){for(var t=arguments[0],e=arguments[1],n=new Jf(t),r=new ff,i=new ff,o=1;o<e.size();o++)if(e.getCoordinate(o,r),e.getCoordinate(o-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof ff&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],u=new Jf(s),c=1;c<a.length;c++){var h=a[c],l=a[c-1];if(u.countSegment(h,l),u.isOnSegment())return u.getLocation()}return u.getLocation()}};var Zf=function(){},Kf={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Zf.prototype.interfaces_=function(){return[]},Zf.prototype.getClass=function(){return Zf},Zf.orientationIndex=function(t,e,n){return Sf.orientationIndex(t,e,n)},Zf.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y;e+=i*(t[r-1].y-o)}return e/2}if(mf(arguments[0],Lf)){var s=arguments[0],a=s.size();if(a<3)return 0;var u=new ff,c=new ff,h=new ff;s.getCoordinate(0,c),s.getCoordinate(1,h);var l=c.x;h.x-=l;for(var p=0,f=1;f<a-1;f++)u.y=c.y,c.x=h.x,c.y=h.y,s.getCoordinate(f+1,h),h.x-=l,p+=c.x*(u.y-h.y);return p/2}},Zf.distanceLineLine=function(t,e,n,r){if(t.equals(e))return Zf.distancePointLine(t,n,r);if(n.equals(r))return Zf.distancePointLine(r,t,e);var i=!1;if(Df.intersects(t,e,n,r)){var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(0===o)i=!0;else{var s=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),a=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),u=a/o,c=s/o;(c<0||c>1||u<0||u>1)&&(i=!0)}}else i=!0;return i?xf.min(Zf.distancePointLine(t,n,r),Zf.distancePointLine(e,n,r),Zf.distancePointLine(n,t,e),Zf.distancePointLine(r,t,e)):0},Zf.isPointInRing=function(t,e){return Zf.locatePointInRing(t,e)!==_f.EXTERIOR},Zf.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new ff;t.getCoordinate(0,r);for(var i=r.x,o=r.y,s=1;s<e;s++){t.getCoordinate(s,r);var a=r.x,u=r.y,c=a-i,h=u-o;n+=Math.sqrt(c*c+h*h),i=a,o=u}return n},Zf.isCCW=function(t){var e=t.length-1;if(e<3)throw new af("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var s=r;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(n)&&s!==r);var a=r;do{a=(a+1)%e}while(t[a].equals2D(n)&&a!==r);var u=t[s],c=t[a];if(u.equals2D(n)||c.equals2D(n)||u.equals2D(c))return!1;var h=Zf.computeOrientation(u,n,c),l=!1;return l=0===h?u.x>c.x:h>0,l},Zf.locatePointInRing=function(t,e){return Jf.locatePointInRing(t,e)},Zf.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)},Zf.computeOrientation=function(t,e,n){return Zf.orientationIndex(t,e,n)},Zf.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new af("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=Zf.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var u=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/u;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var h=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/u;return Math.abs(h)*Math.sqrt(u)}},Zf.isOnLine=function(t,e){for(var n=new Hf,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1},Kf.CLOCKWISE.get=function(){return-1},Kf.RIGHT.get=function(){return Zf.CLOCKWISE},Kf.COUNTERCLOCKWISE.get=function(){return 1},Kf.LEFT.get=function(){return Zf.COUNTERCLOCKWISE},Kf.COLLINEAR.get=function(){return 0},Kf.STRAIGHT.get=function(){return Zf.COLLINEAR},Object.defineProperties(Zf,Kf);var Qf=function(){};Qf.prototype.filter=function(t){},Qf.prototype.interfaces_=function(){return[]},Qf.prototype.getClass=function(){return Qf};var $f=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},tg={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};$f.prototype.isGeometryCollection=function(){return this.getSortIndex()===$f.SORTINDEX_GEOMETRYCOLLECTION},$f.prototype.getFactory=function(){return this._factory},$f.prototype.getGeometryN=function(t){return this},$f.prototype.getArea=function(){return 0},$f.prototype.isRectangle=function(){return!1},$f.prototype.equals=function(){if(arguments[0]instanceof $f){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof $f))return!1;var n=e;return this.equalsExact(n)}},$f.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},$f.prototype.geometryChanged=function(){this.apply($f.geometryChangedFilter)},$f.prototype.geometryChangedAction=function(){this._envelope=null},$f.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},$f.prototype.getLength=function(){return 0},$f.prototype.getNumGeometries=function(){return 1},$f.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},$f.prototype.getUserData=function(){return this._userData},$f.prototype.getSRID=function(){return this._SRID},$f.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},$f.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===$f.SORTINDEX_GEOMETRYCOLLECTION)throw new af("This method does not support GeometryCollection arguments")},$f.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},$f.prototype.norm=function(){var t=this.copy();return t.normalize(),t},$f.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},$f.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Df(this._envelope)},$f.prototype.setSRID=function(t){this._SRID=t},$f.prototype.setUserData=function(t){this._userData=t},$f.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),s=i.compareTo(o);if(0!==s)return s}return n.hasNext()?1:r.hasNext()?-1:0},$f.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},$f.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===$f.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===$f.SORTINDEX_MULTIPOINT||this.getSortIndex()===$f.SORTINDEX_MULTILINESTRING||this.getSortIndex()===$f.SORTINDEX_MULTIPOLYGON},$f.prototype.interfaces_=function(){return[lf,hf,ou]},$f.prototype.getClass=function(){return $f},$f.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},$f.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},tg.serialVersionUID.get=function(){return 0x799ea46522854c00},tg.SORTINDEX_POINT.get=function(){return 0},tg.SORTINDEX_MULTIPOINT.get=function(){return 1},tg.SORTINDEX_LINESTRING.get=function(){return 2},tg.SORTINDEX_LINEARRING.get=function(){return 3},tg.SORTINDEX_MULTILINESTRING.get=function(){return 4},tg.SORTINDEX_POLYGON.get=function(){return 5},tg.SORTINDEX_MULTIPOLYGON.get=function(){return 6},tg.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},tg.geometryChangedFilter.get=function(){return eg},Object.defineProperties($f,tg);var eg=function(){};eg.interfaces_=function(){return[Qf]},eg.filter=function(t){t.geometryChangedAction()};var ng=function(){};ng.prototype.filter=function(t){},ng.prototype.interfaces_=function(){return[]},ng.prototype.getClass=function(){return ng};var rg=function(){},ig={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};rg.prototype.isInBoundary=function(t){},rg.prototype.interfaces_=function(){return[]},rg.prototype.getClass=function(){return rg},ig.Mod2BoundaryNodeRule.get=function(){return og},ig.EndPointBoundaryNodeRule.get=function(){return sg},ig.MultiValentEndPointBoundaryNodeRule.get=function(){return ag},ig.MonoValentEndPointBoundaryNodeRule.get=function(){return ug},ig.MOD2_BOUNDARY_RULE.get=function(){return new og},ig.ENDPOINT_BOUNDARY_RULE.get=function(){return new sg},ig.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ag},ig.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ug},ig.OGC_SFS_BOUNDARY_RULE.get=function(){return rg.MOD2_BOUNDARY_RULE},Object.defineProperties(rg,ig);var og=function(){};og.prototype.isInBoundary=function(t){return t%2==1},og.prototype.interfaces_=function(){return[rg]},og.prototype.getClass=function(){return og};var sg=function(){};sg.prototype.isInBoundary=function(t){return t>0},sg.prototype.interfaces_=function(){return[rg]},sg.prototype.getClass=function(){return sg};var ag=function(){};ag.prototype.isInBoundary=function(t){return t>1},ag.prototype.interfaces_=function(){return[rg]},ag.prototype.getClass=function(){return ag};var ug=function(){};ug.prototype.isInBoundary=function(t){return 1===t},ug.prototype.interfaces_=function(){return[rg]},ug.prototype.getClass=function(){return ug};var cg=function(){};cg.prototype.add=function(){},cg.prototype.addAll=function(){},cg.prototype.isEmpty=function(){},cg.prototype.iterator=function(){},cg.prototype.size=function(){},cg.prototype.toArray=function(){},cg.prototype.remove=function(){};var hg=function(t){function e(e){t.call(this),this.message=e||""}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,{name:{configurable:!0}}.name.get=function(){return"IndexOutOfBoundsException"},e}(Error),lg=function(){};lg.prototype.hasNext=function(){},lg.prototype.next=function(){},lg.prototype.remove=function(){};var pg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(cg);su.prototype=new Error,su.prototype.name="NoSuchElementException";var fg=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof cg&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,cg]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new gg(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new hg;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e},e.prototype.remove=function(t){for(var e=this,n=!1,r=0,i=this.array_.length;r<i;r++)if(e.array_[r]===t){e.array_.splice(r,1),n=!0;break}return n},e}(pg),gg=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new su;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(lg),dg=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){var e=this;if(2===arguments.length){for(var n=arguments[0],r=arguments[1],i=!1,o=n.iterator();o.hasNext();)e.add(o.next(),r),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=this,n=t.prototype.clone.call(this),r=0;r<this.size();r++)n.add(r,e.get(r).copy());return n},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length){var n=arguments[0];t.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var r=arguments[0],i=arguments[1];return this.add(r,i,!0),!0}if(arguments[0]instanceof ff&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var a=this.get(this.size()-1);if(a.equals2D(o))return null}t.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var u=arguments[0],c=arguments[1];return this.add(u,c),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var h=arguments[0],l=arguments[1],p=arguments[2];if(p)for(var f=0;f<h.length;f++)e.add(h[f],l);else for(var g=h.length-1;g>=0;g--)e.add(h[g],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof ff){var d=arguments[0],y=arguments[1],_=arguments[2];if(!_){var v=this.size();if(v>0){if(d>0){var m=this.get(d-1);if(m.equals2D(y))return null}if(d<v){var x=this.get(d);if(x.equals2D(y))return null}}}t.prototype.add.call(this,d,y)}}else if(4===arguments.length){var E=arguments[0],w=arguments[1],b=arguments[2],I=arguments[3],N=1;b>I&&(N=-1);for(var C=b;C!==I;C+=N)e.add(E[C],w);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new ff(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(fg),yg=function(){},_g={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};_g.ForwardComparator.get=function(){return vg},_g.BidirectionalComparator.get=function(){return mg},_g.coordArrayType.get=function(){return new Array(0).fill(null)},yg.prototype.interfaces_=function(){return[]},yg.prototype.getClass=function(){return yg},yg.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},yg.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(yg.indexOf(r,e)<0)return r}return null},yg.scroll=function(t,e){var n=yg.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Tf.arraycopy(t,n,r,0,t.length-n),Tf.arraycopy(t,0,r,t.length-n,n),Tf.arraycopy(r,0,t,0,t.length)},yg.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],i[s]))return!1;return!0}},yg.intersection=function(t,e){for(var n=new dg,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()},yg.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},yg.removeRepeatedPoints=function(t){return yg.hasRepeatedPoints(t)?new dg(t,!1).toCoordinateArray():t},yg.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}},yg.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(r[i++]=t[o]);return r},yg.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new ff(t[n]);return e}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],u=0;u<a;u++)o[s+u]=new ff(r[i+u])},yg.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(0!==r.compareTo(i))return!1}return!0},yg.envelope=function(t){for(var e=new Df,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},yg.toCoordinateArray=function(t){return t.toArray(yg.coordArrayType)},yg.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},yg.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},yg.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(0!==r)return r}return 1},yg.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(0!==r)return r;n++}return n<e.length?-1:n<t.length?1:0},yg.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},yg.extract=function(t,e,n){e=xf.clamp(e,0,t.length),n=xf.clamp(n,-1,t.length);var r=n-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,s=e;s<=n;s++)i[o++]=t[s];return i},Object.defineProperties(yg,_g);var vg=function(){};vg.prototype.compare=function(t,e){
return yg.compare(t,e)},vg.prototype.interfaces_=function(){return[pf]},vg.prototype.getClass=function(){return vg};var mg=function(){};mg.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=yg.compare(n,r);return yg.isEqualReversed(n,r)?0:i},mg.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=yg.increasingDirection(n),o=yg.increasingDirection(r),s=i>0?0:n.length-1,a=o>0?0:n.length-1,u=0;u<n.length;u++){var c=n[s].compareTo(r[a]);if(0!==c)return c;s+=i,a+=o}return 0},mg.prototype.interfaces_=function(){return[pf]},mg.prototype.getClass=function(){return mg};var xg=function(){};xg.prototype.get=function(){},xg.prototype.put=function(){},xg.prototype.size=function(){},xg.prototype.values=function(){},xg.prototype.entrySet=function(){};var Eg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xg);au.prototype=new Error,au.prototype.name="OperationNotSupported",uu.prototype=new cg,uu.prototype.contains=function(){};var wg=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof cg&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){if(e.array_[n]===t)return!0}return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e},e.prototype.iterator=function(){return new bg(this)},e}(uu),bg=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new su;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new au},e}(lg),Ig=0;gu.prototype=new Eg,gu.prototype.get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},gu.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Ig,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=t.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var s={key:t,left:null,right:null,value:e,parent:n,color:Ig,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},gu.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(hu(t)===pu(hu(hu(t)))){var n=fu(hu(hu(t)));1===cu(n)?(lu(hu(t),Ig),lu(n,Ig),lu(hu(hu(t)),1),t=hu(hu(t))):(t===fu(hu(t))&&(t=hu(t),e.rotateLeft(t)),lu(hu(t),Ig),lu(hu(hu(t)),1),e.rotateRight(hu(hu(t))))}else{var r=pu(hu(hu(t)));1===cu(r)?(lu(hu(t),Ig),lu(r,Ig),lu(hu(hu(t)),1),t=hu(hu(t))):(t===pu(hu(t))&&(t=hu(t),e.rotateRight(t)),lu(hu(t),Ig),lu(hu(hu(t)),1),e.rotateLeft(hu(hu(t))))}this.root_.color=Ig},gu.prototype.values=function(){var t=new fg,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=gu.successor(e));)t.add(e.value);return t},gu.prototype.entrySet=function(){var t=new wg,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=gu.successor(e));)t.add(e);return t},gu.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},gu.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},gu.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},gu.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,r=t;null!==n&&r===n.right;)r=n,n=n.parent;return n},gu.prototype.size=function(){return this.size_};var Ng=function(){};Ng.prototype.interfaces_=function(){return[]},Ng.prototype.getClass=function(){return Ng},du.prototype=new uu,yu.prototype=new du,yu.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){if(0===e.array_[n].compareTo(t))return!0}return!1},yu.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){if(1===e.array_[n].compareTo(t))return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0},yu.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0},yu.prototype.remove=function(t){throw new au},yu.prototype.size=function(){return this.array_.length},yu.prototype.isEmpty=function(){return 0===this.array_.length},yu.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e},yu.prototype.iterator=function(){return new Cg(this)};var Cg=function(t){this.treeSet_=t,this.position_=0};Cg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new su;return this.treeSet_.array_[this.position_++]},Cg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Cg.prototype.remove=function(){throw new au};var Sg=function(){};Sg.sort=function(){var t,e,n,r,i=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(t,e){return n.compare(t,e)},i.sort(r);else if(3===arguments.length){e=i.slice(arguments[1],arguments[2]),e.sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(t,e){return n.compare(t,e)},e.sort(r),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Sg.asList=function(t){for(var e=new fg,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Mg=function(){},Lg={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Lg.P.get=function(){return 0},Lg.L.get=function(){return 1},Lg.A.get=function(){return 2},Lg.FALSE.get=function(){return-1},Lg.TRUE.get=function(){return-2},Lg.DONTCARE.get=function(){return-3},Lg.SYM_FALSE.get=function(){return"F"},Lg.SYM_TRUE.get=function(){return"T"},Lg.SYM_DONTCARE.get=function(){return"*"},Lg.SYM_P.get=function(){return"0"},Lg.SYM_L.get=function(){return"1"},Lg.SYM_A.get=function(){return"2"},Mg.prototype.interfaces_=function(){return[]},Mg.prototype.getClass=function(){return Mg},Mg.toDimensionSymbol=function(t){switch(t){case Mg.FALSE:return Mg.SYM_FALSE;case Mg.TRUE:return Mg.SYM_TRUE;case Mg.DONTCARE:return Mg.SYM_DONTCARE;case Mg.P:return Mg.SYM_P;case Mg.L:return Mg.SYM_L;case Mg.A:return Mg.SYM_A}throw new af("Unknown dimension value: "+t)},Mg.toDimensionValue=function(t){switch(If.toUpperCase(t)){case Mg.SYM_FALSE:return Mg.FALSE;case Mg.SYM_TRUE:return Mg.TRUE;case Mg.SYM_DONTCARE:return Mg.DONTCARE;case Mg.SYM_P:return Mg.P;case Mg.SYM_L:return Mg.L;case Mg.SYM_A:return Mg.A}throw new af("Unknown dimension symbol: "+t)},Object.defineProperties(Mg,Lg);var Pg=function(){};Pg.prototype.filter=function(t){},Pg.prototype.interfaces_=function(){return[]},Pg.prototype.getClass=function(){return Pg};var Og=function(){};Og.prototype.filter=function(t,e){},Og.prototype.isDone=function(){},Og.prototype.isGeometryChanged=function(){},Og.prototype.interfaces_=function(){return[]},Og.prototype.getClass=function(){return Og};var Rg=function(t){function e(e,n){if(t.call(this,n),this._geometries=e||[],t.hasNullElements(this._geometries))throw new af("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=this,e=new Df,n=0;n<this._geometries.length;n++)e.expandToInclude(t._geometries[n].getEnvelopeInternal());return e},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=this,e=new Array(this.getNumPoints()).fill(null),n=-1,r=0;r<this._geometries.length;r++)for(var i=t._geometries[r].getCoordinates(),o=0;o<i.length;o++)n++,e[n]=i[o];return e},e.prototype.getArea=function(){for(var t=this,e=0,n=0;n<this._geometries.length;n++)e+=t._geometries[n].getArea();return e},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._geometries.length!==i._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!e._geometries[o].equalsExact(i._geometries[o],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<this._geometries.length;e++)t._geometries[e].normalize();Sg.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=this,e=Mg.FALSE,n=0;n<this._geometries.length;n++)e=Math.max(e,t._geometries[n].getBoundaryDimension());return e},e.prototype.getDimension=function(){for(var t=this,e=Mg.FALSE,n=0;n<this._geometries.length;n++)e=Math.max(e,t._geometries[n].getDimension());return e},e.prototype.getLength=function(){for(var t=this,e=0,n=0;n<this._geometries.length;n++)e+=t._geometries[n].getLength();return e},e.prototype.getNumPoints=function(){for(var t=this,e=0,n=0;n<this._geometries.length;n++)e+=t._geometries[n].getNumPoints();return e},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this,e=this._geometries.length,n=new Array(e).fill(null),r=0;r<this._geometries.length;r++)n[r]=t._geometries[r].reverse();return this.getFactory().createGeometryCollection(n)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new yu(Sg.asList(this._geometries)),r=new yu(Sg.asList(e._geometries));return this.compare(n,r)}if(2===arguments.length){for(var i=arguments[0],o=arguments[1],s=i,a=this.getNumGeometries(),u=s.getNumGeometries(),c=0;c<a&&c<u;){var h=t.getGeometryN(c),l=s.getGeometryN(c),p=h.compareToSameClass(l,o);if(0!==p)return p;c++}return c<a?1:c<u?-1:0}},e.prototype.apply=function(){var t=this;if(mf(arguments[0],ng))for(var e=arguments[0],n=0;n<this._geometries.length;n++)t._geometries[n].apply(e);else if(mf(arguments[0],Og)){var r=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(t._geometries[i].apply(r),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(mf(arguments[0],Pg)){var o=arguments[0];o.filter(this);for(var s=0;s<this._geometries.length;s++)t._geometries[s].apply(o)}else if(mf(arguments[0],Qf)){var a=arguments[0];a.filter(this);for(var u=0;u<this._geometries.length;u++)t._geometries[u].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Uf.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=this,n=t.prototype.clone.call(this);n._geometries=new Array(this._geometries.length).fill(null);for(var r=0;r<this._geometries.length;r++)n._geometries[r]=e._geometries[r].clone();return n},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=this,n=new Array(this._geometries.length).fill(null),r=0;r<n.length;r++)n[r]=t._geometries[r].copy();return new e(n,this._factory)},e.prototype.isEmpty=function(){for(var t=this,e=0;e<this._geometries.length;e++)if(!t._geometries[e].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}($f),Tg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return $f.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Mg.FALSE:0},e.prototype.isClosed=function(){var t=this;if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!t._geometries[e].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this,e=this._geometries.length,n=new Array(e).fill(null),r=0;r<this._geometries.length;r++)n[e-1-r]=t._geometries[r].reverse();return this.getFactory().createMultiLineString(n)},e.prototype.getBoundary=function(){return new Ag(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=this,n=new Array(this._geometries.length).fill(null),r=0;r<n.length;r++)n[r]=t._geometries[r].copy();return new e(n,this._factory)},e.prototype.interfaces_=function(){return[Ng]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(Rg),Ag=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=rg.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Ag.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Ag.prototype.getBoundary=function(){return this._geom instanceof kg?this.boundaryLineString(this._geom):this._geom instanceof Tg?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Ag.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){return this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Ag.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Ag.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new fg;this._endpointMap=new gu;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);0!==i.getNumPoints()&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var s=o.next(),a=s.getValue(),u=a.count;e._bnRule.isInBoundary(u)&&n.add(s.getKey())}return yg.toCoordinateArray(n)},Ag.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Dg,this._endpointMap.put(t,e)),e.count++},Ag.prototype.interfaces_=function(){return[]},Ag.prototype.getClass=function(){return Ag},Ag.getBoundary=function(){if(1===arguments.length){var t=arguments[0];return new Ag(t).getBoundary()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return new Ag(e,n).getBoundary()}};var Dg=function(){this.count=null};Dg.prototype.interfaces_=function(){return[]},Dg.prototype.getClass=function(){return Dg};var Fg=function(){},qg=function(){},Gg={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};qg.prototype.interfaces_=function(){return[]},qg.prototype.getClass=function(){return qg},qg.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)},qg.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new mu,n=new _u(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o="",s=new vu(qg.getStackTrace(r)),a=new Eu(s),u=0;u<i;u++)try{o+=a.readLine()+qg.NEWLINE}catch(t){if(!(t instanceof xu))throw t;Uf.shouldNeverReachHere()}return o}},qg.split=function(t,e){for(var n=e.length,r=new fg,i=""+t,o=i.indexOf(e);o>=0;){var s=i.substring(0,o);r.add(s),i=i.substring(o+n),o=i.indexOf(e)}i.length>0&&r.add(i);for(var a=new Array(r.size()).fill(null),u=0;u<a.length;u++)a[u]=r.get(u);return a},qg.toString=function(){if(1===arguments.length){var t=arguments[0];return qg.SIMPLE_ORDINATE_FORMAT.format(t)}},qg.spaces=function(t){return qg.chars(" ",t)},Gg.NEWLINE.get=function(){return Tf.getProperty("line.separator")},Gg.SIMPLE_ORDINATE_FORMAT.get=function(){return new Fg("0.#")},Object.defineProperties(qg,Gg);var Bg=function(){};Bg.prototype.interfaces_=function(){return[]},Bg.prototype.getClass=function(){return Bg},Bg.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))},Bg.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&(t.getOrdinate(0,Lf.X)===t.getOrdinate(e-1,Lf.X)&&t.getOrdinate(0,Lf.Y)===t.getOrdinate(e-1,Lf.Y))},Bg.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var s=t.getOrdinate(i,o),a=e.getOrdinate(i,o);if(t.getOrdinate(i,o)!==e.getOrdinate(i,o)&&(!uf.isNaN(s)||!uf.isNaN(a)))return!1}return!0},Bg.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(Bg.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)Bg.copy(e,i-1,r,o,1);return r},Bg.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)Bg.swap(t,r,e-r)},Bg.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}},Bg.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)Bg.copyCoord(t,e+o,n,r+o)},Bg.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),r=new wf;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(qg.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}},Bg.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?Bg.createClosedRing(t,e,4):e.getOrdinate(0,Lf.X)===e.getOrdinate(n-1,Lf.X)&&e.getOrdinate(0,Lf.Y)===e.getOrdinate(n-1,Lf.Y)?e:Bg.createClosedRing(t,e,n+1)},Bg.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();Bg.copy(e,0,r,0,i);for(var o=i;o<n;o++)Bg.copy(e,0,r,o,1);return r};var kg=function(t){function e(e,n){t.call(this,n),this._points=null,this.init(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Df:this._points.expandEnvelope(new Df)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._points.size()!==i._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!e.equal(e._points.getCoordinate(o),i._points.getCoordinate(o),r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this._points.size()/2);e++){var n=t._points.size()-1-e;if(!t._points.getCoordinate(e).equals(t._points.getCoordinate(n)))return t._points.getCoordinate(e).compareTo(t._points.getCoordinate(n))>0&&Bg.reverse(t._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Mg.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Zf.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Bg.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=e,r=0,i=0;r<this._points.size()&&i<n._points.size();){var o=t._points.getCoordinate(r).compareTo(n._points.getCoordinate(i));if(0!==o)return o;r++,i++}return r<this._points.size()?1:i<n._points.size()?-1:0}if(2===arguments.length){var s=arguments[0],a=arguments[1],u=s;return a.compare(this._points,u._points)}},e.prototype.apply=function(){var t=this;if(mf(arguments[0],ng))for(var e=arguments[0],n=0;n<this._points.size();n++)e.filter(t._points.getCoordinate(n));else if(mf(arguments[0],Og)){var r=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(r.filter(t._points,i),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(mf(arguments[0],Pg)){var o=arguments[0];o.filter(this)}else if(mf(arguments[0],Qf)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return new Ag(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new af("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=this,n=0;n<this._points.size();n++)if(e._points.getCoordinate(n).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Ng]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}($f),zg=function(){};zg.prototype.interfaces_=function(){return[]},zg.prototype.getClass=function(){return zg};var jg=function(t){function e(e,n){t.call(this,n),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Df;var t=new Df;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Mg.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=n;return r.compare(this._coordinates,i._coordinates)}},e.prototype.apply=function(){if(mf(arguments[0],ng)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(mf(arguments[0],Og)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(mf(arguments[0],Pg)){var n=arguments[0];n.filter(this)}else if(mf(arguments[0],Qf)){var r=arguments[0];r.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Uf.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[zg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}($f),Xg=function(){};Xg.prototype.interfaces_=function(){return[]},Xg.prototype.getClass=function(){return Xg};var Ug=function(t){function e(e,n,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new af("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new af("shell is empty but holes are not");this._shell=e,this._holes=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var t=this;if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),n=-1,r=this._shell.getCoordinates(),i=0;i<r.length;i++)n++,e[n]=r[i];for(var o=0;o<this._holes.length;o++)for(var s=t._holes[o].getCoordinates(),a=0;a<s.length;a++)n++,e[n]=s[a];return e},e.prototype.getArea=function(){var t=this,e=0;e+=Math.abs(Zf.signedArea(this._shell.getCoordinateSequence()));for(var n=0;n<this._holes.length;n++)e-=Math.abs(Zf.signedArea(t._holes[n].getCoordinateSequence()));return e},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var r=t.getX(n);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var i=t.getY(n);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var u=t.getX(a),c=t.getY(a);if(u!==o===(c!==s))return!1;o=u,s=c}return!0},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n,o=this._shell,s=i._shell;if(!o.equalsExact(s,r))return!1;if(this._holes.length!==i._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!e._holes[a].equalsExact(i._holes[a],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var t=this;if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)t.normalize(t._holes[e],!1);Sg.sort(this._holes)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];if(n.isEmpty())return null;var i=new Array(n.getCoordinates().length-1).fill(null);Tf.arraycopy(n.getCoordinates(),0,i,0,i.length);var o=yg.minCoordinate(n.getCoordinates());yg.scroll(i,o),Tf.arraycopy(i,0,n.getCoordinates(),0,i.length),n.getCoordinates()[i.length]=i[0],Zf.isCCW(n.getCoordinates())===r&&yg.reverse(n.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=this,e=0;e+=this._shell.getLength();for(var n=0;n<this._holes.length;n++)e+=t._holes[n].getLength();return e},e.prototype.getNumPoints=function(){for(var t=this,e=this._shell.getNumPoints(),n=0;n<this._holes.length;n++)e+=t._holes[n].getNumPoints();return e},e.prototype.reverse=function(){var t=this,e=this.copy();e._shell=this._shell.copy().reverse(),e._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)e._holes[n]=t._holes[n].copy().reverse();return e},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this._shell,r=e._shell;return n.compareToSameClass(r)}if(2===arguments.length){var i=arguments[0],o=arguments[1],s=i,a=this._shell,u=s._shell,c=a.compareToSameClass(u,o);if(0!==c)return c;for(var h=this.getNumInteriorRing(),l=s.getNumInteriorRing(),p=0;p<h&&p<l;){var f=t.getInteriorRingN(p),g=s.getInteriorRingN(p),d=f.compareToSameClass(g,o);if(0!==d)return d;p++}return p<h?1:p<l?-1:0}},e.prototype.apply=function(t){var e=this;if(mf(t,ng)){this._shell.apply(t);for(var n=0;n<this._holes.length;n++)e._holes[n].apply(t)}else if(mf(t,Og)){if(this._shell.apply(t),!t.isDone())for(var r=0;r<this._holes.length&&(e._holes[r].apply(t),!t.isDone());r++);t.isGeometryChanged()&&this.geometryChanged()}else if(mf(t,Pg))t.filter(this);else if(mf(t,Qf)){t.filter(this),this._shell.apply(t);for(var i=0;i<this._holes.length;i++)e._holes[i].apply(t)}},e.prototype.getBoundary=function(){var t=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var n=0;n<this._holes.length;n++)e[n+1]=t._holes[n];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},e.prototype.clone=function(){
var e=this,n=t.prototype.clone.call(this);n._shell=this._shell.clone(),n._holes=new Array(this._holes.length).fill(null);for(var r=0;r<this._holes.length;r++)n._holes[r]=e._holes[r].clone();return n},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this,n=this._shell.copy(),r=new Array(this._holes.length).fill(null),i=0;i<r.length;i++)r[i]=t._holes[i].copy();return new e(n,r,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Xg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}($f),Yg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return $f.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Mg.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=this,n=new Array(this._geometries.length).fill(null),r=0;r<n.length;r++)n[r]=t._geometries[r].copy();return new e(n,this._factory)},e.prototype.interfaces_=function(){return[zg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(Rg),Vg=function(t){function e(e,n){e instanceof ff&&n instanceof ud&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return $f.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Mg.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Bg.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new af("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new af("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(kg),Hg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return $f.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this,e=this._geometries.length,n=new Array(e).fill(null),r=0;r<this._geometries.length;r++)n[r]=t._geometries[r].reverse();return this.getFactory().createMultiPolygon(n)},e.prototype.getBoundary=function(){var t=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new fg,n=0;n<this._geometries.length;n++)for(var r=t._geometries[n],i=r.getBoundary(),o=0;o<i.getNumGeometries();o++)e.add(i.getGeometryN(o));var s=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(s))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=this,n=new Array(this._geometries.length).fill(null),r=0;r<n.length;r++)n[r]=t._geometries[r].copy();return new e(n,this._factory)},e.prototype.interfaces_=function(){return[Xg]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Rg),Wg=function(t){this._factory=t||null,this._isUserDataCopied=!1},Jg={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Wg.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},Wg.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},Wg.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Rg?this.editGeometryCollection(t,e):t instanceof Ug?this.editPolygon(t,e):t instanceof jg?e.edit(t,this._factory):t instanceof kg?e.edit(t,this._factory):(Uf.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},Wg.prototype.editGeometryCollection=function(t,e){for(var n=this,r=e.edit(t,this._factory),i=new fg,o=0;o<r.getNumGeometries();o++){var s=n.edit(r.getGeometryN(o),e);null===s||s.isEmpty()||i.add(s)}return r.getClass()===Yg?this._factory.createMultiPoint(i.toArray([])):r.getClass()===Tg?this._factory.createMultiLineString(i.toArray([])):r.getClass()===Hg?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))},Wg.prototype.editPolygon=function(t,e){var n=this,r=e.edit(t,this._factory);if(null===r&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var i=this.edit(r.getExteriorRing(),e);if(null===i||i.isEmpty())return this._factory.createPolygon();for(var o=new fg,s=0;s<r.getNumInteriorRing();s++){var a=n.edit(r.getInteriorRingN(s),e);null===a||a.isEmpty()||o.add(a)}return this._factory.createPolygon(i,o.toArray([]))},Wg.prototype.interfaces_=function(){return[]},Wg.prototype.getClass=function(){return Wg},Wg.GeometryEditorOperation=function(){},Jg.NoOpGeometryOperation.get=function(){return Zg},Jg.CoordinateOperation.get=function(){return Kg},Jg.CoordinateSequenceOperation.get=function(){return Qg},Object.defineProperties(Wg,Jg);var Zg=function(){};Zg.prototype.edit=function(t,e){return t},Zg.prototype.interfaces_=function(){return[Wg.GeometryEditorOperation]},Zg.prototype.getClass=function(){return Zg};var Kg=function(){};Kg.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof Vg?e.createLinearRing(n):t instanceof kg?e.createLineString(n):t instanceof jg?n.length>0?e.createPoint(n[0]):e.createPoint():t},Kg.prototype.interfaces_=function(){return[Wg.GeometryEditorOperation]},Kg.prototype.getClass=function(){return Kg};var Qg=function(){};Qg.prototype.edit=function(t,e){return t instanceof Vg?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof kg?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof jg?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},Qg.prototype.interfaces_=function(){return[Wg.GeometryEditorOperation]},Qg.prototype.getClass=function(){return Qg};var $g=function(){var t=this;if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new ff}else if(mf(arguments[0],Lf)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1];this._coordinates=o,this._dimension=s,null===o&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],u=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=u;for(var c=0;c<a;c++)t._coordinates[c]=new ff}},td={serialVersionUID:{configurable:!0}};$g.prototype.setOrdinate=function(t,e,n){switch(e){case Lf.X:this._coordinates[t].x=n;break;case Lf.Y:this._coordinates[t].y=n;break;case Lf.Z:this._coordinates[t].z=n;break;default:throw new af("invalid ordinateIndex")}},$g.prototype.size=function(){return this._coordinates.length},$g.prototype.getOrdinate=function(t,e){switch(e){case Lf.X:return this._coordinates[t].x;case Lf.Y:return this._coordinates[t].y;case Lf.Z:return this._coordinates[t].z}return uf.NaN},$g.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},$g.prototype.getCoordinateCopy=function(t){return new ff(this._coordinates[t])},$g.prototype.getDimension=function(){return this._dimension},$g.prototype.getX=function(t){return this._coordinates[t].x},$g.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new $g(e,this._dimension)},$g.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t},$g.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new $g(e,this._dimension)},$g.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new wf(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}return"()"},$g.prototype.getY=function(t){return this._coordinates[t].y},$g.prototype.toCoordinateArray=function(){return this._coordinates},$g.prototype.interfaces_=function(){return[Lf,ou]},$g.prototype.getClass=function(){return $g},td.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties($g,td);var ed=function(){},nd={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ed.prototype.readResolve=function(){return ed.instance()},ed.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new $g(t)}if(mf(arguments[0],Lf)){var e=arguments[0];return new $g(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new $g(n):new $g(n,r)}},ed.prototype.interfaces_=function(){return[yf,ou]},ed.prototype.getClass=function(){return ed},ed.instance=function(){return ed.instanceObject},nd.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},nd.instanceObject.get=function(){return new ed},Object.defineProperties(ed,nd);var rd=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new fg,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new wg;return this.map_.entries().forEach(function(e){return t.add(e)}),t},e.prototype.size=function(){return this.map_.size()},e}(xg),id=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof sd){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},od={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};id.prototype.equals=function(t){if(!(t instanceof id))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},id.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new bf(n).compareTo(new bf(r))},id.prototype.getScale=function(){return this._scale},id.prototype.isFloating=function(){return this._modelType===id.FLOATING||this._modelType===id.FLOATING_SINGLE},id.prototype.getType=function(){return this._modelType},id.prototype.toString=function(){var t="UNKNOWN";return this._modelType===id.FLOATING?t="Floating":this._modelType===id.FLOATING_SINGLE?t="Floating-Single":this._modelType===id.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},id.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];if(uf.isNaN(t))return t;if(this._modelType===id.FLOATING_SINGLE){return t}return this._modelType===id.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof ff){var e=arguments[0];if(this._modelType===id.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},id.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===id.FLOATING?t=16:this._modelType===id.FLOATING_SINGLE?t=6:this._modelType===id.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},id.prototype.setScale=function(t){this._scale=Math.abs(t)},id.prototype.interfaces_=function(){return[ou,hf]},id.prototype.getClass=function(){return id},id.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},od.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},od.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(id,od);var sd=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ad={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};sd.prototype.readResolve=function(){return sd.nameToTypeMap.get(this._name)},sd.prototype.toString=function(){return this._name},sd.prototype.interfaces_=function(){return[ou]},sd.prototype.getClass=function(){return sd},ad.serialVersionUID.get=function(){return-552860263173159e4},ad.nameToTypeMap.get=function(){return new rd},Object.defineProperties(sd,ad),id.Type=sd,id.FIXED=new sd("FIXED"),id.FLOATING=new sd("FLOATING"),id.FLOATING_SINGLE=new sd("FLOATING SINGLE");var ud=function t(){this._precisionModel=new id,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?mf(arguments[0],yf)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof id&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},cd={serialVersionUID:{configurable:!0}};ud.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new ff(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new ff(t.getMinX(),t.getMinY()),new ff(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new ff(t.getMinX(),t.getMinY()),new ff(t.getMinX(),t.getMaxY()),new ff(t.getMaxX(),t.getMaxY()),new ff(t.getMaxX(),t.getMinY()),new ff(t.getMinX(),t.getMinY())]),null)},ud.prototype.createLineString=function(t){return t?t instanceof Array?new kg(this.getCoordinateSequenceFactory().create(t),this):mf(t,Lf)?new kg(t,this):void 0:new kg(this.getCoordinateSequenceFactory().create([]),this)},ud.prototype.createMultiLineString=function(){if(0===arguments.length)return new Tg(null,this);if(1===arguments.length){var t=arguments[0];return new Tg(t,this)}},ud.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),s=o.getClass();null===e&&(e=s),s!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(ud.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Ug)return this.createMultiPolygon(ud.toPolygonArray(t));if(a instanceof kg)return this.createMultiLineString(ud.toLineStringArray(t));if(a instanceof jg)return this.createMultiPoint(ud.toPointArray(t));Uf.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},ud.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},ud.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof ff){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(mf(arguments[0],Lf)){var e=arguments[0];return new jg(e,this)}}},ud.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},ud.prototype.createPolygon=function(){if(0===arguments.length)return new Ug(null,null,this);if(1===arguments.length){if(mf(arguments[0],Lf)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Vg){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return new Ug(r,i,this)}},ud.prototype.getSRID=function(){return this._SRID},ud.prototype.createGeometryCollection=function(){if(0===arguments.length)return new Rg(null,this);if(1===arguments.length){var t=arguments[0];return new Rg(t,this)}},ud.prototype.createGeometry=function(t){return new Wg(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},ud.prototype.getPrecisionModel=function(){return this._precisionModel},ud.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(mf(arguments[0],Lf)){var e=arguments[0];return new Vg(e,this)}}},ud.prototype.createMultiPolygon=function(){if(0===arguments.length)return new Hg(null,this);if(1===arguments.length){var t=arguments[0];return new Hg(t,this)}},ud.prototype.createMultiPoint=function(){var t=this;if(0===arguments.length)return new Yg(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new Yg(e,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(mf(arguments[0],Lf)){var r=arguments[0];if(null===r)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),o=0;o<r.size();o++){var s=t.getCoordinateSequenceFactory().create(1,r.getDimension());Bg.copy(r,o,s,0,1),i[o]=t.createPoint(s)}return this.createMultiPoint(i)}}},ud.prototype.interfaces_=function(){return[ou]},ud.prototype.getClass=function(){return ud},ud.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.getDefaultCoordinateSequenceFactory=function(){return ed.instance()},ud.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ud.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},cd.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(ud,cd);var hd=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ld=function(t){this.geometryFactory=t||new ud};ld.prototype.read=function(t){var e;e="string"==typeof t?JSON.parse(t):t;var n=e.type;if(!pd[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==hd.indexOf(n)?pd[n].apply(this,[e.coordinates]):"GeometryCollection"===n?pd[n].apply(this,[e.geometries]):pd[n].apply(this,[e])},ld.prototype.write=function(t){var e=t.getGeometryType();if(!fd[e])throw new Error("Geometry is not supported");return fd[e].apply(this,[t])};var pd={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!pd[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=pd.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new ff(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new ff(t[0],t[1]),new ff(t[2],t[1]),new ff(t[2],t[3]),new ff(t[0],t[3]),new ff(t[0],t[1])])},Point:function(t){var e=new ff(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(pd.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=pd.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(pd.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=pd.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],o=1;o<t.length;++o){var s=t[o],a=pd.coordinates.apply(e,[s]),u=e.geometryFactory.createLinearRing(a);i.push(u)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(pd.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},fd={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:fd.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=fd.Point.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var o=r[i];n.push(fd.coordinate.apply(e,[o]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=fd.LineString.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=fd.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var o=t._holes[i],s=fd.LineString.apply(e,[o]);n.push(s.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=fd.Polygon.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=i.getGeometryType();n.push(fd[o].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},gd=function(t){this.geometryFactory=t||new ud,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ld(this.geometryFactory)};gd.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===id.FIXED&&this.reducePrecision(e),e},gd.prototype.reducePrecision=function(t){var e,n,r=this;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)r.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)r.reducePrecision(t.geometries[e])};var dd=function(){this.parser=new ld(this.geometryFactory)};dd.prototype.write=function(t){return this.parser.write(t)};var yd=function(){},_d={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};yd.prototype.interfaces_=function(){return[]},yd.prototype.getClass=function(){return yd},yd.opposite=function(t){return t===yd.LEFT?yd.RIGHT:t===yd.RIGHT?yd.LEFT:t},_d.ON.get=function(){return 0},_d.LEFT.get=function(){return 1},_d.RIGHT.get=function(){return 2},Object.defineProperties(yd,_d),wu.prototype=new Error,wu.prototype.name="EmptyStackException",bu.prototype=new pg,bu.prototype.add=function(t){return this.array_.push(t),!0},bu.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},bu.prototype.push=function(t){return this.array_.push(t),t},bu.prototype.pop=function(t){if(0===this.array_.length)throw new wu;return this.array_.pop()},bu.prototype.peek=function(){if(0===this.array_.length)throw new wu;return this.array_[this.array_.length-1]},bu.prototype.empty=function(){return 0===this.array_.length},bu.prototype.isEmpty=function(){return this.empty()},bu.prototype.search=function(t){return this.array_.indexOf(t)},bu.prototype.size=function(){return this.array_.length},bu.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var vd=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};vd.prototype.getCoordinate=function(){return this._minCoord},vd.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},vd.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();Uf.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=Zf.computeOrientation(this._minCoord,n,e),i=!1;e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===Zf.COUNTERCLOCKWISE?i=!0:e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===Zf.CLOCKWISE&&(i=!0),i&&(this._minIndex=this._minIndex-1)},vd.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),r=n.getCoordinates();if(e<0||e+1>=r.length)return-1;if(r[e].y===r[e+1].y)return-1;var i=yd.LEFT;return r[e].y<r[e+1].y&&(i=yd.RIGHT),i},vd.prototype.getEdge=function(){return this._orientedDe},vd.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(null===e._minCoord||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])},vd.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},vd.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();r.isForward()&&e.checkForRightmostCoordinate(r)}Uf.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===yd.LEFT&&(this._orientedDe=this._minDe.getSym())},vd.prototype.interfaces_=function(){return[]},vd.prototype.getClass=function(){return vd};var md=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new ff(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(jf),xd=function(){this.array_=[]};xd.prototype.addLast=function(t){this.array_.push(t)},xd.prototype.removeFirst=function(){return this.array_.shift()},xd.prototype.isEmpty=function(){return 0===this.array_.length};var Ed=function(){this._finder=null,this._dirEdgeList=new fg,this._nodes=new fg,this._rightMostCoord=null,this._env=null,this._finder=new vd};Ed.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){t.next().setVisited(!1)}},Ed.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Ed.prototype.computeNodeDepth=function(t){for(var e=this,n=null,r=t.getEdges().iterator();r.hasNext();){var i=r.next();if(i.isVisited()||i.getSym().isVisited()){n=i;break}}if(null===n)throw new md("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var o=t.getEdges().iterator();o.hasNext();){var s=o.next();s.setVisited(!0),e.copySymDepths(s)}},Ed.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(yd.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Ed.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Ed.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(yd.RIGHT)>=1&&e.getDepth(yd.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Ed.prototype.computeDepths=function(t){var e=this,n=new wg,r=new xd,i=t.getNode();for(r.addLast(i),n.add(i),t.setVisited(!0);!r.isEmpty();){var o=r.removeFirst();n.add(o),e.computeNodeDepth(o);for(var s=o.getEdges().iterator();s.hasNext();){var a=s.next(),u=a.getSym();if(!u.isVisited()){var c=u.getNode();n.contains(c)||(r.addLast(c),n.add(c))}}}},Ed.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Ed.prototype.getEnvelope=function(){if(null===this._env){for(var t=new Df,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),r=n.getEdge().getCoordinates(),i=0;i<r.length-1;i++)t.expandToInclude(r[i]);this._env=t}return this._env},Ed.prototype.addReachable=function(t){var e=this,n=new bu;for(n.add(t);!n.empty();){var r=n.pop();e.add(r,n)}},Ed.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(yd.LEFT,t.getDepth(yd.RIGHT)),e.setDepth(yd.RIGHT,t.getDepth(yd.LEFT))},Ed.prototype.add=function(t,e){var n=this;t.setVisited(!0),
this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var i=r.next();n._dirEdgeList.add(i);var o=i.getSym(),s=o.getNode();s.isVisited()||e.push(s)}},Ed.prototype.getNodes=function(){return this._nodes},Ed.prototype.getDirectedEdges=function(){return this._dirEdgeList},Ed.prototype.interfaces_=function(){return[hf]},Ed.prototype.getClass=function(){return Ed};var wd=function t(){var e=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[yd.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],u=arguments[2];this.init(3),this.location[yd.ON]=s,this.location[yd.LEFT]=a,this.location[yd.RIGHT]=u}};wd.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t},wd.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==_f.NONE)return!1;return!0},wd.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===_f.NONE&&(e.location[n]=t)},wd.prototype.isLine=function(){return 1===this.location.length},wd.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[yd.ON]=this.location[yd.ON],n[yd.LEFT]=_f.NONE,n[yd.RIGHT]=_f.NONE,this.location=n}for(var r=0;r<this.location.length;r++)e.location[r]===_f.NONE&&r<t.location.length&&(e.location[r]=t.location[r])},wd.prototype.getLocations=function(){return this.location},wd.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[yd.LEFT];this.location[yd.LEFT]=this.location[yd.RIGHT],this.location[yd.RIGHT]=t},wd.prototype.toString=function(){var t=new wf;return this.location.length>1&&t.append(_f.toLocationSymbol(this.location[yd.LEFT])),t.append(_f.toLocationSymbol(this.location[yd.ON])),this.location.length>1&&t.append(_f.toLocationSymbol(this.location[yd.RIGHT])),t.toString()},wd.prototype.setLocations=function(t,e,n){this.location[yd.ON]=t,this.location[yd.LEFT]=e,this.location[yd.RIGHT]=n},wd.prototype.get=function(t){return t<this.location.length?this.location[t]:_f.NONE},wd.prototype.isArea=function(){return this.location.length>1},wd.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===_f.NONE)return!0;return!1},wd.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(yd.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},wd.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(_f.NONE)},wd.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},wd.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0},wd.prototype.interfaces_=function(){return[]},wd.prototype.getClass=function(){return wd};var bd=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new wd(e),this.elt[1]=new wd(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new wd(n.elt[0]),this.elt[1]=new wd(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new wd(_f.NONE),this.elt[1]=new wd(_f.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new wd(o,s,a),this.elt[1]=new wd(o,s,a)}else if(4===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2],l=arguments[3];this.elt[0]=new wd(_f.NONE,_f.NONE,_f.NONE),this.elt[1]=new wd(_f.NONE,_f.NONE,_f.NONE),this.elt[u].setLocations(c,h,l)}};bd.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},bd.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},bd.prototype.isNull=function(t){return this.elt[t].isNull()},bd.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},bd.prototype.isLine=function(t){return this.elt[t].isLine()},bd.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)null===e.elt[n]&&null!==t.elt[n]?e.elt[n]=new wd(t.elt[n]):e.elt[n].merge(t.elt[n])},bd.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},bd.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(yd.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},bd.prototype.toString=function(){var t=new wf;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},bd.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},bd.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},bd.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(yd.ON,e)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},bd.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},bd.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},bd.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new wd(this.elt[t].location[0]))},bd.prototype.interfaces_=function(){return[]},bd.prototype.getClass=function(){return bd},bd.toLineLabel=function(t){for(var e=new bd(_f.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Id=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new fg,this._pts=new fg,this._label=new bd(_f.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new fg,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Id.prototype.computeRing=function(){var t=this;if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=Zf.isCCW(this._ring.getCoordinates())},Id.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Id.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(null===n)throw new md("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new md("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();Uf.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)},Id.prototype.getLinearRing=function(){return this._ring},Id.prototype.getCoordinate=function(t){return this._pts.get(t)},Id.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),r=n.getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Id.prototype.addPoints=function(t,e,n){var r=this,i=t.getCoordinates();if(e){var o=1;n&&(o=0);for(var s=o;s<i.length;s++)r._pts.add(i[s])}else{var a=i.length-2;n&&(a=i.length-1);for(var u=a;u>=0;u--)r._pts.add(i[u])}},Id.prototype.isHole=function(){return this._isHole},Id.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Id.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!Zf.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){if(n.next().containsPoint(t))return!1}return!0},Id.prototype.addHole=function(t){this._holes.add(t)},Id.prototype.isShell=function(){return null===this._shell},Id.prototype.getLabel=function(){return this._label},Id.prototype.getEdges=function(){return this._edges},Id.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Id.prototype.getShell=function(){return this._shell},Id.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=e.getLocation(n,yd.RIGHT);if(r===_f.NONE)return null;if(this._label.getLocation(n)===_f.NONE)return this._label.setLocation(n,r),null}},Id.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Id.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=e._holes.get(r).getLinearRing();return t.createPolygon(this.getLinearRing(),n)},Id.prototype.interfaces_=function(){return[]},Id.prototype.getClass=function(){return Id};var Nd=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Id),Cd=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=this,e=new fg,n=this._startDe;do{if(null===n.getMinEdgeRing()){var r=new Nd(n,t._geometryFactory);e.add(r)}n=n.getNext()}while(n!==this._startDe);return e},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this,e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(t),e=e.getNext()}while(e!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Id),Sd=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Sd.prototype.setVisited=function(t){this._isVisited=t},Sd.prototype.setInResult=function(t){this._isInResult=t},Sd.prototype.isCovered=function(){return this._isCovered},Sd.prototype.isCoveredSet=function(){return this._isCoveredSet},Sd.prototype.setLabel=function(t){this._label=t},Sd.prototype.getLabel=function(){return this._label},Sd.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Sd.prototype.updateIM=function(t){Uf.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Sd.prototype.isInResult=function(){return this._isInResult},Sd.prototype.isVisited=function(){return this._isVisited},Sd.prototype.interfaces_=function(){return[]},Sd.prototype.getClass=function(){return Sd};var Md=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],n=arguments[1];this._coord=e,this._edges=n,this._label=new bd(0,_f.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();){if(t.next().getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=_f.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);n!==_f.BOUNDARY&&(n=r)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this._label?this._label=new bd(e,n):this._label.setLocation(e,n)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof bd)for(var r=arguments[0],i=0;i<2;i++){var o=t.computeMergedLocation(r,i),s=t._label.getLocation(i);s===_f.NONE&&t._label.setLocation(i,o)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=_f.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;switch(e){case _f.BOUNDARY:n=_f.INTERIOR;break;case _f.INTERIOR:default:n=_f.BOUNDARY}this._label.setLocation(t,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Sd),Ld=function(){this.nodeMap=new gu,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Ld.prototype.find=function(t){return this.nodeMap.get(t)},Ld.prototype.addNode=function(){if(arguments[0]instanceof ff){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Md){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},Ld.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Ld.prototype.iterator=function(){return this.nodeMap.values().iterator()},Ld.prototype.values=function(){return this.nodeMap.values()},Ld.prototype.getBoundaryNodes=function(t){for(var e=new fg,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===_f.BOUNDARY&&e.add(r)}return e},Ld.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Ld.prototype.interfaces_=function(){return[]},Ld.prototype.getClass=function(){return Ld};var Pd=function(){},Od={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Pd.prototype.interfaces_=function(){return[]},Pd.prototype.getClass=function(){return Pd},Pd.isNorthern=function(t){return t===Pd.NE||t===Pd.NW},Pd.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Pd.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e,r=t>e?t:e;return 0===n&&3===r?3:n},Pd.isInHalfPlane=function(t,e){return e===Pd.SE?t===Pd.SE||t===Pd.SW:t===e||t===e+1},Pd.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new af("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Pd.NE:Pd.SE:e>=0?Pd.NW:Pd.SW}if(arguments[0]instanceof ff&&arguments[1]instanceof ff){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new af("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Pd.NE:Pd.SE:r.y>=n.y?Pd.NW:Pd.SW}},Od.NE.get=function(){return 0},Od.NW.get=function(){return 1},Od.SW.get=function(){return 2},Od.SE.get=function(){return 3},Object.defineProperties(Pd,Od);var Rd=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];this._edge=e,this.init(n,r),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=i,this.init(o,s),this._label=a}};Rd.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Zf.computeOrientation(t._p0,t._p1,this._p1)},Rd.prototype.getDy=function(){return this._dy},Rd.prototype.getCoordinate=function(){return this._p0},Rd.prototype.setNode=function(t){this._node=t},Rd.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Rd.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Rd.prototype.getDirectedCoordinate=function(){return this._p1},Rd.prototype.getDx=function(){return this._dx},Rd.prototype.getLabel=function(){return this._label},Rd.prototype.getEdge=function(){return this._edge},Rd.prototype.getQuadrant=function(){return this._quadrant},Rd.prototype.getNode=function(){return this._node},Rd.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Rd.prototype.computeLabel=function(t){},Rd.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Pd.quadrant(this._dx,this._dy),Uf.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Rd.prototype.interfaces_=function(){return[hf]},Rd.prototype.getClass=function(){return Rd};var Td=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new bd(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new md("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,n=0;n<2;n++)t._label.isArea(n)&&t._label.getLocation(n,yd.LEFT)===_f.INTERIOR&&t._label.getLocation(n,yd.RIGHT)===_f.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[yd.LEFT]+"/"+this._depth[yd.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,_f.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,_f.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;t===yd.LEFT&&(r=-1);var i=yd.opposite(t),o=n*r,s=e+o;this.setDepth(t,e),this.setDepth(i,s)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===_f.EXTERIOR&&e===_f.INTERIOR?1:t===_f.INTERIOR&&e===_f.EXTERIOR?-1:0},e}(Rd),Ad=function(){};Ad.prototype.createNode=function(t){return new Md(t,null)},Ad.prototype.interfaces_=function(){return[]},Ad.prototype.getClass=function(){return Ad};var Dd=function(){if(this._edges=new fg,this._nodes=null,this._edgeEndList=new fg,0===arguments.length)this._nodes=new Ld(new Ad);else if(1===arguments.length){var t=arguments[0];this._nodes=new Ld(t)}};Dd.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var r=e._edges.get(n);r.print(t),r.eiList.print(t)}},Dd.prototype.find=function(t){return this._nodes.find(t)},Dd.prototype.addNode=function(){if(arguments[0]instanceof Md){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof ff){var e=arguments[0];return this._nodes.addNode(e)}},Dd.prototype.getNodeIterator=function(){return this._nodes.iterator()},Dd.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkResultDirectedEdges()}},Dd.prototype.debugPrintln=function(t){Tf.out.println(t)},Dd.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(t)===_f.BOUNDARY},Dd.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkAllDirectedEdges()}},Dd.prototype.matchInSameDirection=function(t,e,n,r){return!!t.equals(n)&&(Zf.computeOrientation(t,e,r)===Zf.COLLINEAR&&Pd.quadrant(t,e)===Pd.quadrant(n,r))},Dd.prototype.getEdgeEnds=function(){return this._edgeEndList},Dd.prototype.debugPrint=function(t){Tf.out.print(t)},Dd.prototype.getEdgeIterator=function(){return this._edges.iterator()},Dd.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(n.matchInSameDirection(t,e,o[0],o[1]))return i;if(n.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return i}return null},Dd.prototype.insertEdge=function(t){this._edges.add(t)},Dd.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Dd.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new Td(r,!0),o=new Td(r,!1);i.setSym(o),o.setSym(i),e.add(i),e.add(o)}},Dd.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Dd.prototype.getNodes=function(){return this._nodes.values()},Dd.prototype.findEdge=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(t.equals(o[0])&&e.equals(o[1]))return i}return null},Dd.prototype.interfaces_=function(){return[]},Dd.prototype.getClass=function(){return Dd},Dd.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){e.next().getEdges().linkResultDirectedEdges()}};var Fd=function(){this._geometryFactory=null,this._shellList=new fg;var t=arguments[0];this._geometryFactory=t};Fd.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}},Fd.prototype.computePolygons=function(t){for(var e=this,n=new fg,r=t.iterator();r.hasNext();){var i=r.next(),o=i.toPolygon(e._geometryFactory);n.add(o)}return n},Fd.prototype.placeFreeHoles=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(null===i.getShell()){var o=n.findEdgeRingContaining(i,t);if(null===o)throw new md("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(o)}}},Fd.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=this,i=new fg,o=t.iterator();o.hasNext();){var s=o.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var a=s.buildMinimalRings(),u=r.findShell(a);null!==u?(r.placePolygonHoles(u,a),e.add(u)):n.addAll(a)}else i.add(s)}return i},Fd.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){if(e.next().containsPoint(t))return!0}return!1},Fd.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new fg,r=t.iterator();r.hasNext();){var i=r.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var o=new Cd(i,e._geometryFactory);n.add(o),o.setInResult()}}return n},Fd.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}},Fd.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Fd.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var u=a.next(),c=u.getLinearRing(),h=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var l=!1;h.contains(r)&&Zf.isPointInRing(i,c.getCoordinates())&&(l=!0),l&&(null===o||s.contains(h))&&(o=u)}return o},Fd.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return Uf.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},Fd.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Dd.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new fg,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},Fd.prototype.interfaces_=function(){return[]},Fd.prototype.getClass=function(){return Fd};var qd=function(){};qd.prototype.getBounds=function(){},qd.prototype.interfaces_=function(){return[]},qd.prototype.getClass=function(){return qd};var Gd=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Gd.prototype.getItem=function(){return this._item},Gd.prototype.getBounds=function(){return this._bounds},Gd.prototype.interfaces_=function(){return[qd,ou]},Gd.prototype.getClass=function(){return Gd};var Bd=function(){this._size=null,this._items=null,this._size=0,this._items=new fg,this._items.add(null)};Bd.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Bd.prototype.size=function(){return this._size},Bd.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);2*t<=this._size&&(n=2*t,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)},Bd.prototype.clear=function(){this._size=0,this._items.clear()},Bd.prototype.isEmpty=function(){return 0===this._size},Bd.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)},Bd.prototype.interfaces_=function(){return[]},Bd.prototype.getClass=function(){return Bd};var kd=function(){};kd.prototype.visitItem=function(t){},kd.prototype.interfaces_=function(){return[]},kd.prototype.getClass=function(){return kd};var zd=function(){};zd.prototype.insert=function(t,e){},zd.prototype.remove=function(t,e){},zd.prototype.query=function(){},zd.prototype.interfaces_=function(){return[]},zd.prototype.getClass=function(){return zd};var jd=function(){if(this._childBoundables=new fg,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Xd={serialVersionUID:{configurable:!0}};jd.prototype.getLevel=function(){return this._level},jd.prototype.size=function(){return this._childBoundables.size()},jd.prototype.getChildBoundables=function(){return this._childBoundables},jd.prototype.addChildBoundable=function(t){Uf.isTrue(null===this._bounds),this._childBoundables.add(t)},jd.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},jd.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},jd.prototype.interfaces_=function(){return[qd,ou]},jd.prototype.getClass=function(){return jd},Xd.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(jd,Xd);var Ud=function(){};Ud.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Ud.min=function(t){return Ud.sort(t),t.get(0)},Ud.sort=function(t,e){var n=t.toArray();e?Sg.sort(n,e):Sg.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},Ud.singletonList=function(t){var e=new fg;return e.add(t),e};var Yd=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};Yd.prototype.expandToQueue=function(t,e){var n=Yd.isComposite(this._boundable1),r=Yd.isComposite(this._boundable2);if(n&&r)return Yd.area(this._boundable1)>Yd.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new af("neither boundable is composite")},Yd.prototype.isLeaves=function(){return!(Yd.isComposite(this._boundable1)||Yd.isComposite(this._boundable2))},Yd.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},Yd.prototype.expand=function(t,e,n,r){for(var i=this,o=t.getChildBoundables(),s=o.iterator();s.hasNext();){var a=s.next(),u=new Yd(a,e,i._itemDistance);u.getDistance()<r&&n.add(u)}},Yd.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},Yd.prototype.getDistance=function(){return this._distance},Yd.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Yd.prototype.interfaces_=function(){return[hf]},Yd.prototype.getClass=function(){return Yd},Yd.area=function(t){return t.getBounds().getArea()},Yd.isComposite=function(t){return t instanceof jd};var Vd=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new fg,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var n=arguments[0];Uf.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},Hd={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Vd.prototype.getNodeCapacity=function(){return this._nodeCapacity},Vd.prototype.lastNode=function(t){return t.get(t.size()-1)},Vd.prototype.size=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof jd?n+=t.size(i):i instanceof Gd&&(n+=1)}return n}},Vd.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Gd&&i.getItem()===e&&(n=i)}return null!==n&&(t.getChildBoundables().remove(n),!0)},Vd.prototype.itemsTree=function(){var t=this
;if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new fg:e}if(1===arguments.length){for(var n=arguments[0],r=new fg,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof jd){var s=t.itemsTree(o);null!==s&&r.add(s)}else o instanceof Gd?r.add(o.getItem()):Uf.shouldNeverReachHere()}return r.size()<=0?null:r}},Vd.prototype.insert=function(t,e){Uf.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Gd(t,e))},Vd.prototype.boundablesAtLevel=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new fg;return this.boundablesAtLevel(e,this._root,n),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(Uf.isTrue(r>-2),i.getLevel()===r)return o.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof jd?t.boundablesAtLevel(r,a,o):(Uf.isTrue(a instanceof Gd),-1===r&&o.add(a))}return null}},Vd.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var n=new fg;return this.isEmpty()?n:(this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n)}if(2===arguments.length){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(3===arguments.length)if(mf(arguments[2],kd)&&arguments[0]instanceof Object&&arguments[1]instanceof jd)for(var o=arguments[0],s=arguments[1],a=arguments[2],u=s.getChildBoundables(),c=0;c<u.size();c++){var h=u.get(c);t.getIntersectsOp().intersects(h.getBounds(),o)&&(h instanceof jd?t.query(o,h,a):h instanceof Gd?a.visitItem(h.getItem()):Uf.shouldNeverReachHere())}else if(mf(arguments[2],pg)&&arguments[0]instanceof Object&&arguments[1]instanceof jd)for(var l=arguments[0],p=arguments[1],f=arguments[2],g=p.getChildBoundables(),d=0;d<g.size();d++){var y=g.get(d);t.getIntersectsOp().intersects(y.getBounds(),l)&&(y instanceof jd?t.query(l,y,f):y instanceof Gd?f.add(y.getItem()):Uf.shouldNeverReachHere())}},Vd.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Vd.prototype.getRoot=function(){return this.build(),this._root},Vd.prototype.remove=function(){var t=this;if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,n)}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=this.removeItem(i,o);if(s)return!0;for(var a=null,u=i.getChildBoundables().iterator();u.hasNext();){var c=u.next();if(t.getIntersectsOp().intersects(c.getBounds(),r)&&(c instanceof jd&&(s=t.remove(r,c,o)))){a=c;break}}return null!==a&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),s}},Vd.prototype.createHigherLevels=function(t,e){Uf.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},Vd.prototype.depth=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof jd){var o=t.depth(i);o>n&&(n=o)}}return n+1}},Vd.prototype.createParentBoundables=function(t,e){var n=this;Uf.isTrue(!t.isEmpty());var r=new fg;r.add(this.createNode(e));var i=new fg(t);Ud.sort(i,this.getComparator());for(var o=i.iterator();o.hasNext();){var s=o.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(s)}return r},Vd.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Vd.prototype.interfaces_=function(){return[ou]},Vd.prototype.getClass=function(){return Vd},Vd.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},Hd.IntersectsOp.get=function(){return Wd},Hd.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Hd.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Vd,Hd);var Wd=function(){},Jd=function(){};Jd.prototype.distance=function(t,e){},Jd.prototype.interfaces_=function(){return[]},Jd.prototype.getClass=function(){return Jd};var Zd=function(t){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,t.call(this,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){var n=this;Uf.isTrue(t.length>0);for(var r=new fg,i=0;i<t.length;i++)r.addAll(n.createParentBoundablesFromVerticalSlice(t[i],e));return r},e.prototype.createNode=function(t){return new Kd(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){r[o]=new fg;for(var s=0;i.hasNext()&&s<n;){var a=i.next();r[o].add(a),s++}}return r},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];t.prototype.query.call(this,n,r)}else if(3===arguments.length)if(mf(arguments[2],kd)&&arguments[0]instanceof Object&&arguments[1]instanceof jd){var i=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,i,o,s)}else if(mf(arguments[2],pg)&&arguments[0]instanceof Object&&arguments[1]instanceof jd){var a=arguments[0],u=arguments[1],c=arguments[2];t.prototype.query.call(this,a,u,c)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return t.prototype.remove.call(this,e,n)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,n){Uf.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new fg(t);Ud.sort(i,e.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,n)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(mf(arguments[0],Jd)){var t=arguments[0],n=new Yd(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof Yd){var r=arguments[0];return this.nearestNeighbour(r,uf.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&mf(arguments[1],Jd)){var i=arguments[0],o=arguments[1],s=new Yd(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof Yd&&"number"==typeof arguments[1]){var a=arguments[0],u=arguments[1],c=u,h=null,l=new Bd;for(l.add(a);!l.isEmpty()&&c>0;){var p=l.poll(),f=p.getDistance();if(f>=c)break;p.isLeaves()?(c=f,h=p):p.expandToQueue(l,c)}return[h.getBoundable(0).getItem(),h.getBoundable(1).getItem()]}}else if(3===arguments.length){var g=arguments[0],d=arguments[1],y=arguments[2],_=new Gd(g,d),v=new Yd(this.getRoot(),_,y);return this.nearestNeighbour(v)[0]}},e.prototype.interfaces_=function(){return[zd,ou]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return Kd},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[pf]},compare:function(n,r){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[pf]},compare:function(n,r){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Vd),Kd=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new Df(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jd),Qd=function(){};Qd.prototype.interfaces_=function(){return[]},Qd.prototype.getClass=function(){return Qd},Qd.relativeSign=function(t,e){return t<e?-1:t>e?1:0},Qd.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=Qd.relativeSign(e.x,n.x),i=Qd.relativeSign(e.y,n.y);switch(t){case 0:return Qd.compareValue(r,i);case 1:return Qd.compareValue(i,r);case 2:return Qd.compareValue(i,-r);case 3:return Qd.compareValue(-r,i);case 4:return Qd.compareValue(-r,-i);case 5:return Qd.compareValue(-i,-r);case 6:return Qd.compareValue(-i,r);case 7:return Qd.compareValue(r,-i)}return Uf.shouldNeverReachHere("invalid octant value"),0},Qd.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var $d=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new ff(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};$d.prototype.getCoordinate=function(){return this.coord},$d.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},$d.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Qd.compare(this._segmentOctant,this.coord,e.coord)},$d.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},$d.prototype.isInterior=function(){return this._isInterior},$d.prototype.interfaces_=function(){return[hf]},$d.prototype.getClass=function(){return $d};var ty=function(){this._nodeMap=new gu,this._edge=null;var t=arguments[0];this._edge=t};ty.prototype.getSplitCoordinates=function(){var t=this,e=new dg;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();t.addEdgeCoordinates(r,i,e),r=i}return e.toCoordinateArray()},ty.prototype.addCollapsedNodes=function(){var t=this,e=new fg;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();t.add(t._edge.getCoordinate(r),r)}},ty.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},ty.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var r=e._edge.getCoordinate(n),i=e._edge.getCoordinate(n+2);r.equals2D(i)&&t.add(new bf(n+1))}},ty.prototype.addEdgeCoordinates=function(t,e,n){var r=this,i=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(i);n.add(new ff(t.coord),!1);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)n.add(r._edge.getCoordinate(s));o&&n.add(new ff(e.coord))},ty.prototype.iterator=function(){return this._nodeMap.values().iterator()},ty.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),o=e.createSplitEdge(r,i);t.add(o),r=i}},ty.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(n[0]=t.segmentIndex+1,!0)},ty.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),r=this.iterator(),i=r.next();r.hasNext();){var o=r.next();e.findCollapseIndex(i,o,n)&&t.add(new bf(n[0])),i=o}},ty.prototype.getEdge=function(){return this._edge},ty.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},ty.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(i);o||r--;var s=new Array(r).fill(null),a=0;s[a++]=new ff(t.coord);for(var u=t.segmentIndex+1;u<=e.segmentIndex;u++)s[a++]=n._edge.getCoordinate(u);return o&&(s[a]=new ff(e.coord)),new iy(s,this._edge.getData())},ty.prototype.add=function(t,e){var n=new $d(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return null!==r?(Uf.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},ty.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),r=n.getCoordinate(0);if(!r.equals2D(e[0]))throw new jf("bad split edge start point at "+r);var i=t.get(t.size()-1),o=i.getCoordinates(),s=o[o.length-1];if(!s.equals2D(e[e.length-1]))throw new jf("bad split edge end point at "+s)},ty.prototype.interfaces_=function(){return[]},ty.prototype.getClass=function(){return ty};var ey=function(){};ey.prototype.interfaces_=function(){return[]},ey.prototype.getClass=function(){return ey},ey.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new af("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof ff&&arguments[1]instanceof ff){var i=arguments[0],o=arguments[1],s=o.x-i.x,a=o.y-i.y;if(0===s&&0===a)throw new af("Cannot compute the octant for two identical points "+i);return ey.octant(s,a)}};var ny=function(){};ny.prototype.getCoordinates=function(){},ny.prototype.size=function(){},ny.prototype.getCoordinate=function(t){},ny.prototype.isClosed=function(){},ny.prototype.setData=function(t){},ny.prototype.getData=function(){},ny.prototype.interfaces_=function(){return[]},ny.prototype.getClass=function(){return ny};var ry=function(){};ry.prototype.addIntersection=function(t,e){},ry.prototype.interfaces_=function(){return[ny]},ry.prototype.getClass=function(){return ry};var iy=function(){this._nodeList=new ty(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};iy.prototype.getCoordinates=function(){return this._pts},iy.prototype.size=function(){return this._pts.length},iy.prototype.getCoordinate=function(t){return this._pts[t]},iy.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},iy.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},iy.prototype.setData=function(t){this._data=t},iy.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ey.octant(t,e)},iy.prototype.getData=function(){return this._data},iy.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[3],o=new ff(n.getIntersection(i));this.addIntersection(o,r)}},iy.prototype.toString=function(){return zf.toLineString(new $g(this._pts))},iy.prototype.getNodeList=function(){return this._nodeList},iy.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}return this._nodeList.add(t,n)},iy.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)},iy.prototype.interfaces_=function(){return[ry]},iy.prototype.getClass=function(){return iy},iy.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new fg;return iy.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();o.getNodeList().addSplitEdges(r)}};var oy=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new ff,this.p1=new ff;else if(1===arguments.length){var t=arguments[0];this.p0=new ff(t.p0),this.p1=new ff(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new ff(e,n),this.p1=new ff(r,i)}},sy={serialVersionUID:{configurable:!0}};oy.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},oy.prototype.orientationIndex=function(){if(arguments[0]instanceof oy){var t=arguments[0],e=Zf.orientationIndex(this.p0,this.p1,t.p0),n=Zf.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0?Math.max(e,n):e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof ff){var r=arguments[0];return Zf.orientationIndex(this.p0,this.p1,r)}},oy.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},oy.prototype.isVertical=function(){return this.p0.x===this.p1.x},oy.prototype.equals=function(t){if(!(t instanceof oy))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},oy.prototype.intersection=function(t){var e=new Hf;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},oy.prototype.project=function(){if(arguments[0]instanceof ff){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new ff(t);var e=this.projectionFactor(t),n=new ff;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof oy){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var s=this.project(r.p0);i<0&&(s=this.p0),i>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new oy(s,a)}},oy.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},oy.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},oy.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},oy.prototype.distancePerpendicular=function(t){return Zf.distancePointLinePerpendicular(t,this.p0,this.p1)},oy.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},oy.prototype.midPoint=function(){return oy.midPoint(this.p0,this.p1)},oy.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;return r<=0?uf.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},oy.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=uf.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var s=this.closestPoint(t.p1);(i=s.distance(t.p1))<r&&(r=i,n[0]=s,n[1]=t.p1);var a=t.closestPoint(this.p0);(i=a.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=a);var u=t.closestPoint(this.p1);return i=u.distance(this.p1),i<r&&(r=i,n[0]=this.p1,n[1]=u),n},oy.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},oy.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},oy.prototype.getLength=function(){return this.p0.distance(this.p1)},oy.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},oy.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},oy.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},oy.prototype.lineIntersection=function(t){try{return Af.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof Rf))throw t}return null},oy.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},oy.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(i*i+o*o),a=0,u=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*i/s,u=e*o/s}return new ff(n-u,r+a)},oy.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},oy.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||uf.isNaN(e))&&(e=1),e},oy.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},oy.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},oy.prototype.distance=function(){if(arguments[0]instanceof oy){var t=arguments[0];return Zf.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof ff){var e=arguments[0];return Zf.distancePointLine(e,this.p0,this.p1)}},oy.prototype.pointAlong=function(t){var e=new ff;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},oy.prototype.hashCode=function(){var t=uf.doubleToLongBits(this.p0.x);t^=31*uf.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=uf.doubleToLongBits(this.p1.x);return n^=31*uf.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},oy.prototype.interfaces_=function(){return[hf,ou]},oy.prototype.getClass=function(){return oy},oy.midPoint=function(t,e){return new ff((t.x+e.x)/2,(t.y+e.y)/2)},sy.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(oy,sy);var ay=function(){this.tempEnv1=new Df,this.tempEnv2=new Df,this._overlapSeg1=new oy,this._overlapSeg2=new oy};ay.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},ay.prototype.interfaces_=function(){return[]},ay.prototype.getClass=function(){return ay};var uy=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};uy.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},uy.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var s=Math.trunc((e+n)/2);e<s&&this.computeSelect(t,e,s,r),s<n&&this.computeSelect(t,s,n,r)},uy.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=t._pts[r];return e},uy.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},uy.prototype.setId=function(t){this._id=t},uy.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},uy.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Df(t,e)}return this._env},uy.prototype.getEndIndex=function(){return this._end},uy.prototype.getStartIndex=function(){return this._start},uy.prototype.getContext=function(){return this._context},uy.prototype.getId=function(){return this._id},uy.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var s=this._pts[t],a=this._pts[e],u=n._pts[r],c=n._pts[i];if(e-t==1&&i-r==1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(u,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var h=Math.trunc((t+e)/2),l=Math.trunc((r+i)/2);t<h&&(r<l&&this.computeOverlapsInternal(t,h,n,r,l,o),l<i&&this.computeOverlapsInternal(t,h,n,l,i,o)),h<e&&(r<l&&this.computeOverlapsInternal(h,e,n,r,l,o),l<i&&this.computeOverlapsInternal(h,e,n,l,i,o))},uy.prototype.interfaces_=function(){return[]},uy.prototype.getClass=function(){return uy};var cy=function(){};cy.prototype.interfaces_=function(){return[]},cy.prototype.getClass=function(){return cy},cy.getChainStartIndices=function(t){var e=0,n=new fg;n.add(new bf(e));do{var r=cy.findChainEnd(t,e);n.add(new bf(r)),e=r}while(e<t.length-1);return cy.toIntArray(n)},cy.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Pd.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){if(Pd.quadrant(t[i-1],t[i])!==r)break}i++}return i-1},cy.getChains=function(){if(1===arguments.length){var t=arguments[0];return cy.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=new fg,i=cy.getChainStartIndices(e),o=0;o<i.length-1;o++){var s=new uy(e,i[o],i[o+1],n);r.add(s)}return r}},cy.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var hy=function(){};hy.prototype.computeNodes=function(t){},hy.prototype.getNodedSubstrings=function(){},hy.prototype.interfaces_=function(){return[]},hy.prototype.getClass=function(){return hy};var ly=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};ly.prototype.setSegmentIntersector=function(t){this._segInt=t},ly.prototype.interfaces_=function(){return[hy]},ly.prototype.getClass=function(){return ly};var py=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new fg,this._index=new Zd,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return iy.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=this,n=cy.getChains(t.getCoordinates(),t),r=n.iterator();r.hasNext();){var i=r.next();i.setId(e._idCounter++),e._index.insert(i.getEnvelope(),i),e._monoChains.add(i)}},e.prototype.computeNodes=function(t){var e=this;this._nodedSegStrings=t;for(var n=t.iterator();n.hasNext();)e.add(n.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new fy(this._segInt),n=this._monoChains.iterator();n.hasNext();)for(var r=n.next(),i=t._index.query(r.getEnvelope()),o=i.iterator();o.hasNext();){var s=o.next();if(s.getId()>r.getId()&&(r.computeOverlaps(s,e),t._nOverlaps++),t._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return fy},Object.defineProperties(e,n),e}(ly),fy=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=e.getContext(),s=r.getContext();this._si.processIntersections(o,n,s,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ay),gy=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},dy={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};gy.prototype.getEndCapStyle=function(){return this._endCapStyle},gy.prototype.isSingleSided=function(){return this._isSingleSided},gy.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=gy.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=gy.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==gy.JOIN_ROUND&&(this._quadrantSegments=gy.DEFAULT_QUADRANT_SEGMENTS)},gy.prototype.getJoinStyle=function(){return this._joinStyle},gy.prototype.setJoinStyle=function(t){this._joinStyle=t},gy.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},gy.prototype.getSimplifyFactor=function(){return this._simplifyFactor},gy.prototype.getQuadrantSegments=function(){return this._quadrantSegments},gy.prototype.setEndCapStyle=function(t){this._endCapStyle=t},gy.prototype.getMitreLimit=function(){return this._mitreLimit},gy.prototype.setMitreLimit=function(t){this._mitreLimit=t},gy.prototype.setSingleSided=function(t){this._isSingleSided=t},gy.prototype.interfaces_=function(){return[]},gy.prototype.getClass=function(){return gy},gy.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},dy.CAP_ROUND.get=function(){return 1},dy.CAP_FLAT.get=function(){return 2},dy.CAP_SQUARE.get=function(){return 3},dy.JOIN_ROUND.get=function(){return 1},dy.JOIN_MITRE.get=function(){return 2},dy.JOIN_BEVEL.get=function(){return 3},dy.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},dy.DEFAULT_MITRE_LIMIT.get=function(){return 5},dy.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(gy,dy);var yy=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Zf.COUNTERCLOCKWISE,this._inputLine=t||null},_y={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};yy.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[n];return!!this.isConcave(i,o,s)&&(!!this.isShallow(i,o,s,r)&&this.isShallowSampled(i,o,t,n,r))},yy.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var o=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=yy.DELETE,o=!0,i=!0),e=o?r:n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i},yy.prototype.isShallowConcavity=function(t,e,n,r){return Zf.computeOrientation(t,e,n)===this._angleOrientation&&Zf.distancePointLine(e,t,n)<r},yy.prototype.isShallowSampled=function(t,e,n,r,i){var o=this,s=Math.trunc((r-n)/yy.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var a=n;a<r;a+=s)if(!o.isShallow(t,e,o._inputLine[a],i))return!1;return!0},yy.prototype.isConcave=function(t,e,n){return Zf.computeOrientation(t,e,n)===this._angleOrientation},yy.prototype.simplify=function(t){var e=this
;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Zf.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do{n=e.deleteShallowConcavities()}while(n);return this.collapseLine()},yy.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===yy.DELETE;)e++;return e},yy.prototype.isShallow=function(t,e,n,r){return Zf.distancePointLine(e,t,n)<r},yy.prototype.collapseLine=function(){for(var t=this,e=new dg,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==yy.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()},yy.prototype.interfaces_=function(){return[]},yy.prototype.getClass=function(){return yy},yy.simplify=function(t,e){return new yy(t).simplify(e)},_y.INIT.get=function(){return 0},_y.DELETE.get=function(){return 1},_y.KEEP.get=function(){return 1},_y.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(yy,_y);var vy=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new fg},my={COORDINATE_ARRAY_TYPE:{configurable:!0}};vy.prototype.getCoordinates=function(){return this._ptList.toArray(vy.COORDINATE_ARRAY_TYPE)},vy.prototype.setPrecisionModel=function(t){this._precisionModel=t},vy.prototype.addPt=function(t){var e=new ff(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},vy.prototype.revere=function(){},vy.prototype.addPts=function(t,e){var n=this;if(e)for(var r=0;r<t.length;r++)n.addPt(t[r]);else for(var i=t.length-1;i>=0;i--)n.addPt(t[i])},vy.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},vy.prototype.toString=function(){return(new ud).createLineString(this.getCoordinates()).toString()},vy.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new ff(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},vy.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},vy.prototype.interfaces_=function(){return[]},vy.prototype.getClass=function(){return vy},my.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(vy,my);var xy=function(){},Ey={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};xy.prototype.interfaces_=function(){return[]},xy.prototype.getClass=function(){return xy},xy.toDegrees=function(t){return 180*t/Math.PI},xy.normalize=function(t){for(;t>Math.PI;)t-=xy.PI_TIMES_2;for(;t<=-Math.PI;)t+=xy.PI_TIMES_2;return t},xy.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}},xy.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)>0},xy.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0},xy.interiorAngle=function(t,e,n){var r=xy.angle(e,t),i=xy.angle(e,n);return Math.abs(i-r)},xy.normalizePositive=function(t){if(t<0){for(;t<0;)t+=xy.PI_TIMES_2;t>=xy.PI_TIMES_2&&(t=0)}else{for(;t>=xy.PI_TIMES_2;)t-=xy.PI_TIMES_2;t<0&&(t=0)}return t},xy.angleBetween=function(t,e,n){var r=xy.angle(e,t),i=xy.angle(e,n);return xy.diff(r,i)},xy.diff=function(t,e){var n=null;return n=t<e?e-t:t-e,n>Math.PI&&(n=2*Math.PI-n),n},xy.toRadians=function(t){return t*Math.PI/180},xy.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?xy.COUNTERCLOCKWISE:n<0?xy.CLOCKWISE:xy.NONE},xy.angleBetweenOriented=function(t,e,n){var r=xy.angle(e,t),i=xy.angle(e,n),o=i-r;return o<=-Math.PI?o+xy.PI_TIMES_2:o>Math.PI?o-xy.PI_TIMES_2:o},Ey.PI_TIMES_2.get=function(){return 2*Math.PI},Ey.PI_OVER_2.get=function(){return Math.PI/2},Ey.PI_OVER_4.get=function(){return Math.PI/4},Ey.COUNTERCLOCKWISE.get=function(){return Zf.COUNTERCLOCKWISE},Ey.CLOCKWISE.get=function(){return Zf.CLOCKWISE},Ey.NONE.get=function(){return Zf.COLLINEAR},Object.defineProperties(xy,Ey);var wy=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new oy,this._seg1=new oy,this._offset0=new oy,this._offset1=new oy,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new Hf,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===gy.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},by={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};wy.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=Zf.computeOrientation(this._s0,this._s1,this._s2),r=n===Zf.CLOCKWISE&&this._side===yd.LEFT||n===Zf.COUNTERCLOCKWISE&&this._side===yd.RIGHT;0===n?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},wy.prototype.addLineEndCap=function(t,e){var n=new oy(t,e),r=new oy;this.computeOffsetSegment(n,yd.LEFT,this._distance,r);var i=new oy;this.computeOffsetSegment(n,yd.RIGHT,this._distance,i);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case gy.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,Zf.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case gy.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case gy.CAP_SQUARE:var u=new ff;u.x=Math.abs(this._distance)*Math.cos(a),u.y=Math.abs(this._distance)*Math.sin(a);var c=new ff(r.p1.x+u.x,r.p1.y+u.y),h=new ff(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(c),this._segList.addPt(h)}},wy.prototype.getCoordinates=function(){return this._segList.getCoordinates()},wy.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=Af.intersection(e.p0,e.p1,n.p0,n.p1);(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof Rf))throw t;o=new ff(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())},wy.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),u=n.x-t.x,c=n.y-t.y,h=Math.atan2(c,u);r===Zf.CLOCKWISE?a<=h&&(a+=2*Math.PI):a>=h&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,h,r,i),this._segList.addPt(n)},wy.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*wy.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===gy.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===gy.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},wy.prototype.createSquare=function(t){this._segList.addPt(new ff(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new ff(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new ff(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new ff(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},wy.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},wy.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},wy.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},wy.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},wy.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=xy.angle(i,this._seg0.p0),s=xy.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),a=s/2,u=xy.normalize(o+a),c=xy.normalize(u+Math.PI),h=r*n,l=h*Math.abs(Math.sin(a)),p=n-l,f=i.x+h*Math.cos(c),g=i.y+h*Math.sin(c),d=new ff(f,g),y=new oy(i,d),_=y.pointAlongOffset(1,p),v=y.pointAlongOffset(1,-p);this._side===yd.LEFT?(this._segList.addPt(_),this._segList.addPt(v)):(this._segList.addPt(v),this._segList.addPt(_))},wy.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===yd.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),u=i*n*o/a,c=i*n*s/a;r.p0.x=t.p0.x-c,r.p0.y=t.p0.y+u,r.p1.x=t.p1.x-c,r.p1.y=t.p1.y+u},wy.prototype.addFilletArc=function(t,e,n,r,i){var o=this,s=r===Zf.CLOCKWISE?-1:1,a=Math.abs(e-n),u=Math.trunc(a/this._filletAngleQuantum+.5);if(u<1)return null;for(var c=a/u,h=0,l=new ff;h<a;){var p=e+s*h;l.x=t.x+i*Math.cos(p),l.y=t.y+i*Math.sin(p),o._segList.addPt(l),h+=c}},wy.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*wy.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new ff((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new ff((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},wy.prototype.createCircle=function(t){var e=new ff(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},wy.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},wy.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new vy,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*wy.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},wy.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===gy.JOIN_BEVEL||this._bufParams.getJoinStyle()===gy.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Zf.CLOCKWISE,this._distance))},wy.prototype.closeRing=function(){this._segList.closeRing()},wy.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},wy.prototype.interfaces_=function(){return[]},wy.prototype.getClass=function(){return wy},by.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},by.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},by.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},by.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(wy,by);var Iy=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Iy.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&yg.reverse(o),o},Iy.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=yy.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],yd.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{n.addSegments(t,!1);var a=yy.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],yd.LEFT),n.addFirstSegment();for(var c=2;c<=u;c++)n.addNextSegment(a[c],!0)}n.addLastSegment(),n.closeRing()},Iy.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===yd.RIGHT&&(r=-r);var i=yy.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var s=1;s<=o;s++){var a=1!==s;n.addNextSegment(i[s],a)}n.closeRing()},Iy.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=yy.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],yd.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var s=yy.simplify(t,-n),a=s.length-1;e.initSideSegments(s[a],s[a-1],yd.LEFT);for(var u=a-2;u>=0;u--)e.addNextSegment(s[u],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Iy.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case gy.CAP_ROUND:e.createCircle(t);break;case gy.CAP_SQUARE:e.createSquare(t)}},Iy.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},Iy.prototype.getBufferParameters=function(){return this._bufParams},Iy.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Iy.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Iy.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},Iy.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=yy.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],yd.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{var a=yy.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],yd.LEFT),n.addFirstSegment();for(var c=2;c<=u;c++)n.addNextSegment(a[c],!0)}n.addLastSegment()},Iy.prototype.getSegGen=function(t){return new wy(this._precisionModel,this._bufParams,t)},Iy.prototype.interfaces_=function(){return[]},Iy.prototype.getClass=function(){return Iy},Iy.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new ff(t[n]);return e};var Ny=function(){this._subgraphs=null,this._seg=new oy,this._cga=new Zf;var t=arguments[0];this._subgraphs=t},Cy={DepthSegment:{configurable:!0}};Ny.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=new fg,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),o=i.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}if(3===arguments.length)if(mf(arguments[2],pg)&&arguments[0]instanceof ff&&arguments[1]instanceof Td)for(var s=arguments[0],a=arguments[1],u=arguments[2],c=a.getEdge().getCoordinates(),h=0;h<c.length-1;h++){t._seg.p0=c[h],t._seg.p1=c[h+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var l=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(l<s.x)&&!(t._seg.isHorizontal()||s.y<t._seg.p0.y||s.y>t._seg.p1.y||Zf.computeOrientation(t._seg.p0,t._seg.p1,s)===Zf.RIGHT)){var p=a.getDepth(yd.LEFT);t._seg.p0.equals(c[h])||(p=a.getDepth(yd.RIGHT));var f=new Sy(t._seg,p);u.add(f)}}else if(mf(arguments[2],pg)&&arguments[0]instanceof ff&&mf(arguments[1],pg))for(var g=arguments[0],d=arguments[1],y=arguments[2],_=d.iterator();_.hasNext();){var v=_.next();v.isForward()&&t.findStabbedSegments(g,v,y)}},Ny.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Ud.min(e)._leftDepth},Ny.prototype.interfaces_=function(){return[]},Ny.prototype.getClass=function(){return Ny},Cy.DepthSegment.get=function(){return Sy},Object.defineProperties(Ny,Cy);var Sy=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new oy(t),this._leftDepth=e};Sy.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n?n:(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),0!==n?n:this._upwardSeg.compareTo(e._upwardSeg))},Sy.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Sy.prototype.toString=function(){return this._upwardSeg.toString()},Sy.prototype.interfaces_=function(){return[hf]},Sy.prototype.getClass=function(){return Sy};var My=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};My.prototype.area=function(){return My.area(this.p0,this.p1,this.p2)},My.prototype.signedArea=function(){return My.signedArea(this.p0,this.p1,this.p2)},My.prototype.interpolateZ=function(t){if(null===t)throw new af("Supplied point is null.");return My.interpolateZ(t,this.p0,this.p1,this.p2)},My.prototype.longestSideLength=function(){return My.longestSideLength(this.p0,this.p1,this.p2)},My.prototype.isAcute=function(){return My.isAcute(this.p0,this.p1,this.p2)},My.prototype.circumcentre=function(){return My.circumcentre(this.p0,this.p1,this.p2)},My.prototype.area3D=function(){return My.area3D(this.p0,this.p1,this.p2)},My.prototype.centroid=function(){return My.centroid(this.p0,this.p1,this.p2)},My.prototype.inCentre=function(){return My.inCentre(this.p0,this.p1,this.p2)},My.prototype.interfaces_=function(){return[]},My.prototype.getClass=function(){return My},My.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},My.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},My.det=function(t,e,n,r){return t*r-e*n},My.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,s=n.x-i,a=r.x-i,u=n.y-o,c=r.y-o,h=s*c-a*u,l=t.x-i,p=t.y-o,f=(c*l-a*p)/h,g=(-u*l+s*p)/h;return e.z+f*(n.z-e.z)+g*(r.z-e.z)},My.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),s=r;return i>s&&(s=i),o>s&&(s=o),s},My.isAcute=function(t,e,n){return!!xy.isAcute(t,e,n)&&(!!xy.isAcute(e,n,t)&&!!xy.isAcute(n,t,e))},My.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,s=t.y-i,a=e.x-r,u=e.y-i,c=2*My.det(o,s,a,u),h=My.det(s,o*o+s*s,u,a*a+u*u),l=My.det(o,o*o+s*s,a,a*a+u*u);return new ff(r-h/c,i+l/c)},My.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Af(t.x+n/2,t.y+r/2,1),o=new Af(t.x-r+n/2,t.y+n+r/2,1);return new Af(i,o)},My.angleBisector=function(t,e,n){var r=e.distance(t),i=e.distance(n),o=r/(r+i),s=n.x-t.x,a=n.y-t.y;return new ff(t.x+o*s,t.y+o*a)},My.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,s=n.x-t.x,a=n.y-t.y,u=n.z-t.z,c=i*u-o*a,h=o*s-r*u,l=r*a-i*s,p=c*c+h*h+l*l;return Math.sqrt(p)/2},My.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new ff(r,i)},My.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),s=r+i+o,a=(r*t.x+i*e.x+o*n.x)/s,u=(r*t.y+i*e.y+o*n.y)/s;return new ff(a,u)};var Ly=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new fg;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Ly.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,_f.EXTERIOR,_f.INTERIOR)},Ly.prototype.addPolygon=function(t){var e=this,n=this._distance,r=yd.LEFT;this._distance<0&&(n=-this._distance,r=yd.RIGHT);var i=t.getExteriorRing(),o=yg.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,n,r,_f.EXTERIOR,_f.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var a=t.getInteriorRingN(s),u=yg.removeRepeatedPoints(a.getCoordinates());e._distance>0&&e.isErodedCompletely(a,-e._distance)||e.addPolygonRing(u,n,yd.opposite(r),_f.INTERIOR,_f.EXTERIOR)}},Ly.prototype.isTriangleErodedCompletely=function(t,e){var n=new My(t[0],t[1],t[2]),r=n.inCentre();return Zf.distancePointLine(r,n.p0,n.p1)<Math.abs(e)},Ly.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=yg.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,_f.EXTERIOR,_f.INTERIOR)},Ly.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var r=new iy(t,new bd(0,_f.BOUNDARY,e,n));this._curveList.add(r)},Ly.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Ly.prototype.addPolygonRing=function(t,e,n,r,i){if(0===e&&t.length<Vg.MINIMUM_VALID_SIZE)return null;var o=r,s=i;t.length>=Vg.MINIMUM_VALID_SIZE&&Zf.isCCW(t)&&(o=i,s=r,n=yd.opposite(n));var a=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(a,o,s)},Ly.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Ug?this.addPolygon(t):t instanceof kg?this.addLineString(t):t instanceof jg?this.addPoint(t):t instanceof Yg?this.addCollection(t):t instanceof Tg?this.addCollection(t):t instanceof Hg?this.addCollection(t):t instanceof Rg&&this.addCollection(t)},Ly.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i},Ly.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}},Ly.prototype.interfaces_=function(){return[]},Ly.prototype.getClass=function(){return Ly};var Py=function(){};Py.prototype.locate=function(t){},Py.prototype.interfaces_=function(){return[]},Py.prototype.getClass=function(){return Py};var Oy=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Oy.prototype.next=function(){if(this._atStart)return this._atStart=!1,Oy.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new su;var t=this._parent.getGeometryN(this._index++);return t instanceof Rg?(this._subcollectionIterator=new Oy(t),this._subcollectionIterator.next()):t},Oy.prototype.remove=function(){throw new Error(this.getClass().getName())},Oy.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Oy.prototype.interfaces_=function(){return[lg]},Oy.prototype.getClass=function(){return Oy},Oy.isAtomic=function(t){return!(t instanceof Rg)};var Ry=function(){this._geom=null;var t=arguments[0];this._geom=t};Ry.prototype.locate=function(t){return Ry.locate(t,this._geom)},Ry.prototype.interfaces_=function(){return[Py]},Ry.prototype.getClass=function(){return Ry},Ry.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&Zf.isPointInRing(t,e.getCoordinates())},Ry.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!Ry.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(Ry.isPointInRing(t,i))return!1}return!0},Ry.containsPoint=function(t,e){if(e instanceof Ug)return Ry.containsPointInPolygon(t,e);if(e instanceof Rg)for(var n=new Oy(e);n.hasNext();){var r=n.next();if(r!==e&&Ry.containsPoint(t,r))return!0}return!1},Ry.locate=function(t,e){return e.isEmpty()?_f.EXTERIOR:Ry.containsPoint(t,e)?_f.INTERIOR:_f.EXTERIOR};var Ty=function(){this._edgeMap=new gu,this._edgeList=null,this._ptInAreaLocation=[_f.NONE,_f.NONE]};Ty.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},Ty.prototype.propagateSideLabels=function(t){for(var e=_f.NONE,n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea(t)&&i.getLocation(t,yd.LEFT)!==_f.NONE&&(e=i.getLocation(t,yd.LEFT))}if(e===_f.NONE)return null;for(var o=e,s=this.iterator();s.hasNext();){var a=s.next(),u=a.getLabel();if(u.getLocation(t,yd.ON)===_f.NONE&&u.setLocation(t,yd.ON,o),u.isArea(t)){var c=u.getLocation(t,yd.LEFT),h=u.getLocation(t,yd.RIGHT);if(h!==_f.NONE){if(h!==o)throw new md("side location conflict",a.getCoordinate());c===_f.NONE&&Uf.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),o=c}else Uf.isTrue(u.getLocation(t,yd.LEFT)===_f.NONE,"found single null side"),u.setLocation(t,yd.RIGHT,o),u.setLocation(t,yd.LEFT,o)}}},Ty.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Ty.prototype.print=function(t){Tf.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Ty.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ty.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel(),i=r.getLocation(t,yd.LEFT);Uf.isTrue(i!==_f.NONE,"Found unlabelled area edge");for(var o=i,s=this.iterator();s.hasNext();){var a=s.next(),u=a.getLabel();Uf.isTrue(u.isArea(t),"Found non-area edge");var c=u.getLocation(t,yd.LEFT),h=u.getLocation(t,yd.RIGHT);if(c===h)return!1;if(h!==o)return!1;o=c}return!0},Ty.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){if(e._edgeList.get(n)===t)return n}return-1},Ty.prototype.iterator=function(){return this.getEdges().iterator()},Ty.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new fg(this._edgeMap.values())),this._edgeList},Ty.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===_f.NONE&&(this._ptInAreaLocation[t]=Ry.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},Ty.prototype.toString=function(){var t=new wf;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},Ty.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){e.next().computeLabel(t)}},Ty.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var i=r.next(),o=i.getLabel(),s=0;s<2;s++)o.isLine(s)&&o.getLocation(s)===_f.BOUNDARY&&(n[s]=!0);for(var a=this.iterator();a.hasNext();)for(var u=a.next(),c=u.getLabel(),h=0;h<2;h++)if(c.isAnyNull(h)){var l=_f.NONE;if(n[h])l=_f.EXTERIOR;else{var p=u.getCoordinate();l=e.getLocation(h,p,t)}c.setAllLocationsIfNull(h,l)}},Ty.prototype.getDegree=function(){return this._edgeMap.size()},Ty.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Ty.prototype.interfaces_=function(){return[]},Ty.prototype.getClass=function(){return Ty};var Ay=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,n=null,r=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var o=t._resultAreaEdgeList.get(i),s=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),r){case t._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;n=s,r=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!o.isInResult())continue;n.setNext(o),r=t._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(null===e)throw new md("no outgoing dirEdge found",this.getCoordinate());Uf.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),n.setNext(e)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var r=t.get(e-1),i=n.getQuadrant(),o=r.getQuadrant();return Pd.isNorthern(i)&&Pd.isNorthern(o)?n:Pd.isNorthern(i)||Pd.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(Uf.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){Tf.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){var t=this;if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new fg;for(var e=this.iterator();e.hasNext();){var n=e.next();(n.isInResult()||n.getSym().isInResult())&&t._resultAreaEdgeList.add(n)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next(),r=n.getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var t=this;this.getEdges();for(var e=null,n=null,r=this._edgeList.size()-1;r>=0;r--){var i=t._edgeList.get(r),o=i.getSym();null===n&&(n=o),null!==e&&o.setNext(e),e=i}n.setNext(e)},e.prototype.computeDepths=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this.findIndex(e),r=e.getDepth(yd.LEFT),i=e.getDepth(yd.RIGHT),o=this.computeDepths(n+1,this._edgeList.size(),r);if(this.computeDepths(0,n,o)!==i)throw new md("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var s=arguments[0],a=arguments[1],u=arguments[2],c=u,h=s;h<a;h++){var l=t._edgeList.get(h);l.setEdgeDepths(yd.RIGHT,c),c=l.getDepth(yd.LEFT)}return c}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,n=null,r=null,i=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var s=e._resultAreaEdgeList.get(o),a=s.getSym();switch(null===n&&s.getEdgeRing()===t&&(n=s),i){case e._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;r=a,i=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;r.setNextMin(s),i=e._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(Uf.isTrue(null!==n,"found null for first outgoing dirEdge"),Uf.isTrue(n.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(n))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){e.next().isInResult()&&t++}return t}if(1===arguments.length){for(var n=arguments[0],r=0,i=this.iterator();i.hasNext();){i.next().getEdgeRing()===n&&r++}return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=_f.NONE,e=this.iterator();e.hasNext();){var n=e.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=_f.INTERIOR;break}if(r.isInResult()){t=_f.EXTERIOR
;break}}}if(t===_f.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===_f.INTERIOR):(s.isInResult()&&(i=_f.EXTERIOR),a.isInResult()&&(i=_f.INTERIOR))}},e.prototype.computeLabelling=function(e){var n=this;t.prototype.computeLabelling.call(this,e),this._label=new bd(_f.NONE);for(var r=this.iterator();r.hasNext();)for(var i=r.next(),o=i.getEdge(),s=o.getLabel(),a=0;a<2;a++){var u=s.getLocation(a);u!==_f.INTERIOR&&u!==_f.BOUNDARY||n._label.setLocation(a,_f.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ty),Dy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Md(t,new Ay)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ad),Fy=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Fy.prototype.compareTo=function(t){var e=t;return Fy.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Fy.prototype.interfaces_=function(){return[hf]},Fy.prototype.getClass=function(){return Fy},Fy.orientation=function(t){return 1===yg.increasingDirection(t)},Fy.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,s=e?t.length:-1,a=r?n.length:-1,u=e?0:t.length-1,c=r?0:n.length-1;;){var h=t[u].compareTo(n[c]);if(0!==h)return h;u+=i,c+=o;var l=u===s,p=c===a;if(l&&!p)return-1;if(!l&&p)return 1;if(l&&p)return 0}};var qy=function(){this._edges=new fg,this._ocaMap=new gu};qy.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var i=r.getCoordinates(),o=0;o<i.length;o++)o>0&&t.print(","),t.print(i[o].x+" "+i[o].y);t.println(")")}t.print(")  ")},qy.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())},qy.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1},qy.prototype.iterator=function(){return this._edges.iterator()},qy.prototype.getEdges=function(){return this._edges},qy.prototype.get=function(t){return this._edges.get(t)},qy.prototype.findEqualEdge=function(t){var e=new Fy(t.getCoordinates());return this._ocaMap.get(e)},qy.prototype.add=function(t){this._edges.add(t);var e=new Fy(t.getCoordinates());this._ocaMap.put(e,t)},qy.prototype.interfaces_=function(){return[]},qy.prototype.getClass=function(){return qy};var Gy=function(){};Gy.prototype.processIntersections=function(t,e,n,r){},Gy.prototype.isDone=function(){},Gy.prototype.interfaces_=function(){return[]},Gy.prototype.getClass=function(){return Gy};var By=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};By.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(By.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},By.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},By.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},By.prototype.getLineIntersector=function(){return this._li},By.prototype.hasProperIntersection=function(){return this._hasProper},By.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},By.prototype.hasIntersection=function(){return this._hasIntersection},By.prototype.isDone=function(){return!1},By.prototype.hasInteriorIntersection=function(){return this._hasInterior},By.prototype.interfaces_=function(){return[Gy]},By.prototype.getClass=function(){return By},By.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var ky=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new ff(t),this.segmentIndex=e,this.dist=n};ky.prototype.getSegmentIndex=function(){return this.segmentIndex},ky.prototype.getCoordinate=function(){return this.coord},ky.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},ky.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},ky.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},ky.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},ky.prototype.getDistance=function(){return this.dist},ky.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},ky.prototype.interfaces_=function(){return[hf]},ky.prototype.getClass=function(){return ky};var zy=function(){this._nodeMap=new gu,this.edge=null;var t=arguments[0];this.edge=t};zy.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},zy.prototype.iterator=function(){return this._nodeMap.values().iterator()},zy.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),o=e.createSplitEdge(r,i);t.add(o),r=i}},zy.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},zy.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],o=e.dist>0||!e.coord.equals2D(i);o||r--;var s=new Array(r).fill(null),a=0;s[a++]=new ff(t.coord);for(var u=t.segmentIndex+1;u<=e.segmentIndex;u++)s[a++]=n.edge.pts[u];return o&&(s[a]=e.coord),new Vy(s,new bd(this.edge._label))},zy.prototype.add=function(t,e,n){var r=new ky(t,e,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},zy.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){if(e.next().coord.equals(t))return!0}return!1},zy.prototype.interfaces_=function(){return[]},zy.prototype.getClass=function(){return zy};var jy=function(){};jy.prototype.getChainStartIndices=function(t){var e=this,n=0,r=new fg;r.add(new bf(n));do{var i=e.findChainEnd(t,n);r.add(new bf(i)),n=i}while(n<t.length-1);return jy.toIntArray(r)},jy.prototype.findChainEnd=function(t,e){for(var n=Pd.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){if(Pd.quadrant(t[r-1],t[r])!==n)break;r++}return r-1},jy.prototype.interfaces_=function(){return[]},jy.prototype.getClass=function(){return jy},jy.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Xy=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Df,this.env2=new Df;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new jy;this.startIndex=e.getChainStartIndices(this.pts)};Xy.prototype.getCoordinates=function(){return this.pts},Xy.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},Xy.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},Xy.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=arguments[4],c=arguments[5],h=this.pts[i],l=this.pts[o],p=s.pts[a],f=s.pts[u];if(o-i==1&&u-a==1)return c.addIntersections(this.e,i,s.e,a),null;if(this.env1.init(h,l),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var g=Math.trunc((i+o)/2),d=Math.trunc((a+u)/2);i<g&&(a<d&&this.computeIntersectsForChain(i,g,s,a,d,c),d<u&&this.computeIntersectsForChain(i,g,s,d,u,c)),g<o&&(a<d&&this.computeIntersectsForChain(g,o,s,a,d,c),d<u&&this.computeIntersectsForChain(g,o,s,d,u,c))}},Xy.prototype.getStartIndexes=function(){return this.startIndex},Xy.prototype.computeIntersects=function(t,e){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var i=0;i<t.startIndex.length-1;i++)n.computeIntersectsForChain(r,t,i,e)},Xy.prototype.interfaces_=function(){return[]},Xy.prototype.getClass=function(){return Xy};var Uy=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},Yy={NULL_VALUE:{configurable:!0}};Uy.prototype.getDepth=function(t,e){return this._depth[t][e]},Uy.prototype.setDepth=function(t,e,n){this._depth[t][e]=n},Uy.prototype.isNull=function(){var t=this;if(0===arguments.length){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==Uy.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===Uy.NULL_VALUE}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._depth[i][o]===Uy.NULL_VALUE}},Uy.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}},Uy.prototype.getDelta=function(t){return this._depth[t][yd.RIGHT]-this._depth[t][yd.LEFT]},Uy.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?_f.EXTERIOR:_f.INTERIOR},Uy.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Uy.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);i!==_f.EXTERIOR&&i!==_f.INTERIOR||(t.isNull(n,r)?t._depth[n][r]=Uy.depthAtLocation(i):t._depth[n][r]+=Uy.depthAtLocation(i))}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];a===_f.INTERIOR&&this._depth[o][s]++}},Uy.prototype.interfaces_=function(){return[]},Uy.prototype.getClass=function(){return Uy},Uy.depthAtLocation=function(t){return t===_f.EXTERIOR?0:t===_f.INTERIOR?1:Uy.NULL_VALUE},Yy.NULL_VALUE.get=function(){return-1},Object.defineProperties(Uy,Yy);var Vy=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new zy(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Uy,this._depthDelta=0,1===arguments.length){var n=arguments[0];e.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,bd.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){var n=this;if(!(t instanceof e))return!1;var r=t;if(this.pts.length!==r.pts.length)return!1;for(var i=!0,o=!0,s=this.pts.length,a=0;a<this.pts.length;a++)if(n.pts[a].equals2D(r.pts[a])||(i=!1),n.pts[a].equals2D(r.pts[--s])||(o=!1),!i&&!o)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){var e=this;t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&t.print(","),t.print(e.pts[n].x+" "+e.pts[n].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){var e=this;t.print("edge "+this._name+": ");for(var n=this.pts.length-1;n>=0;n--)t.print(e.pts[n]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Xy(this)),this._mce},e.prototype.getEnvelope=function(){var t=this;if(null===this._env){this._env=new Df;for(var e=0;e<this.pts.length;e++)t._env.expandToInclude(t.pts[e])}return this._env},e.prototype.addIntersection=function(t,e,n,r){var i=new ff(t.getIntersection(r)),o=e,s=t.getEdgeDistance(n,r),a=o+1;if(a<this.pts.length){var u=this.pts[a];i.equals2D(u)&&(o=a,s=0)}this.eiList.add(i,o,s)},e.prototype.toString=function(){var t=this,e=new wf;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var n=0;n<this.pts.length;n++)n>0&&e.append(","),e.append(t.pts[n].x+" "+t.pts[n].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()},e.prototype.isPointwiseEqual=function(t){var e=this;if(this.pts.length!==t.pts.length)return!1;for(var n=0;n<this.pts.length;n++)if(!e.pts[n].equals2D(t.pts[n]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,yd.ON),e.getLocation(1,yd.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,yd.LEFT),e.getLocation(1,yd.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,yd.RIGHT),e.getLocation(1,yd.RIGHT),2))},e}(Sd),Hy=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new qy,this._bufParams=t||null};Hy.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},Hy.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new bd(t.getLabel()),r.flip()),n.merge(r);var i=Hy.depthDelta(r),o=e.getDepthDelta(),s=o+i;e.setDepthDelta(s)}else this._edgeList.add(t),t.setDepthDelta(Hy.depthDelta(t.getLabel()))},Hy.prototype.buildSubgraphs=function(t,e){for(var n=new fg,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),s=new Ny(n),a=s.getDepth(o);i.computeDepth(a),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},Hy.prototype.createSubgraphs=function(t){for(var e=new fg,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Ed;i.create(r),e.add(i)}}return Ud.sort(e,Ud.reverseOrder()),e},Hy.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Hy.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new py,n=new Hf;return n.setPrecisionModel(t),e.setSegmentIntersector(new By(n)),e},Hy.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Iy(n,this._bufParams),i=new Ly(t,e,r),o=i.getCurves();if(o.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(o,n),this._graph=new Dd(new Dy),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),a=new Fd(this._geomFact);this.buildSubgraphs(s,a);var u=a.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(u)},Hy.prototype.computeNodedEdges=function(t,e){var n=this,r=this.getNoder(e);r.computeNodes(t);for(var i=r.getNodedSubstrings(),o=i.iterator();o.hasNext();){var s=o.next(),a=s.getCoordinates();if(2!==a.length||!a[0].equals2D(a[1])){var u=s.getData(),c=new Vy(s.getCoordinates(),new bd(u));n.insertUniqueEdge(c)}}},Hy.prototype.setNoder=function(t){this._workingNoder=t},Hy.prototype.interfaces_=function(){return[]},Hy.prototype.getClass=function(){return Hy},Hy.depthDelta=function(t){var e=t.getLocation(0,yd.LEFT),n=t.getLocation(0,yd.RIGHT);return e===_f.INTERIOR&&n===_f.EXTERIOR?1:e===_f.EXTERIOR&&n===_f.INTERIOR?-1:0},Hy.convertSegStrings=function(t){for(var e=new ud,n=new fg;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var Wy=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};Wy.prototype.rescale=function(){var t=this;if(mf(arguments[0],cg))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],o=0;o<i.length;o++)i[o].x=i[o].x/t._scaleFactor+t._offsetX,i[o].y=i[o].y/t._scaleFactor+t._offsetY;2===i.length&&i[0].equals2D(i[1])&&Tf.out.println(i)}},Wy.prototype.scale=function(){var t=this;if(mf(arguments[0],cg)){for(var e=arguments[0],n=new fg,r=e.iterator();r.hasNext();){var i=r.next();n.add(new iy(t.scale(i.getCoordinates()),i.getData()))}return n}if(arguments[0]instanceof Array){for(var o=arguments[0],s=new Array(o.length).fill(null),a=0;a<o.length;a++)s[a]=new ff(Math.round((o[a].x-t._offsetX)*t._scaleFactor),Math.round((o[a].y-t._offsetY)*t._scaleFactor),o[a].z);return yg.removeRepeatedPoints(s)}},Wy.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},Wy.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},Wy.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},Wy.prototype.interfaces_=function(){return[hy]},Wy.prototype.getClass=function(){return Wy};var Jy=function(){this._li=new Hf,this._segStrings=null;var t=arguments[0];this._segStrings=t},Zy={fact:{configurable:!0}};Jy.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=o.iterator();s.hasNext();)for(var a=s.next(),u=a.getCoordinates(),c=1;c<u.length-1;c++)if(u[c].equals(i))throw new jf("found endpt/interior pt intersection at index "+c+" :pt "+i)},Jy.prototype.checkInteriorIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(2===arguments.length)for(var o=arguments[0],s=arguments[1],a=o.getCoordinates(),u=s.getCoordinates(),c=0;c<a.length-1;c++)for(var h=0;h<u.length-1;h++)t.checkInteriorIntersections(o,c,s,h);else if(4===arguments.length){var l=arguments[0],p=arguments[1],f=arguments[2],g=arguments[3];if(l===f&&p===g)return null;var d=l.getCoordinates()[p],y=l.getCoordinates()[p+1],_=f.getCoordinates()[g],v=f.getCoordinates()[g+1];if(this._li.computeIntersection(d,y,_,v),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,d,y)||this.hasInteriorIntersection(this._li,_,v)))throw new jf("found non-noded intersection at "+d+"-"+y+" and "+_+"-"+v)}},Jy.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Jy.prototype.checkCollapses=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(1===arguments.length)for(var r=arguments[0],i=r.getCoordinates(),o=0;o<i.length-2;o++)t.checkCollapse(i[o],i[o+1],i[o+2])},Jy.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!i.equals(e)&&!i.equals(n))return!0}return!1},Jy.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new jf("found non-noded collapse at "+Jy.fact.createLineString([t,e,n]))},Jy.prototype.interfaces_=function(){return[]},Jy.prototype.getClass=function(){return Jy},Zy.fact.get=function(){return new ud},Object.defineProperties(Jy,Zy);var Ky=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new af("Scale factor must be non-zero");1!==e&&(this._pt=new ff(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new ff,this._p1Scaled=new ff),this.initCorners(this._pt)},Qy={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Ky.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return Uf.isTrue(!(s&&a),"Found bad envelope test"),a},Ky.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new ff(this._maxx,this._maxy),this._corner[1]=new ff(this._minx,this._maxy),this._corner[2]=new ff(this._minx,this._miny),this._corner[3]=new ff(this._maxx,this._miny)},Ky.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Ky.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},Ky.prototype.getCoordinate=function(){return this._originalPt},Ky.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},Ky.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=Ky.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Df(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},Ky.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},Ky.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!n||!r)||(!!t.equals(this._pt)||!!e.equals(this._pt))))))},Ky.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(n,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},Ky.prototype.interfaces_=function(){return[]},Ky.prototype.getClass=function(){return Ky},Qy.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Ky,Qy);var $y=function(){this.tempEnv1=new Df,this.selectedSegment=new oy};$y.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},$y.prototype.interfaces_=function(){return[]},$y.prototype.getClass=function(){return $y};var t_=function(){this._index=null;var t=arguments[0];this._index=t},e_={HotPixelSnapAction:{configurable:!0}};t_.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new n_(e,n,r);return this._index.query(i,{interfaces_:function(){return[kd]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},t_.prototype.interfaces_=function(){return[]},t_.prototype.getClass=function(){return t_},e_.HotPixelSnapAction.get=function(){return n_},Object.defineProperties(t_,e_);var n_=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=n,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],n=arguments[1],r=e.getContext();if(null!==this._parentEdge&&r===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($y),r_=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new fg};r_.prototype.processIntersections=function(t,e,n,r){var i=this;if(t===n&&e===r)return null;var o=t.getCoordinates()[e],s=t.getCoordinates()[e+1],a=n.getCoordinates()[r],u=n.getCoordinates()[r+1];if(this._li.computeIntersection(o,s,a,u),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var c=0;c<this._li.getIntersectionNum();c++)i._interiorIntersections.add(i._li.getIntersection(c));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}},r_.prototype.isDone=function(){return!1},r_.prototype.getInteriorIntersections=function(){return this._interiorIntersections},r_.prototype.interfaces_=function(){return[Gy]},r_.prototype.getClass=function(){return r_};var i_=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Hf,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};i_.prototype.checkCorrectness=function(t){var e=iy.getNodedSubstrings(t),n=new Jy(e);try{n.checkValid()}catch(t){if(!(t instanceof Of))throw t;t.printStackTrace()}},i_.prototype.getNodedSubstrings=function(){return iy.getNodedSubstrings(this._nodedSegStrings)},i_.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},i_.prototype.findInteriorIntersections=function(t,e){var n=new r_(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},i_.prototype.computeVertexSnaps=function(){var t=this;if(mf(arguments[0],cg))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof iy)for(var i=arguments[0],o=i.getCoordinates(),s=0;s<o.length;s++){var a=new Ky(o[s],t._scaleFactor,t._li),u=t._pointSnapper.snap(a,i,s);u&&i.addIntersection(o[s],s)}},i_.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new py,this._pointSnapper=new t_(this._noder.getIndex()),this.snapRound(t,this._li)},i_.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new Ky(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}},i_.prototype.interfaces_=function(){return[hy]},i_.prototype.getClass=function(){return i_};var o_=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new gy,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},s_={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};o_.prototype.bufferFixedPrecision=function(t){var e=new Wy(new i_(new id(1)),t.getScale()),n=new Hy(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},o_.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=o_.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof md))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=o_.precisionScaleFactor(this._argGeom,this._distance,n),i=new id(r);this.bufferFixedPrecision(i)}},o_.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===id.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},o_.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},o_.prototype.bufferOriginalPrecision=function(){try{var t=new Hy(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof jf))throw t;this._saveException=t}},o_.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},o_.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},o_.prototype.interfaces_=function(){return[]},o_.prototype.getClass=function(){return o_},o_.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return new o_(t).getResultGeometry(e)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof $f&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1],i=arguments[2],o=new o_(n);o.setQuadrantSegments(i);return o.getResultGeometry(r)}if(arguments[2]instanceof gy&&arguments[0]instanceof $f&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],u=arguments[2];return new o_(s,u).getResultGeometry(a)}}else if(4===arguments.length){var c=arguments[0],h=arguments[1],l=arguments[2],p=arguments[3],f=new o_(c);f.setQuadrantSegments(l),f.setEndCapStyle(p);var g=f.getResultGeometry(h);return g}},o_.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=xf.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),o=e>0?e:0,s=i+2*o,a=Math.trunc(Math.log(s)/Math.log(10)+1),u=n-a;return Math.pow(10,u)},s_.CAP_ROUND.get=function(){return gy.CAP_ROUND},s_.CAP_BUTT.get=function(){
return gy.CAP_FLAT},s_.CAP_FLAT.get=function(){return gy.CAP_FLAT},s_.CAP_SQUARE.get=function(){return gy.CAP_SQUARE},s_.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(o_,s_);var a_=function(){this._pt=[new ff,new ff],this._distance=uf.NaN,this._isNull=!0};a_.prototype.getCoordinates=function(){return this._pt},a_.prototype.getCoordinate=function(t){return this._pt[t]},a_.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},a_.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},a_.prototype.getDistance=function(){return this._distance},a_.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},a_.prototype.interfaces_=function(){return[]},a_.prototype.getClass=function(){return a_};var u_=function(){};u_.prototype.interfaces_=function(){return[]},u_.prototype.getClass=function(){return u_},u_.computeDistance=function(){if(arguments[2]instanceof a_&&arguments[0]instanceof kg&&arguments[1]instanceof ff)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new oy,o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var s=i.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof a_&&arguments[0]instanceof Ug&&arguments[1]instanceof ff){var a=arguments[0],u=arguments[1],c=arguments[2];u_.computeDistance(a.getExteriorRing(),u,c);for(var h=0;h<a.getNumInteriorRing();h++)u_.computeDistance(a.getInteriorRingN(h),u,c)}else if(arguments[2]instanceof a_&&arguments[0]instanceof $f&&arguments[1]instanceof ff){var l=arguments[0],p=arguments[1],f=arguments[2];if(l instanceof kg)u_.computeDistance(l,p,f);else if(l instanceof Ug)u_.computeDistance(l,p,f);else if(l instanceof Rg)for(var g=l,d=0;d<g.getNumGeometries();d++){var y=g.getGeometryN(d);u_.computeDistance(y,p,f)}else f.setMinimum(l.getCoordinate(),p)}else if(arguments[2]instanceof a_&&arguments[0]instanceof oy&&arguments[1]instanceof ff){var _=arguments[0],v=arguments[1],m=arguments[2],x=_.closestPoint(v);m.setMinimum(x,v)}};var c_=function(t){this._maxPtDist=new a_,this._inputGeom=t||null},h_={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};c_.prototype.computeMaxMidpointDistance=function(t){var e=new p_(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},c_.prototype.computeMaxVertexDistance=function(t){var e=new l_(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},c_.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},c_.prototype.getDistancePoints=function(){return this._maxPtDist},c_.prototype.interfaces_=function(){return[]},c_.prototype.getClass=function(){return c_},h_.MaxPointDistanceFilter.get=function(){return l_},h_.MaxMidpointDistanceFilter.get=function(){return p_},Object.defineProperties(c_,h_);var l_=function(t){this._maxPtDist=new a_,this._minPtDist=new a_,this._geom=t||null};l_.prototype.filter=function(t){this._minPtDist.initialize(),u_.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},l_.prototype.getMaxPointDistance=function(){return this._maxPtDist},l_.prototype.interfaces_=function(){return[ng]},l_.prototype.getClass=function(){return l_};var p_=function(t){this._maxPtDist=new a_,this._minPtDist=new a_,this._geom=t||null};p_.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new ff((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),u_.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},p_.prototype.isDone=function(){return!1},p_.prototype.isGeometryChanged=function(){return!1},p_.prototype.getMaxPointDistance=function(){return this._maxPtDist},p_.prototype.interfaces_=function(){return[Og]},p_.prototype.getClass=function(){return p_};var f_=function(t){this._comps=t||null};f_.prototype.filter=function(t){t instanceof Ug&&this._comps.add(t)},f_.prototype.interfaces_=function(){return[Pg]},f_.prototype.getClass=function(){return f_},f_.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return f_.getPolygons(t,new fg)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Ug?n.add(e):e instanceof Rg&&e.apply(new f_(n)),n}};var g_=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};g_.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Vg){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof kg&&this._lines.add(t)},g_.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},g_.prototype.interfaces_=function(){return[Qf]},g_.prototype.getClass=function(){return g_},g_.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(g_.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(g_.getLines(e,n))}},g_.getLines=function(){if(1===arguments.length){var t=arguments[0];return g_.getLines(t,!1)}if(2===arguments.length){if(mf(arguments[0],cg)&&mf(arguments[1],cg)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();g_.getLines(i,n)}return n}if(arguments[0]instanceof $f&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new fg;return o.apply(new g_(a,s)),a}if(arguments[0]instanceof $f&&mf(arguments[1],cg)){var u=arguments[0],c=arguments[1];return u instanceof kg?c.add(u):u.apply(new g_(c)),c}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&mf(arguments[0],cg)&&mf(arguments[1],cg)){for(var h=arguments[0],l=arguments[1],p=arguments[2],f=h.iterator();f.hasNext();){var g=f.next();g_.getLines(g,l,p)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof $f&&mf(arguments[1],cg)){var d=arguments[0],y=arguments[1],_=arguments[2];return d.apply(new g_(y,_)),y}}};var d_=function(){if(this._boundaryRule=rg.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new af("Rule must be non-null");this._boundaryRule=t}};d_.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof ff&&arguments[1]instanceof Ug){var e=arguments[0],n=arguments[1];if(n.isEmpty())return _f.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===_f.EXTERIOR)return _f.EXTERIOR;if(i===_f.BOUNDARY)return _f.BOUNDARY;for(var o=0;o<n.getNumInteriorRing();o++){var s=n.getInteriorRingN(o),a=t.locateInPolygonRing(e,s);if(a===_f.INTERIOR)return _f.EXTERIOR;if(a===_f.BOUNDARY)return _f.BOUNDARY}return _f.INTERIOR}if(arguments[0]instanceof ff&&arguments[1]instanceof kg){var u=arguments[0],c=arguments[1];if(!c.getEnvelopeInternal().intersects(u))return _f.EXTERIOR;var h=c.getCoordinates();return c.isClosed()||!u.equals(h[0])&&!u.equals(h[h.length-1])?Zf.isOnLine(u,h)?_f.INTERIOR:_f.EXTERIOR:_f.BOUNDARY}if(arguments[0]instanceof ff&&arguments[1]instanceof jg){var l=arguments[0];return arguments[1].getCoordinate().equals2D(l)?_f.INTERIOR:_f.EXTERIOR}},d_.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Zf.locatePointInRing(t,e.getCoordinates()):_f.EXTERIOR},d_.prototype.intersects=function(t,e){return this.locate(t,e)!==_f.EXTERIOR},d_.prototype.updateLocationInfo=function(t){t===_f.INTERIOR&&(this._isIn=!0),t===_f.BOUNDARY&&this._numBoundaries++},d_.prototype.computeLocation=function(t,e){var n=this;if(e instanceof jg&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof kg)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Ug)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Tg)for(var r=e,i=0;i<r.getNumGeometries();i++){var o=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,o))}else if(e instanceof Hg)for(var s=e,a=0;a<s.getNumGeometries();a++){var u=s.getGeometryN(a);n.updateLocationInfo(n.locateInternal(t,u))}else if(e instanceof Rg)for(var c=new Oy(e);c.hasNext();){var h=c.next();h!==e&&n.computeLocation(t,h)}},d_.prototype.locate=function(t,e){return e.isEmpty()?_f.EXTERIOR:e instanceof kg?this.locateInternal(t,e):e instanceof Ug?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?_f.BOUNDARY:this._numBoundaries>0||this._isIn?_f.INTERIOR:_f.EXTERIOR)},d_.prototype.interfaces_=function(){return[]},d_.prototype.getClass=function(){return d_};var y_=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},__={INSIDE_AREA:{configurable:!0}};y_.prototype.isInsideArea=function(){return this._segIndex===y_.INSIDE_AREA},y_.prototype.getCoordinate=function(){return this._pt},y_.prototype.getGeometryComponent=function(){return this._component},y_.prototype.getSegmentIndex=function(){return this._segIndex},y_.prototype.interfaces_=function(){return[]},y_.prototype.getClass=function(){return y_},__.INSIDE_AREA.get=function(){return-1},Object.defineProperties(y_,__);var v_=function(t){this._pts=t||null};v_.prototype.filter=function(t){t instanceof jg&&this._pts.add(t)},v_.prototype.interfaces_=function(){return[Pg]},v_.prototype.getClass=function(){return v_},v_.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof jg?Ud.singletonList(t):v_.getPoints(t,new fg)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof jg?n.add(e):e instanceof Rg&&e.apply(new v_(n)),n}};var m_=function(){this._locations=null;var t=arguments[0];this._locations=t};m_.prototype.filter=function(t){(t instanceof jg||t instanceof kg||t instanceof Ug)&&this._locations.add(new y_(t,0,t.getCoordinate()))},m_.prototype.interfaces_=function(){return[Pg]},m_.prototype.getClass=function(){return m_},m_.getLocations=function(t){var e=new fg;return t.apply(new m_(e)),e};var x_=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new d_,this._minDistanceLocation=null,this._minDistance=uf.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};x_.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=1-n,o=f_.getPolygons(this._geom[n]);if(o.size()>0){var s=m_.getLocations(this._geom[i]);if(this.computeContainmentDistance(s,o,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&mf(arguments[0],pg)&&mf(arguments[1],pg)){for(var a=arguments[0],u=arguments[1],c=arguments[2],h=0;h<a.size();h++)for(var l=a.get(h),p=0;p<u.size();p++)if(t.computeContainmentDistance(l,u.get(p),c),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof y_&&arguments[1]instanceof Ug){var f=arguments[0],g=arguments[1],d=arguments[2],y=f.getCoordinate();if(_f.EXTERIOR!==this._ptLocator.locate(y,g))return this._minDistance=0,d[0]=f,d[1]=new y_(g,y),null}},x_.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(r.computeMinDistance(o,a,n),r._minDistance<=r._terminateDistance)return null}},x_.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=g_.getLines(this._geom[0]),n=g_.getLines(this._geom[1]),r=v_.getPoints(this._geom[0]),i=v_.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),void this.updateMinDistance(t,!1))))},x_.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},x_.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},x_.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},x_.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof kg&&arguments[1]instanceof jg){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),o=n.getCoordinate(),s=0;s<i.length-1;s++){var a=Zf.distancePointLine(o,i[s],i[s+1]);if(a<t._minDistance){t._minDistance=a;var u=new oy(i[s],i[s+1]),c=u.closestPoint(o);r[0]=new y_(e,s,c),r[1]=new y_(n,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof kg&&arguments[1]instanceof kg){var h=arguments[0],l=arguments[1],p=arguments[2];if(h.getEnvelopeInternal().distance(l.getEnvelopeInternal())>this._minDistance)return null;for(var f=h.getCoordinates(),g=l.getCoordinates(),d=0;d<f.length-1;d++)for(var y=0;y<g.length-1;y++){var _=Zf.distanceLineLine(f[d],f[d+1],g[y],g[y+1]);if(_<t._minDistance){t._minDistance=_;var v=new oy(f[d],f[d+1]),m=new oy(g[y],g[y+1]),x=v.closestPoints(m);p[0]=new y_(h,d,x[0]),p[1]=new y_(l,y,x[1])}if(t._minDistance<=t._terminateDistance)return null}}},x_.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s),u=o.getCoordinate().distance(a.getCoordinate());if(u<r._minDistance&&(r._minDistance=u,n[0]=new y_(o,0,o.getCoordinate()),n[1]=new y_(a,0,a.getCoordinate())),r._minDistance<=r._terminateDistance)return null}},x_.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new af("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},x_.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(r.computeMinDistance(o,a,n),r._minDistance<=r._terminateDistance)return null}},x_.prototype.interfaces_=function(){return[]},x_.prototype.getClass=function(){return x_},x_.distance=function(t,e){return new x_(t,e).distance()},x_.isWithinDistance=function(t,e,n){return new x_(t,e,n).distance()<=n},x_.nearestPoints=function(t,e){return new x_(t,e).nearestPoints()};var E_=function(){this._pt=[new ff,new ff],this._distance=uf.NaN,this._isNull=!0};E_.prototype.getCoordinates=function(){return this._pt},E_.prototype.getCoordinate=function(t){return this._pt[t]},E_.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},E_.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},E_.prototype.toString=function(){return zf.toLineString(this._pt[0],this._pt[1])},E_.prototype.getDistance=function(){return this._distance},E_.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},E_.prototype.interfaces_=function(){return[]},E_.prototype.getClass=function(){return E_};var w_=function(){};w_.prototype.interfaces_=function(){return[]},w_.prototype.getClass=function(){return w_},w_.computeDistance=function(){if(arguments[2]instanceof E_&&arguments[0]instanceof kg&&arguments[1]instanceof ff)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new oy,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var s=r.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof E_&&arguments[0]instanceof Ug&&arguments[1]instanceof ff){var a=arguments[0],u=arguments[1],c=arguments[2];w_.computeDistance(a.getExteriorRing(),u,c);for(var h=0;h<a.getNumInteriorRing();h++)w_.computeDistance(a.getInteriorRingN(h),u,c)}else if(arguments[2]instanceof E_&&arguments[0]instanceof $f&&arguments[1]instanceof ff){var l=arguments[0],p=arguments[1],f=arguments[2];if(l instanceof kg)w_.computeDistance(l,p,f);else if(l instanceof Ug)w_.computeDistance(l,p,f);else if(l instanceof Rg)for(var g=l,d=0;d<g.getNumGeometries();d++){var y=g.getGeometryN(d);w_.computeDistance(y,p,f)}else f.setMinimum(l.getCoordinate(),p)}else if(arguments[2]instanceof E_&&arguments[0]instanceof oy&&arguments[1]instanceof ff){var _=arguments[0],v=arguments[1],m=arguments[2],x=_.closestPoint(v);m.setMinimum(x,v)}};var b_=function(){this._g0=null,this._g1=null,this._ptDist=new E_,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},I_={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};b_.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},b_.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new af("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},b_.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},b_.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},b_.prototype.computeOrientedDistance=function(t,e,n){var r=new N_(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new C_(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}},b_.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},b_.prototype.interfaces_=function(){return[]},b_.prototype.getClass=function(){return b_},b_.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return new b_(t,e).distance()}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new b_(n,r);return o.setDensifyFraction(i),o.distance()}},I_.MaxPointDistanceFilter.get=function(){return N_},I_.MaxDensifiedByFractionDistanceFilter.get=function(){return C_},Object.defineProperties(b_,I_);var N_=function(){this._maxPtDist=new E_,this._minPtDist=new E_,this._euclideanDist=new w_,this._geom=null;var t=arguments[0];this._geom=t};N_.prototype.filter=function(t){this._minPtDist.initialize(),w_.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},N_.prototype.getMaxPointDistance=function(){return this._maxPtDist},N_.prototype.interfaces_=function(){return[ng]},N_.prototype.getClass=function(){return N_};var C_=function(){this._maxPtDist=new E_,this._minPtDist=new E_,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};C_.prototype.filter=function(t,e){var n=this;if(0===e)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),o=(i.x-r.x)/this._numSubSegs,s=(i.y-r.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var u=r.x+a*o,c=r.y+a*s,h=new ff(u,c);n._minPtDist.initialize(),w_.computeDistance(n._geom,h,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}},C_.prototype.isDone=function(){return!1},C_.prototype.isGeometryChanged=function(){return!1},C_.prototype.getMaxPointDistance=function(){return this._maxPtDist},C_.prototype.interfaces_=function(){return[Og]},C_.prototype.getClass=function(){return C_};var S_=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},M_={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};S_.prototype.checkMaximumDistance=function(t,e,n){var r=new b_(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+zf.toLineString(i[0],i[1])+")"}},S_.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=S_.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),S_.VERBOSE&&Tf.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},S_.prototype.checkNegativeValid=function(){if(!(this._input instanceof Ug||this._input instanceof Hg||this._input instanceof Rg))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},S_.prototype.getErrorIndicator=function(){return this._errorIndicator},S_.prototype.checkMinimumDistance=function(t,e,n){var r=new x_(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+zf.toLineString(i[0],i[1])+" )"}},S_.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},S_.prototype.getErrorLocation=function(){return this._errorLocation},S_.prototype.getPolygonLines=function(t){for(var e=new fg,n=new g_(e),r=f_.getPolygons(t),i=r.iterator();i.hasNext();){i.next().apply(n)}return t.getFactory().buildGeometry(e)},S_.prototype.getErrorMessage=function(){return this._errMsg},S_.prototype.interfaces_=function(){return[]},S_.prototype.getClass=function(){return S_},M_.VERBOSE.get=function(){return!1},M_.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(S_,M_);var L_=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},P_={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};L_.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},L_.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*L_.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Df(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Df(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},L_.prototype.checkDistance=function(){var t=new S_(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},L_.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},L_.prototype.checkPolygonal=function(){this._result instanceof Ug||this._result instanceof Hg||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},L_.prototype.getErrorIndicator=function(){return this._errorIndicator},L_.prototype.getErrorLocation=function(){return this._errorLocation},L_.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2?null:this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},L_.prototype.report=function(t){if(!L_.VERBOSE)return null;Tf.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},L_.prototype.getErrorMessage=function(){return this._errorMsg},L_.prototype.interfaces_=function(){return[]},L_.prototype.getClass=function(){return L_},L_.isValidMsg=function(t,e,n){var r=new L_(t,e,n);return r.isValid()?null:r.getErrorMessage()},L_.isValid=function(t,e,n){return!!new L_(t,e,n).isValid()},P_.VERBOSE.get=function(){return!1},P_.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(L_,P_);var O_=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};O_.prototype.getCoordinates=function(){return this._pts},O_.prototype.size=function(){return this._pts.length},O_.prototype.getCoordinate=function(t){return this._pts[t]},O_.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},O_.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:ey.octant(this.getCoordinate(t),this.getCoordinate(t+1))},O_.prototype.setData=function(t){this._data=t},O_.prototype.getData=function(){return this._data},O_.prototype.toString=function(){return zf.toLineString(new $g(this._pts))},O_.prototype.interfaces_=function(){return[ny]},O_.prototype.getClass=function(){return O_};var R_=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new fg,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};R_.prototype.getInteriorIntersection=function(){return this._interiorIntersection},R_.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},R_.prototype.getIntersectionSegments=function(){return this._intSegments},R_.prototype.count=function(){return this._intersectionCount},R_.prototype.getIntersections=function(){return this._intersections},R_.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},R_.prototype.setKeepIntersections=function(t){this._keepIntersections=t},R_.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){if(!(this.isEndSegment(t,e)||this.isEndSegment(n,r)))return null}var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},R_.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},R_.prototype.hasIntersection=function(){return null!==this._interiorIntersection},R_.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},R_.prototype.interfaces_=function(){return[Gy]},R_.prototype.getClass=function(){return R_},R_.createAllIntersectionsFinder=function(t){var e=new R_(t);return e.setFindAllIntersections(!0),e},R_.createAnyIntersectionFinder=function(t){return new R_(t)},R_.createIntersectionCounter=function(t){var e=new R_(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var T_=function(){this._li=new Hf,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};T_.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},T_.prototype.getIntersections=function(){return this._segInt.getIntersections()},T_.prototype.isValid=function(){return this.execute(),this._isValid},T_.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},T_.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new R_(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new py;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},T_.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new md(this.getErrorMessage(),this._segInt.getInteriorIntersection())},T_.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+zf.toLineString(t[0],t[1])+" and "+zf.toLineString(t[2],t[3])},T_.prototype.interfaces_=function(){return[]},T_.prototype.getClass=function(){return T_},T_.computeIntersections=function(t){var e=new T_(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()}
;var A_=function t(){this._nv=null;var e=arguments[0];this._nv=new T_(t.toSegmentStrings(e))};A_.prototype.checkValid=function(){this._nv.checkValid()},A_.prototype.interfaces_=function(){return[]},A_.prototype.getClass=function(){return A_},A_.toSegmentStrings=function(t){for(var e=new fg,n=t.iterator();n.hasNext();){var r=n.next();e.add(new O_(r.getCoordinates(),r))}return e},A_.checkValid=function(t){new A_(t).checkValid()};var D_=function(t){this._mapOp=t};D_.prototype.map=function(t){for(var e=this,n=new fg,r=0;r<t.getNumGeometries();r++){var i=e._mapOp.map(t.getGeometryN(r));i.isEmpty()||n.add(i)}return t.getFactory().createGeometryCollection(ud.toGeometryArray(n))},D_.prototype.interfaces_=function(){return[]},D_.prototype.getClass=function(){return D_},D_.map=function(t,e){return new D_(e).map(t)};var F_=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new fg,this._resultLineList=new fg;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};F_.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}},F_.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},F_.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},F_.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!yv.isResultOfOp(r,e)||i.isCovered()||(n.add(i),t.setVisitedEdge(!0)))},F_.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){e.next().getEdges().findCoveredLineEdges()}for(var n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getEdge();if(r.isLineEdge()&&!i.isCoveredSet()){var o=t._op.isCoveredByA(r.getCoordinate());i.setCovered(o)}}},F_.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();r.isIsolated()&&(i.isNull(0)?e.labelIsolatedLine(r,0):e.labelIsolatedLine(r,1))}},F_.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),i=e._geometryFactory.createLineString(r.getCoordinates());e._resultLineList.add(i),r.setInResult(!0)}},F_.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();return t.isLineEdge()?null:t.isVisited()?null:t.isInteriorAreaEdge()?null:t.getEdge().isInResult()?null:(Uf.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(yv.isResultOfOp(r,e)&&e===yv.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},F_.prototype.interfaces_=function(){return[]},F_.prototype.getClass=function(){return F_};var q_=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new fg;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};q_.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},q_.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&(!r.isIncidentEdgeInResult()&&(0===r.getEdges().getDegree()||t===yv.INTERSECTION))){var i=r.getLabel();yv.isResultOfOp(i,t)&&e.filterCoveredNodeToPoint(r)}}},q_.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},q_.prototype.interfaces_=function(){return[]},q_.prototype.getClass=function(){return q_};var G_=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};G_.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},G_.prototype.transformPolygon=function(t,e){var n=this,r=!0,i=this.transformLinearRing(t.getExteriorRing(),t);null!==i&&i instanceof Vg&&!i.isEmpty()||(r=!1);for(var o=new fg,s=0;s<t.getNumInteriorRing();s++){var a=n.transformLinearRing(t.getInteriorRingN(s),t);null===a||a.isEmpty()||(a instanceof Vg||(r=!1),o.add(a))}if(r)return this._factory.createPolygon(i,o.toArray([]));var u=new fg;return null!==i&&u.add(i),u.addAll(o),this._factory.buildGeometry(u)},G_.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},G_.prototype.getInputGeometry=function(){return this._inputGeom},G_.prototype.transformMultiLineString=function(t,e){for(var n=this,r=new fg,i=0;i<t.getNumGeometries();i++){var o=n.transformLineString(t.getGeometryN(i),t);null!==o&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)},G_.prototype.transformCoordinates=function(t,e){return this.copy(t)},G_.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},G_.prototype.transformMultiPoint=function(t,e){for(var n=this,r=new fg,i=0;i<t.getNumGeometries();i++){var o=n.transformPoint(t.getGeometryN(i),t);null!==o&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)},G_.prototype.transformMultiPolygon=function(t,e){for(var n=this,r=new fg,i=0;i<t.getNumGeometries();i++){var o=n.transformPolygon(t.getGeometryN(i),t);null!==o&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)},G_.prototype.copy=function(t){return t.copy()},G_.prototype.transformGeometryCollection=function(t,e){for(var n=this,r=new fg,i=0;i<t.getNumGeometries();i++){var o=n.transform(t.getGeometryN(i));null!==o&&(n._pruneEmptyGeometry&&o.isEmpty()||r.add(o))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ud.toGeometryArray(r)):this._factory.buildGeometry(r)},G_.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof jg)return this.transformPoint(t,null);if(t instanceof Yg)return this.transformMultiPoint(t,null);if(t instanceof Vg)return this.transformLinearRing(t,null);if(t instanceof kg)return this.transformLineString(t,null);if(t instanceof Tg)return this.transformMultiLineString(t,null);if(t instanceof Ug)return this.transformPolygon(t,null);if(t instanceof Hg)return this.transformMultiPolygon(t,null);if(t instanceof Rg)return this.transformGeometryCollection(t,null);throw new af("Unknown Geometry subtype: "+t.getClass().getName())},G_.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},G_.prototype.interfaces_=function(){return[]},G_.prototype.getClass=function(){return G_};var B_=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new oy,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof kg&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};B_.prototype.snapVertices=function(t,e){for(var n=this,r=this._isClosed?t.size()-1:t.size(),i=0;i<r;i++){var o=t.get(i),s=n.findSnapForVertex(o,e);null!==s&&(t.set(i,new ff(s)),0===i&&n._isClosed&&t.set(t.size()-1,new ff(s)))}},B_.prototype.findSnapForVertex=function(t,e){for(var n=this,r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<n._snapTolerance)return e[r]}return null},B_.prototype.snapTo=function(t){var e=new dg(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},B_.prototype.snapSegments=function(t,e){var n=this;if(0===e.length)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var i=0;i<r;i++){var o=e[i],s=n.findSegmentIndexToSnap(o,t);s>=0&&t.add(s+1,new ff(o),!1)}},B_.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=uf.MAX_VALUE,i=-1,o=0;o<e.size()-1;o++){if(n._seg.p0=e.get(o),n._seg.p1=e.get(o+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var s=n._seg.distance(t);s<n._snapTolerance&&s<r&&(r=s,i=o)}return i},B_.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},B_.prototype.interfaces_=function(){return[]},B_.prototype.getClass=function(){return B_},B_.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var k_=function(t){this._srcGeom=t||null},z_={SNAP_PRECISION_FACTOR:{configurable:!0}};k_.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new j_(e,n).transform(this._srcGeom)},k_.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new j_(t,n,!0),i=r.transform(this._srcGeom),o=i;return e&&mf(o,Xg)&&(o=i.buffer(0)),o},k_.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},k_.prototype.extractTargetCoordinates=function(t){for(var e=new yu,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))},k_.prototype.computeMinimumSegmentLength=function(t){for(var e=uf.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},k_.prototype.interfaces_=function(){return[]},k_.prototype.getClass=function(){return k_},k_.snap=function(t,e,n){var r=new Array(2).fill(null),i=new k_(t);r[0]=i.snapTo(e,n);var o=new k_(e);return r[1]=o.snapTo(r[0],n),r},k_.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=k_.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===id.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(k_.computeOverlaySnapTolerance(i),k_.computeOverlaySnapTolerance(o))}},k_.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*k_.SNAP_PRECISION_FACTOR},k_.snapToSelf=function(t,e,n){return new k_(t).snapToSelf(e,n)},z_.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(k_,z_);var j_=function(t){function e(e,n,r){t.call(this),this._snapTolerance=e||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var n=new B_(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(G_),X_=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};X_.prototype.getCommon=function(){return uf.longBitsToDouble(this._commonBits)},X_.prototype.add=function(t){var e=uf.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=X_.signExpBits(this._commonBits),this._isFirst=!1,null):X_.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=X_.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=X_.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},X_.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=uf.longBitsToDouble(t),n=uf.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64);return i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]"}},X_.prototype.interfaces_=function(){return[]},X_.prototype.getClass=function(){return X_},X_.getBit=function(t,e){return 0!=(t&1<<e)?1:0},X_.signExpBits=function(t){return t>>52},X_.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},X_.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(X_.getBit(t,r)!==X_.getBit(e,r))return n;n++}return 52};var U_=function(){this._commonCoord=null,this._ccFilter=new V_},Y_={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};U_.prototype.addCommonBits=function(t){var e=new H_(this._commonCoord);t.apply(e),t.geometryChanged()},U_.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new ff(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new H_(e);return t.apply(n),t.geometryChanged(),t},U_.prototype.getCommonCoordinate=function(){return this._commonCoord},U_.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},U_.prototype.interfaces_=function(){return[]},U_.prototype.getClass=function(){return U_},Y_.CommonCoordinateFilter.get=function(){return V_},Y_.Translater.get=function(){return H_},Object.defineProperties(U_,Y_);var V_=function(){this._commonBitsX=new X_,this._commonBitsY=new X_};V_.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},V_.prototype.getCommonCoordinate=function(){return new ff(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},V_.prototype.interfaces_=function(){return[ng]},V_.prototype.getClass=function(){return V_};var H_=function(){this.trans=null;var t=arguments[0];this.trans=t};H_.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)},H_.prototype.isDone=function(){return!1},H_.prototype.isGeometryChanged=function(){return!0},H_.prototype.interfaces_=function(){return[Og]},H_.prototype.getClass=function(){return H_};var W_=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};W_.prototype.selfSnap=function(t){return new k_(t).snapTo(t,this._snapTolerance)},W_.prototype.removeCommonBits=function(t){this._cbr=new U_,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},W_.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},W_.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=yv.overlayOp(e[0],e[1],t);return this.prepareResult(n)},W_.prototype.checkValid=function(t){t.isValid()||Tf.out.println("Snapped geometry is invalid")},W_.prototype.computeSnapTolerance=function(){this._snapTolerance=k_.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},W_.prototype.snap=function(t){var e=this.removeCommonBits(t);return k_.snap(e[0],e[1],this._snapTolerance)},W_.prototype.interfaces_=function(){return[]},W_.prototype.getClass=function(){return W_},W_.overlayOp=function(t,e,n){return new W_(t,e).getResultGeometry(n)},W_.union=function(t,e){return W_.overlayOp(t,e,yv.UNION)},W_.intersection=function(t,e){return W_.overlayOp(t,e,yv.INTERSECTION)},W_.symDifference=function(t,e){return W_.overlayOp(t,e,yv.SYMDIFFERENCE)},W_.difference=function(t,e){return W_.overlayOp(t,e,yv.DIFFERENCE)};var J_=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};J_.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=yv.overlayOp(this._geom[0],this._geom[1],t);n=!0}catch(t){if(!(t instanceof jf))throw t;r=t}if(!n)try{e=W_.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof jf?r:t}return e},J_.prototype.interfaces_=function(){return[]},J_.prototype.getClass=function(){return J_},J_.overlayOp=function(t,e,n){return new J_(t,e).getResultGeometry(n)},J_.union=function(t,e){return J_.overlayOp(t,e,yv.UNION)},J_.intersection=function(t,e){return J_.overlayOp(t,e,yv.INTERSECTION)},J_.symDifference=function(t,e){return J_.overlayOp(t,e,yv.SYMDIFFERENCE)},J_.difference=function(t,e){return J_.overlayOp(t,e,yv.DIFFERENCE)};var Z_=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};Z_.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},Z_.prototype.interfaces_=function(){return[]},Z_.prototype.getClass=function(){return Z_};var K_=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},Q_={INSERT:{configurable:!0},DELETE:{configurable:!0}};K_.prototype.isDelete=function(){return this._eventType===K_.DELETE},K_.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},K_.prototype.getObject=function(){return this._obj},K_.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},K_.prototype.getInsertEvent=function(){return this._insertEvent},K_.prototype.isInsert=function(){return this._eventType===K_.INSERT},K_.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},K_.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},K_.prototype.interfaces_=function(){return[hf]},K_.prototype.getClass=function(){return K_},Q_.INSERT.get=function(){return 1},Q_.DELETE.get=function(){return 2},Object.defineProperties(K_,Q_);var $_=function(){};$_.prototype.interfaces_=function(){return[]},$_.prototype.getClass=function(){return $_};var tv=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};tv.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(tv.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},tv.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},tv.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},tv.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},tv.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinate();if(t.isIntersection(i))return!0}return!1},tv.prototype.hasProperIntersection=function(){return this._hasProper},tv.prototype.hasIntersection=function(){return this._hasIntersection},tv.prototype.isDone=function(){return this._isDone},tv.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},tv.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},tv.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},tv.prototype.interfaces_=function(){return[]},tv.prototype.getClass=function(){return tv},tv.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var ev=function(t){function e(){t.call(this),this.events=new fg,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var t=this;Ud.sort(this.events);for(var e=0;e<this.events.size();e++){var n=t.events.get(e);n.isDelete()&&n.getInsertEvent().setDeleteEventIndex(e)}},e.prototype.computeIntersections=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var r=t.events.get(n);if(r.isInsert()&&t.processOverlaps(n,r.getDeleteEventIndex(),r,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof tv&&mf(arguments[0],pg)&&mf(arguments[1],pg)){var i=arguments[0],o=arguments[1],s=arguments[2];this.addEdges(i,i),this.addEdges(o,o),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&mf(arguments[0],pg)&&arguments[1]instanceof tv){var a=arguments[0],u=arguments[1],c=arguments[2];c?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(u)}},e.prototype.addEdge=function(t,e){for(var n=this,r=t.getMonotoneChainEdge(),i=r.getStartIndexes(),o=0;o<i.length-1;o++){var s=new Z_(r,o),a=new K_(e,r.getMinX(o),s);n.events.add(a),n.events.add(new K_(r.getMaxX(o),a))}},e.prototype.processOverlaps=function(t,e,n,r){for(var i=this,o=n.getObject(),s=t;s<e;s++){var a=i.events.get(s);if(a.isInsert()){var u=a.getObject();n.isSameLabel(a)||(o.computeIntersections(u,r),i.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.addEdge(r,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=i.iterator();s.hasNext();){var a=s.next();t.addEdge(a,o)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($_),nv=function(){this._min=uf.POSITIVE_INFINITY,this._max=uf.NEGATIVE_INFINITY},rv={NodeComparator:{configurable:!0}};nv.prototype.getMin=function(){return this._min},nv.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},nv.prototype.getMax=function(){return this._max},nv.prototype.toString=function(){return zf.toLineString(new ff(this._min,0),new ff(this._max,0))},nv.prototype.interfaces_=function(){return[]},nv.prototype.getClass=function(){return nv},rv.NodeComparator.get=function(){return iv},Object.defineProperties(nv,rv);var iv=function(){};iv.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},iv.prototype.interfaces_=function(){return[pf]},iv.prototype.getClass=function(){return iv};var ov=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._min=e,this._max=n,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(nv),sv=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],n=arguments[1];this._node1=e,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(nv),av=function(){this._leaves=new fg,this._root=null,this._level=0};av.prototype.buildTree=function(){var t=this;Ud.sort(this._leaves,new nv.NodeComparator);for(var e=this._leaves,n=null,r=new fg;;){if(t.buildLevel(e,r),1===r.size())return r.get(0);n=e,e=r,r=n}},av.prototype.insert=function(t,e,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new ov(t,e,n))},av.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)},av.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},av.prototype.printNode=function(t){Tf.out.println(zf.toLineString(new ff(t._min,this._level),new ff(t._max,this._level)))},av.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},av.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(r);else{var i=new sv(t.get(n),t.get(n+1));e.add(i)}}},av.prototype.interfaces_=function(){return[]},av.prototype.getClass=function(){return av};var uv=function(){this._items=new fg};uv.prototype.visitItem=function(t){this._items.add(t)},uv.prototype.getItems=function(){return this._items},uv.prototype.interfaces_=function(){return[kd]},uv.prototype.getClass=function(){return uv};var cv=function(){this._index=null;var t=arguments[0];if(!mf(t,Xg))throw new af("Argument must be Polygonal");this._index=new pv(t)},hv={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};cv.prototype.locate=function(t){var e=new Jf(t),n=new lv(e);return this._index.query(t.y,t.y,n),e.getLocation()},cv.prototype.interfaces_=function(){return[Py]},cv.prototype.getClass=function(){return cv},hv.SegmentVisitor.get=function(){return lv},hv.IntervalIndexedGeometry.get=function(){return pv},Object.defineProperties(cv,hv);var lv=function(){this._counter=null;var t=arguments[0];this._counter=t};lv.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},lv.prototype.interfaces_=function(){return[kd]},lv.prototype.getClass=function(){return lv};var pv=function(){this._index=new av;var t=arguments[0];this.init(t)};pv.prototype.init=function(t){for(var e=this,n=g_.getLines(t),r=n.iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();e.addLine(o)}},pv.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var r=new oy(t[n-1],t[n]),i=Math.min(r.p0.y,r.p1.y),o=Math.max(r.p0.y,r.p1.y);e._index.insert(i,o,r)}},pv.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new uv;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},pv.prototype.interfaces_=function(){return[]},pv.prototype.getClass=function(){return pv};var fv=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new rd,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new d_,2===arguments.length){var e=arguments[0],n=arguments[1],r=rg.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var r=this._nodes.addNode(n),i=r.getLabel(),o=1,s=_f.NONE;(s=i.getLocation(t,yd.ON))===_f.BOUNDARY&&o++;var a=e.determineBoundary(this._boundaryNodeRule,o);i.setLocation(t,a)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new tv(n,!0,!1);o.setIsDoneIfProperInt(i);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof Vg||this._parentGeom instanceof Ug||this._parentGeom instanceof Hg,u=r||!a;return s.computeIntersections(this._edges,o,u),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();){e.next().eiList.addSplitEdges(t)}},e.prototype.computeEdgeIntersections=function(t,e,n){var r=new tv(e,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof jg){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this._argIndex,e,_f.INTERIOR)}else if(arguments[0]instanceof ff){var n=arguments[0];this.insertPoint(this._argIndex,n,_f.INTERIOR)}},e.prototype.addPolygon=function(t){var e=this;this.addPolygonRing(t.getExteriorRing(),_f.EXTERIOR,_f.INTERIOR);for(var n=0;n<t.getNumInteriorRing();n++){var r=t.getInteriorRingN(n);e.addPolygonRing(r,_f.INTERIOR,_f.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],_f.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],_f.BOUNDARY)},e.prototype.addLineString=function(t){var e=yg.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new Vy(e,new bd(this._argIndex,_f.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),Uf.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,r=t.iterator();r.hasNext();){var i=r.next();e[n++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===_f.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var r=yg.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=e,o=n;Zf.isCCW(r)&&(i=n,o=e);var s=new Vy(r,new bd(this._argIndex,_f.BOUNDARY,i,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],_f.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var r=this._nodes.addNode(e),i=r.getLabel();null===i?r._label=new bd(t,n):i.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new ev},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this,n=this._edges.iterator();n.hasNext();)for(var r=n.next(),i=r.getLabel().getLocation(t),o=r.eiList.iterator();o.hasNext();){var s=o.next();e.addSelfIntersectionNode(t,s.coord,i)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof Hg&&(this._useBoundaryDeterminationRule=!1),e instanceof Ug)this.addPolygon(e);else if(e instanceof kg)this.addLineString(e);else if(e instanceof jg)this.addPoint(e);else if(e instanceof Yg)this.addCollection(e);else if(e instanceof Tg)this.addCollection(e);else if(e instanceof Hg)this.addCollection(e);else{
if(!(e instanceof Rg))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}},e.prototype.locate=function(t){return mf(this._parentGeom,Xg)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new cv(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?_f.BOUNDARY:_f.INTERIOR},e}(Dd),gv=function(){if(this._li=new Hf,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new fv(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=rg.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new fv(0,e,r),this._arg[1]=new fv(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new fv(0,i,s),this._arg[1]=new fv(1,o,s)}};gv.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},gv.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},gv.prototype.interfaces_=function(){return[]},gv.prototype.getClass=function(){return gv};var dv=function(){};dv.prototype.interfaces_=function(){return[]},dv.prototype.getClass=function(){return dv},dv.map=function(){if(arguments[0]instanceof $f&&mf(arguments[1],dv.MapOp)){for(var t=arguments[0],e=arguments[1],n=new fg,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));null!==i&&n.add(i)}return t.getFactory().buildGeometry(n)}if(mf(arguments[0],cg)&&mf(arguments[1],dv.MapOp)){for(var o=arguments[0],s=arguments[1],a=new fg,u=o.iterator();u.hasNext();){var c=u.next(),h=s.map(c);null!==h&&a.add(h)}return a}},dv.MapOp=function(){};var yv=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n),this._ptLocator=new d_,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new qy,this._resultPolyList=new fg,this._resultLineList=new fg,this._resultPointList=new fg,this._graph=new Dd(new Dy),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new bd(t.getLabel()),r.flip());var i=e.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,n,r,i){var o=new fg;return o.addAll(t),o.addAll(n),o.addAll(r),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){t.next().getEdges().mergeSymLabels()}},e.prototype.isCovered=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(n._ptLocator.locate(t,i)!==_f.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new fg,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e.insertUniqueEdge(r)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new fg;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),A_.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Fd(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new F_(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var i=new q_(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this,n=this._arg[t].getNodeIterator();n.hasNext();){var r=n.next();e._graph.addNode(r.getCoordinate()).setLabel(t,r.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,yd.RIGHT),i.getLocation(1,yd.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(Uf.isTrue(!r.isNull(i,yd.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,yd.LEFT,r.getLocation(i,yd.LEFT)),Uf.isTrue(!r.isNull(i,yd.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,yd.RIGHT,r.getLocation(i,yd.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this,e=this._graph.getNodes().iterator();e.hasNext();){e.next().getEdges().computeLabelling(t._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this,e=this._graph.getNodes().iterator();e.hasNext();){var n=e.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?t.labelIncompleteNode(n,0):t.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(r)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gv);yv.overlayOp=function(t,e,n){return new yv(t,e).getResultGeometry(n)},yv.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return yv.createEmptyResult(yv.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return D_.map(t,{interfaces_:function(){return[dv.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),J_.overlayOp(t,e,yv.INTERSECTION)},yv.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return yv.createEmptyResult(yv.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),J_.overlayOp(t,e,yv.SYMDIFFERENCE)},yv.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case yv.INTERSECTION:o=Math.min(r,i);break;case yv.UNION:o=Math.max(r,i);break;case yv.DIFFERENCE:o=r;break;case yv.SYMDIFFERENCE:o=Math.max(r,i)}return o},yv.createEmptyResult=function(t,e,n,r){var i=null;switch(yv.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},yv.difference=function(t,e){return t.isEmpty()?yv.createEmptyResult(yv.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),J_.overlayOp(t,e,yv.DIFFERENCE))},yv.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return yv.isResultOfOp(n,r,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];switch(i===_f.BOUNDARY&&(i=_f.INTERIOR),o===_f.BOUNDARY&&(o=_f.INTERIOR),s){case yv.INTERSECTION:return i===_f.INTERIOR&&o===_f.INTERIOR;case yv.UNION:return i===_f.INTERIOR||o===_f.INTERIOR;case yv.DIFFERENCE:return i===_f.INTERIOR&&o!==_f.INTERIOR;case yv.SYMDIFFERENCE:return i===_f.INTERIOR&&o!==_f.INTERIOR||i!==_f.INTERIOR&&o===_f.INTERIOR}return!1}},yv.INTERSECTION=1,yv.UNION=2,yv.DIFFERENCE=3,yv.SYMDIFFERENCE=4;var _v=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new d_,this._seg=new oy;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};_v.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n),i=r.getCoordinateSequence(),o=0;o<i.size()-1;o++){i.getCoordinate(o,e._seg.p0),i.getCoordinate(o+1,e._seg.p1);var s=e._seg.distance(t);if(s<=e._boundaryDistanceTolerance)return!0}return!1},_v.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?_f.BOUNDARY:this._ptLocator.locate(t,this._g)},_v.prototype.extractLinework=function(t){var e=new vv;t.apply(e);var n=e.getLinework(),r=ud.toLineStringArray(n);return t.getFactory().createMultiLineString(r)},_v.prototype.interfaces_=function(){return[]},_v.prototype.getClass=function(){return _v};var vv=function(){this._linework=null,this._linework=new fg};vv.prototype.getLinework=function(){return this._linework},vv.prototype.filter=function(t){var e=this;if(t instanceof Ug){var n=t;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)e._linework.add(n.getInteriorRingN(r))}},vv.prototype.interfaces_=function(){return[Pg]},vv.prototype.getClass=function(){return vv};var mv=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};mv.prototype.extractPoints=function(t,e,n){for(var r=this,i=t.getCoordinates(),o=0;o<i.length-1;o++)r.computeOffsetPoints(i[o],i[o+1],e,n)},mv.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},mv.prototype.getPoints=function(t){for(var e=this,n=new fg,r=g_.getLines(this._g),i=r.iterator();i.hasNext();){var o=i.next();e.extractPoints(o,t,n)}return n},mv.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,s=Math.sqrt(i*i+o*o),a=n*i/s,u=n*o/s,c=(e.x+t.x)/2,h=(e.y+t.y)/2;if(this._doLeft){var l=new ff(c-u,h+a);r.add(l)}if(this._doRight){var p=new ff(c+u,h-a);r.add(p)}},mv.prototype.interfaces_=function(){return[]},mv.prototype.getClass=function(){return mv};var xv=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new fg;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new _v(this._geom[0],this._boundaryDistanceTolerance),new _v(this._geom[1],this._boundaryDistanceTolerance),new _v(this._geom[2],this._boundaryDistanceTolerance)]},Ev={TOLERANCE:{configurable:!0}};xv.prototype.reportResult=function(t,e,n){Tf.out.println("Overlay result invalid - A:"+_f.toLocationSymbol(e[0])+" B:"+_f.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+_f.toLocationSymbol(e[2]))},xv.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},xv.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),!!xv.hasLocation(this._location,_f.BOUNDARY)||this.isValidResult(i,this._location)}},xv.prototype.addTestPts=function(t){var e=new mv(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},xv.prototype.isValidResult=function(t,e){var n=yv.isResultOfOp(e[0],e[1],t),r=e[2]===_f.INTERIOR,i=!(n^r);return i||this.reportResult(t,e,n),i},xv.prototype.getInvalidLocation=function(){return this._invalidLocation},xv.prototype.interfaces_=function(){return[]},xv.prototype.getClass=function(){return xv},xv.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},xv.computeBoundaryDistanceTolerance=function(t,e){return Math.min(k_.computeSizeBasedSnapTolerance(t),k_.computeSizeBasedSnapTolerance(e))},xv.isValid=function(t,e,n,r){return new xv(t,e,r).isValid(n)},Ev.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(xv,Ev);var wv=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};wv.prototype.extractElements=function(t,e){var n=this;if(null===t)return null;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);n._skipEmpty&&i.isEmpty()||e.add(i)}},wv.prototype.combine=function(){for(var t=this,e=new fg,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();t.extractElements(r,e)}return 0===e.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)},wv.prototype.interfaces_=function(){return[]},wv.prototype.getClass=function(){return wv},wv.combine=function(){if(1===arguments.length){var t=arguments[0];return new wv(t).combine()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return new wv(wv.createList(e,n)).combine()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];return new wv(wv.createList(r,i,o)).combine()}},wv.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},wv.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new fg;return n.add(t),n.add(e),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=new fg;return s.add(r),s.add(i),s.add(o),s}};var bv=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new fg)},Iv={STRTREE_NODE_CAPACITY:{configurable:!0}};bv.prototype.reduceToGeometries=function(t){for(var e=this,n=new fg,r=t.iterator();r.hasNext();){var i=r.next(),o=null;mf(i,pg)?o=e.unionTree(i):i instanceof $f&&(o=i),n.add(o)}return n},bv.prototype.extractByEnvelope=function(t,e,n){for(var r=new fg,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},bv.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){return wv.combine(t,e)}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,i)},bv.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new Zd(bv.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},bv.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=bv.getGeometry(e,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(bv.getGeometry(e,n),bv.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),s=this.binaryUnion(e,n,o),a=this.binaryUnion(e,o,r);return this.unionSafe(s,a)}},bv.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e=null===e?r.copy():e.union(r)}return e},bv.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},bv.prototype.unionActual=function(t,e){return bv.restrictToPolygons(t.union(e))},bv.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},bv.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new fg,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),s=this.unionActual(i,o);return r.add(s),wv.combine(r)},bv.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().createGeometryCollection([e,n]).buffer(0)}},bv.prototype.interfaces_=function(){return[]},bv.prototype.getClass=function(){return bv},bv.restrictToPolygons=function(t){if(mf(t,Xg))return t;var e=f_.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(ud.toPolygonArray(e))},bv.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},bv.union=function(t){return new bv(t).union()},Iv.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(bv,Iv);var Nv=function(){};Nv.prototype.interfaces_=function(){return[]},Nv.prototype.getClass=function(){return Nv},Nv.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return yv.createEmptyResult(yv.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),J_.overlayOp(t,e,yv.UNION)};var Cv=function(){return new Cu};Cu.prototype={constructor:Cu,reset:function(){this.s=this.t=0},add:function(t){Su(Sv,t,this.t),Su(this,Sv.s,this.s),this.s?this.t+=Sv.t:this.s=Sv.t},valueOf:function(){return this.s}};var Sv=new Cu,Mv=1e-6,Lv=Math.PI,Pv=Lv/2,Ov=Lv/4,Rv=2*Lv,Tv=180/Lv,Av=Lv/180,Dv=Math.abs,Fv=Math.atan,qv=Math.atan2,Gv=Math.cos,Bv=Math.exp,kv=Math.log,zv=Math.sin,jv=Math.sqrt,Xv=Math.tan,Uv={Feature:function(t,e){Ou(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Ou(n[r].geometry,e)}},Yv={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Ru(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Ru(n[r],e,0)},Polygon:function(t,e){Tu(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Tu(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Ou(n[r],e)}},Vv=function(t,e){t&&Uv.hasOwnProperty(t.type)?Uv[t.type](t,e):Ou(t,e)},Hv=(Cv(),Cv(),Cv(),function(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n});zu.invert=zu;var Wv=function(t){function e(e){return e=t(e[0]*Av,e[1]*Av),e[0]*=Tv,e[1]*=Tv,e}return t=ju(t[0]*Av,t[1]*Av,t.length>2?t[2]*Av:0),e.invert=function(e){return e=t.invert(e[0]*Av,e[1]*Av),e[0]*=Tv,e[1]*=Tv,e},e},Jv=function(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:Pu,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},Zv=function(t,e,n,r,i,o){var s,a=t[0],u=t[1],c=e[0],h=e[1],l=0,p=1,f=c-a,g=h-u;if(s=n-a,f||!(s>0)){if(s/=f,f<0){if(s<l)return;s<p&&(p=s)}else if(f>0){if(s>p)return;s>l&&(l=s)}if(s=i-a,f||!(s<0)){if(s/=f,f<0){if(s>p)return;s>l&&(l=s)}else if(f>0){if(s<l)return;s<p&&(p=s)}if(s=r-u,g||!(s>0)){if(s/=g,g<0){if(s<l)return;s<p&&(p=s)}else if(g>0){if(s>p)return;s>l&&(l=s)}if(s=o-u,g||!(s<0)){if(s/=g,g<0){if(s>p)return;s>l&&(l=s)}else if(g>0){if(s<l)return;s<p&&(p=s)}return l>0&&(t[0]=a+l*f,t[1]=u+l*g),p<1&&(e[0]=a+p*f,e[1]=u+p*g),!0}}}}},Kv=function(t,e){return Dv(t[0]-e[0])<Mv&&Dv(t[1]-e[1])<Mv},Qv=function(t,e,n,r,i){var o,s,a=[],u=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],s=t[e];if(Kv(r,s)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);return void i.lineEnd()}a.push(n=new Wu(r,t,null,!0)),u.push(n.o=new Wu(r,null,n,!1)),a.push(n=new Wu(s,t,null,!1)),u.push(n.o=new Wu(s,null,n,!0))}}),a.length){for(u.sort(e),Ju(a),Ju(u),o=0,s=u.length;o<s;++o)u[o].e=n=!n;for(var c,h,l=a[0];;){for(var p=l,f=!0;p.v;)if((p=p.n)===l)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(o=0,s=c.length;o<s;++o)i.point((h=c[o])[0],h[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(f)for(c=p.p.z,o=c.length-1;o>=0;--o)i.point((h=c[o])[0],h[1]);else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,c=p.z,f=!f}while(!p.v);i.lineEnd()}}},$v=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},tm=(function(t){1===t.length&&(t=Zu(t))}($v),function(t){for(var e,n,r,i=t.length,o=-1,s=0;++o<i;)s+=t[o].length;for(n=new Array(s);--i>=0;)for(r=t[i],e=r.length;--e>=0;)n[--s]=r[e];return n}),em=1e9,nm=-em,rm=Cv(),im=function(t,e){var n=e[0],r=e[1],i=[zv(n),-Gv(n),0],o=0,s=0;rm.reset();for(var a=0,u=t.length;a<u;++a)if(h=(c=t[a]).length)for(var c,h,l=c[h-1],p=l[0],f=l[1]/2+Ov,g=zv(f),d=Gv(f),y=0;y<h;++y,p=v,g=x,d=E,l=_){var _=c[y],v=_[0],m=_[1]/2+Ov,x=zv(m),E=Gv(m),w=v-p,b=w>=0?1:-1,I=b*w,N=I>Lv,C=g*x;if(rm.add(qv(C*b*zv(I),d*E+C*Gv(I))),o+=N?w+b*Rv:w,N^p>=n^v>=n){var S=qu(Du(l),Du(_));ku(S);var M=qu(i,S);ku(M);var L=(N^w>=0?-1:1)*Lu(M[2]);(r>L||r===L&&(S[0]||S[1]))&&(s+=N^w>=0?1:-1)}}return(o<-Mv||o<Mv&&rm<-Mv)^1&s},om=(Cv(),function(t){return t}),sm=(Cv(),Cv(),1/0),am=sm,um=-sm,cm=um,hm={point:Qu,lineStart:Pu,lineEnd:Pu,polygonStart:Pu,polygonEnd:Pu,result:function(){var t=[[sm,am],[um,cm]];return um=cm=-(am=sm=1/0),t}},lm=(Cv(),function(t,e,n,r){return function(i,o){function s(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function a(t,e){var n=i(t,e);y.point(n[0],n[1])}function u(){E.point=a,y.lineStart()}function c(){E.point=s,y.lineEnd()}function h(t,e){d.push([t,e]);var n=i(t,e);m.point(n[0],n[1])}function l(){m.lineStart(),d=[]}function p(){h(d[0][0],d[0][1]),m.lineEnd();var t,e,n,r,i=m.clean(),s=v.result(),a=s.length;if(d.pop(),f.push(d),d=null,a)if(1&i){if(n=s[0],(e=n.length-1)>0){for(x||(o.polygonStart(),x=!0),o.lineStart(),t=0;t<e;++t)o.point((r=n[t])[0],r[1]);o.lineEnd()}}else a>1&&2&i&&s.push(s.pop().concat(s.shift())),g.push(s.filter($u))}var f,g,d,y=e(o),_=i.invert(r[0],r[1]),v=Jv(),m=e(v),x=!1,E={point:s,lineStart:u,lineEnd:c,polygonStart:function(){E.point=h,E.lineStart=l,E.lineEnd=p,g=[],f=[]},polygonEnd:function(){E.point=s,E.lineStart=u,E.lineEnd=c,g=tm(g);var t=im(f,_);g.length?(x||(o.polygonStart(),x=!0),Qv(g,tc,t,n,o)):t&&(x||(o.polygonStart(),x=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),x&&(o.polygonEnd(),x=!1),g=f=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};return E}}),pm=lm(function(){return!0},ec,rc,[-Lv,-Pv]),fm=function(t,e){function n(n,r,i,o){Vu(o,t,e,i,n,r)}function r(t,e){return Gv(t)*Gv(e)>a}function i(t){var e,n,i,a,h;return{lineStart:function(){a=i=!1,h=1},point:function(l,p){var f,g=[l,p],d=r(l,p),y=u?d?0:s(l,p):d?s(l+(l<0?Lv:-Lv),p):0;if(!e&&(a=i=d)&&t.lineStart(),d!==i&&(!(f=o(e,g))||Kv(e,f)||Kv(g,f))&&(g[0]+=Mv,g[1]+=Mv,d=r(g[0],g[1])),d!==i)h=0,d?(t.lineStart(),f=o(g,e),t.point(f[0],f[1])):(f=o(e,g),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(c&&e&&u^d){var _;y&n||!(_=o(g,e,!0))||(h=0,u?(t.lineStart(),t.point(_[0][0],_[0][1]),t.point(_[1][0],_[1][1]),t.lineEnd()):(t.point(_[1][0],_[1][1]),t.lineEnd(),t.lineStart(),t.point(_[0][0],_[0][1])))}!d||e&&Kv(e,g)||t.point(g[0],g[1]),e=g,i=d,n=y},lineEnd:function(){i&&t.lineEnd(),e=null},clean:function(){return h|(a&&i)<<1}}}function o(t,e,n){var r=Du(t),i=Du(e),o=[1,0,0],s=qu(r,i),u=Fu(s,s),c=s[0],h=u-c*c;if(!h)return!n&&t;var l=a*u/h,p=-a*c/h,f=qu(o,s),g=Bu(o,l);Gu(g,Bu(s,p));var d=f,y=Fu(g,d),_=Fu(d,d),v=y*y-_*(Fu(g,g)-1);if(!(v<0)){var m=jv(v),x=Bu(d,(-y-m)/_);if(Gu(x,g),x=Au(x),!n)return x;var E,w=t[0],b=e[0],I=t[1],N=e[1];b<w&&(E=w,w=b,b=E);var C=b-w,S=Dv(C-Lv)<Mv,M=S||C<Mv;if(!S&&N<I&&(E=I,I=N,N=E),M?S?I+N>0^x[1]<(Dv(x[0]-w)<Mv?I:N):I<=x[1]&&x[1]<=N:C>Lv^(w<=x[0]&&x[0]<=b)){var L=Bu(d,(-y+m)/_);return Gu(L,g),[x,Au(L)]}}}function s(e,n){var r=u?t:Lv-t,i=0;return e<-r?i|=1:e>r&&(i|=2),n<-r?i|=4:n>r&&(i|=8),i}var a=Gv(t),u=a>0,c=Dv(a)>Mv;return lm(r,i,n,u?[0,-t]:[-Lv,t-Lv])};oc.prototype={constructor:oc,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var gm=16,dm=Gv(30*Av),ym=function(t,e){return+e?cc(t,e):uc(t)},_m=ic({point:function(t,e){this.stream.point(t*Av,e*Av)}});pc.invert=function(t,e){return[t,2*Fv(Bv(e))-Pv]},gc.invert=function(t,e){return[-e,2*Fv(Bv(t))-Pv]};var vm=function(){var t=fc(gc),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90]).scale(159.155)};t.projection=Fh,t.random=rf,t.clusters=of,t.helpers=Uc,t.invariant=Vc,t.meta=Yc,t.isolines=yt,t.convex=ae,t.pointsWithinPolygon=le,t.concave=ze,t.collect=Xe,t.flip=Ue,t.simplify=en,t.bezierSpline=an,t.tag=un,t.sample=cn,t.envelope=pn,t.square=fn,t.circle=dn,t.midpoint=vn,t.center=mn,t.centerOfMass=En,t.centroid=xn,t.combine=wn,t.distance=_e,t.explode=bn,t.bbox=J,t.tesselate=$n,t.bboxPolygon=ln,t.booleanPointInPolygon=ue,t.nearestPoint=nr,t.nearestPointOnLine=Or,t.nearestPointToLine=Hr,t.planepoint=Jr,t.tin=pe,t.bearing=yn,t.destination=gn,t.kinks=Zr,t.pointOnFeature=Qr,t.area=ei,t.along=si,t.length=ai,t.lineSlice=ui,t.lineSliceAlong=ci,t.pointGrid=bi,t.truncate=Ii,t.flatten=Ci,t.lineIntersect=Lr,t.lineChunk=Si,t.unkinkPolygon=Di,t.greatCircle=Fi,t.lineSegment=Nr,t.lineSplit=qi,t.lineArc=ji,t.polygonToLine=Ui,t.lineToPolygon=Vi,t.bboxClip=to,t.lineOverlap=uo,t.sector=ho,t.rhumbBearing=Rr,t.rhumbDistance=Ar,t.rhumbDestination=po,t.polygonTangents=go,t.rewind=Eo,t.isobands=qo,t.transformRotate=Uo,t.transformScale=Yo,t.transformTranslate=Wo,t.lineOffset=rs,t.polygonize=ls,t.booleanDisjoint=ps,t.booleanContains=xs,t.booleanCrosses=Os,t.booleanClockwise=xo,t.booleanOverlap=ks,t.booleanPointOnLine=hi,t.booleanEqual=zs,t.booleanWithin=pi,t.clone=ve,t.cleanCoords=Ye,t.clustersDbscan=js,t.clustersKmeans=Ys,t.pointToLineDistance=jr,t.booleanParallel=Vs,t.shortestPath=ta,t.voronoi=Da,t.ellipse=Fa,t.centerMean=Ga,t.centerMedian=Ba,t.standardDeviationalEllipse=za,t.difference=Iu,t.buffer=dc,t.union=Ec,t.intersect=wc,t.dissolve=Nc,t.hexGrid=Sc,t.mask=Pc,t.squareGrid=qc,t.triangleGrid=Gc,t.interpolate=Bc,t.pointOnSurface=Qr,t.polygonToLineString=Ui,t.lineStringToPolygon=Vi,t.inside=ue,t.within=le,t.bezier=an,t.nearest=nr,t.pointOnLine=Or,t.lineDistance=ai,t.radians2degrees=m,t.degrees2radians=x,t.distanceToDegrees=_,t.distanceToRadians=y,t.radiansToDistance=d,t.bearingToAngle=v,t.convertDistance=E,t.toMercator=Fr,t.toWgs84=qr,t.randomPosition=Xa,t.randomPoint=Ua,t.randomPolygon=Ya,t.randomLineString=Va,t.getCluster=Qa,t.clusterEach=$a,t.clusterReduce=tu,t.createBins=eu,t.applyFilter=nu,t.propertiesContainsFilter=ru,t.filterProperties=iu,t.earthRadius=kc,t.factors=zc,t.unitsFactors=jc,t.areaFactors=Xc,t.feature=e,t.geometry=n,t.point=r,t.points=i,t.polygon=o,t.polygons=s,t.lineString=a,t.lineStrings=u,t.featureCollection=c,t.multiLineString=h,t.multiPoint=l,t.multiPolygon=p,t.geometryCollection=f,t.round=g,t.radiansToLength=d,t.lengthToRadians=y,t.lengthToDegrees=_,t.bearingToAzimuth=v,t.radiansToDegrees=m,t.degreesToRadians=x,t.convertLength=E,t.convertArea=w,t.isNumber=b,t.isObject=I,t.validateBBox=N,t.validateId=C,t.getCoord=Z,t.getCoords=K,t.containsNumber=Q,t.geojsonType=$,t.featureOf=tt,t.collectionOf=et,t.getGeom=nt,t.getGeomType=rt,t.getType=it,t.coordEach=A,t.coordReduce=D,t.propEach=F,t.propReduce=q,t.featureEach=G,t.featureReduce=B,t.coordAll=k,t.geomEach=z,t.geomReduce=j,t.flattenEach=X,t.flattenReduce=U,t.segmentEach=Y,t.segmentReduce=V,t.lineEach=H,t.lineReduce=W,Object.defineProperty(t,"__esModule",{value:!0})});
},{}],29:[function(_dereq_,module,exports){
function geometry(r){if("Polygon"===r.type)return polygonArea(r.coordinates);if("MultiPolygon"===r.type){for(var e=0,n=0;n<r.coordinates.length;n++)e+=polygonArea(r.coordinates[n]);return e}return null}function polygonArea(r){var e=0;if(r&&r.length>0){e+=Math.abs(ringArea(r[0]));for(var n=1;n<r.length;n++)e-=Math.abs(ringArea(r[n]))}return e}function ringArea(r){var e=0;if(r.length>2){for(var n,t,o=0;o<r.length-1;o++)n=r[o],t=r[o+1],e+=rad(t[0]-n[0])*(2+Math.sin(rad(n[1]))+Math.sin(rad(t[1])));e=e*wgs84.RADIUS*wgs84.RADIUS/2}return e}function rad(r){return r*Math.PI/180}var wgs84=_dereq_("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea;
},{"wgs84":26}],30:[function(_dereq_,module,exports){
function rewind(r,e){switch(r&&r.type||null){case"FeatureCollection":return r.features=r.features.map(curryOuter(rewind,e)),r;case"Feature":return r.geometry=rewind(r.geometry,e),r;case"Polygon":case"MultiPolygon":return correct(r,e);default:return r}}function curryOuter(r,e){return function(n){return r(n,e)}}function correct(r,e){return"Polygon"===r.type?r.coordinates=correctRings(r.coordinates,e):"MultiPolygon"===r.type&&(r.coordinates=r.coordinates.map(curryOuter(correctRings,e))),r}function correctRings(r,e){e=!!e,r[0]=wind(r[0],e);for(var n=1;n<r.length;n++)r[n]=wind(r[n],!e);return r}function wind(r,e){return cw(r)===e?r:r.reverse()}function cw(r){return geojsonArea.ring(r)>=0}var geojsonArea=_dereq_("../geojson-area");module.exports=rewind;
},{"../geojson-area":29}],31:[function(_dereq_,module,exports){
"use strict";function clip(e,r,t,n,u,i,l,s){if(t/=r,n/=r,l>=t&&s<=n)return e;if(l>n||s<t)return null;for(var h=[],p=0;p<e.length;p++){var a,c,o=e[p],f=o.geometry,g=o.type;if(a=o.min[u],c=o.max[u],a>=t&&c<=n)h.push(o);else if(!(a>n||c<t)){var v=1===g?clipPoints(f,t,n,u):clipGeometry(f,t,n,u,i,3===g);v.length&&h.push(createFeature(o.tags,g,v,o.id))}}return h.length?h:null}function clipPoints(e,r,t,n){for(var u=[],i=0;i<e.length;i++){var l=e[i],s=l[n];s>=r&&s<=t&&u.push(l)}return u}function clipGeometry(e,r,t,n,u,i){for(var l=[],s=0;s<e.length;s++){var h,p,a,c=0,o=0,f=null,g=e[s],v=g.area,m=g.dist,w=g.outer,S=g.length,d=[];for(p=0;p<S-1;p++)h=f||g[p],f=g[p+1],c=o||h[n],o=f[n],c<r?o>t?(d.push(u(h,f,r),u(h,f,t)),i||(d=newSlice(l,d,v,m,w))):o>=r&&d.push(u(h,f,r)):c>t?o<r?(d.push(u(h,f,t),u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o<=t&&d.push(u(h,f,t)):(d.push(h),o<r?(d.push(u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o>t&&(d.push(u(h,f,t)),i||(d=newSlice(l,d,v,m,w))));h=g[S-1],c=h[n],c>=r&&c<=t&&d.push(h),a=d[d.length-1],i&&a&&(d[0][0]!==a[0]||d[0][1]!==a[1])&&d.push(d[0]),newSlice(l,d,v,m,w)}return l}function newSlice(e,r,t,n,u){return r.length&&(r.area=t,r.dist=n,void 0!==u&&(r.outer=u),e.push(r)),[]}module.exports=clip;var createFeature=_dereq_("./feature");
},{"./feature":33}],32:[function(_dereq_,module,exports){
"use strict";function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)convertFeature(r,e.features[o],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){if(null!==t.geometry){var o,a,i,n,u=t.geometry,c=u.type,l=u.coordinates,s=t.properties,p=t.id;if("Point"===c)e.push(createFeature(s,1,[projectPoint(l)],p));else if("MultiPoint"===c)e.push(createFeature(s,1,project(l),p));else if("LineString"===c)e.push(createFeature(s,2,[project(l,r)],p));else if("MultiLineString"===c||"Polygon"===c){for(i=[],o=0;o<l.length;o++)n=project(l[o],r),"Polygon"===c&&(n.outer=0===o),i.push(n);e.push(createFeature(s,"Polygon"===c?3:2,i,p))}else if("MultiPolygon"===c){for(i=[],o=0;o<l.length;o++)for(a=0;a<l[o].length;a++)n=project(l[o][a],r),n.outer=0===a,i.push(n);e.push(createFeature(s,3,i,p))}else{if("GeometryCollection"!==c)throw new Error("Input data is not a valid GeoJSON object.");for(o=0;o<u.geometries.length;o++)convertFeature(e,{geometry:u.geometries[o],properties:s},r)}}}function project(e,t){for(var r=[],o=0;o<e.length;o++)r.push(projectPoint(e[o]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return o=o<0?0:o>1?1:o,[r,o,0]}function calcSize(e){for(var t,r,o=0,a=0,i=0;i<e.length-1;i++)t=r||e[i],r=e[i+1],o+=t[0]*r[1]-r[0]*t[1],a+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(o/2),e.dist=a}module.exports=convert;var simplify=_dereq_("./simplify"),createFeature=_dereq_("./feature");
},{"./feature":33,"./simplify":35}],33:[function(_dereq_,module,exports){
"use strict";function createFeature(e,t,a,n){var r={id:n||null,type:t,geometry:a,tags:e||null,min:[1/0,1/0],max:[-1/0,-1/0]};return calcBBox(r),r}function calcBBox(e){var t=e.geometry,a=e.min,n=e.max;if(1===e.type)calcRingBBox(a,n,t);else for(var r=0;r<t.length;r++)calcRingBBox(a,n,t[r]);return e}function calcRingBBox(e,t,a){for(var n,r=0;r<a.length;r++)n=a[r],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1])}module.exports=createFeature;
},{}],34:[function(_dereq_,module,exports){
"use strict";function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var i=t.debug;i&&console.time("preprocess data");var o=1<<t.maxZoom,n=convert(e,t.tolerance/(o*t.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=wrap(n,t.buffer/t.extent,intersectX),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,i){return 32*((1<<e)*i+t)+e}function intersectX(e,t,i){return[i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function intersectY(e,t,i){return[(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i,1]}function extend(e,t){for(var i in t)e[i]=t[i];return e}function isClippedSquare(e,t,i){var o=e.source;if(1!==o.length)return!1;var n=o[0];if(3!==n.type||n.geometry.length>1)return!1;var r=n.geometry[0].length;if(5!==r)return!1;for(var s=0;s<r;s++){var l=transform.point(n.geometry[0][s],t,e.z2,e.x,e.y);if(l[0]!==-i&&l[0]!==t+i||l[1]!==-i&&l[1]!==t+i)return!1}return!0}module.exports=geojsonvt;var convert=_dereq_("./convert"),transform=_dereq_("./transform"),clip=_dereq_("./clip"),wrap=_dereq_("./wrap"),createTile=_dereq_("./tile");GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,i,o,n,r,s){for(var l=[e,t,i,o],a=this.options,u=a.debug,c=null;l.length;){o=l.pop(),i=l.pop(),t=l.pop(),e=l.pop();var p=1<<t,d=toID(t,i,o),m=this.tiles[d],f=t===a.maxZoom?0:a.tolerance/(p*a.extent);if(!m&&(u>1&&console.time("creation"),m=this.tiles[d]=createTile(e,p,i,o,f,t===a.maxZoom),this.tileCoords.push({z:t,x:i,y:o}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,o,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var h="z"+t;this.stats[h]=(this.stats[h]||0)+1,this.total++}if(m.source=e,n){if(t===a.maxZoom||t===n)continue;var x=1<<n-t;if(i!==Math.floor(r/x)||o!==Math.floor(s/x))continue}else if(t===a.indexMaxZoom||m.numPoints<=a.indexMaxPoints)continue;if(a.solidChildren||!isClippedSquare(m,a.extent,a.buffer)){m.source=null,u>1&&console.time("clipping");var g,v,M,T,b,y,S=.5*a.buffer/a.extent,Z=.5-S,q=.5+S,w=1+S;g=v=M=T=null,b=clip(e,p,i-S,i+q,0,intersectX,m.min[0],m.max[0]),y=clip(e,p,i+Z,i+w,0,intersectX,m.min[0],m.max[0]),b&&(g=clip(b,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),v=clip(b,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),y&&(M=clip(y,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),T=clip(y,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),u>1&&console.timeEnd("clipping"),e.length&&(l.push(g||[],t+1,2*i,2*o),l.push(v||[],t+1,2*i,2*o+1),l.push(M||[],t+1,2*i+1,2*o),l.push(T||[],t+1,2*i+1,2*o+1))}else n&&(c=t)}return c},GeoJSONVT.prototype.getTile=function(e,t,i){var o=this.options,n=o.extent,r=o.debug,s=1<<e;t=(t%s+s)%s;var l=toID(e,t,i);if(this.tiles[l])return transform.tile(this.tiles[l],n);r>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var a,u=e,c=t,p=i;!a&&u>0;)u--,c=Math.floor(c/2),p=Math.floor(p/2),a=this.tiles[toID(u,c,p)];if(!a||!a.source)return null;if(r>1&&console.log("found parent tile z%d-%d-%d",u,c,p),isClippedSquare(a,n,o.buffer))return transform.tile(a,n);r>1&&console.time("drilling down");var d=this.splitTile(a.source,u,c,p,e,t,i);if(r>1&&console.timeEnd("drilling down"),null!==d){var m=1<<e-d;l=toID(d,Math.floor(t/m),Math.floor(i/m))}return this.tiles[l]?transform.tile(this.tiles[l],n):null};
},{"./clip":31,"./convert":32,"./tile":36,"./transform":37,"./wrap":38}],35:[function(_dereq_,module,exports){
"use strict";function simplify(t,i){var e,p,r,s,o=i*i,f=t.length,u=0,n=f-1,g=[];for(t[u][2]=1,t[n][2]=1;n;){for(p=0,e=u+1;e<n;e++)(r=getSqSegDist(t[e],t[u],t[n]))>p&&(s=e,p=r);p>o?(t[s][2]=p,g.push(u),g.push(s),u=s):(n=g.pop(),u=g.pop())}}function getSqSegDist(t,i,e){var p=i[0],r=i[1],s=e[0],o=e[1],f=t[0],u=t[1],n=s-p,g=o-r;if(0!==n||0!==g){var l=((f-p)*n+(u-r)*g)/(n*n+g*g);l>1?(p=s,r=o):l>0&&(p+=n*l,r+=g*l)}return n=f-p,g=u-r,n*n+g*g}module.exports=simplify;
},{}],36:[function(_dereq_,module,exports){
"use strict";function createTile(e,n,r,i,t,u){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z2:n,transformed:!1,min:[2,1],max:[-1,0]},m=0;m<e.length;m++){a.numFeatures++,addFeature(a,e[m],t,u);var s=e[m].min,l=e[m].max;s[0]<a.min[0]&&(a.min[0]=s[0]),s[1]<a.min[1]&&(a.min[1]=s[1]),l[0]>a.max[0]&&(a.max[0]=l[0]),l[1]>a.max[1]&&(a.max[1]=l[1])}return a}function addFeature(e,n,r,i){var t,u,a,m,s=n.geometry,l=n.type,o=[],f=r*r;if(1===l)for(t=0;t<s.length;t++)o.push(s[t]),e.numPoints++,e.numSimplified++;else for(t=0;t<s.length;t++)if(a=s[t],i||!(2===l&&a.dist<r||3===l&&a.area<f)){var d=[];for(u=0;u<a.length;u++)m=a[u],(i||m[2]>f)&&(d.push(m),e.numSimplified++),e.numPoints++;3===l&&rewind(d,a.outer),o.push(d)}else e.numPoints+=a.length;if(o.length){var g={geometry:o,type:l,tags:n.tags||null};null!==n.id&&(g.id=n.id),e.features.push(g)}}function rewind(e,n){signedArea(e)<0===n&&e.reverse()}function signedArea(e){for(var n,r,i=0,t=0,u=e.length,a=u-1;t<u;a=t++)n=e[t],r=e[a],i+=(r[0]-n[0])*(n[1]+r[1]);return i}module.exports=createTile;
},{}],37:[function(_dereq_,module,exports){
"use strict";function transformTile(r,t){if(r.transformed)return r;var n,e,o,f=r.z2,a=r.x,s=r.y;for(n=0;n<r.features.length;n++){var i=r.features[n],u=i.geometry;if(1===i.type)for(e=0;e<u.length;e++)u[e]=transformPoint(u[e],t,f,a,s);else for(e=0;e<u.length;e++){var m=u[e];for(o=0;o<m.length;o++)m[o]=transformPoint(m[o],t,f,a,s)}}return r.transformed=!0,r}function transformPoint(r,t,n,e,o){return[Math.round(t*(r[0]*n-e)),Math.round(t*(r[1]*n-o))]}exports.tile=transformTile,exports.point=transformPoint;
},{}],38:[function(_dereq_,module,exports){
"use strict";function wrap(r,e,t){var o=r,a=clip(r,1,-1-e,e,0,t,-1,2),s=clip(r,1,1-e,2+e,0,t,-1,2);return(a||s)&&(o=clip(r,1,-e,1+e,0,t,-1,2)||[],a&&(o=shiftFeatureCoords(a,1).concat(o)),s&&(o=o.concat(shiftFeatureCoords(s,-1)))),o}function shiftFeatureCoords(r,e){for(var t=[],o=0;o<r.length;o++){var a,s=r[o],i=s.type;if(1===i)a=shiftCoords(s.geometry,e);else{a=[];for(var u=0;u<s.geometry.length;u++)a.push(shiftCoords(s.geometry[u],e))}t.push(createFeature(s.tags,i,a,s.id))}return t}function shiftCoords(r,e){var t=[];t.area=r.area,t.dist=r.dist;for(var o=0;o<r.length;o++)t.push([r[o][0]+e,r[o][1],r[o][2]]);return t}var clip=_dereq_("./clip"),createFeature=_dereq_("./feature");module.exports=wrap;
},{"./clip":31,"./feature":33}],39:[function(_dereq_,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.glMatrix=n()}(this,function(){"use strict";function t(t,n,r){var e=n[0],a=n[1],o=n[2];return t[0]=e*r[0]+a*r[3]+o*r[6],t[1]=e*r[1]+a*r[4]+o*r[7],t[2]=e*r[2]+a*r[5]+o*r[8],t}function n(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3];return t[0]=r[0]*e+r[4]*a+r[8]*o+r[12]*u,t[1]=r[1]*e+r[5]*a+r[9]*o+r[13]*u,t[2]=r[2]*e+r[6]*a+r[10]*o+r[14]*u,t[3]=r[3]*e+r[7]*a+r[11]*o+r[15]*u,t}function r(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function e(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+o*i,t[1]=a*c+u*i,t[2]=e*-i+o*c,t[3]=a*-i+u*c,t}function a(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=r[0],c=r[1];return t[0]=e*i,t[1]=a*i,t[2]=o*c,t[3]=u*c,t}function o(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function u(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,n){var r=n[0],e=n[1],a=n[2],o=n[3],u=n[4],i=n[5],c=n[6],f=n[7],v=n[8],s=n[9],l=n[10],M=n[11],h=n[12],m=n[13],y=n[14],d=n[15],p=r*i-e*u,w=r*c-a*u,A=r*f-o*u,F=e*c-a*i,x=e*f-o*i,b=a*f-o*c,g=v*m-s*h,j=v*y-l*h,R=v*d-M*h,X=s*y-l*m,Z=s*d-M*m,k=l*d-M*y,q=p*k-w*Z+A*X+F*R-x*j+b*g;return q?(q=1/q,t[0]=(i*k-c*Z+f*X)*q,t[1]=(a*Z-e*k-o*X)*q,t[2]=(m*b-y*x+d*F)*q,t[3]=(l*x-s*b-M*F)*q,t[4]=(c*R-u*k-f*j)*q,t[5]=(r*k-a*R+o*j)*q,t[6]=(y*A-h*b-d*w)*q,t[7]=(v*b-l*A+M*w)*q,t[8]=(u*Z-i*R+f*g)*q,t[9]=(e*R-r*Z-o*g)*q,t[10]=(h*x-m*A+d*p)*q,t[11]=(s*A-v*x-M*p)*q,t[12]=(i*j-u*X-c*g)*q,t[13]=(r*X-e*j+a*g)*q,t[14]=(m*w-h*F-y*p)*q,t[15]=(v*F-s*w+l*p)*q,t):null}function v(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],m=n[12],y=n[13],d=n[14],p=n[15],w=r[0],A=r[1],F=r[2],x=r[3];return t[0]=w*e+A*i+F*s+x*m,t[1]=w*a+A*c+F*l+x*y,t[2]=w*o+A*f+F*M+x*d,t[3]=w*u+A*v+F*h+x*p,w=r[4],A=r[5],F=r[6],x=r[7],t[4]=w*e+A*i+F*s+x*m,t[5]=w*a+A*c+F*l+x*y,t[6]=w*o+A*f+F*M+x*d,t[7]=w*u+A*v+F*h+x*p,w=r[8],A=r[9],F=r[10],x=r[11],t[8]=w*e+A*i+F*s+x*m,t[9]=w*a+A*c+F*l+x*y,t[10]=w*o+A*f+F*M+x*d,t[11]=w*u+A*v+F*h+x*p,w=r[12],A=r[13],F=r[14],x=r[15],t[12]=w*e+A*i+F*s+x*m,t[13]=w*a+A*c+F*l+x*y,t[14]=w*o+A*f+F*M+x*d,t[15]=w*u+A*v+F*h+x*p,t}function s(t,n,r){var e,a,o,u,i,c,f,v,s,l,M,h,m=r[0],y=r[1],d=r[2];return n===t?(t[12]=n[0]*m+n[4]*y+n[8]*d+n[12],t[13]=n[1]*m+n[5]*y+n[9]*d+n[13],t[14]=n[2]*m+n[6]*y+n[10]*d+n[14],t[15]=n[3]*m+n[7]*y+n[11]*d+n[15]):(e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],t[0]=e,t[1]=a,t[2]=o,t[3]=u,t[4]=i,t[5]=c,t[6]=f,t[7]=v,t[8]=s,t[9]=l,t[10]=M,t[11]=h,t[12]=e*m+i*y+s*d+n[12],t[13]=a*m+c*y+l*d+n[13],t[14]=o*m+f*y+M*d+n[14],t[15]=u*m+v*y+h*d+n[15]),t}function l(t,n,r){var e=r[0],a=r[1],o=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function M(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[4],u=n[5],i=n[6],c=n[7],f=n[8],v=n[9],s=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*a+f*e,t[5]=u*a+v*e,t[6]=i*a+s*e,t[7]=c*a+l*e,t[8]=f*a-o*e,t[9]=v*a-u*e,t[10]=s*a-i*e,t[11]=l*a-c*e,t}function h(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[0],u=n[1],i=n[2],c=n[3],f=n[4],v=n[5],s=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*a+f*e,t[1]=u*a+v*e,t[2]=i*a+s*e,t[3]=c*a+l*e,t[4]=f*a-o*e,t[5]=v*a-u*e,t[6]=s*a-i*e,t[7]=l*a-c*e,t}function m(t,n,r,e,a){var o=1/Math.tan(n/2),u=1/(e-a);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*u,t[15]=0,t}function y(t,n,r,e,a,o,u){var i=1/(n-r),c=1/(e-a),f=1/(o-u);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(n+r)*i,t[13]=(a+e)*c,t[14]=(u+o)*f,t[15]=1,t}(function(){var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0})(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}();return{vec3:{transformMat3:t},vec4:{transformMat4:n},mat2:{create:r,rotate:e,scale:a},mat3:{create:o,fromRotation:u},mat4:{create:i,identity:c,translate:s,scale:l,multiply:v,perspective:m,rotateX:M,rotateZ:h,invert:f,ortho:y}}});
},{}],40:[function(_dereq_,module,exports){
"use strict";function isSupported(e){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(e&&e.failIfMajorPerformanceCaveat))}function isBrowser(){return"undefined"!=typeof window&&"undefined"!=typeof document}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){return"Worker"in window}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}function isWebGLSupportedCached(e){return void 0===isWebGLSupportedCache[e]&&(isWebGLSupportedCache[e]=isWebGLSupported(e)),isWebGLSupportedCache[e]}function isWebGLSupported(e){var t=document.createElement("canvas"),r=Object.create(isSupported.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.probablySupportsContext?t.probablySupportsContext("webgl",r)||t.probablySupportsContext("experimental-webgl",r):t.supportsContext?t.supportsContext("webgl",r)||t.supportsContext("experimental-webgl",r):t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}"undefined"!=typeof module&&module.exports?module.exports=isSupported:window&&(window.minemap=window.minemap||{},window.minemap.supported=isSupported);var isWebGLSupportedCache={};isSupported.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};
},{}],41:[function(_dereq_,module,exports){
"use strict";function Point(t,n){this.x=t,this.y=n}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),i=Math.sin(t),s=n*this.x-i*this.y,r=i*this.x+n*this.y;return this.x=s,this.y=r,this},_rotateAround:function(t,n){var i=Math.cos(t),s=Math.sin(t),r=n.x+i*(this.x-n.x)-s*(this.y-n.y),h=n.y+s*(this.x-n.x)+i*(this.y-n.y);return this.x=r,this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t};
},{}],42:[function(_dereq_,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ShelfPack=e()}(this,function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}function i(t,e,i,s,h,n,r){this.id=t,this.x=e,this.y=i,this.w=s,this.h=h,this.maxw=n||s,this.maxh=r||h,this.refcount=0}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,s,h,n,r=[],f=0;f<t.length;f++)if(i=t[f].w||t[f].width,s=t[f].h||t[f].height,h=t[f].id,i&&s){if(!(n=this.packOne(i,s,h)))continue;e.inPlace&&(t[f].x=n.x,t[f].y=n.y,t[f].id=n.id),r.push(n)}if(this.shelves.length>0){for(var o=0,a=0,u=0;u<this.shelves.length;u++){var l=this.shelves[u];a+=l.h,o=Math.max(l.w-l.free,o)}this.resize(o,a)}return r},t.prototype.packOne=function(t,i,s){var h,n,r,f,o={freebin:-1,shelf:-1,waste:1/0},a=0;if("string"==typeof s||"number"==typeof s){if(h=this.getBin(s))return this.ref(h),h;"number"==typeof s&&(this.maxId=Math.max(s,this.maxId))}else s=++this.maxId;for(f=0;f<this.freebins.length;f++){if(h=this.freebins[f],i===h.maxh&&t===h.maxw)return this.allocFreebin(f,t,i,s);i>h.maxh||t>h.maxw||i<=h.maxh&&t<=h.maxw&&(r=h.maxw*h.maxh-t*i)<o.waste&&(o.waste=r,o.freebin=f)}for(f=0;f<this.shelves.length;f++)if(n=this.shelves[f],a+=n.h,!(t>n.free)){if(i===n.h)return this.allocShelf(f,t,i,s);i>n.h||i<n.h&&(r=(n.h-i)*t)<o.waste&&(o.freebin=-1,o.waste=r,o.shelf=f)}if(-1!==o.freebin)return this.allocFreebin(o.freebin,t,i,s);if(-1!==o.shelf)return this.allocShelf(o.shelf,t,i,s);if(i<=this.h-a&&t<=this.w)return n=new e(a,this.w,i),this.allocShelf(this.shelves.push(n)-1,t,i,s);if(this.autoResize){var u,l,c,p;return u=l=this.h,c=p=this.w,(c<=u||t>c)&&(p=2*Math.max(t,c)),(u<c||i>u)&&(l=2*Math.max(i,u)),this.resize(p,l),this.packOne(t,i,s)}return null},t.prototype.allocFreebin=function(t,e,i,s){var h=this.freebins.splice(t,1)[0];return h.id=s,h.w=e,h.h=i,h.refcount=0,this.bins[s]=h,this.ref(h),h},t.prototype.allocShelf=function(t,e,i,s){var h=this.shelves[t],n=h.alloc(e,i,s);return this.bins[s]=n,this.ref(n),n},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},e.prototype.alloc=function(t,e,s){if(t>this.free||e>this.h)return null;var h=this.x;return this.x+=t,this.free-=t,new i(s,h,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t});
},{}],43:[function(_dereq_,module,exports){
"use strict";function supercluster(t){return new SuperCluster(t)}function SuperCluster(t){this.options=extend(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function createCluster(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:r,properties:i,parentId:-1,numPoints:n}}function createPointCluster(t,e){var n=t.geometry.coordinates;return{x:lngX(n[0]),y:latY(n[1]),zoom:1/0,id:e,parentId:-1}}function getClusterJSON(t){return{type:"Feature",properties:getClusterProperties(t),geometry:{type:"Point",coordinates:[xLng(t.x),yLat(t.y)]}}}function getClusterProperties(t,e,n,r){var i=t.numPoints,o=i>=1e4?Math.round(i/1e3)+"k":i>=1e3?Math.round(i/100)/10+"k":i;return extend(extend({},t.properties),{cluster:!0,cluster_id:t.id,point_count:i,point_count_abbreviated:o,children:e&&n?e.getChildren(t.id,r):null})}function lngX(t){return t/360+.5}function latY(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function xLng(t){return 360*(t-.5)}function yLat(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function extend(t,e){for(var n in e)t[n]=e[n];return t}function getX(t){return t.x}function getY(t){return t.y}var kdbush=_dereq_("kdbush");module.exports=supercluster,SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t},queryChildrenFlag:!1},load:function(t){try{var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n),this.points=t;var r=t.map(createPointCluster);e&&console.timeEnd(n);for(var i=this.options.maxZoom;i>=this.options.minZoom;i--){var o=+Date.now();this.trees[i+1]=kdbush(r,getX,getY,this.options.nodeSize,Float32Array),r=this._cluster(r,i),e&&console.log("z%d: %d clusters in %dms",i,r.length,+Date.now()-o)}return this.trees[this.options.minZoom]=kdbush(r,getX,getY,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this}catch(t){return this}},getClusters:function(t,e){try{for(var n=this.trees[this._limitZoom(e)],r=n.range(lngX(t[0]),latY(t[3]),lngX(t[2]),latY(t[1])),i=[],o=0;o<r.length;o++){var s=n.points[r[o]];i.push(s.numPoints?getClusterJSON(s):this.points[s.id])}return i}catch(t){return[]}},getChildren:function(t,e){try{var n=this.trees[e+1].points[t],r=this.options.radius/(this.options.extent*Math.pow(2,e)),i=this.trees[e+1].within(n.x,n.y,r);if(this.options.maxZoom-e>2)return[];var o=[];try{for(var s=0;s<i.length;s++){var a=this.trees[e+1].points[i[s]];a.parentId===t&&e==this.options.maxZoom?o.push(a.numPoints?getClusterJSON(a):this.points[a.id]):a.parentId===t&&e<this.options.maxZoom&&o.concat(this.getChildren(a.id,e+1))}}finally{return o}}catch(t){return[]}},getLeaves:function(t,e,n,r){n=n||10,r=r||0;var i=[];return this._appendLeaves(i,t,e,n,r,0),i},getTile:function(t,e,n){try{var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options.extent,s=this.options.radius,a=s/o,u=(n-a)/i,h=(n+1+a)/i,p={features:[]};return this._addTileFeatures(r.range((e-a)/i,u,(e+1+a)/i,h),r.points,e,n,i,p),0===e&&this._addTileFeatures(r.range(1-a/i,u,1,h),r.points,i,n,i,p),e===i-1&&this._addTileFeatures(r.range(0,u,a/i,h),r.points,-1,n,i,p),p.features.length?p:null}catch(t){return null}},getClusterExpansionZoom:function(t,e){for(;e<this.options.maxZoom;){var n=this.getChildren(t,e);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},_appendLeaves:function(t,e,n,r,i,o){for(var s=this.getChildren(e,n),a=0;a<s.length;a++){var u=s[a].properties;if(u.cluster?o+u.point_count<=i?o+=u.point_count:o=this._appendLeaves(t,u.cluster_id,n+1,r,i,o):o<i?o++:t.push(s[a]),t.length===r)break}return o},_addTileFeatures:function(t,e,n,r,i,o){for(var s=0;s<t.length;s++){var a=e[t[s]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(a.x*i-n)),Math.round(this.options.extent*(a.y*i-r))]],tags:a.numPoints?getClusterProperties(a,this,!0,Math.log2(i)):this.points[a.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],r=this.options.radius/(this.options.extent*Math.pow(2,e)),i=0;i<t.length;i++){var o=t[i];if(!(o.zoom<=e)){o.zoom=e;var s=this.trees[e+1],a=s.within(o.x,o.y,r),u=o.numPoints||1,h=o.x*u,p=o.y*u,l=null;this.options.reduce&&(l=this.options.initial(),this._accumulate(l,o));for(var c=0;c<a.length;c++){var d=s.points[a[c]];if(e<d.zoom){var m=d.numPoints||1;d.zoom=e,h+=d.x*m,p+=d.y*m,u+=m,d.parentId=i,this.options.reduce&&this._accumulate(l,d)}}1===u?n.push(o):(o.parentId=i,n.push(createCluster(h/u,p/u,u,i,l)))}}return n},_accumulate:function(t,e){var n=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,n)}};
},{"kdbush":6}],44:[function(_dereq_,module,exports){
"use strict";function TinySDF(t,i,s,e,h,r){this.fontSize=t||24,this.buffer=void 0===i?3:i,this.cutoff=e||.25,this.fontFamily=h||"sans-serif",this.fontWeight=r||"normal",this.radius=s||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function edt(t,i,s,e,h,r,a){for(var n=0;n<i;n++){for(var o=0;o<s;o++)e[o]=t[o*i+n];for(edt1d(e,h,r,a,s),o=0;o<s;o++)t[o*i+n]=h[o]}for(o=0;o<s;o++){for(n=0;n<i;n++)e[n]=t[o*i+n];for(edt1d(e,h,r,a,i),n=0;n<i;n++)t[o*i+n]=Math.sqrt(h[n])}}function edt1d(t,i,s,e,h){s[0]=0,e[0]=-INF,e[1]=+INF;for(var r=1,a=0;r<h;r++){for(var n=(t[r]+r*r-(t[s[a]]+s[a]*s[a]))/(2*r-2*s[a]);n<=e[a];)a--,n=(t[r]+r*r-(t[s[a]]+s[a]*s[a]))/(2*r-2*s[a]);a++,s[a]=r,e[a]=n,e[a+1]=+INF}for(r=0,a=0;r<h;r++){for(;e[a+1]<r;)a++;i[r]=(r-s[a])*(r-s[a])+t[s[a]]}}module.exports=TinySDF;var INF=1e20;TinySDF.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var i=this.ctx.getImageData(0,0,this.size,this.size),s=new Uint8ClampedArray(this.size*this.size),e=0;e<this.size*this.size;e++){var h=i.data[4*e+3]/255;this.gridOuter[e]=1===h?0:0===h?INF:Math.pow(Math.max(0,.5-h),2),this.gridInner[e]=1===h?INF:0===h?0:Math.pow(Math.max(0,h-.5),2)}for(edt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),edt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),e=0;e<this.size*this.size;e++){var r=this.gridOuter[e]-this.gridInner[e];s[e]=Math.max(0,Math.min(255,Math.round(255-255*(r/this.radius+this.cutoff))))}return s};
},{}],45:[function(_dereq_,module,exports){
function UnitBezier(t,i,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(r-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=e,this.p2y=r}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,i){void 0===i&&(i=1e-6);var e,r,s,h,n;for(s=t,n=0;n<8;n++){if(h=this.sampleCurveX(s)-t,Math.abs(h)<i)return s;var u=this.sampleCurveDerivativeX(s);if(Math.abs(u)<1e-6)break;s-=h/u}if(e=0,r=1,(s=t)<e)return e;if(s>r)return r;for(;e<r;){if(h=this.sampleCurveX(s),Math.abs(h-t)<i)return s;t>h?e=s:r=s,s=.5*(r-e)+e}return s},UnitBezier.prototype.solve=function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))};
},{}],46:[function(_dereq_,module,exports){
module.exports.VectorTile=_dereq_("./lib/vectortile.js"),module.exports.VectorTileFeature=_dereq_("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=_dereq_("./lib/vectortilelayer.js");
},{"./lib/vectortile.js":47,"./lib/vectortilefeature.js":48,"./lib/vectortilelayer.js":49}],47:[function(_dereq_,module,exports){
"use strict";function VectorTile(e,r){this.layers=e.readFields(readTile,{},r)}function readTile(e,r,i){if(3===e){var t=new VectorTileLayer(i,i.readVarint()+i.pos);t.length&&(r[t.name]=t)}}var VectorTileLayer=_dereq_("./vectortilelayer");module.exports=VectorTile;
},{"./vectortilelayer":49}],48:[function(_dereq_,module,exports){
"use strict";function VectorTileFeature(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?readTag(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function readTag(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[i]=a}}function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,i,a=[],o=0;o<t;o++){var n=signedArea(e[o]);0!==n&&(void 0===i&&(i=n<0),i===n<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}return r&&a.push(r),a}function signedArea(e){for(var t,r,i=0,a=0,o=e.length,n=o-1;a<o;n=a++)t=e[a],r=e[n],i+=(r.x-t.x)*(t.y+r.y);return i}var Point=_dereq_("../../../_minemap_/point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,o=0,n=0,s=[];e.pos<r;){if(!a){var p=e.readVarint();i=7&p,a=p>>3}if(a--,1===i||2===i)o+=e.readSVarint(),n+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new Point(o,n));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,o=0,n=1/0,s=-1/0,p=1/0,h=-1/0;e.pos<t;){if(!i){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),a<n&&(n=a),a>s&&(s=a),o<p&&(p=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[n,p,s,h]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){function i(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+p)/n;e[t]=[360*(r.x+s)/n-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}var a,o,n=this.extent*Math.pow(2,r),s=this.extent*e,p=this.extent*t,h=this.loadGeometry(),u=VectorTileFeature.types[this.type];switch(this.type){case 1:var d=[];for(a=0;a<h.length;a++)d[a]=h[a][0];h=d,i(h);break;case 2:for(a=0;a<h.length;a++)i(h[a]);break;case 3:for(h=classifyRings(h),a=0;a<h.length;a++)for(o=0;o<h[a].length;o++)i(h[a][o])}1===h.length?h=h[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:h},properties:this.properties};return"id"in this&&(f.id=this.id),f};
},{"../../../_minemap_/point-geometry":41}],49:[function(_dereq_,module,exports){
"use strict";function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r))}function readValueMessage(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var a=e.readVarint()>>3;t=1===a?e.readString():2===a?e.readFloat():3===a?e.readDouble():4===a?e.readVarint64():5===a?e.readVarint():6===a?e.readSVarint():7===a?e.readBoolean():null}return t}var VectorTileFeature=_dereq_("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)};
},{"./vectortilefeature.js":48}],50:[function(_dereq_,module,exports){
function fromVectorTileJs(e){var r=[];for(var o in e.layers)r.push(prepareLayer(e.layers[o]));var t=new Pbf;return vtpb.tile.write({layers:r},t),t.finish()}function fromGeojsonVt(e){var r={};for(var o in e)r[o]=new GeoJSONWrapper(e[o].features),r[o].name=o;return fromVectorTileJs({layers:r})}function prepareLayer(e){for(var r={name:e.name||"",version:e.version||1,extent:e.extent||4096,keys:[],values:[],features:[]},o={},t={},a=0;a<e.length;a++){var n=e.feature(a);n.geometry=encodeGeometry(n.loadGeometry());var u=[];for(var s in n.properties){var i=o[s];void 0===i&&(r.keys.push(s),i=r.keys.length-1,o[s]=i);var p=wrapValue(n.properties[s]),l=t[p.key];void 0===l&&(r.values.push(p),l=r.values.length-1,t[p.key]=l),u.push(i),u.push(l)}n.tags=u,r.features.push(n)}return r}function command(e,r){return(r<<3)+(7&e)}function zigzag(e){return e<<1^e>>31}function encodeGeometry(e){for(var r=[],o=0,t=0,a=e.length,n=0;n<a;n++){var u=e[n];r.push(command(1,1));for(var s=0;s<u.length;s++){1===s&&r.push(command(2,u.length-1));var i=u[s].x-o,p=u[s].y-t;r.push(zigzag(i),zigzag(p)),o+=i,t+=p}}return r}function wrapValue(e){var r,o=typeof e;return"string"===o?r={string_value:e}:"boolean"===o?r={bool_value:e}:"number"===o?r=e%1!=0?{double_value:e}:e<0?{sint_value:e}:{uint_value:e}:(e=JSON.stringify(e),r={string_value:e}),r.key=o+":"+e,r}var Pbf=_dereq_("pbf"),vtpb=_dereq_("./vector-tile-pb"),GeoJSONWrapper=_dereq_("./lib/geojson_wrapper");module.exports=fromVectorTileJs,module.exports.fromVectorTileJs=fromVectorTileJs,module.exports.fromGeojsonVt=fromGeojsonVt,module.exports.GeoJSONWrapper=GeoJSONWrapper;
},{"./lib/geojson_wrapper":51,"./vector-tile-pb":52,"pbf":18}],51:[function(_dereq_,module,exports){
"use strict";function GeoJSONWrapper(e){this.features=e,this.length=e.length}function FeatureWrapper(e){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=4096}var Point=_dereq_("../../../_minemap_/point-geometry"),VectorTileFeature=_dereq_("../../../_minemap_/vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e])},FeatureWrapper.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],a=0;a<r.length;a++)o.push(new Point(r[a][0],r[a][1]));this.geometry.push(o)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,a=-1/0,i=0;i<e.length;i++)for(var p=e[i],n=0;n<p.length;n++){var h=p[n];t=Math.min(t,h.x),r=Math.max(r,h.x),o=Math.min(o,h.y),a=Math.max(a,h.y)}return[t,o,r,a]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON;
},{"../../../_minemap_/point-geometry":41,"../../../_minemap_/vector-tile":46}],52:[function(_dereq_,module,exports){
"use strict";function readTile(e,r){return e.readFields(readTileField,{layers:[]},r)}function readTileField(e,r,i){3===e&&r.layers.push(readLayer(i,i.readVarint()+i.pos))}function writeTile(e,r){var i;if(void 0!==e.layers)for(i=0;i<e.layers.length;i++)r.writeMessage(3,writeLayer,e.layers[i])}function readValue(e,r){return e.readFields(readValueField,{},r)}function readValueField(e,r,i){1===e?r.string_value=i.readString():2===e?r.float_value=i.readFloat():3===e?r.double_value=i.readDouble():4===e?r.int_value=i.readVarint():5===e?r.uint_value=i.readVarint():6===e?r.sint_value=i.readSVarint():7===e&&(r.bool_value=i.readBoolean())}function writeValue(e,r){void 0!==e.string_value&&r.writeStringField(1,e.string_value),void 0!==e.float_value&&r.writeFloatField(2,e.float_value),void 0!==e.double_value&&r.writeDoubleField(3,e.double_value),void 0!==e.int_value&&r.writeVarintField(4,e.int_value),void 0!==e.uint_value&&r.writeVarintField(5,e.uint_value),void 0!==e.sint_value&&r.writeSVarintField(6,e.sint_value),void 0!==e.bool_value&&r.writeBooleanField(7,e.bool_value)}function readFeature(e,r){var i=e.readFields(readFeatureField,{},r);return void 0===i.type&&(i.type="Unknown"),i}function readFeatureField(e,r,i){1===e?r.id=i.readVarint():2===e?r.tags=i.readPackedVarint():3===e?r.type=i.readVarint():4===e&&(r.geometry=i.readPackedVarint())}function writeFeature(e,r){void 0!==e.id&&r.writeVarintField(1,e.id),void 0!==e.tags&&r.writePackedVarint(2,e.tags),void 0!==e.type&&r.writeVarintField(3,e.type),void 0!==e.geometry&&r.writePackedVarint(4,e.geometry)}function readLayer(e,r){return e.readFields(readLayerField,{features:[],keys:[],values:[]},r)}function readLayerField(e,r,i){15===e?r.version=i.readVarint():1===e?r.name=i.readString():2===e?r.features.push(readFeature(i,i.readVarint()+i.pos)):3===e?r.keys.push(i.readString()):4===e?r.values.push(readValue(i,i.readVarint()+i.pos)):5===e&&(r.extent=i.readVarint())}function writeLayer(e,r){void 0!==e.version&&r.writeVarintField(15,e.version),void 0!==e.name&&r.writeStringField(1,e.name);var i;if(void 0!==e.features)for(i=0;i<e.features.length;i++)r.writeMessage(2,writeFeature,e.features[i]);if(void 0!==e.keys)for(i=0;i<e.keys.length;i++)r.writeStringField(3,e.keys[i]);if(void 0!==e.values)for(i=0;i<e.values.length;i++)r.writeMessage(4,writeValue,e.values[i]);void 0!==e.extent&&r.writeVarintField(5,e.extent)}var tile=exports.tile={read:readTile,write:writeTile};tile.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},tile.value={read:readValue,write:writeValue},tile.feature={read:readFeature,write:writeFeature},tile.layer={read:readLayer,write:writeLayer};
},{}],53:[function(_dereq_,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.WhooTS=e.WhooTS||{})}(this,function(e){function t(e,t,r,n,i,s){return s=s||{},e+"?"+["bbox="+o(r,n,i),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+t].join("&")}function o(e,t,o){t=Math.pow(2,o)-t-1;var n=r(256*e,256*t,o),i=r(256*(e+1),256*(t+1),o);return n[0]+","+n[1]+","+i[0]+","+i[1]}function r(e,t,o){var r=2*Math.PI*6378137/256/Math.pow(2,o);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=t,e.getTileBBox=o,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})});
},{}],54:[function(_dereq_,module,exports){
"use strict";function serializePaintVertexArrays(r,e){var t={};for(var a in r){var i=r[a].paintVertexArray;if(0!==i.length){var n=i.serialize(e),y=i.constructor.serialize();t[a]={array:n,type:y}}}return t}var ProgramConfiguration=_dereq_("./program_configuration"),createVertexArrayType=_dereq_("./vertex_array_type"),Segment=function(r,e){this.vertexOffset=r,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},ArrayGroup=function(r,e,t){var a=this;this.globalProperties={zoom:t};var i=createVertexArrayType(r.layoutAttributes);if(this.layoutVertexArray=new i,r.dynamicLayoutAttributes){var n=createVertexArrayType(r.dynamicLayoutAttributes);this.dynamicLayoutVertexArray=new n}var y=r.elementArrayType;y&&(this.elementArray=new y);var s=r.elementArrayType2;s&&(this.elementArray2=new s),this.layerData={};for(var o=0,A=e;o<A.length;o+=1){var p=A[o],u=ProgramConfiguration.createDynamic(r,p,t);a.layerData[p.id]={layer:p,programConfiguration:u,paintVertexArray:new u.PaintVertexArray,paintPropertyStatistics:u.createPaintPropertyStatistics()}}this.segments=[],this.segments2=[]};ArrayGroup.prototype.prepareSegment=function(r){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+r>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH)&&(e=new Segment(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},ArrayGroup.prototype.prepareSegment2=function(r){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+r>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH)&&(e=new Segment(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},ArrayGroup.prototype.populatePaintArrays=function(r){var e=this;for(var t in e.layerData){var a=e.layerData[t];0!==a.paintVertexArray.bytesPerElement&&a.programConfiguration.populatePaintArray(a.layer,a.paintVertexArray,a.paintPropertyStatistics,e.layoutVertexArray.length,r)}},ArrayGroup.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ArrayGroup.prototype.serialize=function(r){return{layoutVertexArray:this.layoutVertexArray.serialize(r),dynamicLayoutVertexArray:this.dynamicLayoutVertexArray&&this.dynamicLayoutVertexArray.serialize(r),elementArray:this.elementArray&&this.elementArray.serialize(r),elementArray2:this.elementArray2&&this.elementArray2.serialize(r),paintVertexArrays:serializePaintVertexArrays(this.layerData,r),segments:this.segments,segments2:this.segments2}},ArrayGroup.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,module.exports=ArrayGroup;
},{"./program_configuration":74,"./vertex_array_type":76}],55:[function(_dereq_,module,exports){
"use strict";var ArrayGroup=_dereq_("./array_group"),BufferGroup=_dereq_("./buffer_group"),util=_dereq_("../util/util"),Bucket=function(r,e){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.index=r.index,r.arrays?this.buffers=new BufferGroup(e,r.layers,r.zoom,r.arrays):this.arrays=new ArrayGroup(e,r.layers,r.zoom)};Bucket.deserialize=function(r,e){var t={};if(!e)return t;for(var i=0,a=r;i<a.length;i+=1){var u=a[i],o=u.layerIds.map(function(r){return e.getLayer(r)}).filter(Boolean);if(0!==o.length)for(var s=o[0].createBucket(util.extend({layers:o},u)),n=0,f=o;n<f.length;n+=1){var y=f[n];t[y.id]=s}}return t},Bucket.prototype.populate=function(r,e){for(var t=this,i=0,a=r;i<a.length;i+=1){var u=a[i],o=u.feature,s=u.index,n=u.sourceLayerIndex;t.layers[0].filter(o)&&(t.addFeature(o),e.featureIndex.insert(o,s,n,t.index))}},Bucket.prototype.getPaintPropertyStatistics=function(){return util.mapObject(this.arrays.layerData,function(r){return r.paintPropertyStatistics})},Bucket.prototype.isEmpty=function(){return this.arrays.isEmpty()},Bucket.prototype.serialize=function(r){return{zoom:this.zoom,layerIds:this.layers.map(function(r){return r.id}),arrays:this.arrays.serialize(r)}},Bucket.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},module.exports=Bucket;
},{"../util/util":244,"./array_group":54,"./buffer_group":68}],56:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,o){e.emplaceBack(t.x<<1|i,t.y<<1|a,h_seq,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(o*LINE_DISTANCE_SCALE&63)<<2,o*LINE_DISTANCE_SCALE>>6,seq,_count)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,h_seq=0,seq=0,_count=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,airlineInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:2,type:"Uint16"}],paintAttributes:[{property:"airline-color"},{property:"airline-blur"},{property:"airline-opacity"},{property:"airline-gap-width",name:"gapwidth"},{property:"airline-offset"},{property:"airline-width"},{property:"airline-width",name:"floorwidth",useIntegerZoom:!0}],elementArrayType:createElementArrayType()},AirlineBucket=function(e){function t(t){e.call(this,t,airlineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=this.layers[0].getLayoutValue("airline-join",{zoom:this.zoom},e.properties),a=r["airline-cap"];seq=e.properties.link_seq,_count=e.properties.total;for(var n=0,o=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);n<o.length;n+=1){var s=o[n];t.addLine(s,e,i,a)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var o=this,s=t.properties,p="Polygon"===vectorTileFeatureTypes[t.type],h=e.length;h>=2&&e[h-1].equals(e[h-2]);)h--;for(var l=0;l<h-1&&e[l].equals(e[l+1]);)l++;if(!(h<(p?3:2))){"bevel"===r&&1.05;var _=e[l],u=this.arrays,c=u.prepareSegment(10*h);this.distance=0;var y,d=void 0,E=void 0,m=void 0,A=void 0;this.e1=this.e2=this.e3=-1,p&&(y=e[h-2],A=_.sub(y)._unit()._perp());for(var L=l;L<h;L++)if(h_seq=0===L?10*t.properties.start_height:10*t.properties.end_height,!(E=p&&L===h-1?e[l+1]:e[L+1])||!e[L].equals(E)){A&&(m=A),y&&(d=y),y=e[L],A=E?E.sub(y)._unit()._perp():m,m=m||A;var v=m.add(A);0===v.x&&0===v.y||v._unit();var I=v.x*A.x+v.y*A.y,T=0!==I?1/I:1/0;d&&(o.distance+=y.dist(d)),v._mult(T),o.addCurrentVertex(y,o.distance,v,0,0,!1,c)}u.populatePaintArrays(s)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,o){var s,p=n?1:0,h=this.arrays,l=h.layoutVertexArray,_=h.elementArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),addLineVertex(l,e,s,p,0,i,t),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(_.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),a&&s._sub(r.perp()._mult(a)),addLineVertex(l,e,s,p,1,-a,t),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(_.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,o))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var o=this.arrays,s=o.layoutVertexArray,p=o.elementArray;addLineVertex(s,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);AirlineBucket.programInterface=airlineInterface,module.exports=AirlineBucket;
},{"../../_minemap_/vector-tile":46,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],57:[function(_dereq_,module,exports){
"use strict";function addCircleVertex(e,r,t,c,a){e.emplaceBack(2*r+(c+1)/2,2*t+(a+1)/2)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),circleInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"}],elementArrayType:createElementArrayType(),paintAttributes:[{property:"circle-color"},{property:"circle-radius"},{property:"circle-blur"},{property:"circle-opacity"},{property:"circle-stroke-color"},{property:"circle-stroke-width"},{property:"circle-stroke-opacity"}]},CircleBucket=function(e){function r(r){e.call(this,r,circleInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,c=loadGeometry(e);t<c.length;t+=1)for(var a=c[t],o=0,p=a;o<p.length;o+=1){var l=p[o],i=l.x,y=l.y;if(!(i<0||i>=EXTENT||y<0||y>=EXTENT)){var n=r.prepareSegment(4),u=n.vertexLength;addCircleVertex(r.layoutVertexArray,i,y,-1,-1),addCircleVertex(r.layoutVertexArray,i,y,1,-1),addCircleVertex(r.layoutVertexArray,i,y,1,1),addCircleVertex(r.layoutVertexArray,i,y,-1,1),r.elementArray.emplaceBack(u,u+1,u+2),r.elementArray.emplaceBack(u,u+3,u+2),n.vertexLength+=4,n.primitiveLength+=2}}r.populatePaintArrays(e.properties)},r}(Bucket);CircleBucket.programInterface=circleInterface,module.exports=CircleBucket;
},{"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],58:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,seq,total,offset)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,seq=0,total=0,offset=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,dynamicLineInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}],paintAttributes:[{property:"dynamicLine-color"},{property:"dynamicLine-blur"},{property:"dynamicLine-opacity"},{property:"dynamicLine-gap-width",name:"gapwidth"},{property:"dynamicLine-offset"},{property:"dynamicLine-width"},{property:"dynamicLine-width",name:"floorwidth",useIntegerZoom:!0}],elementArrayType:createElementArrayType()},DynamicLineBucket=function(e){function t(t){e.call(this,t,dynamicLineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=this.layers[0].getLayoutValue("dynamicLine-join",{zoom:this.zoom},e.properties),a=r["dynamicLine-cap"];seq=e.properties.link_seq,total=e.properties.total_link_count,offset=e.properties.offset_link_count;for(var n=0,s=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);n<s.length;n+=1){var d=s[n];t.addLine(d,e,i,a)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,d=t.properties,o="Polygon"===vectorTileFeatureTypes[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var c=0;c<u-1&&e[c].equals(e[c+1]);)c++;if(!(u<(o?3:2))){"bevel"===r&&(a=1.05);var p=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),l=e[c],y=this.arrays,_=y.prepareSegment(10*u);this.distance=0;var m,h,f,E=i,L=o?"butt":i,v=!0,x=void 0,C=void 0,A=void 0,S=void 0;this.e1=this.e2=this.e3=-1,o&&(m=e[u-2],S=l.sub(m)._unit()._perp());for(var T=c;T<u;T++)if(seq++,!(C=o&&T===u-1?e[c+1]:e[T+1])||!e[T].equals(C)){S&&(A=S),m&&(x=m),m=e[T],S=C?C.sub(m)._unit()._perp():A,A=A||S;var V=A.add(S);0===V.x&&0===V.y||V._unit();var I=V.x*S.x+V.y*S.y,N=0!==I?1/I:1/0,b=I<COS_HALF_SHARP_CORNER&&x&&C;if(b&&T>c){var g=m.dist(x);if(g>2*p){var R=m.sub(m.sub(x)._mult(p/g)._round());s.distance+=R.dist(x),s.addCurrentVertex(R,s.distance,A.mult(1),0,0,!1,_),x=R}}var k=x&&C,q=k?r:C?E:L;if(k&&"round"===q&&(N<n?q="miter":N<=2&&(q="fakeround")),"miter"===q&&N>a&&(q="bevel"),"bevel"===q&&(N>2&&(q="flipbevel"),N<a&&(q="miter")),x&&(s.distance+=m.dist(x)),"miter"===q)V._mult(N),s.addCurrentVertex(m,s.distance,V,0,0,!1,_);else if("flipbevel"===q){if(N>100)V=S.clone().mult(-1);else{var F=A.x*S.y-A.y*S.x>0?-1:1,B=N*A.add(S).mag()/A.sub(S).mag();V._perp()._mult(B*F)}s.addCurrentVertex(m,s.distance,V,0,0,!1,_),s.addCurrentVertex(m,s.distance,V.mult(-1),0,0,!1,_)}else if("bevel"===q||"fakeround"===q){var D=A.x*S.y-A.y*S.x>0,P=-Math.sqrt(N*N-1);if(D?(f=0,h=P):(h=0,f=P),v||s.addCurrentVertex(m,s.distance,A,h,f,!1,_),"fakeround"===q){for(var M=Math.floor(8*(.5-(I-.5))),O=void 0,U=0;U<M;U++)O=S.mult((U+1)/(M+1))._add(A)._unit(),s.addPieSliceVertex(m,s.distance,O,D,_);s.addPieSliceVertex(m,s.distance,V,D,_);for(var X=M-1;X>=0;X--)O=A.mult((X+1)/(M+1))._add(S)._unit(),s.addPieSliceVertex(m,s.distance,O,D,_)}C&&s.addCurrentVertex(m,s.distance,S,-h,-f,!1,_)}else"butt"===q?(v||s.addCurrentVertex(m,s.distance,A,0,0,!1,_),C&&s.addCurrentVertex(m,s.distance,S,0,0,!1,_)):"square"===q?(v||(s.addCurrentVertex(m,s.distance,A,1,1,!1,_),s.e1=s.e2=-1),C&&s.addCurrentVertex(m,s.distance,S,-1,-1,!1,_)):"round"===q&&(v||(s.addCurrentVertex(m,s.distance,A,0,0,!1,_),s.addCurrentVertex(m,s.distance,A,1,1,!0,_),s.e1=s.e2=-1),C&&(s.addCurrentVertex(m,s.distance,S,-1,-1,!0,_),s.addCurrentVertex(m,s.distance,S,0,0,!1,_)));if(b&&T<u-1){var w=m.dist(C);if(w>2*p){var H=m.add(C.sub(m)._mult(p/w)._round());s.distance+=H.dist(m),s.addCurrentVertex(H,s.distance,S.mult(1),0,0,!1,_),m=H}}v=!1}y.populatePaintArrays(d)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var d,o=n?1:0,u=this.arrays,c=u.layoutVertexArray,p=u.elementArray;d=r.clone(),i&&d._sub(r.perp()._mult(i)),addLineVertex(c,e,d,o,0,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,d=r.mult(-1),a&&d._sub(r.perp()._mult(a)),addLineVertex(c,e,d,o,1,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var s=this.arrays,d=s.layoutVertexArray,o=s.elementArray;addLineVertex(d,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);DynamicLineBucket.programInterface=dynamicLineInterface,module.exports=DynamicLineBucket;
},{"../../_minemap_/vector-tile":46,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],59:[function(_dereq_,module,exports){
"use strict";function addVertex(e,r,t,a,n,o,i,y){e.emplaceBack(r,t,2*Math.floor(a*FACTOR)+i,n*FACTOR*2,o*FACTOR*2,Math.round(y))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,fillExtrusionInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}],elementArrayType:createElementArrayType(3),paintAttributes:[{property:"extrusion-base"},{property:"extrusion-height"},{property:"extrusion-color"}]},FACTOR=Math.pow(2,13),FillExtrusionBucket=function(e){function r(r){e.call(this,r,fillExtrusionInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);t<a.length;t+=1){for(var n=a[t],o=0,i=0,y=n;i<y.length;i+=1){o+=y[i].length}for(var u=r.prepareSegment(5*o),l=[],p=[],s=[],c=0,x=n;c<x.length;c+=1){var d=x[c];if(0!==d.length){d!==n[0]&&p.push(l.length/2);for(var m=0,h=0;h<d.length;h++){var f=d[h];if(addVertex(r.layoutVertexArray,f.x,f.y,0,0,1,1,0),s.push(u.vertexLength++),h>=1){var g=d[h-1];if(!isBoundaryEdge(f,g)){var A=f.sub(g)._perp()._unit();addVertex(r.layoutVertexArray,f.x,f.y,A.x,A.y,0,0,m),addVertex(r.layoutVertexArray,f.x,f.y,A.x,A.y,0,1,m),m+=g.dist(f),addVertex(r.layoutVertexArray,g.x,g.y,A.x,A.y,0,0,m),addVertex(r.layoutVertexArray,g.x,g.y,A.x,A.y,0,1,m);var E=u.vertexLength;r.elementArray.emplaceBack(E,E+1,E+2),r.elementArray.emplaceBack(E+1,E+2,E+3),u.vertexLength+=4,u.primitiveLength+=2}}l.push(f.x),l.push(f.y)}}}for(var _=earcut(l,p),v=0;v<_.length;v+=3)r.elementArray.emplaceBack(s[_[v]],s[_[v+1]],s[_[v+2]]);u.primitiveLength+=_.length/3}r.populatePaintArrays(e.properties)},r}(Bucket);FillExtrusionBucket.programInterface=fillExtrusionInterface,module.exports=FillExtrusionBucket;
},{"../../util/classify_rings":220,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72,"earcut":2}],60:[function(_dereq_,module,exports){
"use strict";var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,fillInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"}],elementArrayType:createElementArrayType(3),elementArrayType2:createElementArrayType(2),paintAttributes:[{property:"fill-color"},{property:"fill-outline-color"},{property:"fill-opacity"}]},FillBucket=function(e){function t(t){e.call(this,t,fillInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){for(var t=this.arrays,r=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);r<a.length;r+=1){for(var l=a[r],n=0,p=0,o=l;p<o.length;p+=1){n+=o[p].length}for(var c=t.prepareSegment(n),i=c.vertexLength,y=[],u=[],s=0,g=l;s<g.length;s+=1){var h=g[s];if(0!==h.length){h!==l[0]&&u.push(y.length/2);var m=t.prepareSegment2(h.length),f=m.vertexLength;t.layoutVertexArray.emplaceBack(h[0].x,h[0].y),t.elementArray2.emplaceBack(f+h.length-1,f),y.push(h[0].x),y.push(h[0].y);for(var A=1;A<h.length;A++)t.layoutVertexArray.emplaceBack(h[A].x,h[A].y),t.elementArray2.emplaceBack(f+A-1,f+A),y.push(h[A].x),y.push(h[A].y);m.vertexLength+=h.length,m.primitiveLength+=h.length}}for(var v=earcut(y,u),_=0;_<v.length;_+=3)t.elementArray.emplaceBack(i+v[_],i+v[_+1],i+v[_+2]);c.vertexLength+=n,c.primitiveLength+=v.length/3}t.populatePaintArrays(e.properties)},t}(Bucket);FillBucket.programInterface=fillInterface,module.exports=FillBucket;
},{"../../util/classify_rings":220,"../bucket":55,"../element_array_type":69,"../load_geometry":72,"earcut":2}],61:[function(_dereq_,module,exports){
"use strict";function addVertex(e,r,t,a,o,n,y,i){e.emplaceBack(r,t,2*Math.floor(a*FACTOR)+y,o*FACTOR*2,n*FACTOR*2,Math.round(i))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,histogramInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}],elementArrayType:createElementArrayType(3),paintAttributes:[{property:"histogram-base"},{property:"histogram-height"},{property:"histogram-time"},{property:"histogram-color"},{property:"histogram-heightArr1"},{property:"histogram-heightArr2"},{property:"histogram-heightArr3"}]},FACTOR=Math.pow(2,13),HistogramBucket=function(e){function r(r){e.call(this,r,histogramInterface)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(e){for(var r=this.arrays,t=0,a=classifyRings(loadGeometry(e),EARCUT_MAX_RINGS);t<a.length;t+=1){for(var o=a[t],n=0,y=0,i=o;y<i.length;y+=1){n+=i[y].length}for(var p=r.prepareSegment(5*n),s=[],u=[],c=[],h=0,g=o;h<g.length;h+=1){var l=g[h];if(0!==l.length){l!==o[0]&&u.push(s.length/2);for(var m=0,x=0;x<l.length;x++){var d=l[x];if(addVertex(r.layoutVertexArray,d.x,d.y,0,0,1,1,0),c.push(p.vertexLength++),x>=1){var A=l[x-1];if(!isBoundaryEdge(d,A)){var f=d.sub(A)._perp()._unit();addVertex(r.layoutVertexArray,d.x,d.y,f.x,f.y,0,0,m),addVertex(r.layoutVertexArray,d.x,d.y,f.x,f.y,0,1,m),m+=A.dist(d),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,0,m),addVertex(r.layoutVertexArray,A.x,A.y,f.x,f.y,0,1,m);var _=p.vertexLength;r.elementArray.emplaceBack(_,_+1,_+2),r.elementArray.emplaceBack(_+1,_+2,_+3),p.vertexLength+=4,p.primitiveLength+=2}}s.push(d.x),s.push(d.y)}}}for(var v=earcut(s,u),T=0;T<v.length;T+=3)r.elementArray.emplaceBack(c[v[T]],c[v[T+1]],c[v[T+2]]);p.primitiveLength+=v.length/3}r.populatePaintArrays(e.properties)},r}(Bucket);HistogramBucket.programInterface=histogramInterface,module.exports=HistogramBucket;
},{"../../util/classify_rings":220,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72,"earcut":2}],62:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,d){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(d*LINE_DISTANCE_SCALE&63)<<2,d*LINE_DISTANCE_SCALE>>6)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,lineInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],paintAttributes:[{property:"line-color"},{property:"line-blur"},{property:"line-opacity"},{property:"line-gap-width",name:"gapwidth"},{property:"line-offset"},{property:"line-width"},{property:"line-width",name:"floorwidth",useIntegerZoom:!0}],elementArrayType:createElementArrayType()},LineBucket=function(e){function t(t){e.call(this,t,lineInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){for(var t=this,r=this.layers[0].layout,i=this.layers[0].getLayoutValue("line-join",{zoom:this.zoom},e.properties),a=r["line-cap"],n=r["line-miter-limit"],d=r["line-round-limit"],s=0,o=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);s<o.length;s+=1){var u=o[s];t.addLine(u,e,i,a,n,d)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var d=this,s=t.properties,o="Polygon"===vectorTileFeatureTypes[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var l=0;l<u-1&&e[l].equals(e[l+1]);)l++;if(!(u<(o?3:2))){"bevel"===r&&(a=1.05);var p=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),c=e[l],h=this.arrays,_=h.prepareSegment(10*u);this.distance=0;var y,m,E,v=i,x=o?"butt":i,C=!0,f=void 0,A=void 0,L=void 0,S=void 0;this.e1=this.e2=this.e3=-1,o&&(y=e[u-2],S=c.sub(y)._unit()._perp());for(var T=l;T<u;T++)if(!(A=o&&T===u-1?e[l+1]:e[T+1])||!e[T].equals(A)){S&&(L=S),y&&(f=y),y=e[T],S=A?A.sub(y)._unit()._perp():L,L=L||S;var V=L.add(S);0===V.x&&0===V.y||V._unit();var I=V.x*S.x+V.y*S.y,N=0!==I?1/I:1/0,b=I<COS_HALF_SHARP_CORNER&&f&&A;if(b&&T>l){var g=y.dist(f);if(g>2*p){var R=y.sub(y.sub(f)._mult(p/g)._round());d.distance+=R.dist(f),d.addCurrentVertex(R,d.distance,L.mult(1),0,0,!1,_),f=R}}var F=f&&A,B=F?r:A?v:x;if(F&&"round"===B&&(N<n?B="miter":N<=2&&(B="fakeround")),"miter"===B&&N>a&&(B="bevel"),"bevel"===B&&(N>2&&(B="flipbevel"),N<a&&(B="miter")),f&&(d.distance+=y.dist(f)),"miter"===B)V._mult(N),d.addCurrentVertex(y,d.distance,V,0,0,!1,_);else if("flipbevel"===B){if(N>100)V=S.clone().mult(-1);else{var k=L.x*S.y-L.y*S.x>0?-1:1,D=N*L.add(S).mag()/L.sub(S).mag();V._perp()._mult(D*k)}d.addCurrentVertex(y,d.distance,V,0,0,!1,_),d.addCurrentVertex(y,d.distance,V.mult(-1),0,0,!1,_)}else if("bevel"===B||"fakeround"===B){var P=L.x*S.y-L.y*S.x>0,q=-Math.sqrt(N*N-1);if(P?(E=0,m=q):(m=0,E=q),C||d.addCurrentVertex(y,d.distance,L,m,E,!1,_),"fakeround"===B){for(var M=Math.floor(8*(.5-(I-.5))),O=void 0,U=0;U<M;U++)O=S.mult((U+1)/(M+1))._add(L)._unit(),d.addPieSliceVertex(y,d.distance,O,P,_);d.addPieSliceVertex(y,d.distance,V,P,_);for(var X=M-1;X>=0;X--)O=L.mult((X+1)/(M+1))._add(S)._unit(),d.addPieSliceVertex(y,d.distance,O,P,_)}A&&d.addCurrentVertex(y,d.distance,S,-m,-E,!1,_)}else"butt"===B?(C||d.addCurrentVertex(y,d.distance,L,0,0,!1,_),A&&d.addCurrentVertex(y,d.distance,S,0,0,!1,_)):"square"===B?(C||(d.addCurrentVertex(y,d.distance,L,1,1,!1,_),d.e1=d.e2=-1),A&&d.addCurrentVertex(y,d.distance,S,-1,-1,!1,_)):"round"===B&&(C||(d.addCurrentVertex(y,d.distance,L,0,0,!1,_),d.addCurrentVertex(y,d.distance,L,1,1,!0,_),d.e1=d.e2=-1),A&&(d.addCurrentVertex(y,d.distance,S,-1,-1,!0,_),d.addCurrentVertex(y,d.distance,S,0,0,!1,_)));if(b&&T<u-1){var w=y.dist(A);if(w>2*p){var H=y.add(A.sub(y)._mult(p/w)._round());d.distance+=H.dist(y),d.addCurrentVertex(H,d.distance,S.mult(1),0,0,!1,_),y=H}}C=!1}h.populatePaintArrays(s)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,d){var s,o=n?1:0,u=this.arrays,l=u.layoutVertexArray,p=u.elementArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),addLineVertex(l,e,s,o,0,i,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),a&&s._sub(r.perp()._mult(a)),addLineVertex(l,e,s,o,1,-a,t),this.e3=d.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,d))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var d=this.arrays,s=d.layoutVertexArray,o=d.elementArray;addLineVertex(s,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);LineBucket.programInterface=lineInterface,module.exports=LineBucket;
},{"../../_minemap_/vector-tile":46,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],63:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,s,n){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===s?0:s<0?-1:1)|(n*LINE_DISTANCE_SCALE&63)<<2,n*LINE_DISTANCE_SCALE>>6,255&curOpacity,parseInt(curNum),parseInt(curStatus))}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,spriteInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}],paintAttributes:[{property:"sprite-color"},{property:"sprite-blur"},{property:"sprite-opacity"},{property:"sprite-gap-width",name:"gapwidth"},{property:"sprite-offset"},{property:"sprite-width"},{property:"sprite-width",name:"floorwidth",useIntegerZoom:!0}],elementArrayType:createElementArrayType()},curOpacity=0,curNum=0,curStatus=1,SpriteBucket=function(e){function t(t){e.call(this,t,spriteInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=this.layers[0].getLayoutValue("sprite-join",{zoom:this.zoom},e.properties),a=r["sprite-cap"],s=r["sprite-miter-limit"],n=r["sprite-round-limit"];curNum=e.properties.link_seq?e.properties.link_seq:curNum,curNum%=10,curStatus=e.properties.status||1;for(var d=0,u=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);d<u.length;d+=1){var p=u[d];t.addLine(p,e,i,a,s,n)}},t.prototype.addLine=function(e,t,r,i,a,s){for(var n=this,d=t.properties,u="Polygon"===vectorTileFeatureTypes[t.type],p=e.length;p>=2&&e[p-1].equals(e[p-2]);)p--;for(var o=0;o<p-1&&e[o].equals(e[o+1]);)o++;if(!(p<(u?3:2))){"bevel"===r&&(a=1.05);var c=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),l=e[o],_=this.arrays,h=_.prepareSegment(10*p);this.distance=0;var m,y,E,v=i,x=u?"butt":i,C=!0,S=void 0,f=void 0,A=void 0,L=void 0;this.e1=this.e2=this.e3=-1,u&&(m=e[p-2],L=l.sub(m)._unit()._perp());for(var I=o;I<p;I++)if(curOpacity=Math.round(255/p*I),!(f=u&&I===p-1?e[o+1]:e[I+1])||!e[I].equals(f)){L&&(A=L),m&&(S=m),m=e[I],L=f?f.sub(m)._unit()._perp():A,A=A||L;var N=A.add(L);0===N.x&&0===N.y||N._unit();var T=N.x*L.x+N.y*L.y,V=0!==T?1/T:1/0,b=T<COS_HALF_SHARP_CORNER&&S&&f;if(b&&I>o){var g=m.dist(S);if(g>2*c){var R=m.sub(m.sub(S)._mult(c/g)._round());n.distance+=R.dist(S),n.addCurrentVertex(R,n.distance,A.mult(1),0,0,!1,h),S=R}}var F=S&&f,k=F?r:f?v:x;if(F&&"round"===k&&(V<s?k="miter":V<=2&&(k="fakeround")),"miter"===k&&V>a&&(k="bevel"),"bevel"===k&&(V>2&&(k="flipbevel"),V<a&&(k="miter")),S&&(n.distance+=m.dist(S)),"miter"===k)N._mult(V),n.addCurrentVertex(m,n.distance,N,0,0,!1,h);else if("flipbevel"===k){if(V>100)N=L.clone().mult(-1);else{var B=A.x*L.y-A.y*L.x>0?-1:1,q=V*A.add(L).mag()/A.sub(L).mag();N._perp()._mult(q*B)}n.addCurrentVertex(m,n.distance,N,0,0,!1,h),n.addCurrentVertex(m,n.distance,N.mult(-1),0,0,!1,h)}else if("bevel"===k||"fakeround"===k){var D=A.x*L.y-A.y*L.x>0,O=-Math.sqrt(V*V-1);if(D?(E=0,y=O):(y=0,E=O),C||n.addCurrentVertex(m,n.distance,A,y,E,!1,h),"fakeround"===k){for(var P=Math.floor(8*(.5-(T-.5))),M=void 0,U=0;U<P;U++)M=L.mult((U+1)/(P+1))._add(A)._unit(),n.addPieSliceVertex(m,n.distance,M,D,h);n.addPieSliceVertex(m,n.distance,N,D,h);for(var X=P-1;X>=0;X--)M=A.mult((X+1)/(P+1))._add(L)._unit(),n.addPieSliceVertex(m,n.distance,M,D,h)}f&&n.addCurrentVertex(m,n.distance,L,-y,-E,!1,h)}else"butt"===k?(C||n.addCurrentVertex(m,n.distance,A,0,0,!1,h),f&&n.addCurrentVertex(m,n.distance,L,0,0,!1,h)):"square"===k?(C||(n.addCurrentVertex(m,n.distance,A,1,1,!1,h),n.e1=n.e2=-1),f&&n.addCurrentVertex(m,n.distance,L,-1,-1,!1,h)):"round"===k&&(C||(n.addCurrentVertex(m,n.distance,A,0,0,!1,h),n.addCurrentVertex(m,n.distance,A,1,1,!0,h),n.e1=n.e2=-1),f&&(n.addCurrentVertex(m,n.distance,L,-1,-1,!0,h),n.addCurrentVertex(m,n.distance,L,0,0,!1,h)));if(b&&I<p-1){var w=m.dist(f);if(w>2*c){var H=m.add(f.sub(m)._mult(c/w)._round());n.distance+=H.dist(m),n.addCurrentVertex(H,n.distance,L.mult(1),0,0,!1,h),m=H}}C=!1}_.populatePaintArrays(d)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,s,n){var d,u=s?1:0,p=this.arrays,o=p.layoutVertexArray,c=p.elementArray;d=r.clone(),i&&d._sub(r.perp()._mult(i)),addLineVertex(o,e,d,u,0,i,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,d=r.mult(-1),a&&d._sub(r.perp()._mult(a)),addLineVertex(o,e,d,u,1,-a,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,s,n))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var s=i?1:0;r=r.mult(i?-1:1);var n=this.arrays,d=n.layoutVertexArray,u=n.elementArray;addLineVertex(d,e,r,0,s,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);SpriteBucket.programInterface=spriteInterface,module.exports=SpriteBucket;
},{"../../_minemap_/vector-tile":46,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],64:[function(_dereq_,module,exports){
"use strict";function addVertex(e,t,a,o,r,i,n,l){e.emplaceBack(t,a,Math.round(64*o),Math.round(64*r),i,n,l?l[0]:void 0,l?l[1]:void 0)}function addDynamicAttributes(e,t,a,o){var r=2*Math.PI,i=packUint8ToFloat((a+r)%r/r*255,10*o);e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function addCollisionBoxVertex(e,t,a,o,r,i){return e.emplaceBack(t.x,t.y,a.x,a.y,Math.round(o.x),Math.round(o.y),10*r,10*i)}function getSizeData(e,t,a){var o={};if(o.isFeatureConstant=t.isLayoutValueFeatureConstant(a),o.isZoomConstant=t.isLayoutValueZoomConstant(a),o.isFeatureConstant&&(o.layoutSize=t.getLayoutValue(a,{zoom:e+1})),!o.isZoomConstant){for(var r=t.getLayoutValueStopZoomLevels(a),i=0;i<r.length&&r[i]<=e;)i++;i=Math.max(0,i-1);for(var n=i;n<r.length&&r[n]<e+1;)n++;n=Math.min(r.length-1,n),o.coveringZoomRange=[r[i],r[n]],t.isLayoutValueFeatureConstant(a)&&(o.coveringStopValues=[t.getLayoutValue(a,{zoom:r[i]}),t.getLayoutValue(a,{zoom:r[n]})]),o.functionBase=t.getLayoutProperty(a).base,void 0===o.functionBase&&(o.functionBase=1),o.functionType=t.getLayoutProperty(a).type||"exponential"}return o}function getSizeVertexData(e,t,a,o,r){return e.isLayoutValueZoomConstant(o)&&!e.isLayoutValueFeatureConstant(o)?[10*e.getLayoutValue(o,{},r)]:e.isLayoutValueZoomConstant(o)||e.isLayoutValueFeatureConstant(o)?null:[10*e.getLayoutValue(o,{zoom:a[0]},r),10*e.getLayoutValue(o,{zoom:a[1]},r)]}var Point=_dereq_("../../_minemap_/point-geometry"),ArrayGroup=_dereq_("../array_group"),BufferGroup=_dereq_("../buffer_group"),createElementArrayType=_dereq_("../element_array_type"),EXTENT=_dereq_("../extent"),packUint8ToFloat=_dereq_("../../shaders/encode_attribute").packUint8ToFloat,Anchor=_dereq_("../../symbol/anchor"),getAnchors=_dereq_("../../symbol/get_anchors"),resolveTokens=_dereq_("../../util/token"),Quads=_dereq_("../../symbol/quads"),Shaping=_dereq_("../../symbol/shaping"),transformText=_dereq_("../../symbol/transform_text"),mergeLines=_dereq_("../../symbol/mergelines"),clipLine=_dereq_("../../symbol/clip_line"),util=_dereq_("../../util/util"),scriptDetection=_dereq_("../../util/script_detection"),loadGeometry=_dereq_("../load_geometry"),CollisionFeature=_dereq_("../../symbol/collision_feature"),findPoleOfInaccessibility=_dereq_("../../util/find_pole_of_inaccessibility"),classifyRings=_dereq_("../../util/classify_rings"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,createStructArrayType=_dereq_("../../util/struct_array"),verticalizePunctuation=_dereq_("../../util/verticalize_punctuation"),shapeText=Shaping.shapeText,shapeIcon=Shaping.shapeIcon,WritingMode=Shaping.WritingMode,getGlyphQuads=Quads.getGlyphQuads,getIconQuads=Quads.getIconQuads,PlacedSymbolArray=createStructArrayType({members:[{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Float32",name:"placementZoom"},{type:"Uint8",name:"vertical"}]}),GlyphOffsetArray=createStructArrayType({members:[{type:"Float32",name:"offsetX"}]}),LineVertexArray=createStructArrayType({members:[{type:"Int16",name:"x"},{type:"Int16",name:"y"}]}),elementArrayType=createElementArrayType(),layoutAttributes=[{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}],dynamicLayoutAttributes=[{name:"a_projected_pos",components:3,type:"Float32"}],symbolInterfaces={glyph:{layoutAttributes:layoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,elementArrayType:elementArrayType,paintAttributes:[{property:"text-color",name:"fill_color"},{property:"text-halo-color",name:"halo_color"},{property:"text-halo-width",name:"halo_width"},{property:"text-halo-blur",name:"halo_blur"},{property:"text-opacity",name:"opacity"}]},icon:{layoutAttributes:layoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,elementArrayType:elementArrayType,paintAttributes:[{property:"icon-color",name:"fill_color"},{property:"icon-halo-color",name:"halo_color"},{property:"icon-halo-width",name:"halo_width"},{property:"icon-halo-blur",name:"halo_blur"},{property:"icon-opacity",name:"opacity"}]},collisionBox:{layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}],elementArrayType:createElementArrayType(2)}},SymbolBucket=function(e){var t=this;this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.index=e.index,this.sdfIcons=e.sdfIcons,this.iconsNeedLinear=e.iconsNeedLinear,this.fontstack=e.fontstack;var a=this.layers[0];if(this.symbolInterfaces=symbolInterfaces,e.arrays){this.buffers={};for(var o in e.arrays)e.arrays[o]&&(t.buffers[o]=new BufferGroup(t.symbolInterfaces[o],e.layers,e.zoom,e.arrays[o]));this.textSizeData=e.textSizeData,this.iconSizeData=e.iconSizeData,this.placedGlyphArray=new PlacedSymbolArray(e.placedGlyphArray),this.placedIconArray=new PlacedSymbolArray(e.placedIconArray),this.glyphOffsetArray=new GlyphOffsetArray(e.glyphOffsetArray),this.lineVertexArray=new LineVertexArray(e.lineVertexArray)}else this.textSizeData=getSizeData(this.zoom,a,"text-size"),this.iconSizeData=getSizeData(this.zoom,a,"icon-size")};SymbolBucket.prototype.populate=function(e,t){var a=this,o=this.layers[0],r=o.layout,i=r["text-font"],n=(!o.isLayoutValueFeatureConstant("text-field")||r["text-field"])&&i,l=!o.isLayoutValueFeatureConstant("icon-image")||r["icon-image"];if(this.features=[],n||l){for(var s=t.iconDependencies,y=t.glyphDependencies,c=y[i]=y[i]||{},p={zoom:this.zoom},u=0,m=e;u<m.length;u+=1){var h=m[u],x=h.feature,d=h.index,f=h.sourceLayerIndex;if(o.filter(x)){var g=void 0;n&&(g=o.getLayoutValue("text-field",p,x.properties),o.isLayoutValueFeatureConstant("text-field")&&(g=resolveTokens(x.properties,g)),g=transformText(g,o,p,x.properties));var b=void 0;if(l&&(b=o.getLayoutValue("icon-image",p,x.properties),o.isLayoutValueFeatureConstant("icon-image")&&(b=resolveTokens(x.properties,b))),(g||b)&&(a.features.push({text:g,icon:b,index:d,sourceLayerIndex:f,geometry:loadGeometry(x),properties:x.properties,type:vectorTileFeatureTypes[x.type]}),b&&(s[b]=!0),g))for(var v="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],S=scriptDetection.allowsVerticalWritingMode(g),A=0;A<g.length;A++)if(c[g.charCodeAt(A)]=!0,v&&S){var I=verticalizePunctuation.lookup[g.charAt(A)];I&&(c[I.charCodeAt(0)]=!0)}}}"line"===r["symbol-placement"]&&(this.features=mergeLines(this.features))}},SymbolBucket.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},SymbolBucket.prototype.getPaintPropertyStatistics=function(){for(var e=this,t={},a=0,o=e.layers;a<o.length;a+=1){var r=o[a];t[r.id]=util.extend({},e.arrays.icon.layerData[r.id].paintPropertyStatistics,e.arrays.glyph.layerData[r.id].paintPropertyStatistics)}return t},SymbolBucket.prototype.serialize=function(e){return{zoom:this.zoom,layerIds:this.layers.map(function(e){return e.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,textSizeData:this.textSizeData,iconSizeData:this.iconSizeData,fontstack:this.fontstack,placedGlyphArray:this.placedGlyphArray.serialize(e),placedIconArray:this.placedIconArray.serialize(e),glyphOffsetArray:this.glyphOffsetArray.serialize(e),lineVertexArray:this.lineVertexArray.serialize(e),arrays:util.mapObject(this.arrays,function(t){return t.isEmpty()?null:t.serialize(e)})}},SymbolBucket.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},SymbolBucket.prototype.createArrays=function(){var e=this;this.arrays=util.mapObject(this.symbolInterfaces,function(t){return new ArrayGroup(t,e.layers,e.zoom)})},SymbolBucket.prototype.prepare=function(e,t){var a=this;this.symbolInstances=[];var o=512*this.overscaling;this.tilePixelRatio=EXTENT/o,this.compareText={},this.iconsNeedLinear=!1;for(var r=this.layers[0].layout,i=24*r["text-line-height"],n="line"!==r["symbol-placement"]?24*r["text-max-width"]:0,l=24*r["text-letter-spacing"],s=this.fontstack=r["text-font"].join(","),y="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],c=0,p=a.features;c<p.length;c+=1){var u=p[c],m=void 0;if(u.text){var h=scriptDetection.allowsVerticalWritingMode(u.text),x=a.layers[0].getLayoutValue("text-offset",{zoom:a.zoom},u.properties).map(function(e){return 24*e}),d=scriptDetection.allowsLetterSpacing(u.text)?l:0,f=a.layers[0].getLayoutValue("text-anchor",{zoom:a.zoom},u.properties),g=a.layers[0].getLayoutValue("text-justify",{zoom:a.zoom},u.properties);m={},m[WritingMode.horizontal]=shapeText(u.text,e[s],n,i,f,g,d,x,24,WritingMode.horizontal),m[WritingMode.vertical]=h&&y&&shapeText(u.text,e[s],n,i,f,g,d,x,24,WritingMode.vertical)}else m={};var b=void 0;if(u.icon){var v=t[u.icon];v&&(b=shapeIcon(v,a.layers[0].getLayoutValue("icon-offset",{zoom:a.zoom},u.properties)),void 0===a.sdfIcons?a.sdfIcons=v.sdf:a.sdfIcons!==v.sdf&&util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),v.isNativePixelRatio?0===r["icon-rotate"]&&a.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(a.iconsNeedLinear=!0):a.iconsNeedLinear=!0)}(m[WritingMode.horizontal]||b)&&a.addFeature(u,m,b)}},SymbolBucket.prototype.addFeature=function(e,t,a){var o=this,r=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1},e.properties),i=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1},e.properties),n=this.layers[0].getLayoutValue("text-offset",{zoom:this.zoom},e.properties),l=this.layers[0].getLayoutValue("icon-offset",{zoom:this.zoom},e.properties),s=this.layers[0].getLayoutValue("text-size",{zoom:18},e.properties);void 0===s&&(s=r);var y=this.layers[0].layout,c=r/24,p=this.tilePixelRatio*c,u=this.tilePixelRatio*s/24,m=this.tilePixelRatio*i,h=this.tilePixelRatio*y["symbol-spacing"],x=y["symbol-avoid-edges"],d=y["text-padding"]*this.tilePixelRatio,f=y["icon-padding"]*this.tilePixelRatio,g=y["text-max-angle"]/180*Math.PI,b="map"===y["text-rotation-alignment"]&&"line"===y["symbol-placement"],v="map"===y["icon-rotation-alignment"]&&"line"===y["symbol-placement"],S=y["text-allow-overlap"]||y["icon-allow-overlap"]||y["text-ignore-placement"]||y["icon-ignore-placement"],A=y["symbol-placement"],I=h/2,z=function(r,i){var s=!(i.x<0||i.x>EXTENT||i.y<0||i.y>EXTENT);if(!x||s){var y=s||S;o.addSymbolInstance(i,r,t,a,o.layers[0],y,o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,p,d,b,n,m,f,v,l,{zoom:o.zoom},e.properties)}};if("line"===A)for(var B=0,L=clipLine(e.geometry,0,0,EXTENT,EXTENT);B<L.length;B+=1)for(var V=L[B],T=getAnchors(V,h,g,t[WritingMode.vertical]||t[WritingMode.horizontal],a,24,u,o.overscaling,EXTENT),M=0,k=T;M<k.length;M+=1){var _=k[M],P=t[WritingMode.horizontal];P&&o.anchorIsTooClose(P.text,I,_)||z(V,_)}else if("Polygon"===e.type)for(var w=0,C=classifyRings(e.geometry,0);w<C.length;w+=1){var E=C[w],F=findPoleOfInaccessibility(E,16);z(E[0],new Anchor(F.x,F.y,0))}else if("LineString"===e.type)for(var D=0,O=e.geometry;D<O.length;D+=1){var q=O[D];z(q,new Anchor(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var N=0,G=e.geometry;N<G.length;N+=1)for(var W=G[N],R=0,Q=W;R<Q.length;R+=1){var U=Q[R];z([U],new Anchor(U.x,U.y,0))}},SymbolBucket.prototype.anchorIsTooClose=function(e,t,a){var o=this.compareText;if(e in o){for(var r=o[e],i=r.length-1;i>=0;i--)if(a.dist(r[i])<t)return!0}else o[e]=[];return o[e].push(a),!1},SymbolBucket.prototype.place=function(e,t){var a=this;this.createArrays(),this.placedGlyphArray=new PlacedSymbolArray,this.placedIconArray=new PlacedSymbolArray,this.glyphOffsetArray=new GlyphOffsetArray,this.lineVertexArray=new LineVertexArray;var o=this.layers[0],r=o.layout,i=e.maxScale,n="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],l="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"];if(r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"]){var s=e.angle,y=Math.sin(s),c=Math.cos(s);this.symbolInstances.sort(function(e,t){return(y*e.anchor.x+c*e.anchor.y|0)-(y*t.anchor.x+c*t.anchor.y|0)||t.featureIndex-e.featureIndex})}for(var p=0,u=a.symbolInstances;p<u.length;p+=1){var m=u[p],h={boxStartIndex:m.textBoxStartIndex,boxEndIndex:m.textBoxEndIndex},x={boxStartIndex:m.iconBoxStartIndex,boxEndIndex:m.iconBoxEndIndex},d=!(m.textBoxStartIndex===m.textBoxEndIndex),f=!(m.iconBoxStartIndex===m.iconBoxEndIndex),g=r["text-optional"]||!d,b=r["icon-optional"]||!f,v=d?e.placeCollisionFeature(h,r["text-allow-overlap"],r["symbol-avoid-edges"]):e.minScale,S=f?e.placeCollisionFeature(x,r["icon-allow-overlap"],r["symbol-avoid-edges"]):e.minScale;if(g||b?!b&&v?v=Math.max(S,v):!g&&S&&(S=Math.max(S,v)):S=v=Math.max(S,v),d||f){for(var A=m.line,I=a.lineVertexArray.length,z=0;z<A.length;z++)a.lineVertexArray.emplaceBack(A[z].x,A[z].y);var B=a.lineVertexArray.length-I;if(d&&(e.insertCollisionFeature(h,v,r["text-ignore-placement"]),v<=i)){var L=getSizeVertexData(o,a.zoom,a.textSizeData.coveringZoomRange,"text-size",m.featureProperties);a.addSymbols(a.arrays.glyph,m.glyphQuads,v,L,r["text-keep-upright"],m.textOffset,n,e.angle,m.featureProperties,m.writingModes,m.anchor,I,B,a.placedGlyphArray)}if(f&&(e.insertCollisionFeature(x,S,r["icon-ignore-placement"]),S<=i)){var V=getSizeVertexData(o,a.zoom,a.iconSizeData.coveringZoomRange,"icon-size",m.featureProperties);a.addSymbols(a.arrays.icon,m.iconQuads,S,V,r["icon-keep-upright"],m.iconOffset,l,e.angle,m.featureProperties,null,m.anchor,I,B,a.placedIconArray)}}}t&&this.addToDebugBuffers(e)},SymbolBucket.prototype.addSymbols=function(e,t,a,o,r,i,n,l,s,y,c,p,u,m){for(var h=this,x=e.elementArray,d=e.layoutVertexArray,f=e.dynamicLayoutVertexArray,g=this.zoom,b=Math.max(Math.log(a)/Math.LN2+g,0),v=this.glyphOffsetArray.length,S=(c.angle+l+2*Math.PI)%(2*Math.PI),A=S>1*Math.PI/4&&S<=3*Math.PI/4||S>5*Math.PI/4&&S<=7*Math.PI/4,I=Boolean(y&WritingMode.vertical)&&A,z=0,B=t;z<B.length;z+=1){var L=B[z];if(!n||!r||L.writingMode===WritingMode.vertical===I){var V=L.tl,T=L.tr,M=L.bl,k=L.br,_=L.tex,P=e.prepareSegment(4),w=P.vertexLength,C=L.glyphOffset[1];addVertex(d,c.x,c.y,V.x,C+V.y,_.x,_.y,o),addVertex(d,c.x,c.y,T.x,C+T.y,_.x+_.w,_.y,o),addVertex(d,c.x,c.y,M.x,C+M.y,_.x,_.y+_.h,o),addVertex(d,c.x,c.y,k.x,C+k.y,_.x+_.w,_.y+_.h,o),addDynamicAttributes(f,c,0,b),x.emplaceBack(w,w+1,w+2),x.emplaceBack(w+1,w+2,w+3),P.vertexLength+=4,P.primitiveLength+=2,h.glyphOffsetArray.emplaceBack(L.glyphOffset[0])}}m.emplaceBack(c.x,c.y,v,this.glyphOffsetArray.length-v,p,u,c.segment,o?o[0]:0,o?o[1]:0,i[0],i[1],b,I),e.populatePaintArrays(s)},SymbolBucket.prototype.addToDebugBuffers=function(e){for(var t=this,a=this.arrays.collisionBox,o=a.layoutVertexArray,r=a.elementArray,i=-e.angle,n=e.yStretch,l=0,s=t.symbolInstances;l<s.length;l+=1){var y=s[l];y.textCollisionFeature={boxStartIndex:y.textBoxStartIndex,boxEndIndex:y.textBoxEndIndex},y.iconCollisionFeature={boxStartIndex:y.iconBoxStartIndex,boxEndIndex:y.iconBoxEndIndex};for(var c=0;c<2;c++){var p=y[0===c?"textCollisionFeature":"iconCollisionFeature"];if(p)for(var u=p.boxStartIndex;u<p.boxEndIndex;u++){var m=t.collisionBoxArray.get(u);if(!(1===e.perspectiveRatio&&m.maxScale<1)){var h=m.anchorPoint,x=new Point(m.x1,m.y1*n)._rotate(i),d=new Point(m.x2,m.y1*n)._rotate(i),f=new Point(m.x1,m.y2*n)._rotate(i),g=new Point(m.x2,m.y2*n)._rotate(i),b=Math.max(0,Math.min(25,t.zoom+Math.log(m.maxScale)/Math.LN2)),v=Math.max(0,Math.min(25,t.zoom+Math.log(m.placementScale)/Math.LN2)),S=a.prepareSegment(4),A=S.vertexLength;addCollisionBoxVertex(o,h,y.anchor,x,b,v),addCollisionBoxVertex(o,h,y.anchor,d,b,v),addCollisionBoxVertex(o,h,y.anchor,g,b,v),addCollisionBoxVertex(o,h,y.anchor,f,b,v),r.emplaceBack(A,A+1),r.emplaceBack(A+1,A+2),r.emplaceBack(A+2,A+3),r.emplaceBack(A+3,A),S.vertexLength+=4,S.primitiveLength+=4}}}}},SymbolBucket.prototype.addSymbolInstance=function(e,t,a,o,r,i,n,l,s,y,c,p,u,m,h,x,d,f,g,b){var v,S,A=[],I=[];for(var z in a){var B=parseInt(z,10);a[B]&&(I=I.concat(i?getGlyphQuads(e,a[B],r,u,g,b):[]),v=new CollisionFeature(n,t,e,l,s,y,a[B],c,p,u,!1))}var L=v?v.boxStartIndex:this.collisionBoxArray.length,V=v?v.boxEndIndex:this.collisionBoxArray.length;o&&(A=i?getIconQuads(e,o,r,d,a[WritingMode.horizontal],g,b):[],S=new CollisionFeature(n,t,e,l,s,y,o,h,x,d,!0));var T=S?S.boxStartIndex:this.collisionBoxArray.length,M=S?S.boxEndIndex:this.collisionBoxArray.length;V>SymbolBucket.MAX_INSTANCES&&util.warnOnce("Too many symbols being rendered in a tile. See minedata.cn-js/issues/2907"),M>SymbolBucket.MAX_INSTANCES&&util.warnOnce("Too many glyphs being rendered in a tile. See minedata.cn-js/issues/2907");var k=(a[WritingMode.vertical]?WritingMode.vertical:0)|(a[WritingMode.horizontal]?WritingMode.horizontal:0);this.symbolInstances.push({textBoxStartIndex:L,textBoxEndIndex:V,iconBoxStartIndex:T,iconBoxEndIndex:M,glyphQuads:I,iconQuads:A,textOffset:m,iconOffset:f,anchor:e,line:t,featureIndex:l,featureProperties:b,writingModes:k})},SymbolBucket.programInterfaces=symbolInterfaces,SymbolBucket.MAX_INSTANCES=65535,SymbolBucket.addDynamicAttributes=addDynamicAttributes,module.exports=SymbolBucket;
},{"../../_minemap_/point-geometry":41,"../../_minemap_/vector-tile":46,"../../shaders/encode_attribute":103,"../../symbol/anchor":180,"../../symbol/clip_line":182,"../../symbol/collision_feature":184,"../../symbol/get_anchors":186,"../../symbol/mergelines":189,"../../symbol/quads":191,"../../symbol/shaping":192,"../../symbol/transform_text":195,"../../util/classify_rings":220,"../../util/find_pole_of_inaccessibility":228,"../../util/script_detection":238,"../../util/struct_array":241,"../../util/token":243,"../../util/util":244,"../../util/verticalize_punctuation":246,"../array_group":54,"../buffer_group":68,"../element_array_type":69,"../extent":70,"../load_geometry":72}],65:[function(_dereq_,module,exports){
"use strict";function addVertex(e,t,a,r,o,i,n,s,l){e.emplaceBack(t,a,Math.round(64*r),Math.round(64*o),i,n,s?s[0]:void 0,s?s[1]:void 0,l)}function addDynamicAttributes(e,t,a,r){var o=2*Math.PI,i=packUint8ToFloat((a+o)%o/o*255,10*r);e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function addCollisionBoxVertex(e,t,a,r,o,i){return e.emplaceBack(t.x,t.y,a.x,a.y,Math.round(r.x),Math.round(r.y),10*o,10*i)}function getSizeData(e,t,a){var r={};if(r.isFeatureConstant=t.isLayoutValueFeatureConstant(a),r.isZoomConstant=t.isLayoutValueZoomConstant(a),r.isFeatureConstant&&(r.layoutSize=t.getLayoutValue(a,{zoom:e+1})),!r.isZoomConstant){for(var o=t.getLayoutValueStopZoomLevels(a),i=0;i<o.length&&o[i]<=e;)i++;i=Math.max(0,i-1);for(var n=i;n<o.length&&o[n]<e+1;)n++;n=Math.min(o.length-1,n),r.coveringZoomRange=[o[i],o[n]],t.isLayoutValueFeatureConstant(a)&&(r.coveringStopValues=[t.getLayoutValue(a,{zoom:o[i]}),t.getLayoutValue(a,{zoom:o[n]})]),r.functionBase=t.getLayoutProperty(a).base,void 0===r.functionBase&&(r.functionBase=1),r.functionType=t.getLayoutProperty(a).type||"exponential"}return r}function getSizeVertexData(e,t,a,r,o){return e.isLayoutValueZoomConstant(r)&&!e.isLayoutValueFeatureConstant(r)?[10*e.getLayoutValue(r,{},o)]:e.isLayoutValueZoomConstant(r)||e.isLayoutValueFeatureConstant(r)?null:[10*e.getLayoutValue(r,{zoom:a[0]},o),10*e.getLayoutValue(r,{zoom:a[1]},o)]}var Point=_dereq_("../../_minemap_/point-geometry"),ArrayGroup=_dereq_("../array_group"),BufferGroup=_dereq_("../buffer_group"),createElementArrayType=_dereq_("../element_array_type"),EXTENT=_dereq_("../extent"),packUint8ToFloat=_dereq_("../../shaders/encode_attribute").packUint8ToFloat,Anchor=_dereq_("../../symbol/anchor"),getAnchors=_dereq_("../../symbol/get_anchors"),resolveTokens=_dereq_("../../util/token"),Quads=_dereq_("../../symbol/quads"),Shaping=_dereq_("../../symbol/shaping"),transformText=_dereq_("../../symbol/transform_text"),mergeLines=_dereq_("../../symbol/mergelines"),clipLine=_dereq_("../../symbol/clip_line"),util=_dereq_("../../util/util"),scriptDetection=_dereq_("../../util/script_detection"),loadGeometry=_dereq_("../load_geometry"),CollisionFeature=_dereq_("../../symbol/collision_feature"),findPoleOfInaccessibility=_dereq_("../../util/find_pole_of_inaccessibility"),classifyRings=_dereq_("../../util/classify_rings"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,createStructArrayType=_dereq_("../../util/struct_array"),verticalizePunctuation=_dereq_("../../util/verticalize_punctuation"),shapeText=Shaping.shapeText,shapeIcon=Shaping.shapeIcon,WritingMode=Shaping.WritingMode,getGlyphQuads=Quads.getGlyphQuads,getIconQuads=Quads.getIconQuads,PlacedSymbolArray=createStructArrayType({members:[{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Float32",name:"placementZoom"},{type:"Uint8",name:"vertical"}]}),GlyphOffsetArray=createStructArrayType({members:[{type:"Float32",name:"offsetX"}]}),LineVertexArray=createStructArrayType({members:[{type:"Int16",name:"x"},{type:"Int16",name:"y"}]}),elementArrayType=createElementArrayType(),layoutAttributes=[{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_seq",components:1,type:"Uint16"}],dynamicLayoutAttributes=[{name:"a_projected_pos",components:3,type:"Float32"}],symtrackingInterfaces={glyph:{layoutAttributes:layoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,elementArrayType:elementArrayType,paintAttributes:[{property:"text-color",name:"fill_color"},{property:"text-halo-color",name:"halo_color"},{property:"text-halo-width",name:"halo_width"},{property:"text-halo-blur",name:"halo_blur"},{property:"text-opacity",name:"opacity"}]},icon:{layoutAttributes:layoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,elementArrayType:elementArrayType,paintAttributes:[{property:"icon-color",name:"fill_color"},{property:"icon-halo-color",name:"halo_color"},{property:"icon-halo-width",name:"halo_width"},{property:"icon-halo-blur",name:"halo_blur"},{property:"icon-opacity",name:"opacity"}]},collisionBox:{layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}],elementArrayType:createElementArrayType(2)}},SymtrackingBucket=function(e){var t=this;this.collisionBoxArray=e.collisionBoxArray,this._seq=0,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.index=e.index,this.sdfIcons=e.sdfIcons,this.iconsNeedLinear=e.iconsNeedLinear,this.fontstack=e.fontstack;var a=this.layers[0];if(this.symtrackingInterfaces=symtrackingInterfaces,e.arrays){this.buffers={};for(var r in e.arrays)e.arrays[r]&&(t.buffers[r]=new BufferGroup(t.symtrackingInterfaces[r],e.layers,e.zoom,e.arrays[r]));this.textSizeData=e.textSizeData,this.iconSizeData=e.iconSizeData,this.placedGlyphArray=new PlacedSymbolArray(e.placedGlyphArray),this.placedIconArray=new PlacedSymbolArray(e.placedIconArray),this.glyphOffsetArray=new GlyphOffsetArray(e.glyphOffsetArray),this.lineVertexArray=new LineVertexArray(e.lineVertexArray)}else this.textSizeData=getSizeData(this.zoom,a,"text-size"),this.iconSizeData=getSizeData(this.zoom,a,"icon-size")};SymtrackingBucket.prototype.populate=function(e,t){var a=this,r=this.layers[0],o=r.layout,i=o["text-font"],n=(!r.isLayoutValueFeatureConstant("text-field")||o["text-field"])&&i,s=!r.isLayoutValueFeatureConstant("icon-image")||o["icon-image"];if(this.features=[],n||s){for(var l=t.iconDependencies,c=t.glyphDependencies,y=c[i]=c[i]||{},p={zoom:this.zoom},u=0,m=e;u<m.length;u+=1){var h=m[u],x=h.feature,d=h.index,g=h.sourceLayerIndex;if(r.filter(x)){var f=void 0;n&&(f=r.getLayoutValue("text-field",p,x.properties),r.isLayoutValueFeatureConstant("text-field")&&(f=resolveTokens(x.properties,f)),f=transformText(f,r,p,x.properties));var v=void 0;if(s&&(v=r.getLayoutValue("icon-image",p,x.properties),r.isLayoutValueFeatureConstant("icon-image")&&(v=resolveTokens(x.properties,v))),(f||v)&&(a.features.push({text:f,icon:v,index:d,sourceLayerIndex:g,geometry:loadGeometry(x),properties:x.properties,type:vectorTileFeatureTypes[x.type]}),v&&(l[v]=!0),f))for(var A="map"===o["text-rotation-alignment"]&&"line"===o["symbol-placement"],S=scriptDetection.allowsVerticalWritingMode(f),b=0;b<f.length;b++)if(y[f.charCodeAt(b)]=!0,A&&S){var I=verticalizePunctuation.lookup[f.charAt(b)];I&&(y[I.charCodeAt(0)]=!0)}}}"line"===o["symbol-placement"]&&(this.features=mergeLines(this.features))}},SymtrackingBucket.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},SymtrackingBucket.prototype.getPaintPropertyStatistics=function(){for(var e=this,t={},a=0,r=e.layers;a<r.length;a+=1){var o=r[a];t[o.id]=util.extend({},e.arrays.icon.layerData[o.id].paintPropertyStatistics,e.arrays.glyph.layerData[o.id].paintPropertyStatistics)}return t},SymtrackingBucket.prototype.serialize=function(e){return{zoom:this.zoom,layerIds:this.layers.map(function(e){return e.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,textSizeData:this.textSizeData,iconSizeData:this.iconSizeData,fontstack:this.fontstack,placedGlyphArray:this.placedGlyphArray.serialize(e),placedIconArray:this.placedIconArray.serialize(e),glyphOffsetArray:this.glyphOffsetArray.serialize(e),lineVertexArray:this.lineVertexArray.serialize(e),arrays:util.mapObject(this.arrays,function(t){return t.isEmpty()?null:t.serialize(e)})}},SymtrackingBucket.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},SymtrackingBucket.prototype.createArrays=function(){var e=this;this.arrays=util.mapObject(this.symtrackingInterfaces,function(t){return new ArrayGroup(t,e.layers,e.zoom)})},SymtrackingBucket.prototype.prepare=function(e,t){var a=this;this.symbolInstances=[];var r=512*this.overscaling;this.tilePixelRatio=EXTENT/r,this.compareText={},this.iconsNeedLinear=!1;for(var o=this.layers[0].layout,i=24*o["text-line-height"],n="line"!==o["symbol-placement"]?24*o["text-max-width"]:0,s=24*o["text-letter-spacing"],l=this.fontstack=o["text-font"].join(","),c="map"===o["text-rotation-alignment"]&&"line"===o["symbol-placement"],y=0,p=a.features;y<p.length;y+=1){var u=p[y];a._seq=u.properties.link_seq;var m=void 0;if(u.text){var h=scriptDetection.allowsVerticalWritingMode(u.text),x=a.layers[0].getLayoutValue("text-offset",{zoom:a.zoom},u.properties).map(function(e){return 24*e}),d=scriptDetection.allowsLetterSpacing(u.text)?s:0,g=a.layers[0].getLayoutValue("text-anchor",{zoom:a.zoom},u.properties),f=a.layers[0].getLayoutValue("text-justify",{zoom:a.zoom},u.properties);m={},m[WritingMode.horizontal]=shapeText(u.text,e[l],n,i,g,f,d,x,24,WritingMode.horizontal),m[WritingMode.vertical]=h&&c&&shapeText(u.text,e[l],n,i,g,f,d,x,24,WritingMode.vertical)}else m={};var v=void 0;if(u.icon){var A=t[u.icon];A&&(v=shapeIcon(A,a.layers[0].getLayoutValue("icon-offset",{zoom:a.zoom},u.properties)),void 0===a.sdfIcons?a.sdfIcons=A.sdf:a.sdfIcons!==A.sdf&&util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),A.isNativePixelRatio?0===o["icon-rotate"]&&a.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(a.iconsNeedLinear=!0):a.iconsNeedLinear=!0)}(m[WritingMode.horizontal]||v)&&a.addFeature(u,m,v,a._seq)}},SymtrackingBucket.prototype.addFeature=function(e,t,a,r){var o=this,i=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1},e.properties),n=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1},e.properties),s=this.layers[0].getLayoutValue("text-offset",{zoom:this.zoom},e.properties),l=this.layers[0].getLayoutValue("icon-offset",{zoom:this.zoom},e.properties),c=this.layers[0].getLayoutValue("text-size",{zoom:18},e.properties);void 0===c&&(c=i);var y=this.layers[0].layout,p=i/24,u=this.tilePixelRatio*p,m=this.tilePixelRatio*c/24,h=this.tilePixelRatio*n,x=this.tilePixelRatio*y["symbol-spacing"],d=y["symbol-avoid-edges"],g=y["text-padding"]*this.tilePixelRatio,f=y["icon-padding"]*this.tilePixelRatio,v=y["text-max-angle"]/180*Math.PI,A="map"===y["text-rotation-alignment"]&&"line"===y["symbol-placement"],S="map"===y["icon-rotation-alignment"]&&"line"===y["symbol-placement"],b=y["text-allow-overlap"]||y["icon-allow-overlap"]||y["text-ignore-placement"]||y["icon-ignore-placement"],I=y["symbol-placement"],z=x/2,k=function(i,n){var c=!(n.x<0||n.x>EXTENT||n.y<0||n.y>EXTENT);if(!d||c){var y=c||b;o.addSymbolInstance(n,i,t,a,o.layers[0],y,o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,u,g,A,s,h,f,S,l,{zoom:o.zoom},e.properties,r)}};if("line"===I)for(var B=0,L=clipLine(e.geometry,0,0,EXTENT,EXTENT,!0);B<L.length;B+=1)for(var V=L[B],M=getAnchors(V,x,v,t[WritingMode.vertical]||t[WritingMode.horizontal],a,24,m,o.overscaling,EXTENT,!0),T=0,_=M;T<_.length;T+=1){var P=_[T],w=t[WritingMode.horizontal];w&&o.anchorIsTooClose(w.text,z,P)||k(V,P)}else if("Polygon"===e.type)for(var C=0,E=classifyRings(e.geometry,0);C<E.length;C+=1){var F=E[C],D=findPoleOfInaccessibility(F,16);k(F[0],new Anchor(D.x,D.y,0))}else if("LineString"===e.type)for(var q=0,O=e.geometry;q<O.length;q+=1){var N=O[q];k(N,new Anchor(N[0].x,N[0].y,0))}else if("Point"===e.type)for(var G=0,W=e.geometry;G<W.length;G+=1)for(var R=W[G],U=0,Q=R;U<Q.length;U+=1){var X=Q[U];k([X],new Anchor(X.x,X.y,0))}},SymtrackingBucket.prototype.anchorIsTooClose=function(e,t,a){var r=this.compareText;if(e in r){for(var o=r[e],i=o.length-1;i>=0;i--)if(a.dist(o[i])<t)return!0}else r[e]=[];return r[e].push(a),!1},SymtrackingBucket.prototype.place=function(e,t){var a=this;this.createArrays(),this.placedGlyphArray=new PlacedSymbolArray,this.placedIconArray=new PlacedSymbolArray,this.glyphOffsetArray=new GlyphOffsetArray,this.lineVertexArray=new LineVertexArray;var r=this.layers[0],o=r.layout,i=e.maxScale,n="map"===o["text-rotation-alignment"]&&"line"===o["symbol-placement"],s="map"===o["icon-rotation-alignment"]&&"line"===o["symbol-placement"];if(o["text-allow-overlap"]||o["icon-allow-overlap"]||o["text-ignore-placement"]||o["icon-ignore-placement"]){var l=e.angle,c=Math.sin(l),y=Math.cos(l);this.symbolInstances.sort(function(e,t){return(c*e.anchor.x+y*e.anchor.y|0)-(c*t.anchor.x+y*t.anchor.y|0)||t.featureIndex-e.featureIndex})}for(var p=0,u=a.symbolInstances;p<u.length;p+=1){var m=u[p],h={boxStartIndex:m.textBoxStartIndex,boxEndIndex:m.textBoxEndIndex},x={boxStartIndex:m.iconBoxStartIndex,boxEndIndex:m.iconBoxEndIndex},d=!(m.textBoxStartIndex===m.textBoxEndIndex),g=!(m.iconBoxStartIndex===m.iconBoxEndIndex),f=o["text-optional"]||!d,v=o["icon-optional"]||!g,A=d?e.placeCollisionFeature(h,o["text-allow-overlap"],o["symbol-avoid-edges"]):e.minScale,S=g?e.placeCollisionFeature(x,o["icon-allow-overlap"],o["symbol-avoid-edges"]):e.minScale;if(f||v?!v&&A?A=Math.max(S,A):!f&&S&&(S=Math.max(S,A)):S=A=Math.max(S,A),d||g){for(var b=m.line,I=a.lineVertexArray.length,z=0;z<b.length;z++)a.lineVertexArray.emplaceBack(b[z].x,b[z].y);var k=a.lineVertexArray.length-I;if(d&&(e.insertCollisionFeature(h,A,o["text-ignore-placement"]),A<=i)){var B=getSizeVertexData(r,a.zoom,a.textSizeData.coveringZoomRange,"text-size",m.featureProperties);a.addSymbols(a.arrays.glyph,m.glyphQuads,A,B,o["text-keep-upright"],m.textOffset,n,e.angle,m.featureProperties,m.writingModes,m.anchor,I,k,a.placedGlyphArray,m.seq)}if(g&&(e.insertCollisionFeature(x,S,o["icon-ignore-placement"]),S<=i)){var L=getSizeVertexData(r,a.zoom,a.iconSizeData.coveringZoomRange,"icon-size",m.featureProperties);a.addSymbols(a.arrays.icon,m.iconQuads,S,L,o["icon-keep-upright"],m.iconOffset,s,e.angle,m.featureProperties,null,m.anchor,I,k,a.placedIconArray,m.seq)}}}t&&this.addToDebugBuffers(e)},SymtrackingBucket.prototype.addSymbols=function(e,t,a,r,o,i,n,s,l,c,y,p,u,m,h){for(var x=this,d=e.elementArray,g=e.layoutVertexArray,f=e.dynamicLayoutVertexArray,v=this.zoom,A=Math.max(Math.log(a)/Math.LN2+v,0),S=this.glyphOffsetArray.length,b=(y.angle+s+2*Math.PI)%(2*Math.PI),I=b>1*Math.PI/4&&b<=3*Math.PI/4||b>5*Math.PI/4&&b<=7*Math.PI/4,z=Boolean(c&WritingMode.vertical)&&I,k=0,B=t;k<B.length;k+=1){var L=B[k];if(!n||!o||L.writingMode===WritingMode.vertical===z){var V=L.tl,M=L.tr,T=L.bl,_=L.br,P=L.tex,w=e.prepareSegment(4),C=w.vertexLength,E=L.glyphOffset[1];addVertex(g,y.x,y.y,V.x,E+V.y,P.x,P.y,r,h),addVertex(g,y.x,y.y,M.x,E+M.y,P.x+P.w,P.y,r,h),addVertex(g,y.x,y.y,T.x,E+T.y,P.x,P.y+P.h,r,h),addVertex(g,y.x,y.y,_.x,E+_.y,P.x+P.w,P.y+P.h,r,h),addDynamicAttributes(f,y,0,A),d.emplaceBack(C,C+1,C+2),d.emplaceBack(C+1,C+2,C+3),w.vertexLength+=4,w.primitiveLength+=2,x.glyphOffsetArray.emplaceBack(L.glyphOffset[0])}}m.emplaceBack(y.x,y.y,S,this.glyphOffsetArray.length-S,p,u,y.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],A,z),e.populatePaintArrays(l)},SymtrackingBucket.prototype.addToDebugBuffers=function(e){for(var t=this,a=this.arrays.collisionBox,r=a.layoutVertexArray,o=a.elementArray,i=-e.angle,n=e.yStretch,s=0,l=t.symbolInstances;s<l.length;s+=1){var c=l[s];c.textCollisionFeature={boxStartIndex:c.textBoxStartIndex,boxEndIndex:c.textBoxEndIndex},c.iconCollisionFeature={boxStartIndex:c.iconBoxStartIndex,boxEndIndex:c.iconBoxEndIndex};for(var y=0;y<2;y++){var p=c[0===y?"textCollisionFeature":"iconCollisionFeature"];if(p)for(var u=p.boxStartIndex;u<p.boxEndIndex;u++){var m=t.collisionBoxArray.get(u);if(!(1===e.perspectiveRatio&&m.maxScale<1)){var h=m.anchorPoint,x=new Point(m.x1,m.y1*n)._rotate(i),d=new Point(m.x2,m.y1*n)._rotate(i),g=new Point(m.x1,m.y2*n)._rotate(i),f=new Point(m.x2,m.y2*n)._rotate(i),v=Math.max(0,Math.min(25,t.zoom+Math.log(m.maxScale)/Math.LN2)),A=Math.max(0,Math.min(25,t.zoom+Math.log(m.placementScale)/Math.LN2)),S=a.prepareSegment(4),b=S.vertexLength;addCollisionBoxVertex(r,h,c.anchor,x,v,A),addCollisionBoxVertex(r,h,c.anchor,d,v,A),addCollisionBoxVertex(r,h,c.anchor,f,v,A),addCollisionBoxVertex(r,h,c.anchor,g,v,A),o.emplaceBack(b,b+1),o.emplaceBack(b+1,b+2),o.emplaceBack(b+2,b+3),o.emplaceBack(b+3,b),S.vertexLength+=4,S.primitiveLength+=4}}}}},SymtrackingBucket.prototype.addSymbolInstance=function(e,t,a,r,o,i,n,s,l,c,y,p,u,m,h,x,d,g,f,v,A){var S,b,I=[],z=[];for(var k in a){var B=parseInt(k,10);a[B]&&(z=z.concat(i?getGlyphQuads(e,a[B],o,u,f,v):[]),S=new CollisionFeature(n,t,e,s,l,c,a[B],y,p,u,!1))}var L=S?S.boxStartIndex:this.collisionBoxArray.length,V=S?S.boxEndIndex:this.collisionBoxArray.length;r&&(I=i?getIconQuads(e,r,o,d,a[WritingMode.horizontal],f,v):[],b=new CollisionFeature(n,t,e,s,l,c,r,h,x,d,!0));var M=b?b.boxStartIndex:this.collisionBoxArray.length,T=b?b.boxEndIndex:this.collisionBoxArray.length;V>SymtrackingBucket.MAX_INSTANCES&&util.warnOnce("单个瓦片数据量过大"),T>SymtrackingBucket.MAX_INSTANCES&&util.warnOnce("单个瓦片数据量过大");var _=(a[WritingMode.vertical]?WritingMode.vertical:0)|(a[WritingMode.horizontal]?WritingMode.horizontal:0);this.symbolInstances.push({textBoxStartIndex:L,textBoxEndIndex:V,iconBoxStartIndex:M,iconBoxEndIndex:T,glyphQuads:z,iconQuads:I,textOffset:m,iconOffset:g,anchor:e,line:t,featureIndex:s,featureProperties:v,writingModes:_,seq:A})},SymtrackingBucket.programInterfaces=symtrackingInterfaces,SymtrackingBucket.MAX_INSTANCES=65535,SymtrackingBucket.addDynamicAttributes=addDynamicAttributes,module.exports=SymtrackingBucket;
},{"../../_minemap_/point-geometry":41,"../../_minemap_/vector-tile":46,"../../shaders/encode_attribute":103,"../../symbol/anchor":180,"../../symbol/clip_line":182,"../../symbol/collision_feature":184,"../../symbol/get_anchors":186,"../../symbol/mergelines":189,"../../symbol/quads":191,"../../symbol/shaping":192,"../../symbol/transform_text":195,"../../util/classify_rings":220,"../../util/find_pole_of_inaccessibility":228,"../../util/script_detection":238,"../../util/struct_array":241,"../../util/token":243,"../../util/util":244,"../../util/verticalize_punctuation":246,"../array_group":54,"../buffer_group":68,"../element_array_type":69,"../extent":70,"../load_geometry":72}],66:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x<<1|i,t.y<<1|a,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,seq)}var Bucket=_dereq_("../bucket"),createElementArrayType=_dereq_("../element_array_type"),loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,seq=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,trackingInterface={layoutAttributes:[{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],paintAttributes:[{property:"tracking-color"},{property:"tracking-blur"},{property:"tracking-opacity"},{property:"tracking-gap-width",name:"gapwidth"},{property:"tracking-offset"},{property:"tracking-width"},{property:"tracking-width",name:"floorwidth",useIntegerZoom:!0}],elementArrayType:createElementArrayType()},TrackingBucket=function(e){function t(t){e.call(this,t,trackingInterface)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e){var t=this,r=this.layers[0].layout,i=this.layers[0].getLayoutValue("tracking-join",{zoom:this.zoom},e.properties),a=r["tracking-cap"],n=r["tracking-miter-limit"],s=r["tracking-round-limit"];seq=e.properties.link_seq;for(var d=0,o=loadGeometry(e,LINE_DISTANCE_BUFFER_BITS);d<o.length;d+=1){var u=o[d];t.addLine(u,e,i,a,n,s)}},t.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,d=t.properties,o="Polygon"===vectorTileFeatureTypes[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var c=0;c<u-1&&e[c].equals(e[c+1]);)c++;if(!(u<(o?3:2))){"bevel"===r&&(a=1.05);var p=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),l=e[c],h=this.arrays,_=h.prepareSegment(10*u);this.distance=0;var y,m,E,v=i,x=o?"butt":i,C=!0,f=void 0,g=void 0,A=void 0,S=void 0;this.e1=this.e2=this.e3=-1,o&&(y=e[u-2],S=l.sub(y)._unit()._perp());for(var T=c;T<u;T++)if(seq++,!(g=o&&T===u-1?e[c+1]:e[T+1])||!e[T].equals(g)){S&&(A=S),y&&(f=y),y=e[T],S=g?g.sub(y)._unit()._perp():A,A=A||S;var k=A.add(S);0===k.x&&0===k.y||k._unit();var L=k.x*S.x+k.y*S.y,V=0!==L?1/L:1/0,I=L<COS_HALF_SHARP_CORNER&&f&&g;if(I&&T>c){var N=y.dist(f);if(N>2*p){var b=y.sub(y.sub(f)._mult(p/N)._round());s.distance+=b.dist(f),s.addCurrentVertex(b,s.distance,A.mult(1),0,0,!1,_),f=b}}var R=f&&g,q=R?r:g?v:x;if(R&&"round"===q&&(V<n?q="miter":V<=2&&(q="fakeround")),"miter"===q&&V>a&&(q="bevel"),"bevel"===q&&(V>2&&(q="flipbevel"),V<a&&(q="miter")),f&&(s.distance+=y.dist(f)),"miter"===q)k._mult(V),s.addCurrentVertex(y,s.distance,k,0,0,!1,_);else if("flipbevel"===q){if(V>100)k=S.clone().mult(-1);else{var F=A.x*S.y-A.y*S.x>0?-1:1,B=V*A.add(S).mag()/A.sub(S).mag();k._perp()._mult(B*F)}s.addCurrentVertex(y,s.distance,k,0,0,!1,_),s.addCurrentVertex(y,s.distance,k.mult(-1),0,0,!1,_)}else if("bevel"===q||"fakeround"===q){var D=A.x*S.y-A.y*S.x>0,P=-Math.sqrt(V*V-1);if(D?(E=0,m=P):(m=0,E=P),C||s.addCurrentVertex(y,s.distance,A,m,E,!1,_),"fakeround"===q){for(var M=Math.floor(8*(.5-(L-.5))),O=void 0,U=0;U<M;U++)O=S.mult((U+1)/(M+1))._add(A)._unit(),s.addPieSliceVertex(y,s.distance,O,D,_);s.addPieSliceVertex(y,s.distance,k,D,_);for(var X=M-1;X>=0;X--)O=A.mult((X+1)/(M+1))._add(S)._unit(),s.addPieSliceVertex(y,s.distance,O,D,_)}g&&s.addCurrentVertex(y,s.distance,S,-m,-E,!1,_)}else"butt"===q?(C||s.addCurrentVertex(y,s.distance,A,0,0,!1,_),g&&s.addCurrentVertex(y,s.distance,S,0,0,!1,_)):"square"===q?(C||(s.addCurrentVertex(y,s.distance,A,1,1,!1,_),s.e1=s.e2=-1),g&&s.addCurrentVertex(y,s.distance,S,-1,-1,!1,_)):"round"===q&&(C||(s.addCurrentVertex(y,s.distance,A,0,0,!1,_),s.addCurrentVertex(y,s.distance,A,1,1,!0,_),s.e1=s.e2=-1),g&&(s.addCurrentVertex(y,s.distance,S,-1,-1,!0,_),s.addCurrentVertex(y,s.distance,S,0,0,!1,_)));if(I&&T<u-1){var w=y.dist(g);if(w>2*p){var H=y.add(g.sub(y)._mult(p/w)._round());s.distance+=H.dist(y),s.addCurrentVertex(H,s.distance,S.mult(1),0,0,!1,_),y=H}}C=!1}h.populatePaintArrays(d)}},t.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var d,o=n?1:0,u=this.arrays,c=u.layoutVertexArray,p=u.elementArray;d=r.clone(),i&&d._sub(r.perp()._mult(i)),addLineVertex(c,e,d,o,0,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,d=r.mult(-1),a&&d._sub(r.perp()._mult(a)),addLineVertex(c,e,d,o,1,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},t.prototype.addPieSliceVertex=function(e,t,r,i,a){var n=i?1:0;r=r.mult(i?-1:1);var s=this.arrays,d=s.layoutVertexArray,o=s.elementArray;addLineVertex(d,e,r,0,n,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},t}(Bucket);TrackingBucket.programInterface=trackingInterface,module.exports=TrackingBucket;
},{"../../_minemap_/vector-tile":46,"../bucket":55,"../element_array_type":69,"../extent":70,"../load_geometry":72}],67:[function(_dereq_,module,exports){
"use strict";var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Buffer=function(t,r,e,f){this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.attributes=r.members,this.itemSize=r.bytesPerElement,this.type=e,this.arrayType=r,this.dynamicDraw=f};Buffer.fromStructArray=function(t,r){return new Buffer(t.serialize(),t.constructor.serialize(),r)},Buffer.prototype.bind=function(t){var r=t[this.type];this.buffer?(t.bindBuffer(r,this.buffer),this.dynamicDraw&&this.arrayBuffer&&(t.bufferSubData(r,0,this.arrayBuffer),this.arrayBuffer=null)):(this.gl=t,this.buffer=t.createBuffer(),t.bindBuffer(r,this.buffer),t.bufferData(r,this.arrayBuffer,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW),this.arrayBuffer=null)},Buffer.prototype.updateData=function(t){this.arrayBuffer=t.arrayBuffer},Buffer.prototype.enableAttributes=function(t,r){for(var e=this,f=0;f<this.attributes.length;f++){var i=e.attributes[f],a=r[i.name];void 0!==a&&t.enableVertexAttribArray(a)}},Buffer.prototype.setVertexAttribPointers=function(t,r,e){for(var f=this,i=0;i<this.attributes.length;i++){var a=f.attributes[i],u=r[a.name];void 0!==u&&t.vertexAttribPointer(u,a.components,t[AttributeType[a.type]],!1,f.arrayType.bytesPerElement,a.offset+(f.arrayType.bytesPerElement*e||0))}},Buffer.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},Buffer.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},module.exports=Buffer;
},{}],68:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),Buffer=_dereq_("./buffer"),ProgramConfiguration=_dereq_("./program_configuration"),createVertexArrayType=_dereq_("./vertex_array_type"),VertexArrayObject=_dereq_("../render/vertex_array_object"),BufferGroup=function(e,r,t,a){var f=this,y=createVertexArrayType(e.layoutAttributes);if(this.layoutVertexBuffer=new Buffer(a.layoutVertexArray,y.serialize(),Buffer.BufferType.VERTEX),a.dynamicLayoutVertexArray&&e.dynamicLayoutAttributes){var u=createVertexArrayType(e.dynamicLayoutAttributes);this.dynamicLayoutVertexArray=new u(a.dynamicLayoutVertexArray),this.dynamicLayoutVertexBuffer=new Buffer(a.dynamicLayoutVertexArray,u.serialize(),Buffer.BufferType.VERTEX,!0)}a.elementArray&&e.elementArrayType&&(this.elementBuffer=new Buffer(a.elementArray,e.elementArrayType.serialize(),Buffer.BufferType.ELEMENT)),a.elementArray2&&e.elementArrayType2&&(this.elementBuffer2=new Buffer(a.elementArray2,e.elementArrayType2.serialize(),Buffer.BufferType.ELEMENT)),this.layerData={};for(var i=0,n=r;i<n.length;i+=1){var s=n[i],o=a.paintVertexArrays&&a.paintVertexArrays[s.id],l=ProgramConfiguration.createDynamic(e,s,t),m=o?new Buffer(o.array,o.type,Buffer.BufferType.VERTEX):null;f.layerData[s.id]={programConfiguration:l,paintVertexBuffer:m}}this.segments=a.segments,this.segments2=a.segments2;for(var B=0,p=[f.segments,f.segments2];B<p.length;B+=1)for(var c=p[B],A=0,h=c||[];A<h.length;A+=1){var x=h[A];x.vaos=util.mapObject(f.layerData,function(){return new VertexArrayObject})}};BufferGroup.prototype.destroy=function(){var e=this;this.layoutVertexBuffer.destroy(),this.dynamicLayoutVertexBuffer&&this.dynamicLayoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy();for(var r in e.layerData){var t=e.layerData[r].paintVertexBuffer;t&&t.destroy()}for(var a=0,f=[e.segments,e.segments2];a<f.length;a+=1)for(var y=f[a],u=0,i=y||[];u<i.length;u+=1){var n=i[u];for(var s in n.vaos)n.vaos[s].destroy()}},module.exports=BufferGroup;
},{"../render/vertex_array_object":102,"../util/util":244,"./buffer":67,"./program_configuration":74,"./vertex_array_type":76}],69:[function(_dereq_,module,exports){
"use strict";function createElementArrayType(e){return createStructArrayType({members:[{type:"Uint16",name:"vertices",components:e||3}]})}var createStructArrayType=_dereq_("../util/struct_array");module.exports=createElementArrayType;
},{"../util/struct_array":241}],70:[function(_dereq_,module,exports){
"use strict";module.exports=8192;
},{}],71:[function(_dereq_,module,exports){
"use strict";function translateDistance(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function topDownFeatureComparator(e,t){return t-e}function getLineWidth(e,t){return t>0?t+2*e:e}function translate(e,t,r,i,a){if(!t[0]&&!t[1])return e;t=Point.convert(t),"viewport"===r&&t._rotate(-i);for(var n=[],o=0;o<e.length;o++){for(var s=e[o],u=[],l=0;l<s.length;l++)u.push(s[l].sub(t._mult(a)));n.push(u)}return n}function offsetLine(e,t){for(var r=[],i=new Point(0,0),a=0;a<e.length;a++){for(var n=e[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],y=0===s?i:l.sub(u)._unit()._perp(),f=s===n.length-1?i:c.sub(l)._unit()._perp(),d=y._add(f)._unit(),h=d.x*f.x+d.y*f.y;d._mult(1/h),o.push(d._mult(t)._add(l))}r.push(o)}return r}var Point=_dereq_("../_minemap_/point-geometry"),loadGeometry=_dereq_("./load_geometry"),EXTENT=_dereq_("./extent"),featureFilter=_dereq_("../style-spec/feature_filter"),createStructArrayType=_dereq_("../util/struct_array"),Grid=_dereq_("grid-index"),DictionaryCoder=_dereq_("../util/dictionary_coder"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),GeoJSONFeature=_dereq_("../util/vectortile_to_geojson"),arraysIntersect=_dereq_("../util/util").arraysIntersect,intersection=_dereq_("../util/intersection_tests"),multiPolygonIntersectsBufferedMultiPoint=intersection.multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon=intersection.multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine=intersection.multiPolygonIntersectsBufferedMultiLine,FeatureIndexArray=createStructArrayType({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),FeatureIndex=function(e,t,r,i){this.coord=e,this.overscaling=t,this.x=e.x,this.y=e.y,this.z=e.z-Math.log(t)/Math.LN2,this.grid=r||new Grid(EXTENT,16,0),this.featureIndexArray=i||new FeatureIndexArray};FeatureIndex.deserialize=function(e,t,r){var i=new FeatureIndex(e.coord,e.overscaling,new Grid(e.grid),new FeatureIndexArray(e.featureIndexArray));return i.rawTileData=t,i.bucketLayerIDs=e.bucketLayerIDs,i.paintPropertyStatistics=e.paintPropertyStatistics,i.setCollisionTile(r),i},FeatureIndex.prototype.insert=function(e,t,r,i){var a=this,n=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t,r,i);for(var o=loadGeometry(e),s=0;s<o.length;s++){for(var u=o[s],l=[1/0,1/0,-1/0,-1/0],c=0;c<u.length;c++){var y=u[c];l[0]=Math.min(l[0],y.x),l[1]=Math.min(l[1],y.y),l[2]=Math.max(l[2],y.x),l[3]=Math.max(l[3],y.y)}a.grid.insert(n,l[0],l[1],l[2],l[3])}},FeatureIndex.prototype.setCollisionTile=function(e){this.collisionTile=e},FeatureIndex.prototype.serialize=function(e){var t=this.grid.toArrayBuffer();return e&&e.push(t),{coord:this.coord,overscaling:this.overscaling,grid:t,featureIndexArray:this.featureIndexArray.serialize(e),bucketLayerIDs:this.bucketLayerIDs,paintPropertyStatistics:this.paintPropertyStatistics}},FeatureIndex.prototype.query=function(e,t){var r=this;this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers,this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var i={},a=e.params||{},n=EXTENT/e.tileSize/e.scale,o=featureFilter(a.filter),s=0;for(var u in t)if(r.hasLayer(u)){var l=t[u],c=0,y=l.type;if("line"===y||"sprite"===y||"airline"===y||"tracking"===y||"dynamicLine"===y){var f=getLineWidth(r.getPaintValue(y+"-width",l),r.getPaintValue(y+"-gap-width",l)),d=r.getPaintValue(y+"-offset",l),h=r.getPaintValue(y+"-translate",l);c=f/2+Math.abs(d)+translateDistance(h)}else"fill"===y||"extrusion"===y||"histogram"===y?c=translateDistance(r.getPaintValue(y+"-translate",l)):"circle"===y&&(c=r.getPaintValue(y+"-radius",l)+translateDistance(r.getPaintValue(y+"-translate",l)));s=Math.max(s,c*n)}for(var g=e.queryGeometry.map(function(e){return e.map(function(e){return new Point(e.x,e.y)})}),p=1/0,v=1/0,m=-1/0,x=-1/0,I=0;I<g.length;I++)for(var P=g[I],L=0;L<P.length;L++){var M=P[L];p=Math.min(p,M.x),v=Math.min(v,M.y),m=Math.max(m,M.x),x=Math.max(x,M.y)}var _=this.grid.query(p-s,v-s,m+s,x+s);_.sort(topDownFeatureComparator),this.filterMatching(i,_,this.featureIndexArray,g,o,a.layers,t,e.bearing,n);var b=this.collisionTile.queryRenderedSymbols(g,e.scale);return b.sort(),this.filterMatching(i,b,this.collisionTile.collisionBoxArray,g,o,a.layers,t,e.bearing,n),i},FeatureIndex.prototype.filterMatching=function(e,t,r,i,a,n,o,s,u){for(var l,c=this,y=0;y<t.length;y++){var f=t[y];if(f!==l){l=f;var d=r.get(f),h=c.bucketLayerIDs[d.bucketIndex];if(!n||arraysIntersect(n,h)){var g=c.sourceLayerCoder.decode(d.sourceLayerIndex),p=c.vtLayers[g],v=p.feature(d.featureIndex);if(a(v))for(var m=null,x=0;x<h.length;x++){var I=h[x];if(!(n&&n.indexOf(I)<0)){var P=o[I];if(P){var L=void 0,M=P.type;if("symbol"!==M&&"symtracking"!==M)if(m||(m=loadGeometry(v)),"line"===M||"sprite"===M||"airline"===M||"tracking"===M||"dynamicLine"===M){L=translate(i,c.getPaintValue(M+"-translate",P,v),c.getPaintValue(M+"-translate-anchor",P,v),s,u);var _=u/2*getLineWidth(c.getPaintValue(M+"-width",P,v),c.getPaintValue(M+"-gap-width",P,v)),b=c.getPaintValue(M+"-offset",P,v);if(b&&(m=offsetLine(m,b*u)),!multiPolygonIntersectsBufferedMultiLine(L,m,_))continue}else if("fill"===M||"extrusion"===M||"histogram"===M){if(L=translate(i,c.getPaintValue(M+"-translate",P,v),c.getPaintValue(M+"-translate-anchor",P,v),s,u),!multiPolygonIntersectsMultiPolygon(L,m))continue}else if("circle"===M){L=translate(i,c.getPaintValue(M+"-translate",P,v),c.getPaintValue(M+"-translate-anchor",P,v),s,u);var F=c.getPaintValue(M+"-radius",P,v)*u;if(!multiPolygonIntersectsBufferedMultiPoint(L,m,F))continue}var V=new GeoJSONFeature(v,c.z,c.x,c.y);V.layer=P.serialize();var w=e[I];void 0===w&&(w=e[I]=[]),w.push({featureIndex:f,feature:V})}}}}}}},FeatureIndex.prototype.hasLayer=function(e){for(var t=this,r=0,i=t.bucketLayerIDs;r<i.length;r+=1)for(var a=i[r],n=0,o=a;n<o.length;n+=1){var s=o[n];if(e===s)return!0}return!1},FeatureIndex.prototype.getPaintValue=function(e,t,r){if(t.isPaintValueFeatureConstant(e)||r){var i=r?r.properties:{};return t.getPaintValue(e,{zoom:this.z},i)}return this.paintPropertyStatistics[t.id][e].max},module.exports=FeatureIndex;
},{"../_minemap_/point-geometry":41,"../_minemap_/vector-tile":46,"../style-spec/feature_filter":129,"../util/dictionary_coder":222,"../util/intersection_tests":233,"../util/struct_array":241,"../util/util":244,"../util/vectortile_to_geojson":245,"./extent":70,"./load_geometry":72,"grid-index":4,"pbf":18}],72:[function(_dereq_,module,exports){
"use strict";function createBounds(e){return{min:-1*Math.pow(2,e-1),max:Math.pow(2,e-1)-1}}var util=_dereq_("../util/util"),EXTENT=_dereq_("./extent"),boundsLookup={15:createBounds(15),16:createBounds(16)};module.exports=function(e,t){for(var r=boundsLookup[t||16],o=EXTENT/e.extent,u=e.loadGeometry(),n=0;n<u.length;n++)for(var a=u[n],i=0;i<a.length;i++){var d=a[i];d.x=Math.round(d.x*o),d.y=Math.round(d.y*o),(d.x<r.min||d.x>r.max||d.y<r.min||d.y>r.max)&&util.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u};
},{"../util/util":244,"./extent":70}],73:[function(_dereq_,module,exports){
"use strict";var createStructArrayType=_dereq_("../util/struct_array"),PosArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2}]});module.exports=PosArray;
},{"../util/struct_array":241}],74:[function(_dereq_,module,exports){
"use strict";function packColor(t,o){return o?[packUint8ToFloat(t[0],t[1]),packUint8ToFloat(t[2],t[3])]:[packUint8ToFloat(255*t[0],255*t[1]),packUint8ToFloat(255*t[2],255*t[3])]}var createVertexArrayType=_dereq_("./vertex_array_type"),interpolationFactor=_dereq_("../style-spec/function").interpolationFactor,packUint8ToFloat=_dereq_("../shaders/encode_attribute").packUint8ToFloat,ConstantBinder=function(t,o,r,e){this.name=t,this.type=o,this.property=r,this.useIntegerZoom=e};ConstantBinder.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},ConstantBinder.prototype.populatePaintArray=function(){},ConstantBinder.prototype.setUniforms=function(t,o,r,e){var n=e.zoom,i=r.getPaintValue(this.property,{zoom:this.useIntegerZoom?Math.floor(n):n});"color"===this.type?t.uniform4fv(o["u_"+this.name],i):t.uniform1f(o["u_"+this.name],i)};var SourceFunctionBinder=function(t,o,r){this.name=t,this.type=o,this.property=r};SourceFunctionBinder.prototype.defines=function(){return[]},SourceFunctionBinder.prototype.populatePaintArray=function(t,o,r,e,n,i){var a=this,s=t.getPaintValue(this.property,void 0,i);if("color"===this.type)for(var p=packColor(s,"color"!==this.name&&"fill_color"!==this.name),c=e;c<n;c++){var u=o.get(c);u["a_"+a.name+"0"]=p[0],u["a_"+a.name+"1"]=p[1]}else{for(var m=e;m<n;m++){o.get(m)["a_"+a.name]=s}var f=r[this.property];f.max=Math.max(f.max,s)}},SourceFunctionBinder.prototype.setUniforms=function(t,o){t.uniform1f(o["a_"+this.name+"_t"],0)};var CompositeFunctionBinder=function(t,o,r,e,n){this.name=t,this.type=o,this.property=r,this.useIntegerZoom=e,this.zoom=n};CompositeFunctionBinder.prototype.defines=function(){return[]},CompositeFunctionBinder.prototype.populatePaintArray=function(t,o,r,e,n,i){var a=this,s=t.getPaintValue(this.property,{zoom:this.zoom},i),p=t.getPaintValue(this.property,{zoom:this.zoom+1},i);if("color"===this.type)for(var c=packColor(s),u=packColor(p),m=e;m<n;m++){var f=o.get(m);f["a_"+a.name+"0"]=c[0],f["a_"+a.name+"1"]=c[1],f["a_"+a.name+"2"]=u[0],f["a_"+a.name+"3"]=u[1]}else{for(var y=e;y<n;y++){var h=o.get(y);h["a_"+a.name+"0"]=s,h["a_"+a.name+"1"]=p}var l=r[this.property];l.max=Math.max(l.max,s,p)}},CompositeFunctionBinder.prototype.setUniforms=function(t,o,r,e){var n=e.zoom,i=interpolationFactor(this.useIntegerZoom?Math.floor(n):n,1,this.zoom,this.zoom+1);t.uniform1f(o["a_"+this.name+"_t"],i)};var ProgramConfiguration=function(){this.binders={},this.cacheKey=""};ProgramConfiguration.createDynamic=function(t,o,r){for(var e=new ProgramConfiguration,n=[],i=0,a=t.paintAttributes||[];i<a.length;i+=1){var s=a[i],p=s.property,c=s.useIntegerZoom||!1,u=s.name||p.replace(o.type+"-","").replace(/-/g,"_"),m=o._paintSpecifications[p].type;o.isPaintValueFeatureConstant(p)?(e.binders[u]=new ConstantBinder(u,m,p,c),e.cacheKey+="/u_"+u):o.isPaintValueZoomConstant(p)?(e.binders[u]=new SourceFunctionBinder(u,m,p),e.cacheKey+="/a_"+u,n.push({name:"a_"+u,type:"Float32",components:"color"===m?2:1})):(e.binders[u]=new CompositeFunctionBinder(u,m,p,c,r),e.cacheKey+="/z_"+u,n.push({name:"a_"+u,type:"Float32",components:"color"===m?4:2}))}return e.PaintVertexArray=createVertexArrayType(n),e.interface=t,e},ProgramConfiguration.createBasicFill=function(){var t=new ProgramConfiguration;return t.binders.color=new ConstantBinder("color","color","fill-color",!1),t.cacheKey+="/u_color",t.binders.opacity=new ConstantBinder("opacity","number","fill-opacity",!1),t.cacheKey+="/u_opacity",t},ProgramConfiguration.prototype.createPaintPropertyStatistics=function(){var t=this,o={};for(var r in t.binders)o[t.binders[r].property]={max:-1/0};return o},ProgramConfiguration.prototype.populatePaintArray=function(t,o,r,e,n){var i=this,a=o.length;o.resize(e);for(var s in i.binders)i.binders[s].populatePaintArray(t,o,r,a,e,n)},ProgramConfiguration.prototype.defines=function(){var t=this,o=[];for(var r in t.binders)o.push.apply(o,t.binders[r].defines());return o},ProgramConfiguration.prototype.setUniforms=function(t,o,r,e){var n=this;for(var i in n.binders)n.binders[i].setUniforms(t,o,r,e)},module.exports=ProgramConfiguration;
},{"../shaders/encode_attribute":103,"../style-spec/function":131,"./vertex_array_type":76}],75:[function(_dereq_,module,exports){
"use strict";var createStructArrayType=_dereq_("../util/struct_array"),RasterBoundsArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});module.exports=RasterBoundsArray;
},{"../util/struct_array":241}],76:[function(_dereq_,module,exports){
"use strict";function createVertexArrayType(r){return createStructArrayType({members:r,alignment:4})}var createStructArrayType=_dereq_("../util/struct_array");module.exports=createVertexArrayType;
},{"../util/struct_array":241}],77:[function(_dereq_,module,exports){
"use strict";var Coordinate=function(o,t,n){this.column=o,this.row=t,this.zoom=n};Coordinate.prototype.clone=function(){return new Coordinate(this.column,this.row,this.zoom)},Coordinate.prototype.zoomTo=function(o){return this.clone()._zoomTo(o)},Coordinate.prototype.sub=function(o){return this.clone()._sub(o)},Coordinate.prototype._zoomTo=function(o){var t=Math.pow(2,o-this.zoom);return this.column*=t,this.row*=t,this.zoom=o,this},Coordinate.prototype._sub=function(o){return o=o.zoomTo(this.zoom),this.column-=o.column,this.row-=o.row,this},module.exports=Coordinate;
},{}],78:[function(_dereq_,module,exports){
"use strict";var wrap=_dereq_("../util/util").wrap,LngLat=function(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: ("+t+", "+n+")");if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};LngLat.prototype.wrap=function(){return new LngLat(wrap(this.lng,-180,180),this.lat)},LngLat.prototype.wrapToBestWorld=function(t){var n=new LngLat(this.lng,this.lat);return Math.abs(this.lng-t.lng)>180&&(t.lng<0?n.lng-=360:n.lng+=360),n},LngLat.prototype.toArray=function(){return[this.lng,this.lat]},LngLat.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},LngLat.prototype.toBounds=function(t){var n=360*t/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new(_dereq_("./lng_lat_bounds"))(new LngLat(this.lng-a,this.lat-n),new LngLat(this.lng+a,this.lat+n))},LngLat.convert=function(t){if(t instanceof LngLat)return t;if(Array.isArray(t)&&2===t.length)return new LngLat(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new LngLat(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},module.exports=LngLat;
},{"../util/util":244,"./lng_lat_bounds":79}],79:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("./lng_lat"),LngLatBounds=function(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};LngLatBounds.prototype.setNorthEast=function(t){return this._ne=t instanceof LngLat?new LngLat(t.lng,t.lat):LngLat.convert(t),this},LngLatBounds.prototype.setSouthWest=function(t){return this._sw=t instanceof LngLat?new LngLat(t.lng,t.lat):LngLat.convert(t),this},LngLatBounds.prototype.extend=function(t){var n,e,s=this._sw,o=this._ne;if(t instanceof LngLat)n=t,e=t;else{if(!(t instanceof LngLatBounds))return Array.isArray(t)?t.every(Array.isArray)?this.extend(LngLatBounds.convert(t)):this.extend(LngLat.convert(t)):this;if(n=t._sw,e=t._ne,!n||!e)return this}return s||o?(s.lng=Math.min(n.lng,s.lng),s.lat=Math.min(n.lat,s.lat),o.lng=Math.max(e.lng,o.lng),o.lat=Math.max(e.lat,o.lat)):(this._sw=new LngLat(n.lng,n.lat),this._ne=new LngLat(e.lng,e.lat)),this},LngLatBounds.prototype.getCenter=function(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},LngLatBounds.prototype.getSouthWest=function(){return this._sw},LngLatBounds.prototype.getNorthEast=function(){return this._ne},LngLatBounds.prototype.getNorthWest=function(){return new LngLat(this.getWest(),this.getNorth())},LngLatBounds.prototype.getSouthEast=function(){return new LngLat(this.getEast(),this.getSouth())},LngLatBounds.prototype.getWest=function(){return this._sw.lng},LngLatBounds.prototype.getSouth=function(){return this._sw.lat},LngLatBounds.prototype.getEast=function(){return this._ne.lng},LngLatBounds.prototype.getNorth=function(){return this._ne.lat},LngLatBounds.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},LngLatBounds.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},LngLatBounds.convert=function(t){return!t||t instanceof LngLatBounds?t:new LngLatBounds(t)},module.exports=LngLatBounds;
},{"./lng_lat":78}],80:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("./lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),Coordinate=_dereq_("./coordinate"),util=_dereq_("../util/util"),interp=_dereq_("../style-spec/util/interpolate"),TileCoord=_dereq_("../source/tile_coord"),EXTENT=_dereq_("../data/extent"),glmatrix=_dereq_("../_minemap_/gl-matrix"),vec4=glmatrix.vec4,mat4=glmatrix.mat4,mat2=glmatrix.mat2,Transform=function(t,i,o){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},prototypeAccessors={minZoom:{},maxZoom:{},renderWorldCopies:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};prototypeAccessors.minZoom.get=function(){return this._minZoom},prototypeAccessors.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},prototypeAccessors.maxZoom.get=function(){return this._maxZoom},prototypeAccessors.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},prototypeAccessors.renderWorldCopies.get=function(){return this._renderWorldCopies},prototypeAccessors.worldSize.get=function(){return this.tileSize*this.scale},prototypeAccessors.centerPoint.get=function(){return this.size._div(2)},prototypeAccessors.size.get=function(){return new Point(this.width,this.height)},prototypeAccessors.bearing.get=function(){return-this.angle/Math.PI*180},prototypeAccessors.bearing.set=function(t){var i=-util.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},prototypeAccessors.pitch.get=function(){return this._pitch/Math.PI*180},prototypeAccessors.pitch.set=function(t){var i=util.clamp(t,0,60)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},prototypeAccessors.fov.get=function(){return this._fov/Math.PI*180},prototypeAccessors.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},prototypeAccessors.zoom.get=function(){return this._zoom},prototypeAccessors.zoom.set=function(t){var i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom,this._constrain(),this._calcMatrices())},prototypeAccessors.center.get=function(){return this._center},prototypeAccessors.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Transform.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},Transform.prototype.getVisibleWrappedCoordinates=function(t){for(var i=this.pointCoordinate(new Point(0,0),0),o=this.pointCoordinate(new Point(this.width,0),0),e=Math.floor(i.column),r=Math.floor(o.column),n=[t],s=e;s<=r;s++)0!==s&&n.push(new TileCoord(t.z,t.x,t.y,s));return n},Transform.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),o=i;if(i<t.minzoom)return[];i>t.maxzoom&&(i=t.maxzoom);var e=this.pointCoordinate(this.centerPoint,i),r=new Point(e.column-.5,e.row-.5),n=[this.pointCoordinate(new Point(0,0),i),this.pointCoordinate(new Point(this.width,0),i),this.pointCoordinate(new Point(this.width,this.height),i),this.pointCoordinate(new Point(0,this.height),i)];return TileCoord.cover(i,n,t.reparseOverscaled?o:i,this._renderWorldCopies).sort(function(t,i){return r.dist(t)-r.dist(i)})},Transform.prototype.resize=function(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()},prototypeAccessors.unmodified.get=function(){return this._unmodified},Transform.prototype.zoomScale=function(t){return Math.pow(2,t)},Transform.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Transform.prototype.project=function(t){return new Point(this.lngX(t.lng),this.latY(t.lat))},Transform.prototype.unproject=function(t){return new LngLat(this.xLng(t.x),this.yLat(t.y))},prototypeAccessors.x.get=function(){return this.lngX(this.center.lng)},prototypeAccessors.y.get=function(){return this.latY(this.center.lat)},prototypeAccessors.point.get=function(){return new Point(this.x,this.y)},Transform.prototype.lngX=function(t){return(180+t)*this.worldSize/360},Transform.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},Transform.prototype.xLng=function(t){return 360*t/this.worldSize-180},Transform.prototype.yLat=function(t){var i=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90},Transform.prototype.setLocationAtPoint=function(t,i){var o=this.pointCoordinate(i)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(o)),this._renderWorldCopies&&(this.center=this.center.wrap())},Transform.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Transform.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Transform.prototype.locationCoordinate=function(t){return new Coordinate(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},Transform.prototype.coordinateLocation=function(t){var i=t.zoomTo(this.zoom);return new LngLat(this.xLng(i.column*this.tileSize),this.yLat(i.row*this.tileSize))},Transform.prototype.pointCoordinate=function(t,i){void 0===i&&(i=this.tileZoom);var o=[t.x,t.y,0,1],e=[t.x,t.y,1,1];vec4.transformMat4(o,o,this.pixelMatrixInverse),vec4.transformMat4(e,e,this.pixelMatrixInverse);var r=o[3],n=e[3],s=o[0]/r,a=e[0]/n,h=o[1]/r,c=e[1]/n,m=o[2]/r,p=e[2]/n,l=m===p?0:(0-m)/(p-m);return new Coordinate(interp(s,a,l)/this.tileSize,interp(h,c,l)/this.tileSize,this.zoom)._zoomTo(i)},Transform.prototype.coordinatePoint=function(t){var i=t.zoomTo(this.zoom),o=[i.column*this.tileSize,i.row*this.tileSize,0,1];return vec4.transformMat4(o,o,this.pixelMatrix),new Point(o[0]/o[3],o[1]/o[3])},Transform.prototype.calculatePosMatrix=function(t,i){var o=t.toCoordinate(i),e=this.worldSize/this.zoomScale(o.zoom),r=mat4.identity(new Float64Array(16));return mat4.translate(r,r,[o.column*e,o.row*e,0]),mat4.scale(r,r,[e/EXTENT,e/EXTENT,1]),mat4.multiply(r,this.projMatrix,r),new Float32Array(r)},Transform.prototype.cameraToTileDistance=function(t){var i=this.calculatePosMatrix(t.coord,t.sourceMaxZoom),o=[t.tileSize/2,t.tileSize/2,0,1];return vec4.transformMat4(o,o,i),o[3]},Transform.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,i,o,e,r=-90,n=90,s=-180,a=180,h=this.size,c=this._unmodified;if(this.latRange){var m=this.latRange;r=this.latY(m[1]),n=this.latY(m[0]),t=n-r<h.y?h.y/(n-r):0}if(this.lngRange){var p=this.lngRange;s=this.lngX(p[0]),a=this.lngX(p[1]),i=a-s<h.x?h.x/(a-s):0}var l=Math.max(i||0,t||0);if(l)return this.center=this.unproject(new Point(i?(a+s)/2:this.x,t?(n+r)/2:this.y)),this.zoom+=this.scaleZoom(l),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var u=this.y,f=h.y/2;u-f<r&&(e=r+f),u+f>n&&(e=n-f)}if(this.lngRange){var d=this.x,g=h.x/2;d-g<s&&(o=s+g),d+g>a&&(o=a-g)}void 0===o&&void 0===e||(this.center=this.unproject(new Point(void 0!==o?o:this.x,void 0!==e?e:this.y))),this._unmodified=c,this._constraining=!1}},Transform.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,i=Math.PI/2+this._pitch,o=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),e=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,r=1.01*e,n=new Float64Array(16);mat4.perspective(n,this._fov,this.width/this.height,1,r),mat4.scale(n,n,[1,-1,1]),mat4.translate(n,n,[0,0,-this.cameraToCenterDistance]),mat4.rotateX(n,n,this._pitch),mat4.rotateZ(n,n,this.angle),mat4.translate(n,n,[-this.x,-this.y,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(mat4.scale(n,n,[1,1,s,1]),this.projMatrix=n,n=mat4.create(),mat4.scale(n,n,[this.width/2,-this.height/2,1]),mat4.translate(n,n,[1,-1,0]),this.pixelMatrix=mat4.multiply(new Float64Array(16),n,this.projMatrix),!(n=mat4.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=n}},Object.defineProperties(Transform.prototype,prototypeAccessors),module.exports=Transform;
},{"../_minemap_/gl-matrix":39,"../_minemap_/point-geometry":41,"../data/extent":70,"../source/tile_coord":120,"../style-spec/util/interpolate":137,"../util/util":244,"./coordinate":77,"./lng_lat":78}],81:[function(_dereq_,module,exports){
"use strict";var supported=_dereq_("./_minemap_/minemap-supported"),browser=_dereq_("./util/browser"),version=_dereq_("../package.json").version,Map=_dereq_("./ui/map"),Navigation=_dereq_("./ui/control/navigation_control"),Geolocate=_dereq_("./ui/control/geolocate_control"),Attribution=_dereq_("./ui/control/attribution_control"),LogoControl=_dereq_("./ui/control/logo_control"),Scale=_dereq_("./ui/control/scale_control"),Fullscreen=_dereq_("./ui/control/fullscreen_control"),Popup=_dereq_("./ui/popup"),Marker=_dereq_("./ui/marker"),Style=_dereq_("./style/style"),LngLat=_dereq_("./geo/lng_lat"),LngLatBounds=_dereq_("./geo/lng_lat_bounds"),Point=_dereq_("./_minemap_/point-geometry"),Evented=_dereq_("./util/evented"),config=_dereq_("./util/config"),service=_dereq_("./util/service"),IndoorMap=_dereq_("./util/indoor/indoormap"),util={getJSON:_dereq_("./util/ajax").getJSON,getArrayBuffer:_dereq_("./util/ajax").getArrayBuffer};module.exports={version:version,supported:supported,workerCount:Math.max(Math.floor(browser.hardwareConcurrency/2),1),Map:Map,Navigation:Navigation,Geolocate:Geolocate,Attribution:Attribution,LogoControl:LogoControl,Scale:Scale,Fullscreen:Fullscreen,Popup:Popup,Marker:Marker,Style:Style,LngLat:LngLat,LngLatBounds:LngLatBounds,Point:Point,Evented:Evented,config:config,util:util,service:service,IndoorMap:IndoorMap,get accessToken(){return config.ACCESS_TOKEN},set accessToken(e){config.ACCESS_TOKEN=e},get solution(){return config.SOLU},set solution(e){config.SOLU=e},get dataVersion(){return config.DATA_VERSION},set dataVersion(e){config.DATA_VERSION=e},get TRW(){return config.TRW},set TRW(e){config.TRW=e},get spriteUrl(){return config.spriteUrl},set spriteUrl(e){config.spriteUrl=e},get fontsUrl(){return config.fontsUrl},set fontsUrl(e){config.fontsUrl=e},get serviceUrl(){return config.SERVICE_URL},set serviceUrl(e){config.SERVICE_URL=e},get domainUrl(){return config.DOMAIN},set domainUrl(e){config.DOMAIN=e,config.SRC_URL=config.DOMAIN+config.SRC_BASE,config.SERVICE_URL=config.DOMAIN+config.SERVICE_BASE},get dataDomainUrl(){return config.DATA_DOMAIN},set dataDomainUrl(e){config.DATA_DOMAIN=e,config.API_URL=config.DATA_DOMAIN+config.API_BASE,config.DYN_URL=config.DATA_DOMAIN+config.DYN_BASE,config.MERGE_URL=config.DATA_DOMAIN+config.MERGE_BASE,config.OTHER_URL=config.DATA_DOMAIN+config.OTHER_BASE}};
},{"../package.json":27,"./_minemap_/minemap-supported":40,"./_minemap_/point-geometry":41,"./geo/lng_lat":78,"./geo/lng_lat_bounds":79,"./style/style":163,"./ui/control/attribution_control":198,"./ui/control/fullscreen_control":199,"./ui/control/geolocate_control":200,"./ui/control/logo_control":201,"./ui/control/navigation_control":202,"./ui/control/scale_control":203,"./ui/map":212,"./ui/marker":213,"./ui/popup":214,"./util/ajax":216,"./util/browser":217,"./util/config":221,"./util/evented":226,"./util/indoor/indoormap":232,"./util/service":239}],82:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,r,t,i,a,n,T,u,o,f){var E=r.gl;(u||o)&&E.uniform2f(e.u_gl_units_to_pixels,1/r.transform.pixelsToGLUnits[0],1/r.transform.pixelsToGLUnits[1]),r.enableTileClippingMask(n);var s=r.translatePosMatrix(n.posMatrix,t,a.paint["airline-translate"],a.paint["airline-translate-anchor"]);E.uniformMatrix4fv(e.u_matrix,!1,s),E.uniform1f(e.u_ratio,1/pixelsToTileUnits(t,1,r.transform.zoom)),E.uniform1f(e.u_start,f-segmentGroup),E.uniform1f(e.u_segments,segmentGroup),E.uniform1f(e.u_discard,discardLine);for(var m=0,l=i.segments;m<l.length;m+=1){var _=l[m];_.vaos[a.id].bind(E,e,i.layoutVertexBuffer,i.elementBuffer,T.paintVertexBuffer,_.vertexOffset),E.drawElements(E.TRIANGLES,3*_.primitiveLength,E.UNSIGNED_SHORT,3*_.primitiveOffset*2)}}function renderToTexture(e,r){e.activeTexture(e.TEXTURE1);var t=r.viewportTexture;t?e.bindTexture(e.TEXTURE_2D,t):(t=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),r.viewportTexture=t);var i=r.viewportFbo;if(i)e.bindFramebuffer(e.FRAMEBUFFER,i);else{i=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,i);var a=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),r.viewportFbo=i}return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),t}function renderTextureToMap(e,r,t,i){var a=r.useProgram("extrusionTexture");e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.uniform1f(a.u_opacity,t.paint["airline-opacity"]),e.uniform1i(a.u_image,1);var n=mat4.create();mat4.ortho(n,0,r.width,r.height,0,0,1),e.uniformMatrix4fv(a.u_matrix,!1,n),e.disable(e.DEPTH_TEST),e.uniform2f(a.u_world,e.drawingBufferWidth,e.drawingBufferHeight);var T=new PosArray;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1);var u=Buffer.fromStructArray(T,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(e,a,u),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.DEPTH_TEST)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),glMatrix=_dereq_("../_minemap_/gl-matrix"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),PosArray=_dereq_("../data/pos_array"),mat4=glMatrix.mat4,segmentGroup=20,discardLine=0;module.exports=function(e,r,t,i){var a=this;if(!e.isOpaquePass){var n=e.gl;n.disable(n.STENCIL_TEST),n.enable(n.DEPTH_TEST),e.depthMask(!0);var T=renderToTexture(n,e);if(n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),!(t.paint["airline-width"]<=0)){segmentGroup=t.paint["airline-seg-group"]||20,discardLine="none"===t.paint["airline-type"]?0:1,"real-time"===t.paint["airline-type"]&&(this.count||(this.start=(new Date).getTime(),this.count=1),this.end=(new Date).getTime(),this.end-this.start>=1e3/t.paint["airline-speed"]&&(this.count+=1,this.start=this.end));for(var u,o=!0,f=0,E=i;f<E.length;f+=1){var s=E[f],m=r.getTile(s),l=m.getBucket(t);if(l){var _=l.buffers.layerData[t.id],R=e.currentProgram,d=e.useProgram("airline",_.programConfiguration),p=o||d!==R,x=u!==m.coord.z;p&&_.programConfiguration.setUniforms(e.gl,d,t,{zoom:e.transform.zoom}),drawLineTile(d,e,m,l.buffers,t,s,_,p,x,a.count),u=m.coord.z,o=!1}}n.bindFramebuffer(n.FRAMEBUFFER,null),renderTextureToMap(n,e,t,T)}}};
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/pos_array":73,"../source/pixels_to_tile_units":111,"../util/browser":217,"./vertex_array_object":102}],83:[function(_dereq_,module,exports){
"use strict";function drawBackground(r,t,e){var a=r.gl,i=r.transform,n=i.tileSize,o=e.paint["background-color"],l=e.paint["background-pattern"],u=e.paint["background-opacity"],f=!l&&1===o[3]&&1===u;if(r.isOpaquePass===f){a.disable(a.STENCIL_TEST),r.setDepthSublayer(0);var s;if(l){if(pattern.isPatternMissing(l,r))return;s=r.useProgram("fillPattern",r.basicFillProgramConfiguration),pattern.prepare(l,r,s),r.tileExtentPatternVAO.bind(a,s,r.tileExtentBuffer)}else s=r.useProgram("fill",r.basicFillProgramConfiguration),a.uniform4fv(s.u_color,o),r.tileExtentVAO.bind(a,s,r.tileExtentBuffer);a.uniform1f(s.u_opacity,u);for(var c=i.coveringTiles({tileSize:n}),g=0,p=c;g<p.length;g+=1){var d=p[g];l&&pattern.setTile({coord:d,tileSize:n},r,s),a.uniformMatrix4fv(s.u_matrix,!1,r.transform.calculatePosMatrix(d)),a.drawArrays(a.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}}}var pattern=_dereq_("./pattern");module.exports=drawBackground;
},{"./pattern":101}],84:[function(_dereq_,module,exports){
"use strict";function drawCircles(e,r,i,t){if(!e.isOpaquePass){var a=e.gl;e.setDepthSublayer(0),e.depthMask(!1),a.disable(a.STENCIL_TEST);for(var s=0;s<t.length;s++){var o=t[s],n=r.getTile(o),f=n.getBucket(i);if(f){var l=f.buffers,u=l.layerData[i.id],m=u.programConfiguration,c=e.useProgram("circle",m);if(m.setUniforms(a,c,i,{zoom:e.transform.zoom}),a.uniform1f(c.u_camera_to_center_distance,e.transform.cameraToCenterDistance),a.uniform1i(c.u_scale_with_map,"map"===i.paint["circle-pitch-scale"]),"map"===i.paint["circle-pitch-alignment"]){a.uniform1i(c.u_pitch_with_map,!0);var p=pixelsToTileUnits(n,1,e.transform.zoom);a.uniform2f(c.u_extrude_scale,p,p)}else a.uniform1i(c.u_pitch_with_map,!1),a.uniform2fv(c.u_extrude_scale,e.transform.pixelsToGLUnits);a.uniform1f(c.u_devicepixelratio,browser.devicePixelRatio),a.uniformMatrix4fv(c.u_matrix,!1,e.translatePosMatrix(o.posMatrix,n,i.paint["circle-translate"],i.paint["circle-translate-anchor"]));for(var _=0,v=l.segments;_<v.length;_+=1){var x=v[_];x.vaos[i.id].bind(a,c,l.layoutVertexBuffer,l.elementBuffer,u.paintVertexBuffer,x.vertexOffset),a.drawElements(a.TRIANGLES,3*x.primitiveLength,a.UNSIGNED_SHORT,3*x.primitiveOffset*2)}}}}}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units");module.exports=drawCircles;
},{"../source/pixels_to_tile_units":111,"../util/browser":217}],85:[function(_dereq_,module,exports){
"use strict";function drawCollisionDebug(e,r,i,o){var t=e.gl;t.enable(t.STENCIL_TEST);var a=e.useProgram("collisionBox");t.activeTexture(t.TEXTURE1),e.frameHistory.bind(t),t.uniform1i(a.u_fadetexture,1);for(var n=0;n<o.length;n++){var f=o[n],l=r.getTile(f),m=l.getBucket(i);if(m){var u=m.buffers.collisionBox;if(u){t.uniformMatrix4fv(a.u_matrix,!1,f.posMatrix),e.enableTileClippingMask(f),e.lineWidth(1),t.uniform1f(a.u_scale,Math.pow(2,e.transform.zoom-l.coord.z)),t.uniform1f(a.u_zoom,10*e.transform.zoom);var s=Math.max(0,Math.min(25,l.coord.z+Math.log(l.collisionTile.maxScale)/Math.LN2));t.uniform1f(a.u_maxzoom,10*s),t.uniform1f(a.u_collision_y_stretch,l.collisionTile.yStretch),t.uniform1f(a.u_pitch,e.transform.pitch/360*2*Math.PI),t.uniform1f(a.u_camera_to_center_distance,e.transform.cameraToCenterDistance);for(var c=0,_=u.segments;c<_.length;c+=1){var h=_[c];h.vaos[i.id].bind(t,a,u.layoutVertexBuffer,u.elementBuffer,null,h.vertexOffset),t.drawElements(t.LINES,2*h.primitiveLength,t.UNSIGNED_SHORT,2*h.primitiveOffset*2)}}}}}module.exports=drawCollisionDebug;
},{}],86:[function(_dereq_,module,exports){
"use strict";function drawDebug(r,e,a){for(var t=0;t<a.length;t++)drawDebugTile(r,e,a[t])}function drawDebugTile(r,e,a){var t=r.gl;t.disable(t.STENCIL_TEST),r.lineWidth(1*browser.devicePixelRatio);var i=a.posMatrix,u=r.useProgram("debug");t.uniformMatrix4fv(u.u_matrix,!1,i),t.uniform4f(u.u_color,1,0,0,1),r.debugVAO.bind(t,u,r.debugBuffer),t.drawArrays(t.LINE_STRIP,0,r.debugBuffer.length);for(var o=createTextVerticies(a.toString(),50,200,5),f=new PosArray,n=0;n<o.length;n+=2)f.emplaceBack(o[n],o[n+1]);var l=Buffer.fromStructArray(f,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(t,u,l),t.uniform4f(u.u_color,1,1,1,1);for(var m=e.getTile(a).tileSize,s=EXTENT/(Math.pow(2,r.transform.zoom-a.z)*m),g=[[-1,-1],[-1,1],[1,-1],[1,1]],d=0;d<g.length;d++){var x=g[d];t.uniformMatrix4fv(u.u_matrix,!1,mat4.translate([],i,[s*x[0],s*x[1],0])),t.drawArrays(t.LINES,0,l.length)}t.uniform4f(u.u_color,0,0,0,1),t.uniformMatrix4fv(u.u_matrix,!1,i),t.drawArrays(t.LINES,0,l.length)}function createTextVerticies(r,e,a,t){t=t||1;var i,u,o,f,n,l,m,s,g=[];for(i=0,u=r.length;i<u;i++)if(n=simplexFont[r[i]]){for(s=null,o=0,f=n[1].length;o<f;o+=2)-1===n[1][o]&&-1===n[1][o+1]?s=null:(l=e+n[1][o]*t,m=a-n[1][o+1]*t,s&&g.push(s.x,s.y,l,m),s={x:l,y:m});e+=n[0]*t}return g}var browser=_dereq_("../util/browser"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,EXTENT=_dereq_("../data/extent"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),PosArray=_dereq_("../data/pos_array");module.exports=drawDebug;var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/extent":70,"../data/pos_array":73,"../util/browser":217,"./vertex_array_object":102}],87:[function(_dereq_,module,exports){
"use strict";function drawLineTile(i,t,e,r,n,a,o,s,f,u){var l,m,p,_,d=t.gl,g=n.paint["dynamicLine-dasharray"],c=n.paint["dynamicLine-pattern"];if(s||f){var h=1/pixelsToTileUnits(e,1,t.transform.tileZoom);if(g){l=t.lineAtlas.getDash(g.from,"round"===n.layout["dynamicLine-cap"]),m=t.lineAtlas.getDash(g.to,"round"===n.layout["dynamicLine-cap"]);var T=l.width*g.fromScale,v=m.width*g.toScale;d.uniform2f(i.u_patternscale_a,h/T,-l.height/2),d.uniform2f(i.u_patternscale_b,h/v,-m.height/2),d.uniform1f(i.u_sdfgamma,t.lineAtlas.width/(256*Math.min(T,v)*browser.devicePixelRatio)/2)}else if(c){if(p=t.spriteAtlas.getPattern(c.from),_=t.spriteAtlas.getPattern(c.to),!p||!_)return;d.uniform2f(i.u_pattern_size_a,p.displaySize[0]*c.fromScale/h,_.displaySize[1]),d.uniform2f(i.u_pattern_size_b,_.displaySize[0]*c.toScale/h,_.displaySize[1]),d.uniform2fv(i.u_texsize,t.spriteAtlas.getPixelSize())}d.uniform2f(i.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1])}s&&(g?(d.uniform1i(i.u_image,0),d.activeTexture(d.TEXTURE0),t.lineAtlas.bind(d),d.uniform1f(i.u_tex_y_a,l.y),d.uniform1f(i.u_tex_y_b,m.y),d.uniform1f(i.u_mix,g.t)):c&&(d.uniform1i(i.u_image,0),d.activeTexture(d.TEXTURE0),t.spriteAtlas.bind(d,!0),d.uniform2fv(i.u_pattern_tl_a,p.tl),d.uniform2fv(i.u_pattern_br_a,p.br),d.uniform2fv(i.u_pattern_tl_b,_.tl),d.uniform2fv(i.u_pattern_br_b,_.br),d.uniform1f(i.u_fade,c.t))),t.enableTileClippingMask(a);var y=t.translatePosMatrix(a.posMatrix,e,n.paint["dynamicLine-translate"],n.paint["dynamicLine-translate-anchor"]);d.uniformMatrix4fv(i.u_matrix,!1,y),d.uniform1f(i.u_ratio,1/pixelsToTileUnits(e,1,t.transform.zoom)),d.uniform1f(i.u_count,u),d.uniform1f(i.u_segments,segmentGroup);for(var x=0,b=r.segments;x<b.length;x+=1){var S=b[x];S.vaos[n.id].bind(d,i,r.layoutVertexBuffer,r.elementBuffer,o.paintVertexBuffer,S.vertexOffset),d.drawElements(d.TRIANGLES,3*S.primitiveLength,d.UNSIGNED_SHORT,3*S.primitiveOffset*2)}}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),config=_dereq_("../util/config"),segmentGroup=20;module.exports=function(i,t,e,r){if(!i.isOpaquePass){i.setDepthSublayer(0),i.depthMask(!1);var n=i.gl;if(n.enable(n.STENCIL_TEST),!(e.paint["dynamicLine-width"]<=0)){segmentGroup=e.paint["dynamicLine-seg-group"]||20,e.histEnd=(new Date).getTime(),e.first||(e.first=!0,e.histStart=0,e.histCount=0),e.histEnd-e.histStart>=1e3/e.paint["dynamicLine-speed"]&&(e.histCount++,config.TRW&&config.TRW.setProgress(this.histCount),e.histStart=e.histEnd);for(var a,o=!0,s=0,f=r;s<f.length;s+=1){var u=f[s],l=t.getTile(u),m=l.getBucket(e);if(m){var p=m.buffers.layerData[e.id],_=i.currentProgram,d=i.useProgram("dynamicLine",p.programConfiguration),g=o||d!==_,c=a!==l.coord.z;g&&p.programConfiguration.setUniforms(i.gl,d,e,{zoom:i.transform.zoom}),drawLineTile(d,i,l,m.buffers,e,u,p,g,c,e.histCount),a=l.coord.z,o=!1}}}}};
},{"../source/pixels_to_tile_units":111,"../util/browser":217,"../util/config":221}],88:[function(_dereq_,module,exports){
"use strict";function draw(e,r,t,a){if(!e.isOpaquePass&&0!==t.paint["extrusion-opacity"]){var i=e.gl;i.disable(i.STENCIL_TEST),i.enable(i.DEPTH_TEST),e.depthMask(!0);var n=renderToTexture(i,e);i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);for(var u=0;u<a.length;u++)drawExtrusion(e,r,t,a[u]);i.bindFramebuffer(i.FRAMEBUFFER,null),renderTextureToMap(i,e,t,n)}}function renderToTexture(e,r){e.activeTexture(e.TEXTURE1);var t=r.viewportTexture;t?e.bindTexture(e.TEXTURE_2D,t):(t=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,null),r.viewportTexture=t);var a=r.viewportFbo;if(a)e.bindFramebuffer(e.FRAMEBUFFER,a);else{a=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,a);var i=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),r.viewportFbo=a}return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),t}function renderTextureToMap(e,r,t,a){var i=r.useProgram("extrusionTexture");e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),e.uniform1f(i.u_opacity,t.paint["extrusion-opacity"]),e.uniform1i(i.u_image,1);var n=mat4.create();mat4.ortho(n,0,r.width,r.height,0,0,1),e.uniformMatrix4fv(i.u_matrix,!1,n),e.disable(e.DEPTH_TEST),e.uniform2f(i.u_world,e.drawingBufferWidth,e.drawingBufferHeight);var u=new PosArray;u.emplaceBack(0,0),u.emplaceBack(1,0),u.emplaceBack(0,1),u.emplaceBack(1,1);var T=Buffer.fromStructArray(u,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(e,i,T),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.DEPTH_TEST)}function drawExtrusion(e,r,t,a){var i=r.getTile(a),n=i.getBucket(t);if(n){var u=n.buffers,T=e.gl,f=t.paint["extrusion-pattern"],o=u.layerData[t.id],E=o.programConfiguration,l=e.useProgram(f?"extrusionPattern":"extrusion",E);if(E.setUniforms(T,l,t,{zoom:e.transform.zoom}),f){if(pattern.isPatternMissing(f,e))return;pattern.prepare(f,e,l),pattern.setTile(i,e,l),T.uniform1f(l.u_height_factor,-Math.pow(2,a.z)/i.tileSize/8)}e.gl.uniformMatrix4fv(l.u_matrix,!1,e.translatePosMatrix(a.posMatrix,i,t.paint["extrusion-translate"],t.paint["extrusion-translate-anchor"])),setLight(l,e);for(var m=0,s=u.segments;m<s.length;m+=1){var R=s[m];R.vaos[t.id].bind(T,l,u.layoutVertexBuffer,u.elementBuffer,o.paintVertexBuffer,R.vertexOffset),T.drawElements(T.TRIANGLES,3*R.primitiveLength,T.UNSIGNED_SHORT,3*R.primitiveOffset*2)}}}function setLight(e,r){var t=r.gl,a=r.style.light,i=a.calculated.position,n=[i.x,i.y,i.z],u=mat3.create();"viewport"===a.calculated.anchor&&mat3.fromRotation(u,-r.transform.angle),vec3.transformMat3(n,n,u),t.uniform3fv(e.u_lightpos,n),t.uniform1f(e.u_lightintensity,a.calculated.intensity),t.uniform3fv(e.u_lightcolor,a.calculated.color.slice(0,3))}var glMatrix=_dereq_("../_minemap_/gl-matrix"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),PosArray=_dereq_("../data/pos_array"),pattern=_dereq_("./pattern"),mat3=glMatrix.mat3,mat4=glMatrix.mat4,vec3=glMatrix.vec3;module.exports=draw;
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/pos_array":73,"./pattern":101,"./vertex_array_object":102}],89:[function(_dereq_,module,exports){
"use strict";function drawFill(r,t,e,a){var i=r.gl;i.enable(i.STENCIL_TEST);var l=!e.paint["fill-pattern"]&&e.isPaintValueFeatureConstant("fill-color")&&e.isPaintValueFeatureConstant("fill-opacity")&&1===e.paint["fill-color"][3]&&1===e.paint["fill-opacity"];drawWater="water"===e.paint["fill-water"],r.isOpaquePass===l&&(r.setDepthSublayer(1),drawFillTiles(r,t,e,a,drawFillTile)),!r.isOpaquePass&&e.paint["fill-antialias"]&&(r.lineWidth(2),r.depthMask(!1),r.setDepthSublayer(e.getPaintProperty("fill-outline-color")?2:0),drawFillTiles(r,t,e,a,drawStrokeTile))}function drawFillTiles(r,t,e,a,i){if(!pattern.isPatternMissing(e.paint["fill-pattern"],r))for(var l=!0,n=0,o=a;n<o.length;n+=1){var f=o[n],s=t.getTile(f),p=s.getBucket(e);p&&(r.enableTileClippingMask(f),i(r,t,e,s,f,p.buffers,l),l=!1)}}function drawFillTile(r,t,e,a,i,l,n){for(var o=r.gl,f=l.layerData[e.id],s=setFillProgram("fill",e.paint["fill-pattern"],r,f,e,a,i,n),p=0,u=l.segments;p<u.length;p+=1){var g=u[p];g.vaos[e.id].bind(o,s,l.layoutVertexBuffer,l.elementBuffer,f.paintVertexBuffer,g.vertexOffset),o.drawElements(o.TRIANGLES,3*g.primitiveLength,o.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}function drawStrokeTile(r,t,e,a,i,l,n){var o=r.gl,f=l.layerData[e.id],s=e.paint["fill-pattern"]&&!e.getPaintProperty("fill-outline-color"),p=setFillProgram("fillOutline",s,r,f,e,a,i,n);o.uniform2f(p.u_world,o.drawingBufferWidth,o.drawingBufferHeight);for(var u=0,g=l.segments2;u<g.length;u+=1){var m=g[u];m.vaos[e.id].bind(o,p,l.layoutVertexBuffer,l.elementBuffer2,f.paintVertexBuffer,m.vertexOffset),o.drawElements(o.LINES,2*m.primitiveLength,o.UNSIGNED_SHORT,2*m.primitiveOffset*2)}}function setFillProgram(r,t,e,a,i,l,n,o){var f,s=e.currentProgram;return drawWater?(f=e.useProgram("fillWater",a.programConfiguration),(o||f!==s)&&a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom}),e.gl.uniform1f(f.u_time,performance.now()/1e3)):t?(f=e.useProgram(r+"Pattern",a.programConfiguration),(o||f!==s)&&(a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom}),pattern.prepare(i.paint["fill-pattern"],e,f)),pattern.setTile(l,e,f)):(f=e.useProgram(r,a.programConfiguration),(o||f!==s)&&a.programConfiguration.setUniforms(e.gl,f,i,{zoom:e.transform.zoom})),e.gl.uniformMatrix4fv(f.u_matrix,!1,e.translatePosMatrix(n.posMatrix,l,i.paint["fill-translate"],i.paint["fill-translate-anchor"])),f}var pattern=_dereq_("./pattern"),drawWater=!1;module.exports=drawFill;
},{"./pattern":101}],90:[function(_dereq_,module,exports){
"use strict";function draw(r,e,t,a){if(!r.isOpaquePass&&0!==t.paint["histogram-opacity"]){var i=r.gl;if(i.disable(i.STENCIL_TEST),i.enable(i.DEPTH_TEST),r.depthMask(!0),t.hasOwnProperty("_hasRendered")||(t._hasRendered=!0),t.paint["histogram-dynamic"])if(t.hasOwnProperty("_transform")&&t.hasOwnProperty("_count")||(t._transform=Date.now(),t._count=0),config.TRW&&!config.TRW.stayStatic){var o=Date.now()-t._transform;t._count+=o/t.paint["histogram-time"]*500,t._count>=500*t.paint["histogram-count"]&&(t._count=0),t._transform=Date.now()}else t._transform=Date.now();var n=renderToTexture(i,r);i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);for(var u=0;u<a.length;u++)drawExtrusion(r,e,t,a[u]);i.bindFramebuffer(i.FRAMEBUFFER,null),renderTextureToMap(i,r,t,n)}}function renderToTexture(r,e){r.activeTexture(r.TEXTURE1);var t=e.viewportTexture;t?r.bindTexture(r.TEXTURE_2D,t):(t=r.createTexture(),r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width,e.height,0,r.RGBA,r.UNSIGNED_BYTE,null),e.viewportTexture=t);var a=e.viewportFbo;if(a)r.bindFramebuffer(r.FRAMEBUFFER,a);else{a=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,a);var i=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,i),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,i),e.viewportFbo=a}return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),t}function renderTextureToMap(r,e,t,a){var i=e.useProgram("extrusionTexture");r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a),r.uniform1f(i.u_opacity,t.paint["histogram-opacity"]),r.uniform1i(i.u_image,1);var o=mat4.create();mat4.ortho(o,0,e.width,e.height,0,0,1),r.uniformMatrix4fv(i.u_matrix,!1,o),r.disable(r.DEPTH_TEST),r.uniform2f(i.u_world,r.drawingBufferWidth,r.drawingBufferHeight);var n=new PosArray;n.emplaceBack(0,0),n.emplaceBack(1,0),n.emplaceBack(0,1),n.emplaceBack(1,1);var u=Buffer.fromStructArray(n,Buffer.BufferType.VERTEX);(new VertexArrayObject).bind(r,i,u),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.enable(r.DEPTH_TEST)}function drawExtrusion(r,e,t,a){var i=e.getTile(a),o=i.getBucket(t);if(o){var n=t.paint["histogram-dynamic"],u=t.layout["histogram-color-render"],f=o.buffers,m=r.gl,T=f.layerData[t.id],E=T.programConfiguration,s=null;if(s=n?r.useProgram("histogramDynamic",E):r.useProgram(u?"histogramColor":"histogram",E),E.setUniforms(m,s,t,{zoom:r.transform.zoom}),u){for(var _=t.paint["histogram-colors"],c=t.paint["histogram-max-height"],l=[],g=0;g<_.length;g++){var R=colorParser.parseCSSColor(_[g]);R[0]/=255,R[1]/=255,R[2]/=255,l.push(R)}m.uniform1f(s.u_max_height,3*c),m.uniform4fv(s.u_color_a,l[0]),m.uniform4fv(s.u_color_b,l[1]),m.uniform4fv(s.u_color_c,l[2]),m.uniform4fv(s.u_color_d,l[3]),m.uniform4fv(s.u_color_e,l[4])}n&&m.uniform1f(s.u_dyn_count,t._count),r.gl.uniformMatrix4fv(s.u_matrix,!1,r.translatePosMatrix(a.posMatrix,i,t.paint["histogram-translate"],t.paint["histogram-translate-anchor"])),m.uniform1f(s.u_is_max_length,t.layout["histogram-max-height-render"]),setLight(s,r);for(var h=0,d=f.segments;h<d.length;h+=1){var x=d[h];x.vaos[t.id].bind(m,s,f.layoutVertexBuffer,f.elementBuffer,T.paintVertexBuffer,x.vertexOffset),m.drawElements(m.TRIANGLES,3*x.primitiveLength,m.UNSIGNED_SHORT,3*x.primitiveOffset*2)}}}function setLight(r,e){var t=e.gl,a=e.style.light,i=a.calculated.position,o=[i.x,i.y,i.z],n=mat3.create();"viewport"===a.calculated.anchor&&mat3.fromRotation(n,-e.transform.angle),vec3.transformMat3(o,o,n),t.uniform3fv(r.u_lightpos,o),t.uniform1f(r.u_lightintensity,a.calculated.intensity),t.uniform3fv(r.u_lightcolor,a.calculated.color.slice(0,3))}var glMatrix=_dereq_("../_minemap_/gl-matrix"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),PosArray=_dereq_("../data/pos_array"),colorParser=_dereq_("csscolorparser"),config=_dereq_("../util/config"),mat3=glMatrix.mat3,mat4=glMatrix.mat4,vec3=glMatrix.vec3;module.exports=draw;
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/pos_array":73,"../util/config":221,"./vertex_array_object":102,"csscolorparser":1}],91:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,i,t,r,a,n,o,l,f){var s,u,m,p,_=i.gl,d=a.paint["line-dasharray"],g=a.paint["line-pattern"];if(l||f){var v=1/pixelsToTileUnits(t,1,i.transform.tileZoom);if(d){s=i.lineAtlas.getDash(d.from,"round"===a.layout["line-cap"]),u=i.lineAtlas.getDash(d.to,"round"===a.layout["line-cap"]);var x=s.width*d.fromScale,T=u.width*d.toScale;_.uniform2f(e.u_patternscale_a,v/x,-s.height/2),_.uniform2f(e.u_patternscale_b,v/T,-u.height/2),_.uniform1f(e.u_sdfgamma,i.lineAtlas.width/(256*Math.min(x,T)*browser.devicePixelRatio)/2)}else if(g){if(m=i.spriteAtlas.getPattern(g.from),p=i.spriteAtlas.getPattern(g.to),!m||!p)return;_.uniform2f(e.u_pattern_size_a,m.displaySize[0]*g.fromScale/v,p.displaySize[1]),_.uniform2f(e.u_pattern_size_b,p.displaySize[0]*g.toScale/v,p.displaySize[1]),_.uniform2fv(e.u_texsize,i.spriteAtlas.getPixelSize())}_.uniform2f(e.u_gl_units_to_pixels,1/i.transform.pixelsToGLUnits[0],1/i.transform.pixelsToGLUnits[1])}l&&(d?(_.uniform1i(e.u_image,0),_.activeTexture(_.TEXTURE0),i.lineAtlas.bind(_),_.uniform1f(e.u_tex_y_a,s.y),_.uniform1f(e.u_tex_y_b,u.y),_.uniform1f(e.u_mix,d.t)):g&&(_.uniform1i(e.u_image,0),_.activeTexture(_.TEXTURE0),i.spriteAtlas.bind(_,!0),_.uniform2fv(e.u_pattern_tl_a,m.tl),_.uniform2fv(e.u_pattern_br_a,m.br),_.uniform2fv(e.u_pattern_tl_b,p.tl),_.uniform2fv(e.u_pattern_br_b,p.br),_.uniform1f(e.u_fade,g.t))),i.enableTileClippingMask(n);var b=i.translatePosMatrix(n.posMatrix,t,a.paint["line-translate"],a.paint["line-translate-anchor"]);_.uniformMatrix4fv(e.u_matrix,!1,b),_.uniform1f(e.u_ratio,1/pixelsToTileUnits(t,1,i.transform.zoom));for(var c=0,h=r.segments;c<h.length;c+=1){var S=h[c];S.vaos[a.id].bind(_,e,r.layoutVertexBuffer,r.elementBuffer,o.paintVertexBuffer,S.vertexOffset),_.drawElements(_.TRIANGLES,3*S.primitiveLength,_.UNSIGNED_SHORT,3*S.primitiveOffset*2)}}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units");module.exports=function(e,i,t,r){if(!e.isOpaquePass){e.setDepthSublayer(0),e.depthMask(!1);var a=e.gl;if(a.enable(a.STENCIL_TEST),!(t.paint["line-width"]<=0))for(var n,o=t.paint["line-dasharray"]?"lineSDF":t.paint["line-pattern"]?"linePattern":"line",l=!0,f=0,s=r;f<s.length;f+=1){var u=s[f],m=i.getTile(u),p=m.getBucket(t);if(p){var _=p.buffers.layerData[t.id],d=e.currentProgram,g=e.useProgram(o,_.programConfiguration),v=l||g!==d,x=n!==m.coord.z;v&&_.programConfiguration.setUniforms(e.gl,g,t,{zoom:e.transform.zoom}),drawLineTile(g,e,m,p.buffers,t,u,_,v,x),n=m.coord.z,l=!1}}}};
},{"../source/pixels_to_tile_units":111,"../util/browser":217}],92:[function(_dereq_,module,exports){
"use strict";function drawRaster(r,t,e,a){if(!r.isOpaquePass){var i=r.gl;i.enable(i.DEPTH_TEST),r.depthMask(!0),i.depthFunc(i.LESS);for(var o=a.length&&a[0].z,n=0;n<a.length;n++){var u=a[n];r.setDepthSublayer(u.z-o),drawRasterTile(r,t,e,u)}i.depthFunc(i.LEQUAL)}}function drawRasterTile(r,t,e,a){var i=r.gl;i.disable(i.STENCIL_TEST);var o=t.getTile(a),n=r.transform.calculatePosMatrix(a,t.getSource().maxzoom);o.registerFadeDuration(r.style.animationLoop,e.paint["raster-fade-duration"]);var u=r.useProgram("raster");i.uniformMatrix4fv(u.u_matrix,!1,n),i.uniform1f(u.u_brightness_low,e.paint["raster-brightness-min"]),i.uniform1f(u.u_brightness_high,e.paint["raster-brightness-max"]),i.uniform1f(u.u_saturation_factor,saturationFactor(e.paint["raster-saturation"])),i.uniform1f(u.u_contrast_factor,contrastFactor(e.paint["raster-contrast"])),i.uniform3fv(u.u_spin_weights,spinWeights(e.paint["raster-hue-rotate"]));var s,c,f=o.sourceCache&&o.sourceCache.findLoadedParent(a,0,{}),d=getFadeValues(o,f,e,r.transform);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.texture),i.activeTexture(i.TEXTURE1),f?(i.bindTexture(i.TEXTURE_2D,f.texture),s=Math.pow(2,f.coord.z-o.coord.z),c=[o.coord.x*s%1,o.coord.y*s%1]):i.bindTexture(i.TEXTURE_2D,o.texture),i.uniform2fv(u.u_tl_parent,c||[0,0]),i.uniform1f(u.u_scale_parent,s||1),i.uniform1f(u.u_buffer_scale,1),i.uniform1f(u.u_fade_t,d.mix),i.uniform1f(u.u_opacity,d.opacity*e.paint["raster-opacity"]),i.uniform1i(u.u_image0,0),i.uniform1i(u.u_image1,1);var m=o.boundsBuffer||r.rasterBoundsBuffer;(o.boundsVAO||r.rasterBoundsVAO).bind(i,u,m),i.drawArrays(i.TRIANGLE_STRIP,0,m.length)}function spinWeights(r){r*=Math.PI/180;var t=Math.sin(r),e=Math.cos(r);return[(2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3]}function contrastFactor(r){return r>0?1/(1-r):1+r}function saturationFactor(r){return r>0?1-1/(1.001-r):-r}function getFadeValues(r,t,e,a){var i=e.paint["raster-fade-duration"];if(r.sourceCache&&i>0){var o=Date.now(),n=(o-r.timeAdded)/i,u=t?(o-t.timeAdded)/i:-1,s=r.sourceCache.getSource(),c=a.coveringZoomLevel({tileSize:s.tileSize,roundZoom:s.roundZoom}),f=!t||Math.abs(t.coord.z-c)>Math.abs(r.coord.z-c),d=f&&r.refreshedUponExpiration?1:util.clamp(f?n:1-u,0,1);return r.refreshedUponExpiration&&n>=1&&(r.refreshedUponExpiration=!1),t?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var util=_dereq_("../util/util");module.exports=drawRaster;
},{"../util/util":244}],93:[function(_dereq_,module,exports){
"use strict";function drawSpriteTile(e,t,r,i,a,s,n,u,l){var p,o,f,d,m=t.gl,_=a.paint["sprite-dasharray"],c=a.paint["sprite-pattern"];if(u||l){var g=1/pixelsToTileUnits(r,1,t.transform.tileZoom);if(_){p=t.lineAtlas.getDash(_.from,"round"===a.layout["sprite-cap"]),o=t.lineAtlas.getDash(_.to,"round"===a.layout["sprite-cap"]);var b=p.width*_.fromScale,x=o.width*_.toScale;m.uniform2f(e.u_patternscale_a,g/b,-p.height/2),m.uniform2f(e.u_patternscale_b,g/x,-o.height/2),m.uniform1f(e.u_sdfgamma,t.lineAtlas.width/(256*Math.min(b,x)*browser.devicePixelRatio)/2)}else if(c){if(f=t.spriteAtlas.getPattern(c.from),d=t.spriteAtlas.getPattern(c.to),!f||!d)return;m.uniform2f(e.u_pattern_size_a,f.displaySize[0]*c.fromScale/g,d.displaySize[1]),m.uniform2f(e.u_pattern_size_b,d.displaySize[0]*c.toScale/g,d.displaySize[1]),m.uniform2fv(e.u_texsize,t.spriteAtlas.getPixelSize())}m.uniform2f(e.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1])}u&&(_?(m.uniform1i(e.u_image,0),m.activeTexture(m.TEXTURE0),t.lineAtlas.bind(m),m.uniform1f(e.u_tex_y_a,p.y),m.uniform1f(e.u_tex_y_b,o.y),m.uniform1f(e.u_mix,_.t)):c&&(m.uniform1i(e.u_image,0),m.activeTexture(m.TEXTURE0),t.spriteAtlas.bind(m,!0),m.uniform2fv(e.u_pattern_tl_a,f.tl),m.uniform2fv(e.u_pattern_br_a,f.br),m.uniform2fv(e.u_pattern_tl_b,d.tl),m.uniform2fv(e.u_pattern_br_b,d.br),m.uniform1f(e.u_fade,c.t))),t.enableTileClippingMask(s),m.uniform4f(e.u_speed_mat,curEleObj.getCalculatedSpeed(1),curEleObj.getCalculatedSpeed(2),curEleObj.getCalculatedSpeed(3),curEleObj.getCalculatedSpeed(4));var v=t.translatePosMatrix(s.posMatrix,r,a.paint["sprite-translate"],a.paint["sprite-translate-anchor"]);m.uniformMatrix4fv(e.u_matrix,!1,v),m.uniform1f(e.u_ratio,1/pixelsToTileUnits(r,1,t.transform.zoom));for(var E=0,S=i.segments;E<S.length;E+=1){var T=S[E];T.vaos[a.id].bind(m,e,i.layoutVertexBuffer,i.elementBuffer,n.paintVertexBuffer,T.vertexOffset),m.drawElements(m.TRIANGLES,3*T.primitiveLength,m.UNSIGNED_SHORT,3*T.primitiveOffset*2)}}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),curEleObj={speed1:0,speed2:0,speed3:0,speed4:0,speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(e){return parseInt(this["speed"+e]/e/this["speedExt"+e])}};module.exports=function(e,t,r,i){if(!e.isOpaquePass){e.setDepthSublayer(0),e.depthMask(!1);var a=e.gl;if(a.enable(a.STENCIL_TEST),!(r.paint["sprite-width"]<=0)){var s=parseInt(r.paint["sprite-speed-factor"]);curEleObj["speed"+s]++,curEleObj.speed1%=20,curEleObj.speed2%=80,curEleObj.speed3%=150,curEleObj.speed4%=240;for(var n,u=r.paint["sprite-dasharray"]?"spriteSDF":r.paint["sprite-pattern"]?"spritePattern":"sprite",l=!0,p=0,o=i;p<o.length;p+=1){var f=o[p],d=t.getTile(f),m=d.getBucket(r);if(m){var _=m.buffers.layerData[r.id],c=e.currentProgram,g=e.useProgram(u,_.programConfiguration),b=l||g!==c,x=n!==d.coord.z;b&&_.programConfiguration.setUniforms(e.gl,g,r,{zoom:e.transform.zoom}),drawSpriteTile(g,e,d,m.buffers,r,f,_,b,x),n=d.coord.z,l=!1}}}}};
},{"../source/pixels_to_tile_units":111,"../util/browser":217}],94:[function(_dereq_,module,exports){
"use strict";function drawSymbols(t,e,i,a){if(!t.isOpaquePass){var o=!(i.layout["text-allow-overlap"]||i.layout["icon-allow-overlap"]||i.layout["text-ignore-placement"]||i.layout["icon-ignore-placement"]),r=t.gl;o?r.disable(r.STENCIL_TEST):r.enable(r.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),drawLayerSymbols(t,e,i,a,!1,i.paint["icon-translate"],i.paint["icon-translate-anchor"],i.layout["icon-rotation-alignment"],i.layout["icon-pitch-alignment"],i.layout["icon-keep-upright"]),drawLayerSymbols(t,e,i,a,!0,i.paint["text-translate"],i.paint["text-translate-anchor"],i.layout["text-rotation-alignment"],i.layout["text-pitch-alignment"],i.layout["text-keep-upright"]),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,i,a)}}function drawLayerSymbols(t,e,i,a,o,r,n,l,s,u){if(o||!t.style.sprite||t.style.sprite.loaded()){var m=t.gl,f="map"===l,c="map"===s,_=f&&"line"===i.layout["symbol-placement"],y=f&&!c&&!_,p=c;p?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST);for(var b,d,x=0,g=a;x<g.length;x+=1){var S=g[x],T=e.getTile(S),h=T.getBucket(i);if(h){var v=o?h.buffers.glyph:h.buffers.icon;if(v&&v.segments.length){var z=v.layerData[i.id],w=z.programConfiguration,E=o||h.sdfIcons,M=o?h.textSizeData:h.iconSizeData;b&&h.fontstack===d||(b=t.useProgram(E?"symbolSDF":"symbolIcon",w),w.setUniforms(m,b,i,{zoom:t.transform.zoom}),setSymbolDrawState(b,t,i,S.z,o,E,y,c,h.fontstack,h.iconsNeedLinear,M)),t.enableTileClippingMask(S),m.uniformMatrix4fv(b.u_matrix,!1,t.translatePosMatrix(S.posMatrix,T,r,n));var D=pixelsToTileUnits(T,1,t.transform.zoom),C=symbolProjection.getLabelPlaneMatrix(S.posMatrix,c,f,t.transform,D),L=symbolProjection.getGlCoordMatrix(S.posMatrix,c,f,t.transform,D);m.uniformMatrix4fv(b.u_gl_coord_matrix,!1,t.translatePosMatrix(L,T,r,n,!0)),_?(m.uniformMatrix4fv(b.u_label_plane_matrix,!1,identityMat4),symbolProjection.updateLineLabels(h,S.posMatrix,t,o,C,L,c,u,D,i)):m.uniformMatrix4fv(b.u_label_plane_matrix,!1,C),m.uniform1f(b.u_collision_y_stretch,T.collisionTile.yStretch),drawTileSymbols(b,w,t,i,T,v,o,E,c),d=h.fontstack}}}p||m.enable(m.DEPTH_TEST)}}function setSymbolDrawState(t,e,i,a,o,r,n,l,s,u,m){var f=e.gl,c=e.transform;if(f.uniform1i(t.u_pitch_with_map,l),f.activeTexture(f.TEXTURE0),f.uniform1i(t.u_texture,0),f.uniform1f(t.u_is_text,o?1:0),o){var _=s&&e.glyphSource.getGlyphAtlas(s);if(!_)return;_.updateTexture(f),f.uniform2f(t.u_texsize,_.width,_.height)}else{var y=e.options.rotating||e.options.zooming,p=!i.isLayoutValueFeatureConstant("icon-size")||!i.isLayoutValueZoomConstant("icon-size")||1!==i.getLayoutValue("icon-size",{zoom:c.zoom}),b=p||u,d=l||c.pitch;e.spriteAtlas.bind(f,r||y||b||d),f.uniform2fv(t.u_texsize,e.spriteAtlas.getPixelSize())}f.activeTexture(f.TEXTURE1),e.frameHistory.bind(f),f.uniform1i(t.u_fadetexture,1),f.uniform1f(t.u_pitch,c.pitch/360*2*Math.PI),f.uniform1i(t.u_is_size_zoom_constant,m.isZoomConstant?1:0),f.uniform1i(t.u_is_size_feature_constant,m.isFeatureConstant?1:0),f.uniform1f(t.u_camera_to_center_distance,c.cameraToCenterDistance);var x=symbolSize.evaluateSizeForZoom(m,c,i,o);void 0!==x.uSizeT&&f.uniform1f(t.u_size_t,x.uSizeT),void 0!==x.uSize&&f.uniform1f(t.u_size,x.uSize),f.uniform1f(t.u_aspect_ratio,c.width/c.height),f.uniform1i(t.u_rotate_symbol,n)}function drawTileSymbols(t,e,i,a,o,r,n,l,s){var u=i.gl,m=i.transform;if(l){var f=(n?"text":"icon")+"-halo-width",c=!a.isPaintValueFeatureConstant(f)||a.paint[f],_=s?Math.cos(m._pitch)*m.cameraToCenterDistance:1;u.uniform1f(t.u_gamma_scale,_),c&&(u.uniform1f(t.u_is_halo,1),drawSymbolElements(r,a,u,t)),u.uniform1f(t.u_is_halo,0)}drawSymbolElements(r,a,u,t)}function drawSymbolElements(t,e,i,a){for(var o=t.layerData[e.id],r=o&&o.paintVertexBuffer,n=0,l=t.segments;n<l.length;n+=1){var s=l[n];s.vaos[e.id].bind(i,a,t.layoutVertexBuffer,t.elementBuffer,r,s.vertexOffset,t.dynamicLayoutVertexBuffer),i.drawElements(i.TRIANGLES,3*s.primitiveLength,i.UNSIGNED_SHORT,3*s.primitiveOffset*2)}}var drawCollisionDebug=_dereq_("./draw_collision_debug"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),symbolProjection=_dereq_("../symbol/projection"),symbolSize=_dereq_("../symbol/symbol_size"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,identityMat4=mat4.identity(new Float32Array(16));module.exports=drawSymbols;
},{"../_minemap_/gl-matrix":39,"../source/pixels_to_tile_units":111,"../symbol/projection":190,"../symbol/symbol_size":194,"./draw_collision_debug":85}],95:[function(_dereq_,module,exports){
"use strict";function drawSymbols(t,e,i,o){if(!t.isOpaquePass){this.start||(this.start=(new Date).getTime(),this.count=0),this.end=(new Date).getTime();var a=i.layout["symtracking-fps"],r=i.layout["symtracking-time-segment"];if(offset=i.paint["symtracking-delay"],this.end-this.start>=1e3/a){this.count+=1;var n=config.TRW&&config.TRW.hasOwnProperty("replaceOffset")?config.TRW.replaceOffset:a*(r+offset);this.count%=n;var s=config.TRW&&config.TRW.hasOwnProperty("requestOffset")?config.TRW.requestOffset:r*a;this.count===s&&config.TRW&&config.TRW.request(),0===this.count&&(config.TRW&&config.TRW.replace(),this.count=offset),config.TRW&&(config.TRW.currentSeq=this.count),_count=this.count,this.start=this.end}var u=t.gl;u.disable(u.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),drawLayerSymbols(t,e,i,o,!1,i.paint["icon-translate"],i.paint["icon-translate-anchor"],i.layout["icon-rotation-alignment"],i.layout["icon-pitch-alignment"],i.layout["icon-keep-upright"],this.count),drawLayerSymbols(t,e,i,o,!0,i.paint["text-translate"],i.paint["text-translate-anchor"],i.layout["text-rotation-alignment"],i.layout["text-pitch-alignment"],i.layout["text-keep-upright"],this.count),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,i,o)}}function drawLayerSymbols(t,e,i,o,a,r,n,s,u,l,f){if(a||!t.style.sprite||t.style.sprite.loaded()){var m=t.gl,c="map"===s,_="map"===u,y=c&&"line"===i.layout["symbol-placement"],g=c&&!_&&!y,p=_;p?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST);for(var h,d,T=0,x=o;T<x.length;T+=1){var b=x[T],S=e.getTile(b);if(S){var v=S.getBucket(i);if(v){var z=a?v.buffers.glyph:v.buffers.icon;if(z&&z.segments.length){var w=z.layerData[i.id],D=w.programConfiguration,E=a||v.sdfIcons,M=a?v.textSizeData:v.iconSizeData;h&&v.fontstack===d||(h=t.useProgram(E?"symtrackingSDF":"symtrackingIcon",D),D.setUniforms(m,h,i,{zoom:t.transform.zoom}),setSymbolDrawState(h,t,i,b.z,a,E,g,_,v.fontstack,v.iconsNeedLinear,M,f)),t.enableTileClippingMask(b),m.uniformMatrix4fv(h.u_matrix,!1,t.translatePosMatrix(b.posMatrix,S,r,n));var P=pixelsToTileUnits(S,1,t.transform.zoom),R=symbolProjection.getLabelPlaneMatrix(b.posMatrix,_,c,t.transform,P),C=symbolProjection.getGlCoordMatrix(b.posMatrix,_,c,t.transform,P);m.uniformMatrix4fv(h.u_gl_coord_matrix,!1,t.translatePosMatrix(C,S,r,n,!0)),y?(m.uniformMatrix4fv(h.u_label_plane_matrix,!1,identityMat4),symbolProjection.updateLineLabels(v,b.posMatrix,t,a,R,C,_,l,P,i)):m.uniformMatrix4fv(h.u_label_plane_matrix,!1,R),m.uniform1f(h.u_collision_y_stretch,S.collisionTile.yStretch),drawTileSymbols(h,D,t,i,S,z,a,E,_),d=v.fontstack}}}}p||m.enable(m.DEPTH_TEST)}}function setSymbolDrawState(t,e,i,o,a,r,n,s,u,l,f,m){var c=e.gl,_=e.transform;if(c.uniform1i(t.u_pitch_with_map,s),c.activeTexture(c.TEXTURE0),c.uniform1i(t.u_texture,0),c.uniform1f(t.u_is_text,a?1:0),a){var y=u&&e.glyphSource.getGlyphAtlas(u);if(!y)return;y.updateTexture(c),c.uniform2f(t.u_texsize,y.width,y.height)}else{var g=e.options.rotating||e.options.zooming,p=!i.isLayoutValueFeatureConstant("icon-size")||!i.isLayoutValueZoomConstant("icon-size")||1!==i.getLayoutValue("icon-size",{zoom:_.zoom}),h=p||l,d=s||_.pitch;e.spriteAtlas.bind(c,r||g||h||d),c.uniform2fv(t.u_texsize,e.spriteAtlas.getPixelSize()),c.uniform1f(t.u_seq,m)}c.activeTexture(c.TEXTURE1),e.frameHistory.bind(c),c.uniform1i(t.u_fadetexture,1),c.uniform1f(t.u_pitch,_.pitch/360*2*Math.PI),c.uniform1i(t.u_is_size_zoom_constant,f.isZoomConstant?1:0),c.uniform1i(t.u_is_size_feature_constant,f.isFeatureConstant?1:0),c.uniform1f(t.u_camera_to_center_distance,_.cameraToCenterDistance);var T=symbolSize.evaluateSizeForZoom(f,_,i,a);void 0!==T.uSizeT&&c.uniform1f(t.u_size_t,T.uSizeT),void 0!==T.uSize&&c.uniform1f(t.u_size,T.uSize),c.uniform1f(t.u_aspect_ratio,_.width/_.height),c.uniform1i(t.u_rotate_symbol,n)}function drawTileSymbols(t,e,i,o,a,r,n,s,u){var l=i.gl,f=i.transform;if(s){var m=(n?"text":"icon")+"-halo-width",c=!o.isPaintValueFeatureConstant(m)||o.paint[m],_=u?Math.cos(f._pitch)*f.cameraToCenterDistance:1;l.uniform1f(t.u_gamma_scale,_),c&&(l.uniform1f(t.u_is_halo,1),drawSymbolElements(r,o,l,t)),l.uniform1f(t.u_is_halo,0)}drawSymbolElements(r,o,l,t)}function drawSymbolElements(t,e,i,o){for(var a=t.layerData[e.id],r=a&&a.paintVertexBuffer,n=0,s=t.segments;n<s.length;n+=1){var u=s[n];u.vaos[e.id].bind(i,o,t.layoutVertexBuffer,t.elementBuffer,r,u.vertexOffset,t.dynamicLayoutVertexBuffer),i.drawElements(i.TRIANGLES,3*u.primitiveLength,i.UNSIGNED_SHORT,3*u.primitiveOffset*2)}}var drawCollisionDebug=_dereq_("./draw_collision_debug"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),symbolProjection=_dereq_("../symbol/projection"),symbolSize=_dereq_("../symbol/symbol_size"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,identityMat4=mat4.identity(new Float32Array(16)),config=_dereq_("../util/config");module.exports=drawSymbols;var _count=0,offset=10;
},{"../_minemap_/gl-matrix":39,"../source/pixels_to_tile_units":111,"../symbol/projection":190,"../symbol/symbol_size":194,"../util/config":221,"./draw_collision_debug":85}],96:[function(_dereq_,module,exports){
"use strict";function drawTrackingTile(t,e,r,i,n,s,o,a,u,f,g,p){var c=e.gl;(a||u)&&c.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1]),e.enableTileClippingMask(s);var l=e.translatePosMatrix(s.posMatrix,r,n.paint["tracking-translate"],n.paint["tracking-translate-anchor"]);c.uniformMatrix4fv(t.u_matrix,!1,l),c.uniform1f(t.u_ratio,1/pixelsToTileUnits(r,1,e.transform.zoom)),c.uniform1f(t.u_start,f-segmentGroup),c.uniform1f(t.u_end,f),c.uniform1f(t.u_segments,segmentGroup),c.uniform1f(t.u_reverse,g),c.uniform1f(t.u_reserve,p);for(var h=0,m=i.segments;h<m.length;h+=1){var v=m[h];v.vaos[n.id].bind(c,t,i.layoutVertexBuffer,i.elementBuffer,o.paintVertexBuffer,v.vertexOffset),c.drawElements(c.TRIANGLES,3*v.primitiveLength,c.UNSIGNED_SHORT,3*v.primitiveOffset*2)}}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),config=_dereq_("../util/config"),offset=20,segmentGroup=20;module.exports=function(t,e,r,i){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var n=t.gl;if(n.enable(n.STENCIL_TEST),!(r.paint["tracking-width"]<=0)){if(segmentGroup=r.paint["tracking-seg-group"],offset=r.paint["tracking-delay"],"history"===r.paint["tracking-type"])r.histEnd=Date.now(),r.first||(r.first=!0,r.histStart=0,r.histCount=0,r.isReverse=!1,r.isReserve=!1),r.histEnd-r.histStart>=1e3/r.paint["tracking-speed"]&&("loop"===r.layout["tracking-display-mode"]?(r.histCount++,r.histCount%=r.paint["tracking-seg-count"],r.histCount=0===r.histCount?1:r.histCount):"reverse"===r.layout["tracking-display-mode"]?(r.histCount>=r.paint["tracking-seg-count"]+r.paint["tracking-seg-group"]?r.isReverse=!0:r.histCount<=1&&(r.isReverse=!1),r.histCount=r.isReverse?r.histCount-1:r.histCount+1):"loop-reserve"===r.layout["tracking-display-mode"]?(r.isReserve=!0,r.histCount++,r.histCount%=r.paint["tracking-seg-count"],r.histCount=0===r.histCount?1:r.histCount):"reverse-reserve"===r.layout["tracking-display-mode"]&&(r.isReserve=!0,r.histCount>=r.paint["tracking-seg-count"]+r.paint["tracking-seg-group"]?r.isReverse=!0:r.histCount<=1&&(r.isReverse=!1),r.histCount=r.isReverse?r.histCount-1:r.histCount+1),config.TRW&&config.TRW.setProgress(r.histCount),r.histStart=r.histEnd);else if(r.count||(r.start=Date.now(),r.count=1),r.end=Date.now(),r.end-r.start>=1e3/r.paint["tracking-speed"]){var s=config.TRW||r.paint["tracking-trw"];r.count+=1;var o=s&&s.hasOwnProperty("replaceOffset")?s.replaceOffset:120+offset;r.count%=o;var a=s&&s.hasOwnProperty("requestOffset")?s.requestOffset:90+offset;r.count===a&&s&&s.request(),0===r.count&&(s&&s.replace(),r.count=offset),s&&(s.currentSeq=r.count),r.start=r.end}for(var u,f=r.paint["tracking-dasharray"]?"lineSDF":r.paint["tracking-pattern"]?"linePattern":"tracking",g=!0,p=0,c=i;p<c.length;p+=1){var l=c[p],h=e.getTile(l);if(h){if(Object.getPrototypeOf(h).hasOwnProperty("getBucket")){var m=h.getBucket(r);if(m){var v=m.buffers.layerData[r.id],d=t.currentProgram,k=t.useProgram(f,v.programConfiguration),C=g||k!==d,y=u!==h.coord.z;C&&v.programConfiguration.setUniforms(t.gl,k,r,{zoom:t.transform.zoom}),drawTrackingTile(k,t,h,m.buffers,r,l,v,C,y,"history"===r.paint["tracking-type"]?r.histCount:r.count,r.isReverse,r.isReserve),u=h.coord.z,g=!1}}}}}}};
},{"../source/pixels_to_tile_units":111,"../util/browser":217,"../util/config":221}],97:[function(_dereq_,module,exports){
"use strict";var FrameHistory=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};FrameHistory.prototype.record=function(e,t,i){var r=this;this.firstFrame&&(e=0,this.firstFrame=!1),t=Math.floor(10*t);var a;if(t<this.previousZoom)for(a=t+1;a<=this.previousZoom;a++)r.changeTimes[a]=e,r.changeOpacities[a]=r.opacities[a];else for(a=t;a>this.previousZoom;a--)r.changeTimes[a]=e,r.changeOpacities[a]=r.opacities[a];for(a=0;a<256;a++){var s=e-r.changeTimes[a],o=255*(i?s/i:1);r.opacities[a]=a<=t?r.changeOpacities[a]+o:r.changeOpacities[a]-o}this.changed=!0,this.previousZoom=t},FrameHistory.prototype.isVisible=function(e){return 0!==this.opacities[Math.floor(10*e)]},FrameHistory.prototype.bind=function(e){this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.changed&&(e.texSubImage2D(e.TEXTURE_2D,0,0,0,256,1,e.ALPHA,e.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,256,1,0,e.ALPHA,e.UNSIGNED_BYTE,this.array))},module.exports=FrameHistory;
},{}],98:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),LineAtlas=function(t,i){this.width=t,this.height=i,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};LineAtlas.prototype.setSprite=function(t){this.sprite=t},LineAtlas.prototype.getDash=function(t,i){var e=t.join(",")+i;return this.positions[e]||(this.positions[e]=this.addDash(t,i)),this.positions[e]},LineAtlas.prototype.addDash=function(t,i){var e=this,h=i?7:0,s=2*h+1;if(this.nextRow+s>this.height)return util.warnOnce("LineAtlas out of space"),null;for(var a=0,r=0;r<t.length;r++)a+=t[r];for(var n=this.width/a,o=n/2,E=t.length%2==1,T=-h;T<=h;T++)for(var R=e.nextRow+h+T,u=e.width*R,d=E?-t[t.length-1]:0,l=t[0],x=1,A=0;A<this.width;A++){for(;l<A/n;)d=l,l+=t[x],E&&x===t.length-1&&(l+=t[0]),x++;var _=Math.abs(A-d*n),p=Math.abs(A-l*n),g=Math.min(_,p),w=x%2==1,D=void 0;if(i){var U=h?T/h*(o+1):0;if(w){var f=o-Math.abs(U);D=Math.sqrt(g*g+f*f)}else D=o-Math.sqrt(g*g+U*U)}else D=(w?1:-1)*g;e.data[3+4*(u+A)]=Math.max(0,Math.min(255,D+128))}var X={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:a};return this.nextRow+=s,this.dirty=!0,X},LineAtlas.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},module.exports=LineAtlas;
},{"../util/util":244}],99:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("../util/browser"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,FrameHistory=_dereq_("./frame_history"),SourceCache=_dereq_("../source/source_cache"),EXTENT=_dereq_("../data/extent"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),util=_dereq_("../util/util"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),RasterBoundsArray=_dereq_("../data/raster_bounds_array"),PosArray=_dereq_("../data/pos_array"),ProgramConfiguration=_dereq_("../data/program_configuration"),shaders=_dereq_("../shaders"),draw={symbol:_dereq_("./draw_symbol"),circle:_dereq_("./draw_circle"),line:_dereq_("./draw_line"),fill:_dereq_("./draw_fill"),extrusion:_dereq_("./draw_extrusion"),raster:_dereq_("./draw_raster"),background:_dereq_("./draw_background"),debug:_dereq_("./draw_debug"),sprite:_dereq_("./draw_sprite"),histogram:_dereq_("./draw_histogram"),airline:_dereq_("./draw_airline"),tracking:_dereq_("./draw_tracking"),symtracking:_dereq_("./draw_symtracking"),dynamicLine:_dereq_("./draw_dynamic_line")},Painter=function(e,r){this.gl=e,this.transform=r,this._tileTextures={},this.frameHistory=new FrameHistory,this.setup(),this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=ProgramConfiguration.createBasicFill(),this.emptyProgramConfiguration=new ProgramConfiguration};Painter.prototype.resize=function(e,r){var t=this.gl;this.width=e*browser.devicePixelRatio,this.height=r*browser.devicePixelRatio,t.viewport(0,0,this.width,this.height),this.viewportTexture&&(this.gl.deleteTexture(this.viewportTexture),this.viewportTexture=null),this.viewportFbo&&(this.gl.deleteFramebuffer(this.viewportFbo),this.viewportFbo=null)},Painter.prototype.setup=function(){var e=this.gl;e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.STENCIL_TEST),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),this._depthMask=!1,e.depthMask(!1);var r=new PosArray;r.emplaceBack(0,0),r.emplaceBack(EXTENT,0),r.emplaceBack(0,EXTENT),r.emplaceBack(EXTENT,EXTENT),this.tileExtentBuffer=Buffer.fromStructArray(r,Buffer.BufferType.VERTEX),this.tileExtentVAO=new VertexArrayObject,this.tileExtentPatternVAO=new VertexArrayObject;var t=new PosArray;t.emplaceBack(0,0),t.emplaceBack(EXTENT,0),t.emplaceBack(EXTENT,EXTENT),t.emplaceBack(0,EXTENT),t.emplaceBack(0,0),this.debugBuffer=Buffer.fromStructArray(t,Buffer.BufferType.VERTEX),this.debugVAO=new VertexArrayObject;var i=new RasterBoundsArray;i.emplaceBack(0,0,0,0),i.emplaceBack(EXTENT,0,EXTENT,0),i.emplaceBack(0,EXTENT,0,EXTENT),i.emplaceBack(EXTENT,EXTENT,EXTENT,EXTENT),this.rasterBoundsBuffer=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX),this.rasterBoundsVAO=new VertexArrayObject,this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))},Painter.prototype.clearColor=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},Painter.prototype.clearStencil=function(){var e=this.gl;e.clearStencil(0),e.stencilMask(255),e.clear(e.STENCIL_BUFFER_BIT)},Painter.prototype.clearDepth=function(){var e=this.gl;e.clearDepth(1),this.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT)},Painter.prototype._renderTileClippingMasks=function(e){var r=this,t=this.gl;t.colorMask(!1,!1,!1,!1),this.depthMask(!1),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE);var i=1;this._tileClippingMaskIDs={};for(var a=0,s=e;a<s.length;a+=1){var o=s[a],n=r._tileClippingMaskIDs[o.id]=i++;t.stencilFunc(t.ALWAYS,n,255);var l=r.useProgram("fill",r.basicFillProgramConfiguration);t.uniformMatrix4fv(l.u_matrix,!1,o.posMatrix),r.tileExtentVAO.bind(t,l,r.tileExtentBuffer),t.drawArrays(t.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}t.stencilMask(0),t.colorMask(!0,!0,!0,!0),this.depthMask(!0),t.enable(t.DEPTH_TEST)},Painter.prototype.enableTileClippingMask=function(e){var r=this.gl;r.stencilFunc(r.EQUAL,this._tileClippingMaskIDs[e.id],255)},Painter.prototype.prepareBuffers=function(){},Painter.prototype.render=function(e,r){if(this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.spriteAtlas=e.spriteAtlas,this.spriteAtlas.setSprite(e.sprite),this.glyphSource=e.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,e.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(r.showOverdrawInspector),this.depthRange=(e._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var t=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];t&&draw.debug(this,t,t.getVisibleCoordinates())}},Painter.prototype.renderPass=function(){var e,r=this,t=this.style._order,i=[];this.currentLayer=this.isOpaquePass?t.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var a=0;a<t.length;a++){var s=r.style._layers[t[r.currentLayer]];s.source!==(e&&e.id)&&(e=r.style.sourceCaches[s.source],i=[],e&&(e.prepare&&e.prepare(),r.clearStencil(),i=e.getVisibleCoordinates(),e.getSource().isTileClipped&&r._renderTileClippingMasks(i)),r.isOpaquePass||i.reverse()),r.renderLayer(r,e,s,i),r.currentLayer+=r.isOpaquePass?-1:1}},Painter.prototype.depthMask=function(e){e!==this._depthMask&&(this._depthMask=e,this.gl.depthMask(e))},Painter.prototype.renderLayer=function(e,r,t,i){t.isHidden(this.transform.zoom)||("background"===t.type||i.length)&&(this.id=t.id,draw[t.type](e,r,t,i))},Painter.prototype.setDepthSublayer=function(e){var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,t=r-1+this.depthRange;this.gl.depthRange(t,r)},Painter.prototype.translatePosMatrix=function(e,r,t,i,a){if(!t[0]&&!t[1])return e;var s=a?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(s){var o=Math.sin(s),n=Math.cos(s);t=[t[0]*n-t[1]*o,t[0]*o+t[1]*n]}var l=[a?t[0]:pixelsToTileUnits(r,t[0],this.transform.zoom),a?t[1]:pixelsToTileUnits(r,t[1],this.transform.zoom),0],h=new Float32Array(16);return mat4.translate(h,e,l),h},Painter.prototype.saveTileTexture=function(e){var r=this._tileTextures[e.size];r?r.push(e):this._tileTextures[e.size]=[e]},Painter.prototype.getTileTexture=function(e){var r=this._tileTextures[e];return r&&r.length>0?r.pop():null},Painter.prototype.lineWidth=function(e){this.gl.lineWidth(util.clamp(e,this.lineWidthRange[0],this.lineWidthRange[1]))},Painter.prototype.showOverdrawInspector=function(e){if(e||this._showOverdrawInspector){this._showOverdrawInspector=e;var r=this.gl;if(e){r.blendFunc(r.CONSTANT_COLOR,r.ONE);r.blendColor(1/8,1/8,1/8,0),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}else r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)}},Painter.prototype.createProgram=function(e,r){var t=this.gl,i=t.createProgram(),a=r.defines().concat("#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1));this._showOverdrawInspector&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(shaders.prelude.fragmentSource,shaders[e].fragmentSource).join("\n"),o=a.concat(shaders.prelude.vertexSource,shaders[e].vertexSource).join("\n"),n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,s),t.compileShader(n),t.attachShader(i,n);var l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,o),t.compileShader(l),t.attachShader(i,l);for(var h=r.interface?r.interface.layoutAttributes:[],c=0;c<h.length;c++)t.bindAttribLocation(i,c,h[c].name);t.linkProgram(i);for(var u=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES),p={program:i,numAttributes:u},d=0;d<u;d++){var g=t.getActiveAttrib(i,d);g&&(p[g.name]=t.getAttribLocation(i,g.name))}for(var T=t.getProgramParameter(i,t.ACTIVE_UNIFORMS),f=0;f<T;f++){var E=t.getActiveUniform(i,f);E&&(p[E.name]=t.getUniformLocation(i,E.name))}return p},Painter.prototype._createProgramCached=function(e,r){this.cache=this.cache||{};var t=""+e+(r.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[t]||(this.cache[t]=this.createProgram(e,r)),this.cache[t]},Painter.prototype.useProgram=function(e,r){var t=this.gl,i=this._createProgramCached(e,r||this.emptyProgramConfiguration);return this.currentProgram!==i&&(t.useProgram(i.program),this.currentProgram=i),i},module.exports=Painter;
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/extent":70,"../data/pos_array":73,"../data/program_configuration":74,"../data/raster_bounds_array":75,"../shaders":104,"../source/pixels_to_tile_units":111,"../source/source_cache":117,"../util/browser":217,"../util/util":244,"./draw_airline":82,"./draw_background":83,"./draw_circle":84,"./draw_debug":86,"./draw_dynamic_line":87,"./draw_extrusion":88,"./draw_fill":89,"./draw_histogram":90,"./draw_line":91,"./draw_raster":92,"./draw_sprite":93,"./draw_symbol":94,"./draw_symtracking":95,"./draw_tracking":96,"./frame_history":97,"./vertex_array_object":102}],100:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("../util/browser"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,FrameHistory=_dereq_("./frame_history"),SourceCache=_dereq_("../source/source_cache"),EXTENT=_dereq_("../data/extent"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),util=_dereq_("../util/util"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("./vertex_array_object"),RasterBoundsArray=_dereq_("../data/raster_bounds_array"),PosArray=_dereq_("../data/pos_array"),ProgramConfiguration=_dereq_("../data/program_configuration"),shaders=_dereq_("../shaders"),draw={symbol:_dereq_("./draw_symbol"),circle:_dereq_("./draw_circle"),line:_dereq_("./draw_line"),fill:_dereq_("./draw_fill"),extrusion:_dereq_("./draw_extrusion"),raster:_dereq_("./draw_raster"),background:_dereq_("./draw_background"),debug:_dereq_("./draw_debug"),sprite:_dereq_("./draw_sprite"),histogram:_dereq_("./draw_histogram"),airline:_dereq_("./draw_airline"),tracking:_dereq_("./draw_tracking"),symtracking:_dereq_("./draw_symtracking"),dynamicLine:_dereq_("./draw_dynamic_line")},Painter=function(e,r){this.gl=e,this.transform=r,this._tileTextures={},this.frameHistory=new FrameHistory,this.setup(),this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=ProgramConfiguration.createBasicFill(),this.emptyProgramConfiguration=new ProgramConfiguration};Painter.prototype.resize=function(e,r){var t=this.gl;this.width=e*browser.devicePixelRatio,this.height=r*browser.devicePixelRatio,t.viewport(0,0,this.width,this.height),this.viewportTexture&&(this.gl.deleteTexture(this.viewportTexture),this.viewportTexture=null),this.viewportFbo&&(this.gl.deleteFramebuffer(this.viewportFbo),this.viewportFbo=null)},Painter.prototype.setup=function(){var e=this.gl;e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.STENCIL_TEST),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),this._depthMask=!1,e.depthMask(!1);var r=new PosArray;r.emplaceBack(0,0),r.emplaceBack(EXTENT,0),r.emplaceBack(0,EXTENT),r.emplaceBack(EXTENT,EXTENT),this.tileExtentBuffer=Buffer.fromStructArray(r,Buffer.BufferType.VERTEX),this.tileExtentVAO=new VertexArrayObject,this.tileExtentPatternVAO=new VertexArrayObject;var t=new PosArray;t.emplaceBack(0,0),t.emplaceBack(EXTENT,0),t.emplaceBack(EXTENT,EXTENT),t.emplaceBack(0,EXTENT),t.emplaceBack(0,0),this.debugBuffer=Buffer.fromStructArray(t,Buffer.BufferType.VERTEX),this.debugVAO=new VertexArrayObject;var i=new RasterBoundsArray;i.emplaceBack(0,0,0,0),i.emplaceBack(EXTENT,0,EXTENT,0),i.emplaceBack(0,EXTENT,0,EXTENT),i.emplaceBack(EXTENT,EXTENT,EXTENT,EXTENT),this.rasterBoundsBuffer=Buffer.fromStructArray(i,Buffer.BufferType.VERTEX),this.rasterBoundsVAO=new VertexArrayObject;var a=new PosArray;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=Buffer.fromStructArray(a,Buffer.BufferType.VERTEX),this.viewportVAO=new VertexArrayObject,this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear")},Painter.prototype.clearColor=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},Painter.prototype.clearStencil=function(){var e=this.gl;e.colorMask(!1,!1,!1,!1),this.depthMask(!1),e.disable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.stencilMask(255),e.stencilOp(e.ZERO,e.ZERO,e.ZERO),e.stencilFunc(e.ALWAYS,0,255);var r=mat4.create();mat4.ortho(r,0,this.width,this.height,0,0,1),mat4.scale(r,r,[e.drawingBufferWidth,e.drawingBufferHeight,0]);var t=this.useProgram("fill",this.basicFillProgramConfiguration);e.uniformMatrix4fv(t.u_matrix,!1,r),this.viewportVAO.bind(e,t,this.viewportBuffer),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.stencilMask(0),e.colorMask(!0,!0,!0,!0),this.depthMask(!0),e.enable(e.DEPTH_TEST)},Painter.prototype.clearDepth=function(){var e=this.gl;e.clearDepth(1),this.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT)},Painter.prototype._renderTileClippingMasks=function(e){var r=this,t=this.gl;t.colorMask(!1,!1,!1,!1),this.depthMask(!1),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE);var i=1;this._tileClippingMaskIDs={};for(var a=0,s=e;a<s.length;a+=1){var o=s[a],n=r._tileClippingMaskIDs[o.id]=i++;t.stencilFunc(t.ALWAYS,n,255);var l=r.useProgram("fill",r.emptyProgramConfiguration);t.uniformMatrix4fv(l.u_matrix,!1,o.posMatrix),r.tileExtentVAO.bind(t,l,r.tileExtentBuffer),t.drawArrays(t.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}t.stencilMask(0),t.colorMask(!0,!0,!0,!0),this.depthMask(!0),t.enable(t.DEPTH_TEST)},Painter.prototype.enableTileClippingMask=function(e){var r=this.gl;r.stencilFunc(r.EQUAL,this._tileClippingMaskIDs[e.id],255)},Painter.prototype.prepareBuffers=function(){},Painter.prototype.render=function(e,r){if(this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.spriteAtlas=e.spriteAtlas,this.spriteAtlas.setSprite(e.sprite),this.glyphSource=e.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,e.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(r.showOverdrawInspector),this.depthRange=(e._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var t=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];t&&draw.debug(this,t,t.getVisibleCoordinates())}},Painter.prototype.renderPass=function(){var e,r=this,t=this.style._order,i=[];this.currentLayer=this.isOpaquePass?t.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var a=0;a<t.length;a++){var s=r.style._layers[t[r.currentLayer]];s.source!==(e&&e.id)&&(e=r.style.sourceCaches[s.source],i=[],e&&(e.prepare&&e.prepare(),r.clearStencil(),i=e.getVisibleCoordinates(),e.getSource().isTileClipped&&r._renderTileClippingMasks(i)),r.isOpaquePass||i.reverse()),r.renderLayer(r,e,s,i),r.currentLayer+=r.isOpaquePass?-1:1}},Painter.prototype.depthMask=function(e){e!==this._depthMask&&(this._depthMask=e,this.gl.depthMask(e))},Painter.prototype.renderLayer=function(e,r,t,i){t.isHidden(this.transform.zoom)||("background"===t.type||i.length)&&(this.id=t.id,draw[t.type](e,r,t,i))},Painter.prototype.setDepthSublayer=function(e){var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,t=r-1+this.depthRange;this.gl.depthRange(t,r)},Painter.prototype.translatePosMatrix=function(e,r,t,i,a){if(!t[0]&&!t[1])return e;var s=a?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(s){var o=Math.sin(s),n=Math.cos(s);t=[t[0]*n-t[1]*o,t[0]*o+t[1]*n]}var l=[a?t[0]:pixelsToTileUnits(r,t[0],this.transform.zoom),a?t[1]:pixelsToTileUnits(r,t[1],this.transform.zoom),0],h=new Float32Array(16);return mat4.translate(h,e,l),h},Painter.prototype.saveTileTexture=function(e){var r=this._tileTextures[e.size];r?r.push(e):this._tileTextures[e.size]=[e]},Painter.prototype.getTileTexture=function(e){var r=this._tileTextures[e];return r&&r.length>0?r.pop():null},Painter.prototype.lineWidth=function(e){this.gl.lineWidth(util.clamp(e,this.lineWidthRange[0],this.lineWidthRange[1]))},Painter.prototype.showOverdrawInspector=function(e){if(e||this._showOverdrawInspector){this._showOverdrawInspector=e;var r=this.gl;if(e){r.blendFunc(r.CONSTANT_COLOR,r.ONE);r.blendColor(1/8,1/8,1/8,0),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}else r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)}},Painter.prototype.createProgram=function(e,r){var t=this.gl,i=t.createProgram(),a=r.defines().concat("#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1));this._showOverdrawInspector&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(shaders.prelude.fragmentSource,shaders[e].fragmentSource).join("\n"),o=a.concat(shaders.prelude.vertexSource,shaders[e].vertexSource).join("\n"),n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,s),t.compileShader(n),t.attachShader(i,n);var l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,o),t.compileShader(l),t.attachShader(i,l);for(var h=r.interface?r.interface.layoutAttributes:[],c=0;c<h.length;c++)t.bindAttribLocation(i,c,h[c].name);t.linkProgram(i);for(var u=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES),p={program:i,numAttributes:u},d=0;d<u;d++){var f=t.getActiveAttrib(i,d);f&&(p[f.name]=t.getAttribLocation(i,f.name))}for(var T=t.getProgramParameter(i,t.ACTIVE_UNIFORMS),E=0;E<T;E++){var g=t.getActiveUniform(i,E);g&&(p[g.name]=t.getUniformLocation(i,g.name))}return p},Painter.prototype._createProgramCached=function(e,r){this.cache=this.cache||{};var t=""+e+(r.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[t]||(this.cache[t]=this.createProgram(e,r)),this.cache[t]},Painter.prototype.useProgram=function(e,r){var t=this.gl,i=this._createProgramCached(e,r||this.emptyProgramConfiguration);return this.currentProgram!==i&&(t.useProgram(i.program),this.currentProgram=i),i},module.exports=Painter;
},{"../_minemap_/gl-matrix":39,"../data/buffer":67,"../data/extent":70,"../data/pos_array":73,"../data/program_configuration":74,"../data/raster_bounds_array":75,"../shaders":104,"../source/pixels_to_tile_units":111,"../source/source_cache":117,"../util/browser":217,"../util/util":244,"./draw_airline":82,"./draw_background":83,"./draw_circle":84,"./draw_debug":86,"./draw_dynamic_line":87,"./draw_extrusion":88,"./draw_fill":89,"./draw_histogram":90,"./draw_line":91,"./draw_raster":92,"./draw_sprite":93,"./draw_symbol":94,"./draw_symtracking":95,"./draw_tracking":96,"./frame_history":97,"./vertex_array_object":102}],101:[function(_dereq_,module,exports){
"use strict";var pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units");exports.isPatternMissing=function(t,r){if(!t)return!1;var e=r.spriteAtlas.getPattern(t.from),i=r.spriteAtlas.getPattern(t.to);return!e||!i},exports.prepare=function(t,r,e){var i=r.gl,o=r.spriteAtlas.getPattern(t.from),n=r.spriteAtlas.getPattern(t.to);i.uniform1i(e.u_image,0),i.uniform2fv(e.u_pattern_tl_a,o.tl),i.uniform2fv(e.u_pattern_br_a,o.br),i.uniform2fv(e.u_pattern_tl_b,n.tl),i.uniform2fv(e.u_pattern_br_b,n.br),i.uniform2fv(e.u_texsize,r.spriteAtlas.getPixelSize()),i.uniform1f(e.u_mix,t.t),i.uniform2fv(e.u_pattern_size_a,o.displaySize),i.uniform2fv(e.u_pattern_size_b,n.displaySize),i.uniform1f(e.u_scale_a,t.fromScale),i.uniform1f(e.u_scale_b,t.toScale),i.activeTexture(i.TEXTURE0),r.spriteAtlas.bind(i,!0)},exports.setTile=function(t,r,e){var i=r.gl;i.uniform1f(e.u_tile_units_to_pixels,1/pixelsToTileUnits(t,1,r.transform.tileZoom));var o=Math.pow(2,t.coord.z),n=t.tileSize*Math.pow(2,r.transform.tileZoom)/o,u=n*(t.coord.x+t.coord.w*o),a=n*t.coord.y;i.uniform2f(e.u_pixel_coord_upper,u>>16,a>>16),i.uniform2f(e.u_pixel_coord_lower,65535&u,65535&a)};
},{"../source/pixels_to_tile_units":111}],102:[function(_dereq_,module,exports){
"use strict";var VertexArrayObject=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};VertexArrayObject.prototype.bind=function(e,t,r,i,n,s,b){void 0===e.extVertexArrayObject&&(e.extVertexArrayObject=e.getExtension("OES_vertex_array_object"));var u=!this.vao||this.boundProgram!==t||this.boundVertexBuffer!==r||this.boundVertexBuffer2!==n||this.boundElementBuffer!==i||this.boundVertexOffset!==s||this.boundDynamicVertexBuffer!==b;!e.extVertexArrayObject||u?(this.freshBind(e,t,r,i,n,s,b),this.gl=e):(e.extVertexArrayObject.bindVertexArrayOES(this.vao),b&&b.bind(e))},VertexArrayObject.prototype.freshBind=function(e,t,r,i,n,s,b){var u,o=t.numAttributes;if(e.extVertexArrayObject)this.vao&&this.destroy(),this.vao=e.extVertexArrayObject.createVertexArrayOES(),e.extVertexArrayObject.bindVertexArrayOES(this.vao),u=0,this.boundProgram=t,this.boundVertexBuffer=r,this.boundVertexBuffer2=n,this.boundElementBuffer=i,this.boundVertexOffset=s,this.boundDynamicVertexBuffer=b;else{u=e.currentNumAttributes||0;for(var a=o;a<u;a++)e.disableVertexAttribArray(a)}r.enableAttributes(e,t),n&&n.enableAttributes(e,t),b&&b.enableAttributes(e,t),r.bind(e),r.setVertexAttribPointers(e,t,s),n&&(n.bind(e),n.setVertexAttribPointers(e,t,s)),b&&(b.bind(e),b.setVertexAttribPointers(e,t,s)),i&&i.bind(e),e.currentNumAttributes=o},VertexArrayObject.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},module.exports=VertexArrayObject;
},{}],103:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util");exports.packUint8ToFloat=function(t,l){return t=util.clamp(Math.floor(t),0,255),l=util.clamp(Math.floor(l),0,255),256*t+l};
},{"../util/util":244}],104:[function(_dereq_,module,exports){
"use strict";module.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n// Unpack a pair of values that have been packed into a single float.\n// The packed values are assumed to be 8-bit unsigned integers, and are\n// packed like so:\n// packedValue = floor(input[0]) * 256 + input[1],\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue = int(packedValue);\n    int v0 = packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\n\n// To minimize the number of attributes needed, we encode a 4-component\n// color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize mediump float radius\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize highp vec4 stroke_color\n    #pragma minemap: initialize mediump float stroke_width\n    #pragma minemap: initialize lowp float stroke_opacity\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main(void) {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize mediump float radius\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize highp vec4 stroke_color\n    #pragma minemap: initialize mediump float stroke_width\n    #pragma minemap: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center = floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position = circle_center;\n        if (u_scale_with_map) {\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\n    } else {\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\n// u_maxzoom is derived from the maximum scale considered by the CollisionTile\n// Labels with placement zoom greater than this value will not be placed,\n// regardless of perspective effects.\nuniform float u_maxzoom;\nuniform sampler2D u_fadetexture;\n\n// v_max_zoom is a collision-box-specific value that controls when line-following\n// collision boxes are used.\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\nvarying float v_perspective_zoom_adjust;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    // Green = no collisions, label is showing\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    // Red = collision, label hidden\n    if (texture2D(u_fadetexture, v_fade_tex).a < 1.0) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    // Faded black = this collision box is not used at this zoom (for curved labels)\n    if (u_zoom >= v_max_zoom + v_perspective_zoom_adjust) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    // Faded blue = the placement scale for this label is beyond the CollisionTile\n    // max scale, so it's impossible for this label to show without collision detection\n    // being run again (the label's glyphs haven't even been added to the symbol bucket)\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\nuniform float u_pitch;\nuniform float u_collision_y_stretch;\nuniform float u_camera_to_center_distance;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\nvarying float v_perspective_zoom_adjust;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = 1.0 + 0.5 * ((camera_to_anchor_distance / u_camera_to_center_distance) - 1.0);\n\n    highp float incidence_stretch  = camera_to_anchor_distance / (u_camera_to_center_distance * cos(u_pitch));\n    highp float collision_adjustment = max(1.0, incidence_stretch / u_collision_y_stretch);\n\n    gl_Position = u_matrix * vec4(a_pos + a_extrude * collision_perspective_ratio * collision_adjustment / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n\n    v_perspective_zoom_adjust = floor(log2(collision_perspective_ratio * collision_adjustment) * 10.0);\n    v_fade_tex = vec2((v_placement_zoom + v_perspective_zoom_adjust) / 255.0, 0.0);\n}\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    gl_Position = u_matrix * vec4(a_pos, step(8192.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 outline_color\n    #pragma minemap: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 outline_color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillWater:{fragmentSource:"#define TAU 6.28318530718\n#define MAX_ITER 5\n#define INTENSITY 0.004\n#define SCALE 1000.0\n\nuniform lowp float u_time;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / SCALE;\n    vec2 p = mod(uv * TAU, TAU) - 250.0;\n    vec2 i = vec2(p);\n    float c = 1.0;\n\n    for (int n = 0; n < MAX_ITER; n++) {\n        float t = 0.5 * u_time * (1.0 - (3.5 / float(n + 1)));\n        i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n        c += 1.0 / length(vec2(p.x / (sin(i.x + t) / INTENSITY), p.y / (cos(i.y + t) / INTENSITY)));\n    }\n    c = 1.17 - pow(c / float(MAX_ITER), 1.4);\n\n    gl_FragColor = vec4(clamp(vec3(pow(abs(c), 8.0)) + vec3(0.0, 0.35, 0.5), 0.0, 1.0), 1.0);\n\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma minemap: define lowp vec4 color\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp vec4 color\n    #pragma minemap: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},extrusion:{fragmentSource:"varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define highp vec4 color\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},extrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},line:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float width\n    #pragma minemap: initialize lowp float floorwidth\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n    #pragma minemap: initialize lowp float floorwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    if (color0.a > 0.0) {\n        color0.rgb = color0.rgb / color0.a;\n    }\n    if (color1.a > 0.0) {\n        color1.rgb = color1.rgb / color1.a;\n    }\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_collision_y_stretch;\n\n#pragma minemap: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp vec2 angle_labelminzoom = unpack_float(a_projected_pos[2]);\n    highp float segment_angle = -angle_labelminzoom[0] / 255.0 * 2.0 * PI;\n    mediump float a_labelminzoom = angle_labelminzoom[1];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    // See comments in symbol_sdf.vertex\n    highp float incidence_stretch  = camera_to_anchor_distance / (u_camera_to_center_distance * cos(u_pitch));\n    highp float collision_adjustment = max(1.0, incidence_stretch / u_collision_y_stretch);\n\n    highp float collision_perspective_ratio = 1.0 + 0.5*((camera_to_anchor_distance / u_camera_to_center_distance) - 1.0);\n    highp float perspective_zoom_adjust = floor(log2(collision_perspective_ratio * collision_adjustment) * 10.0);\n    v_fade_tex = vec2((a_labelminzoom + perspective_zoom_adjust) / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec4 v_data0;\nvarying vec2 v_data1;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    vec2 tex = v_data0.xy;\n    vec2 fade_tex = v_data0.zw;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, fade_tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_collision_y_stretch;\n\nuniform vec2 u_texsize;\n\nvarying vec4 v_data0;\nvarying vec2 v_data1;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp vec2 angle_labelminzoom = unpack_float(a_projected_pos[2]);\n    highp float segment_angle = -angle_labelminzoom[0] / 255.0 * 2.0 * PI;\n    mediump float a_labelminzoom = angle_labelminzoom[1];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    // incidence_stretch is the ratio of how much y space a label takes up on a tile while drawn perpendicular to the viewport vs\n    //  how much space it would take up if it were drawn flat on the tile\n    // Using law of sines, camera_to_anchor/sin(ground_angle) = camera_to_center/sin(incidence_angle)\n    // sin(incidence_angle) = 1/incidence_stretch\n    // Incidence angle 90 -> head on, sin(incidence_angle) = 1, no incidence stretch\n    // Incidence angle 1 -> very oblique, sin(incidence_angle) =~ 0, lots of incidence stretch\n    // ground_angle = u_pitch + PI/2 -> sin(ground_angle) = cos(u_pitch)\n    // This 2D calculation is only exactly correct when gl_Position.x is in the center of the viewport,\n    //  but it's a close enough approximation for our purposes\n    highp float incidence_stretch  = camera_to_anchor_distance / (u_camera_to_center_distance * cos(u_pitch));\n    // incidence_stretch only applies to the y-axis, but without re-calculating the collision tile, we can't\n    // adjust the size of only one axis. So, we do a crude approximation at placement time to get the aspect ratio\n    // about right, and then do the rest of the adjustment here: there will be some extra padding on the x-axis,\n    // but hopefully not too much.\n    // Never make the adjustment less than 1.0: instead of allowing collisions on the x-axis, be conservative on\n    // the y-axis.\n    highp float collision_adjustment = max(1.0, incidence_stretch / u_collision_y_stretch);\n\n    // Floor to 1/10th zoom to dodge precision issues that can cause partially hidden labels\n    highp float collision_perspective_ratio = 1.0 + 0.5*((camera_to_anchor_distance / u_camera_to_center_distance) - 1.0);\n    highp float perspective_zoom_adjust = floor(log2(collision_perspective_ratio * collision_adjustment) * 10.0);\n    vec2 fade_tex = vec2((a_labelminzoom + perspective_zoom_adjust) / 255.0, 0.0);\n\n    v_data0 = vec4(tex.x, tex.y, fade_tex.x, fade_tex.y);\n    v_data1 = vec2(gamma_scale, size);\n}\n"},sprite:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float v_opacity;\nvarying float v_discard;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    if(v_discard<0.0){\n        discard;\n    }\n\n    float opacity_m = v_opacity;\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity) * opacity_m;\n\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\nattribute vec3 a_extra_m;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\nuniform vec4 u_speed_mat;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying float v_opacity;\nvarying float v_discard;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n\n    //处理我的附加库\n        vec3 f_extra_m = vec3(a_extra_m[0] * 3.0 / 255.0,a_extra_m[1], a_extra_m[2]);\n        float status = f_extra_m[2];\n        float link_seq = f_extra_m[1];\n        v_opacity = f_extra_m[0];\n\n        float speed1 = u_speed_mat[0];\n        float speed2 = u_speed_mat[1];\n        float speed3 = u_speed_mat[2];\n        float speed4 = u_speed_mat[3];\n\n        if(status ==1.0){\n            if(link_seq!=speed1){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 2.0){\n            if(link_seq!=speed2){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 3.0){\n            if(link_seq!=speed3){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }else if(status == 4.0){\n            if(link_seq!=speed4){\n                 v_discard = -100.0;\n            }else{\n                v_discard = 100.0;\n            }\n        }\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},histogram:{fragmentSource:"varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    gl_FragColor = v_color * v_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform float u_is_max_length;  // 解决特大高度的柱状图显示问题\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define highp vec4 color\n\nvarying float v_opacity;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? ( u_is_max_length == 1.0 ? height * 100.0 : height * 3.0 ) : base * 300.0, 1);\n    if(t > 0.0){\n        v_opacity = 1.2;\n    }else{\n        v_opacity = 0.1;\n    }\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},histogramColor:{fragmentSource:"uniform vec4 u_color_a;\nuniform vec4 u_color_b;\nuniform vec4 u_color_c;\nuniform vec4 u_color_d;\nuniform vec4 u_color_e;\nuniform float u_max_height;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    if (v_height < 0.25 * u_max_height) {\n        vec4 tmp = u_color_b - u_color_a;\n        vec4 real = tmp * ((v_height) / 0.25 / u_max_height) + u_color_a;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.5 * u_max_height) {\n        vec4 tmp = u_color_c - u_color_b;\n        vec4 real = tmp * ((v_height - 0.25 * u_max_height) / 0.25 / u_max_height) + u_color_b;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.75 * u_max_height) {\n        vec4 tmp = u_color_d - u_color_c;\n        vec4 real = tmp * ((v_height - 0.5 * u_max_height) / 0.25 / u_max_height) + u_color_c;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.8 * u_max_height){\n        vec4 tmp = u_color_e - u_color_d;\n        vec4 real = tmp * ((v_height - 0.75 * u_max_height) / 0.25 / u_max_height) + u_color_d;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else{\n        gl_FragColor = vec4(u_color_e.rgb * v_directional, 1.0);\n    }\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform float u_is_max_length;  // 解决特大高度的柱状图显示问题\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n\n#pragma minemap: define highp vec4 color\n\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? ( u_is_max_length == 1.0 ? height * 100.0 : height * 3.0 ) : base * 300.0, 1);\n    if(t > 0.0){\n        v_opacity = 1.2;\n        v_height = height*3.0;\n    }else{\n        v_opacity = 0.1;\n        v_height = 0.0;\n    }\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n\n    v_directional = directional;\n}\n"},histogramDynamic:{fragmentSource:"varying vec4 v_color;\nuniform vec4 u_color_a;\nuniform vec4 u_color_b;\nuniform vec4 u_color_c;\nuniform vec4 u_color_d;\nuniform vec4 u_color_e;\nuniform float u_max_height;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n\n    if (v_height < 0.2 * u_max_height) {\n        vec4 tmp = u_color_b - u_color_a;\n        vec4 real = tmp * ((v_height) / 0.2 / u_max_height) + u_color_a;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.4 * u_max_height) {\n        vec4 tmp = u_color_c - u_color_b;\n        vec4 real = tmp * ((v_height - 0.2 * u_max_height) / 0.2 / u_max_height) + u_color_b;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.6 * u_max_height) {\n        vec4 tmp = u_color_d - u_color_c;\n        vec4 real = tmp * ((v_height - 0.4 * u_max_height) / 0.2 / u_max_height) + u_color_c;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else if (v_height < 0.8 * u_max_height){\n        vec4 tmp = u_color_e - u_color_d;\n        vec4 real = tmp * ((v_height - 0.6 * u_max_height) / 0.2 / u_max_height) + u_color_d;\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\n    } else{\n        gl_FragColor = vec4(u_color_e.rgb * v_directional, 1.0);\n    }\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp float u_dyn_count;\n\nattribute vec2 a_pos;\n\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\nvarying float v_opacity;\nvarying float v_height;\nvarying float v_directional;\n\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp vec4 heightArr1\n#pragma minemap: define lowp vec4 heightArr2\n#pragma minemap: define lowp vec4 heightArr3\n\nvoid main() {\n    #pragma minemap: initialize lowp float base\n    #pragma minemap: initialize lowp float height\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp vec4 heightArr1\n    #pragma minemap: initialize lowp vec4 heightArr2\n    #pragma minemap: initialize lowp vec4 heightArr3\n\n    //基本思路，将  u_count / 总数， 奇数为加，偶数为减\n\n    // float loops = mod(floor(u_dyn_count / height), 2.0);\n    // float _height = 0.0;\n    // if(loops == 0.0){\n    //     _height = mod(abs(u_dyn_count), abs(height));\n    // }else{\n    //     _height = abs(height) - mod(abs(u_dyn_count), abs(height));\n    // }\n\n    float _height = 0.0;\n    float _num = 0.0;\n    float _height1 = 0.0;\n    float _height2 = 0.0;\n    _num = abs(u_dyn_count) / 500.0;\n    if(_num < 1.0){\n        _height1 = abs(height);\n        _height2 = abs(heightArr1[0])*255.0;\n    }else if(_num < 2.0){\n        _height1 = abs(heightArr1[0])*255.0;\n        _height2 = abs(heightArr1[1])*255.0;\n    }else if(_num < 3.0){\n        _height1 = abs(heightArr1[1])*255.0;\n        _height2 = abs(heightArr1[2])*255.0;\n    }else if(_num < 4.0){\n        _height1 = abs(heightArr1[2])*255.0;\n        _height2 = abs(heightArr1[3])*255.0;\n    }else if(_num < 5.0){\n        _height1 = abs(heightArr1[3])*255.0;\n        _height2 = abs(heightArr2[0])*255.0;\n    }else if(_num < 6.0){\n        _height1 = abs(heightArr2[0])*255.0;\n        _height2 = abs(heightArr2[1])*255.0;\n    }else if(_num < 7.0){\n        _height1 = abs(heightArr2[1])*255.0;\n        _height2 = abs(heightArr2[2])*255.0;\n    }else if(_num < 8.0){\n        _height1 = abs(heightArr2[2])*255.0;\n        _height2 = abs(heightArr2[3])*255.0;\n    }else if(_num < 9.0){\n        _height1 = abs(heightArr2[3])*255.0;\n        _height2 = abs(heightArr3[0])*255.0;\n    }else if(_num < 10.0){\n        _height1 = abs(heightArr3[0])*255.0;\n        _height2 = abs(heightArr3[1])*255.0;\n    }else if(_num < 11.0){\n        _height1 = abs(heightArr3[1])*255.0;\n        _height2 = abs(heightArr3[2])*255.0;\n    }else if(_num < 12.0){\n        _height1 = abs(heightArr3[2])*255.0;\n        _height2 = abs(heightArr3[3])*255.0;\n    }\n\n    _height = 20.0 + (_height1 + (_height2 - _height1) / 500.0 * mod(abs(u_dyn_count), 500.0)) * 1.0;\n\n    base = max(0.0, base);\n    // height1 = max(0.0, height1);\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? _height * 3.0 : base * 3.0, 1);\n\n    if(t > 0.0){\n        v_opacity = 1.2;\n        v_height = _height*3.0;\n    }else{\n        v_opacity = 0.1;\n        v_height = 0.0;\n    }\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(_height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n\n    v_directional = directional;\n}\n"},airline:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float _is_discard;\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    if(_is_discard<0.0) discard;\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute float a_height;\nattribute vec4 a_data;\nattribute vec2 a_seq;  //hack me\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\n//hack me\nuniform float u_start;\nuniform float u_segments;\nuniform float u_discard;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\nvarying float _is_discard;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n\n    float count = mod(u_start,a_seq[1]);\n\n    _is_discard = 100.0;\n     //hack me\n    if(u_discard == 1.0){\n        if((count+u_segments)<=a_seq[1] && (a_seq[0]<(count) || a_seq[0]>(count+u_segments))){\n             _is_discard = -100.0;\n        }else if((count+u_segments)>a_seq[1] && (a_seq[0]> (count+u_segments-a_seq[1]) && a_seq[0]<count)){\n             _is_discard = -100.0;\n        }\n    }\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_height * 10.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},tracking:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\n//hack me\nuniform float u_start;\nuniform float u_end;\nuniform float u_segments;\nuniform float u_reverse;\nuniform float u_reserve;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    mediump float drive_opacity = 1.0;\n    if(u_reserve == 1.0){\n        if(v_seq>u_end){\n            discard;\n        }\n    }else{\n        if(v_seq<u_start || v_seq>u_end){\n            discard;\n        }\n\n        drive_opacity = (v_seq - u_start) / u_segments;\n        if(u_reverse == 1.0){\n            drive_opacity = 1.0 - drive_opacity;\n        }\n    }\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    vec4 tmpColor = vec4(color.xyz,0.25);\n    gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\nattribute float a_seq;  //hack me\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying float v_seq;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n\n    v_seq = a_seq;\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},symtrackingIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma minemap: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    if(v_seq<0.0){\n        discard;\n    }\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_seq;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_collision_y_stretch;\n\n#pragma minemap: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nuniform float u_seq;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize lowp float opacity\n\n    if(a_seq!=u_seq){\n        v_seq = -100.0;\n    }else{\n        v_seq = 100.0;\n    }\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp vec2 angle_labelminzoom = unpack_float(a_projected_pos[2]);\n    highp float segment_angle = -angle_labelminzoom[0] / 255.0 * 2.0 * PI;\n    mediump float a_labelminzoom = angle_labelminzoom[1];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    // See comments in symbol_sdf.vertex\n    highp float incidence_stretch  = camera_to_anchor_distance / (u_camera_to_center_distance * cos(u_pitch));\n    highp float collision_adjustment = max(1.0, incidence_stretch / u_collision_y_stretch);\n\n    highp float collision_perspective_ratio = 1.0 + 0.5*((camera_to_anchor_distance / u_camera_to_center_distance) - 1.0);\n    highp float perspective_zoom_adjust = floor(log2(collision_perspective_ratio * collision_adjustment) * 10.0);\n    v_fade_tex = vec2((a_labelminzoom + perspective_zoom_adjust) / 255.0, 0.0);\n}\n"},symtrackingSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec4 v_data0;\nvarying vec2 v_data1;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    if(v_seq<0.0){\n        discard;\n    }\n\n    vec2 tex = v_data0.xy;\n    vec2 fade_tex = v_data0.zw;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, fade_tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_seq;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_collision_y_stretch;\n\nuniform vec2 u_texsize;\n\nuniform float u_seq;\n\nvarying vec4 v_data0;\nvarying vec2 v_data1;\nvarying float v_seq;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 fill_color\n    #pragma minemap: initialize highp vec4 halo_color\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize lowp float halo_width\n    #pragma minemap: initialize lowp float halo_blur\n\n    if(a_seq!=u_seq){\n        v_seq = -100.0;\n    }else{\n        v_seq = 100.0;\n    }\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp vec2 angle_labelminzoom = unpack_float(a_projected_pos[2]);\n    highp float segment_angle = -angle_labelminzoom[0] / 255.0 * 2.0 * PI;\n    mediump float a_labelminzoom = angle_labelminzoom[1];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    // incidence_stretch is the ratio of how much y space a label takes up on a tile while drawn perpendicular to the viewport vs\n    //  how much space it would take up if it were drawn flat on the tile\n    // Using law of sines, camera_to_anchor/sin(ground_angle) = camera_to_center/sin(incidence_angle)\n    // sin(incidence_angle) = 1/incidence_stretch\n    // Incidence angle 90 -> head on, sin(incidence_angle) = 1, no incidence stretch\n    // Incidence angle 1 -> very oblique, sin(incidence_angle) =~ 0, lots of incidence stretch\n    // ground_angle = u_pitch + PI/2 -> sin(ground_angle) = cos(u_pitch)\n    // This 2D calculation is only exactly correct when gl_Position.x is in the center of the viewport,\n    //  but it's a close enough approximation for our purposes\n    highp float incidence_stretch  = camera_to_anchor_distance / (u_camera_to_center_distance * cos(u_pitch));\n    // incidence_stretch only applies to the y-axis, but without re-calculating the collision tile, we can't\n    // adjust the size of only one axis. So, we do a crude approximation at placement time to get the aspect ratio\n    // about right, and then do the rest of the adjustment here: there will be some extra padding on the x-axis,\n    // but hopefully not too much.\n    // Never make the adjustment less than 1.0: instead of allowing collisions on the x-axis, be conservative on\n    // the y-axis.\n    highp float collision_adjustment = max(1.0, incidence_stretch / u_collision_y_stretch);\n\n    // Floor to 1/10th zoom to dodge precision issues that can cause partially hidden labels\n    highp float collision_perspective_ratio = 1.0 + 0.5*((camera_to_anchor_distance / u_camera_to_center_distance) - 1.0);\n    highp float perspective_zoom_adjust = floor(log2(collision_perspective_ratio * collision_adjustment) * 10.0);\n    vec2 fade_tex = vec2((a_labelminzoom + perspective_zoom_adjust) / 255.0, 0.0);\n\n    v_data0 = vec4(tex.x, tex.y, fade_tex.x, fade_tex.y);\n    v_data1 = vec2(gamma_scale, size);\n}\n"},dynamicLine:{fragmentSource:"#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n\nuniform float u_count;\nuniform float u_segments;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvarying float v_seq;\nvarying vec2 v_info;\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n\n    float total_count = v_info[0];\n    float offset_count = v_info[1];\n    // 不知道为什么一定要把v_seq减2才能匹配上,不理解\n    float actualSeq = v_seq - 2.0;\n    float actualCount = u_count + offset_count;\n    float quotient = floor(actualCount / (total_count + u_segments));\n    float mod1 = mod(quotient, 2.0);\n    float count = mod(actualCount, total_count + u_segments);\n    if(mod1 != 0.0){\n        count = total_count + u_segments - count;\n    }\n\n    float start = count - u_segments;\n    float end = count;\n\n    if(actualSeq<start || actualSeq>end){\n         discard;\n     }\n\n     mediump float drive_opacity = (actualSeq - start) / u_segments;\n     if(mod1 != 0.0){\n         drive_opacity = 1.0 - drive_opacity;\n     }\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    vec4 tmpColor = vec4(color.xyz, 0.25);\n    gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\nattribute float a_seq;\nattribute vec2 a_info;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\nvarying float v_seq;\nvarying vec2 v_info;\n\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n\nvoid main() {\n    #pragma minemap: initialize highp vec4 color\n    #pragma minemap: initialize lowp float blur\n    #pragma minemap: initialize lowp float opacity\n    #pragma minemap: initialize mediump float gapwidth\n    #pragma minemap: initialize lowp float offset\n    #pragma minemap: initialize mediump float width\n\n    v_seq = a_seq;\n    v_info = a_info;\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"}};var re=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,loop=function(e){var n=module.exports[e],a={};n.fragmentSource=n.fragmentSource.replace(re,function(e,n,t,i,o){return a[o]=!0,"define"===n?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+t+" "+i+" "+o+";\n#else\nuniform "+t+" "+i+" u_"+o+";\n#endif\n":"initialize"===n?"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+t+" "+i+" "+o+" = u_"+o+";\n#endif\n":void 0}),n.vertexSource=n.vertexSource.replace(re,function(e,n,t,i,o){var r="float"===i?"vec2":"vec4";if(a[o]){if("define"===n)return"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+t+" "+r+" a_"+o+";\nvarying "+t+" "+i+" "+o+";\n#else\nuniform "+t+" "+i+" u_"+o+";\n#endif\n";if("initialize"===n)return"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+r+"(a_"+o+", a_"+o+"_t);\n#else\n    "+t+" "+i+" "+o+" = u_"+o+";\n#endif\n"}else{if("define"===n)return"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+t+" "+r+" a_"+o+";\n#else\nuniform "+t+" "+i+" u_"+o+";\n#endif\n";if("initialize"===n)return"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+t+" "+i+" "+o+" = unpack_mix_"+r+"(a_"+o+", a_"+o+"_t);\n#else\n    "+t+" "+i+" "+o+" = u_"+o+";\n#endif\n"}})};for(var programName in module.exports)loop(programName);
},{}],105:[function(_dereq_,module,exports){
"use strict";var ImageSource=_dereq_("./image_source"),window=_dereq_("../util/window"),CanvasSource=function(t){function i(i,a,s,n){t.call(this,i,a,s,n),this.options=a,this.animate=void 0===a.animate||a.animate}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){if(this.canvas=this.canvas||window.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions())return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&this.animate&&this.play())},i.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||0!==Object.keys(this.tiles).length&&this._prepareImage(this.map.painter.gl,this.canvas,t)},i.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},i.prototype._hasInvalidDimensions=function(){for(var t=this,i=0,a=[t.canvas.width,t.canvas.height];i<a.length;i+=1){var s=a[i];if(isNaN(s)||s<=0)return!0}return!1},i}(ImageSource);module.exports=CanvasSource;
},{"../util/window":219,"./image_source":109}],106:[function(_dereq_,module,exports){
"use strict";function resolveURL(t){var e=window.document.createElement("a");return e.href=t,e.href}var Evented=_dereq_("../util/evented"),util=_dereq_("../util/util"),window=_dereq_("../util/window"),EXTENT=_dereq_("../data/extent"),ResourceType=_dereq_("../util/ajax").ResourceType,GeoJSONSource=function(t){function e(e,o,r,i){t.call(this),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=r,this.setEventedParent(i),this._data=o.data,this._options=util.extend({},o),void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type);var a=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*a,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*a,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?Math.min(o.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:EXTENT,radius:(o.clusterRadius||50)*a,log:!1}},o.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){if(e)return void t.fire("error",{error:e});t.fire("data",{dataType:"source",sourceDataType:"metadata"})})},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){if(t)return e.fire("error",{error:t});e.fire("data",{dataType:"source",sourceDataType:"content"})}),this},e.prototype._updateWorkerData=function(t){var e=this,o=util.extend({},this.workerOptions),r=this._data;"string"==typeof r?o.request=this.map._transformRequest(resolveURL(r),ResourceType.Source):o.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+".loadData",o,function(o){e._loaded=!0,t(o)},this.workerID)},e.prototype.loadTile=function(t,e){var o=this,r=t.workerID&&"expired"!==t.state?"reloadTile":"loadTile",i={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,angle:this.map.transform.angle,pitch:this.map.transform.pitch,cameraToCenterDistance:this.map.transform.cameraToCenterDistance,cameraToTileDistance:this.map.transform.cameraToTileDistance(t),showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send(r,i,function(r,i){if(t.unloadVectorData(),!t.aborted)return r?e(r):(t.loadVectorData(i,o.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(o)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return util.extend({},this._options,{type:this.type,data:this._data})},e}(Evented);module.exports=GeoJSONSource;
},{"../data/extent":70,"../util/ajax":216,"../util/evented":226,"../util/util":244,"../util/window":219}],107:[function(_dereq_,module,exports){
"use strict";function loadGeoJSONTile(e,r){var t=e.source,o=e.coord;if(!this._geoJSONIndexes[t])return r(null,null);var n=this._geoJSONIndexes[t].getTile(Math.min(o.z,e.maxZoom),o.x,o.y);if(!n)return r(null,null);var u=new GeoJSONWrapper(n.features),i=vtpbf(u);0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),r(null,{vectorTile:u,rawData:i.buffer})}var ajax=_dereq_("../util/ajax"),rewind=_dereq_("../_minemap_/geojson-rewind"),GeoJSONWrapper=_dereq_("./geojson_wrapper"),vtpbf=_dereq_("../_minemap_/vt-pbf"),supercluster=_dereq_("../_minemap_/supercluster"),geojsonvt=_dereq_("../_minemap_/geojson-vt"),VectorTileWorkerSource=_dereq_("./vector_tile_worker_source"),GeoJSONWorkerSource=function(e){function r(r,t,o){e.call(this,r,t,loadGeoJSONTile),o&&(this.loadGeoJSON=o),this._geoJSONIndexes={}}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadData=function(e,r){var t=this;this.loadGeoJSON(e,function(o,n){if(o||!n)return r(o);if("object"!=typeof n)return r(new Error("Input data is not a valid GeoJSON object."));rewind(n,!0);try{t._geoJSONIndexes[e.source]=e.cluster?supercluster(e.superclusterOptions).load(n.features):geojsonvt(n,e.geojsonVtOptions)}catch(o){return r(o)}t.loaded[e.source]={},r(null)})},r.prototype.reloadTile=function(r,t){var o=this.loaded[r.source],n=r.uid;return o&&o[n]?e.prototype.reloadTile.call(this,r,t):this.loadTile(r,t)},r.prototype.loadGeoJSON=function(e,r){if(e.request)ajax.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(e){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(e){this._geoJSONIndexes[e.source]&&delete this._geoJSONIndexes[e.source]},r}(VectorTileWorkerSource);module.exports=GeoJSONWorkerSource;
},{"../_minemap_/geojson-rewind":30,"../_minemap_/geojson-vt":34,"../_minemap_/supercluster":43,"../_minemap_/vt-pbf":50,"../util/ajax":216,"./geojson_wrapper":108,"./vector_tile_worker_source":122}],108:[function(_dereq_,module,exports){
"use strict";var Point=_dereq_("../_minemap_/point-geometry"),toGeoJSON=_dereq_("../_minemap_/vector-tile").VectorTileFeature.prototype.toGeoJSON,EXTENT=_dereq_("../data/extent"),FeatureWrapper=function(e){var t=this;if(this.type=e.type,1===e.type){this.rawGeometry=[];for(var r=0;r<e.geometry.length;r++)t.rawGeometry.push([e.geometry[r]])}else this.rawGeometry=e.geometry;this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10)),this.extent=EXTENT};FeatureWrapper.prototype.loadGeometry=function(){var e=this,t=this.rawGeometry;this.geometry=[];for(var r=0;r<t.length;r++){for(var o=t[r],a=[],i=0;i<o.length;i++)a.push(new Point(o[i][0],o[i][1]));e.geometry.push(a)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,a=-1/0,i=0;i<e.length;i++)for(var n=e[i],p=0;p<n.length;p++){var s=n[p];t=Math.min(t,s.x),r=Math.max(r,s.x),o=Math.min(o,s.y),a=Math.max(a,s.y)}return[t,o,r,a]},FeatureWrapper.prototype.toGeoJSON=function(e,t,r){return toGeoJSON.call(this,e,t,r)};var GeoJSONWrapper=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=EXTENT,this.length=e.length,this._features=e};GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this._features[e])},module.exports=GeoJSONWrapper;
},{"../_minemap_/point-geometry":41,"../_minemap_/vector-tile":46,"../data/extent":70}],109:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),window=_dereq_("../util/window"),TileCoord=_dereq_("./tile_coord"),LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),Evented=_dereq_("../util/evented"),ajax=_dereq_("../util/ajax"),EXTENT=_dereq_("../data/extent"),RasterBoundsArray=_dereq_("../data/raster_bounds_array"),Buffer=_dereq_("../data/buffer"),VertexArrayObject=_dereq_("../render/vertex_array_object"),ImageSource=function(t){function e(e,o,r,i){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(i),this.options=o,this.textureLoaded=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,ajax.getImage(this.map._transformRequest(this.url,ajax.ResourceType.Image),function(e,o){e?t.fire("error",{error:e}):o&&(t.image=o,t._finishLoading())})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,o=t.map(function(t){return e.transform.locationCoordinate(LngLat.convert(t)).zoomTo(0)}),r=this.centerCoord=util.getCoordinatesCenter(o);return r.column=Math.floor(r.column),r.row=Math.floor(r.row),this.coord=new TileCoord(r.zoom,r.column,r.row),this.minzoom=this.maxzoom=r.zoom,this._tileCoords=o.map(function(t){var e=t.zoomTo(r.zoom);return new Point(Math.round((e.column-r.column)*EXTENT),Math.round((e.row-r.row)*EXTENT))}),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},e.prototype._setTile=function(t){this.tiles[String(t.coord.w)]=t;var e=new RasterBoundsArray;e.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),e.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,EXTENT,0),e.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,EXTENT),e.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,EXTENT,EXTENT),t.buckets={},t.boundsBuffer=Buffer.fromStructArray(e,Buffer.BufferType.VERTEX),t.boundsVAO=new VertexArrayObject},e.prototype.prepare=function(){0!==Object.keys(this.tiles).length&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,o){var r=this;this.textureLoaded?o?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof window.HTMLVideoElement||e instanceof window.ImageData||e instanceof window.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e)):(this.textureLoaded=!0,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e));for(var i in r.tiles){var a=r.tiles[i];"loaded"!==a.state&&(a.state="loaded",a.texture=r.texture)}},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.options.url,coordinates:this.coordinates}},e}(Evented);module.exports=ImageSource;
},{"../_minemap_/point-geometry":41,"../data/buffer":67,"../data/extent":70,"../data/raster_bounds_array":75,"../geo/lng_lat":78,"../render/vertex_array_object":102,"../util/ajax":216,"../util/evented":226,"../util/util":244,"../util/window":219,"./tile_coord":120}],110:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),normalizeURL=_dereq_("../util/minemap").normalizeSourceURL;module.exports=function(r,e,i){var u=function(r,e){if(r)return i(r);if(e){var u=util.pick(e,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);e.vector_layers&&(u.vectorLayers=e.vector_layers,u.vectorLayerIds=u.vectorLayers.map(function(r){return r.id})),i(null,u)}};r.url?ajax.getJSON(e(normalizeURL(r.url),ajax.ResourceType.Source),u):browser.frame(function(){return u(null,r)})};
},{"../util/ajax":216,"../util/browser":217,"../util/minemap":236,"../util/util":244}],111:[function(_dereq_,module,exports){
"use strict";var EXTENT=_dereq_("../data/extent");module.exports=function(e,t,r){return t*(EXTENT/(e.tileSize*Math.pow(2,r-e.coord.z)))};
},{"../data/extent":70}],112:[function(_dereq_,module,exports){
"use strict";function sortTilesIn(e,r){var t=e.coord,o=r.coord;return t.z-o.z||t.y-o.y||t.w-o.w||t.x-o.x}function mergeRenderedFeatureLayers(e){for(var r={},t={},o=0,a=e;o<a.length;o+=1){var n=a[o],u=n.queryResults,i=n.wrappedTileID,d=t[i]=t[i]||{};for(var s in u)for(var l=u[s],c=d[s]=d[s]||{},f=r[s]=r[s]||[],y=0,p=l;y<p.length;y+=1){var v=p[y];c[v.featureIndex]||(c[v.featureIndex]=!0,f.push(v.feature))}}return r}var TileCoord=_dereq_("./tile_coord");exports.rendered=function(e,r,t,o,a,n){var u=e.tilesIn(t);u.sort(sortTilesIn);for(var i=[],d=0;d<u.length;d++){var s=u[d],l=s.tile.featureIndex;l&&i.push({wrappedTileID:s.coord.wrapped().id,queryResults:l.query({queryGeometry:s.queryGeometry,scale:s.scale,tileSize:s.tile.tileSize,bearing:n,params:o},r)})}return mergeRenderedFeatureLayers(i)},exports.source=function(e,r){for(var t=e.getRenderableIds().map(function(r){return e.getTileByID(r)}),o=[],a={},n=0;n<t.length;n++){var u=t[n],i=new TileCoord(Math.min(u.sourceMaxZoom,u.coord.z),u.coord.x,u.coord.y,0).id;a[i]||(a[i]=!0,u.querySourceFeatures(o,r))}return o};
},{"./tile_coord":120}],113:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),Evented=_dereq_("../util/evented"),loadTileJSON=_dereq_("./load_tilejson"),normalizeURL=_dereq_("../util/minemap").normalizeTileURL,TileBounds=_dereq_("./tile_bounds"),RasterTileSource=function(e){function t(t,i,r,o){e.call(this),this.id=t,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=util.extend({},i),util.extend(this,util.pick(i,["url","scheme","tileSize"]))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire("dataloading",{dataType:"source"}),loadTileJSON(this._options,this.map._transformRequest,function(t,i){t?e.fire("error",t):i&&(util.extend(e,i),e.setBounds(i.bounds),e.fire("data",{dataType:"source",sourceDataType:"metadata"}),e.fire("data",{dataType:"source",sourceDataType:"content"}))})},t.prototype.onAdd=function(e){this.map=e,this.load()},t.prototype.setBounds=function(e){this.bounds=e,e&&(this.tileBounds=new TileBounds(e,this.minzoom,this.maxzoom))},t.prototype.serialize=function(){return util.extend({},this._options)},t.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e,this.maxzoom)},t.prototype.loadTile=function(e,t){var i=this,r=normalizeURL(e.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);e.request=ajax.getImage(this.map._transformRequest(r,ajax.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)i.state="unloaded",t(null);else if(r)i.state="errored",t(r);else if(o){i.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=i.map.painter.gl;e.texture=i.map.painter.getTileTexture(o.width),e.texture?(a.bindTexture(a.TEXTURE_2D,e.texture),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,o)):(e.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,e.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.map.painter.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.map.painter.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.map.painter.extTextureFilterAnisotropicMax),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o),e.texture.size=o.width),a.generateMipmap(a.TEXTURE_2D),e.state="loaded",t(null)}})},t.prototype.abortTile=function(e){e.request&&(e.request.abort(),delete e.request)},t.prototype.unloadTile=function(e){e.texture&&this.map.painter.saveTileTexture(e.texture)},t}(Evented);module.exports=RasterTileSource;
},{"../util/ajax":216,"../util/evented":226,"../util/minemap":236,"../util/util":244,"./load_tilejson":110,"./tile_bounds":119}],114:[function(_dereq_,module,exports){
"use strict";var config=_dereq_("../util/config"),ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),normalizeURL=_dereq_("../util/minemap").normalizeTileURL,RticCache=function(e){this._source=e,this._separate=e._options?e._options.separate||{}:{},this._isRitcSeparate=this._separate.isRitcSeparate||!1,this._hasTimeStamp=this._separate.hasTimeStamp||!1,this._valueUrl=this._separate.valueUrl||"",this._separateSource=this._separate.separateSource||"",this._separateLayer=this._separate.separateLayer||"",this._timestamp=0,this._tiles={},this._valueTiles={}};RticCache.prototype.updateTimeStamp=function(e){this._timestamp=e},RticCache.prototype.reloadSeparateTile=function(){var e=this;for(var t in e._tiles){var a=e._tiles[t];e.map&&e.onSeparateTileLoaded(a,e._tiles,e.map)}},RticCache.prototype.onSeparateTileLoaded=function(e,t,a){if(this._isRitcSeparate){this._tiles=t,this.map=a;var i=this._source.maxzoom,s=this._source.scheme,r=e.coord.toAccess(i,s);if(r){var o=r.split("_"),l=this._valueUrl.replace("{z}",o[0]).replace("{x}",o[1]).replace("{y}",o[2]);this._hasTimeStamp&&(l=l.replace("{t}",this._timestamp));var c=normalizeURL(l);this._loadValueData(c)}}},RticCache.prototype._loadValueData=function(e){var t=this;ajax.getJSON(e,function(e,a){e||(t._resetValueTiles(a),t._repaintValueLayerColor())})},RticCache.prototype._resetValueTiles=function(e){var t=this;if(e){var a=this._source.maxzoom,i=this._source.scheme,s=[];for(var r in t._tiles){var o=t._tiles[r],l=o.coord.toAccess(a,i);s.push(l),l==e.tile&&(t._valueTiles[l]=e)}Object.keys(this._valueTiles).map(function(e){s.indexOf(e)<0&&delete t._valueTiles[e]})}},RticCache.prototype._getCombineValueData=function(){var e=this,t=["status_0","status_2","status_3"],a={};t.map(function(e){a[e]=[]});for(var i in e._valueTiles)!function(i){var s=e._valueTiles[i];t.map(function(e){s[e]&&s[e].map(function(t){a[e].push(t)})})}(i);return a},RticCache.prototype._getValueColorStyle=function(e){var t={};t.property="rtic_key",t.type="categorical",t.default="#66cc00";for(var a={},i=["status_0","status_2","status_3"],s={status_0:"#999999",status_2:"#ff9900",status_3:"#cc0000"},r=this._separateSource,o=this._separateLayer,l=this.map.style._layers,c=0,p=Object.entries(l);c<p.length;c+=1){var u=p[c],n=(u[0],u[1]);if(n&&"line"==n.type&&n.source==r&&n.sourceLayer==o){var _=null,h=n._paintDeclarations?n._paintDeclarations[""]:null;h&&(_=h["line-color"]?h["line-color"].value:null),_&&"object"==typeof _&&_.stops&&"status"===_.property?_.stops.map(function(e){0===e[0]?s.status_0=e[1]||"#999999":1===e[0]?t.default=e[1]||"#66cc00":2===e[0]?s.status_2=e[1]||"#ff9900":3===e[0]&&(s.status_3=e[1]||"#cc0000")}):_&&"string"==typeof _&&(t.default=_||"#66cc00")}}i.map(function(t){var i=s[t];e[t].map(function(e){a[e]=i})});var f=Object.entries(a);return t.stops=f,f&&0!=f.length?t:t.default},RticCache.prototype._repaintValueLayerColor=function(){var e=this;if(this.map){for(var t=function(t,a){e.map.setPaintProperty(t,"line-color",a)},a=this.map.style._layers,i=this._separateSource,s=this._separateLayer,r=[],o=0,l=Object.entries(a);o<l.length;o+=1){var c=l[o],p=c[0],u=c[1];u&&"line"==u.type&&u.source==i&&u.sourceLayer==s&&r.push(p)}if(r.length>0){var n=this._getValueColorStyle(this._getCombineValueData());r.map(function(a){browser.frame(t.bind(e,a,n))})}}},module.exports=RticCache;
},{"../util/ajax":216,"../util/browser":217,"../util/config":221,"../util/minemap":236}],115:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("../util/ajax"),Evented=_dereq_("../util/evented"),window=_dereq_("../util/window"),pluginRequested=!1,pluginBlobURL=null;module.exports.evented=new Evented,module.exports.registerForPluginAvailability=function(e){return pluginBlobURL?e({pluginBlobURL:pluginBlobURL,errorCallback:module.exports.errorCallback}):module.exports.evented.once("pluginAvailable",e),e},module.exports.createBlobURL=function(e){return window.URL.createObjectURL(new window.Blob([e.data]),{type:"text/javascript"})},module.exports.clearRTLTextPlugin=function(){pluginRequested=!1,pluginBlobURL=null},module.exports.setRTLTextPlugin=function(e,l){if(pluginRequested)throw new Error("setRTLTextPlugin cannot be called multiple times.");pluginRequested=!0,module.exports.errorCallback=l,ajax.getArrayBuffer({url:e},function(e,t){e?l(e):t&&(pluginBlobURL=module.exports.createBlobURL(t),module.exports.evented.fire("pluginAvailable",{pluginBlobURL:pluginBlobURL,errorCallback:l}))})},module.exports.applyArabicShaping=null,module.exports.processBidirectionalText=null;
},{"../util/ajax":216,"../util/evented":226,"../util/window":219}],116:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),sourceTypes={vector:_dereq_("../source/vector_tile_source"),raster:_dereq_("../source/raster_tile_source"),geojson:_dereq_("../source/geojson_source"),video:_dereq_("../source/video_source"),image:_dereq_("../source/image_source"),canvas:_dereq_("../source/canvas_source")};exports.create=function(e,r,o,u){var s=new sourceTypes[r.type](e,r,o,u);if(s.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+s.id);return util.bindAll(["load","abort","unload","serialize","prepare"],s),s},exports.getType=function(e){return sourceTypes[e]},exports.setType=function(e,r){sourceTypes[e]=r};
},{"../source/canvas_source":105,"../source/geojson_source":106,"../source/image_source":109,"../source/raster_tile_source":113,"../source/vector_tile_source":121,"../source/video_source":123,"../util/util":244}],117:[function(_dereq_,module,exports){
"use strict";function coordinateToTilePoint(e,t,o){var i=o.zoomTo(Math.min(e.z,t));return{x:(i.column-(e.x+e.w*Math.pow(2,e.z)))*EXTENT,y:(i.row-e.y)*EXTENT}}function compareKeyZoom(e,t){return e%32-t%32}function isRasterType(e){return"raster"===e||"image"===e||"video"===e}var createSource=_dereq_("./source").create,Tile=_dereq_("./tile"),Evented=_dereq_("../util/evented"),TileCoord=_dereq_("./tile_coord"),Cache=_dereq_("../util/lru_cache"),RticCache=_dereq_("./rtic_cache"),Coordinate=_dereq_("../geo/coordinate"),util=_dereq_("../util/util"),EXTENT=_dereq_("../data/extent"),SourceCache=function(e){function t(t,o,i){var r=this;e.call(this),this.id=t,this.dispatcher=i,this.on("data",function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(r._sourceLoaded=!0),r._sourceLoaded&&!r._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(r.reload(),r.transform&&r.update(r.transform))}),this.on("error",function(){r._sourceErrored=!0}),this._source=createSource(t,o,i,this),this._tiles={},this._cache=new Cache(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._rticCache=new RticCache(this._source),this._isIdRenderable=this._isIdRenderable.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)},t.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},t.prototype.loaded=function(){var e=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in e._tiles){var o=e._tiles[t];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0},t.prototype.getSource=function(){return this._source},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}},t.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},t.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e)},t.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e)},t.prototype.serialize=function(){return this._source.serialize()},t.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},t.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(compareKeyZoom)},t.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},t.prototype._isIdRenderable=function(e){return this._tiles[e].hasData()&&!this._coveredTiles[e]},t.prototype.reload=function(){var e=this;if(this._paused)return void(this._shouldReloadOnResume=!0);this._cache.reset();for(var t in e._tiles)e._reloadTile(t,"reloading")},t.prototype._reloadTile=function(e,t){var o=this._tiles[e];o&&("loading"!==o.state&&(o.state=t),this._loadTile(o,this._tileLoaded.bind(this,o,e,t)))},t.prototype._tileLoaded=function(e,t,o,i){if(i)return e.state="errored",void(404!==i.status&&this._source.fire("error",{tile:e,error:i}));if("vector"==this._source.type&&"loading"==o){this._source.maxzoom,this._source.scheme;this._rticCache.onSeparateTileLoaded(e,this._tiles,this.map)}e.sourceCache=this,e.timeAdded=(new Date).getTime(),"expired"===o&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.fire("data",{dataType:"source",tile:e,coord:e.coord}),this.map&&(this.map.painter.tileExtentVAO.vao=null)},t.prototype.getTile=function(e){return this.getTileByID(e.id)},t.prototype.getTileByID=function(e){return this._tiles[e]},t.prototype.getZoom=function(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)},t.prototype._findLoadedChildren=function(e,t,o){var i=this,r=!1;for(var s in i._tiles){var a=i._tiles[s];if(!(o[s]||!a.hasData()||a.coord.z<=e.z||a.coord.z>t)){var n=Math.pow(2,Math.min(a.coord.z,i._source.maxzoom)-Math.min(e.z,i._source.maxzoom));if(Math.floor(a.coord.x/n)===e.x&&Math.floor(a.coord.y/n)===e.y)for(o[s]=!0,r=!0;a&&a.coord.z-1>e.z;){var c=a.coord.parent(i._source.maxzoom);if(!c)break;a=i._tiles[c.id],a&&a.hasData()&&(delete o[s],o[c.id]=!0)}}}return r},t.prototype.findLoadedParent=function(e,t,o){for(var i=this,r=e.z-1;r>=t;r--){var s=e.parent(i._source.maxzoom);if(!s)return;e=s;var a=String(e.id),n=i._tiles[a];if(n&&n.hasData())return o[a]=!0,n;if(i._cache.has(a))return o[a]=!0,i._cache.getWithoutRemoving(a)}},t.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/e.tileSize)+1,o=Math.ceil(e.height/e.tileSize)+1,i=t*o,r=Math.floor(5*i),s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(s)},t.prototype.update=function(e){var o=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i,r,s,a;this.updateCacheSize(e);var n=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),c=Math.max(n-t.maxOverzooming,this._source.minzoom),h=Math.max(n+t.maxUnderzooming,this._source.minzoom),d={};this._coveredTiles={};var u;for(this.used?this._source.coord?u=e.getVisibleWrappedCoordinates(this._source.coord):(u=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(u=u.filter(function(e){return o._source.hasTile(e)}))):u=[],i=0;i<u.length;i++)r=u[i],s=o._addTile(r),d[r.id]=!0,s.hasData()||o._findLoadedChildren(r,h,d)||(a=o.findLoadedParent(r,c,d))&&o._addTile(a.coord);var l={};if(isRasterType(this._source.type))for(var _=Object.keys(d),m=0;m<_.length;m++){var p=_[m];r=TileCoord.fromID(+p),s=o._tiles[p],s&&((void 0===s.fadeEndTime||s.fadeEndTime>=Date.now())&&(o._findLoadedChildren(r,h,d)&&(d[p]=!0),(a=o.findLoadedParent(r,c,l))&&o._addTile(a.coord)))}var f;for(f in l)d[f]||(o._coveredTiles[f]=!0);for(f in l)d[f]=!0;var T=util.keysDifference(this._tiles,d);for(i=0;i<T.length;i++)o._removeTile(T[i])}},t.prototype._addTile=function(e){var t=this._tiles[e.id];if(t)return t;(t=this._cache.get(e.id))&&(t.redoPlacement(this._source),this._cacheTimers[e.id]&&(clearTimeout(this._cacheTimers[e.id]),delete this._cacheTimers[e.id],this._setTileReloadTimer(e.id,t)));var o=Boolean(t);if(!o){var i=e.z,r=i>this._source.maxzoom?Math.pow(2,i-this._source.maxzoom):1;t=new Tile(e,this._source.tileSize*r,this._source.maxzoom),this._loadTile(t,this._tileLoaded.bind(this,t,e.id,t.state))}return t?(t.uses++,this._tiles[e.id]=t,o||this._source.fire("dataloading",{tile:t,coord:t.coord,dataType:"source"}),t):null},t.prototype._setTileReloadTimer=function(e,t){var o=this,i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout(function(){o._reloadTile(e,"expired"),delete o._timers[e]},i))},t.prototype._setCacheInvalidationTimer=function(e,t){var o=this,i=t.getExpiryTimeout();i&&(this._cacheTimers[e]=setTimeout(function(){o._cache.remove(e),delete o._cacheTimers[e]},i))},t.prototype._removeTile=function(e){var t=this._tiles[e];if(t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),!(t.uses>0)))if(t.stopPlacementThrottler(),t.hasData()){var o=t.coord.wrapped().id;this._cache.add(o,t),this._setCacheInvalidationTimer(o,t)}else t.aborted=!0,this._abortTile(t),this._unloadTile(t)},t.prototype.clearTiles=function(){var e=this;this._shouldReloadOnResume=!1,this._paused=!1;for(var t in e._tiles)e._removeTile(t);this._cache.reset()},t.prototype.tilesIn=function(e){for(var t=this,o=[],i=this.getIds(),r=1/0,s=1/0,a=-1/0,n=-1/0,c=e[0].zoom,h=0;h<e.length;h++){var d=e[h];r=Math.min(r,d.column),s=Math.min(s,d.row),a=Math.max(a,d.column),n=Math.max(n,d.row)}for(var u=0;u<i.length;u++){var l=t._tiles[i[u]],_=TileCoord.fromID(i[u]),m=[coordinateToTilePoint(_,l.sourceMaxZoom,new Coordinate(r,s,c)),coordinateToTilePoint(_,l.sourceMaxZoom,new Coordinate(a,n,c))];if(m[0].x<EXTENT&&m[0].y<EXTENT&&m[1].x>=0&&m[1].y>=0){for(var p=[],f=0;f<e.length;f++)p.push(coordinateToTilePoint(_,l.sourceMaxZoom,e[f]));o.push({tile:l,coord:_,queryGeometry:[p],scale:Math.pow(2,t.transform.zoom-l.coord.z)})}}return o},t.prototype.redoPlacement=function(){for(var e=this,t=this.getIds(),o=0;o<t.length;o++){e.getTileByID(t[o]).redoPlacement(e._source)}},t.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(TileCoord.fromID),o=0,i=t;o<i.length;o+=1){var r=i[o];r.posMatrix=e.transform.calculatePosMatrix(r,e._source.maxzoom)}return t},t}(Evented);SourceCache.maxOverzooming=10,SourceCache.maxUnderzooming=3,module.exports=SourceCache;
},{"../data/extent":70,"../geo/coordinate":77,"../util/evented":226,"../util/lru_cache":235,"../util/util":244,"./rtic_cache":114,"./source":116,"./tile":118,"./tile_coord":120}],118:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),Bucket=_dereq_("../data/bucket"),FeatureIndex=_dereq_("../data/feature_index"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),GeoJSONFeature=_dereq_("../util/vectortile_to_geojson"),featureFilter=_dereq_("../style-spec/feature_filter"),CollisionTile=_dereq_("../symbol/collision_tile"),CollisionBoxArray=_dereq_("../symbol/collision_box"),Throttler=_dereq_("../util/throttler"),CLOCK_SKEW_RETRY_TIMEOUT=3e4,Tile=function(e,t,i){this.coord=e,this.uid=util.uniqueId(),this.uses=0,this.tileSize=t,this.sourceMaxZoom=i,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading",this.placementThrottler=new Throttler(300,this._immediateRedoPlacement.bind(this))};Tile.prototype.registerFadeDuration=function(e,t){var i=t+this.timeAdded;i<Date.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i,e.set(this.fadeEndTime-Date.now()))},Tile.prototype.loadVectorData=function(e,t){this.hasData()&&this.unloadVectorData(),this.state="loaded",e&&(e.rawTileData&&(this.rawTileData=e.rawTileData),this.collisionBoxArray=new CollisionBoxArray(e.collisionBoxArray),this.collisionTile=CollisionTile.deserialize(e.collisionTile,this.collisionBoxArray),this.featureIndex=FeatureIndex.deserialize(e.featureIndex,this.rawTileData,this.collisionTile),this.buckets=Bucket.deserialize(e.buckets,t.style))},Tile.prototype.reloadSymbolData=function(e,t){var i=this;if("unloaded"!==this.state){this.collisionTile=CollisionTile.deserialize(e.collisionTile,this.collisionBoxArray),this.featureIndex&&this.featureIndex.setCollisionTile(this.collisionTile);for(var o in i.buckets){var a=i.buckets[o];"symbol"!==a.layers[0].type&&"symtracking"!==a.layers[0].type||(a.destroy(),delete i.buckets[o])}util.extend(this.buckets,Bucket.deserialize(e.buckets,t))}},Tile.prototype.unloadVectorData=function(){var e=this;for(var t in e.buckets)e.buckets[t].destroy();this.buckets={},this.collisionBoxArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},Tile.prototype.redoPlacement=function(e){if("vector"===e.type||"geojson"===e.type){if("loaded"!==this.state)return void(this.redoWhenDone=!0);if(this.collisionTile){var t=e.map.transform.cameraToTileDistance(this);if(this.angle===e.map.transform.angle&&this.pitch===e.map.transform.pitch&&this.cameraToCenterDistance===e.map.transform.cameraToCenterDistance&&this.showCollisionBoxes===e.map.showCollisionBoxes){if(this.cameraToTileDistance===t)return;if(this.pitch<25)return void(this.cameraToTileDistance=t)}this.angle=e.map.transform.angle,this.pitch=e.map.transform.pitch,this.cameraToCenterDistance=e.map.transform.cameraToCenterDistance,this.cameraToTileDistance=t,this.showCollisionBoxes=e.map.showCollisionBoxes,this.placementSource=e,this.state="reloading",this.placementThrottler.invoke()}}},Tile.prototype._immediateRedoPlacement=function(){var e=this;this.placementSource.dispatcher.send("redoPlacement",{type:this.placementSource.type,uid:this.uid,source:this.placementSource.id,angle:this.angle,pitch:this.pitch,cameraToCenterDistance:this.cameraToCenterDistance,cameraToTileDistance:this.cameraToTileDistance,showCollisionBoxes:this.showCollisionBoxes},function(t,i){"reloading"===e.state&&(e.state="loaded",e.reloadSymbolData(i,e.placementSource.map.style),e.placementSource.fire("data",{tile:e,coord:e.coord,dataType:"source"}),e.placementSource.map&&(e.placementSource.map.painter.tileExtentVAO.vao=null),e.redoWhenDone&&(e.state="reloading",e.redoWhenDone=!1,e._immediateRedoPlacement()))},this.workerID)},Tile.prototype.getBucket=function(e){return this.buckets[e.id]},Tile.prototype.querySourceFeatures=function(e,t){var i=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers);var o=t?t.sourceLayer:"",a=this.vtLayers._geojsonTileLayer||this.vtLayers[o];if(a)for(var r=featureFilter(t&&t.filter),s={z:this.coord.z,x:this.coord.x,y:this.coord.y},l=0;l<a.length;l++){var n=a.feature(l);if(r(n)){var h=new GeoJSONFeature(n,i.coord.z,i.coord.x,i.coord.y);h.tile=s,e.push(h)}}}},Tile.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Tile.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var i=util.parseCacheControl(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var o=Date.now(),a=!1;if(this.expirationTime>o)a=!1;else if(t)if(this.expirationTime<t)a=!0;else{var r=this.expirationTime-t;r?this.expirationTime=o+Math.max(r,CLOCK_SKEW_RETRY_TIMEOUT):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Tile.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Tile.prototype.stopPlacementThrottler=function(){this.placementThrottler.stop(),"reloading"===this.state&&(this.state="loaded")},module.exports=Tile;
},{"../_minemap_/vector-tile":46,"../data/bucket":55,"../data/feature_index":71,"../style-spec/feature_filter":129,"../symbol/collision_box":183,"../symbol/collision_tile":185,"../util/throttler":242,"../util/util":244,"../util/vectortile_to_geojson":245,"pbf":18}],119:[function(_dereq_,module,exports){
"use strict";var LngLatBounds=_dereq_("../geo/lng_lat_bounds"),clamp=_dereq_("../util/util").clamp,TileBounds=function(t,n,o){this.bounds=LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24};TileBounds.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},TileBounds.prototype.contains=function(t,n){var o=n?Math.min(t.z,n):t.z,a={minX:Math.floor(this.lngX(this.bounds.getWest(),o)),minY:Math.floor(this.latY(this.bounds.getNorth(),o)),maxX:Math.ceil(this.lngX(this.bounds.getEast(),o)),maxY:Math.ceil(this.latY(this.bounds.getSouth(),o))};return t.x>=a.minX&&t.x<a.maxX&&t.y>=a.minY&&t.y<a.maxY},TileBounds.prototype.lngX=function(t,n){return(t+180)*(Math.pow(2,n)/360)},TileBounds.prototype.latY=function(t,n){var o=clamp(Math.sin(Math.PI/180*t),-.9999,.9999),a=Math.pow(2,n)/(2*Math.PI);return Math.pow(2,n-1)+.5*Math.log((1+o)/(1-o))*-a},module.exports=TileBounds;
},{"../geo/lng_lat_bounds":79,"../util/util":244}],120:[function(_dereq_,module,exports){
"use strict";function edge(t,i){if(t.row>i.row){var o=t;t=i,i=o}return{x0:t.column,y0:t.row,x1:i.column,y1:i.row,dx:i.column-t.column,dy:i.row-t.row}}function scanSpans(t,i,o,r,e){var h=Math.max(o,Math.floor(i.y0)),s=Math.min(r,Math.ceil(i.y1));if(t.x0===i.x0&&t.y0===i.y0?t.x0+i.dy/t.dy*t.dx<i.x1:t.x1-i.dy/t.dy*t.dx<i.x0){var n=t;t=i,i=n}for(var a=t.dx/t.dy,d=i.dx/i.dy,y=t.dx>0,l=i.dx<0,x=h;x<s;x++){var u=a*Math.max(0,Math.min(t.dy,x+y-t.y0))+t.x0,c=d*Math.max(0,Math.min(i.dy,x+l-i.y0))+i.x0;e(Math.floor(c),Math.ceil(u),x)}}function scanTriangle(t,i,o,r,e,h){var s,n=edge(t,i),a=edge(i,o),d=edge(o,t);n.dy>a.dy&&(s=n,n=a,a=s),n.dy>d.dy&&(s=n,n=d,d=s),a.dy>d.dy&&(s=a,a=d,d=s),n.dy&&scanSpans(d,n,r,e,h),a.dy&&scanSpans(d,a,r,e,h)}function getQuadkey(t,i,o){for(var r,e="",h=t;h>0;h--)r=1<<h-1,e+=(i&r?1:0)+(o&r?2:0);return e}var WhooTS=_dereq_("../_minemap_/whoots-js"),Coordinate=_dereq_("../geo/coordinate"),TileCoord=function(t,i,o,r){(void 0===r||isNaN(r))&&(r=0),this.z=+t,this.x=+i,this.y=+o,this.w=+r,(r*=2)<0&&(r=-1*r-1);var e=1<<this.z;this.id=32*(e*e*r+e*this.y+this.x)+this.z,this.posMatrix=null};TileCoord.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},TileCoord.prototype.toCoordinate=function(t){var i=Math.min(this.z,void 0===t?this.z:t),o=Math.pow(2,i),r=this.y,e=this.x+o*this.w;return new Coordinate(e,r,i)},TileCoord.prototype.url=function(t,i,o){var r=WhooTS.getTileBBox(this.x,this.y,this.z),e=getQuadkey(this.z,this.x,this.y),h=Math.min(this.z,i||this.z),s="tms"===o?Math.pow(2,this.z)-this.y-1:this.y;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",h).replace("{x}",this.x).replace("{y}",s).replace("{m}",Math.floor(this.x/16)).replace("{n}",Math.floor(s/16)).replace("{quadkey}",e).replace("{bbox-epsg-3857}",r)},TileCoord.prototype.toAccess=function(t,i){var o=(WhooTS.getTileBBox(this.x,this.y,this.z),getQuadkey(this.z,this.x,this.y),Math.min(this.z,t||this.z)),r="tms"===i?Math.pow(2,this.z)-this.y-1:this.y;return o+"_"+this.x+"_"+r},TileCoord.prototype.parent=function(t){return 0===this.z?null:this.z>t?new TileCoord(this.z-1,this.x,this.y,this.w):new TileCoord(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},TileCoord.prototype.wrapped=function(){return new TileCoord(this.z,this.x,this.y,0)},TileCoord.prototype.children=function(t){if(this.z>=t)return[new TileCoord(this.z+1,this.x,this.y,this.w)];var i=this.z+1,o=2*this.x,r=2*this.y;return[new TileCoord(i,o,r,this.w),new TileCoord(i,o+1,r,this.w),new TileCoord(i,o,r+1,this.w),new TileCoord(i,o+1,r+1,this.w)]},TileCoord.cover=function(t,i,o,r){function e(t,i,e){var n,a,d,y;if(e>=0&&e<=h)for(n=t;n<i;n++)a=Math.floor(n/h),d=(n%h+h)%h,0!==a&&!0!==r||(y=new TileCoord(o,d,e,a),s[y.id]=y)}void 0===r&&(r=!0);var h=1<<t,s={};return scanTriangle(i[0],i[1],i[2],0,h,e),scanTriangle(i[2],i[3],i[0],0,h,e),Object.keys(s).map(function(t){return s[t]})},TileCoord.fromID=function(t){var i=t%32,o=1<<i,r=(t-i)/32,e=r%o,h=(r-e)/o%o,s=Math.floor(r/(o*o));return s%2!=0&&(s=-1*s-1),s/=2,new TileCoord(i,e,h,s)},module.exports=TileCoord;
},{"../_minemap_/whoots-js":53,"../geo/coordinate":77}],121:[function(_dereq_,module,exports){
"use strict";var Evented=_dereq_("../util/evented"),util=_dereq_("../util/util"),loadTileJSON=_dereq_("./load_tilejson"),normalizeURL=_dereq_("../util/minemap").normalizeTileURL,TileBounds=_dereq_("./tile_bounds"),ResourceType=_dereq_("../util/ajax").ResourceType,VectorTileSource=function(e){function t(t,i,o,r){if(e.call(this),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,util.extend(this,util.pick(i,["url","scheme","tileSize"])),this._options=util.extend({type:"vector"},i),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire("dataloading",{dataType:"source"}),loadTileJSON(this._options,this.map._transformRequest,function(t,i){t?e.fire("error",t):i&&(util.extend(e,i),e.setBounds(i.bounds),e.fire("data",{dataType:"source",sourceDataType:"metadata"}),e.fire("data",{dataType:"source",sourceDataType:"content"}))})},t.prototype.setBounds=function(e){this.bounds=e,e&&(this.tileBounds=new TileBounds(e,this.minzoom,this.maxzoom))},t.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e,this.maxzoom)},t.prototype.onAdd=function(e){this.map=e,this.load()},t.prototype.serialize=function(){return util.extend({},this._options)},t.prototype.loadTile=function(e,t){function i(i,o){if(!e.aborted){if(i)return t(i);this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(this)),t(null),e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)}}var o=e.coord.z>this.maxzoom?Math.pow(2,e.coord.z-this.maxzoom):1,r=normalizeURL(e.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),s={request:this.map._transformRequest(r,ResourceType.Tile),uid:e.uid,coord:e.coord,zoom:e.coord.z,tileSize:this.tileSize*o,type:this.type,source:this.id,overscaling:o,angle:this.map.transform.angle,pitch:this.map.transform.pitch,cameraToCenterDistance:this.map.transform.cameraToCenterDistance,cameraToTileDistance:this.map.transform.cameraToTileDistance(e),showCollisionBoxes:this.map.showCollisionBoxes};e.workerID&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=t:this.dispatcher.send("reloadTile",s,i.bind(this),e.workerID):e.workerID=this.dispatcher.send("loadTile",s,i.bind(this))},t.prototype.abortTile=function(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID)},t.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID)},t}(Evented);module.exports=VectorTileSource;
},{"../util/ajax":216,"../util/evented":226,"../util/minemap":236,"../util/util":244,"./load_tilejson":110,"./tile_bounds":119}],122:[function(_dereq_,module,exports){
"use strict";function loadVectorTile(e,r){var o=ajax.getArrayBuffer(e.request,function(e,o){e?r(e):o&&r(null,{vectorTile:new vt.VectorTile(new Protobuf(o.data)),rawData:o.data,cacheControl:o.cacheControl,expires:o.expires})});return function(){o.abort()}}var ajax=_dereq_("../util/ajax"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),WorkerTile=_dereq_("./worker_tile"),util=_dereq_("../util/util"),VectorTileWorkerSource=function(e,r,o){this.actor=e,this.layerIndex=r,this.loadVectorData=o||loadVectorTile,this.loading={},this.loaded={}};VectorTileWorkerSource.prototype.loadTile=function(e,r){var o=this,t=e.source,a=e.uid;this.loading[t]||(this.loading[t]={});var i=this.loading[t][a]=new WorkerTile(e);i.abort=this.loadVectorData(e,function(e,l){if(delete o.loading[t][a],e||!l)return r(e);var c=l.rawData,n={};l.expires&&(n.expires=l.expires),l.cacheControl&&(n.cacheControl=l.cacheControl),i.vectorTile=l.vectorTile,i.parse(l.vectorTile,o.layerIndex,o.actor,function(e,o,t){if(e||!o)return r(e);r(null,util.extend({rawTileData:c},o,n),t)}),o.loaded[t]=o.loaded[t]||{},o.loaded[t][a]=i})},VectorTileWorkerSource.prototype.reloadTile=function(e,r){function o(e,o){if(this.reloadCallback){var t=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,i.layerIndex,i.actor,t)}r(e,o)}var t=this.loaded[e.source],a=e.uid,i=this;if(t&&t[a]){var l=t[a];"parsing"===l.status?l.reloadCallback=r:"done"===l.status&&l.parse(l.vectorTile,this.layerIndex,this.actor,o.bind(l))}},VectorTileWorkerSource.prototype.abortTile=function(e){var r=this.loading[e.source],o=e.uid;r&&r[o]&&r[o].abort&&(r[o].abort(),delete r[o])},VectorTileWorkerSource.prototype.removeTile=function(e){var r=this.loaded[e.source],o=e.uid;r&&r[o]&&delete r[o]},VectorTileWorkerSource.prototype.redoPlacement=function(e,r){var o=this.loaded[e.source],t=this.loading[e.source],a=e.uid;if(o&&o[a]){var i=o[a],l=i.redoPlacement(e.angle,e.pitch,e.cameraToCenterDistance,e.cameraToTileDistance,e.showCollisionBoxes);l.result&&r(null,l.result,l.transferables)}else t&&t[a]&&(t[a].angle=e.angle)},module.exports=VectorTileWorkerSource;
},{"../_minemap_/vector-tile":46,"../util/ajax":216,"../util/util":244,"./worker_tile":125,"pbf":18}],123:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("../util/ajax"),ImageSource=_dereq_("./image_source"),VideoSource=function(e){function t(t,o,i,r){e.call(this,t,o,i,r),this.roundZoom=!0,this.type="video",this.options=o}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this,t=this.options;this.urls=t.urls,ajax.getVideo(t.urls,function(t,o){if(t)e.fire("error",{error:t});else if(o){e.video=o,e.video.loop=!0;var i;e.video.addEventListener("playing",function(){i=e.map.style.animationLoop.set(1/0),e.map._rerender()}),e.video.addEventListener("pause",function(){e.map.style.animationLoop.cancel(i)}),e.map&&e.video.play(),e._finishLoading()}})},t.prototype.getVideo=function(){return this.video},t.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},t.prototype.prepare=function(){0===Object.keys(this.tiles).length||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},t.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},t}(ImageSource);module.exports=VideoSource;
},{"../util/ajax":216,"./image_source":109}],124:[function(_dereq_,module,exports){
"use strict";var Actor=_dereq_("../util/actor"),StyleLayerIndex=_dereq_("../style/style_layer_index"),VectorTileWorkerSource=_dereq_("./vector_tile_worker_source"),GeoJSONWorkerSource=_dereq_("./geojson_worker_source"),globalRTLTextPlugin=_dereq_("./rtl_text_plugin"),Worker=function(e){var r=this;this.self=e,this.actor=new Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource},this.workerSources={},this.self.registerWorkerSource=function(e,o){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');r.workerSourceTypes[e]=o},this.self.registerRTLTextPlugin=function(e){if(globalRTLTextPlugin.applyArabicShaping||globalRTLTextPlugin.processBidirectionalText)throw new Error("RTL text plugin already registered.");globalRTLTextPlugin.applyArabicShaping=e.applyArabicShaping,globalRTLTextPlugin.processBidirectionalText=e.processBidirectionalText}};Worker.prototype.setLayers=function(e,r){this.getLayerIndex(e).replace(r)},Worker.prototype.updateLayers=function(e,r){this.getLayerIndex(e).update(r.layers,r.removedIds,r.symbolOrder)},Worker.prototype.loadTile=function(e,r,o){this.getWorkerSource(e,r.type).loadTile(r,o)},Worker.prototype.reloadTile=function(e,r,o){this.getWorkerSource(e,r.type).reloadTile(r,o)},Worker.prototype.abortTile=function(e,r){this.getWorkerSource(e,r.type).abortTile(r)},Worker.prototype.removeTile=function(e,r){this.getWorkerSource(e,r.type).removeTile(r)},Worker.prototype.removeSource=function(e,r){var o=this.getWorkerSource(e,r.type);void 0!==o.removeSource&&o.removeSource(r)},Worker.prototype.redoPlacement=function(e,r,o){this.getWorkerSource(e,r.type).redoPlacement(r,o)},Worker.prototype.loadWorkerSource=function(e,r,o){try{this.self.importScripts(r.url),o()}catch(e){o(e)}},Worker.prototype.loadRTLTextPlugin=function(e,r,o){try{globalRTLTextPlugin.applyArabicShaping||globalRTLTextPlugin.processBidirectionalText||(this.self.importScripts(r),globalRTLTextPlugin.applyArabicShaping&&globalRTLTextPlugin.processBidirectionalText||o(new Error("RTL Text Plugin failed to import scripts from "+r)))}catch(e){o(e)}},Worker.prototype.getLayerIndex=function(e){var r=this.layerIndexes[e];return r||(r=this.layerIndexes[e]=new StyleLayerIndex),r},Worker.prototype.getWorkerSource=function(e,r){var o=this;if(this.workerSources[e]||(this.workerSources[e]={}),!this.workerSources[e][r]){var t={send:function(r,t,i,n){o.actor.send(r,t,i,n,e)}};this.workerSources[e][r]=new this.workerSourceTypes[r](t,this.getLayerIndex(e))}return this.workerSources[e][r]},module.exports=function(e){return new Worker(e)};
},{"../style/style_layer_index":177,"../util/actor":215,"./geojson_worker_source":107,"./rtl_text_plugin":115,"./vector_tile_worker_source":122}],125:[function(_dereq_,module,exports){
"use strict";function recalculateLayers(e,i){for(var t=0,r=e.layers;t<r.length;t+=1){r[t].recalculate(i)}}function serializeBuckets(e,i){return e.filter(function(e){return!e.isEmpty()}).map(function(e){return e.serialize(i)})}var FeatureIndex=_dereq_("../data/feature_index"),CollisionTile=_dereq_("../symbol/collision_tile"),CollisionBoxArray=_dereq_("../symbol/collision_box"),DictionaryCoder=_dereq_("../util/dictionary_coder"),util=_dereq_("../util/util"),WorkerTile=function(e){this.coord=e.coord,this.uid=e.uid,this.zoom=e.zoom,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=e.overscaling,this.angle=e.angle,this.pitch=e.pitch,this.cameraToCenterDistance=e.cameraToCenterDistance,this.cameraToTileDistance=e.cameraToTileDistance,this.showCollisionBoxes=e.showCollisionBoxes};WorkerTile.prototype.parse=function(e,i,t,r){var o=this;this.status="parsing",this.data=e,this.collisionBoxArray=new CollisionBoxArray;var s=new DictionaryCoder(Object.keys(e.layers).sort()),a=new FeatureIndex(this.coord,this.overscaling);a.bucketLayerIDs=[];var n={},l={featureIndex:a,iconDependencies:{},glyphDependencies:{}},c=i.familiesBySource[this.source];for(var u in c){var h=e.layers[u];if(h){for(var y=s.encode(u),m=[],p=0;p<h.length;p++){var d=h.feature(p);m.push({feature:d,index:p,sourceLayerIndex:y})}for(var f=0,v=c[u];f<v.length;f+=1){var g=v[f],T=g[0];if(!(T.minzoom&&o.zoom<Math.floor(T.minzoom))&&!(T.maxzoom&&o.zoom>=T.maxzoom||T.layout&&"none"===T.layout.visibility)){for(var x=0,b=g;x<b.length;x+=1){b[x].recalculate(o.zoom)}(n[T.id]=T.createBucket({index:a.bucketLayerIDs.length,layers:g,zoom:o.zoom,overscaling:o.overscaling,collisionBoxArray:o.collisionBoxArray})).populate(m,l),a.bucketLayerIDs.push(g.map(function(e){return e.id}))}}}}var k=function(e){o.status="done",a.paintPropertyStatistics={};for(var i in n)util.extend(a.paintPropertyStatistics,n[i].getPaintPropertyStatistics());var t=[];r(null,{buckets:serializeBuckets(util.values(n),t),featureIndex:a.serialize(t),collisionTile:e.serialize(t),collisionBoxArray:o.collisionBoxArray.serialize()},t)};this.symbolBuckets=[];for(var B=i.symbolOrder.length-1;B>=0;B--){var z=n[i.symbolOrder[B]];z&&o.symbolBuckets.push(z)}if(0===this.symbolBuckets.length)return k(new CollisionTile(this.angle,this.pitch,this.cameraToCenterDistance,this.cameraToTileDistance,this.collisionBoxArray));var D=0,C=Object.keys(l.iconDependencies),A=util.mapObject(l.glyphDependencies,function(e){return Object.keys(e).map(Number)}),w=function(e){if(e)return r(e);if(2===++D){for(var i=new CollisionTile(o.angle,o.pitch,o.cameraToCenterDistance,o.cameraToTileDistance,o.collisionBoxArray),t=0,s=o.symbolBuckets;t<s.length;t+=1){var a=s[t];recalculateLayers(a,o.zoom),a.prepare(A,C),a.place(i,o.showCollisionBoxes)}k(i)}};Object.keys(A).length?t.send("getGlyphs",{uid:this.uid,stacks:A},function(e,i){A=i,w(e)}):w(),C.length?t.send("getIcons",{icons:C},function(e,i){C=i,w(e)}):w()},WorkerTile.prototype.redoPlacement=function(e,i,t,r,o){var s=this;if(this.angle=e,this.pitch=i,this.cameraToCenterDistance=t,this.cameraToTileDistance=r,"done"!==this.status)return{};for(var a=new CollisionTile(this.angle,this.pitch,this.cameraToCenterDistance,this.cameraToTileDistance,this.collisionBoxArray),n=0,l=s.symbolBuckets;n<l.length;n+=1){var c=l[n];recalculateLayers(c,s.zoom),c.place(a,o)}var u=[];return{result:{buckets:serializeBuckets(this.symbolBuckets,u),collisionTile:a.serialize(u)},transferables:u}},module.exports=WorkerTile;
},{"../data/feature_index":71,"../symbol/collision_box":183,"../symbol/collision_tile":185,"../util/dictionary_coder":222,"../util/util":244}],126:[function(_dereq_,module,exports){
"use strict";function deref(r,e){var f={};for(var t in r)"ref"!==t&&(f[t]=r[t]);return refProperties.forEach(function(r){r in e&&(f[r]=e[r])}),f}function derefLayers(r){r=r.slice();for(var e=Object.create(null),f=0;f<r.length;f++)e[r[f].id]=r[f];for(var t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=deref(r[t],e[r[t].ref]));return r}var refProperties=_dereq_("./util/ref_properties");module.exports=derefLayers;
},{"./util/ref_properties":139}],127:[function(_dereq_,module,exports){
"use strict";function diffSources(e,r,o,a){e=e||{},r=r||{};var s;for(s in e)e.hasOwnProperty(s)&&(r.hasOwnProperty(s)||(o.push({command:operations.removeSource,args:[s]}),a[s]=!0));for(s in r)r.hasOwnProperty(s)&&(e.hasOwnProperty(s)?isEqual(e[s],r[s])||(o.push({command:operations.removeSource,args:[s]}),o.push({command:operations.addSource,args:[s,r[s]]}),a[s]=!0):o.push({command:operations.addSource,args:[s,r[s]]}))}function diffLayerPropertyChanges(e,r,o,a,s,t){e=e||{},r=r||{};var n;for(n in e)e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:t,args:[a,n,r[n],s]}));for(n in r)r.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:t,args:[a,n,r[n],s]}))}function pluckId(e){return e.id}function indexById(e,r){return e[r.id]=r,e}function diffLayers(e,r,o){e=e||[],r=r||[];var a,s,t,n,i,p,m,u=e.map(pluckId),l=r.map(pluckId),y=e.reduce(indexById,{}),c=r.reduce(indexById,{}),d=u.slice(),h=Object.create(null);for(a=0,s=0;a<u.length;a++)t=u[a],c.hasOwnProperty(t)?s++:(o.push({command:operations.removeLayer,args:[t]}),d.splice(d.indexOf(t,s),1));for(a=0,s=0;a<l.length;a++)t=l[l.length-1-a],d[d.length-1-a]!==t&&(y.hasOwnProperty(t)?(o.push({command:operations.removeLayer,args:[t]}),d.splice(d.lastIndexOf(t,d.length-s),1)):s++,p=d[d.length-a],o.push({command:operations.addLayer,args:[c[t],p]}),d.splice(d.length-a,0,t),h[t]=!0);for(a=0;a<l.length;a++)if(t=l[a],n=y[t],i=c[t],!h[t]&&!isEqual(n,i))if(isEqual(n.source,i.source)&&isEqual(n["source-layer"],i["source-layer"])&&isEqual(n.type,i.type)){diffLayerPropertyChanges(n.layout,i.layout,o,t,null,operations.setLayoutProperty),diffLayerPropertyChanges(n.paint,i.paint,o,t,null,operations.setPaintProperty),isEqual(n.filter,i.filter)||o.push({command:operations.setFilter,args:[t,i.filter]}),isEqual(n.minzoom,i.minzoom)&&isEqual(n.maxzoom,i.maxzoom)||o.push({command:operations.setLayerZoomRange,args:[t,i.minzoom,i.maxzoom]});for(m in n)n.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?diffLayerPropertyChanges(n[m],i[m],o,t,m.slice(6),operations.setPaintProperty):isEqual(n[m],i[m])||o.push({command:operations.setLayerProperty,args:[t,m,i[m]]}));for(m in i)i.hasOwnProperty(m)&&!n.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?diffLayerPropertyChanges(n[m],i[m],o,t,m.slice(6),operations.setPaintProperty):isEqual(n[m],i[m])||o.push({command:operations.setLayerProperty,args:[t,m,i[m]]}))}else o.push({command:operations.removeLayer,args:[t]}),p=d[d.lastIndexOf(t)+1],o.push({command:operations.addLayer,args:[i,p]})}function diffStyles(e,r){if(!e)return[{command:operations.setStyle,args:[r]}];var o=[];try{if(!isEqual(e.version,r.version))return[{command:operations.setStyle,args:[r]}];isEqual(e.center,r.center)||o.push({command:operations.setCenter,args:[r.center]}),isEqual(e.zoom,r.zoom)||o.push({command:operations.setZoom,args:[r.zoom]}),isEqual(e.bearing,r.bearing)||o.push({command:operations.setBearing,args:[r.bearing]}),isEqual(e.pitch,r.pitch)||o.push({command:operations.setPitch,args:[r.pitch]}),isEqual(e.sprite,r.sprite)||o.push({command:operations.setSprite,args:[r.sprite]}),isEqual(e.glyphs,r.glyphs)||o.push({command:operations.setGlyphs,args:[r.glyphs]}),isEqual(e.transition,r.transition)||o.push({command:operations.setTransition,args:[r.transition]}),isEqual(e.light,r.light)||o.push({command:operations.setLight,args:[r.light]});var a={},s=[];diffSources(e.sources,r.sources,s,a);var t=[];e.layers&&e.layers.forEach(function(e){a[e.source]?o.push({command:operations.removeLayer,args:[e.id]}):t.push(e)}),o=o.concat(s),diffLayers(t,r.layers,o)}catch(e){console.warn("Unable to compute style diff:",e),o=[{command:operations.setStyle,args:[r]}]}return o}var isEqual=_dereq_("lodash.isequal"),operations={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};module.exports=diffStyles,module.exports.operations=operations;
},{"lodash.isequal":15}],128:[function(_dereq_,module,exports){
"use strict";function ValidationError(r,i){for(var t=[],o=arguments.length-2;o-- >0;)t[o]=arguments[o+2];this.message=(r?r+": ":"")+format.apply(format,t),null!==i&&void 0!==i&&i.__line__&&(this.line=i.__line__)}var format=_dereq_("util").format;module.exports=ValidationError;
},{"util":24}],129:[function(_dereq_,module,exports){
"use strict";function createFilter(e){return new Function("f","var p = (f && f.properties || {}); return "+compile(e))}function compile(e){if(!e)return"true";var i=e[0];return e.length<=1?"any"===i?"false":"true":"("+("=="===i?compileComparisonOp(e[1],e[2],"===",!1):"!="===i?compileComparisonOp(e[1],e[2],"!==",!1):"<"===i||">"===i||"<="===i||">="===i?compileComparisonOp(e[1],e[2],i,!0):"any"===i?compileLogicalOp(e.slice(1),"||"):"all"===i?compileLogicalOp(e.slice(1),"&&"):"none"===i?compileNegation(compileLogicalOp(e.slice(1),"||")):"in"===i?compileInOp(e[1],e.slice(2)):"!in"===i?compileNegation(compileInOp(e[1],e.slice(2))):"has"===i?compileHasOp(e[1]):"!has"===i?compileNegation(compileHasOp(e[1])):"arrin"===i?compileArrInOp(e[1],e.slice(2)):"!arrin"===i?compileNegation(compileArrInOp(e[1],e.slice(2))):"true")+")"}function compilePropertyReference(e){return"$type"===e?"f.type":"$id"===e?"f.id":"p["+JSON.stringify(e)+"]"}function compileComparisonOp(e,i,n,r){var o=compilePropertyReference(e),t="$type"===e?types.indexOf(i):JSON.stringify(i);return(r?"typeof "+o+"=== typeof "+t+"&&":"")+o+n+t}function compileLogicalOp(e,i){return e.map(compile).join(i)}function compileInOp(e,i){"$type"===e&&(i=i.map(function(e){return types.indexOf(e)}));var n=JSON.stringify(i.sort(compare)),r=compilePropertyReference(e);return i.length<=200?n+".indexOf("+r+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+r+", "+n+",0,"+(i.length-1)+")"}function compileArrInOp(e,i){"$type"===e&&(i=i.map(function(e){return types.indexOf(e)}));var n=JSON.stringify(i.sort(compare));return'function(v, a,i, j) {while (i <= j) { if (!v)return false;var m = v.split(","); if (m.indexOf(a[i]) > -1) return true; i = i + 1;}return false; }('+compilePropertyReference(e)+", "+n+",0,"+(i.length-1)+")"}function compileHasOp(e){return"$id"===e?'"id" in f':JSON.stringify(e)+" in p"}function compileNegation(e){return"!("+e+")"}function compare(e,i){return e<i?-1:e>i?1:0}module.exports=createFilter;var types=["Unknown","Point","LineString","Polygon"];
},{}],130:[function(_dereq_,module,exports){
"use strict";function xyz2lab(r){return r>t3?Math.pow(r,1/3):r/t2+t0}function lab2xyz(r){return r>t1?r*r*r:t2*(r-t0)}function xyz2rgb(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function rgb2xyz(r){return r/=255,r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function rgbToLab(r){var t=rgb2xyz(r[0]),a=rgb2xyz(r[1]),n=rgb2xyz(r[2]),b=xyz2lab((.4124564*t+.3575761*a+.1804375*n)/Xn),o=xyz2lab((.2126729*t+.7151522*a+.072175*n)/Yn);return[116*o-16,500*(b-o),200*(o-xyz2lab((.0193339*t+.119192*a+.9503041*n)/Zn)),r[3]]}function labToRgb(r){var t=(r[0]+16)/116,a=isNaN(r[1])?t:t+r[1]/500,n=isNaN(r[2])?t:t-r[2]/200;return t=Yn*lab2xyz(t),a=Xn*lab2xyz(a),n=Zn*lab2xyz(n),[xyz2rgb(3.2404542*a-1.5371385*t-.4985314*n),xyz2rgb(-.969266*a+1.8760108*t+.041556*n),xyz2rgb(.0556434*a-.2040259*t+1.0572252*n),r[3]]}function rgbToHcl(r){var t=rgbToLab(r),a=t[0],n=t[1],b=t[2],o=Math.atan2(b,n)*rad2deg;return[o<0?o+360:o,Math.sqrt(n*n+b*b),a,r[3]]}function hclToRgb(r){var t=r[0]*deg2rad,a=r[1];return labToRgb([r[2],Math.cos(t)*a,Math.sin(t)*a,r[3]])}var Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad=Math.PI/180,rad2deg=180/Math.PI;module.exports={lab:{forward:rgbToLab,reverse:labToRgb},hcl:{forward:rgbToHcl,reverse:hclToRgb}};
},{}],131:[function(_dereq_,module,exports){
"use strict";function identityFunction(t){return t}function createFunction(t,e){var o,n="color"===e.type;if(isFunctionDefinition(t)){var r=t.stops&&"object"==typeof t.stops[0][0],a=r||void 0!==t.property,i=r||!a,s=t.type||("interpolated"===e.function?"exponential":"interval");n&&(t=extend({},t),t.stops&&(t.stops=t.stops.map(function(t){return[t[0],parseColor(t[1])]})),t.default?t.default=parseColor(t.default):t.default=parseColor(e.default));var u,p,l;if("exponential"===s)u=evaluateExponentialFunction;else if("interval"===s)u=evaluateIntervalFunction;else if("categorical"===s){u=evaluateCategoricalFunction,p=Object.create(null);for(var c=0,f=t.stops;c<f.length;c+=1){var v=f[c];p[v[0]]=v[1]}l=typeof t.stops[0][0]}else{if("identity"!==s)throw new Error('Unknown function type "'+s+'"');u=evaluateIdentityFunction}var d;if(t.colorSpace&&"rgb"!==t.colorSpace){if(!colorSpaces[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);var y=colorSpaces[t.colorSpace];t=JSON.parse(JSON.stringify(t));for(var F=0;F<t.stops.length;F++)t.stops[F]=[t.stops[F][0],y.forward(t.stops[F][1])];d=y.reverse}else d=identityFunction;if(r){for(var h={},g=[],m=0;m<t.stops.length;m++){var C=t.stops[m],S=C[0].zoom;void 0===h[S]&&(h[S]={zoom:S,type:t.type,property:t.property,default:t.default,stops:[]},g.push(S)),h[S].stops.push([C[0].value,C[1]])}for(var T=[],x=0,b=g;x<b.length;x+=1){var q=b[x];T.push([h[q].zoom,createFunction(h[q],e)])}o=function(o,n){return d(evaluateExponentialFunction({stops:T,base:t.base},e,o)(o,n))},o.isFeatureConstant=!1,o.isZoomConstant=!1}else i?(o=function(o){return d(u(t,e,o,p,l))},o.isFeatureConstant=!0,o.isZoomConstant=!1):(o=function(o,n){var r=n[t.property];return void 0===r?coalesce(t.default,e.default):d(u(t,e,r,p,l))},o.isFeatureConstant=!1,o.isZoomConstant=!0)}else n&&t&&(t=parseColor(t)),o=function(){return t},o.isFeatureConstant=!0,o.isZoomConstant=!0;return o}function coalesce(t,e,o){return void 0!==t?t:void 0!==e?e:void 0!==o?o:void 0}function evaluateCategoricalFunction(t,e,o,n,r){return coalesce(typeof o===r?n[o]:void 0,t.default,e.default)}function evaluateIntervalFunction(t,e,o){if("number"!==getType(o))return coalesce(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(o<=t.stops[0][0])return t.stops[0][1];if(o>=t.stops[n-1][0])return t.stops[n-1][1];var r=findStopLessThanOrEqualTo(t.stops,o);return t.stops[r][1]}function evaluateExponentialFunction(t,e,o){var n=void 0!==t.base?t.base:1;if("number"!==getType(o))return coalesce(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(o<=t.stops[0][0])return t.stops[0][1];if(o>=t.stops[r-1][0])return t.stops[r-1][1];var a=findStopLessThanOrEqualTo(t.stops,o),i=interpolationFactor(o,n,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],p=interpolate[e.type]||identityFunction;return"function"==typeof s?function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var o=s.apply(void 0,t),n=u.apply(void 0,t);if(void 0!==o&&void 0!==n)return p(o,n,i)}:p(s,u,i)}function evaluateIdentityFunction(t,e,o){return"color"===e.type?o=parseColor(o):getType(o)===e.type||"enum"===e.type&&e.values[o]||(o=void 0),coalesce(o,t.default,e.default)}function findStopLessThanOrEqualTo(t,e){for(var o,n,r=t.length,a=0,i=r-1,s=0;a<=i;){if(s=Math.floor((a+i)/2),o=t[s][0],n=t[s+1][0],e===o||e>o&&e<n)return s;o<e?a=s+1:o>e&&(i=s-1)}return Math.max(s-1,0)}function isFunctionDefinition(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}function interpolationFactor(t,e,o,n){var r=n-o,a=t-o;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}var colorSpaces=_dereq_("./color_spaces"),parseColor=_dereq_("../util/parse_color"),extend=_dereq_("../util/extend"),getType=_dereq_("../util/get_type"),interpolate=_dereq_("../util/interpolate");module.exports=createFunction,module.exports.isFunctionDefinition=isFunctionDefinition,module.exports.interpolationFactor=interpolationFactor,module.exports.findStopLessThanOrEqualTo=findStopLessThanOrEqualTo;
},{"../util/extend":135,"../util/get_type":136,"../util/interpolate":137,"../util/parse_color":138,"./color_spaces":130}],132:[function(_dereq_,module,exports){
"use strict";function key(r){return stringify(refProperties.map(function(e){return r[e]}))}function groupByLayout(r){for(var e={},t=0;t<r.length;t++){var i=key(r[t]),u=e[i];u||(u=e[i]=[]),u.push(r[t])}var n=[];for(var o in e)n.push(e[o]);return n}var refProperties=_dereq_("./util/ref_properties"),stringify=_dereq_("fast-stable-stringify");module.exports=groupByLayout;
},{"./util/ref_properties":139,"fast-stable-stringify":3}],133:[function(_dereq_,module,exports){
"use strict";module.exports=_dereq_("./v8.json");
},{"./v8.json":134}],134:[function(_dereq_,module,exports){
module.exports={"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_tile","source_geojson","source_video","source_image","source_canvas"],"source_tile":{"type":{"required":true,"type":"enum","values":{"vector":{},"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_canvas":{"type":{"required":true,"type":"enum","values":{"canvas":{}}},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}},"animate":{"type":"boolean","default":"true"},"canvas":{"type":"string","required":true}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"extrusion":{},"raster":{},"background":{},"sprite":{},"histogram":{},"airline":{},"tracking":{},"symtracking":{},"dynamicLine":{}}},"metadata":{"type":"*"},"ref":{"type":"string"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"paint.*":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_extrusion","layout_symbol","layout_raster","layout_background","layout_sprite","layout_histogram","layout_airline","layout_tracking","layout_symtracking","layout_dynamicLine"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_fill":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_circle":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_line":{"line-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"line-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"line-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"miter"}]},"line-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_symbol":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{},"line":{}},"default":"point"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","requires":[{"symbol-placement":"line"}]},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image","text-field"]},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"units":"factor of the original icon size","requires":["icon-image"]},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"]},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"tokens":true},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","requires":["icon-image"]},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","requires":["icon-image"]},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"requires":["icon-image"]},"icon-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":"","tokens":true},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"]},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"]},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field"]},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"requires":["text-field",{"symbol-placement":"line"}]},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"]},"text-offset":{"type":"array","value":"number","units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"length":2,"default":[0,0],"requires":["text-field"]},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field","icon-image"]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_sprite":{"sprite-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"sprite-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"sprite-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"sprite-join":"miter"}]},"sprite-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"sprite-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_histogram":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"histogram-color-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"histogram-max-height-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"layout_airline":{"airline-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"airline-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"airline-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"airline-join":"miter"}]},"airline-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"airline-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_tracking":{"tracking-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"tracking-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"tracking-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"miter"}]},"tracking-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"tracking-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"tracking-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop"}},"layout_symtracking":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{},"line":{}},"default":"point"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","requires":[{"symtracking-placement":"line"}]},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image","text-field"]},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"units":"factor of the original icon size","requires":["icon-image"]},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"]},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"tokens":true},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","requires":["icon-image"]},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","requires":["icon-image"]},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"requires":["icon-image"]},"icon-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":"","tokens":true},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"]},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"]},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field"]},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"requires":["text-field",{"symbol-placement":"line"}]},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"]},"text-offset":{"type":"array","value":"number","units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"length":2,"default":[0,0],"requires":["text-field"]},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field","icon-image"]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"symtracking-time-segment":{"type":"number","default":20,"minimum":1},"symtracking-fps":{"type":"number","default":1,"minimum":1}},"layout_dynamicLine":{"dynamicLine-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"dynamicLine-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"dynamicLine-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"dynamicLine-join":"miter"}]},"dynamicLine-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"dynamicLine-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"dynamicLine-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop"}},"filter":{"type":"array","value":"*"},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"arrin":{},"!arrin":{},"all":{},"any":{},"none":{},"has":{},"!has":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":22,"value":["number","color"],"length":2},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"transition":false,"zoom-function":true,"property-function":false,"function":"piecewise-constant"},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"function":"interpolated","zoom-function":true,"property-function":false},"color":{"type":"color","default":"#ffffff","function":"interpolated","zoom-function":true,"property-function":false,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_extrusion","paint_symbol","paint_raster","paint_background","paint_sprite","paint_histogram","paint_airline","paint_tracking","paint_symtracking","paint_dynamicLine"],"paint_fill":{"fill-antialias":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true},"fill-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"fill-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"}]},"fill-outline-color":{"type":"color","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}]},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"fill-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"]},"fill-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"fill-water":{"type":"enum","values":{"water":{},"none":{}},"default":"none"}},"paint_extrusion":{"extrusion-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"transition":true},"extrusion-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"extrusion-pattern"}]},"extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"extrusion-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["extrusion-translate"]},"extrusion-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"extrusion-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"maximum":65535,"units":"meters","transition":true},"extrusion-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"maximum":65535,"units":"meters","transition":true,"requires":["extrusion-height"]}},"paint_line":{"line-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"line-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"line-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"]},"line-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}]},"line-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"circle-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-blur":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"circle-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"]},"circle-pitch-scale":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map"},"circle-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"viewport"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"circle-stroke-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"]},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"]}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-hue-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"transition":true,"units":"degrees"},"raster-brightness-min":{"type":"number","function":"interpolated","zoom-function":true,"default":0,"minimum":0,"maximum":1,"transition":true},"raster-brightness-max":{"type":"number","function":"interpolated","zoom-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"milliseconds"}},"paint_sprite":{"sprite-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"sprite-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"sprite-pattern"}]},"sprite-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"sprite-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"]},"sprite-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"sprite widths","requires":[{"!":"sprite-pattern"}]},"sprite-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"sprite-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"}},"paint_histogram":{"histogram-dynamic":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"histogram-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"transition":true},"histogram-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"histogram-pattern"}]},"histogram-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"histogram-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["histogram-translate"]},"histogram-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"histogram-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"maximum":65535,"units":"meters","transition":true},"histogram-heightArr1":{"type":"color","function":"interpolated","zoom-function":true,"property-function":true,"default":[0,0,0,0],"units":"meters","transition":true},"histogram-heightArr2":{"type":"color","function":"interpolated","zoom-function":true,"property-function":true,"default":[0,0,0,0],"units":"meters","transition":true},"histogram-heightArr3":{"type":"color","function":"interpolated","zoom-function":true,"property-function":true,"default":[0,0,0,0],"units":"meters","transition":true},"histogram-time":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1000,"minimum":0,"units":"millisecond","transition":true},"histogram-count":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":12,"minimum":1,"maximum":12,"units":"millisecond","transition":true},"histogram-colors":{"type":"array","value":"string","length":5,"default":["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],"function":"interpolated","zoom-function":true,"transition":true},"histogram-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"maximum":65535,"units":"meters","transition":true,"requires":["histogram-height"]},"histogram-max-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":200,"minimum":0,"units":"meters","transition":true}},"paint_airline":{"airline-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"airline-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"airline-pattern"}]},"airline-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"airline-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["airline-translate"]},"airline-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"","requires":[{"!":"airline-pattern"}]},"airline-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"airline-seg-count":{"type":"number","function":"interpolated","zoom-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"airline-seg-group":{"type":"number","function":"interpolated","zoom-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"airline-speed":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":1,"maximum":500,"transition":true},"airline-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"airline-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["real-time","history","none"],"default":"history"}},"paint_tracking":{"tracking-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"tracking-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"tracking-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"tracking-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["tracking-translate"]},"tracking-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":["real-time","history"],"default":"real-time"},"tracking-seg-count":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"tracking-seg-group":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"tracking-speed":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"tracking-delay":{"type":"number","zoom-function":true,"property-function":true,"default":20,"minimum":0,"maximum":120,"transition":true},"tracking-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"}},"paint_symtracking":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"]},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"]},"symtracking-delay":{"type":"number","zoom-function":true,"default":10,"minimum":0,"maximum":120,"transition":true}},"paint_dynamicLine":{"dynamicLine-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"dynamicLine-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"dynamicLine-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"dynamicLine-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["dynamicLine-translate"]},"dynamicLine-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}]},"dynamicLine-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"dynamicLine-seg-count":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"dynamicLine-seg-group":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"dynamicLine-speed":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"dynamicLine-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"}},"paint_background":{"background-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"transition":true,"requires":[{"!":"background-pattern"}]},"background-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}}}
},{}],135:[function(_dereq_,module,exports){
"use strict";module.exports=function(r){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];for(var n=0,o=t;n<o.length;n+=1){var a=o[n];for(var f in a)r[f]=a[f]}return r};
},{}],136:[function(_dereq_,module,exports){
"use strict";module.exports=function(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n};
},{}],137:[function(_dereq_,module,exports){
"use strict";function interpolate(t,e,n){return t*(1-n)+e*n}module.exports=interpolate,interpolate.number=interpolate,interpolate.vec2=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n)]},interpolate.color=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n),interpolate(t[2],e[2],n),interpolate(t[3],e[3],n)]},interpolate.array=function(t,e,n){return t.map(function(t,r){return interpolate(t,e[r],n)})};
},{}],138:[function(_dereq_,module,exports){
"use strict";var parseColorString=_dereq_("csscolorparser").parseCSSColor;module.exports=function(r){if("string"==typeof r){var e=parseColorString(r);if(!e)return;return[e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]]}return Array.isArray(r)?r:void 0};
},{"csscolorparser":1}],139:[function(_dereq_,module,exports){
"use strict";module.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"];
},{}],140:[function(_dereq_,module,exports){
"use strict";module.exports=function(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n};
},{}],141:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),extend=_dereq_("../util/extend");module.exports=function(e){var r=_dereq_("./validate_function"),t=_dereq_("./validate_object"),i={"*":function(){return[]},array:_dereq_("./validate_array"),boolean:_dereq_("./validate_boolean"),number:_dereq_("./validate_number"),color:_dereq_("./validate_color"),constants:_dereq_("./validate_constants"),enum:_dereq_("./validate_enum"),filter:_dereq_("./validate_filter"),function:_dereq_("./validate_function"),layer:_dereq_("./validate_layer"),object:_dereq_("./validate_object"),source:_dereq_("./validate_source"),light:_dereq_("./validate_light"),string:_dereq_("./validate_string")},a=e.value,n=e.valueSpec,u=e.key,o=e.styleSpec,l=e.style;if("string"===getType(a)&&"@"===a[0]){if(o.$version>7)return[new ValidationError(u,a,"constants have been deprecated as of v8")];if(!(a in l.constants))return[new ValidationError(u,a,'constant "%s" not found',a)];e=extend({},e,{value:l.constants[a]})}return n.function&&"object"===getType(a)?r(e):n.type&&i[n.type]?i[n.type](e):t(extend({},e,{valueSpec:n.type?o[n.type]:n}))};
},{"../error/validation_error":128,"../util/extend":135,"../util/get_type":136,"./validate_array":142,"./validate_boolean":143,"./validate_color":144,"./validate_constants":145,"./validate_enum":146,"./validate_filter":147,"./validate_function":148,"./validate_layer":150,"./validate_light":152,"./validate_number":153,"./validate_object":154,"./validate_source":157,"./validate_string":158}],142:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),validate=_dereq_("./validate"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.value,t=e.valueSpec,a=e.style,n=e.styleSpec,l=e.key,i=e.arrayElementValidator||validate;if("array"!==getType(r))return[new ValidationError(l,r,"array expected, %s found",getType(r))];if(t.length&&r.length!==t.length)return[new ValidationError(l,r,"array length %d expected, length %d found",t.length,r.length)];if(t["min-length"]&&r.length<t["min-length"])return[new ValidationError(l,r,"array length at least %d expected, length %d found",t["min-length"],r.length)];var o={type:t.value};n.$version<7&&(o.function=t.function),"object"===getType(t.value)&&(o=t.value);for(var u=[],d=0;d<r.length;d++)u=u.concat(i({array:r,arrayIndex:d,value:r[d],valueSpec:o,style:a,styleSpec:n,key:l+"["+d+"]"}));return u};
},{"../error/validation_error":128,"../util/get_type":136,"./validate":141}],143:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.value,o=e.key,t=getType(r);return"boolean"!==t?[new ValidationError(o,r,"boolean expected, %s found",t)]:[]};
},{"../error/validation_error":128,"../util/get_type":136}],144:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),parseCSSColor=_dereq_("csscolorparser").parseCSSColor;module.exports=function(r){var e=r.key,o=r.value,t=getType(o);return"string"!==t?[new ValidationError(e,o,"color expected, %s found",t)]:null===parseCSSColor(o)?[new ValidationError(e,o,'color expected, "%s" found',o)]:[]};
},{"../error/validation_error":128,"../util/get_type":136,"csscolorparser":1}],145:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type");module.exports=function(r){var e=r.key,t=r.value;if(r.styleSpec.$version>7)return t?[new ValidationError(e,t,"constants have been deprecated as of v8")]:[];var a=getType(t);if("object"!==a)return[new ValidationError(e,t,"object expected, %s found",a)];var o=[];for(var n in t)"@"!==n[0]&&o.push(new ValidationError(e+"."+n,t[n],'constants must start with "@"'));return o};
},{"../error/validation_error":128,"../util/get_type":136}],146:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e){var r=e.key,n=e.value,u=e.valueSpec,o=[];return Array.isArray(u.values)?-1===u.values.indexOf(unbundle(n))&&o.push(new ValidationError(r,n,"expected one of [%s], %s found",u.values.join(", "),n)):-1===Object.keys(u.values).indexOf(unbundle(n))&&o.push(new ValidationError(r,n,"expected one of [%s], %s found",Object.keys(u.values).join(", "),n)),o};
},{"../error/validation_error":128,"../util/unbundle_jsonlint":140}],147:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),validateEnum=_dereq_("./validate_enum"),getType=_dereq_("../util/get_type"),unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function e(r){var t,a=r.value,n=r.key,l=r.styleSpec,s=[];if("array"!==getType(a))return[new ValidationError(n,a,"array expected, %s found",getType(a))];if(a.length<1)return[new ValidationError(n,a,"filter array must have at least 1 element")];switch(s=s.concat(validateEnum({key:n+"[0]",value:a[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),unbundle(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&"$type"===unbundle(a[1])&&s.push(new ValidationError(n,a,'"$type" cannot be use with operator "%s"',a[0]));case"==":case"!=":3!==a.length&&s.push(new ValidationError(n,a,'filter array for operator "%s" must have 3 elements',a[0]));case"in":case"!in":case"arrin":case"!arrin":a.length>=2&&"string"!==(t=getType(a[1]))&&s.push(new ValidationError(n+"[1]",a[1],"string expected, %s found",t));for(var o=2;o<a.length;o++)t=getType(a[o]),"$type"===unbundle(a[1])?s=s.concat(validateEnum({key:n+"["+o+"]",value:a[o],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==t&&"number"!==t&&"boolean"!==t&&s.push(new ValidationError(n+"["+o+"]",a[o],"string, number, or boolean expected, %s found",t));break;case"any":case"all":case"none":for(var i=1;i<a.length;i++)s=s.concat(e({key:n+"["+i+"]",value:a[i],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":t=getType(a[1]),2!==a.length?s.push(new ValidationError(n,a,'filter array for "%s" operator must have 2 elements',a[0])):"string"!==t&&s.push(new ValidationError(n+"[1]",a[1],"string expected, %s found",t))}return s};
},{"../error/validation_error":128,"../util/get_type":136,"../util/unbundle_jsonlint":140,"./validate_enum":146}],148:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validate=_dereq_("./validate"),validateObject=_dereq_("./validate_object"),validateArray=_dereq_("./validate_array"),validateNumber=_dereq_("./validate_number"),unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e){function t(e){if("identity"===p)return[new ValidationError(e.key,e.value,'identity function may not have a "stops" property')];var t=[],a=e.value;return t=t.concat(validateArray({key:e.key,value:a,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:r})),"array"===getType(a)&&0===a.length&&t.push(new ValidationError(e.key,a,"array must have at least one stop")),t}function r(e){var t=[],r=e.value,o=e.key;if("array"!==getType(r))return[new ValidationError(o,r,"array expected, %s found",getType(r))];if(2!==r.length)return[new ValidationError(o,r,"array length %d expected, length %d found",2,r.length)];if(c){if("object"!==getType(r[0]))return[new ValidationError(o,r,"object expected, %s found",getType(r[0]))];if(void 0===r[0].zoom)return[new ValidationError(o,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new ValidationError(o,r,"object stop key must have value")];if(l&&l>unbundle(r[0].zoom))return[new ValidationError(o,r[0].zoom,"stop zoom values must appear in ascending order")];unbundle(r[0].zoom)!==l&&(l=unbundle(r[0].zoom),i=void 0,s={}),t=t.concat(validateObject({key:o+"[0]",value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:validateNumber,value:a}}))}else t=t.concat(a({key:o+"[0]",value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec}));return t.concat(validate({key:o+"[1]",value:r[1],valueSpec:u,style:e.style,styleSpec:e.styleSpec}))}function a(e){var t=getType(e.value),r=unbundle(e.value);if(n){if(t!==n)return[new ValidationError(e.key,e.value,"%s stop domain type must match previous stop domain type %s",t,n)]}else n=t;if("number"!==t&&"string"!==t&&"boolean"!==t)return[new ValidationError(e.key,e.value,"stop domain value must be a number, string, or boolean")];if("number"!==t&&"categorical"!==p){var a="number expected, %s found";return u["property-function"]&&void 0===p&&(a+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ValidationError(e.key,e.value,a,t)]}return"categorical"!==p||"number"!==t||isFinite(r)&&Math.floor(r)===r?"categorical"!==p&&"number"===t&&void 0!==i&&r<i?[new ValidationError(e.key,e.value,"stop domain values must appear in ascending order")]:(i=r,"categorical"===p&&r in s?[new ValidationError(e.key,e.value,"stop domain values must be unique")]:(s[r]=!0,[])):[new ValidationError(e.key,e.value,"integer expected, found %s",r)]}function o(e){return validate({key:e.key,value:e.value,valueSpec:u,style:e.style,styleSpec:e.styleSpec})}var n,i,l,u=e.valueSpec,p=unbundle(e.value.type),s={},y="categorical"!==p&&void 0===e.value.property,d=!y,c="array"===getType(e.value.stops)&&"array"===getType(e.value.stops[0])&&"object"===getType(e.value.stops[0][0]),v=validateObject({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:t,default:o}});return"identity"===p&&y&&v.push(new ValidationError(e.key,e.value,'missing required property "property"')),"identity"===p||e.value.stops||v.push(new ValidationError(e.key,e.value,'missing required property "stops"')),"exponential"===p&&"piecewise-constant"===e.valueSpec.function&&v.push(new ValidationError(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(d&&!e.valueSpec["property-function"]?v.push(new ValidationError(e.key,e.value,"property functions not supported")):y&&!e.valueSpec["zoom-function"]&&v.push(new ValidationError(e.key,e.value,"zoom functions not supported"))),"categorical"!==p&&!c||void 0!==e.value.property||v.push(new ValidationError(e.key,e.value,'"property" property is required')),v};
},{"../error/validation_error":128,"../util/get_type":136,"../util/unbundle_jsonlint":140,"./validate":141,"./validate_array":142,"./validate_number":153,"./validate_object":154}],149:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),validateString=_dereq_("./validate_string");module.exports=function(r){var e=r.value,t=r.key,a=validateString(r);return a.length?a:(-1===e.indexOf("{fontstack}")&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{range}" token')),a)};
},{"../error/validation_error":128,"./validate_string":158}],150:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint"),validateObject=_dereq_("./validate_object"),validateFilter=_dereq_("./validate_filter"),validatePaintProperty=_dereq_("./validate_paint_property"),validateLayoutProperty=_dereq_("./validate_layout_property"),extend=_dereq_("../util/extend");module.exports=function(e){var r=[],t=e.value,a=e.key,i=e.style,l=e.styleSpec;t.type||t.ref||r.push(new ValidationError(a,t,'either "type" or "ref" is required'));var u=unbundle(t.type),n=unbundle(t.ref);if(t.id)for(var o=unbundle(t.id),s=0;s<e.arrayIndex;s++){var d=i.layers[s];unbundle(d.id)===o&&r.push(new ValidationError(a,t.id,'duplicate layer id "%s", previously used at line %d',t.id,d.id.__line__))}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(function(e){e in t&&r.push(new ValidationError(a,t[e],'"%s" is prohibited for ref layers',e))});var y;i.layers.forEach(function(e){unbundle(e.id)===n&&(y=e)}),y?y.ref?r.push(new ValidationError(a,t.ref,"ref cannot reference another ref layer")):u=unbundle(y.type):r.push(new ValidationError(a,t.ref,'ref layer "%s" not found',n))}else if("background"!==u)if(t.source){var c=i.sources&&i.sources[t.source],p=c&&unbundle(c.type);c?"vector"===p&&"raster"===u?r.push(new ValidationError(a,t.source,'layer "%s" requires a raster source',t.id)):"raster"===p&&"raster"!==u?r.push(new ValidationError(a,t.source,'layer "%s" requires a vector source',t.id)):"vector"!==p||t["source-layer"]||r.push(new ValidationError(a,t,'layer "%s" must specify a "source-layer"',t.id)):r.push(new ValidationError(a,t.source,'source "%s" not found',t.source))}else r.push(new ValidationError(a,t,'missing required property "source"'));return r=r.concat(validateObject({key:a,value:t,valueSpec:l.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},filter:validateFilter,layout:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validateLayoutProperty(extend({layerType:u},e))}}})},paint:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validatePaintProperty(extend({layerType:u},e))}}})}}}))};
},{"../error/validation_error":128,"../util/extend":135,"../util/unbundle_jsonlint":140,"./validate_filter":147,"./validate_layout_property":151,"./validate_object":154,"./validate_paint_property":155}],151:[function(_dereq_,module,exports){
"use strict";var validateProperty=_dereq_("./validate_property");module.exports=function(r){return validateProperty(r,"layout")};
},{"./validate_property":156}],152:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validate=_dereq_("./validate");module.exports=function(e){var t=e.value,r=e.styleSpec,a=r.light,i=e.style,n=[],o=getType(t);if(void 0===t)return n;if("object"!==o)return n=n.concat([new ValidationError("light",t,"object expected, %s found",o)]);for(var l in t){var c=l.match(/^(.*)-transition$/);n=c&&a[c[1]]&&a[c[1]].transition?n.concat(validate({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r})):a[l]?n.concat(validate({key:l,value:t[l],valueSpec:a[l],style:i,styleSpec:r})):n.concat([new ValidationError(l,t[l],'unknown property "%s"',l)])}return n};
},{"../error/validation_error":128,"../util/get_type":136,"./validate":141}],153:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.key,i=e.value,m=e.valueSpec,a=getType(i);return"number"!==a?[new ValidationError(r,i,"number expected, %s found",a)]:"minimum"in m&&i<m.minimum?[new ValidationError(r,i,"%s is less than the minimum value %s",i,m.minimum)]:"maximum"in m&&i>m.maximum?[new ValidationError(r,i,"%s is greater than the maximum value %s",i,m.maximum)]:[]};
},{"../error/validation_error":128,"../util/get_type":136}],154:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validateSpec=_dereq_("./validate");module.exports=function(e){var r=e.key,t=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},o=e.style,l=e.styleSpec,n=[],u=getType(t);if("object"!==u)return[new ValidationError(r,t,"object expected, %s found",u)];for(var d in t){var p=d.split(".")[0],s=i[p]||i["*"],c=void 0;if(a[p])c=a[p];else if(i[p])c=validateSpec;else if(a["*"])c=a["*"];else{if(!i["*"]){n.push(new ValidationError(r,t[d],'unknown property "%s"',d));continue}c=validateSpec}n=n.concat(c({key:(r?r+".":r)+d,value:t[d],valueSpec:s,style:o,styleSpec:l,object:t,objectKey:d}))}for(var v in i)i[v].required&&void 0===i[v].default&&void 0===t[v]&&n.push(new ValidationError(r,t,'missing required property "%s"',v));return n};
},{"../error/validation_error":128,"../util/get_type":136,"./validate":141}],155:[function(_dereq_,module,exports){
"use strict";var validateProperty=_dereq_("./validate_property");module.exports=function(r){return validateProperty(r,"paint")};
},{"./validate_property":156}],156:[function(_dereq_,module,exports){
"use strict";var validate=_dereq_("./validate"),ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type");module.exports=function(e,t){var r=e.key,i=e.style,a=e.styleSpec,n=e.value,o=e.objectKey,l=a[t+"_"+e.layerType];if(!l)return[];var y=o.match(/^(.*)-transition$/);if("paint"===t&&y&&l[y[1]]&&l[y[1]].transition)return validate({key:r,value:n,valueSpec:a.transition,style:i,styleSpec:a});var p=e.valueSpec||l[o];if(!p)return[new ValidationError(r,n,'unknown property "%s"',o)];var s;if("string"===getType(n)&&p["property-function"]&&!p.tokens&&(s=/^{([^}]+)}$/.exec(n)))return[new ValidationError(r,n,'"%s" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": %s` }`.',o,JSON.stringify(s[1]))];var u=[];return"symbol"===e.layerType&&"text-field"===o&&i&&!i.glyphs&&u.push(new ValidationError(r,n,'use of "text-field" requires a style "glyphs" property')),u.concat(validate({key:e.key,value:n,valueSpec:p,style:i,styleSpec:a}))};
},{"../error/validation_error":128,"../util/get_type":136,"./validate":141}],157:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint"),validateObject=_dereq_("./validate_object"),validateEnum=_dereq_("./validate_enum");module.exports=function(e){var a=e.value,t=e.key,r=e.styleSpec,l=e.style;if(!a.type)return[new ValidationError(t,a,'"type" is required')];var u=unbundle(a.type),i=[];switch(u){case"vector":case"raster":if(i=i.concat(validateObject({key:t,value:a,valueSpec:r.source_tile,style:e.style,styleSpec:r})),"url"in a)for(var s in a)["type","url","tileSize"].indexOf(s)<0&&i.push(new ValidationError(t+"."+s,a[s],'a source with a "url" property may not include a "%s" property',s));return i;case"geojson":return validateObject({key:t,value:a,valueSpec:r.source_geojson,style:l,styleSpec:r});case"video":return validateObject({key:t,value:a,valueSpec:r.source_video,style:l,styleSpec:r});case"image":return validateObject({key:t,value:a,valueSpec:r.source_image,style:l,styleSpec:r});case"canvas":return validateObject({key:t,value:a,valueSpec:r.source_canvas,style:l,styleSpec:r});default:return validateEnum({key:t+".type",value:a.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:l,styleSpec:r})}};
},{"../error/validation_error":128,"../util/unbundle_jsonlint":140,"./validate_enum":146,"./validate_object":154}],158:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(r){var e=r.value,t=r.key,i=getType(e);return"string"!==i?[new ValidationError(t,e,"string expected, %s found",i)]:[]};
},{"../error/validation_error":128,"../util/get_type":136}],159:[function(_dereq_,module,exports){
"use strict";function validateStyleMin(e,a){a=a||latestStyleSpec;var t=[];return t=t.concat(validate({key:"",value:e,valueSpec:a.$root,styleSpec:a,style:e,objectElementValidators:{glyphs:validateGlyphsURL,"*":function(){return[]}}})),a.$version>7&&e.constants&&(t=t.concat(validateConstants({key:"constants",value:e.constants,style:e,styleSpec:a}))),sortErrors(t)}function sortErrors(e){return[].concat(e).sort(function(e,a){return e.line-a.line})}function wrapCleanErrors(e){return function(){return sortErrors(e.apply(this,arguments))}}var validateConstants=_dereq_("./validate/validate_constants"),validate=_dereq_("./validate/validate"),latestStyleSpec=_dereq_("./reference/latest"),validateGlyphsURL=_dereq_("./validate/validate_glyphs_url");validateStyleMin.source=wrapCleanErrors(_dereq_("./validate/validate_source")),validateStyleMin.light=wrapCleanErrors(_dereq_("./validate/validate_light")),validateStyleMin.layer=wrapCleanErrors(_dereq_("./validate/validate_layer")),validateStyleMin.filter=wrapCleanErrors(_dereq_("./validate/validate_filter")),validateStyleMin.paintProperty=wrapCleanErrors(_dereq_("./validate/validate_paint_property")),validateStyleMin.layoutProperty=wrapCleanErrors(_dereq_("./validate/validate_layout_property")),module.exports=validateStyleMin;
},{"./reference/latest":133,"./validate/validate":141,"./validate/validate_constants":145,"./validate/validate_filter":147,"./validate/validate_glyphs_url":149,"./validate/validate_layer":150,"./validate/validate_layout_property":151,"./validate/validate_light":152,"./validate/validate_paint_property":155,"./validate/validate_source":157}],160:[function(_dereq_,module,exports){
"use strict";var AnimationLoop=function(){this.n=0,this.times=[]};AnimationLoop.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},AnimationLoop.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},AnimationLoop.prototype.cancel=function(t){this.times=this.times.filter(function(i){return i.id!==t})},module.exports=AnimationLoop;
},{}],161:[function(_dereq_,module,exports){
"use strict";var Evented=_dereq_("../util/evented"),ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),normalizeURL=_dereq_("../util/minemap").normalizeSpriteURL,SpritePosition=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},ImageSprite=function(t){function e(e,i,r){var a=this;t.call(this),this.base=e,this.retina=browser.devicePixelRatio>1,this.setEventedParent(r),this.transformRequestFn=i;var o=this.retina?"@2x":"",n=normalizeURL(e,o,".json"),s=i(n,ajax.ResourceType.SpriteJSON);ajax.getJSON(s,function(t,e){t?a.fire("error",{error:t}):e&&(a.data=e,a.imgData&&a.fire("data",{dataType:"style"}))}),n=normalizeURL(e,o,".png");var p=i(n,ajax.ResourceType.SpriteImage);ajax.getImage(p,function(t,e){t?a.fire("error",{error:t}):e&&(a.imgData=browser.getImageData(e),a.width=e.width,a.data&&a.fire("data",{dataType:"style"}))})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return this.base},e.prototype.loaded=function(){return!(!this.data||!this.imgData)},e.prototype.resize=function(){var t=this;if(browser.devicePixelRatio>1!==this.retina){var i=new e(this.base,this.transformRequestFn);i.on("data",function(){t.data=i.data,t.imgData=i.imgData,t.width=i.width,t.retina=i.retina})}},e.prototype.getSpritePosition=function(t){if(!this.loaded())return new SpritePosition;var e=this.data&&this.data[t];return e&&this.imgData?e:new SpritePosition},e}(Evented);module.exports=ImageSprite;
},{"../util/ajax":216,"../util/browser":217,"../util/evented":226,"../util/minemap":236}],162:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../style-spec/reference/latest"),util=_dereq_("../util/util"),Evented=_dereq_("../util/evented"),validateStyle=_dereq_("./validate_style"),StyleDeclaration=_dereq_("./style_declaration"),StyleTransition=_dereq_("./style_transition"),TRANSITION_SUFFIX="-transition",Light=function(t){function i(i){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=styleSpec.light,this.set(i)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.set=function(t){var i=this;if(!this._validate(validateStyle.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=util.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var e=0,o=i.properties;e<o.length;e+=1){var n=o[e];i._declarations[n]=new StyleDeclaration(i._specifications[n],t[n])}return this}},i.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},i.prototype.getLightProperty=function(t){return util.endsWith(t,TRANSITION_SUFFIX)?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},i.prototype.getLightValue=function(t,i){if("position"===t){var e=this._transitions[t].calculate(i),o=util.sphericalToCartesian(e);return{x:o[0],y:o[1],z:o[2]}}return this._transitions[t].calculate(i)},i.prototype.setLight=function(t){var i=this;if(!this._validate(validateStyle.light,t))for(var e in t){var o=t[e];util.endsWith(e,TRANSITION_SUFFIX)?i._transitionOptions[e]=o:null===o||void 0===o?delete i._declarations[e]:i._declarations[e]=new StyleDeclaration(i._specifications[e],o)}},i.prototype.recalculate=function(t){var i=this;for(var e in i._declarations)i.calculated[e]=i.getLightValue(e,{zoom:t})},i.prototype._applyLightDeclaration=function(t,i,e,o,n){var r=e.transition?this._transitions[t]:void 0,a=this._specifications[t];if(null!==i&&void 0!==i||(i=new StyleDeclaration(a,a.default)),!r||r.declaration.json!==i.json){var s=util.extend({duration:300,delay:0},o,this.getLightProperty(t+TRANSITION_SUFFIX)),l=this._transitions[t]=new StyleTransition(a,i,r,s);l.instant()||(l.loopID=n.set(l.endTime-Date.now())),r&&n.cancel(r.loopID)}},i.prototype.updateLightTransitions=function(t,i,e){var o,n=this;for(o in n._declarations)n._applyLightDeclaration(o,n._declarations[o],t,i,e)},i.prototype._validate=function(t,i){return validateStyle.emitErrors(this,t.call(validateStyle,util.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:styleSpec})))},i}(Evented);module.exports=Light;
},{"../style-spec/reference/latest":133,"../util/evented":226,"../util/util":244,"./style_declaration":164,"./style_transition":178,"./validate_style":179}],163:[function(_dereq_,module,exports){
"use strict";var Evented=_dereq_("../util/evented"),StyleLayer=_dereq_("./style_layer"),ImageSprite=_dereq_("./image_sprite"),Light=_dereq_("./light"),GlyphSource=_dereq_("../symbol/glyph_source"),SpriteAtlas=_dereq_("../symbol/sprite_atlas"),LineAtlas=_dereq_("../render/line_atlas"),util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),minemap=_dereq_("../util/minemap"),browser=_dereq_("../util/browser"),Dispatcher=_dereq_("../util/dispatcher"),AnimationLoop=_dereq_("./animation_loop"),validateStyle=_dereq_("./validate_style"),getSourceType=_dereq_("../source/source").getType,setSourceType=_dereq_("../source/source").setType,QueryFeatures=_dereq_("../source/query_features"),SourceCache=_dereq_("../source/source_cache"),styleSpec=_dereq_("../style-spec/reference/latest"),MinemapFunction=_dereq_("../style-spec/function"),getWorkerPool=_dereq_("../util/global_worker_pool"),deref=_dereq_("../style-spec/deref"),diff=_dereq_("../style-spec/diff"),rtlTextPlugin=_dereq_("../source/rtl_text_plugin"),supportedDiffOperations=util.pick(diff.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),ignoredDiffOperations=util.pick(diff.operations,["setCenter","setZoom","setBearing","setPitch"]),Style=function(e){function t(t,r,i){var s=this;e.call(this),this.map=r,this.animationLoop=r&&r.animationLoop||new AnimationLoop,this.dispatcher=new Dispatcher(getWorkerPool(),this),this.spriteAtlas=new SpriteAtlas(1024,1024),this.spriteAtlas.setEventedParent(this),this.lineAtlas=new LineAtlas(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,util.bindAll(["_redoPlacement"],this),this._resetUpdates(),i=util.extend({validate:"string"!=typeof t||!minemap.isMinemapURL(t)},i),this.setEventedParent(r),this.fire("dataloading",{dataType:"style"});var o=this;this._rtlTextPluginCallback=rtlTextPlugin.registerForPluginAvailability(function(e){o.dispatcher.broadcast("loadRTLTextPlugin",e.pluginBlobURL,e.errorCallback);for(var t in o.sourceCaches)o.sourceCaches[t].reload()});var a=function(e,t){return s.map?s.map._transformRequest(e,t):{url:e}},n=function(e,t){if(e)s.fire("error",{error:e});else if(t){if(i.validate&&validateStyle.emitErrors(s,validateStyle(t)))return;s._loaded=!0,s.stylesheet=t,s.updateClasses();for(var r in t.sources)s.addSource(r,t.sources[r],i);t.sprite&&(s.sprite=new ImageSprite(t.sprite,a,s)),s.glyphSource=new GlyphSource(t.glyphs,i.localIdeographFontFamily,a,s),s._resolve(),s.fire("data",{dataType:"style"}),s.fire("style.load")}};"string"==typeof t?ajax.getJSON(a(minemap.normalizeStyleURL(t),ajax.ResourceType.Style),n):browser.frame(function(){return n(null,t)}),this.on("data",function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=s.sourceCaches[e.sourceId];if(t){var r=t.getSource();if(r&&r.vectorLayerIds)for(var i in s._layers){var o=s._layers[i];o.source===r.id&&s._validateLayer(o)}}}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._validateLayer=function(e){var t=this.sourceCaches[e.source];if(t){var r=e.sourceLayer;if(r){var i=t.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire("error",{error:new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')})}}},t.prototype.loaded=function(){var e=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in e.sourceCaches)if(!e.sourceCaches[t].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},t.prototype._resolve=function(){var e=this,t=deref(this.stylesheet.layers);this._order=t.map(function(e){return e.id}),this._layers={};for(var r=0,i=t;r<i.length;r+=1){var s=i[r];s=StyleLayer.create(s),s.setEventedParent(e,{layer:{id:s.id}}),e._layers[s.id]=s}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Light(this.stylesheet.light)},t.prototype._serializeLayers=function(e){var t=this;return e.map(function(e){return t._layers[e].serialize()})},t.prototype._applyClasses=function(e,t){var r=this;if(this._loaded){e=e||[],t=t||{transition:!0};var i=this.stylesheet.transition||{},s=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var o in s){var a=r._layers[o],n=r._updatedPaintProps[o];if(r._updatedAllPaintProps||n.all)a.updatePaintTransitions(e,t,i,r.animationLoop,r.zoomHistory);else for(var l in n)r._layers[o].updatePaintTransition(l,e,t,i,r.animationLoop,r.zoomHistory)}this.light.updateLightTransitions(t,i,this.animationLoop)}},t.prototype._recalculate=function(e){var t=this;if(this._loaded){for(var r in t.sourceCaches)t.sourceCaches[r].used=!1;this._updateZoomHistory(e);for(var i=0,s=t._order;i<s.length;i+=1){var o=s[i],a=t._layers[o];a.recalculate(e),!a.isHidden(e)&&a.source&&(t.sourceCaches[a.source].used=!0)}this.light.recalculate(e);Math.floor(this.z)!==Math.floor(e)&&this.animationLoop.set(300),this.z=e}},t.prototype._updateZoomHistory=function(e){var t=this.zoomHistory;void 0===t.lastIntegerZoom&&(t.lastIntegerZoom=Math.floor(e),t.lastIntegerZoomTime=0,t.lastZoom=e),Math.floor(t.lastZoom)<Math.floor(e)?(t.lastIntegerZoom=Math.floor(e),t.lastIntegerZoomTime=Date.now()):Math.floor(t.lastZoom)>Math.floor(e)&&(t.lastIntegerZoom=Math.floor(e+1),t.lastIntegerZoomTime=Date.now()),t.lastZoom=e},t.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},t.prototype.update=function(e,t){var r=this;if(this._changed){var i=Object.keys(this._updatedLayers),s=Object.keys(this._removedLayers);(i.length||s.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(i,s);for(var o in r._updatedSources){var a=r._updatedSources[o];"reload"===a?r._reloadSource(o):"clear"===a&&r._clearSource(o)}this._applyClasses(e,t),this._resetUpdates(),this.fire("data",{dataType:"style"})}},t.prototype._updateWorkerLayers=function(e,t){var r=this,i=this._updatedSymbolOrder?this._order.filter(function(e){return"symbol"===r._layers[e].type||"symtracking"===r._layers[e].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t,symbolOrder:i})},t.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},t.prototype.setState=function(e){var t=this;if(this._checkLoaded(),validateStyle.emitErrors(this,validateStyle(e)))return!1;e=util.clone(e),e.layers=deref(e.layers);var r=diff(this.serialize(),e).filter(function(e){return!(e.command in ignoredDiffOperations)});if(0===r.length)return!1;var i=r.filter(function(e){return!(e.command in supportedDiffOperations)});if(i.length>0)throw new Error("Unimplemented: "+i.map(function(e){return e.command}).join(", ")+".");return r.forEach(function(e){"setTransition"!==e.command&&t[e.command].apply(t,e.args)}),this.stylesheet=e,!0},t.prototype.addSource=function(e,t,r){var i=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!t.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(t).join(", ")+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(t.type)>=0&&this._validate(validateStyle.source,"sources."+e,t,null,r))){var s=this.sourceCaches[e]=new SourceCache(e,t,this.dispatcher);s.style=this,s.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:s.serialize(),sourceId:e}}),s.onAdd(this.map),this._changed=!0}},t.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");var t=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],t.fire("data",{sourceDataType:"metadata",dataType:"source",sourceId:e}),t.setEventedParent(null),t.clearTiles(),t.onRemove&&t.onRemove(this.map),this._changed=!0},t.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},t.prototype.addLayer=function(e,t,r){this._checkLoaded();var i=e.id;if("object"==typeof e.source&&(this.addSource(i,e.source),e=util.extend(e,{source:i})),!this._validate(validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r)){var s=StyleLayer.create(e);this._validateLayer(s),s.setEventedParent(this,{layer:{id:i}});var o=t?this._order.indexOf(t):this._order.length;if(this._order.splice(o,0,i),this._layers[i]=s,this._removedLayers[i]&&s.source){var a=this._removedLayers[i];delete this._removedLayers[i],a.type!==s.type?this._updatedSources[s.source]="clear":(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause())}this._updateLayer(s),"symbol"!==s.type&&"symtracking"!==s.type||(this._updatedSymbolOrder=!0),this.updateClasses(i)}},t.prototype.moveLayer=function(e,t){this._checkLoaded(),this._changed=!0;var r=this._layers[e];if(!r)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")});var i=this._order.indexOf(e);this._order.splice(i,1);var s=t?this._order.indexOf(t):this._order.length;this._order.splice(s,0,e),"symbol"!==r.type&&"symtracking"!==r.type||(this._updatedSymbolOrder=!0,r.source&&!this._updatedSources[r.source]&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()))},t.prototype.removeLayer=function(e){this._checkLoaded();var t=this._layers[e];if(!t)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")});t.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),"symbol"!==t.type&&"symtracking"!==t.type||(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[e]=t,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e]},t.prototype.getLayer=function(e){return this._layers[e]},t.prototype.setLayerZoomRange=function(e,t,r){this._checkLoaded();var i=this.getLayer(e);if(!i)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")});i.minzoom===t&&i.maxzoom===r||(null!=t&&(i.minzoom=t),null!=r&&(i.maxzoom=r),this._updateLayer(i))},t.prototype.setFilter=function(e,t){this._checkLoaded();var r=this.getLayer(e);if(!r)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")});null!==t&&void 0!==t&&this._validate(validateStyle.filter,"layers."+r.id+".filter",t)||util.deepEqual(r.filter,t)||(r.filter=util.clone(t),this._updateLayer(r))},t.prototype.getFilter=function(e){return util.clone(this.getLayer(e).filter)},t.prototype.setLayoutProperty=function(e,t,r){this._checkLoaded();var i=this.getLayer(e);if(!i)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")});util.deepEqual(i.getLayoutProperty(t),r)||(i.setLayoutProperty(t,r),this._updateLayer(i))},t.prototype.getLayoutProperty=function(e,t){return this.getLayer(e).getLayoutProperty(t)},t.prototype.setPaintProperty=function(e,t,r,i){this._checkLoaded();var s=this.getLayer(e);if(!s)return void this.fire("error",{error:new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")});if(!util.deepEqual(s.getPaintProperty(t,i),r)){var o=s.isPaintValueFeatureConstant(t);s.setPaintProperty(t,r,i);!(r&&MinemapFunction.isFunctionDefinition(r)&&"$zoom"!==r.property&&void 0!==r.property)&&o||this._updateLayer(s),this.updateClasses(e,t)}},t.prototype.getPaintProperty=function(e,t,r){return this.getLayer(e).getPaintProperty(t,r)},t.prototype.getTransition=function(){return util.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},t.prototype.updateClasses=function(e,t){if(this._changed=!0,e){var r=this._updatedPaintProps;r[e]||(r[e]={}),r[e][t||"all"]=!0}else this._updatedAllPaintProps=!0},t.prototype.serialize=function(){var e=this;return util.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:util.mapObject(this.sourceCaches,function(e){return e.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(e){return void 0!==e})},t.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0},t.prototype._flattenRenderedFeatures=function(e){for(var t=this,r=[],i=this._order.length-1;i>=0;i--)for(var s=t._order[i],o=0,a=e;o<a.length;o+=1){var n=a[o],l=n[s];if(l)for(var u=0,h=l;u<h.length;u+=1){var d=h[u];r.push(d)}}return r},t.prototype.queryRenderedFeatures=function(e,t,r,i){var s=this;t&&t.filter&&this._validate(validateStyle.filter,"queryRenderedFeatures.filter",t.filter);var o={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire("error",{error:"parameters.layers must be an Array."}),[];for(var a=0,n=t.layers;a<n.length;a+=1){var l=n[a],u=s._layers[l];if(!u)return s.fire("error",{error:"The layer '"+l+"' does not exist in the map's style and cannot be queried for features."}),[];o[u.source]=!0}}var h=[];for(var d in s.sourceCaches)if(!t.layers||o[d]){var c=QueryFeatures.rendered(s.sourceCaches[d],s._layers,e,t,r,i);h.push(c)}return this._flattenRenderedFeatures(h)},t.prototype.querySourceFeatures=function(e,t){t&&t.filter&&this._validate(validateStyle.filter,"querySourceFeatures.filter",t.filter);var r=this.sourceCaches[e];return r?QueryFeatures.source(r,t):[]},t.prototype.addSourceType=function(e,t,r){return getSourceType(e)?r(new Error('A source type called "'+e+'" already exists.')):(setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))},t.prototype.getLight=function(){return this.light.getLight()},t.prototype.setLight=function(e,t){this._checkLoaded();var r=this.light.getLight(),i=!1;for(var s in e)if(!util.deepEqual(e[s],r[s])){i=!0;break}if(i){var o=this.stylesheet.transition||{};this.light.setLight(e),this.light.updateLightTransitions(t||{transition:!0},o,this.animationLoop)}},t.prototype._validate=function(e,t,r,i,s){return(!s||!1!==s.validate)&&validateStyle.emitErrors(this,e.call(validateStyle,util.extend({key:t,style:this.serialize(),value:r,styleSpec:styleSpec},i)))},t.prototype._remove=function(){var e=this;rtlTextPlugin.evented.off("pluginAvailable",this._rtlTextPluginCallback);for(var t in e.sourceCaches)e.sourceCaches[t].clearTiles();this.dispatcher.remove()},t.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},t.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()},t.prototype._updateSources=function(e){var t=this;for(var r in t.sourceCaches)t.sourceCaches[r].update(e)},t.prototype._redoPlacement=function(){var e=this;for(var t in e.sourceCaches)e.sourceCaches[t].redoPlacement()},t.prototype.getIcons=function(e,t,r){var i=this,s=function(){i.spriteAtlas.setSprite(i.sprite),i.spriteAtlas.addIcons(t.icons,r)};!this.sprite||this.sprite.loaded()?s():this.sprite.on("data",s)},t.prototype.getGlyphs=function(e,t,r){function i(e,t,i){e&&console.error(e),n[i]=t,0===--a&&r(null,n)}var s=this,o=t.stacks,a=Object.keys(o).length,n={};for(var l in o)s.glyphSource.getSimpleGlyphs(l,o[l],t.uid,i)},t}(Evented);module.exports=Style;
},{"../render/line_atlas":98,"../source/query_features":112,"../source/rtl_text_plugin":115,"../source/source":116,"../source/source_cache":117,"../style-spec/deref":126,"../style-spec/diff":127,"../style-spec/function":131,"../style-spec/reference/latest":133,"../symbol/glyph_source":188,"../symbol/sprite_atlas":193,"../util/ajax":216,"../util/browser":217,"../util/dispatcher":223,"../util/evented":226,"../util/global_worker_pool":229,"../util/minemap":236,"../util/util":244,"./animation_loop":160,"./image_sprite":161,"./light":162,"./style_layer":165,"./validate_style":179}],164:[function(_dereq_,module,exports){
"use strict";var createFunction=_dereq_("../style-spec/function"),util=_dereq_("../util/util"),StyleDeclaration=function(t,i){var o=this;if(this.value=util.clone(i),this.isFunction=createFunction.isFunctionDefinition(i),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.function=createFunction(this.value,t),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,this.isFeatureConstant||this.isZoomConstant){if(!this.isZoomConstant){this.stopZoomLevels=[];for(var n=0,s=o.value.stops;n<s.length;n+=1){var e=s[n];o.stopZoomLevels.indexOf(e[0])<0&&o.stopZoomLevels.push(e[0])}}}else{this.stopZoomLevels=[];for(var a=[],u=0,r=o.value.stops;u<r.length;u+=1){var l=r[u],c=l[0].zoom;o.stopZoomLevels.indexOf(c)<0&&(o.stopZoomLevels.push(c),a.push([c,a.length]))}this._functionInterpolationT=createFunction({type:"exponential",stops:a,base:i.base},{type:"number"})}};StyleDeclaration.prototype.calculate=function(t,i){try{var o=this.function(t&&t.zoom,i||{});return void 0!==this.minimum&&o<this.minimum?this.minimum:o}catch(t){}},StyleDeclaration.prototype.calculateInterpolationT=function(t){return this.isFeatureConstant||this.isZoomConstant?0:this._functionInterpolationT(t&&t.zoom,{})},module.exports=StyleDeclaration;
},{"../style-spec/function":131,"../util/util":244}],165:[function(_dereq_,module,exports){
"use strict";function getDeclarationValue(t){return t.value}var util=_dereq_("../util/util"),StyleTransition=_dereq_("./style_transition"),StyleDeclaration=_dereq_("./style_declaration"),styleSpec=_dereq_("../style-spec/reference/latest"),validateStyle=_dereq_("./validate_style"),parseColor=_dereq_("./../style-spec/util/parse_color"),Evented=_dereq_("../util/evented"),TRANSITION_SUFFIX="-transition",StyleLayer=function(t){function i(i){var e=this;t.call(this),this.id=i.id,this.metadata=i.metadata,this.type=i.type,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),this.paint={},this.layout={},this._paintSpecifications=styleSpec["paint_"+this.type],this._layoutSpecifications=styleSpec["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var a,n,o={validate:!1};for(var r in i){var s=r.match(/^paint(?:\.(.*))?$/);if(s){var l=s[1]||"";for(a in i[r])e.setPaintProperty(a,i[r][a],l,o)}}for(n in i.layout)e.setLayoutProperty(n,i.layout[n],o);for(a in e._paintSpecifications)e.paint[a]=e.getPaintValue(a);for(n in e._layoutSpecifications)e._updateLayoutValue(n)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setLayoutProperty=function(t,i,e){if(null==i)delete this._layoutDeclarations[t];else{var a="layers."+this.id+".layout."+t;if(this._validate(validateStyle.layoutProperty,a,t,i,e))return;this._layoutDeclarations[t]=new StyleDeclaration(this._layoutSpecifications[t],i)}this._updateLayoutValue(t)},i.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},i.prototype.getLayoutValue=function(t,i,e){var a=this._layoutSpecifications[t],n=this._layoutDeclarations[t];return n?n.calculate(i,e):a.default},i.prototype.setPaintProperty=function(t,i,e,a){var n="layers."+this.id+(e?'["paint.'+e+'"].':".paint.")+t;if(util.endsWith(t,TRANSITION_SUFFIX))if(this._paintTransitionOptions[e||""]||(this._paintTransitionOptions[e||""]={}),null===i||void 0===i)delete this._paintTransitionOptions[e||""][t];else{if(this._validate(validateStyle.paintProperty,n,t,i,a))return;this._paintTransitionOptions[e||""][t]=i}else if(this._paintDeclarations[e||""]||(this._paintDeclarations[e||""]={}),null===i||void 0===i)delete this._paintDeclarations[e||""][t];else{if(this._validate(validateStyle.paintProperty,n,t,i,a))return;this._paintDeclarations[e||""][t]=new StyleDeclaration(this._paintSpecifications[t],i)}},i.prototype.getPaintProperty=function(t,i){return i=i||"",util.endsWith(t,TRANSITION_SUFFIX)?this._paintTransitionOptions[i]&&this._paintTransitionOptions[i][t]:this._paintDeclarations[i]&&this._paintDeclarations[i][t]&&this._paintDeclarations[i][t].value},i.prototype.getPaintValue=function(t,i,e){var a=this._paintSpecifications[t],n=this._paintTransitions[t];return n?n.calculate(i,e):"color"===a.type&&a.default?parseColor(a.default):a.default},i.prototype.getPaintValueStopZoomLevels=function(t){var i=this._paintTransitions[t];return i?i.declaration.stopZoomLevels:[]},i.prototype.getLayoutValueStopZoomLevels=function(t){var i=this._layoutDeclarations[t];return i?i.stopZoomLevels:[]},i.prototype.getPaintInterpolationT=function(t,i){return this._paintTransitions[t].declaration.calculateInterpolationT(i)},i.prototype.getLayoutInterpolationT=function(t,i){return this._layoutDeclarations[t].calculateInterpolationT(i)},i.prototype.isPaintValueFeatureConstant=function(t){var i=this._paintTransitions[t];return!i||i.declaration.isFeatureConstant},i.prototype.isLayoutValueFeatureConstant=function(t){var i=this._layoutDeclarations[t];return!i||i.isFeatureConstant},i.prototype.isPaintValueZoomConstant=function(t){var i=this._paintTransitions[t];return!i||i.declaration.isZoomConstant},i.prototype.isLayoutValueZoomConstant=function(t){var i=this._layoutDeclarations[t];return!i||i.isZoomConstant},i.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility)},i.prototype.updatePaintTransitions=function(t,i,e,a,n){for(var o=this,r=util.extend({},this._paintDeclarations[""]),s=0;s<t.length;s++)util.extend(r,o._paintDeclarations[t[s]]);var l;for(l in r)o._applyPaintDeclaration(l,r[l],i,e,a,n);for(l in o._paintTransitions)l in r||o._applyPaintDeclaration(l,null,i,e,a,n)},i.prototype.updatePaintTransition=function(t,i,e,a,n,o){for(var r=this,s=this._paintDeclarations[""][t],l=0;l<i.length;l++){var u=r._paintDeclarations[i[l]];u&&u[t]&&(s=u[t])}this._applyPaintDeclaration(t,s,e,a,n,o)},i.prototype.recalculate=function(t){var i=this;for(var e in i._paintTransitions)i.paint[e]=i.getPaintValue(e,{zoom:t});for(var a in i._layoutFunctions)i.layout[a]=i.getLayoutValue(a,{zoom:t})},i.prototype.serialize=function(){var t=this,i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:util.mapObject(this._layoutDeclarations,getDeclarationValue)};for(var e in t._paintDeclarations){i[""===e?"paint":"paint."+e]=util.mapObject(t._paintDeclarations[e],getDeclarationValue)}return util.filterObject(i,function(t,i){return void 0!==t&&!("layout"===i&&!Object.keys(t).length)})},i.prototype._applyPaintDeclaration=function(t,i,e,a,n,o){var r=e.transition?this._paintTransitions[t]:void 0,s=this._paintSpecifications[t];if(null!==i&&void 0!==i||(i=new StyleDeclaration(s,s.default)),!r||r.declaration.json!==i.json){var l=util.extend({duration:300,delay:0},a,this.getPaintProperty(t+TRANSITION_SUFFIX)),u=this._paintTransitions[t]=new StyleTransition(s,i,r,l,o);u.instant()||(u.loopID=n.set(u.endTime-Date.now())),r&&n.cancel(r.loopID)}},i.prototype._updateLayoutValue=function(t){var i=this._layoutDeclarations[t];i&&i.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},i.prototype._validate=function(t,i,e,a,n){return(!n||!1!==n.validate)&&validateStyle.emitErrors(this,t.call(validateStyle,{key:i,layerType:this.type,objectKey:e,value:a,styleSpec:styleSpec,style:{glyphs:!0,sprite:!0}}))},i}(Evented);module.exports=StyleLayer;var subclasses={circle:_dereq_("./style_layer/circle_style_layer"),fill:_dereq_("./style_layer/fill_style_layer"),extrusion:_dereq_("./style_layer/extrusion_style_layer"),line:_dereq_("./style_layer/line_style_layer"),symbol:_dereq_("./style_layer/symbol_style_layer"),background:StyleLayer,raster:StyleLayer,sprite:_dereq_("./style_layer/sprite_style_layer"),histogram:_dereq_("./style_layer/histogram_style_layer"),airline:_dereq_("./style_layer/airline_style_layer"),tracking:_dereq_("./style_layer/tracking_style_layer"),symtracking:_dereq_("./style_layer/symtracking_style_layer"),dynamicLine:_dereq_("./style_layer/dynamic_line_style_layer")};StyleLayer.create=function(t){return new subclasses[t.type](t)};
},{"../style-spec/reference/latest":133,"../util/evented":226,"../util/util":244,"./../style-spec/util/parse_color":138,"./style_declaration":164,"./style_layer/airline_style_layer":166,"./style_layer/circle_style_layer":167,"./style_layer/dynamic_line_style_layer":168,"./style_layer/extrusion_style_layer":169,"./style_layer/fill_style_layer":170,"./style_layer/histogram_style_layer":171,"./style_layer/line_style_layer":172,"./style_layer/sprite_style_layer":173,"./style_layer/symbol_style_layer":174,"./style_layer/symtracking_style_layer":175,"./style_layer/tracking_style_layer":176,"./style_transition":178,"./validate_style":179}],166:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),AirlineBucket=_dereq_("../../data/bucket/airline_bucket"),AirlineStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new AirlineBucket(e)},t}(StyleLayer);module.exports=AirlineStyleLayer;
},{"../../data/bucket/airline_bucket":56,"../style_layer":165}],167:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),CircleBucket=_dereq_("../../data/bucket/circle_bucket"),CircleStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new CircleBucket(e)},t}(StyleLayer);module.exports=CircleStyleLayer;
},{"../../data/bucket/circle_bucket":57,"../style_layer":165}],168:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),DynamicLineBucket=_dereq_("../../data/bucket/dynamic_line_bucket"),DynamicLineStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new DynamicLineBucket(e)},t}(StyleLayer);module.exports=DynamicLineStyleLayer;
},{"../../data/bucket/dynamic_line_bucket":58,"../style_layer":165}],169:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),ExtrusionBucket=_dereq_("../../data/bucket/extrusion_bucket"),ExtrusionStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var u=t.prototype.getPaintValue.call(this,e,r,o);return"extrusion-color"===e&&u&&(u[3]=1),u},e.prototype.createBucket=function(t){return new ExtrusionBucket(t)},e}(StyleLayer);module.exports=ExtrusionStyleLayer;
},{"../../data/bucket/extrusion_bucket":59,"../style_layer":165}],170:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),FillBucket=_dereq_("../../data/bucket/fill_bucket"),FillStyleLayer=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getPaintValue=function(o,l,e){var i=this;if("fill-outline-color"===o){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",l,e);for(var r=this._paintTransitions["fill-outline-color"];r;){if(!(r&&r.declaration&&r.declaration.value))return t.prototype.getPaintValue.call(i,"fill-color",l,e);r=r.oldTransition}}return t.prototype.getPaintValue.call(this,o,l,e)},o.prototype.getPaintValueStopZoomLevels=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,o)},o.prototype.getPaintInterpolationT=function(o,l){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",l):t.prototype.getPaintInterpolationT.call(this,o,l)},o.prototype.isPaintValueFeatureConstant=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,o)},o.prototype.isPaintValueZoomConstant=function(o){return"fill-outline-color"===o&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,o)},o.prototype.createBucket=function(t){return new FillBucket(t)},o}(StyleLayer);module.exports=FillStyleLayer;
},{"../../data/bucket/fill_bucket":60,"../style_layer":165}],171:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),HistogramBucket=_dereq_("../../data/bucket/histogram_bucket"),HistogramStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,r,o){var a=t.prototype.getPaintValue.call(this,e,r,o);return"histogram-color"===e&&a&&(a[3]=1),a},e.prototype.createBucket=function(t){return new HistogramBucket(t)},e}(StyleLayer);module.exports=HistogramStyleLayer;
},{"../../data/bucket/histogram_bucket":61,"../style_layer":165}],172:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/line_bucket"),LineStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new LineBucket(e)},t}(StyleLayer);module.exports=LineStyleLayer;
},{"../../data/bucket/line_bucket":62,"../style_layer":165}],173:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),SpriteBucket=_dereq_("../../data/bucket/sprite_bucket"),SpriteStyleLayer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new SpriteBucket(e)},t}(StyleLayer);module.exports=SpriteStyleLayer;
},{"../../data/bucket/sprite_bucket":63,"../style_layer":165}],174:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),SymbolBucket=_dereq_("../../data/bucket/symbol_bucket"),SymbolStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,o,r){var a=t.prototype.getLayoutValue.call(this,e,o,r);if("auto"!==a)return a;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",o,r)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",o,r);case"icon-pitch-alignment":return this.getLayoutValue("icon-rotation-alignment",o,r);default:return a}},e.prototype.createBucket=function(t){return new SymbolBucket(t)},e}(StyleLayer);module.exports=SymbolStyleLayer;
},{"../../data/bucket/symbol_bucket":64,"../style_layer":165}],175:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),SymtrackingBucket=_dereq_("../../data/bucket/symtracking_bucket"),SymtrackingStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,r,a){var n=t.prototype.getLayoutValue.call(this,e,r,a);if("auto"!==n)return n;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",r,a)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",r,a);case"icon-pitch-alignment":return this.getLayoutValue("icon-rotation-alignment",r,a);default:return n}},e.prototype.createBucket=function(t){return new SymtrackingBucket(t)},e}(StyleLayer);module.exports=SymtrackingStyleLayer;
},{"../../data/bucket/symtracking_bucket":65,"../style_layer":165}],176:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),TrackingBucket=_dereq_("../../data/bucket/tracking_bucket"),TrackingStyleLayer=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new TrackingBucket(t)},e}(StyleLayer);module.exports=TrackingStyleLayer;
},{"../../data/bucket/tracking_bucket":66,"../style_layer":165}],177:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("./style_layer"),util=_dereq_("../util/util"),featureFilter=_dereq_("../style-spec/feature_filter"),groupByLayout=_dereq_("../style-spec/group_by_layout"),StyleLayerIndex=function(e){e&&this.replace(e)};StyleLayerIndex.prototype.replace=function(e){var r=this;this.symbolOrder=[];for(var t=0,i=e;t<i.length;t+=1){var a=i[t];"symbol"!==a.type&&"symtracking"!==a.type||r.symbolOrder.push(a.id)}this._layerConfigs={},this._layers={},this.update(e,[])},StyleLayerIndex.prototype.update=function(e,r,t){for(var i=this,a=0,l=e;a<l.length;a+=1){var y=l[a];i._layerConfigs[y.id]=y;var s=i._layers[y.id]=StyleLayer.create(y);s.updatePaintTransitions({},{transition:!1}),s.filter=featureFilter(s.filter)}for(var o=0,u=r;o<u.length;o+=1){var n=u[o];delete i._layerConfigs[n],delete i._layers[n]}t&&(this.symbolOrder=t),this.familiesBySource={};for(var f=groupByLayout(util.values(this._layerConfigs)),p=0,d=f;p<d.length;p+=1){var c=d[p],h=c.map(function(e){return i._layers[e.id]}),v=h[0];if(!v.layout||"none"!==v.layout.visibility){var g=v.source||"",_=i.familiesBySource[g];_||(_=i.familiesBySource[g]={});var m=v.sourceLayer||"_geojsonTileLayer",L=_[m];L||(L=_[m]=[]),L.push(h)}}},module.exports=StyleLayerIndex;
},{"../style-spec/feature_filter":129,"../style-spec/group_by_layout":132,"../util/util":244,"./style_layer":165}],178:[function(_dereq_,module,exports){
"use strict";function interpZoomTransitioned(t,i,e){if(void 0!==t&&void 0!==i)return{from:t.to,fromScale:t.toScale,to:i.to,toScale:i.toScale,t:e}}var util=_dereq_("../util/util"),interpolate=_dereq_("../style-spec/util/interpolate"),fakeZoomHistory={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},StyleTransition=function(t,i,e,o,a){this.declaration=i,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=e,this.duration=o.duration||0,this.delay=o.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?interpZoomTransitioned:interpolate[t.type],this.zoomHistory=a||fakeZoomHistory,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),e&&e.endTime<=this.startTime&&delete e.oldTransition};StyleTransition.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},StyleTransition.prototype.calculate=function(t,i,e){var o=this._calculateTargetValue(t,i);if(this.instant())return o;if((e=e||Date.now())>=this.endTime)return o;var a=this.oldTransition.calculate(t,i,this.startTime),n=util.easeCubicInOut((e-this.startTime-this.delay)/this.duration);return this.interp(a,o,n)},StyleTransition.prototype._calculateTargetValue=function(t,i){if(!this.zoomTransitioned)return this.declaration.calculate(t,i);var e=t.zoom,o=this.zoomHistory.lastIntegerZoom,a=e>o?2:.5,n=this.declaration.calculate({zoom:e>o?e-1:e+1},i),r=this.declaration.calculate({zoom:e},i),s=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),l=Math.abs(e-o),u=interpolate(s,1,l);return void 0!==n&&void 0!==r?{from:n,fromScale:a,to:r,toScale:1,t:u}:void 0},module.exports=StyleTransition;
},{"../style-spec/util/interpolate":137,"../util/util":244}],179:[function(_dereq_,module,exports){
"use strict";module.exports=_dereq_("../style-spec/validate_style.min"),module.exports.emitErrors=function(r,e){if(e&&e.length){for(var t=0;t<e.length;t++)r.fire("error",{error:new Error(e[t].message)});return!0}return!1};
},{"../style-spec/validate_style.min":159}],180:[function(_dereq_,module,exports){
"use strict";var Point=_dereq_("../_minemap_/point-geometry"),Anchor=function(t){function e(e,o,n,r){t.call(this,e,o),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(Point);module.exports=Anchor;
},{"../_minemap_/point-geometry":41}],181:[function(_dereq_,module,exports){
"use strict";function checkMaxAngle(e,t,a,r,n){if(void 0===t.segment)return!0;for(var i=t,s=t.segment+1,f=0;f>-a/2;){if(--s<0)return!1;f-=e[s].dist(i),i=e[s]}f+=e[s].dist(e[s+1]),s++;for(var l=[],o=0;f<a/2;){var u=e[s-1],c=e[s],g=e[s+1];if(!g)return!1;var h=u.angleTo(c)-c.angleTo(g);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:f,angleDelta:h}),o+=h;f-l[0].distance>r;)o-=l.shift().angleDelta;if(o>n)return!1;s++,f+=c.dist(g)}return!0}module.exports=checkMaxAngle;
},{}],182:[function(_dereq_,module,exports){
"use strict";function clipLine(n,x,y,o,e,i){for(var t=[],r=0;r<n.length;r++)for(var u=n[r],d=void 0,_=0;_<u.length-1;_++){var P=u[_],w=u[_+1];if(i)P.x<x?P=new Point(x,P.y+(w.y-P.y)*((x-P.x)/(w.x-P.x)))._round():w.x<x&&(w=new Point(x,P.y+(w.y-P.y)*((x-P.x)/(w.x-P.x)))._round()),P.y<y?P=new Point(P.x+(w.x-P.x)*((y-P.y)/(w.y-P.y)),y)._round():w.y<y&&(w=new Point(P.x+(w.x-P.x)*((y-P.y)/(w.y-P.y)),y)._round()),P.x>=o?P=new Point(o,P.y+(w.y-P.y)*((o-P.x)/(w.x-P.x)))._round():w.x>=o&&(w=new Point(o,P.y+(w.y-P.y)*((o-P.x)/(w.x-P.x)))._round()),P.y>=e?P=new Point(P.x+(w.x-P.x)*((e-P.y)/(w.y-P.y)),e)._round():w.y>=e&&(w=new Point(P.x+(w.x-P.x)*((e-P.y)/(w.y-P.y)),e)._round());else{if(P.x<x&&w.x<x)continue;if(P.x<x?P=new Point(x,P.y+(w.y-P.y)*((x-P.x)/(w.x-P.x)))._round():w.x<x&&(w=new Point(x,P.y+(w.y-P.y)*((x-P.x)/(w.x-P.x)))._round()),P.y<y&&w.y<y)continue;if(P.y<y?P=new Point(P.x+(w.x-P.x)*((y-P.y)/(w.y-P.y)),y)._round():w.y<y&&(w=new Point(P.x+(w.x-P.x)*((y-P.y)/(w.y-P.y)),y)._round()),P.x>=o&&w.x>=o)continue;if(P.x>=o?P=new Point(o,P.y+(w.y-P.y)*((o-P.x)/(w.x-P.x)))._round():w.x>=o&&(w=new Point(o,P.y+(w.y-P.y)*((o-P.x)/(w.x-P.x)))._round()),P.y>=e&&w.y>=e)continue;P.y>=e?P=new Point(P.x+(w.x-P.x)*((e-P.y)/(w.y-P.y)),e)._round():w.y>=e&&(w=new Point(P.x+(w.x-P.x)*((e-P.y)/(w.y-P.y)),e)._round())}d&&P.equals(d[d.length-1])||(d=[P],t.push(d)),d.push(w)}return t}var Point=_dereq_("../_minemap_/point-geometry");module.exports=clipLine;
},{"../_minemap_/point-geometry":41}],183:[function(_dereq_,module,exports){
"use strict";var createStructArrayType=_dereq_("../util/struct_array"),Point=_dereq_("../_minemap_/point-geometry"),CollisionBoxArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"offsetX"},{type:"Int16",name:"offsetY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"unadjustedMaxScale"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(CollisionBoxArray.prototype.StructType.prototype,"anchorPoint",{get:function(){return new Point(this.anchorPointX,this.anchorPointY)}}),module.exports=CollisionBoxArray;
},{"../_minemap_/point-geometry":41,"../util/struct_array":241}],184:[function(_dereq_,module,exports){
"use strict";var CollisionFeature=function(t,e,i,o,a,n,s,l,r,d,u){var h=s.top*l-r,f=s.bottom*l+r,x=s.left*l-r,m=s.right*l+r;if(this.boxStartIndex=t.length,d){var _=f-h,b=m-x;if(_>0)if(_=Math.max(10*l,_),u){var v=e[i.segment+1].sub(e[i.segment])._unit()._mult(b),c=[i.sub(v),i.add(v)];this._addLineCollisionBoxes(t,c,i,0,b,_,o,a,n)}else this._addLineCollisionBoxes(t,e,i,i.segment,b,_,o,a,n)}else t.emplaceBack(i.x,i.y,0,0,x,h,m,f,1/0,1/0,o,a,n,0,0,0,0,0);this.boxEndIndex=t.length};CollisionFeature.prototype._addLineCollisionBoxes=function(t,e,i,o,a,n,s,l,r){var d=n/2,u=Math.floor(a/d),h=Math.floor(u/2),f=-n/2,x=i,m=o+1,_=f,b=-a/2,v=b-a/8;do{if(--m<0){if(_>b)return;m=0;break}_-=e[m].dist(x),x=e[m]}while(_>v);for(var c=e[m].dist(e[m+1]),g=-h;g<u+h;g++){var p=g*d,C=b+p;if(p<0&&(C+=p),p>a&&(C+=p-a),!(C<_)){for(;_+c<C;){if(_+=c,++m+1>=e.length)return;c=e[m].dist(e[m+1])}var M=C-_,y=e[m],B=e[m+1],k=B.sub(y)._unit()._mult(M)._add(y)._round(),F=Math.max(Math.abs(C-f)-d/2,0),L=a/2/F;(g<0||g>=u)&&(L=Math.min(L,.99)),t.emplaceBack(k.x,k.y,k.x-i.x,k.y-i.y,-n/2,-n/2,n/2,n/2,L,L,s,l,r,0,0,0,0,0)}}},module.exports=CollisionFeature;
},{}],185:[function(_dereq_,module,exports){
"use strict";var Point=_dereq_("../_minemap_/point-geometry"),EXTENT=_dereq_("../data/extent"),Grid=_dereq_("grid-index"),intersectionTests=_dereq_("../util/intersection_tests"),CollisionTile=function(e,t,i,a,r,o,n){void 0===o&&(o=new Grid(EXTENT,12,6)),void 0===n&&(n=new Grid(EXTENT,12,0)),this.angle=e,this.pitch=t,this.cameraToCenterDistance=i,this.cameraToTileDistance=a,this.grid=o,this.ignoredGrid=n,this.perspectiveRatio=1+.5*(a/i-1),this.minScale=.5/this.perspectiveRatio,this.maxScale=2/this.perspectiveRatio;var s=Math.sin(this.angle),l=Math.cos(this.angle);this.rotationMatrix=[l,-s,s,l],this.reverseRotationMatrix=[l,s,-s,l],this.yStretch=Math.max(1,a/(i*Math.cos(t/180*Math.PI))),this.collisionBoxArray=r,0===r.length&&(r.emplaceBack(),r.emplaceBack(0,0,0,0,0,-EXTENT,0,EXTENT,1/0,1/0,0,0,0,0,0,0,0,0,0),r.emplaceBack(EXTENT,0,0,0,0,-EXTENT,0,EXTENT,1/0,1/0,0,0,0,0,0,0,0,0,0),r.emplaceBack(0,0,0,0,-EXTENT,0,EXTENT,0,1/0,1/0,0,0,0,0,0,0,0,0,0),r.emplaceBack(0,EXTENT,0,0,-EXTENT,0,EXTENT,0,1/0,1/0,0,0,0,0,0,0,0,0,0)),this.tempCollisionBox=r.get(0),this.edges=[r.get(1),r.get(2),r.get(3),r.get(4)]};CollisionTile.deserialize=function(e,t){return new CollisionTile(e.angle,e.pitch,e.cameraToCenterDistance,e.cameraToTileDistance,t,new Grid(e.grid),new Grid(e.ignoredGrid))},CollisionTile.prototype.serialize=function(e){var t=this.grid.toArrayBuffer(),i=this.ignoredGrid.toArrayBuffer();return e&&(e.push(t),e.push(i)),{angle:this.angle,pitch:this.pitch,cameraToCenterDistance:this.cameraToCenterDistance,cameraToTileDistance:this.cameraToTileDistance,grid:t,ignoredGrid:i}},CollisionTile.prototype.placeCollisionFeature=function(e,t,i){for(var a=this,r=this.collisionBoxArray,o=this.minScale,n=this.rotationMatrix,s=this.yStretch,l=e.boxStartIndex;l<e.boxEndIndex;l++){var c=r.get(l),h=c.anchorPoint._matMult(n),x=h.x,m=h.y,p=x+c.x1*a.perspectiveRatio,y=m+c.y1*s*a.perspectiveRatio,g=x+c.x2*a.perspectiveRatio,d=m+c.y2*s*a.perspectiveRatio;c.bbox0=p,c.bbox1=y,c.bbox2=g,c.bbox3=d;var T=new Point(c.offsetX,c.offsetY)._matMult(n),u=T.x*T.x,v=T.y*T.y,M=v*s*s,f=Math.sqrt((u+M)/(u+v))||1;if(c.maxScale=c.unadjustedMaxScale*f,!t)for(var E=a.grid.query(p,y,g,d),S=0;S<E.length;S++){var P=r.get(E[S]),N=P.anchorPoint._matMult(n);if((o=a.getPlacementScale(o,h,c,N,P))>=a.maxScale)return o}if(i){var b=void 0;if(a.angle){var C=a.reverseRotationMatrix,w=new Point(c.x1,c.y1).matMult(C),X=new Point(c.x2,c.y1).matMult(C),B=new Point(c.x1,c.y2).matMult(C),G=new Point(c.x2,c.y2).matMult(C);b=a.tempCollisionBox,b.anchorPointX=c.anchorPoint.x,b.anchorPointY=c.anchorPoint.y,b.x1=Math.min(w.x,X.x,B.x,G.x),b.y1=Math.min(w.y,X.x,B.x,G.x),b.x2=Math.max(w.x,X.x,B.x,G.x),b.y2=Math.max(w.y,X.x,B.x,G.x),b.maxScale=c.maxScale}else b=c;for(var R=0;R<this.edges.length;R++){var q=a.edges[R];if((o=a.getPlacementScale(o,c.anchorPoint,b,q.anchorPoint,q))>=a.maxScale)return o}}}return o},CollisionTile.prototype.queryRenderedSymbols=function(e,t){var i={},a=[];if(0===e.length||0===this.grid.keys.length&&0===this.ignoredGrid.keys.length)return a;for(var r=this.collisionBoxArray,o=this.rotationMatrix,n=this.yStretch,s=[],l=1/0,c=1/0,h=-1/0,x=-1/0,m=0;m<e.length;m++)for(var p=e[m],y=0;y<p.length;y++){var g=p[y].matMult(o);l=Math.min(l,g.x),c=Math.min(c,g.y),h=Math.max(h,g.x),x=Math.max(x,g.y),s.push(g)}for(var d=this.grid.query(l,c,h,x),T=this.ignoredGrid.query(l,c,h,x),u=0;u<T.length;u++)d.push(T[u]);for(var v=t/this.perspectiveRatio,M=Math.pow(2,Math.ceil(Math.log(v)/Math.LN2*10)/10),f=0;f<d.length;f++){var E=r.get(d[f]),S=E.sourceLayerIndex,P=E.featureIndex;if(void 0===i[S]&&(i[S]={}),!i[S][P]&&!(M<E.placementScale||M>E.maxScale)){var N=E.anchorPoint.matMult(o),b=N.x+E.x1/v,C=N.y+E.y1/v*n,w=N.x+E.x2/v,X=N.y+E.y2/v*n,B=[new Point(b,C),new Point(w,C),new Point(w,X),new Point(b,X)];intersectionTests.polygonIntersectsPolygon(s,B)&&(i[S][P]=!0,a.push(d[f]))}}return a},CollisionTile.prototype.getPlacementScale=function(e,t,i,a,r){var o=t.x-a.x,n=t.y-a.y,s=(r.x1-i.x2)/o,l=(r.x2-i.x1)/o,c=(r.y1-i.y2)*this.yStretch/n,h=(r.y2-i.y1)*this.yStretch/n;(isNaN(s)||isNaN(l))&&(s=l=1),(isNaN(c)||isNaN(h))&&(c=h=1);var x=Math.min(Math.max(s,l),Math.max(c,h)),m=r.maxScale,p=i.maxScale;return x>m&&(x=m),x>p&&(x=p),x>e&&x>=r.placementScale&&(e=x),e},CollisionTile.prototype.insertCollisionFeature=function(e,t,i){for(var a=this,r=i?this.ignoredGrid:this.grid,o=this.collisionBoxArray,n=e.boxStartIndex;n<e.boxEndIndex;n++){var s=o.get(n);s.placementScale=t,t<a.maxScale&&(1===a.perspectiveRatio||s.maxScale>=1)&&r.insert(n,s.bbox0,s.bbox1,s.bbox2,s.bbox3)}},module.exports=CollisionTile;
},{"../_minemap_/point-geometry":41,"../data/extent":70,"../util/intersection_tests":233,"grid-index":4}],186:[function(_dereq_,module,exports){
"use strict";function getAnchors(e,r,t,n,a,l,o,c,h,i){var s=n?.6*l*o:0,u=Math.max(n?n.right-n.left:0,a?a.right-a.left:0),g=0===e[0].x||e[0].x===h||0===e[0].y||e[0].y===h;r-u*o<r/4&&(r=u*o+r/4);var p=2*l;return resample(e,g?r/2*c%r:(u/2+p)*o*c%r,r,s,t,u*o,g,!1,h,i)}function resample(e,r,t,n,a,l,o,c,h,i){for(var s=l/2,u=0,g=0;g<e.length-1;g++)u+=e[g].dist(e[g+1]);for(var p=0,x=r-t,f=[],v=0;v<e.length-1;v++){for(var A=e[v],m=e[v+1],y=A.dist(m),d=m.angleTo(A);x+t<p+y;){x+=t;var k=(x-p)/y,M=interpolate(A.x,m.x,k),_=interpolate(A.y,m.y,k);if(!i&&M>=0&&M<h&&_>=0&&_<h&&x-s>=0&&x+s<=u){var q=new Anchor(M,_,d,v)._round();n&&!checkMaxAngle(e,q,l,n,a)||f.push(q)}if(i&&M>=0&&M<h&&_>=0&&_<h){var w=new Anchor(M,_,d,v)._round();n&&!checkMaxAngle(e,w,l,n,a)||f.push(w)}}p+=y}return c||f.length||o||(f=resample(e,p/2,t,n,a,l,o,!0,h,i)),f}var interpolate=_dereq_("../style-spec/util/interpolate"),Anchor=_dereq_("../symbol/anchor"),checkMaxAngle=_dereq_("./check_max_angle");module.exports=getAnchors;
},{"../style-spec/util/interpolate":137,"../symbol/anchor":180,"./check_max_angle":181}],187:[function(_dereq_,module,exports){
"use strict";var ShelfPack=_dereq_("../_minemap_/shelf-pack"),util=_dereq_("../util/util"),SIZE_GROWTH_RATE=4,DEFAULT_SIZE=128,MAX_SIZE=2048,GlyphAtlas=function(){this.width=DEFAULT_SIZE,this.height=DEFAULT_SIZE,this.atlas=new ShelfPack(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};GlyphAtlas.prototype.getGlyphs=function(){var t,i,e,h=this,r={};for(var s in h.ids)t=s.split("#"),i=t[0],e=t[1],r[i]||(r[i]=[]),r[i].push(e);return r},GlyphAtlas.prototype.getRects=function(){var t,i,e,h=this,r={};for(var s in h.ids)t=s.split("#"),i=t[0],e=t[1],r[i]||(r[i]={}),r[i][e]=h.index[s];return r},GlyphAtlas.prototype.addGlyph=function(t,i,e,h){var r=this;if(!e)return null;var s=i+"#"+e.id;if(this.index[s])return this.ids[s].indexOf(t)<0&&this.ids[s].push(t),this.index[s];if(!e.bitmap)return null;var a=e.width+2*h,n=e.height+2*h,E=a+2,l=n+2,T=this.atlas.packOne(E,l);if(T||(this.resize(),T=this.atlas.packOne(E,l)),!T)return util.warnOnce("glyph bitmap overflow"),null;this.index[s]=T,this.ids[s]=[t];for(var u=this.data,d=e.bitmap,_=0;_<n;_++)for(var p=r.width*(T.y+_+1)+T.x+1,A=a*_,o=0;o<a;o++)u[p+o]=d[A+o];return this.dirty=!0,T},GlyphAtlas.prototype.resize=function(){var t=this,i=this.width,e=this.height;if(!(i>=MAX_SIZE||e>=MAX_SIZE)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=SIZE_GROWTH_RATE,this.height*=SIZE_GROWTH_RATE,this.atlas.resize(this.width,this.height);for(var h=new ArrayBuffer(this.width*this.height),r=0;r<e;r++){var s=new Uint8Array(t.data.buffer,e*r,i);new Uint8Array(h,e*r*SIZE_GROWTH_RATE,i).set(s)}this.data=new Uint8Array(h)}},GlyphAtlas.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},GlyphAtlas.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},module.exports=GlyphAtlas;
},{"../_minemap_/shelf-pack":42,"../util/util":244}],188:[function(_dereq_,module,exports){
"use strict";function glyphUrl(t,e,r,a){return a=a||"abc",r.replace("{s}",a[t.length%a.length]).replace("{fontstack}",t).replace("{range}",e)}var normalizeURL=_dereq_("../util/minemap").normalizeGlyphsURL,ajax=_dereq_("../util/ajax"),Glyphs=_dereq_("../util/glyphs"),GlyphAtlas=_dereq_("../symbol/glyph_atlas"),Protobuf=_dereq_("pbf"),TinySDF=_dereq_("../_minemap_/tiny-sdf"),isChar=_dereq_("../util/is_char_in_unicode_block"),Evented=_dereq_("../util/evented"),SimpleGlyph=function(t,e,r){this.advance=t.advance,this.left=t.left-r-1,this.top=t.top+r+1,this.rect=e},GlyphSource=function(t){function e(e,r,a,i){t.call(this),this.url=e&&normalizeURL(e),this.atlases={},this.stacks={},this.loading={},this.localIdeographFontFamily=r,this.tinySDFs={},this.setEventedParent(i),this.transformRequestCallback=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getSimpleGlyphs=function(t,e,r,a){var i=this;void 0===this.stacks[t]&&(this.stacks[t]={ranges:{},cjkGlyphs:{}}),void 0===this.atlases[t]&&(this.atlases[t]=new GlyphAtlas);for(var l={},s=this.stacks[t],o=this.atlases[t],n={},h=0,p=0,y=e;p<y.length;p+=1){var u=y[p];!function(e){var a=Math.floor(e/256);if(i.localIdeographFontFamily&&(isChar["CJK Unified Ideographs"](e)||isChar["Hangul Syllables"](e))){s.cjkGlyphs[e]||(s.cjkGlyphs[e]=i.loadCJKGlyph(t,e));var p=s.cjkGlyphs[e],y=o.addGlyph(r,t,p,3);p&&(l[e]=new SimpleGlyph(p,y,3))}else if(s.ranges[a]){var u=s.ranges[a].glyphs[e],c=o.addGlyph(r,t,u,3);u&&(l[e]=new SimpleGlyph(u,c,3))}else void 0===n[a]&&(n[a]=[],h++),n[a].push(e)}(u)}h||a(void 0,l,t);var c=function(e,s,p){if(e)i.fire("error",{error:e});else if("number"==typeof s&&p){for(var y=i.stacks[t].ranges[s]=p.stacks[0],u=0;u<n[s].length;u++){var c=n[s][u],d=y.glyphs[c],f=o.addGlyph(r,t,d,3);d&&(l[c]=new SimpleGlyph(d,f,3))}h--,h||a(void 0,l,t)}};for(var d in n)i.loadRange(t,+d,c)},e.prototype.createTinySDF=function(t,e){return new TinySDF(22,4,8,.25,t,e)},e.prototype.loadCJKGlyph=function(t,e){var r=this.tinySDFs[t];if(!r){var a="500";/NORMAL/i.test(t)?a="500":/REGULAR/i.test(t)?a="400":/BOLD/i.test(t)&&(a="900"),r=this.tinySDFs[t]=this.createTinySDF(this.localIdeographFontFamily,a)}return{id:e,bitmap:r.draw(String.fromCharCode(e)),width:24,height:24,left:0,top:-3,advance:22}},e.prototype.loadPBF=function(t,e){var r=this.transformRequestCallback?this.transformRequestCallback(t,ajax.ResourceType.Glyphs):{url:t};ajax.getArrayBuffer(r,e)},e.prototype.loadRange=function(t,e,r){if(256*e>65535)return void r(new Error("glyphs > 65535 not supported"));void 0===this.loading[t]&&(this.loading[t]={});var a=this.loading[t];if(a[e])a[e].push(r);else{a[e]=[r];var i=256*e+"-"+(256*e+255),l=glyphUrl(t,i,this.url);this.loadPBF(l,function(t,r){if(t)for(var i=0,l=a[e];i<l.length;i+=1){var s=l[i];s(t)}else if(r)for(var o=new Glyphs(new Protobuf(r.data)),n=0,h=a[e];n<h.length;n+=1){var p=h[n];p(null,e,o)}delete a[e]})}},e.prototype.getGlyphAtlas=function(t){return this.atlases[t]},e}(Evented);module.exports=GlyphSource;
},{"../_minemap_/tiny-sdf":44,"../symbol/glyph_atlas":187,"../util/ajax":216,"../util/evented":226,"../util/glyphs":230,"../util/is_char_in_unicode_block":234,"../util/minemap":236,"pbf":18}],189:[function(_dereq_,module,exports){
"use strict";module.exports=function(e){function t(t){g.push(e[t]),l++}function r(e,t,r){var n=u[e];return delete u[e],u[t]=n,g[n].geometry[0].pop(),g[n].geometry[0]=g[n].geometry[0].concat(r[0]),n}function n(e,t,r){var n=i[t];return delete i[t],i[e]=n,g[n].geometry[0].shift(),g[n].geometry[0]=r[0].concat(g[n].geometry[0]),n}function o(e,t,r){var n=r?t[0][t[0].length-1]:t[0][0];return e+":"+n.x+":"+n.y}for(var i={},u={},g=[],l=0,m=0;m<e.length;m++){var y=e[m],c=y.geometry,f=y.text;if(f){var a=o(f,c),s=o(f,c,!0);if(a in u&&s in i&&u[a]!==i[s]){var v=n(a,s,c),d=r(a,s,g[v].geometry);delete i[a],delete u[s],u[o(f,g[d].geometry,!0)]=d,g[v].geometry=null}else a in u?r(a,s,c):s in i?n(a,s,c):(t(m),i[a]=l-1,u[s]=l-1)}else t(m)}return g.filter(function(e){return e.geometry})};
},{}],190:[function(_dereq_,module,exports){
"use strict";function getLabelPlaneMatrix(e,t,a,n,r){var i=mat4.identity(new Float32Array(16));return t?(mat4.identity(i),mat4.scale(i,i,[1/r,1/r,1]),a||mat4.rotateZ(i,i,n.angle)):(mat4.scale(i,i,[n.width/2,-n.height/2,1]),mat4.translate(i,i,[1,-1,0]),mat4.multiply(i,i,e)),i}function getGlCoordMatrix(e,t,a,n,r){var i=mat4.identity(new Float32Array(16));return t?(mat4.multiply(i,i,e),mat4.scale(i,i,[r,r,1]),a||mat4.rotateZ(i,i,-n.angle)):(mat4.scale(i,i,[1,-1,1]),mat4.translate(i,i,[-1,-1,0]),mat4.scale(i,i,[2/n.width,2/n.height,1])),i}function project(e,t){var a=[e.x,e.y,0,1];return vec4.transformMat4(a,a,t),new Point(a[0]/a[3],a[1]/a[3])}function isVisible(e,t,a,n){var r=e[0]/e[3],i=e[1]/e[3];return r>=-a[0]&&r<=a[0]&&i>=-a[1]&&i<=a[1]&&n.frameHistory.isVisible(t)}function updateLineLabels(e,t,a,n,r,i,l,o,s,m){var p=n?e.textSizeData:e.iconSizeData,u=symbolSize.evaluateSizeForZoom(p,a.transform,m,n),y=[256/a.width*2+1,256/a.height*2+1],c=n?e.buffers.glyph.dynamicLayoutVertexArray:e.buffers.icon.dynamicLayoutVertexArray;c.clear();for(var f=e.lineVertexArray,g=n?e.placedGlyphArray:e.placedIconArray,h=0;h<g.length;h++){var d=g.get(h),v=[d.anchorX,d.anchorY,0,1];if(vec4.transformMat4(v,v,t),isVisible(v,d.placementZoom,y,a)){var x=v[3],b=1+.5*(x/a.transform.cameraToCenterDistance-1),L=symbolSize.evaluateSizeForFeature(p,u,d),A=l?L*b:L/b,G=project(new Point(d.anchorX,d.anchorY),r),S={},I=placeGlyphsAlongLine(d,A,!1,o,t,r,i,e.glyphOffsetArray,f,c,G,S);(I.notEnoughRoom||I.needsFlipping&&placeGlyphsAlongLine(d,A,!0,o,t,r,i,e.glyphOffsetArray,f,c,G,S).notEnoughRoom)&&hideGlyphs(d.numGlyphs,c)}else hideGlyphs(d.numGlyphs,c)}n?e.buffers.glyph.dynamicLayoutVertexBuffer.updateData(c.serialize()):e.buffers.icon.dynamicLayoutVertexBuffer.updateData(c.serialize())}function placeGlyphsAlongLine(e,t,a,n,r,i,l,o,s,m,p,u){var y,c=t/24,f=e.lineOffsetX*t,g=e.lineOffsetY*t;if(e.numGlyphs>1){var h=e.glyphStartIndex+e.numGlyphs,d=o.get(e.glyphStartIndex).offsetX,v=o.get(h-1).offsetX,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,L=placeGlyphAlongLine(c*d,f,g,a,p,e.segment,x,b,s,i,u);if(!L)return{notEnoughRoom:!0};var A=placeGlyphAlongLine(c*v,f,g,a,p,e.segment,x,b,s,i,u);if(!A)return{notEnoughRoom:!0};var G=project(L.point,l),S=project(A.point,l);if(n&&!a&&(e.vertical?G.y<S.y:G.x>S.x))return{needsFlipping:!0};y=[L];for(var I=e.glyphStartIndex+1;I<h-1;I++){var _=o.get(I);y.push(placeGlyphAlongLine(c*_.offsetX,f,g,a,p,e.segment,x,b,s,i,u))}y.push(A)}else{if(n&&!a){var M=project(s.get(e.lineStartIndex+e.segment),r),P=project(s.get(e.lineStartIndex+e.segment+1),r);if(e.vertical?P.y>M.y:P.x<M.x)return{needsFlipping:!0}}var z=o.get(e.glyphStartIndex),D=placeGlyphAlongLine(c*z.offsetX,f,g,a,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,s,i,u);if(!D)return{notEnoughRoom:!0};y=[D]}for(var w=e.placementZoom,F=0,V=y;F<V.length;F+=1){var j=V[F];addDynamicAttributes(m,j.point,j.angle,w)}return{}}function placeGlyphAlongLine(e,t,a,n,r,i,l,o,s,m,p){var u=n?e-t:e+t,y=u>0?1:-1,c=0;n&&(y*=-1,c=Math.PI),y<0&&(c+=Math.PI);for(var f=y>0?l+i:l+i+1,g=r,h=r,d=0,v=0,x=Math.abs(u);d+v<=x;){if((f+=y)<l||f>=o)return null;h=g,g=p[f],void 0===g&&(g=p[f]=project(s.get(f),m)),d+=v,v=h.dist(g)}var b=(x-d)/v,L=g.sub(h),A=L.mult(b)._add(h);return A._add(L._unit()._perp()._mult(a*y)),{point:A,angle:c+Math.atan2(g.y-h.y,g.x-h.x)}}function hideGlyphs(e,t){for(var a=0;a<e;a++)addDynamicAttributes(t,offscreenPoint,0,25)}var Point=_dereq_("../_minemap_/point-geometry"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,vec4=_dereq_("../_minemap_/gl-matrix").vec4,symbolSize=_dereq_("./symbol_size"),addDynamicAttributes=_dereq_("../data/bucket/symbol_bucket").addDynamicAttributes;module.exports={updateLineLabels:updateLineLabels,getLabelPlaneMatrix:getLabelPlaneMatrix,getGlCoordMatrix:getGlCoordMatrix};var offscreenPoint=new Point(-1/0,-1/0);
},{"../_minemap_/gl-matrix":39,"../_minemap_/point-geometry":41,"../data/bucket/symbol_bucket":64,"./symbol_size":194}],191:[function(_dereq_,module,exports){
"use strict";function SymbolQuad(t,e,i,n,o,a,u){this.tl=t,this.tr=e,this.bl=i,this.br=n,this.tex=o,this.writingMode=a,this.glyphOffset=u}function getIconQuads(t,e,i,n,o,a,u){var l,r,d,h,s=e.image,c=i.layout,g=e.top-1/s.pixelRatio,f=e.left-1/s.pixelRatio,x=e.bottom+1/s.pixelRatio,p=e.right+1/s.pixelRatio;if("none"!==c["icon-text-fit"]&&o){var w=p-f,_=x-g,m=c["text-size"]/24,y=o.left*m,M=o.right*m,P=o.top*m,b=o.bottom*m,v=M-y,Q=b-P,R=c["icon-text-fit-padding"][0],I=c["icon-text-fit-padding"][1],S=c["icon-text-fit-padding"][2],G=c["icon-text-fit-padding"][3],L="width"===c["icon-text-fit"]?.5*(Q-_):0,V="height"===c["icon-text-fit"]?.5*(v-w):0,q="width"===c["icon-text-fit"]||"both"===c["icon-text-fit"]?v:w,z="height"===c["icon-text-fit"]||"both"===c["icon-text-fit"]?Q:_;l=new Point(y+V-G,P+L-R),r=new Point(y+V+I+q,P+L-R),d=new Point(y+V+I+q,P+L+S+z),h=new Point(y+V-G,P+L+S+z)}else l=new Point(f,g),r=new Point(p,g),d=new Point(p,x),h=new Point(f,x);var O=i.getLayoutValue("icon-rotate",a,u)*Math.PI/180;if(O){var j=Math.sin(O),k=Math.cos(O),A=[k,-j,j,k];l._matMult(A),r._matMult(A),h._matMult(A),d._matMult(A)}return[new SymbolQuad(l,r,h,d,{x:s.textureRect.x-1,y:s.textureRect.y-1,w:s.textureRect.w+2,h:s.textureRect.h+2},void 0,[0,0])]}function getGlyphQuads(t,e,i,n,o,a){for(var u=i.getLayoutValue("text-rotate",o,a)*Math.PI/180,l=i.getLayoutValue("text-offset",o,a).map(function(t){return 24*t}),r=e.positionedGlyphs,d=[],h=0;h<r.length;h++){var s=r[h],c=s.glyph;if(c){var g=c.rect;if(g){var f=c.advance/2,x=n?[s.x+f,s.y]:[0,0],p=n?[0,0]:[s.x+f+l[0],s.y+l[1]],w=c.left-f+p[0],_=-c.top+p[1],m=w+g.w,y=_+g.h,M=new Point(w,_),P=new Point(m,_),b=new Point(w,y),v=new Point(m,y),Q=new Point(p[0]-f,c.advance/2);if(0!==s.angle&&(M._sub(Q)._rotate(s.angle)._add(Q),P._sub(Q)._rotate(s.angle)._add(Q),b._sub(Q)._rotate(s.angle)._add(Q),v._sub(Q)._rotate(s.angle)._add(Q)),u){var R=Math.sin(u),I=Math.cos(u),S=[I,-R,R,I];M._matMult(S),P._matMult(S),b._matMult(S),v._matMult(S)}d.push(new SymbolQuad(M,P,b,v,g,e.writingMode,x))}}}return d}var Point=_dereq_("../_minemap_/point-geometry");module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};
},{"../_minemap_/point-geometry":41}],192:[function(_dereq_,module,exports){
"use strict";function PositionedGlyph(t,e,i,n,a){this.codePoint=t,this.x=e,this.y=i,this.glyph=n||null,this.angle=a}function Shaping(t,e,i,n,a,r,o){this.positionedGlyphs=t,this.text=e,this.top=i,this.bottom=n,this.left=a,this.right=r,this.writingMode=o}function breakLines(t,e){for(var i=[],n=0,a=0,r=e;a<r.length;a+=1){var o=r[a];i.push(t.substring(n,o)),n=o}return n<t.length&&i.push(t.substring(n,t.length)),i}function shapeText(t,e,i,n,a,r,o,s,l,c){var h=t.trim();c===WritingMode.vertical&&(h=verticalizePunctuation(h));var u,g=[],p=new Shaping(g,h,s[1],s[1],s[0],s[0],c);return u=rtlTextPlugin.processBidirectionalText?rtlTextPlugin.processBidirectionalText(h,determineLineBreaks(h,o,i,e)):breakLines(h,determineLineBreaks(h,o,i,e)),shapeLines(p,e,u,n,a,r,s,c,o,l),!!g.length&&p}function determineAverageLineWidth(t,e,i,n){var a=0;for(var r in t){var o=n[t.charCodeAt(r)];o&&(a+=o.advance+e)}return a/Math.max(1,Math.ceil(a/i))}function calculateBadness(t,e,i,n){var a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(i)*i}function calculatePenalty(t,e){var i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function evaluateBreak(t,e,i,n,a,r){for(var o=null,s=calculateBadness(e,i,a,r),l=0,c=n;l<c.length;l+=1){var h=c[l],u=e-h.x,g=calculateBadness(u,i,a,r)+h.badness;g<=s&&(o=h,s=g)}return{index:t,x:e,priorBreak:o,badness:s}}function leastBadBreaks(t){return t?leastBadBreaks(t.priorBreak).concat(t.index):[]}function determineLineBreaks(t,e,i,n){if(!i)return[];if(!t)return[];for(var a=[],r=determineAverageLineWidth(t,e,i,n),o=0,s=0;s<t.length;s++){var l=t.charCodeAt(s),c=n[l];c&&!whitespace[l]&&(o+=c.advance+e),s<t.length-1&&(breakable[l]||scriptDetection.charAllowsIdeographicBreaking(l))&&a.push(evaluateBreak(s+1,o,r,a,calculatePenalty(l,t.charCodeAt(s+1)),!1))}return leastBadBreaks(evaluateBreak(t.length,o,r,a,0,!0))}function getAnchorAlignment(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function shapeLines(t,e,i,n,a,r,o,s,l,c){var h=0,u=-17,g=0,p=t.positionedGlyphs,d="right"===r?1:"left"===r?0:.5;for(var v in i){var f=i[v].trim();if(f.length){for(var b=p.length,m=0;m<f.length;m++){var x=f.charCodeAt(m),B=e[x];B&&(scriptDetection.charHasUprightVerticalOrientation(x)&&s!==WritingMode.horizontal?(p.push(new PositionedGlyph(x,h,0,B,-Math.PI/2)),h+=c+l):(p.push(new PositionedGlyph(x,h,u,B,0)),h+=B.advance+l))}if(p.length!==b){var k=h-l;g=Math.max(k,g),justifyLine(p,e,b,p.length-1,d)}h=0,u+=n}else u+=n}var A=getAnchorAlignment(a);align(p,d,A.horizontalAlign,A.verticalAlign,g,n,i.length);var y=i.length*n;t.top+=-A.verticalAlign*y,t.bottom=t.top+y,t.left+=-A.horizontalAlign*g,t.right=t.left+g}function justifyLine(t,e,i,n,a){if(a)for(var r=e[t[n].codePoint].advance,o=(t[n].x+r)*a,s=i;s<=n;s++)t[s].x-=o}function align(t,e,i,n,a,r,o){for(var s=(e-i)*a,l=(-n*o+.5)*r,c=0;c<t.length;c++)t[c].x+=s,t[c].y+=l}function shapeIcon(t,e){var i=e[0],n=e[1],a=i-t.displaySize[0]/2,r=a+t.displaySize[0],o=n-t.displaySize[1]/2;return new PositionedIcon(t,o,o+t.displaySize[1],a,r)}function PositionedIcon(t,e,i,n,a){this.image=t,this.top=e,this.bottom=i,this.left=n,this.right=a}var scriptDetection=_dereq_("../util/script_detection"),verticalizePunctuation=_dereq_("../util/verticalize_punctuation"),rtlTextPlugin=_dereq_("../source/rtl_text_plugin"),WritingMode={horizontal:1,vertical:2};module.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:WritingMode};var whitespace={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},breakable={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};
},{"../source/rtl_text_plugin":115,"../util/script_detection":238,"../util/verticalize_punctuation":246}],193:[function(_dereq_,module,exports){
"use strict";function spriteAtlasElement(t){var e={x:t.rect.x+padding,y:t.rect.y+padding,w:t.rect.w-2*padding,h:t.rect.h-2*padding};return{sdf:t.sdf,pixelRatio:t.pixelRatio,isNativePixelRatio:t.pixelRatio===browser.devicePixelRatio,textureRect:e,tl:[e.x,e.y],br:[e.x+e.w,e.y+e.h],displaySize:[e.w/t.pixelRatio,e.h/t.pixelRatio]}}function copyBitmap(t,e,i,r,a,h,s,o,n,l,p){var d,f,u=r*e+i,g=o*h+s;if(p)for(g-=h,f=-1;f<=l;f++,g+=h)for(u=((f+l)%l+r)*e+i,d=-1;d<=n;d++)a[g+d]=t[u+(d+n)%n];else for(f=0;f<l;f++,u+=e,g+=h)for(d=0;d<n;d++)a[g+d]=t[u+d]}var ShelfPack=_dereq_("../_minemap_/shelf-pack"),browser=_dereq_("../util/browser"),util=_dereq_("../util/util"),ref=_dereq_("../util/window"),HTMLImageElement=ref.HTMLImageElement,Evented=_dereq_("../util/evented"),padding=1,SpriteAtlas=function(t){function e(e,i){t.call(this),this.images={},this.filter=0,this.width=Math.ceil(e*browser.devicePixelRatio),this.height=Math.ceil(i*browser.devicePixelRatio),this.shelfPack=new ShelfPack(this.width,this.height),this.dirty=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPixelSize=function(){return[this.width,this.height]},e.prototype.allocateImage=function(t,e){var i=t+2*padding,r=e+2*padding,a=this.shelfPack.packOne(i,r);return a||(util.warnOnce("SpriteAtlas out of space."),null)},e.prototype.addImage=function(t,e,i){var r,a,h;if(e instanceof HTMLImageElement?(r=e.width,a=e.height,e=browser.getImageData(e),h=1):(r=i.width,a=i.height,h=i.pixelRatio||1),ArrayBuffer.isView(e)&&(e=new Uint32Array(e.buffer)),!(e instanceof Uint32Array))return this.fire("error",{error:new Error("Image provided in an invalid format. Supported formats are HTMLImageElement and ArrayBufferView.")});if(this.images[t])return this.fire("error",{error:new Error("An image with this name already exists.")});var s=this.allocateImage(r,a);if(!s)return this.fire("error",{error:new Error("There is not enough space to add this image.")});this.images[t]={rect:s,width:r,height:a,pixelRatio:h,sdf:!1},this.copy(e,r,s,{x:0,y:0,width:r,height:a},!1),this.fire("data",{dataType:"style"})},e.prototype.removeImage=function(t){var e=this.images[t];if(delete this.images[t],!e)return this.fire("error",{error:new Error("No image with this name exists.")});this.shelfPack.unref(e.rect),this.fire("data",{dataType:"style"})},e.prototype.getIcon=function(t){return this._getImage(t,!1)},e.prototype.getPattern=function(t){return this._getImage(t,!0)},e.prototype._getImage=function(t,e){if(this.images[t])return spriteAtlasElement(this.images[t]);if(!this.sprite)return null;var i=this.sprite.getSpritePosition(t);if(!i.width||!i.height)return null;var r=this.allocateImage(i.width,i.height);if(!r)return null;var a={rect:r,width:i.width,height:i.height,sdf:i.sdf,pixelRatio:i.pixelRatio};if(this.images[t]=a,!this.sprite.imgData||!this.sprite.width)return null;var h=new Uint32Array(this.sprite.imgData.buffer);return this.copy(h,this.sprite.width,r,i,e),spriteAtlasElement(a)},e.prototype.allocate=function(){var t=this;if(!this.data){this.data=new Uint32Array(this.width*this.height);for(var e=0;e<this.data.length;e++)t.data[e]=0}},e.prototype.copy=function(t,e,i,r,a){this.allocate();var h=this.data;copyBitmap(t,e,r.x,r.y,h,this.getPixelSize()[0],i.x+padding,i.y+padding,r.width,r.height,a),this.dirty=!0},e.prototype.setSprite=function(t){this.sprite=t},e.prototype.addIcons=function(t,e){for(var i=this,r={},a=0,h=t;a<h.length;a+=1){var s=h[a];r[s]=i.getIcon(s)}e(null,r)},e.prototype.bind=function(t,e){var i=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i=!0);var r=e?t.LINEAR:t.NEAREST;r!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),this.filter=r),this.dirty&&(this.allocate(),i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},e}(Evented);module.exports=SpriteAtlas;
},{"../_minemap_/shelf-pack":42,"../util/browser":217,"../util/evented":226,"../util/util":244,"../util/window":219}],194:[function(_dereq_,module,exports){
"use strict";function evaluateSizeForFeature(e,o,t){var i=o;return e.isFeatureConstant?i.uSize:e.isZoomConstant?t.lowerSize/10:interpolate.number(t.lowerSize/10,t.upperSize/10,i.uSizeT)}function evaluateSizeForZoom(e,o,t,i){var a={};if(e.isZoomConstant||e.isFeatureConstant)if(e.isFeatureConstant&&!e.isZoomConstant){var n;if("interval"===e.functionType)n=t.getLayoutValue(i?"text-size":"icon-size",{zoom:o.zoom});else{var r="interval"===e.functionType?0:interpolationFactor(o.zoom,e.functionBase,e.coveringZoomRange[0],e.coveringZoomRange[1]),u=e.coveringStopValues[0],l=e.coveringStopValues[1];n=u+(l-u)*util.clamp(r,0,1)}a.uSize=n}else e.isFeatureConstant&&e.isZoomConstant&&(a.uSize=e.layoutSize);else{var s=interpolationFactor(o.zoom,e.functionBase,e.coveringZoomRange[0],e.coveringZoomRange[1]);a.uSizeT=util.clamp(s,0,1)}return a}var interpolate=_dereq_("../style-spec/util/interpolate"),util=_dereq_("../util/util"),interpolationFactor=_dereq_("../style-spec/function").interpolationFactor;module.exports={evaluateSizeForFeature:evaluateSizeForFeature,evaluateSizeForZoom:evaluateSizeForZoom};
},{"../style-spec/function":131,"../style-spec/util/interpolate":137,"../util/util":244}],195:[function(_dereq_,module,exports){
"use strict";var rtlTextPlugin=_dereq_("../source/rtl_text_plugin");module.exports=function(e,r,t,a){var l=r.getLayoutValue("text-transform",t,a);return"uppercase"===l?e=e.toLocaleUpperCase():"lowercase"===l&&(e=e.toLocaleLowerCase()),rtlTextPlugin.applyArabicShaping&&(e=rtlTextPlugin.applyArabicShaping(e)),e};
},{"../source/rtl_text_plugin":115}],196:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../util/dom"),Point=_dereq_("../_minemap_/point-geometry"),handlers={scrollZoom:_dereq_("./handler/scroll_zoom"),boxZoom:_dereq_("./handler/box_zoom"),dragRotate:_dereq_("./handler/drag_rotate"),dragPan:_dereq_("./handler/drag_pan"),keyboard:_dereq_("./handler/keyboard"),doubleClickZoom:_dereq_("./handler/dblclick_zoom"),touchZoomRotate:_dereq_("./handler/touch_zoom_rotate")};module.exports=function(e,t){function n(e){h("mouseout",e)}function o(t){e.stop(),L=DOM.mousePos(g,t),h("mousedown",t),E=!0}function r(t){var n=e.dragRotate&&e.dragRotate.isActive();p&&!n&&h("contextmenu",p),p=null,E=!1,h("mouseup",t)}function a(t){if(!(e.dragPan&&e.dragPan.isActive()||e.dragRotate&&e.dragRotate.isActive())){for(var n=t.toElement||t.target;n&&n!==g;)n=n.parentNode;n===g&&h("mousemove",t)}}function u(t){e.stop(),f("touchstart",t),!t.touches||t.touches.length>1||(b?(clearTimeout(b),b=null,h("dblclick",t)):b=setTimeout(l,300))}function i(e){f("touchmove",e)}function c(e){f("touchend",e)}function d(e){f("touchcancel",e)}function l(){b=null}function s(e){DOM.mousePos(g,e).equals(L)&&h("click",e)}function m(e){h("dblclick",e),e.preventDefault()}function v(t){var n=e.dragRotate&&e.dragRotate.isActive();E||n?E&&(p=t):h("contextmenu",t),t.preventDefault()}function h(t,n){var o=DOM.mousePos(g,n);return e.fire(t,{lngLat:e.unproject(o),point:o,originalEvent:n})}function f(t,n){var o=DOM.touchPos(g,n),r=o.reduce(function(e,t,n,o){return e.add(t.div(o.length))},new Point(0,0));return e.fire(t,{lngLat:e.unproject(r),point:r,lngLats:o.map(function(t){return e.unproject(t)},this),points:o,originalEvent:n})}var g=e.getCanvasContainer(),p=null,E=!1,L=null,b=null;for(var q in handlers)e[q]=new handlers[q](e,t),t.interactive&&t[q]&&e[q].enable(t[q]);g.addEventListener("mouseout",n,!1),g.addEventListener("mousedown",o,!1),g.addEventListener("mouseup",r,!1),g.addEventListener("mousemove",a,!1),g.addEventListener("touchstart",u,!1),g.addEventListener("touchend",c,!1),g.addEventListener("touchmove",i,!1),g.addEventListener("touchcancel",d,!1),g.addEventListener("click",s,!1),g.addEventListener("dblclick",m,!1),g.addEventListener("contextmenu",v,!1)};
},{"../_minemap_/point-geometry":41,"../util/dom":224,"./handler/box_zoom":204,"./handler/dblclick_zoom":205,"./handler/drag_pan":206,"./handler/drag_rotate":207,"./handler/keyboard":208,"./handler/scroll_zoom":209,"./handler/touch_zoom_rotate":210}],197:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),interpolate=_dereq_("../style-spec/util/interpolate"),browser=_dereq_("../util/browser"),LngLat=_dereq_("../geo/lng_lat"),LngLatBounds=_dereq_("../geo/lng_lat_bounds"),Point=_dereq_("../_minemap_/point-geometry"),Evented=_dereq_("../util/evented"),Camera=function(t){function e(e,i){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=i.bearingSnap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},e.prototype._lngLat2Mercator=function(t){var e=[],i=20037508.34*t[0]/180,o=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return o=20037508.34*o/180,e.push(i),e.push(o),e},e.prototype._mercator2LngLat=function(t){var e=[],i=t[0]/20037508.34*180,o=t[1]/20037508.34*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),e.push(i),e.push(o),e},e.prototype.panBy=function(t,e,i){if(e&&e.units){var o,n=this.transform.center.toArray(),r=this._lngLat2Mercator(n);o="kilometers"===e.units?[r[0]+1e3*t[0],r[1]+1e3*t[1]]:[r[0]+t[0],r[1]+t[1]];var a=this._mercator2LngLat(o);this.panTo(LngLat.convert(a),e,i)}else this.panTo(this.transform.center,util.extend({offset:Point.convert(t).mult(-1)},e),i);return this},e.prototype.panTo=function(t,e,i){return this.easeTo(util.extend({center:t},e),i)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,i){return this.easeTo(util.extend({zoom:t},e),i)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,i){return this.easeTo(util.extend({bearing:t},e),i)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,util.extend({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,i){if(e=util.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e),"number"==typeof e.padding){var o=e.padding;e.padding={top:o,bottom:o,right:o,left:o}}if(!util.deepEqual(Object.keys(e.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"]))return void util.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");t=LngLatBounds.convert(t);var n=[e.padding.left-e.padding.right,e.padding.top-e.padding.bottom],r=Math.min(e.padding.right,e.padding.left),a=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+n[0],e.offset[1]+n[1]];var s=Point.convert(e.offset),h=this.transform,p=h.project(t.getNorthWest()),u=h.project(t.getSouthEast()),c=u.sub(p),m=(h.width-2*r-2*Math.abs(s.x))/c.x,f=(h.height-2*a-2*Math.abs(s.y))/c.y;return f<0||m<0?void util.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."):(e.center=h.unproject(p.add(u).div(2)),e.zoom=Math.min(h.scaleZoom(h.scale*Math.min(m,f)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,i):this.flyTo(e,i))},e.prototype.jumpTo=function(t,e){this.stop();var i=this.transform,o=!1,n=!1,r=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(o=!0,i.zoom=+t.zoom),"center"in t&&(i.center=LngLat.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(n=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(r=!0,i.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),o&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),n&&this.fire("rotate",e),r&&this.fire("pitchstart",e).fire("pitch",e).fire("pitchend",e),this.fire("moveend",e)},e.prototype.easeTo=function(t,e){var i=this;this.stop(),t=util.extend({offset:[0,0],duration:500,easing:util.ease},t),!1===t.animate&&(t.duration=0),t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration));var o=this.transform,n=this.getZoom(),r=this.getBearing(),a=this.getPitch(),s="zoom"in t?+t.zoom:n,h="bearing"in t?this._normalizeBearing(t.bearing,r):r,p="pitch"in t?+t.pitch:a,u=o.centerPoint.add(Point.convert(t.offset)),c=o.pointLocation(u),m=LngLat.convert(t.center||c);this._normalizeCenter(m);var f,g,d=o.project(c),l=o.project(m).sub(d),v=o.zoomScale(s-n);return t.around&&(f=LngLat.convert(t.around),g=o.locationPoint(f)),this.zooming=s!==n,this.rotating=r!==h,this.pitching=p!==a,this._prepareEase(e,t.noMoveStart),clearTimeout(this._onEaseEnd),this._ease(function(t){if(this.zooming&&(o.zoom=interpolate(n,s,t)),this.rotating&&(o.bearing=interpolate(r,h,t)),this.pitching&&(o.pitch=interpolate(a,p,t)),f)o.setLocationAtPoint(f,g);else{var i=o.zoomScale(o.zoom-n),c=s>n?Math.min(2,v):Math.max(.5,v),m=Math.pow(c,1-t),b=o.unproject(d.add(l.mult(t*m)).mult(i));o.setLocationAtPoint(o.renderWorldCopies?b.wrap():b,u)}this._fireMoveEvents(e)},function(){t.delayEndEvents?i._onEaseEnd=setTimeout(function(){return i._easeToEnd(e)},t.delayEndEvents):i._easeToEnd(e)},t),this},e.prototype._prepareEase=function(t,e){this.moving=!0,e||this.fire("movestart",t),this.zooming&&this.fire("zoomstart",t),this.pitching&&this.fire("pitchstart",t)},e.prototype._fireMoveEvents=function(t){this.fire("move",t),this.zooming&&this.fire("zoom",t),this.rotating&&this.fire("rotate",t),this.pitching&&this.fire("pitch",t)},e.prototype._easeToEnd=function(t){var e=this.zooming,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),i&&this.fire("pitchend",t),this.fire("moveend",t)},e.prototype.flyTo=function(t,e){function i(t){var e=(z*z-M*M+(t?-1:1)*x*x*E*E)/(2*(t?z:M)*x*E);return Math.log(Math.sqrt(e*e+1)-e)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return o(t)/n(t)}var a=this;this.stop(),t=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},t);var s=this.transform,h=this.getZoom(),p=this.getBearing(),u=this.getPitch(),c="zoom"in t?util.clamp(+t.zoom,s.minZoom,s.maxZoom):h,m="bearing"in t?this._normalizeBearing(t.bearing,p):p,f="pitch"in t?+t.pitch:u,g=s.zoomScale(c-h),d=s.centerPoint.add(Point.convert(t.offset)),l=s.pointLocation(d),v=LngLat.convert(t.center||l);this._normalizeCenter(v);var b=s.project(l),_=s.project(v).sub(b),y=t.curve,M=Math.max(s.width,s.height),z=M/g,E=_.mag();if("minZoom"in t){var T=util.clamp(Math.min(t.minZoom,h,c),s.minZoom,s.maxZoom),L=M/s.zoomScale(T-h);y=Math.sqrt(L/E*2)}var x=y*y,P=i(0),j=function(t){return n(P)/n(P+y*t)},Z=function(t){return M*((n(P)*r(P+y*t)-o(P))/x)/E},w=(i(1)-P)/y;if(Math.abs(E)<1e-6||isNaN(w)){if(Math.abs(M-z)<1e-6)return this.easeTo(t,e);var q=z<M?-1:1;w=Math.abs(Math.log(z/M))/y,Z=function(){return 0},j=function(t){return Math.exp(q*y*t)}}if("duration"in t)t.duration=+t.duration;else{var B="screenSpeed"in t?+t.screenSpeed/y:+t.speed;t.duration=1e3*w/B}return this.zooming=!0,this.rotating=p!==m,this.pitching=f!==u,this._prepareEase(e,!1),this._ease(function(t){var i=t*w,o=1/j(i);s.zoom=h+s.scaleZoom(o),this.rotating&&(s.bearing=interpolate(p,m,t)),this.pitching&&(s.pitch=interpolate(u,f,t));var n=s.unproject(b.add(_.mult(Z(i))).mult(o));s.setLocationAtPoint(s.renderWorldCopies?n.wrap():n,d),this._fireMoveEvents(e)},function(){return a._easeToEnd(e)},t),this},e.prototype.isEasing=function(){return!!this._abortFn},e.prototype.isMoving=function(){return this.moving},e.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},e.prototype._ease=function(t,e,i){this._finishFn=e,this._abortFn=browser.timed(function(e){t.call(this,i.easing(e)),1===e&&this._finishEase()},!1===i.animate?0:i.duration,this)},e.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},e.prototype._normalizeBearing=function(t,e){t=util.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},e.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}},e.prototype._smoothOutEasing=function(t){var e=util.ease;if(this._prevEase){var i=this._prevEase,o=(Date.now()-i.start)/i.duration,n=i.easing(o+.01)-i.easing(o),r=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-r*r);e=util.bezier(r,a,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:e},e},e}(Evented);module.exports=Camera;
},{"../_minemap_/point-geometry":41,"../geo/lng_lat":78,"../geo/lng_lat_bounds":79,"../style-spec/util/interpolate":137,"../util/browser":217,"../util/evented":226,"../util/util":244}],198:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),config=_dereq_("../../util/config"),AttributionControl=function(t){this.options=t,util.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};AttributionControl.prototype.getDefaultPosition=function(){return"bottom-right"},AttributionControl.prototype.onAdd=function(t){var i=this.options&&this.options.compact;return this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-attrib"),i&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},AttributionControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},AttributionControl.prototype._updateEditLink=function(){this._editLink||(this._editLink=this._container.querySelector(".minemap-improve-map"));var t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:config.ACCESS_TOKEN}];if(this._editLink){var i=t.reduce(function(i,e,o){return void 0!==e.value&&(i+=e.key+"="+e.value+(o<t.length-1?"&":"")),i},"?");this._editLink.href="https://www.minedata.cn/feedback/"+i+(this._map._hash?this._map._hash.getHashString(!0):"")}},AttributionControl.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},AttributionControl.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this._map.style.stylesheet){var i=this._map.style.stylesheet;this.styleOwner=i.owner,this.styleId=i.id}var e=this._map.style.sourceCaches;for(var o in e){var n=e[o].getSource();n.attribution&&t.indexOf(n.attribution)<0&&t.push(n.attribution)}t.sort(function(t,i){return t.length-i.length}),t=t.filter(function(i,e){for(var o=e+1;o<t.length;o++)if(t[o].indexOf(i)>=0)return!1;return!0}),this._container.innerHTML=t.join(" | "),this._editLink=null}},AttributionControl.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("minemap-compact")},module.exports=AttributionControl;
},{"../../util/config":221,"../../util/dom":224,"../../util/util":244}],199:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),FullscreenControl=function(){this._fullscreen=!1,util.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl"};FullscreenControl.prototype.onAdd=function(e){return this._map=e,this._mapContainer=this._map.getContainer(),this._container=DOM.create("div",this._className+" minemap-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",util.warnOnce("This device does not support fullscreen mode.")),this._container},FullscreenControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},FullscreenControl.prototype._checkFullscreenSupport=function(){return!!(window.document.fullscreenEnabled||window.document.mozFullscreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled)},FullscreenControl.prototype._setupUI=function(){var e=this._fullscreenButton=DOM.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);e.setAttribute("aria-label","Toggle fullscreen"),e.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)},FullscreenControl.prototype._isFullscreen=function(){return this._fullscreen},FullscreenControl.prototype._changeIcon=function(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},FullscreenControl.prototype._onClickFullscreen=function(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},module.exports=FullscreenControl;
},{"../../util/dom":224,"../../util/util":244,"../../util/window":219}],200:[function(_dereq_,module,exports){
"use strict";function checkGeolocationSupport(t){void 0!==supportsGeolocation?t(supportsGeolocation):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(function(o){supportsGeolocation="denied"!==o.state,t(supportsGeolocation)}):(supportsGeolocation=!!window.navigator.geolocation,t(supportsGeolocation))}var Evented=_dereq_("../../util/evented"),DOM=_dereq_("../../util/dom"),window=_dereq_("../../util/window"),util=_dereq_("../../util/util"),LngLat=_dereq_("../../geo/lng_lat"),Marker=_dereq_("../marker"),defaultOptions={positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},className="minemap-ctrl",supportsGeolocation,GeolocateControl=function(t){function o(o){t.call(this),this.options=util.extend({},defaultOptions,o),util.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker","_onClickGeolocate"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div",className+" "+className+"-group"),checkGeolocationSupport(this._setupUI),this._container},o.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),this._container.parentNode.removeChild(this._container),this._map=void 0},o.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire("geolocate",t),this._finish()},o.prototype._updateCamera=function(t){var o=new LngLat(t.coords.longitude,t.coords.latitude),e=t.coords.accuracy;this._map.fitBounds(o.toBounds(e),this.options.fitBoundsOptions,{geolocateSource:!0})},o.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},o.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire("error",t),this._finish()},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(t){var o=this;!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=DOM.create("button",className+"-icon "+className+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed",!1),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOM.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new Marker(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)),this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==o._watchState||(o._watchState="BACKGROUND",o._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),o._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),o.fire("trackuserlocationend"))}))},o.prototype._onClickGeolocate=function(){if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire("trackuserlocationstart");break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire("trackuserlocationend");break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire("trackuserlocationstart")}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4)},o.prototype._clearWatch=function(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed",!1),this.options.showUserLocation&&this._updateMarker(null)},o}(Evented);module.exports=GeolocateControl;
},{"../../geo/lng_lat":78,"../../util/dom":224,"../../util/evented":226,"../../util/util":244,"../../util/window":219,"../marker":213}],201:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),LogoControl=function(){util.bindAll(["_updateLogo"],this)};LogoControl.prototype.onAdd=function(o){this._map=o,this._container=DOM.create("div","minemap-ctrl");var t=DOM.create("a","minemap-ctrl-logo");return t.target="_blank",t.href="https://www.minedata.com.cn/",t.setAttribute("aria-label","Minemap logo"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},LogoControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateLogo)},LogoControl.prototype.getDefaultPosition=function(){return"bottom-left"},LogoControl.prototype._updateLogo=function(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none"),this._container.style.display="block"},LogoControl.prototype._logoRequired=function(){if(this._map.style){var o=this._map.style.sourceCaches;for(var t in o){if(o[t].getSource().minemap_logo)return!0}return!1}},module.exports=LogoControl;
},{"../../util/dom":224,"../../util/util":244}],202:[function(_dereq_,module,exports){
"use strict";function copyMouseEvent(t){return new window.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var DOM=_dereq_("../../util/dom"),window=_dereq_("../../util/window"),util=_dereq_("../../util/util"),className="minemap-ctrl",NavigationControl=function(){util.bindAll(["_rotateCompassArrow"],this)};NavigationControl.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},NavigationControl.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div",className+" "+className+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(className+"-icon "+className+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(className+"-icon "+className+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(className+"-icon "+className+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=DOM.create("span",className+"-compass-arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},NavigationControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},NavigationControl.prototype._onContextMenu=function(t){t.preventDefault()},NavigationControl.prototype._onCompassDown=function(t){0===t.button&&(DOM.disableDrag(),window.document.addEventListener("mousemove",this._onCompassMove),window.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._onCompassUp=function(t){0===t.button&&(window.document.removeEventListener("mousemove",this._onCompassMove),window.document.removeEventListener("mouseup",this._onCompassUp),DOM.enableDrag(),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},NavigationControl.prototype._createButton=function(t,o,e){var n=DOM.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",o),n.addEventListener("click",function(){e()}),n},module.exports=NavigationControl;
},{"../../util/dom":224,"../../util/util":244,"../../util/window":219}],203:[function(_dereq_,module,exports){
"use strict";function updateScale(t,e,n,i){var o=i&&i.maxWidth||100,a=t._container.clientHeight/2,r=getDistance(t.unproject([0,a]),t.unproject([o,a]));if(i&&"imperial"===i.unit){var c=3.2808*r;if(c>5280){setScale(e,n,o,c/5280,"mi")}else setScale(e,n,o,c,"ft")}else setScale(e,n,o,r,"m")}function setScale(t,e,n,i,o){var a=getRoundNum(i),r=a/i;"m"===o&&a>=1e3&&(a/=1e3,o="km"),t.style.width=n*r+"px",e.innerHTML=a+o}function getDistance(t,e){var n=Math.PI/180,i=t.lat*n,o=e.lat*n,a=Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos((e.lng-t.lng)*n);return 6371e3*Math.acos(Math.min(a,1))}function getRoundNum(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),ScaleControl=function(t){this.options=t,util.bindAll(["_onMove"],this)};ScaleControl.prototype.getDefaultPosition=function(){return"bottom-left"},ScaleControl.prototype._onMove=function(){updateScale(this._map,this._container,this._content,this.options)},ScaleControl.prototype.onAdd=function(t){this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._content=DOM.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);var e=DOM.create("div","minemap-ctrl-scale-left-bar",this._container),n=DOM.create("div","minemap-ctrl-scale-right-bar",this._container),i=DOM.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(e),this._container.appendChild(n),this._container.appendChild(i),this._map.on("move",this._onMove),this._onMove(),this._container},ScaleControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},module.exports=ScaleControl;
},{"../../util/dom":224,"../../util/util":244}],204:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),LngLatBounds=_dereq_("../../geo/lng_lat_bounds"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),BoxZoomHandler=function(o){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),util.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};BoxZoomHandler.prototype.isEnabled=function(){return!!this._enabled},BoxZoomHandler.prototype.isActive=function(){return!!this._active},BoxZoomHandler.prototype.enable=function(){this.isEnabled()||(this._map.dragPan&&this._map.dragPan.disable(),this._el.addEventListener("mousedown",this._onMouseDown,!1),this._map.dragPan&&this._map.dragPan.enable(),this._enabled=!0)},BoxZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},BoxZoomHandler.prototype._onMouseDown=function(o){o.shiftKey&&0===o.button&&(window.document.addEventListener("mousemove",this._onMouseMove,!1),window.document.addEventListener("keydown",this._onKeyDown,!1),window.document.addEventListener("mouseup",this._onMouseUp,!1),DOM.disableDrag(),this._startPos=DOM.mousePos(this._el,o),this._active=!0)},BoxZoomHandler.prototype._onMouseMove=function(o){var e=this._startPos,t=DOM.mousePos(this._el,o);this._box||(this._box=DOM.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",o));var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),s=Math.min(e.y,t.y),a=Math.max(e.y,t.y);DOM.setTransform(this._box,"translate("+n+"px,"+s+"px)"),this._box.style.width=i-n+"px",this._box.style.height=a-s+"px"},BoxZoomHandler.prototype._onMouseUp=function(o){if(0===o.button){var e=this._startPos,t=DOM.mousePos(this._el,o),n=(new LngLatBounds).extend(this._map.unproject(e)).extend(this._map.unproject(t));this._finish(),e.x===t.x&&e.y===t.y?this._fireEvent("boxzoomcancel",o):this._map.fitBounds(n,{linear:!0}).fire("boxzoomend",{originalEvent:o,boxZoomBounds:n})}},BoxZoomHandler.prototype._onKeyDown=function(o){27===o.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",o))},BoxZoomHandler.prototype._finish=function(){this._active=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!1),window.document.removeEventListener("keydown",this._onKeyDown,!1),window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("minemap-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),DOM.enableDrag()},BoxZoomHandler.prototype._fireEvent=function(o,e){return this._map.fire(o,{originalEvent:e})},module.exports=BoxZoomHandler;
},{"../../geo/lng_lat_bounds":79,"../../util/dom":224,"../../util/util":244,"../../util/window":219}],205:[function(_dereq_,module,exports){
"use strict";var DoubleClickZoomHandler=function(o){this._map=o,this._onDblClick=this._onDblClick.bind(this)};DoubleClickZoomHandler.prototype.isEnabled=function(){return!!this._enabled},DoubleClickZoomHandler.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},DoubleClickZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},DoubleClickZoomHandler.prototype._onDblClick=function(o){this._map.zoomTo(this._map.getZoom()+(o.originalEvent.shiftKey?-1:1),{around:o.lngLat},o)},module.exports=DoubleClickZoomHandler;
},{}],206:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),inertiaLinearity=.3,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=1400,inertiaDeceleration=2500,DragPanHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),util.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};DragPanHandler.prototype.isEnabled=function(){return!!this._enabled},DragPanHandler.prototype.isActive=function(){return!!this._active},DragPanHandler.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("minemap-touch-drag-pan"),this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},DragPanHandler.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-drag-pan"),this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},DragPanHandler.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(window.document.addEventListener("touchmove",this._onMove),window.document.addEventListener("touchend",this._onTouchEnd)):(window.document.addEventListener("mousemove",this._onMove),window.document.addEventListener("mouseup",this._onMouseUp)),window.addEventListener("blur",this._onMouseUp),this._active=!1,this._startPos=this._pos=DOM.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},DragPanHandler.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=DOM.mousePos(this._el,t),n=this._map;n.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),n.transform.setLocationAtPoint(n.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},DragPanHandler.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var n=function(){e._map.moving=!1,e._fireEvent("moveend",t)},i=this._inertia;if(i.length<2)return void n();var o=i[i.length-1],r=i[0],a=o[1].sub(r[1]),s=(o[0]-r[0])/1e3;if(0===s||o[1].equals(r[1]))return void n();var u=a.mult(inertiaLinearity/s),d=u.mag();d>inertiaMaxSpeed&&(d=inertiaMaxSpeed,u._unit()._mult(d));var h=d/(inertiaDeceleration*inertiaLinearity),v=u.mult(-h/2);this._map.panBy(v,{duration:1e3*h,easing:inertiaEasing,noMoveStart:!0},{originalEvent:t})}},DragPanHandler.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),window.document.removeEventListener("mousemove",this._onMove),window.document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("blur",this._onMouseUp))},DragPanHandler.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),window.document.removeEventListener("touchmove",this._onMove),window.document.removeEventListener("touchend",this._onTouchEnd))},DragPanHandler.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},DragPanHandler.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragRotate&&e.dragRotate.isActive())return!0;if(t.touches)return t.touches.length>1;if(t.ctrlKey)return!0;return"mousemove"===t.type?!1&t.buttons:t.button&&0!==t.button},DragPanHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},module.exports=DragPanHandler;
},{"../../util/dom":224,"../../util/util":244,"../../util/window":219}],207:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),inertiaLinearity=.25,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=180,inertiaDeceleration=720,DragRotateHandler=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=!1!==e.pitchWithRotate,util.bindAll(["_onDown","_onMove","_onUp"],this)};DragRotateHandler.prototype.isEnabled=function(){return!!this._enabled},DragRotateHandler.prototype.isActive=function(){return!!this._active},DragRotateHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},DragRotateHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},DragRotateHandler.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(window.document.addEventListener("mousemove",this._onMove),window.document.addEventListener("mouseup",this._onUp),window.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=DOM.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},DragRotateHandler.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t));var e=this._map;e.stop();var i=this._pos,n=DOM.mousePos(this._el,t),r=.8*(i.x-n.x),a=-.5*(i.y-n.y),o=e.getBearing()-r,s=e.getPitch()-a,h=this._inertia,_=h[h.length-1];this._drainInertiaBuffer(),h.push([Date.now(),e._normalizeBearing(o,_[1])]),e.transform.bearing=o,this._pitchWithRotate&&(this._fireEvent("pitch",t),e.transform.pitch=s),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=n}},DragRotateHandler.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(window.document.removeEventListener("mousemove",this._onMove),window.document.removeEventListener("mouseup",this._onUp),window.removeEventListener("blur",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,a=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t)),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(r.length<2)return void a();var o=r[0],s=r[r.length-1],h=r[r.length-2],_=i._normalizeBearing(n,h[1]),v=s[1]-o[1],p=v<0?-1:1,d=(s[0]-o[0])/1e3;if(0===v||0===d)return void a();var u=Math.abs(v*(inertiaLinearity/d));u>inertiaMaxSpeed&&(u=inertiaMaxSpeed);var l=u/(inertiaDeceleration*inertiaLinearity);_+=p*u*(l/2),Math.abs(i._normalizeBearing(_,0))<this._bearingSnap&&(_=i._normalizeBearing(0,_)),i.rotateTo(_,{duration:1e3*l,easing:inertiaEasing,noMoveStart:!0},{originalEvent:t})}},DragRotateHandler.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},DragRotateHandler.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var i=t.ctrlKey?1:2,n=t.ctrlKey?0:2,r=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(r=0),"mousemove"===t.type?t.buttons&0===i:!this.isActive()&&r!==n},DragRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},module.exports=DragRotateHandler;
},{"../../util/dom":224,"../../util/util":244,"../../util/window":219}],208:[function(_dereq_,module,exports){
"use strict";function easeOut(e){return e*(2-e)}var panStep=100,bearingStep=15,pitchStep=10,KeyboardHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};KeyboardHandler.prototype.isEnabled=function(){return!!this._enabled},KeyboardHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},KeyboardHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},KeyboardHandler.prototype._onKeyDown=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=0,a=0,n=0,r=0,i=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),i=-1);break;case 40:e.shiftKey?n=-1:(i=1,e.preventDefault());break;default:return}var s=this._map,o=s.getZoom(),d={duration:300,delayEndEvents:500,easing:easeOut,zoom:t?Math.round(o)+t*(e.shiftKey?2:1):o,bearing:s.getBearing()+a*bearingStep,pitch:s.getPitch()+n*pitchStep,offset:[-r*panStep,-i*panStep],center:s.getCenter()};s.easeTo(d,{originalEvent:e})}},module.exports=KeyboardHandler;
},{}],209:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),browser=_dereq_("../../util/browser"),window=_dereq_("../../util/window"),ua=window.navigator.userAgent.toLowerCase(),firefox=-1!==ua.indexOf("firefox"),safari=-1!==ua.indexOf("safari")&&-1===ua.indexOf("chrom"),ScrollZoomHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),util.bindAll(["_onWheel","_onTimeout"],this)};ScrollZoomHandler.prototype.isEnabled=function(){return!!this._enabled},ScrollZoomHandler.prototype.enable=function(e){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=e&&"center"===e.around)},ScrollZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},ScrollZoomHandler.prototype._onWheel=function(e){var t;"wheel"===e.type?(t=e.deltaY,firefox&&e.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL&&(t/=browser.devicePixelRatio),e.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(t*=40)):"mousewheel"===e.type&&(t=-e.wheelDeltaY,safari&&(t/=3));var o=browser.now(),i=o-(this._time||0);this._pos=DOM.mousePos(this._el,e),this._time=o,0!==t&&t%4.000244140625==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(i*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&this._zoom(-t,e),e.preventDefault()},ScrollZoomHandler.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},ScrollZoomHandler.prototype._zoom=function(e,t){if(0!==e){var o=this._map,i=2/(1+Math.exp(-Math.abs(e/100)));e<0&&0!==i&&(i=1/i);var l=o.ease?o.ease.to:o.transform.scale,s=o.transform.scaleZoom(l*i);o.zoomTo(s,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?o.getCenter():o.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:t})}},module.exports=ScrollZoomHandler;
},{"../../util/browser":217,"../../util/dom":224,"../../util/util":244,"../../util/window":219}],210:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),inertiaLinearity=.15,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaDeceleration=12,inertiaMaxSpeed=2.5,significantScaleThreshold=.15,significantRotateThreshold=10,TouchZoomRotateHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),util.bindAll(["_onStart","_onMove","_onEnd"],this)};TouchZoomRotateHandler.prototype.isEnabled=function(){return!!this._enabled},TouchZoomRotateHandler.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("minemap-touch-zoom-rotate"),this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},TouchZoomRotateHandler.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-zoom-rotate"),this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},TouchZoomRotateHandler.prototype.disableRotation=function(){this._rotationDisabled=!0},TouchZoomRotateHandler.prototype.enableRotation=function(){this._rotationDisabled=!1},TouchZoomRotateHandler.prototype._onStart=function(t){if(2===t.touches.length){var e=DOM.mousePos(this._el,t.touches[0]),o=DOM.mousePos(this._el,t.touches[1]);this._startVec=e.sub(o),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],window.document.addEventListener("touchmove",this._onMove,!1),window.document.addEventListener("touchend",this._onEnd,!1)}},TouchZoomRotateHandler.prototype._onMove=function(t){if(2===t.touches.length){var e=DOM.mousePos(this._el,t.touches[0]),o=DOM.mousePos(this._el,t.touches[1]),i=e.add(o).div(2),n=e.sub(o),a=n.mag()/this._startVec.mag(),r=this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI,s=this._map;if(this._gestureIntent){var h={duration:0,around:s.unproject(i)};"rotate"===this._gestureIntent&&(h.bearing=this._startBearing+r),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(h.zoom=s.transform.scaleZoom(this._startScale*a)),s.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),a,i]),s.easeTo(h,{originalEvent:t})}else{var u=Math.abs(1-a)>significantScaleThreshold;Math.abs(r)>significantRotateThreshold?this._gestureIntent="rotate":u&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=n,this._startScale=s.transform.scale,this._startBearing=s.transform.bearing)}t.preventDefault()}},TouchZoomRotateHandler.prototype._onEnd=function(t){window.document.removeEventListener("touchmove",this._onMove),window.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,o=this._map;if(e.length<2)return void o.snapToNorth({},{originalEvent:t});var i=e[e.length-1],n=e[0],a=o.transform.scaleZoom(this._startScale*i[1]),r=o.transform.scaleZoom(this._startScale*n[1]),s=a-r,h=(i[0]-n[0])/1e3,u=i[2];if(0===h||a===r)return void o.snapToNorth({},{originalEvent:t});var l=s*inertiaLinearity/h;Math.abs(l)>inertiaMaxSpeed&&(l=l>0?inertiaMaxSpeed:-inertiaMaxSpeed);var d=1e3*Math.abs(l/(inertiaDeceleration*inertiaLinearity)),c=a+l*d/2e3;c<0&&(c=0),o.easeTo({zoom:c,duration:d,easing:inertiaEasing,around:this._aroundCenter?o.getCenter():o.unproject(u)},{originalEvent:t})},TouchZoomRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>2&&e-t[0][0]>160;)t.shift()},module.exports=TouchZoomRotateHandler;
},{"../../util/dom":224,"../../util/util":244,"../../util/window":219}],211:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),window=_dereq_("../util/window"),Hash=function(){util.bindAll(["_onHashChange","_updateHash"],this)};Hash.prototype.addTo=function(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Hash.prototype.remove=function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},Hash.prototype.getHashString=function(t){var a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,e=Math.max(0,Math.ceil(Math.log(h)/Math.LN2)),n=Math.round(a.lng*Math.pow(10,e))/Math.pow(10,e),o=Math.round(a.lat*Math.pow(10,e))/Math.pow(10,e),i=this._map.getBearing(),s=this._map.getPitch(),r="";return r+=t?"#/"+n+"/"+o+"/"+h:"#"+h+"/"+o+"/"+n,(i||s)&&(r+="/"+Math.round(10*i)/10),s&&(r+="/"+Math.round(s)),r},Hash.prototype._onHashChange=function(){var t=window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},Hash.prototype._updateHash=function(){var t=this.getHashString();window.history.replaceState("","",t)},module.exports=Hash;
},{"../util/util":244,"../util/window":219}],212:[function(_dereq_,module,exports){
"use strict";function removeNode(e){e.parentNode&&e.parentNode.removeChild(e)}function contains(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1}function getElementOffset(e){for(var t=e.offsetTop,r=e.offsetLeft,i=e.offsetWidth,o=e.offsetHeight;e=e.offsetParent;)t+=e.offsetTop,r+=e.offsetLeft;return{top:t,left:r,width:i,height:o}}var util=_dereq_("../util/util"),browser=_dereq_("../util/browser"),window=_dereq_("../util/window"),DOM=_dereq_("../util/dom"),ajax=_dereq_("../util/ajax"),Style=_dereq_("../style/style"),AnimationLoop=_dereq_("../style/animation_loop"),Painter=_dereq_("../render/painter"),PainterChromeMac=_dereq_("../render/painter1"),Transform=_dereq_("../geo/transform"),Hash=_dereq_("./hash"),bindHandlers=_dereq_("./bind_handlers"),Camera=_dereq_("./camera"),LngLat=_dereq_("../geo/lng_lat"),LngLatBounds=_dereq_("../geo/lng_lat_bounds"),Point=_dereq_("../_minemap_/point-geometry"),AttributionControl=_dereq_("./control/attribution_control"),LogoControl=_dereq_("./control/logo_control"),isSupported=_dereq_("../_minemap_/minemap-supported"),Drag=_dereq_("../util/drag"),FileSaver=_dereq_("../util/file_saver"),defaultMinZoom=0,defaultMaxZoom=22,defaultOptions={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:defaultMinZoom,maxZoom:defaultMaxZoom,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,logoControl:!0,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体"},Marker=_dereq_("./marker"),Map=function(e){function t(t){var r=this;if(t=util.extend({},defaultOptions,t),null!=t.minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than minZoom");var i=new Transform(t.minZoom,t.maxZoom,t.renderWorldCopies);e.call(this,i,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles;var o=t.transformRequest;if(this._transformRequest=o?function(e,t){return o(e,t)||{url:e}}:function(e){return{url:e}},this.__sourceList=[],this.__layersList=[],this.__markerList=[],this.__eventTree=[],"string"==typeof t.container){if(this._container=window.document.getElementById(t.container),!this._container)throw new Error("Container '"+t.container+"' not found.")}else this._container=t.container;this.animationLoop=new AnimationLoop,t.maxBounds&&this.setMaxBounds(t.maxBounds),util.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){r.animationLoop.set(300),r._rerender()}),void 0!==window&&(window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1)),bindHandlers(this,t),this._hash=t.hash&&(new Hash).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),this._classes=[],this.resize(),t.classes&&this.setClasses(t.classes),t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new AttributionControl),t.logoControl&&this.addControl(new LogoControl,t.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=t,t.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={overviewMap:{},showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return t.prototype.__onMove=function(e){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4)},t.prototype.addOverviewMap=function(){var e=this;this._overviewMapElement=window.document.createElement("div"),this._overviewMapElement.id="overviewMap_"+Math.random(),this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px";var r=this.getContainer().parentNode.parentNode;getElementOffset(r);r.appendChild(this._overviewMapElement),this.overviewMapInstance=new t({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,maxZoom:17,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0}),this.on("moveend",this.__onMove),setTimeout(function(){var t=window.document.createElement("div");e.overviewMapInstance.getCanvas().style.cursor="";var r=e.getBounds(),i=e.overviewMapInstance.project(r.getSouthWest()),o=e.overviewMapInstance.project(r.getNorthEast());o.y<=45&&(o=new Point(o.x,45)),i.x<=45&&(i=new Point(45,i.y)),t.style.top=Math.round(o.y)+"px",t.style.left=Math.round(i.x)+"px",t.style.width=Math.round(160-2*i.x)+"px",t.style.height=Math.round(160-2*o.y)+"px",t.style.border="2px solid red",t.style.position="absolute",e._overviewMapElement.appendChild(t),Drag.init({handler:e._overviewMapElement,root:t,restrictX:2*Math.round(i.x),restrictY:2*Math.round(o.y),cb:function(r,s){if(r-Math.round(i.x)!=0||s-Math.round(o.y)!=0){var n=e.overviewMapInstance.unproject([r-Math.round(i.x)+80,s-Math.round(o.y)+80]);e.flyTo({center:n,bearing:e.overviewMapInstance.getBearing()}),t.style.top=Math.round(o.y)+"px",t.style.left=Math.round(i.x)+"px"}}})},1e3)},r.overviewMap.set=function(e){this._overviewMap=e,this.overviewMapInstance?this._overviewMapElement.style.display=e?"block":"none":e&&this.addOverviewMap()},r.overviewMap.get=function(){return this._overviewMap},t.prototype.addControl=function(e,t){void 0===t&&e.getDefaultPosition&&(t=e.getDefaultPosition()),void 0===t&&(t="top-right");var r=e.onAdd(this),i=this._controlPositions[t];return-1!==t.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},t.prototype.removeControl=function(e){return e.onRemove(this),this},t.prototype.addClass=function(e,t){return util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Minemap JS."),this._classes.indexOf(e)>=0||""===e?this:(this._classes.push(e),this._classOptions=t,this.style&&this.style.updateClasses(),this._update(!0))},t.prototype.removeClass=function(e,t){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Minemap JS.");var r=this._classes.indexOf(e);return r<0||""===e?this:(this._classes.splice(r,1),this._classOptions=t,this.style&&this.style.updateClasses(),this._update(!0))},t.prototype.setClasses=function(e,t){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Minemap JS.");for(var r={},i=0;i<e.length;i++)""!==e[i]&&(r[e[i]]=!0);return this._classes=Object.keys(r),this._classOptions=t,this.style&&this.style.updateClasses(),this._update(!0)},t.prototype.hasClass=function(e){return util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Minemap JS."),this._classes.indexOf(e)>=0},t.prototype.getClasses=function(){return util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Minemap JS."),this._classes},t.prototype.resize=function(){var e=this._containerDimensions(),t=e[0],r=e[1];return this._resizeCanvas(t,r),this.transform.resize(t,r),this.painter.resize(t,r),this.fire("movestart").fire("move").fire("resize").fire("moveend")},t.prototype.getBounds=function(){var e=new LngLatBounds(this.transform.pointLocation(new Point(0,this.transform.height)),this.transform.pointLocation(new Point(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(e.extend(this.transform.pointLocation(new Point(this.transform.size.x,0))),e.extend(this.transform.pointLocation(new Point(0,this.transform.size.y)))),e},t.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new LngLatBounds([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},t.prototype.setMaxBounds=function(e){if(e){var t=LngLatBounds.convert(e);this.transform.lngRange=[t.getWest(),t.getEast()],this.transform.latRange=[t.getSouth(),t.getNorth()],this.transform._constrain(),this._update()}else null!==e&&void 0!==e||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},t.prototype.setMinZoom=function(e){if((e=null===e||void 0===e?defaultMinZoom:e)>=defaultMinZoom&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between "+defaultMinZoom+" and the current maxZoom, inclusive")},t.prototype.getMinZoom=function(){return this.transform.minZoom},t.prototype.setMaxZoom=function(e){if((e=null===e||void 0===e?defaultMaxZoom:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")},t.prototype.getMaxZoom=function(){return this.transform.maxZoom},t.prototype.project=function(e){return this.transform.locationPoint(LngLat.convert(e))},t.prototype.unproject=function(e){return this.transform.pointLocation(Point.convert(e))},t.prototype.on=function(t,r,i){var o=this;if(void 0===i)return e.prototype.on.call(this,t,r);var s=function(){if("mouseenter"===t||"mouseover"===t){var e=!1;return{layer:r,listener:i,delegates:{mousemove:function(s){var n=o.queryRenderedFeatures(s.point,{layers:[r]});n.length?e||(e=!0,i.call(o,util.extend({features:n},s,{type:t}))):e=!1},mouseout:function(){e=!1}}}}if("mouseleave"===t||"mouseout"===t){var s=!1;return{layer:r,listener:i,delegates:{mousemove:function(e){o.queryRenderedFeatures(e.point,{layers:[r]}).length?s=!0:s&&(s=!1,i.call(o,util.extend({},e,{type:t})))},mouseout:function(e){s&&(s=!1,i.call(o,util.extend({},e,{type:t})))}}}}var n=function(e){var t=o.queryRenderedFeatures(e.point,{layers:[r]});t.length&&i.call(o,util.extend({features:t},e))};return{layer:r,listener:i,delegates:(a={},a[t]=n,a)};var a}();this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(s);for(var n in s.delegates)o.on(n,s.delegates[n]);return this},t.prototype.off=function(t,r,i){var o=this;if(void 0===i)return e.prototype.off.call(this,t,r);if(this._delegatedListeners&&this._delegatedListeners[t])for(var s=this._delegatedListeners[t],n=0;n<s.length;n++){var a=s[n];if(a.layer===r&&a.listener===i){for(var h in a.delegates)o.off(h,a.delegates[h]);return s.splice(n,1),o}}},t.prototype.queryRenderedFeatures=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var r,i={};return 2===e.length?(r=arguments[0],i=arguments[1]):1===e.length&&function(e){return e instanceof Point||Array.isArray(e)}(e[0])?r=e[0]:1===e.length&&(i=e[0]),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(r),i,this.transform.zoom,this.transform.angle):[]},t.prototype._makeQueryGeometry=function(e){var t=this;void 0===e&&(e=[Point.convert([0,0]),Point.convert([this.transform.width,this.transform.height])]);var r;if(e instanceof Point||"number"==typeof e[0]){r=[Point.convert(e)]}else{var i=[Point.convert(e[0]),Point.convert(e[1])];r=[i[0],new Point(i[1].x,i[0].y),i[1],new Point(i[0].x,i[1].y),i[0]]}return r=r.map(function(e){return t.transform.pointCoordinate(e)})},t.prototype.querySourceFeatures=function(e,t){return this.style.querySourceFeatures(e,t)},t.prototype.setStyle=function(e,t){if((!t||!1!==t.diff&&!t.localIdeographFontFamily)&&this.style&&e&&!(e instanceof Style)&&"string"!=typeof e)try{return this.style.setState(e)&&this._update(!0),this}catch(e){util.warnOnce("Unable to perform style diff: "+(e.message||e.error||e)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement),this.off("move",this.style._redoPlacement)),e?(this.style=e instanceof Style?e:new Style(e,this,t||{}),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this.on("move",this.style._redoPlacement),this):(this.style=null,this)},t.prototype.getStyle=function(){if(this.style)return this.style.serialize()},t.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():util.warnOnce("There is no style added to the map.")},t.prototype.addSource=function(e,t){return this.style.addSource(e,t),this._update(!0),this},t.prototype.isSourceLoaded=function(e){var t=this.style&&this.style.sourceCaches[e];return void 0===t?void this.fire("error",{error:new Error("There is no source with ID '"+e+"'")}):t.loaded()},t.prototype.areTilesLoaded=function(){var e=this.style&&this.style.sourceCaches;for(var t in e){var r=e[t],i=r._tiles;for(var o in i){var s=i[o];if("loaded"!==s.state&&"errored"!==s.state)return!1}}return!0},t.prototype.addSourceType=function(e,t,r){return this.style.addSourceType(e,t,r)},t.prototype.removeSource=function(e){return this.style.removeSource(e),this._update(!0),this},t.prototype.removeAll=function(e){var t=this;e?"layer"===e.type?(this.__layersList.map(function(e){t.removeLayer(e)}),this.__layersList=[],this.__sourceList.map(function(e){t.removeSource(e)}),this.__sourceList=[],this.removeLayerEvent(null,null,this)):"marker"===e.type&&this.removeMarkers():(this.__layersList.map(function(e){t.removeLayer(e)}),this.__layersList=[],this.__sourceList.map(function(e){t.removeSource(e)}),this.__sourceList=[],this.removeMarkers(),this.removeLayerEvent(null,null,this))},t.prototype.addLayerEvent=function(e,t,r){var i=this,o={id:e,eventType:t,fun:function(t){var o=i.queryRenderedFeatures(t.point,{layers:[e]});if(o&&o.length>0)return r(o)}};i.__eventTree.push(o),this.on(t,o.fun)},t.prototype.removeLayerEvent=function(e,t,r){var i=this;if(r){for(var o=0;o<this.__eventTree.length;o++){var s=i.__eventTree[o];i.off(s.eventType,s.fun)}this.__eventTree=[]}else for(var n=0;n<this.__eventTree.length;n++){var a=i.__eventTree[n];if(a.id===e)return i.off(t,a.fun),void i.__eventTree.splice(n,1)}},t.prototype.getSource=function(e){return this.style.getSource(e)},t.prototype.addImage=function(e,t,r){this.style.spriteAtlas.addImage(e,t,r)},t.prototype.removeImage=function(e){this.style.spriteAtlas.removeImage(e)},t.prototype.loadImage=function(e,t){ajax.getImage(this._transformRequest(e,ajax.ResourceType.Image),t)},t.prototype.addLayer=function(e,t){return e.id&&this.__layersList.push(e.id),this.style.addLayer(e,t),this._update(!0),this},t.prototype.moveLayer=function(e,t){return this.style.moveLayer(e,t),this._update(!0),this},t.prototype.removeLayer=function(e){return this.style.removeLayer(e),this._update(!0),this},t.prototype.getLayer=function(e){return this.style.getLayer(e)},t.prototype.removeLayers=function(e){var t=this;if(e)for(var r=0;r<e.length;r++){var i=e[r];if(t.getLayer(i)){t.removeLayer(i);for(var o=0;o<this.__layersList.length;o++){var s=t.__layersList[o];s===i&&t.__layersList.splice(o,1)}}}else{for(var n=0;n<this.__layersList.length;n++){var a=t.__layersList[n];t.getLayer(a)&&t.removeLayer(a)}this.__layersList=[]}},t.prototype.setFilter=function(e,t){return this.style.setFilter(e,t),this._update(!0),this},t.prototype.setLayerZoomRange=function(e,t,r){return this.style.setLayerZoomRange(e,t,r),this._update(!0),this},t.prototype.getAllMarkers=function(){return this.__markerList},t.prototype.addMarker=function(e){!contains(this.__markerList,e)&&e instanceof Marker&&(this.__markerList.push(e),e.addTo(this))},t.prototype.addMarkers=function(e){for(var t=this,r=0;r<e.length;r++)t.addMarker(e[r])},t.prototype.removeMarker=function(e){e instanceof Marker&&e.remove()},t.prototype.removeMarkers=function(e){var t=this;if(e)for(var r=0;r<e.length;r++){t.removeMarker(e[r]);for(var i=0;i<this.__markerList.length;i++)e[r]===t.__markerList[i]&&t.__markerList.splice(i,1)}else{for(var o=0;o<this.__markerList.length;o++)t.removeMarker(t.__markerList[o]);this.__markerList=[]}},t.prototype.getFilter=function(e){return this.style.getFilter(e)},t.prototype.setPaintProperty=function(e,t,r,i){return this.style.setPaintProperty(e,t,r,i),this._update(!0),this},t.prototype.getPaintProperty=function(e,t,r){return this.style.getPaintProperty(e,t,r)},t.prototype.setLayoutProperty=function(e,t,r){return this.style.setLayoutProperty(e,t,r),this._update(!0),this},t.prototype.getLayoutProperty=function(e,t){return this.style.getLayoutProperty(e,t)},t.prototype.setLight=function(e){return this.style.setLight(e),this._update(!0),this},t.prototype.getLight=function(){return this.style.getLight()},t.prototype.getContainer=function(){return this._container},t.prototype.getCanvasContainer=function(){return this._canvasContainer},t.prototype.getMapScreenShot=function(e,t){if("file"!==e){var r=new Image;return r.src=this._canvas.toDataURL(),r}this._canvas.toBlob(function(e){FileSaver.saveAs(e,t||"mapsave.png")})},t.prototype.getCanvas=function(){return this._canvas},t.prototype._containerDimensions=function(){var e=0,t=0;return this._container&&(e=this._container.offsetWidth||400,t=this._container.offsetHeight||300),[e,t]},t.prototype._setupContainer=function(){var e=this._container;e.classList.add("minemap-map");var t=this._canvasContainer=DOM.create("div","minemap-canvas-container",e);this._interactive&&t.classList.add("minemap-interactive"),this._canvas=DOM.create("canvas","minemap-canvas",t),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=DOM.create("div","minemap-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(e){o[e]=DOM.create("div","minemap-ctrl-"+e,i)})},t.prototype._resizeCanvas=function(e,t){var r=window.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*t,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px"},t.prototype._setupPainter=function(){var e=util.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},isSupported.webGLContextAttributes),t=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e);if(!t)return void this.fire("error",{error:new Error("Failed to initialize WebGL")});-1!==navigator.userAgent.indexOf("Mac OS X")&&-1!==navigator.userAgent.indexOf("Chrome")?this.painter=new PainterChromeMac(t,this.transform):this.painter=new Painter(t,this.transform)},t.prototype._contextLost=function(e){e.preventDefault(),this._frameId&&(browser.cancelFrame(this._frameId),this._frameId=null),this.fire("webglcontextlost",{originalEvent:e})},t.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:e})},t.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},t.prototype._update=function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this._rerender(),this):this},t.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},t.prototype.remove=function(){this._hash&&this._hash.remove(),browser.cancelFrame(this._frameId),this._frameId=null,this.setStyle(null),void 0!==window&&(window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1));var e=this.painter.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),removeNode(this._canvasContainer),removeNode(this._controlContainer),this._container.classList.remove("minemap-map"),this.fire("remove"),this.overviewMapInstance&&(this.off("moveend",this.__onMove),this.overviewMapInstance.remove())},t.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=browser.frame(this._render))},t.prototype._onWindowOnline=function(){this._update()},t.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},r.showTileBoundaries.get=function(){return!!this._showTileBoundaries},r.showTileBoundaries.set=function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())},r.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},r.showCollisionBoxes.set=function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this.style._redoPlacement())},r.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},r.showOverdrawInspector.set=function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())},r.repaint.get=function(){return!!this._repaint},r.repaint.set=function(e){this._repaint=e,this._update()},r.vertices.get=function(){return!!this._vertices},r.vertices.set=function(e){this._vertices=e,this._update()},t.prototype._onData=function(e){this._update("style"===e.dataType),this.fire(e.dataType+"data",e)},t.prototype._onDataLoading=function(e){this.fire(e.dataType+"dataloading",e)},Object.defineProperties(t.prototype,r),t}(Camera);module.exports=Map;
},{"../_minemap_/minemap-supported":40,"../_minemap_/point-geometry":41,"../geo/lng_lat":78,"../geo/lng_lat_bounds":79,"../geo/transform":80,"../render/painter":99,"../render/painter1":100,"../style/animation_loop":160,"../style/style":163,"../util/ajax":216,"../util/browser":217,"../util/dom":224,"../util/drag":225,"../util/file_saver":227,"../util/util":244,"../util/window":219,"./bind_handlers":196,"./camera":197,"./control/attribution_control":198,"./control/logo_control":201,"./hash":211,"./marker":213}],213:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../util/dom"),LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),smartWrap=_dereq_("../util/smart_wrap"),Marker=function(t,e){this._offset=Point.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=DOM.create("div")),t.classList.add("minemap-marker"),this._element=t,this._popup=null};Marker.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),t.addMarker(this),this},Marker.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),DOM.remove(this._element),this._popup&&this._popup.remove(),this},Marker.prototype.getLngLat=function(){return this._lngLat},Marker.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Marker.prototype.getElement=function(){return this._element},Marker.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},Marker.prototype._onMapClick=function(t){var e=t.originalEvent.target,p=this._element;this._popup&&(e===p||p.contains(e))&&this.togglePopup()},Marker.prototype.getPopup=function(){return this._popup},Marker.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},Marker.prototype._update=function(t){if(this._map){var e=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),DOM.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},module.exports=Marker;
},{"../_minemap_/point-geometry":41,"../geo/lng_lat":78,"../util/dom":224,"../util/smart_wrap":240}],214:[function(_dereq_,module,exports){
"use strict";function normalizeOffset(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new Point(0,t),"top-left":new Point(e,e),"top-right":new Point(-e,e),bottom:new Point(0,-t),"bottom-left":new Point(e,-e),"bottom-right":new Point(-e,-e),left:new Point(t,0),right:new Point(-t,0)}}if(isPointLike(t)){var o=Point.convert(t);return{top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{top:Point.convert(t.top||[0,0]),"top-left":Point.convert(t["top-left"]||[0,0]),"top-right":Point.convert(t["top-right"]||[0,0]),bottom:Point.convert(t.bottom||[0,0]),"bottom-left":Point.convert(t["bottom-left"]||[0,0]),"bottom-right":Point.convert(t["bottom-right"]||[0,0]),left:Point.convert(t.left||[0,0]),right:Point.convert(t.right||[0,0])}}return normalizeOffset(new Point(0,0))}function isPointLike(t){return t instanceof Point||Array.isArray(t)}var util=_dereq_("../util/util"),Evented=_dereq_("../util/evented"),DOM=_dereq_("../util/dom"),LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),window=_dereq_("../util/window"),smartWrap=_dereq_("../util/smart_wrap"),defaultOptions={closeButton:!0,closeOnClick:!0},Popup=function(t){function e(e){t.call(this),this.options=util.extend(Object.create(defaultOptions),e),util.bindAll(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(window.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,o=window.document.createDocumentFragment(),n=window.document.createElement("body");for(n.innerHTML=t;;){if(!(e=n.firstChild))break;o.appendChild(e)}return this.setDOMContent(o)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=DOM.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=DOM.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=DOM.create("div","minemap-popup",this._map.getContainer()),this._tip=DOM.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=normalizeOffset(this.options.offset),o=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat).round();if(!t){var n=this._container.offsetWidth,i=this._container.offsetHeight;t=o.y+e.bottom.y<i?["top"]:o.y>this._map.transform.height-i?["bottom"]:[],o.x<n/2?t.push("left"):o.x>this._map.transform.width-n/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var r=o.add(e[t]),s={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},p=this._container.classList;for(var a in s)p.remove("minemap-popup-anchor-"+a);p.add("minemap-popup-anchor-"+t),DOM.setTransform(this._container,s[t]+" translate("+r.x+"px,"+r.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(Evented);module.exports=Popup;
},{"../_minemap_/point-geometry":41,"../geo/lng_lat":78,"../util/dom":224,"../util/evented":226,"../util/smart_wrap":240,"../util/util":244,"../util/window":219}],215:[function(_dereq_,module,exports){
"use strict";var Actor=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};Actor.prototype.send=function(t,e,r,a,s){var i=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[i]=r),this.target.postMessage({targetMapId:s,sourceMapId:this.mapId,type:t,id:String(i),data:e},a)},Actor.prototype.receive=function(t){var e,r=this,a=t.data,s=a.id;if(!a.targetMapId||this.mapId===a.targetMapId){var i=function(t,e,a){r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(s),error:t?String(t):null,data:e},a)};if("<response>"===a.type)e=this.callbacks[a.id],delete this.callbacks[a.id],e&&a.error?e(new Error(a.error)):e&&e(null,a.data);else if(void 0!==a.id&&this.parent[a.type])this.parent[a.type](a.sourceMapId,a.data,i);else if(void 0!==a.id&&this.parent.getWorkerSource){var o=a.type.split("."),p=this.parent.getWorkerSource(a.sourceMapId,o[0]);p[o[1]](a.data,i)}else this.parent[a.type](a.data)}},Actor.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},module.exports=Actor;
},{}],216:[function(_dereq_,module,exports){
"use strict";function makeRequest(e){var r=new window.XMLHttpRequest;r.open("GET",e.url,!0);for(var t in e.headers)r.setRequestHeader(t,e.headers[t]);return r.withCredentials="include"===e.credentials,r}function sameOrigin(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var window=_dereq_("./window"),decoderTilePbf=_dereq_("./pbf_decoder").decoderTilePbf,ResourceType={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};exports.ResourceType=ResourceType,"function"==typeof Object.freeze&&Object.freeze(ResourceType);var AJAXError=function(e){function r(r,t){e.call(this,r),this.status=t}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(Error);exports.postJSON=function(e,r,t){var n=function(e){var r="";for(var t in e)r+=t+"="+e[t]+"&";return r}(r),o=new window.XMLHttpRequest;return o.open("POST",e),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onerror=function(e){t(e)},o.onload=function(){if(o.status>=200&&o.status<300&&o.response){var e=JSON.parse(o.response);try{e=JSON.parse(o.response)}catch(e){return t(e)}t(null,e)}},o.send(n),o},exports.getJSON=function(e,r){var t=makeRequest("string"==typeof e?{url:e}:e);return t.setRequestHeader("Accept","application/json"),t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if(t.status>=200&&t.status<300&&t.response){var e;try{e=JSON.parse(t.response)}catch(e){return r(e)}r(null,e)}else r(new AJAXError(t.statusText,t.status))},t.send(),t},exports.getArrayBuffer=function(e,r){var t=makeRequest(e);return t.responseType="arraybuffer",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){var e=t.response;if(0===e.byteLength&&200===t.status&&r(null,{data:e,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires")}),t.status>=200&&t.status<300&&t.response){var n=decoderTilePbf(t);r(null,{data:n,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires")})}else r(new AJAXError(t.statusText,t.status))},t.send(),t};var transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";exports.getImage=function(e,r){return exports.getArrayBuffer(e,function(e,t){if(e)r(e);else if(t){var n=new window.Image,o=window.URL||window.webkitURL;n.onload=function(){r(null,n),o.revokeObjectURL(n.src)};var s=new window.Blob([new Uint8Array(t.data)],{type:"image/png"});n.cacheControl=t.cacheControl,n.expires=t.expires,n.src=t.data.byteLength?o.createObjectURL(s):transparentPngUrl}})},exports.getVideo=function(e,r){var t=window.document.createElement("video");t.onloadstart=function(){r(null,t)};for(var n=0;n<e.length;n++){var o=window.document.createElement("source");sameOrigin(e[n])||(t.crossOrigin="Anonymous"),o.src=e[n],t.appendChild(o)}return t};
},{"./pbf_decoder":237,"./window":219}],217:[function(_dereq_,module,exports){
"use strict";var window=_dereq_("./window"),now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;module.exports={now:now,frame:function(e){return frame(e)},cancelFrame:function(e){return cancel(e)},timed:function(e,n,a){function t(){if(!i){var r=now();r>=o+n?e.call(a,1):(e.call(a,(r-o)/n),frame(t))}}if(!n)return e.call(a,1),null;var i=!1,o=now();return frame(t),function(){i=!0}},getImageData:function(e){var n=window.document.createElement("canvas"),a=n.getContext("2d");return n.width=e.width,n.height=e.height,a.drawImage(e,0,0,e.width,e.height),a.getImageData(0,0,e.width,e.height).data},hardwareConcurrency:window.navigator.hardwareConcurrency||4,get devicePixelRatio(){return window.devicePixelRatio},supportsWebp:!1};var webpImgTest=window.document.createElement("img");webpImgTest.onload=function(){module.exports.supportsWebp=!0},webpImgTest.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";
},{"./window":219}],218:[function(_dereq_,module,exports){
"use strict";var WebWorkify=_dereq_("webworkify"),window=_dereq_("../window"),workerURL=window.URL.createObjectURL(new WebWorkify(_dereq_("../../source/worker"),{bare:!0}));module.exports=function(){return new window.Worker(workerURL)};
},{"../../source/worker":124,"../window":219,"webworkify":25}],219:[function(_dereq_,module,exports){
"use strict";module.exports=self;
},{}],220:[function(_dereq_,module,exports){
"use strict";function compareAreas(e,r){return r.area-e.area}var quickselect=_dereq_("quickselect"),calculateSignedArea=_dereq_("./util").calculateSignedArea;module.exports=function(e,r){var a=e.length;if(a<=1)return[e];for(var t,u,c=[],i=0;i<a;i++){var l=calculateSignedArea(e[i]);0!==l&&(e[i].area=Math.abs(l),void 0===u&&(u=l<0),u===l<0?(t&&c.push(t),t=[e[i]]):t.push(e[i]))}if(t&&c.push(t),r>1)for(var n=0;n<c.length;n++)c[n].length<=r||(quickselect(c[n],r,1,c[n].length-1,compareAreas),c[n]=c[n].slice(0,r));return c};
},{"./util":244,"quickselect":20}],221:[function(_dereq_,module,exports){
"use strict";var config={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SRC_BASE:"/minemapapi/v1.3/",SRC_URL:"//minedata.cn/minemapapi/v1.3/",SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};module.exports=config;
},{}],222:[function(_dereq_,module,exports){
"use strict";var DictionaryCoder=function(r){var t=this;this._stringToNumber={},this._numberToString=[];for(var o=0;o<r.length;o++){var i=r[o];t._stringToNumber[i]=o,t._numberToString[o]=i}};DictionaryCoder.prototype.encode=function(r){return this._stringToNumber[r]},DictionaryCoder.prototype.decode=function(r){return this._numberToString[r]},module.exports=DictionaryCoder;
},{}],223:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("./util"),Actor=_dereq_("./actor"),Dispatcher=function(t,r){var o=this;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=util.uniqueId();for(var i=this.workerPool.acquire(this.id),e=0;e<i.length;e++){var s=i[e],c=new Actor(s,r,o.id);c.name="Worker "+e,o.actors.push(c)}};Dispatcher.prototype.broadcast=function(t,r,o){o=o||function(){},util.asyncAll(this.actors,function(o,i){o.send(t,r,i)},o)},Dispatcher.prototype.send=function(t,r,o,i,e){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,r,o,e),i},Dispatcher.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},module.exports=Dispatcher;
},{"./actor":215,"./util":244}],224:[function(_dereq_,module,exports){
"use strict";function testProp(e){for(var t=0;t<e.length;t++)if(e[t]in docStyle)return e[t];return e[0]}function suppressClick(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",suppressClick,!0)}var Point=_dereq_("../_minemap_/point-geometry"),window=_dereq_("./window");exports.create=function(e,t,n){var o=window.document.createElement(e);return t&&(o.className=t),n&&n.appendChild(o),o};var docStyle=window.document.documentElement.style,selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),userSelect;exports.disableDrag=function(){selectProp&&(userSelect=docStyle[selectProp],docStyle[selectProp]="none")},exports.enableDrag=function(){selectProp&&(docStyle[selectProp]=userSelect)};var transformProp=testProp(["transform","WebkitTransform"]);exports.setTransform=function(e,t){e.style[transformProp]=t},exports.suppressClick=function(){window.addEventListener("click",suppressClick,!0),window.setTimeout(function(){window.removeEventListener("click",suppressClick,!0)},0)},exports.mousePos=function(e,t){var n=e.getBoundingClientRect();return t=t.touches?t.touches[0]:t,new Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},exports.touchPos=function(e,t){for(var n=e.getBoundingClientRect(),o=[],r="touchend"===t.type?t.changedTouches:t.touches,s=0;s<r.length;s++)o.push(new Point(r[s].clientX-n.left-e.clientLeft,r[s].clientY-n.top-e.clientTop));return o},exports.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};
},{"../_minemap_/point-geometry":41,"./window":219}],225:[function(_dereq_,module,exports){
"use strict";var window=_dereq_("../util/window"),cb=null,restrictX=0,restrictY=0,Drag={obj:null,init:function(t){cb=t.cb,restrictX=t.restrictX,restrictY=t.restrictY,t.handler.onmousedown=this.start,t.handler.root=t.root||t.handler;var o=t.handler.root;o.onDragStart=t.dragStart||new Function,o.onDrag=t.onDrag||new Function,o.onDragEnd=t.onDragEnd||new Function},start:function(t){var o=Drag.obj=this;o.style.cursor="move",t=t||Drag.fixEvent(window.event);var r=t.pageX,e=t.pageY;o.lastMouseX=r,o.lastMouseY=e;var n=o.root.offsetLeft,a=o.root.offsetTop;o.root.style.left=n+"px",o.root.style.top=a+"px",window.document.onmouseup=Drag.end,window.document.onmousemove=Drag.drag,o.root.onDragStart(n,a)},drag:function(t){t=t||Drag.fixEvent(window.event);var o=t.pageX,r=t.pageY,e=Drag.obj.root,n=e.style.left?parseInt(e.style.left):0,a=e.style.top?parseInt(e.style.top):0;n<=-1&&(n=-1),a<=-1&&(a=-1),n>=restrictX&&(n=restrictX),a>=restrictY&&(a=restrictY);var s=o-Drag.obj.lastMouseX+n,l=r-Drag.obj.lastMouseY+a;e.style.left=s+"px",e.style.top=l+"px",Drag.obj.root.onDrag(s,l),Drag.obj.lastMouseX=o,Drag.obj.lastMouseY=r},end:function(t){var o=Drag.obj.root.style.left?parseInt(Drag.obj.root.style.left):0,r=Drag.obj.root.style.top?parseInt(Drag.obj.root.style.top):0;Drag.obj.root.onDragEnd(o,r),window.setTimeout(function(){cb(o,r)},100),window.document.onmousemove=null,window.document.onmouseup=null,Drag.obj=null},fixEvent:function(t){return t.pageX=t.clientX+window.document.documentElement.scrollLeft,t.pageY=t.clientY+window.document.documentElement.scrollTop,t}};module.exports=Drag;
},{"../util/window":219}],226:[function(_dereq_,module,exports){
"use strict";function _addEventListener(e,t,n){n[e]=n[e]||[],n[e].push(t)}function _removeEventListener(e,t,n){if(n&&n[e]){var i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}var util=_dereq_("./util"),Evented=function(){};Evented.prototype.on=function(e,t){return this._listeners=this._listeners||{},_addEventListener(e,t,this._listeners),this},Evented.prototype.off=function(e,t){return _removeEventListener(e,t,this._listeners),_removeEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},_addEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.fire=function(e,t){var n=this;if(this.listens(e)){t=util.extend({},t,{type:e,target:this});for(var i=this._listeners&&this._listeners[e]?this._listeners[e].slice():[],s=0;s<i.length;s++)i[s].call(n,t);for(var r=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[],o=0;o<r.length;o++)r[o].call(n,t),_removeEventListener(e,r[o],n._oneTimeListeners);this._eventedParent&&this._eventedParent.fire(e,util.extend({},t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}else if(util.endsWith(e,"error")){t&&t.error;console.error(t&&t.error||t||"Empty error event")}return this},Evented.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Evented.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this},module.exports=Evented;
},{"./util":244}],227:[function(_dereq_,module,exports){
"use strict";var saveAs=saveAs||function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},u=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){f(e)}}},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,f,l){l||(t=c(t));var v,p=this,w=t.type,m="application/octet-stream"===w,y=function(){u(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,r)return v=n().createObjectURL(t),void setTimeout(function(){o.href=v,o.download=f,a(o),y(),s(v),p.readyState=p.DONE});!function(){if((d||m&&i)&&e.FileReader){var o=new FileReader;return o.onloadend=function(){var t=d?o.result:o.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,y()},o.readAsDataURL(t),void(p.readyState=p.INIT)}if(v||(v=n().createObjectURL(t)),m)e.location.href=v;else{e.open(v,"_blank")||(e.location.href=v)}p.readyState=p.DONE,y(),s(v)}()},v=l.prototype,p=function(e,t,n){return new l(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(v.abort=function(){},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,p)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});
},{}],228:[function(_dereq_,module,exports){
"use strict";function compareMax(e,t){return t.max-e.max}function Cell(e,t,n,r){this.p=new Point(e,t),this.h=n,this.d=pointToPolygonDist(this.p,r),this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(e,t){for(var n=!1,r=1/0,o=0;o<t.length;o++)for(var i=t[o],l=0,u=i.length,a=u-1;l<u;a=l++){var s=i[l],p=i[a];s.y>e.y!=p.y>e.y&&e.x<(p.x-s.x)*(e.y-s.y)/(p.y-s.y)+s.x&&(n=!n),r=Math.min(r,distToSegmentSquared(e,s,p))}return(n?1:-1)*Math.sqrt(r)}function getCentroidCell(e){for(var t=0,n=0,r=0,o=e[0],i=0,l=o.length,u=l-1;i<l;u=i++){var a=o[i],s=o[u],p=a.x*s.y-s.x*a.y;n+=(a.x+s.x)*p,r+=(a.y+s.y)*p,t+=3*p}return new Cell(n/t,r/t,0,e)}var Queue=_dereq_("tinyqueue"),Point=_dereq_("../_minemap_/point-geometry"),distToSegmentSquared=_dereq_("./intersection_tests").distToSegmentSquared;module.exports=function(e,t,n){t=t||1;for(var r,o,i,l,u=e[0],a=0;a<u.length;a++){var s=u[a];(!a||s.x<r)&&(r=s.x),(!a||s.y<o)&&(o=s.y),(!a||s.x>i)&&(i=s.x),(!a||s.y>l)&&(l=s.y)}var p=i-r,h=l-o,y=Math.min(p,h),x=y/2,d=new Queue(null,compareMax);if(0===y)return[r,o];for(var g=r;g<i;g+=y)for(var m=o;m<l;m+=y)d.push(new Cell(g+x,m+x,x,e));for(var f=getCentroidCell(e),c=d.length;d.length;){var v=d.pop();(v.d>f.d||!f.d)&&(f=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,c)),v.max-f.d<=t||(x=v.h/2,d.push(new Cell(v.p.x-x,v.p.y-x,x,e)),d.push(new Cell(v.p.x+x,v.p.y-x,x,e)),d.push(new Cell(v.p.x-x,v.p.y+x,x,e)),d.push(new Cell(v.p.x+x,v.p.y+x,x,e)),c+=4)}return n&&(console.log("num probes: "+c),console.log("best distance: "+f.d)),f.p};
},{"../_minemap_/point-geometry":41,"./intersection_tests":233,"tinyqueue":21}],229:[function(_dereq_,module,exports){
"use strict";var WorkerPool=_dereq_("./worker_pool"),globalWorkerPool;module.exports=function(){return globalWorkerPool||(globalWorkerPool=new WorkerPool),globalWorkerPool};
},{"./worker_pool":247}],230:[function(_dereq_,module,exports){
"use strict";function readFontstacks(a,e,r){if(1===a){var t=r.readMessage(readFontstack,{glyphs:{}});e.push(t)}}function readFontstack(a,e,r){if(1===a)e.name=r.readString();else if(2===a)e.range=r.readString();else if(3===a){var t=r.readMessage(readGlyph,{});e.glyphs[t.id]=t}}function readGlyph(a,e,r){1===a?e.id=r.readVarint():2===a?e.bitmap=r.readBytes():3===a?e.width=r.readVarint():4===a?e.height=r.readVarint():5===a?e.left=r.readSVarint():6===a?e.top=r.readSVarint():7===a&&(e.advance=r.readVarint())}var Glyphs=function(a,e){this.stacks=a.readFields(readFontstacks,[],e)};module.exports=Glyphs;
},{}],231:[function(_dereq_,module,exports){
"use strict";var Polygon=exports.Polygon={};Polygon.read=function(e,n){return e.readFields(Polygon._readField,{lon:[],lat:[],index:[],multi:[]},n)},Polygon._readField=function(e,n,r){1===e?r.readPackedVarint(n.lon,!0):2===e?r.readPackedVarint(n.lat,!0):3===e?r.readPackedVarint(n.index,!0):4===e&&r.readPackedVarint(n.multi,!0)},Polygon.write=function(e,n){e.lon&&n.writePackedVarint(1,e.lon),e.lat&&n.writePackedVarint(2,e.lat),e.index&&n.writePackedVarint(3,e.index),e.multi&&n.writePackedVarint(4,e.multi)};var Building=exports.Building={};Building.read=function(e,n){return e.readFields(Building._readField,{polygon:null,num:0,name:"",type:""},n)},Building._readField=function(e,n,r){1===e?n.polygon=Polygon.read(r,r.readVarint()+r.pos):2===e?n.num=r.readVarint(!0):3===e?n.name=r.readString():4===e&&(n.type=r.readString())},Building.write=function(e,n){e.polygon&&n.writeMessage(1,Polygon.write,e.polygon),e.num&&n.writeVarintField(2,e.num),e.name&&n.writeStringField(3,e.name),e.type&&n.writeStringField(4,e.type)};var Center=exports.Center={};Center.read=function(e,n){return e.readFields(Center._readField,{point:null,num:0,name:"",type:""},n)},Center._readField=function(e,n,r){1===e?n.point=Point.read(r,r.readVarint()+r.pos):3===e?n.num=r.readVarint(!0):4===e?n.name=r.readString():5===e&&(n.type=r.readString())},Center.write=function(e,n){e.point&&n.writeMessage(1,Point.write,e.point),e.num&&n.writeVarintField(3,e.num),e.name&&n.writeStringField(4,e.name),e.type&&n.writeStringField(5,e.type)};var MultiPolygon=exports.MultiPolygon={};MultiPolygon.read=function(e,n){return e.readFields(MultiPolygon._readField,{polygon:[]},n)},MultiPolygon._readField=function(e,n,r){1===e&&n.polygon.push(Polygon.read(r,r.readVarint()+r.pos))},MultiPolygon.write=function(e,n){if(e.polygon)for(var r=0;r<e.polygon.length;r++)n.writeMessage(1,Polygon.write,e.polygon[r])};var Point=exports.Point={};Point.read=function(e,n){return e.readFields(Point._readField,{lon:[],lat:[]},n)},Point._readField=function(e,n,r){1===e?r.readPackedVarint(n.lon,!0):2===e&&r.readPackedVarint(n.lat,!0)},Point.write=function(e,n){e.lon&&n.writePackedVarint(1,e.lon),e.lat&&n.writePackedVarint(2,e.lat)};var Floor=exports.Floor={};Floor.read=function(e,n){return e.readFields(Floor._readField,{ppoint:[],ptype:[],pname:[],sface:[],stype:[],sname:[],fface:null,fname:""},n)},Floor._readField=function(e,n,r){1===e?n.ppoint.push(Point.read(r,r.readVarint()+r.pos)):3===e?r.readPackedVarint(n.ptype,!0):4===e?n.pname.push(r.readString()):5===e?n.sface.push(Polygon.read(r,r.readVarint()+r.pos)):6===e?r.readPackedVarint(n.stype,!0):7===e?n.sname.push(r.readString()):8===e?n.fface=Polygon.read(r,r.readVarint()+r.pos):9===e&&(n.fname=r.readString())},Floor.write=function(e,n){if(e.ppoint)for(var r=0;r<e.ppoint.length;r++)n.writeMessage(1,Point.write,e.ppoint[r]);if(e.ptype&&n.writePackedVarint(3,e.ptype),e.pname)for(r=0;r<e.pname.length;r++)n.writeStringField(4,e.pname[r]);if(e.sface)for(r=0;r<e.sface.length;r++)n.writeMessage(5,Polygon.write,e.sface[r]);if(e.stype&&n.writePackedVarint(6,e.stype),e.sname)for(r=0;r<e.sname.length;r++)n.writeStringField(7,e.sname[r]);e.fface&&n.writeMessage(8,Polygon.write,e.fface),e.fname&&n.writeStringField(9,e.fname)};var IndoorPbf=exports.IndoorPbf={};IndoorPbf.read=function(e,n){return e.readFields(IndoorPbf._readField,{building:null,default:"",center:null,indexes:[],floor:[],lonoffset:0,latoffset:0,num:0},n)},IndoorPbf._readField=function(e,n,r){1===e?n.building=Building.read(r,r.readVarint()+r.pos):2===e?n.default=r.readString():3===e?n.center=Center.read(r,r.readVarint()+r.pos):4===e?n.indexes.push(r.readString()):5===e?n.floor.push(Floor.read(r,r.readVarint()+r.pos)):6===e?n.lonoffset=r.readVarint(!0):7===e?n.latoffset=r.readVarint(!0):8===e&&(n.num=r.readVarint(!0))},IndoorPbf.write=function(e,n){if(e.building&&n.writeMessage(1,Building.write,e.building),e.default&&n.writeStringField(2,e.default),e.center&&n.writeMessage(3,Center.write,e.center),e.indexes)for(var r=0;r<e.indexes.length;r++)n.writeStringField(4,e.indexes[r]);if(e.floor)for(r=0;r<e.floor.length;r++)n.writeMessage(5,Floor.write,e.floor[r]);e.lonoffset&&n.writeVarintField(6,e.lonoffset),e.latoffset&&n.writeVarintField(7,e.latoffset),e.num&&n.writeVarintField(8,e.num)};
},{}],232:[function(_dereq_,module,exports){
"use strict";function parseMessage(e){var t=e.lonoffset,o=e.latoffset,r=Math.pow(10,e.num);return{building:getBuildingData(t,o,r,e),building_name:getBuildingNameData(t,o,r,e),default_:e.default||"",indexes:e.indexes||[],floors:getFloorsData(t,o,r,e)}}function getBuildingData(e,t,o,r){var n=r.building;return{geometry:getPolygonGeometry(e,t,o,n.polygon),type:"Feature",properties:{build_num:n.num,build_name:n.name,build_type:n.type}}}function getBuildingNameData(e,t,o,r){var n=r.center,a=n.point;return{geometry:{type:"Point",coordinates:convertLonLat(e,t,o,a.lon[0],a.lat[0])},type:"Feature",properties:{build_num:n.num,build_name:n.name,build_type:n.type}}}function getFloorsData(e,t,o,r){return(r.floor||[]).map(function(r){return{ix_poi:{type:"FeatureCollection",features:getIxPoiDataArr(e,t,o,r)},space_face:{type:"FeatureCollection",features:getSpaceFaceDataArr(e,t,o,r)},floor:getFloorData(e,t,o,r)}})}function getIxPoiDataArr(e,t,o,r){var n=r.ppoint||[],a=r.pname||[],i=r.ptype||[];return n.map(function(r,n){return{geometry:{type:"Point",coordinates:convertLonLat(e,t,o,r.lon[0],r.lat[0])},type:"Feature",properties:{poi_type:i[n],poi_name:a[n]}}})}function getSpaceFaceDataArr(e,t,o,r){var n=r.sface||[],a=r.sname||[],i=r.stype||[];return n.map(function(r,u){return{geometry:getPolygonGeometry(e,t,o,n[u]),type:"Feature",properties:{space_type:i[u],space_name:a[u]}}})}function getFloorData(e,t,o,r){return{geometry:getPolygonGeometry(e,t,o,r.fface||{}),type:"Feature",properties:{floor_name:r.fname}}}function convertLonLat(e,t,o,r,n){return[(r+e)/o,(n+t)/o]}function getPolygonGeometry(e,t,o,r){for(var n=r.lon,a=r.lat,i=r.index,u=r.multi,p=[],l=0,f=0;f<u.length;f++){for(var g=[],s=0,y=l,c=y+u[f],m=y;m<c;m++){for(var d=[],b=s;b<s+i[m];b++)d.push(convertLonLat(e,t,o,n[b],a[b]));s+=i[m],g.push(d)}l=+u[f],p.push(g)}var P=[],_="Polygon";return u.length>1?(P=p,_="MultiPolygon"):(P=p[0],_="Polygon"),{type:_,coordinates:P}}var Protobuf=_dereq_("pbf"),IndoorPbf=_dereq_("./indoor_pbf").IndoorPbf,IndoorMap=function(e){var t=IndoorPbf.read(new Protobuf(e));this.indoormap=parseMessage(t)};IndoorMap.prototype.getData=function(){return this.indoormap},module.exports=IndoorMap;
},{"./indoor_pbf":231,"pbf":18}],233:[function(_dereq_,module,exports){
"use strict";function polygonIntersectsPolygon(n,t){for(var e=0;e<n.length;e++)if(polygonContainsPoint(t,n[e]))return!0;for(var r=0;r<t.length;r++)if(polygonContainsPoint(n,t[r]))return!0;return!!lineIntersectsLine(n,t)}function multiPolygonIntersectsBufferedMultiPoint(n,t,e){for(var r=0;r<n.length;r++)for(var o=n[r],i=0;i<t.length;i++)for(var l=t[i],u=0;u<l.length;u++){var s=l[u];if(polygonContainsPoint(o,s))return!0;if(pointIntersectsBufferedLine(s,o,e))return!0}return!1}function multiPolygonIntersectsMultiPolygon(n,t){if(1===n.length&&1===n[0].length)return multiPolygonContainsPoint(t,n[0][0]);for(var e=0;e<t.length;e++)for(var r=t[e],o=0;o<r.length;o++)if(multiPolygonContainsPoint(n,r[o]))return!0;for(var i=0;i<n.length;i++){for(var l=n[i],u=0;u<l.length;u++)if(multiPolygonContainsPoint(t,l[u]))return!0;for(var s=0;s<t.length;s++)if(lineIntersectsLine(l,t[s]))return!0}return!1}function multiPolygonIntersectsBufferedMultiLine(n,t,e){for(var r=0;r<t.length;r++)for(var o=t[r],i=0;i<n.length;i++){var l=n[i];if(l.length>=3)for(var u=0;u<o.length;u++)if(polygonContainsPoint(l,o[u]))return!0;if(lineIntersectsBufferedLine(l,o,e))return!0}return!1}function lineIntersectsBufferedLine(n,t,e){if(n.length>1){if(lineIntersectsLine(n,t))return!0;for(var r=0;r<t.length;r++)if(pointIntersectsBufferedLine(t[r],n,e))return!0}for(var o=0;o<n.length;o++)if(pointIntersectsBufferedLine(n[o],t,e))return!0;return!1}function lineIntersectsLine(n,t){if(0===n.length||0===t.length)return!1;for(var e=0;e<n.length-1;e++)for(var r=n[e],o=n[e+1],i=0;i<t.length-1;i++){var l=t[i],u=t[i+1];if(lineSegmentIntersectsLineSegment(r,o,l,u))return!0}return!1}function lineSegmentIntersectsLineSegment(n,t,e,r){return isCounterClockwise(n,e,r)!==isCounterClockwise(t,e,r)&&isCounterClockwise(n,t,e)!==isCounterClockwise(n,t,r)}function pointIntersectsBufferedLine(n,t,e){var r=e*e;if(1===t.length)return n.distSqr(t[0])<r;for(var o=1;o<t.length;o++){if(distToSegmentSquared(n,t[o-1],t[o])<r)return!0}return!1}function distToSegmentSquared(n,t,e){var r=t.distSqr(e);if(0===r)return n.distSqr(t);var o=((n.x-t.x)*(e.x-t.x)+(n.y-t.y)*(e.y-t.y))/r;return o<0?n.distSqr(t):o>1?n.distSqr(e):n.distSqr(e.sub(t)._mult(o)._add(t))}function multiPolygonContainsPoint(n,t){for(var e,r,o,i=!1,l=0;l<n.length;l++){e=n[l];for(var u=0,s=e.length-1;u<e.length;s=u++)r=e[u],o=e[s],r.y>t.y!=o.y>t.y&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}function polygonContainsPoint(n,t){for(var e=!1,r=0,o=n.length-1;r<n.length;o=r++){var i=n[r],l=n[o];i.y>t.y!=l.y>t.y&&t.x<(l.x-i.x)*(t.y-i.y)/(l.y-i.y)+i.x&&(e=!e)}return e}var isCounterClockwise=_dereq_("./util").isCounterClockwise;module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared};
},{"./util":244}],234:[function(_dereq_,module,exports){
"use strict";var unicodeBlockLookup={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};module.exports=unicodeBlockLookup;
},{}],235:[function(_dereq_,module,exports){
"use strict";var LRUCache=function(t,e){this.max=t,this.onRemove=e,this.reset()};LRUCache.prototype.reset=function(){var t=this;for(var e in t.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},LRUCache.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var r=this.get(this.order[0]);r&&this.onRemove(r)}return this},LRUCache.prototype.has=function(t){return t in this.data},LRUCache.prototype.keys=function(){return this.order},LRUCache.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},LRUCache.prototype.getWithoutRemoving=function(t){return this.has(t)?this.data[t]:null},LRUCache.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},LRUCache.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var r=e.get(e.order[0]);r&&e.onRemove(r)}return this},module.exports=LRUCache;
},{}],236:[function(_dereq_,module,exports){
"use strict";function makeAPIURL(r,t,a,o){switch(r.protocol){case"minemap":var e=parseUrl(config.SRC_URL);r.protocol=e.protocol,r.authority=e.authority;break;case"minemapdata":var i=parseUrl(config.API_URL);r.path=i.path+r.authority+r.path,r.protocol=i.protocol,r.authority=i.authority;break;case"minemapdatad":var n=parseUrl(config.DYN_URL);r.path=n.path+r.authority+r.path,r.protocol=n.protocol,r.authority=n.authority;break;case"minemapdatam":var p=parseUrl(config.MERGE_URL);r.path=p.path+r.authority+r.path,r.protocol=p.protocol,r.authority=p.authority;break;case"minemapdatao":var s=parseUrl(config.OTHER_URL);r.path=s.path+r.authority+r.path,r.protocol=s.protocol,r.authority=s.authority}if(!config.REQUIRE_ACCESS_TOKEN)return formatUrl(r);if(t=t||config.ACCESS_TOKEN,a=a||config.SOLU,o=o||config.DATA_VERSION,!t)throw new Error("需要申请accessToken. "+help);return r.params.push("token="+t),r.params.push("solu="+a),o&&r.params.push("version="+o),formatUrl(r)}function isMinemapURL(r){return 0===r.indexOf("minemap:")||0===r.indexOf("minemapdata:")||0===r.indexOf("minemapdatad:")||0===r.indexOf("minemapdatam:")||0===r.indexOf("minemapdatao:")}function getVersion(){return"v"+version.substr(version.indexOf(".")+1)}function replaceTempAccessToken(r){for(var t=0;t<r.length;t++)0===r[t].indexOf("access_token=tk.")&&(r[t]="access_token="+(config.ACCESS_TOKEN||""))}function parseUrl(r){var t=r.match(urlRe);if(!t){var a=/^\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/,o=r.match(a);if(!o)throw new Error("Unable to parse URL object");return{protocol:"",authority:o[1],path:o[2]||"/",params:o[3]?o[3].split("&"):[]}}return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function formatUrl(r){var t=r.params.length?"?"+r.params.join("&"):"";return r.protocol&&r.protocol.length>0?r.protocol+"://"+r.authority+r.path+t:window.document.location.protocol+"//"+r.authority+r.path+t}var config=_dereq_("./config"),browser=_dereq_("./browser"),version=_dereq_("../../package.json").version,help="参见minedata.cn帮助页面";exports.isMinemapURL=isMinemapURL,exports.normalizeStyleURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/styles/v1"+a.path,makeAPIURL(a,t)},exports.normalizeGlyphsURL=function(r,t){if(!isMinemapURL(r)&&!config.fontsUrl)return r;var a=parseUrl(r);return config.fontsUrl&&config.fontsUrl+"/{fontstack}"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"||config.SRC_URL+"fonts/{fontstack}/"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"},exports.normalizeSourceURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),makeAPIURL(a,t)},exports.normalizeSpriteURL=function(r,t,a,o){if(!isMinemapURL(r)&&!config.spriteUrl){return r+""+t+a}var e=parseUrl(r);return e.path="/minemapapi/"+getVersion()+e.path+"/sprite"+t+a,config.spriteUrl&&config.spriteUrl+""+t+a||config.DOMAIN+e.path};var imageExtensionRe=/(\.(png|jpg)\d*)(?=$)/;exports.normalizeTileURL=function(r,t,a){if(!r||!isMinemapURL(r))return r.startsWith("//")?""+window.document.location.protocol+r:r;var o=parseUrl(r),e=browser.devicePixelRatio>=2||512===a?"@2x":"",i=browser.supportsWebp?".webp":"$1";return o.path=o.path.replace(imageExtensionRe,""+e+i),replaceTempAccessToken(o.params),makeAPIURL(o)};var urlRe=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/;
},{"../../package.json":27,"./browser":217,"./config":221}],237:[function(_dereq_,module,exports){
"use strict";function readUtf8(r,e,n){for(var t="",a=e;a<n;){var o=r[a],i=null,u=o>239?4:o>223?3:o>191?2:1;if(a+u>n)break;var f=void 0,l=void 0,v=void 0;1===u?o<128&&(i=o):2===u?128==(192&(f=r[a+1]))&&(i=(31&o)<<6|63&f)<=127&&(i=null):3===u?(f=r[a+1],l=r[a+2],128==(192&f)&&128==(192&l)&&((i=(15&o)<<12|(63&f)<<6|63&l)<=2047||i>=55296&&i<=57343)&&(i=null)):4===u&&(f=r[a+1],l=r[a+2],v=r[a+3],128==(192&f)&&128==(192&l)&&128==(192&v)&&((i=(15&o)<<18|(63&f)<<12|(63&l)<<6|63&v)<=65535||i>=1114112)&&(i=null)),null===i?(i=65533,u=1):i>65535&&(i-=65536,t+=String.fromCharCode(i>>>10&1023|55296),i=56320|1023&i),t+=String.fromCharCode(i),a+=u}return t}function getDecoderRange(r){for(var e=0,n=r.length,t=0;t<n;t++)e+=r.charCodeAt(t);return Number.parseInt(e/n)}function convertBytes(r,e){var n=r.length-8;if(n<=e)for(var t=0;t<n/2;t++){var a=r[t];r[t]=r[n-t-1],r[n-t-1]=a}else for(var o=parseInt(n/e),i=parseInt(e/2),u=0;u<o;u++)for(var f=u*e,l=(u+1)*e-1,v=f,s=0;v<f+i;v++,s++){var c=v,g=l-s,d=r[c];r[c]=r[g],r[g]=d}}function getQueryString(r,e){if(e&&-1!=e.indexOf("?")){var n=e.split("?")[1],t=new RegExp("(^|&)"+r+"=([^&]*)(&|$)"),a=n.match(t);if(null!=a)return unescape(a[2])}return null}exports.decoderTilePbf=function(r){var e=r.responseURL,n=r.response,t=n.byteLength,a=getQueryString("token",e)||"";if(a.length>0&&t>8){var o=new Uint8Array(n);if("minedata"==readUtf8(o,t-8,t).toLowerCase())return convertBytes(o,getDecoderRange(a)),n.slice(0,t-8)}return n};
},{}],238:[function(_dereq_,module,exports){
"use strict";var isChar=_dereq_("./is_char_in_unicode_block");module.exports.allowsIdeographicBreaking=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(!exports.charAllowsIdeographicBreaking(s.charCodeAt(0)))return!1}return!0},module.exports.allowsVerticalWritingMode=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(exports.charHasUprightVerticalOrientation(s.charCodeAt(0)))return!0}return!1},module.exports.allowsLetterSpacing=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(!exports.charAllowsLetterSpacing(s.charCodeAt(0)))return!1}return!0},module.exports.charAllowsLetterSpacing=function(a){return!isChar.Arabic(a)&&(!isChar["Arabic Supplement"](a)&&(!isChar["Arabic Extended-A"](a)&&(!isChar["Arabic Presentation Forms-A"](a)&&!isChar["Arabic Presentation Forms-B"](a))))},module.exports.charAllowsIdeographicBreaking=function(a){return!(a<11904)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!!isChar.Katakana(a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yi Radicals"](a)||!!isChar["Yi Syllables"](a))))))))))))))))))))},exports.charHasUprightVerticalOrientation=function(a){return 746===a||747===a||!(a<4352)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!(!isChar["CJK Compatibility Forms"](a)||a>=65097&&a<=65103)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!(!isChar["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Hangul Compatibility Jamo"](a)||(!!isChar["Hangul Jamo Extended-A"](a)||(!!isChar["Hangul Jamo Extended-B"](a)||(!!isChar["Hangul Jamo"](a)||(!!isChar["Hangul Syllables"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar.Kanbun(a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!(!isChar.Katakana(a)||12540===a)||(!(!isChar["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||(!(!isChar["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(!!isChar["Unified Canadian Aboriginal Syllabics"](a)||(!!isChar["Unified Canadian Aboriginal Syllabics Extended"](a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yijing Hexagram Symbols"](a)||(!!isChar["Yi Syllables"](a)||!!isChar["Yi Radicals"](a))))))))))))))))))))))))))))))},exports.charHasNeutralVerticalOrientation=function(a){return!(!isChar["Latin-1 Supplement"](a)||167!==a&&169!==a&&174!==a&&177!==a&&188!==a&&189!==a&&190!==a&&215!==a&&247!==a)||(!(!isChar["General Punctuation"](a)||8214!==a&&8224!==a&&8225!==a&&8240!==a&&8241!==a&&8251!==a&&8252!==a&&8258!==a&&8263!==a&&8264!==a&&8265!==a&&8273!==a)||(!!isChar["Letterlike Symbols"](a)||(!!isChar["Number Forms"](a)||(!(!isChar["Miscellaneous Technical"](a)||!(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||9003===a||a>=9085&&a<=9114||a>=9150&&a<=9165||9167===a||a>=9169&&a<=9179||a>=9186&&a<=9215))||(!(!isChar["Control Pictures"](a)||9251===a)||(!!isChar["Optical Character Recognition"](a)||(!!isChar["Enclosed Alphanumerics"](a)||(!!isChar["Geometric Shapes"](a)||(!(!isChar["Miscellaneous Symbols"](a)||a>=9754&&a<=9759)||(!(!isChar["Miscellaneous Symbols and Arrows"](a)||!(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243))||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar.Katakana(a)||(!!isChar["Private Use Area"](a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["Small Form Variants"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(8734===a||8756===a||8757===a||a>=9984&&a<=10087||a>=10102&&a<=10131||65532===a||65533===a)))))))))))))))))},exports.charHasRotatedVerticalOrientation=function(a){return!(exports.charHasUprightVerticalOrientation(a)||exports.charHasNeutralVerticalOrientation(a))};
},{"./is_char_in_unicode_block":234}],239:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("./ajax"),config=_dereq_("./config"),TOKEN_VALUE="25cc55a69ea7422182d00d6b7c0ffa93",buffer=_dereq_("../_minemap_/@turf/turf").buffer,point=_dereq_("../_minemap_/@turf/turf").point,lineString=_dereq_("../_minemap_/@turf/turf").lineString,polygon=_dereq_("../_minemap_/@turf/turf").polygon,featureCollection=_dereq_("../_minemap_/@turf/turf").featureCollection,within=_dereq_("../_minemap_/@turf/turf").within,envelope=_dereq_("../_minemap_/@turf/turf").envelope,joinParamToUrl=function(e){var r="";return e&&Object.keys(e).map(function(o){var t=e[o];"string"!=typeof t&&(t=JSON.stringify(t)),r+=o+"="+t+"&"}),r.lastIndexOf("&")===r.length-1&&(r=r.substr(0,r.length-1)),r};exports.querySearchResultByType=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,pageNumber:t||1,pageCount:a||10,source:3},s=config.SERVICE_URL+"/search/keyword?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.queryAllSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"all",o,t,a)},exports.queryPoiSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"poi",o,t,a)},exports.queryPoiSearchResultByDataType=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,adCode:e,searchType:"poi",key:r,pageNumber:o||1,pageCount:t||10,source:3,dataType:a},s=config.SERVICE_URL+"/search/keyword?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.queryRoadSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"road",o,t,a)},exports.querySearchSurroundResult=function(e,r,o,t,a,n,i,s,u,c){var l={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,location:t,inRadius:1,spatialFuntion:a||"geofilt",radius:n||500,seq:i||0,source:3,pageNumber:s||1,pageCount:u||10},f=config.SERVICE_URL+"/search/surround?"+joinParamToUrl(l);return ajax.getJSON(f,c)},exports.querySearchBboxResult=function(e,r,o,t,a,n,i,s){var u={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,bounds:t,seq:a||0,source:1,pageNumber:n||1,pageCount:i||10},c=config.SERVICE_URL+"/search/bbox?"+joinParamToUrl(u);return ajax.getJSON(c,s)},exports.querySearchAroundResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,location:e,type:r||"poi",radius:o||1e3,count:t||5},i=config.SERVICE_URL+"/search/around?"+joinParamToUrl(n);return ajax.getJSON(i,a)},exports.queryRouteDrivingResult=function(e,r,o,t,a,n,i,s,u){var c={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||null,shpFlag:t||0,costModel:a||16,numAlt:n||1,criteria:i||0,traffic:s||0,source:1},l=config.SERVICE_URL+"/route/driving?"+joinParamToUrl(c);return ajax.getJSON(l,u)},exports.queryRouteDrivingResult2=function(e,r,o,t,a,n,i,s,u){var c={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||null,shpFlag:t||0,costModel:a||16,numAlt:n||1,criteria:i||0,traffic:s||0,source:3},l=config.SERVICE_URL+"/route/driving?"+joinParamToUrl(c);return ajax.getJSON(l,u)},exports.queryRouteDrivingResult3=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||"",st:t,avoidArea:a||"",source:3},s=config.SERVICE_URL+"/route/driving2?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.queryRouteBusResult=function(e,r,o,t,a,n,i){var s={token:TOKEN_VALUE,adCode:e,sPoint:r,ePoint:o,strategy:t||0,shpInfoFlag:a||0,showWalkInfo:n||0,source:1},u=config.SERVICE_URL+"/route/busTransfer?"+joinParamToUrl(s);return ajax.getJSON(u,i)},exports.queryRouteBusResult2=function(e,r,o,t,a,n,i){var s={token:TOKEN_VALUE,adCode:e,sPoint:r,ePoint:o,strategy:t||0,shpInfoFlag:a||0,showWalkInfo:n||0,source:3},u=config.SERVICE_URL+"/route/busTransfer?"+joinParamToUrl(s);return ajax.getJSON(u,i)},exports.queryAdminResultByPoint=function(e,r,o){var t={token:TOKEN_VALUE,location:e,geometry:r||0},a=config.SERVICE_URL+"/search/adminByPoint?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryGeoCodingResult=function(e,r,o){var t={token:TOKEN_VALUE,adCode:e,address:r,source:3},a=config.SERVICE_URL+"/coder/geocoding?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryReverseGeoCodingResult=function(e,r,o,t,a,n){var i={token:TOKEN_VALUE,location:e,type:r||1,radius:o||300,roadRadius:t||300,kind:a||0,source:3},s=config.SERVICE_URL+"/coder/reverseGeocoding?"+joinParamToUrl(i);return ajax.getJSON(s,n)},exports.querySmartTipsResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,adCode:e,input:r,searchType:o||"all",pageCount:t||10},i=config.SERVICE_URL+"/tips/smartTips?"+joinParamToUrl(n);return ajax.getJSON(i,a)},exports.queryBusRouteResultByKeyword=function(e,r,o){var t={adCode:e,keyword:r},a=config.SERVICE_URL+"/route/busRoute?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryBusStationResultByKeyword=function(e,r,o){var t={adCode:e,keyword:r},a=config.SERVICE_URL+"/route/busStation?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.searchNameByKey=function(e,r){if(e){var o=config.SERVICE_URL+"/searchnamebykey/"+e;return ajax.getJSON(o,r)}},exports.searchRoadByName=function(e,r){if(e){var o=config.SERVICE_URL+"/searchroadbyname/"+e;return ajax.getJSON(o,r)}},exports.searchTrafficJam=function(e,r,o){if(e&&r){var t=config.SERVICE_URL+"/searchtrafficjam/";return ajax.postJSON(t,{polygon:JSON.stringify(e),dis:r},o)}},exports.searchCrossNameByKey=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossnamebykey/"+e;return ajax.getJSON(o,r)}},exports.searchCrossByName=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossbyname/"+e;return ajax.getJSON(o,r)}},exports.searchCrossById=function(e,r){if(e){var o=config.serviceUrl+"/service/searchcrossbyid/"+e;return ajax.getJSON(o,r)}},exports.searchRoundCrossByName=function(e,r){if(e){var o=config.serviceUrl+"/service/searchroundcrossbyname/"+e;return ajax.getJSON(o,r)}},exports.searchRoundCrossById=function(e,r){if(e){var o=config.serviceUrl+"/service/searchroundcrossbyid/"+e;return ajax.getJSON(o,r)}},exports.searchCrossByCoord=function(e,r,o,t){if(e&&r&&o){var a=config.serviceUrl+"/service/searchcrossbycoord/"+e+"/"+r+"/"+o;return ajax.getJSON(a,t)}},exports.updateRticStatus=function(e,r,o,t){if(e&&r&&o){var a=config.serviceUrl+"/service/updatetricstatus/"+e+"/"+r+"/"+o;return ajax.getJSON(a,t)}},exports.matchTrack=function(e,r,o,t){if(e){var a=config.serviceUrl+"/service/matchtrack/";return ajax.postJSON(a,{line:JSON.stringify(e),costmodel:o,criteria:t},r)}},exports.queryFeaturesWithinBuffer=function(e,r,o,t,a,n,i,s){if(e&&r){var u=null;if(e instanceof Array)switch(r){case"point":u=buffer(point(e),o/1e3,{units:"kilometers"});break;case"line":u=buffer(lineString(e),o/1e3,{units:"kilometers"});break;case"polygon":u=buffer(polygon(e),o/1e3,{units:"kilometers"})}else u=buffer(e,o/1e3,{units:"kilometers"});var c=envelope(u),l=c.geometry.coordinates[0],f=l[0][0]+","+l[0][1]+","+l[2][0]+","+l[2][1],p={token:TOKEN_VALUE,adCode:t,searchType:"all",key:a,bounds:f,seq:0,source:3,pageNumber:n||1,pageCount:i||10},g=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(p);return ajax.getJSON(g,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,i=null;i="FeatureCollection"!==u.type?{type:"FeatureCollection",features:[u]}:u;within(featureCollection([point(n)]),i).features.length>0&&o.push(a)}r.data.rows=o,r.buffer=u,s(e,r)})}},exports.queryFeaturesWithinBufferByType=function(e,r,o,t,a,n,i,s,u){if(e&&r){var c=null;if(e instanceof Array)switch(r){case"point":c=buffer(point(e),o/1e3,{units:"kilometers"});break;case"line":c=buffer(lineString(e),o/1e3,{units:"kilometers"});break;case"polygon":c=buffer(polygon(e),o/1e3,{units:"kilometers"})}else c=buffer(e,o/1e3,{units:"kilometers"});var l=envelope(c),f=l.geometry.coordinates[0],p=f[0][0]+","+f[0][1]+","+f[2][0]+","+f[2][1],g={token:TOKEN_VALUE,adCode:t,searchType:n,key:a,bounds:p,seq:0,source:3,pageNumber:i||1,pageCount:s||10},y=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(g);return ajax.getJSON(y,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,i=null;i="FeatureCollection"!==c.type?{type:"FeatureCollection",features:[c]}:c;within(featureCollection([point(n)]),i).features.length>0&&o.push(a)}r.data.rows=o,r.buffer=c,u(e,r)})}},exports.queryFeaturesWithinGeometry=function(e,r,o,t,a,n){var i=null;i=e instanceof Array?polygon(e):e;var s=envelope(i),u=s.geometry.coordinates[0],c=u[0][0]+","+u[0][1]+","+u[2][0]+","+u[2][1],l={token:TOKEN_VALUE,adCode:r,searchType:"all",key:o,bounds:c,seq:0,source:3,pageNumber:t||1,pageCount:a||10},f=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(l);return ajax.getJSON(f,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],s=a.geom.coordinates,u=null;u="FeatureCollection"!==i.type?{type:"FeatureCollection",features:[i]}:i;within(featureCollection([point(s)]),u).features.length>0&&o.push(a)}r.data.rows=o,n(e,r)})},exports.queryFeaturesWithinGeometryByType=function(e,r,o,t,a,n,i){var s=null;s=e instanceof Array?polygon(e):e;var u=envelope(s),c=u.geometry.coordinates[0],l=c[0][0]+","+c[0][1]+","+c[2][0]+","+c[2][1],f={token:TOKEN_VALUE,adCode:r,key:o,bounds:l,searchType:t,seq:0,source:3,pageNumber:a||1,pageCount:n||10},p=config.DOMAIN+"/service/search/bbox?"+joinParamToUrl(f);return ajax.getJSON(p,function(e,r){for(var o=[],t=0;t<r.data.rows.length;t++){var a=r.data.rows[t],n=a.geom.coordinates,u=null;u="FeatureCollection"!==s.type?{type:"FeatureCollection",features:[s]}:s;within(featureCollection([point(n)]),u).features.length>0&&o.push(a)}r.data.rows=o,i(e,r)})};
},{"../_minemap_/@turf/turf":28,"./ajax":216,"./config":221}],240:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("../geo/lng_lat");module.exports=function(n,t,l){if(n=new LngLat(n.lng,n.lat),t){var a=new LngLat(n.lng-360,n.lat),i=new LngLat(n.lng+360,n.lat),o=l.locationPoint(n).distSqr(t);l.locationPoint(a).distSqr(t)<o?n=a:l.locationPoint(i).distSqr(t)<o&&(n=i)}for(;Math.abs(n.lng-l.center.lng)>180;){var e=l.locationPoint(n);if(e.x>=0&&e.y>=0&&e.x<=l.width&&e.y<=l.height)break;n.lng>l.center.lng?n.lng-=360:n.lng+=360}return n};
},{"../geo/lng_lat":78}],241:[function(_dereq_,module,exports){
"use strict";function createStructArrayType(t){var e=JSON.stringify(t);if(structArrayTypeCache[e])return structArrayTypeCache[e];var r=void 0===t.alignment?1:t.alignment,n=0,i=0,a=["Uint8"],o=t.members.map(function(t){a.indexOf(t.type)<0&&a.push(t.type);var e=sizeOf(t.type),o=n=align(n,Math.max(r,e)),s=t.components||1;return i=Math.max(i,e),n+=e*s,{name:t.name,type:t.type,components:s,offset:o}}),s=align(n,Math.max(i,r)),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Struct);p.prototype.alignment=r,p.prototype.size=s;for(var y=0,c=o;y<c.length;y+=1)for(var h=c[y],u=0;u<h.components;u++){var f=h.name+(1===h.components?"":u);if(f in p.prototype)throw new Error(f+" is a reserved name and cannot be used as a member name.");Object.defineProperty(p.prototype,f,{get:createGetter(h,u),set:createSetter(h,u)})}var m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(StructArray);return m.prototype.members=o,m.prototype.StructType=p,m.prototype.bytesPerElement=s,m.prototype.emplaceBack=createEmplaceBack(o,s),m.prototype._usedTypes=a,structArrayTypeCache[e]=m,m}function align(t,e){return Math.ceil(t/e)*e}function sizeOf(t){return viewTypes[t].BYTES_PER_ELEMENT}function getArrayViewName(t){return t.toLowerCase()}function createEmplaceBack(t,e){for(var r=[],n=[],i="var i = this.length;\nthis.resize(this.length + 1);\n",a=0,o=t;a<o.length;a+=1){var s=o[a],p=sizeOf(s.type);r.indexOf(p)<0&&(r.push(p),i+="var o"+p.toFixed(0)+" = i * "+(e/p).toFixed(0)+";\n");for(var y=0;y<s.components;y++){var c="v"+n.length,h="o"+p.toFixed(0)+" + "+(s.offset/p+y).toFixed(0);i+="this."+getArrayViewName(s.type)+"["+h+"] = "+c+";\n",n.push(c)}}return i+="return i;",new Function(n.toString(),i)}function createMemberComponentString(t,e){var r="this._pos"+sizeOf(t.type).toFixed(0),n=(t.offset/sizeOf(t.type)+e).toFixed(0),i=r+" + "+n;return"this._structArray."+getArrayViewName(t.type)+"["+i+"]"}function createGetter(t,e){return new Function("return "+createMemberComponentString(t,e)+";")}function createSetter(t,e){return new Function("x",createMemberComponentString(t,e)+" = x;")}module.exports=createStructArrayType;var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Struct=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},DEFAULT_CAPACITY=128,RESIZE_MULTIPLIER=5,StructArray=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};StructArray.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},StructArray.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},StructArray.prototype.get=function(t){return new this.StructType(this,t)},StructArray.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},StructArray.prototype.clear=function(){this.length=0},StructArray.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(this.capacity*RESIZE_MULTIPLIER),DEFAULT_CAPACITY),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},StructArray.prototype._refreshViews=function(){for(var t=this,e=0,r=t._usedTypes;e<r.length;e+=1){var n=r[e];t[getArrayViewName(n)]=new viewTypes[n](t.arrayBuffer)}},StructArray.prototype.toArray=function(t,e){for(var r=this,n=[],i=t;i<e;i++){var a=r.get(i);n.push(a)}return n};var structArrayTypeCache={};
},{}],242:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("./browser"),Throttler=function(t,o){this.frequency=t,this.throttledFunction=o,this.lastInvocation=0};Throttler.prototype.invoke=function(){var t=this;if(!this.pendingInvocation){var o=0===this.lastInvocation?0:this.lastInvocation+this.frequency-browser.now();o<=0?(this.lastInvocation=browser.now(),this.throttledFunction()):this.pendingInvocation=setTimeout(function(){t.pendingInvocation=void 0,t.lastInvocation=browser.now(),t.throttledFunction()},o)}},Throttler.prototype.stop=function(){this.pendingInvocation&&(clearTimeout(this.pendingInvocation),this.pendingInvocation=void 0)},module.exports=Throttler;
},{"./browser":217}],243:[function(_dereq_,module,exports){
"use strict";function resolveTokens(e,n){return n.replace(/{([^{}]+)}/g,function(n,r){return r in e?e[r]:""})}module.exports=resolveTokens;
},{}],244:[function(_dereq_,module,exports){
"use strict";var UnitBezier=_dereq_("../_minemap_/unitbezier"),Coordinate=_dereq_("../geo/coordinate"),Point=_dereq_("../_minemap_/point-geometry");exports.easeCubicInOut=function(r){if(r<=0)return 0;if(r>=1)return 1;var e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)},exports.bezier=function(r,e,n,t){var o=new UnitBezier(r,e,n,t);return function(r){return o.solve(r)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.clamp=function(r,e,n){return Math.min(n,Math.max(e,r))},exports.wrap=function(r,e,n){var t=n-e,o=((r-e)%t+t)%t+e;return o===e?n:o},exports.asyncAll=function(r,e,n){if(!r.length)return n(null,[]);var t=r.length,o=new Array(r.length),a=null;r.forEach(function(r,i){e(r,function(r,e){r&&(a=r),o[i]=e,0==--t&&n(a,o)})})},exports.values=function(r){var e=[];for(var n in r)e.push(r[n]);return e},exports.keysDifference=function(r,e){var n=[];for(var t in r)t in e||n.push(t);return n},exports.extend=function(r){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var t=0,o=e;t<o.length;t+=1){var a=o[t];for(var i in a)r[i]=a[i]}return r},exports.pick=function(r,e){for(var n={},t=0;t<e.length;t++){var o=e[t];o in r&&(n[o]=r[o])}return n};var id=1;exports.uniqueId=function(){return id++},exports.bindAll=function(r,e){r.forEach(function(r){e[r]&&(e[r]=e[r].bind(e))})},exports.getCoordinatesCenter=function(r){for(var e=1/0,n=1/0,t=-1/0,o=-1/0,a=0;a<r.length;a++)e=Math.min(e,r[a].column),n=Math.min(n,r[a].row),t=Math.max(t,r[a].column),o=Math.max(o,r[a].row);var i=t-e,u=o-n,s=Math.max(i,u),c=Math.max(0,Math.floor(-Math.log(s)/Math.LN2));return new Coordinate((e+t)/2,(n+o)/2,0).zoomTo(c)},exports.endsWith=function(r,e){return-1!==r.indexOf(e,r.length-e.length)},exports.mapObject=function(r,e,n){var t=this,o={};for(var a in r)o[a]=e.call(n||t,r[a],a,r);return o},exports.filterObject=function(r,e,n){var t=this,o={};for(var a in r)e.call(n||t,r[a],a,r)&&(o[a]=r[a]);return o},exports.deepEqual=function(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(var n=0;n<r.length;n++)if(!exports.deepEqual(r[n],e[n]))return!1;return!0}if("object"==typeof r&&null!==r&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(r).length!==Object.keys(e).length)return!1;for(var t in r)if(!exports.deepEqual(r[t],e[t]))return!1;return!0}return r===e},exports.clone=function(r){return Array.isArray(r)?r.map(exports.clone):"object"==typeof r&&r?exports.mapObject(r,exports.clone):r},exports.arraysIntersect=function(r,e){for(var n=0;n<r.length;n++)if(e.indexOf(r[n])>=0)return!0;return!1};var warnOnceHistory={};exports.warnOnce=function(r){warnOnceHistory[r]||("undefined"!=typeof console&&console.warn(r),warnOnceHistory[r]=!0)},exports.isCounterClockwise=function(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)},exports.calculateSignedArea=function(r){for(var e=0,n=0,t=r.length,o=t-1,a=void 0,i=void 0;n<t;o=n++)a=r[n],i=r[o],e+=(i.x-a.x)*(a.y+i.y);return e},exports.isClosedPolygon=function(r){if(r.length<4)return!1;var e=r[0],n=r[r.length-1];return!(Math.abs(e.x-n.x)>0||Math.abs(e.y-n.y)>0)&&Math.abs(exports.calculateSignedArea(r))>.01},exports.sphericalToCartesian=function(r){var e=r[0],n=r[1],t=r[2];return n+=90,n*=Math.PI/180,t*=Math.PI/180,[e*Math.cos(n)*Math.sin(t),e*Math.sin(n)*Math.sin(t),e*Math.cos(t)]},exports.parseCacheControl=function(r){var e=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,n={};if(r.replace(e,function(r,e,t,o){var a=t||o;return n[e]=!a||a.toLowerCase(),""}),n["max-age"]){var t=parseInt(n["max-age"],10);isNaN(t)?delete n["max-age"]:n["max-age"]=t}return n};
},{"../_minemap_/point-geometry":41,"../_minemap_/unitbezier":45,"../geo/coordinate":77}],245:[function(_dereq_,module,exports){
"use strict";var Feature=function(e,t,r,o){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=o,this.properties=e.properties,null!=e.id&&(this.id=e.id)},prototypeAccessors={geometry:{}};prototypeAccessors.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},prototypeAccessors.geometry.set=function(e){this._geometry=e},Feature.prototype.toJSON=function(){var e=this,t={geometry:this.geometry};for(var r in e)"_geometry"!==r&&"_vectorTileFeature"!==r&&(t[r]=e[r]);return t},Object.defineProperties(Feature.prototype,prototypeAccessors),module.exports=Feature;
},{}],246:[function(_dereq_,module,exports){
"use strict";var scriptDetection=_dereq_("./script_detection");module.exports=function(t){for(var o="",e=0;e<t.length;e++){var r=t.charCodeAt(e+1)||null,l=t.charCodeAt(e-1)||null;(!r||!scriptDetection.charHasRotatedVerticalOrientation(r)||module.exports.lookup[t[e+1]])&&(!l||!scriptDetection.charHasRotatedVerticalOrientation(l)||module.exports.lookup[t[e-1]])&&module.exports.lookup[t[e]]?o+=module.exports.lookup[t[e]]:o+=t[e]}return o},module.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};
},{"./script_detection":238}],247:[function(_dereq_,module,exports){
"use strict";var WebWorker=_dereq_("./web_worker"),WorkerPool=function(){this.active={}};WorkerPool.prototype.acquire=function(r){var e=this;if(!this.workers){var o=_dereq_("../").workerCount;for(this.workers=[];this.workers.length<o;)e.workers.push(new WebWorker)}return this.active[r]=!0,this.workers.slice()},WorkerPool.prototype.release=function(r){delete this.active[r],0===Object.keys(this.active).length&&(this.workers.forEach(function(r){r.terminate()}),this.workers=null)},module.exports=WorkerPool;
},{"../":81,"./web_worker":218}]},{},[81])(81)
});

